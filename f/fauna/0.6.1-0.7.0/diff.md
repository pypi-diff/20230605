# Comparing `tmp/fauna-0.6.1-py2.py3-none-any.whl.zip` & `tmp/fauna-0.7.0-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,26 @@
-Zip file size: 25145 bytes, number of entries: 24
--rw-r--r--  2.0 unx      301 b- defN 23-Apr-20 18:13 fauna/__init__.py
--rw-r--r--  2.0 unx      102 b- defN 23-Apr-20 18:13 fauna/client/__init__.py
--rw-r--r--  2.0 unx    18705 b- defN 23-Apr-20 18:13 fauna/client/client.py
--rw-r--r--  2.0 unx       90 b- defN 23-Apr-20 18:13 fauna/client/endpoints.py
--rw-r--r--  2.0 unx     3190 b- defN 23-Apr-20 18:13 fauna/client/headers.py
--rw-r--r--  2.0 unx     2213 b- defN 23-Apr-20 18:13 fauna/client/utils.py
--rw-r--r--  2.0 unx      161 b- defN 23-Apr-20 18:13 fauna/encoding/__init__.py
--rw-r--r--  2.0 unx     6450 b- defN 23-Apr-20 18:13 fauna/encoding/decoder.py
--rw-r--r--  2.0 unx     8122 b- defN 23-Apr-20 18:13 fauna/encoding/encoder.py
--rw-r--r--  2.0 unx     5991 b- defN 23-Apr-20 18:13 fauna/encoding/wire_protocol.py
--rw-r--r--  2.0 unx      361 b- defN 23-Apr-20 18:13 fauna/errors/__init__.py
--rw-r--r--  2.0 unx     4853 b- defN 23-Apr-20 18:13 fauna/errors/errors.py
--rw-r--r--  2.0 unx       88 b- defN 23-Apr-20 18:13 fauna/http/__init__.py
--rw-r--r--  2.0 unx     1201 b- defN 23-Apr-20 18:13 fauna/http/http_client.py
--rw-r--r--  2.0 unx     2323 b- defN 23-Apr-20 18:13 fauna/http/httpx_client.py
--rw-r--r--  2.0 unx      153 b- defN 23-Apr-20 18:13 fauna/query/__init__.py
--rw-r--r--  2.0 unx     9411 b- defN 23-Apr-20 18:13 fauna/query/models.py
--rw-r--r--  2.0 unx     4005 b- defN 23-Apr-20 18:13 fauna/query/query_builder.py
--rw-r--r--  2.0 unx     2851 b- defN 23-Apr-20 18:13 fauna/query/template.py
--rw-r--r--  2.0 unx      545 b- defN 23-Apr-20 19:47 fauna-0.6.1.dist-info/LICENSE
--rw-r--r--  2.0 unx     7073 b- defN 23-Apr-20 19:47 fauna-0.6.1.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Apr-20 19:47 fauna-0.6.1.dist-info/WHEEL
--rw-r--r--  2.0 unx        6 b- defN 23-Apr-20 19:47 fauna-0.6.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1903 b- defN 23-Apr-20 19:47 fauna-0.6.1.dist-info/RECORD
-24 files, 80208 bytes uncompressed, 22095 bytes compressed:  72.5%
+Zip file size: 25983 bytes, number of entries: 24
+-rw-r--r--  2.0 unx      301 b- defN 23-Jun-03 11:34 fauna/__init__.py
+-rw-r--r--  2.0 unx      102 b- defN 23-Jun-03 11:34 fauna/client/__init__.py
+-rw-r--r--  2.0 unx    22080 b- defN 23-Jun-03 11:34 fauna/client/client.py
+-rw-r--r--  2.0 unx       90 b- defN 23-Jun-03 11:34 fauna/client/endpoints.py
+-rw-r--r--  2.0 unx     3201 b- defN 23-Jun-03 11:34 fauna/client/headers.py
+-rw-r--r--  2.0 unx     2213 b- defN 23-Jun-03 11:34 fauna/client/utils.py
+-rw-r--r--  2.0 unx      161 b- defN 23-Jun-03 11:34 fauna/encoding/__init__.py
+-rw-r--r--  2.0 unx     6450 b- defN 23-Jun-03 11:34 fauna/encoding/decoder.py
+-rw-r--r--  2.0 unx     8122 b- defN 23-Jun-03 11:34 fauna/encoding/encoder.py
+-rw-r--r--  2.0 unx     5991 b- defN 23-Jun-03 11:34 fauna/encoding/wire_protocol.py
+-rw-r--r--  2.0 unx      361 b- defN 23-Jun-03 11:34 fauna/errors/__init__.py
+-rw-r--r--  2.0 unx     4853 b- defN 23-Jun-03 11:34 fauna/errors/errors.py
+-rw-r--r--  2.0 unx       88 b- defN 23-Jun-03 11:34 fauna/http/__init__.py
+-rw-r--r--  2.0 unx     1201 b- defN 23-Jun-03 11:34 fauna/http/http_client.py
+-rw-r--r--  2.0 unx     2323 b- defN 23-Jun-03 11:34 fauna/http/httpx_client.py
+-rw-r--r--  2.0 unx      153 b- defN 23-Jun-03 11:34 fauna/query/__init__.py
+-rw-r--r--  2.0 unx     9411 b- defN 23-Jun-03 11:34 fauna/query/models.py
+-rw-r--r--  2.0 unx     4005 b- defN 23-Jun-03 11:34 fauna/query/query_builder.py
+-rw-r--r--  2.0 unx     2851 b- defN 23-Jun-03 11:34 fauna/query/template.py
+-rw-r--r--  2.0 unx      545 b- defN 23-Jun-05 16:58 fauna-0.7.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx     7568 b- defN 23-Jun-05 16:58 fauna-0.7.0.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jun-05 16:58 fauna-0.7.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        6 b- defN 23-Jun-05 16:58 fauna-0.7.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1903 b- defN 23-Jun-05 16:58 fauna-0.7.0.dist-info/RECORD
+24 files, 84089 bytes uncompressed, 22933 bytes compressed:  72.7%
```

## zipnote {}

```diff
@@ -51,23 +51,23 @@
 
 Filename: fauna/query/query_builder.py
 Comment: 
 
 Filename: fauna/query/template.py
 Comment: 
 
-Filename: fauna-0.6.1.dist-info/LICENSE
+Filename: fauna-0.7.0.dist-info/LICENSE
 Comment: 
 
-Filename: fauna-0.6.1.dist-info/METADATA
+Filename: fauna-0.7.0.dist-info/METADATA
 Comment: 
 
-Filename: fauna-0.6.1.dist-info/WHEEL
+Filename: fauna-0.7.0.dist-info/WHEEL
 Comment: 
 
-Filename: fauna-0.6.1.dist-info/top_level.txt
+Filename: fauna-0.7.0.dist-info/top_level.txt
 Comment: 
 
-Filename: fauna-0.6.1.dist-info/RECORD
+Filename: fauna-0.7.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## fauna/__init__.py

```diff
@@ -1,9 +1,9 @@
 __title__ = "Fauna"
-__version__ = "0.6.1"
+__version__ = "0.7.0"
 __api_version__ = "10"
 __author__ = "Fauna, Inc"
 __license__ = "MPL 2.0"
 __copyright__ = "2023 Fauna, Inc"
 
 from fauna.query import fql, Document, DocumentReference, NamedDocument, NamedDocumentReference, NullDocument, Module, Page
```

## fauna/client/client.py

```diff
@@ -1,18 +1,18 @@
 from datetime import timedelta
 from dataclasses import dataclass
-from typing import Any, Dict, Mapping, Optional, List
+from typing import Any, Dict, Iterator, Mapping, Optional, List
 
 import fauna
 from fauna.errors import AuthenticationError, ClientError, ProtocolError, ServiceError, AuthorizationError, \
     ServiceInternalError, ServiceTimeoutError, ThrottlingError, QueryTimeoutError, QueryRuntimeError, \
     QueryCheckError, AbortError, InvalidRequestError
 from fauna.client.headers import _DriverEnvironment, _Header, _Auth, Header
 from fauna.http.http_client import HTTPClient
-from fauna.query.query_builder import Query
+from fauna.query import Query, Page, fql
 from fauna.client.utils import _Environment, LastTxnTs
 from fauna.encoding import FaunaEncoder, FaunaDecoder
 from fauna.encoding import QuerySuccess, ConstraintFailure, QueryTags, QueryStats
 
 DefaultHttpConnectTimeout = timedelta(seconds=5)
 DefaultHttpReadTimeout: Optional[timedelta] = None
 DefaultHttpWriteTimeout = timedelta(seconds=5)
@@ -175,23 +175,52 @@
         Get the query timeout for all queries.
         """
         if self._query_timeout_ms is not None:
             return timedelta(milliseconds=self._query_timeout_ms)
         else:
             return None
 
+    def paginate(
+        self,
+        fql: Query,
+        opts: Optional[QueryOptions] = None,
+    ) -> "QueryIterator":
+        """
+        Run a query on Fauna and returning an iterator of results. If the query
+        returns a Page, the iterator will fetch additional Pages until the
+        after token is null.
+
+        :param fql: A Query
+        :param opts: (Optional) Query Options
+
+        :return: a :class:`QueryResponse`
+
+        :raises NetworkError: HTTP Request failed in transit
+        :raises ProtocolError: HTTP error not from Fauna
+        :raises ServiceError: Fauna returned an error
+        :raises ValueError: Encoding and decoding errors
+        :raises TypeError: Invalid param types
+        """
+
+        if not isinstance(fql, Query):
+            err_msg = f"'fql' must be a Query but was a {type(fql)}. You can build a " \
+                       f"Query by calling fauna.fql()"
+            raise TypeError(err_msg)
+
+        return QueryIterator(self, fql, opts)
+
     def query(
         self,
         fql: Query,
         opts: Optional[QueryOptions] = None,
     ) -> QuerySuccess:
         """
         Run a query on Fauna.
 
-        :param fql: A string, but will eventually be a query expression.
+        :param fql: A Query
         :param opts: (Optional) Query Options
 
         :return: a :class:`QueryResponse`
 
         :raises NetworkError: HTTP Request failed in transit
         :raises ProtocolError: HTTP error not from Fauna
         :raises ServiceError: Fauna returned an error
@@ -224,15 +253,15 @@
     ) -> QuerySuccess:
 
         headers = self._headers.copy()
         headers[_Header.Format] = "tagged"
         headers[_Header.Authorization] = self._auth.bearer()
 
         if self._query_timeout_ms is not None:
-            headers[Header.TimeoutMs] = str(self._query_timeout_ms)
+            headers[Header.QueryTimeoutMs] = str(self._query_timeout_ms)
 
         headers.update(self._last_txn_ts.request_header)
 
         query_tags = {}
         if self._query_tags is not None:
             query_tags.update(self._query_tags)
 
@@ -241,16 +270,16 @@
                 headers[Header.Linearized] = str(opts.linearized).lower()
             if opts.max_contention_retries is not None:
                 headers[Header.MaxContentionRetries] = \
                     f"{opts.max_contention_retries}"
             if opts.traceparent is not None:
                 headers[Header.Traceparent] = opts.traceparent
             if opts.query_timeout is not None:
-                timeout_ms = f"{opts.query_timeout.total_seconds() * 1000}"
-                headers[Header.TimeoutMs] = timeout_ms
+                timeout_ms = f"{int(opts.query_timeout.total_seconds() * 1000)}"
+                headers[Header.QueryTimeoutMs] = timeout_ms
             if opts.query_tags is not None:
                 query_tags.update(opts.query_tags)
             if opts.typecheck is not None:
                 headers[Header.Typecheck] = str(opts.typecheck).lower()
             if opts.additional_headers is not None:
                 headers.update(opts.additional_headers)
 
@@ -474,7 +503,76 @@
         if endpoint is None:
             endpoint = _Environment.EnvFaunaEndpoint()
 
         if endpoint[-1:] == "/":
             endpoint = endpoint[:-1]
 
         self._endpoint = endpoint
+
+
+class QueryIterator:
+    """A class to provider an iterator on top of Fauna queries."""
+
+    def __init__(self,
+                 client: Client,
+                 fql: Query,
+                 opts: Optional[QueryOptions] = None):
+        """Initializes the QueryIterator
+
+        :param fql: A Query
+        :param opts: (Optional) Query Options
+
+        :raises TypeError: Invalid param types
+        """
+        if not isinstance(client, Client):
+            err_msg = f"'client' must be a Client but was a {type(client)}. You can build a " \
+                        f"Client by calling fauna.client.Client()"
+            raise TypeError(err_msg)
+
+        if not isinstance(fql, Query):
+            err_msg = f"'fql' must be a Query but was a {type(fql)}. You can build a " \
+                       f"Query by calling fauna.fql()"
+            raise TypeError(err_msg)
+
+        self.client = client
+        self.fql = fql
+        self.opts = opts
+
+    def __iter__(self) -> Iterator:
+        return self.iter()
+
+    def iter(self) -> Iterator:
+        """
+        A generator function that immediately fetches and yields the results of
+        the stored query. Yields additional pages on subsequent iterations if
+        they exist
+        """
+
+        cursor = None
+        initial_response = self.client.query(self.fql, self.opts)
+
+        if isinstance(initial_response.data, Page):
+            cursor = initial_response.data.after
+            yield initial_response.data.data
+
+            while cursor is not None:
+                next_response = self.client.query(
+                    fql("Set.paginate(${after})", after=cursor), self.opts)
+                # TODO: `Set.paginate` does not yet return a `@set` tagged value
+                #       so we will get back a plain object that might not have
+                #       an after property.
+                cursor = next_response.data.get("after")
+                yield next_response.data.get("data")
+
+        else:
+            yield [initial_response.data]
+
+    def flatten(self) -> Iterator:
+        """
+        A generator function that immediately fetches and yields the results of
+        the stored query. Yields each item individually, rather than a whole
+        Page at a time. Fetches additional pages as required if they exist.
+        """
+
+        for page in self.iter():
+            for item in page:
+                yield item
```

## fauna/client/headers.py

```diff
@@ -7,15 +7,15 @@
 from fauna import __version__
 
 
 class Header:
     LastTxnTs = "X-Last-Txn-Ts"
     Linearized = "X-Linearized"
     MaxContentionRetries = "X-Max-Contention-Retries"
-    TimeoutMs = "X-Timeout-Ms"
+    QueryTimeoutMs = "X-Query-Timeout-Ms"
     Typecheck = "X-Typecheck"
     Tags = "X-Query-Tags"
     Traceparent = "Traceparent"
 
 
 class _Header:
     AcceptEncoding = "Accept-Encoding"
```

## Comparing `fauna-0.6.1.dist-info/LICENSE` & `fauna-0.7.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `fauna-0.6.1.dist-info/METADATA` & `fauna-0.7.0.dist-info/METADATA`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: fauna
-Version: 0.6.1
+Version: 0.7.0
 Summary: Fauna Python driver for FQL 10+
 Home-page: https://github.com/fauna/fauna-python
 Author: Fauna, Inc
 Author-email: priority@fauna.com
 License: MPL 2.0
 Keywords: faunadb fauna
 Platform: UNKNOWN
@@ -16,14 +16,15 @@
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Programming Language :: Python :: 3.11
 Classifier: Topic :: Database
 Classifier: Topic :: Database :: Front-Ends
 Classifier: Operating System :: MacOS :: MacOS X
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: Unix
+Requires-Python: >=3.9, <4
 Description-Content-Type: text/x-rst
 License-File: LICENSE
 Requires-Dist: iso8601 (==1.1.0)
 Requires-Dist: future (==0.18.3)
 Requires-Dist: httpx[http2] (==0.23.*)
 Provides-Extra: lint
 Requires-Dist: yapf (==0.32.0) ; extra == 'lint'
@@ -114,15 +115,15 @@
     except FaunaException as e:
         # handle errors
         print(e)
 
 Query Composition
 -----------------
 
-This driver supports query composition with Python primitives, lists, dicts, and other FQL queries. Serialization to and from user-defined classes is not yet supportedâ€”for now, adapt your classes into a dict or list prior to using it in composition.
+This driver supports query composition with Python primitives, lists, dicts, and other FQL queries.
 
 For FQL templates, denote variables with ``${}`` and pass variables as kwargs to ``fql()``. You can escape a variable by prepending an additional ``$``.
 
 .. code-block:: python
 
     from fauna import fql
     from fauna.client import Client
@@ -132,21 +133,36 @@
     def add_two(x):
         return fql("${x} + 2", x=x)
 
     q = fql("${y} + 4", y=add_two(2))
     res = client.query(q)
     print(res.data) # 8
 
-Document Streaming
-------------------
+Serialization / Deserialization
+-------------------------------
 
-Not implemented
+Serialization and deserialization with user-defined classes is not yet supported.
+
+When building queries, adapt your classes into dicts or lists prior to using them in composition. When instantiating classes from the query result data, build them from the expected result.
+
+.. code-block:: python
+
+    class MyClass:
+        def __init__ (self, my_prop):
+            self.my_prop = my_prop
+
+        def to_dict(self):
+            return { 'my_prop': self.my_prop }
+
+        @static_method
+        def from_result(obj):
+            return MyClass(obj['my_prop'])
 
 Query Stats
-------------------
+-----------
 
 Stats are returned on query responses and ServiceErrors.
 
 .. code-block:: python
 
     from fauna import fql
     from fauna.client import Client
@@ -165,14 +181,18 @@
         qs: QuerySuccess = client.query(q)
         emit_stats(qs.stats)
     except ServiceError as e:
         if e.stats is not None:
             emit_stats(e.stats)
         # more error handling...
 
+Document Streaming
+------------------
+
+Not implemented
 
 Setup
 -----
 
 .. code-block:: bash
 
     $ virtualenv venv
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## Comparing `fauna-0.6.1.dist-info/RECORD` & `fauna-0.7.0.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,24 +1,24 @@
-fauna/__init__.py,sha256=TUHbkVvykiUA7YBhOSRhwWd4xUxe7mME56PdOuZTM6s,301
+fauna/__init__.py,sha256=hjknrtA2M-CtyVcjF2eev4xyc8oKFj3_vtIL24lQY40,301
 fauna/client/__init__.py,sha256=SH5k-XCHlGKbsSwvRPUzlyXpsN-Bk_uHNNj78D5zpis,102
-fauna/client/client.py,sha256=VrZ7kqo7VStQm1oVsu_4TCOu3anvKSTU4bqpkIqySwg,18705
+fauna/client/client.py,sha256=4tk3a8rqatHGa3ktWlR2w03kWOAlw6fP7YICBWafG3w,22080
 fauna/client/endpoints.py,sha256=nXe1EX-OaVuWc8GRreLcyMDUvfvsJWkec9JlyMAGGzY,90
-fauna/client/headers.py,sha256=IumkqZFRZ9u2ukslT_nybc54caKOutwVF-l5dtN2cdw,3190
+fauna/client/headers.py,sha256=qFIHtEfRnSvhXwxq5dRNrw3l3vqp41ECdLpKGtUdd5E,3201
 fauna/client/utils.py,sha256=N6zaexuSCdsCyyLnsXI7naqp3Qxwdn_yzwCtEIEkwFA,2213
 fauna/encoding/__init__.py,sha256=_IWx06Wiqa2jrpIEjbGAPcCFyFj0y39KuGhXc3YMPyg,161
 fauna/encoding/decoder.py,sha256=cxx845g5uDQdFPG9j1Wgr3T8AOTbyRFlJbPSKxlmwsw,6450
 fauna/encoding/encoder.py,sha256=7tlXTkxr9BusVtkicQWoL384b8cZZiigu8HeT5exTh4,8122
 fauna/encoding/wire_protocol.py,sha256=gEvtRjsOZfC7fm1xDlEXNP8h_MtJgxYr5LJZ5hylzyY,5991
 fauna/errors/__init__.py,sha256=w0rUF3kSFPDxjQB8YyZ1oHvU8lo8TOyNrB_G7_fNlJM,361
 fauna/errors/errors.py,sha256=HRXZ24Sju-9vz0qnnPGbuTjj3qot90l4k3hx4UImAD0,4853
 fauna/http/__init__.py,sha256=bPdaa7lvksdkCrazHEnqHPTHi0kWD-13bxryDwSguM8,88
 fauna/http/http_client.py,sha256=AS6-dCZ5MmfZ14o5FdxWP5waeYIKMJEqrxEn-fXAE-A,1201
 fauna/http/httpx_client.py,sha256=QG4lkmzYdwiTiXM93EhKPeToGqDf8tLOViFX4fR3Gw8,2323
 fauna/query/__init__.py,sha256=Ip51imOskDJpQhDahuq-VcX3o3cb4Y62HUG26rzXCh0,153
 fauna/query/models.py,sha256=T5B1o9YUGGqhQh2QreBwqqiDtQqa43WyZ6RQO5EVUAw,9411
 fauna/query/query_builder.py,sha256=0WqByty8V5NmAYb0rYZw5BP8SUwFtXQYkhaVKFblb0Q,4005
 fauna/query/template.py,sha256=JVAz5cLS_xvTTn0yoUO8bToh7PWgz_BH09a5_XKKHYI,2851
-fauna-0.6.1.dist-info/LICENSE,sha256=0uf36d4oXjlrnYCeCbzUq9413zcktAbg1y5V_dKmNlQ,545
-fauna-0.6.1.dist-info/METADATA,sha256=gHrkpghVecNJN8wiyc0-1r6aF7YMTK0BGA2dIf5v_gg,7073
-fauna-0.6.1.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-fauna-0.6.1.dist-info/top_level.txt,sha256=Ftl5tOivmmW8rHU9QbV0qMG8M9WQp3JhmYM-s3HU10s,6
-fauna-0.6.1.dist-info/RECORD,,
+fauna-0.7.0.dist-info/LICENSE,sha256=0uf36d4oXjlrnYCeCbzUq9413zcktAbg1y5V_dKmNlQ,545
+fauna-0.7.0.dist-info/METADATA,sha256=9tRl5cwI_3yTYEXh0jpwRlbVcy_8p1YC6hfNPa3mPDs,7568
+fauna-0.7.0.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+fauna-0.7.0.dist-info/top_level.txt,sha256=Ftl5tOivmmW8rHU9QbV0qMG8M9WQp3JhmYM-s3HU10s,6
+fauna-0.7.0.dist-info/RECORD,,
```

