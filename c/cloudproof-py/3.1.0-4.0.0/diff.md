# Comparing `tmp/cloudproof_py-3.1.0-py3-none-any.whl.zip` & `tmp/cloudproof_py-4.0.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,17 @@
-Zip file size: 19473 bytes, number of entries: 14
--rw-r--r--  2.0 unx       60 b- defN 23-Apr-07 07:06 cloudproof_py/__init__.py
--rw-r--r--  2.0 unx       27 b- defN 23-Apr-07 07:06 cloudproof_py/py.typed
--rw-r--r--  2.0 unx      120 b- defN 23-Apr-07 07:06 cloudproof_py/cloudproof_fpe/__init__.py
--rw-r--r--  2.0 unx      358 b- defN 23-Apr-07 07:06 cloudproof_py/cover_crypt/__init__.py
--rw-r--r--  2.0 unx     9671 b- defN 23-Apr-07 07:06 cloudproof_py/findex/Findex.py
--rw-r--r--  2.0 unx      295 b- defN 23-Apr-07 07:06 cloudproof_py/findex/__init__.py
--rw-r--r--  2.0 unx      187 b- defN 23-Apr-07 07:06 cloudproof_py/findex/typing.py
--rw-r--r--  2.0 unx     1045 b- defN 23-Apr-07 07:06 cloudproof_py/findex/utils.py
--rw-r--r--  2.0 unx     5043 b- defN 23-Apr-07 07:06 cloudproof_py/kms/__init__.py
--rw-r--r--  2.0 unx    32275 b- defN 23-Apr-07 07:07 cloudproof_py-3.1.0.dist-info/LICENSE.md
--rw-r--r--  2.0 unx     3384 b- defN 23-Apr-07 07:07 cloudproof_py-3.1.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Apr-07 07:07 cloudproof_py-3.1.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       14 b- defN 23-Apr-07 07:07 cloudproof_py-3.1.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     1199 b- defN 23-Apr-07 07:07 cloudproof_py-3.1.0.dist-info/RECORD
-14 files, 53770 bytes uncompressed, 17455 bytes compressed:  67.5%
+Zip file size: 19743 bytes, number of entries: 15
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-05 06:35 cloudproof_py/__init__.py
+-rw-r--r--  2.0 unx       27 b- defN 23-Jun-05 06:35 cloudproof_py/py.typed
+-rw-r--r--  2.0 unx      396 b- defN 23-Jun-05 06:35 cloudproof_py/anonymization/__init__.py
+-rw-r--r--  2.0 unx      358 b- defN 23-Jun-05 06:35 cloudproof_py/cover_crypt/__init__.py
+-rw-r--r--  2.0 unx     9467 b- defN 23-Jun-05 06:35 cloudproof_py/findex/Findex.py
+-rw-r--r--  2.0 unx      295 b- defN 23-Jun-05 06:35 cloudproof_py/findex/__init__.py
+-rw-r--r--  2.0 unx      187 b- defN 23-Jun-05 06:35 cloudproof_py/findex/typing.py
+-rw-r--r--  2.0 unx     1045 b- defN 23-Jun-05 06:35 cloudproof_py/findex/utils.py
+-rw-r--r--  2.0 unx      120 b- defN 23-Jun-05 06:35 cloudproof_py/fpe/__init__.py
+-rw-r--r--  2.0 unx     5043 b- defN 23-Jun-05 06:35 cloudproof_py/kms/__init__.py
+-rw-r--r--  2.0 unx    32275 b- defN 23-Jun-05 06:35 cloudproof_py-4.0.0.dist-info/LICENSE.md
+-rw-r--r--  2.0 unx     3671 b- defN 23-Jun-05 06:35 cloudproof_py-4.0.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jun-05 06:35 cloudproof_py-4.0.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       14 b- defN 23-Jun-05 06:35 cloudproof_py-4.0.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1282 b- defN 23-Jun-05 06:35 cloudproof_py-4.0.0.dist-info/RECORD
+15 files, 54272 bytes uncompressed, 17593 bytes compressed:  67.6%
```

## zipnote {}

```diff
@@ -1,14 +1,14 @@
 Filename: cloudproof_py/__init__.py
 Comment: 
 
 Filename: cloudproof_py/py.typed
 Comment: 
 
-Filename: cloudproof_py/cloudproof_fpe/__init__.py
+Filename: cloudproof_py/anonymization/__init__.py
 Comment: 
 
 Filename: cloudproof_py/cover_crypt/__init__.py
 Comment: 
 
 Filename: cloudproof_py/findex/Findex.py
 Comment: 
@@ -18,26 +18,29 @@
 
 Filename: cloudproof_py/findex/typing.py
 Comment: 
 
 Filename: cloudproof_py/findex/utils.py
 Comment: 
 
+Filename: cloudproof_py/fpe/__init__.py
+Comment: 
+
 Filename: cloudproof_py/kms/__init__.py
 Comment: 
 
-Filename: cloudproof_py-3.1.0.dist-info/LICENSE.md
+Filename: cloudproof_py-4.0.0.dist-info/LICENSE.md
 Comment: 
 
-Filename: cloudproof_py-3.1.0.dist-info/METADATA
+Filename: cloudproof_py-4.0.0.dist-info/METADATA
 Comment: 
 
-Filename: cloudproof_py-3.1.0.dist-info/WHEEL
+Filename: cloudproof_py-4.0.0.dist-info/WHEEL
 Comment: 
 
-Filename: cloudproof_py-3.1.0.dist-info/top_level.txt
+Filename: cloudproof_py-4.0.0.dist-info/top_level.txt
 Comment: 
 
-Filename: cloudproof_py-3.1.0.dist-info/RECORD
+Filename: cloudproof_py-4.0.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## cloudproof_py/__init__.py

```diff
@@ -1,4 +0,0 @@
-00000000: 2320 2d2a 2d20 636f 6469 6e67 3a20 7574  # -*- coding: ut
-00000010: 662d 3820 2d2a 2d0a 5f5f 616c 6c5f 5f20  f-8 -*-.__all__ 
-00000020: 3d20 5b22 6669 6e64 6578 222c 2022 636f  = ["findex", "co
-00000030: 7665 725f 6372 7970 7422 5d0a            ver_crypt"].
```

## cloudproof_py/findex/Findex.py

```diff
@@ -28,37 +28,42 @@
             self.fetch_entry_table,
             self.upsert_entry_table,
             self.insert_chain_table,
         )
 
     def upsert(
         self,
-        indexed_values_and_keywords: IndexedValuesAndKeywords,
         master_key: MasterKey,
         label: Label,
+        additions: IndexedValuesAndKeywords,
+        deletions: IndexedValuesAndKeywords,
     ) -> None:
         """Upserts the given relations between `IndexedValue` and `Keyword` into Findex tables.
 
         Args:
-            indexed_values_and_keywords (Dict[Location | Keyword, List[Keyword | str]]):
-                map of `IndexedValue` to a list of `Keyword`
             master_key (MasterKey): the user master key
             label (Label): label used to allow versioning
+            additions (Dict[Location | Keyword, List[Keyword | str]]):
+                map of `IndexedValue` to a list of `Keyword` to add to the index
+            deletions (Dict[Location | Keyword, List[Keyword | str]]):
+                map of `IndexedValue` to a list of `Keyword` to delete from the index
         """
-        self.findex_core.upsert_wrapper(indexed_values_and_keywords, master_key, label)
+        self.findex_core.upsert_wrapper(master_key, label, additions, deletions)
 
     @abstractmethod
-    def fetch_entry_table(self, entry_uids: List[bytes]) -> Dict[bytes, bytes]:
+    def fetch_entry_table(
+        self, entry_uids: List[bytes]
+    ) -> Sequence[Tuple[bytes, bytes]]:
         """Query the Entry Table.
 
         Args:
             entry_uids (List[bytes], optional): uids to query. if None, return the entire table
 
         Returns:
-            Dict[bytes, bytes]: uid -> value mapping
+           Sequence[Tuple[bytes, bytes]]: uid -> value mapping
         """
 
     @abstractmethod
     def upsert_entry_table(
         self, entry_updates: Dict[bytes, Tuple[bytes, bytes]]
     ) -> Dict[bytes, bytes]:
         """Update key-value pairs in the Entry Table.
@@ -85,22 +90,24 @@
     def __init__(self) -> None:
         super().__init__()
         self.findex_core.set_search_callbacks(
             self.fetch_entry_table, self.fetch_chain_table
         )
 
     @abstractmethod
-    def fetch_entry_table(self, entry_uids: List[bytes]) -> Dict[bytes, bytes]:
+    def fetch_entry_table(
+        self, entry_uids: List[bytes]
+    ) -> Sequence[Tuple[bytes, bytes]]:
         """Query the Entry Table.
 
         Args:
             entry_uids (List[bytes], optional): uids to query. if None, return the entire table
 
         Returns:
-            Dict[bytes, bytes]: uid -> value mapping
+            Sequence[Tuple[bytes, bytes]]: uid -> value mapping
         """
 
     @abstractmethod
     def fetch_chain_table(self, chain_uids: List[bytes]) -> Dict[bytes, bytes]:
         """Query the Chain Table.
 
         Args:
@@ -108,44 +115,35 @@
 
         Returns:
             Dict[bytes, bytes]: uid -> value mapping
         """
 
     def search(
         self,
-        keywords: Sequence[Union[Keyword, str]],
         master_key: MasterKey,
         label: Label,
-        max_result_per_keyword: int = 2**32 - 1,
-        max_depth: int = 100,
-        fetch_chains_batch_size: int = 0,
+        keywords: Sequence[Union[Keyword, str]],
         progress_callback: Optional[Callable[[ProgressResults], bool]] = None,
     ) -> SearchResults:
         """Recursively search Findex graphs for `Locations` corresponding to the given `Keyword`.
 
         Args:
             keywords (List[Keyword | str]): keywords to search using Findex.
             master_key (MasterKey): user secret key.
             label (Label): public label used in keyword hashing.
-            max_result_per_keyword (int, optional): maximum number of results to fetch per keyword.
-            max_depth (int, optional): maximum recursion level allowed. Defaults to 100.
-            fetch_chains_batch_size (int, optional): batch size during fetch chain.
             progress_callback (Callable[[Dict[str, List[IndexedValue]]], bool], optional): callback
                 to process intermediate search results.
 
         Returns:
             Dict[Keyword, List[Location]]: `Locations` found by `Keyword`
         """
         return self.findex_core.search_wrapper(
-            keywords,
             master_key,
             label,
-            max_result_per_keyword,
-            max_depth,
-            fetch_chains_batch_size,
+            keywords,
             progress_callback,
         )
 
 
 class FindexCompact(FindexBase, metaclass=ABCMeta):
     """Implement this class to use Findex Compact API"""
 
@@ -156,22 +154,24 @@
             self.fetch_chain_table,
             self.update_lines,
             self.list_removed_locations,
             self.fetch_all_entry_table_uids,
         )
 
     @abstractmethod
-    def fetch_entry_table(self, entry_uids: List[bytes]) -> Dict[bytes, bytes]:
+    def fetch_entry_table(
+        self, entry_uids: List[bytes]
+    ) -> Sequence[Tuple[bytes, bytes]]:
         """Query the Entry Table.
 
         Args:
             entry_uids (List[bytes]): uids to query
 
         Returns:
-            Dict[bytes, bytes]: uid -> value mapping
+            Sequence[Tuple[bytes, bytes]]: uid -> value mapping
         """
 
     @abstractmethod
     def fetch_all_entry_table_uids(self) -> Set[bytes]:
         """Return all UIDs in the Entry Table.
 
         Returns:
@@ -269,24 +269,24 @@
         self.remove_entry_table()
         self.remove_chain_table(removed_chain_table_uids)
         self.insert_chain_table(new_encrypted_chain_table_items)
         self.insert_entry_table(new_encrypted_entry_table_items)
 
     def compact(
         self,
-        num_reindexing_before_full_set: int,
         master_key: MasterKey,
         new_master_key: MasterKey,
         new_label: Label,
+        num_reindexing_before_full_set: int,
     ) -> None:
         """Performs compacting on the entry and chain tables.
 
         Args:
             num_reindexing_before_full_set (int): number of compacting to do before
             being sure that a big portion of the indexes were checked
             master_key (MasterKey): current master key
             new_master_key (MasterKey): newly generated key
             new_label (Label): newly generated label
         """
         self.findex_core.compact_wrapper(
-            num_reindexing_before_full_set, master_key, new_master_key, new_label
+            master_key, new_master_key, new_label, num_reindexing_before_full_set
         )
```

## Comparing `cloudproof_py-3.1.0.dist-info/LICENSE.md` & `cloudproof_py-4.0.0.dist-info/LICENSE.md`

 * *Files identical despite different names*

## Comparing `cloudproof_py-3.1.0.dist-info/METADATA` & `cloudproof_py-4.0.0.dist-info/METADATA`

 * *Files 6% similar despite different names*

```diff
@@ -1,21 +1,22 @@
 Metadata-Version: 2.1
 Name: cloudproof-py
-Version: 3.1.0
+Version: 4.0.0
 Summary: Python library for Cosmian Cloudproof
 Author-email: Cosmian Tech <tech@cosmian.com>
 Project-URL: Homepage, https://github.com/Cosmian/cloudproof_python
 Project-URL: Bug Tracker, https://github.com/Cosmian/cloudproof_python/issues
 Classifier: Programming Language :: Python :: 3
 Classifier: Operating System :: OS Independent
 Requires-Python: >=3.7
 Description-Content-Type: text/markdown
 License-File: LICENSE.md
+Requires-Dist: cloudproof-anonymization (<1.0.0,>=0.1.0)
 Requires-Dist: cover-crypt (<12.0.0,>=11.0.0)
-Requires-Dist: findex (<4.0.0,>=3.0.0)
+Requires-Dist: findex (<5.0.0,>=4.0.0)
 Requires-Dist: cosmian-kms (<5.0.0,>=4.3.3)
 Requires-Dist: cloudproof-fpe (<1.0.0,>=0.1.0)
 
 # Cloudproof Python Library
 
 [![PyPI version](https://badge.fury.io/py/cloudproof_py.svg)](https://badge.fury.io/py/cloudproof_py)
 ![Build status](https://github.com/Cosmian/cloudproof_python/actions/workflows/ci.yml/badge.svg)
@@ -74,25 +75,31 @@
 ```
 
 ## Building and testing
 
 To build from source:
 
 ```sh
-scripts/build.sh [-i]
+scripts/build.sh
 ```
 
-**Note**: add `-i` to install after build.
-
 To build and run the tests:
 
 ```sh
+scripts/build.sh -t
+```
+
+With PyO3 packages from [package.cosmian.com](https://package.cosmian.com):
+
+```sh
 scripts/build.sh -it
 ```
 
+**Note**: edit [scripts/ci_install_pyo3_builds.sh](./scripts/ci_install_pyo3_builds.sh) with the right build name.
+
 To build the documentation:
 
 ```sh
 scripts/build.sh -d
 ```
 
 The generated documentation will be in `./docs/_build/html`.
@@ -101,10 +108,11 @@
 
 This library depends on [CoverCrypt](https://github.com/Cosmian/cover_crypt) and [Findex](https://github.com/Cosmian/findex).
 
 This table shows the minimum version correspondence between the various components.
 
 | `cloudproof_py` | CoverCrypt | Findex      | KMS   |
 | --------------- | ---------- | ----------- | ----- |
+| >=4.0.0         | 11.0.0     | 4.0.0,4.0.1 | 4.3.3 |
 | >=3.0.0         | 11.0.0     | 3.0.0       | 4.3.3 |
 | >=2.0.0         | 10.0.0     | 2.0.1,2.1.0 | 4.2.0 |
 | >=1.0.0         | 8.0.1      | 2.0.0       | -     |
```

