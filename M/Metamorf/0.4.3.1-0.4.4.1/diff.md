# Comparing `tmp/Metamorf-0.4.3.1.tar.gz` & `tmp/Metamorf-0.4.4.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "Metamorf-0.4.3.1.tar", last modified: Sat Jun  3 22:04:56 2023, max compression
+gzip compressed data, was "Metamorf-0.4.4.1.tar", last modified: Mon Jun  5 10:22:40 2023, max compression
```

## Comparing `Metamorf-0.4.3.1.tar` & `Metamorf-0.4.4.1.tar`

### file list

```diff
@@ -1,107 +1,107 @@
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.874250 Metamorf-0.4.3.1/
--rw-rw-rw-   0        0        0    11582 2023-03-07 20:45:53.000000 Metamorf-0.4.3.1/LICENSE.md
--rw-rw-rw-   0        0        0      487 2023-06-03 12:11:30.000000 Metamorf-0.4.3.1/MANIFEST.in
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.806251 Metamorf-0.4.3.1/Metamorf.egg-info/
--rw-rw-rw-   0        0        0     6903 2023-06-03 22:04:56.000000 Metamorf-0.4.3.1/Metamorf.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0     3388 2023-06-03 22:04:56.000000 Metamorf-0.4.3.1/Metamorf.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-06-03 22:04:56.000000 Metamorf-0.4.3.1/Metamorf.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       48 2023-06-03 22:04:56.000000 Metamorf-0.4.3.1/Metamorf.egg-info/entry_points.txt
--rw-rw-rw-   0        0        0       76 2023-06-03 22:04:56.000000 Metamorf-0.4.3.1/Metamorf.egg-info/requires.txt
--rw-rw-rw-   0        0        0        9 2023-06-03 22:04:56.000000 Metamorf-0.4.3.1/Metamorf.egg-info/top_level.txt
--rw-rw-rw-   0        0        0     6903 2023-06-03 22:04:56.874250 Metamorf-0.4.3.1/PKG-INFO
--rw-rw-rw-   0        0        0     6328 2023-03-07 20:54:13.000000 Metamorf-0.4.3.1/README.md
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.809249 Metamorf-0.4.3.1/metamorf/
--rw-rw-rw-   0        0        0       77 2023-01-31 18:29:02.000000 Metamorf-0.4.3.1/metamorf/__init__.py
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.811250 Metamorf-0.4.3.1/metamorf/configuration/
--rw-rw-rw-   0        0        0      228 2023-03-11 17:01:20.000000 Metamorf-0.4.3.1/metamorf/configuration/configuration.yml
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.813251 Metamorf-0.4.3.1/metamorf/configuration/mysql/
--rw-rw-rw-   0        0        0      134 2023-03-21 20:57:39.000000 Metamorf-0.4.3.1/metamorf/configuration/mysql/configuration_data_mysql.yml
--rw-rw-rw-   0        0        0      125 2023-03-30 10:47:46.000000 Metamorf-0.4.3.1/metamorf/configuration/mysql/configuration_metadata_mysql.yml
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.815249 Metamorf-0.4.3.1/metamorf/configuration/postgresql/
--rw-rw-rw-   0        0        0      182 2023-06-03 11:17:50.000000 Metamorf-0.4.3.1/metamorf/configuration/postgresql/configuration_data_postgresql.yml
--rw-rw-rw-   0        0        0      173 2023-06-03 11:17:50.000000 Metamorf-0.4.3.1/metamorf/configuration/postgresql/configuration_metadata_postgresql.yml
--rw-rw-rw-   0        0        0     4667 2023-06-03 22:04:29.000000 Metamorf-0.4.3.1/metamorf/configuration/properties.yml
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.816249 Metamorf-0.4.3.1/metamorf/configuration/snowflake/
--rw-rw-rw-   0        0        0      231 2023-03-07 17:17:45.000000 Metamorf-0.4.3.1/metamorf/configuration/snowflake/configuration_data_snowflake.yml
--rw-rw-rw-   0        0        0      239 2023-03-07 17:17:50.000000 Metamorf-0.4.3.1/metamorf/configuration/snowflake/configuration_metadata_snowflake.yml
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.818251 Metamorf-0.4.3.1/metamorf/configuration/sqlite/
--rw-rw-rw-   0        0        0       68 2023-02-05 12:43:57.000000 Metamorf-0.4.3.1/metamorf/configuration/sqlite/configuration_data_sqlite.yml
--rw-rw-rw-   0        0        0       76 2023-01-31 18:29:02.000000 Metamorf-0.4.3.1/metamorf/configuration/sqlite/configuration_metadata_sqlite.yml
--rw-rw-rw-   0        0        0    13022 2023-06-03 22:04:23.000000 Metamorf-0.4.3.1/metamorf/constants.py
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.835250 Metamorf-0.4.3.1/metamorf/engines/
--rw-rw-rw-   0        0        0        0 2023-01-31 18:29:02.000000 Metamorf-0.4.3.1/metamorf/engines/__init__.py
--rw-rw-rw-   0        0        0     6950 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine.py
--rw-rw-rw-   0        0        0     4947 2023-03-11 15:54:33.000000 Metamorf-0.4.3.1/metamorf/engines/engine_api.py
--rw-rw-rw-   0        0        0     8322 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_backup.py
--rw-rw-rw-   0        0        0    11239 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/engines/engine_commit.py
--rw-rw-rw-   0        0        0     4932 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/engines/engine_delete.py
--rw-rw-rw-   0        0        0     2432 2023-06-03 22:00:52.000000 Metamorf-0.4.3.1/metamorf/engines/engine_deploy.py
--rw-rw-rw-   0        0        0     3129 2023-06-03 22:01:08.000000 Metamorf-0.4.3.1/metamorf/engines/engine_deploy_example.py
--rw-rw-rw-   0        0        0    14348 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_download.py
--rw-rw-rw-   0        0        0     4347 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_files.py
--rw-rw-rw-   0        0        0     5207 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_init.py
--rw-rw-rw-   0        0        0      939 2023-03-06 18:50:26.000000 Metamorf-0.4.3.1/metamorf/engines/engine_manifest.py
--rw-rw-rw-   0        0        0     1676 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/engines/engine_metadata.py
--rw-rw-rw-   0        0        0     7841 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_output.py
--rw-rw-rw-   0        0        0   368223 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/engines/engine_process.py
--rw-rw-rw-   0        0        0    16024 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/engines/engine_recover.py
--rw-rw-rw-   0        0        0    15830 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_restore.py
--rw-rw-rw-   0        0        0     4778 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/engines/engine_run.py
--rw-rw-rw-   0        0        0    18884 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/engines/engine_upload.py
--rw-rw-rw-   0        0        0     1431 2023-03-06 18:50:50.000000 Metamorf-0.4.3.1/metamorf/engines/engine_validate.py
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.844249 Metamorf-0.4.3.1/metamorf/entry/
--rw-rw-rw-   0        0        0       58 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_AGGREGATORS.csv
--rw-rw-rw-   0        0        0      166 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_DATASET_MAPPINGS.csv
--rw-rw-rw-   0        0        0       91 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_DATASET_RELATIONSHIPS.csv
--rw-rw-rw-   0        0        0      184 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_DV_ENTITY.csv
--rw-rw-rw-   0        0        0      175 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_DV_MAPPINGS.csv
--rw-rw-rw-   0        0        0       35 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_DV_PROPERTIES.csv
--rw-rw-rw-   0        0        0       51 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_ENTITY.csv
--rw-rw-rw-   0        0        0       40 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_FILES.csv
--rw-rw-rw-   0        0        0       34 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_FILTERS.csv
--rw-rw-rw-   0        0        0       34 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_HAVING.csv
--rw-rw-rw-   0        0        0       69 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_ORDER.csv
--rw-rw-rw-   0        0        0       34 2023-06-03 22:00:36.000000 Metamorf-0.4.3.1/metamorf/entry/ENTRY_PATH.csv
--rw-rw-rw-   0        0        0     1124 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/help.py
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.784250 Metamorf-0.4.3.1/metamorf/initialization/
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.848250 Metamorf-0.4.3.1/metamorf/initialization/mysql/
--rw-rw-rw-   0        0        0     6164 2023-04-01 15:51:46.000000 Metamorf-0.4.3.1/metamorf/initialization/mysql/init_example_data_mysql.sql
--rw-rw-rw-   0        0        0    13888 2023-04-01 15:50:11.000000 Metamorf-0.4.3.1/metamorf/initialization/mysql/init_example_metadata_mysql.sql
--rw-rw-rw-   0        0        0    20854 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/initialization/mysql/init_mysql.sql
--rw-rw-rw-   0        0        0       39 2023-03-21 19:01:38.000000 Metamorf-0.4.3.1/metamorf/initialization/mysql/pre_init_mysql.sql
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.852250 Metamorf-0.4.3.1/metamorf/initialization/postgresql/
--rw-rw-rw-   0        0        0     5699 2023-04-01 15:51:44.000000 Metamorf-0.4.3.1/metamorf/initialization/postgresql/init_example_data_postgresql.sql
--rw-rw-rw-   0        0        0    12868 2023-06-03 11:17:50.000000 Metamorf-0.4.3.1/metamorf/initialization/postgresql/init_example_metadata_postgresql.sql
--rw-rw-rw-   0        0        0    19601 2023-06-03 11:17:50.000000 Metamorf-0.4.3.1/metamorf/initialization/postgresql/init_postgresql.sql
--rw-rw-rw-   0        0        0        0 2023-03-30 11:30:16.000000 Metamorf-0.4.3.1/metamorf/initialization/postgresql/pre_init_postgresql.sql
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.855250 Metamorf-0.4.3.1/metamorf/initialization/snowflake/
--rw-rw-rw-   0        0        0     6625 2023-04-01 15:51:44.000000 Metamorf-0.4.3.1/metamorf/initialization/snowflake/init_example_data_snowflake.sql
--rw-rw-rw-   0        0        0    13679 2023-04-01 15:50:03.000000 Metamorf-0.4.3.1/metamorf/initialization/snowflake/init_example_metadata_snowflake.sql
--rw-rw-rw-   0        0        0    18039 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/initialization/snowflake/init_snowflake.sql
--rw-rw-rw-   0        0        0      139 2023-02-18 17:45:07.000000 Metamorf-0.4.3.1/metamorf/initialization/snowflake/pre_init_snowflake.sql
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.858252 Metamorf-0.4.3.1/metamorf/initialization/sqlite/
--rw-rw-rw-   0        0        0     6086 2023-04-01 15:51:18.000000 Metamorf-0.4.3.1/metamorf/initialization/sqlite/init_example_data_sqlite.sql
--rw-rw-rw-   0        0        0    13577 2023-04-01 15:50:00.000000 Metamorf-0.4.3.1/metamorf/initialization/sqlite/init_example_metadata_sqlite.sql
--rw-rw-rw-   0        0        0    24483 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/initialization/sqlite/init_sqlite.sql
--rw-rw-rw-   0        0        0        0 2023-03-21 19:01:29.000000 Metamorf-0.4.3.1/metamorf/initialization/sqlite/pre_init_sqlite.sql
--rw-rw-rw-   0        0        0     4110 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/main.py
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.870253 Metamorf-0.4.3.1/metamorf/tools/
--rw-rw-rw-   0        0        0        0 2023-01-31 18:29:02.000000 Metamorf-0.4.3.1/metamorf/tools/__init__.py
--rw-rw-rw-   0        0        0     4269 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/tools/argparser.py
--rw-rw-rw-   0        0        0    14845 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/tools/configvalidator.py
--rw-rw-rw-   0        0        0    17228 2023-06-03 12:39:24.000000 Metamorf-0.4.3.1/metamorf/tools/connection.py
--rw-rw-rw-   0        0        0    32970 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/tools/database_objects.py
--rw-rw-rw-   0        0        0     6654 2023-06-03 22:00:42.000000 Metamorf-0.4.3.1/metamorf/tools/filecontroller.py
--rw-rw-rw-   0        0        0     2347 2023-06-03 21:44:06.000000 Metamorf-0.4.3.1/metamorf/tools/log.py
--rw-rw-rw-   0        0        0     4310 2023-04-03 14:54:59.000000 Metamorf-0.4.3.1/metamorf/tools/manifest.py
--rw-rw-rw-   0        0        0    43207 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/tools/metadata.py
--rw-rw-rw-   0        0        0    10605 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/tools/metadata_validator.py
--rw-rw-rw-   0        0        0      831 2023-02-26 12:59:21.000000 Metamorf-0.4.3.1/metamorf/tools/node.py
--rw-rw-rw-   0        0        0    19573 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/tools/query.py
--rw-rw-rw-   0        0        0    35424 2023-06-03 10:14:29.000000 Metamorf-0.4.3.1/metamorf/tools/utils.py
--rw-rw-rw-   0        0        0     1000 2023-06-03 22:04:23.000000 Metamorf-0.4.3.1/pyproject.toml
--rw-rw-rw-   0        0        0       42 2023-06-03 22:04:56.874250 Metamorf-0.4.3.1/setup.cfg
-drwxrwxrwx   0        0        0        0 2023-06-03 22:04:56.873249 Metamorf-0.4.3.1/tests/
--rw-rw-rw-   0        0        0     2754 2023-01-31 23:34:10.000000 Metamorf-0.4.3.1/tests/tests.py
--rw-rw-rw-   0        0        0     2316 2023-01-31 19:38:51.000000 Metamorf-0.4.3.1/tests/tests_query.py
--rw-rw-rw-   0        0        0      643 2023-01-31 18:29:02.000000 Metamorf-0.4.3.1/tests/tests_validator.py
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.332069 Metamorf-0.4.4.1/
+-rw-rw-rw-   0        0        0    11582 2023-03-07 20:45:53.000000 Metamorf-0.4.4.1/LICENSE.md
+-rw-rw-rw-   0        0        0      487 2023-06-03 12:11:30.000000 Metamorf-0.4.4.1/MANIFEST.in
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.211066 Metamorf-0.4.4.1/Metamorf.egg-info/
+-rw-rw-rw-   0        0        0     7260 2023-06-05 10:22:40.000000 Metamorf-0.4.4.1/Metamorf.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0     3388 2023-06-05 10:22:40.000000 Metamorf-0.4.4.1/Metamorf.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-06-05 10:22:40.000000 Metamorf-0.4.4.1/Metamorf.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       48 2023-06-05 10:22:40.000000 Metamorf-0.4.4.1/Metamorf.egg-info/entry_points.txt
+-rw-rw-rw-   0        0        0       76 2023-06-05 10:22:40.000000 Metamorf-0.4.4.1/Metamorf.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        9 2023-06-05 10:22:40.000000 Metamorf-0.4.4.1/Metamorf.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0     7260 2023-06-05 10:22:40.330069 Metamorf-0.4.4.1/PKG-INFO
+-rw-rw-rw-   0        0        0     6685 2023-06-05 10:13:19.000000 Metamorf-0.4.4.1/README.md
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.214066 Metamorf-0.4.4.1/metamorf/
+-rw-rw-rw-   0        0        0       77 2023-01-31 18:29:02.000000 Metamorf-0.4.4.1/metamorf/__init__.py
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.216066 Metamorf-0.4.4.1/metamorf/configuration/
+-rw-rw-rw-   0        0        0      228 2023-03-11 17:01:20.000000 Metamorf-0.4.4.1/metamorf/configuration/configuration.yml
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.217065 Metamorf-0.4.4.1/metamorf/configuration/mysql/
+-rw-rw-rw-   0        0        0      134 2023-03-21 20:57:39.000000 Metamorf-0.4.4.1/metamorf/configuration/mysql/configuration_data_mysql.yml
+-rw-rw-rw-   0        0        0      125 2023-03-30 10:47:46.000000 Metamorf-0.4.4.1/metamorf/configuration/mysql/configuration_metadata_mysql.yml
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.219066 Metamorf-0.4.4.1/metamorf/configuration/postgresql/
+-rw-rw-rw-   0        0        0      182 2023-06-03 11:17:50.000000 Metamorf-0.4.4.1/metamorf/configuration/postgresql/configuration_data_postgresql.yml
+-rw-rw-rw-   0        0        0      173 2023-06-03 11:17:50.000000 Metamorf-0.4.4.1/metamorf/configuration/postgresql/configuration_metadata_postgresql.yml
+-rw-rw-rw-   0        0        0     4667 2023-06-05 10:13:19.000000 Metamorf-0.4.4.1/metamorf/configuration/properties.yml
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.220067 Metamorf-0.4.4.1/metamorf/configuration/snowflake/
+-rw-rw-rw-   0        0        0      231 2023-03-07 17:17:45.000000 Metamorf-0.4.4.1/metamorf/configuration/snowflake/configuration_data_snowflake.yml
+-rw-rw-rw-   0        0        0      239 2023-03-07 17:17:50.000000 Metamorf-0.4.4.1/metamorf/configuration/snowflake/configuration_metadata_snowflake.yml
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.223068 Metamorf-0.4.4.1/metamorf/configuration/sqlite/
+-rw-rw-rw-   0        0        0       68 2023-02-05 12:43:57.000000 Metamorf-0.4.4.1/metamorf/configuration/sqlite/configuration_data_sqlite.yml
+-rw-rw-rw-   0        0        0       76 2023-01-31 18:29:02.000000 Metamorf-0.4.4.1/metamorf/configuration/sqlite/configuration_metadata_sqlite.yml
+-rw-rw-rw-   0        0        0    13022 2023-06-05 10:13:19.000000 Metamorf-0.4.4.1/metamorf/constants.py
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.240066 Metamorf-0.4.4.1/metamorf/engines/
+-rw-rw-rw-   0        0        0        0 2023-01-31 18:29:02.000000 Metamorf-0.4.4.1/metamorf/engines/__init__.py
+-rw-rw-rw-   0        0        0     6950 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine.py
+-rw-rw-rw-   0        0        0     4947 2023-03-11 15:54:33.000000 Metamorf-0.4.4.1/metamorf/engines/engine_api.py
+-rw-rw-rw-   0        0        0     8322 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_backup.py
+-rw-rw-rw-   0        0        0    11239 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/engines/engine_commit.py
+-rw-rw-rw-   0        0        0     4932 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/engines/engine_delete.py
+-rw-rw-rw-   0        0        0     2432 2023-06-03 22:08:07.000000 Metamorf-0.4.4.1/metamorf/engines/engine_deploy.py
+-rw-rw-rw-   0        0        0     3129 2023-06-03 22:08:07.000000 Metamorf-0.4.4.1/metamorf/engines/engine_deploy_example.py
+-rw-rw-rw-   0        0        0    14348 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_download.py
+-rw-rw-rw-   0        0        0     4347 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_files.py
+-rw-rw-rw-   0        0        0     5207 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_init.py
+-rw-rw-rw-   0        0        0      939 2023-03-06 18:50:26.000000 Metamorf-0.4.4.1/metamorf/engines/engine_manifest.py
+-rw-rw-rw-   0        0        0     1676 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/engines/engine_metadata.py
+-rw-rw-rw-   0        0        0     7841 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_output.py
+-rw-rw-rw-   0        0        0   370431 2023-06-05 10:13:19.000000 Metamorf-0.4.4.1/metamorf/engines/engine_process.py
+-rw-rw-rw-   0        0        0    16024 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/engines/engine_recover.py
+-rw-rw-rw-   0        0        0    15830 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_restore.py
+-rw-rw-rw-   0        0        0     4778 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/engines/engine_run.py
+-rw-rw-rw-   0        0        0    18884 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/engines/engine_upload.py
+-rw-rw-rw-   0        0        0     1431 2023-03-06 18:50:50.000000 Metamorf-0.4.4.1/metamorf/engines/engine_validate.py
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.249066 Metamorf-0.4.4.1/metamorf/entry/
+-rw-rw-rw-   0        0        0       58 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_AGGREGATORS.csv
+-rw-rw-rw-   0        0        0      166 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_DATASET_MAPPINGS.csv
+-rw-rw-rw-   0        0        0       91 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_DATASET_RELATIONSHIPS.csv
+-rw-rw-rw-   0        0        0      184 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_DV_ENTITY.csv
+-rw-rw-rw-   0        0        0      175 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_DV_MAPPINGS.csv
+-rw-rw-rw-   0        0        0       35 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_DV_PROPERTIES.csv
+-rw-rw-rw-   0        0        0       51 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_ENTITY.csv
+-rw-rw-rw-   0        0        0       40 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_FILES.csv
+-rw-rw-rw-   0        0        0       34 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_FILTERS.csv
+-rw-rw-rw-   0        0        0       34 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_HAVING.csv
+-rw-rw-rw-   0        0        0       69 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_ORDER.csv
+-rw-rw-rw-   0        0        0       34 2023-06-03 22:00:36.000000 Metamorf-0.4.4.1/metamorf/entry/ENTRY_PATH.csv
+-rw-rw-rw-   0        0        0     1124 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/help.py
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.187067 Metamorf-0.4.4.1/metamorf/initialization/
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.269065 Metamorf-0.4.4.1/metamorf/initialization/mysql/
+-rw-rw-rw-   0        0        0     6164 2023-04-01 15:51:46.000000 Metamorf-0.4.4.1/metamorf/initialization/mysql/init_example_data_mysql.sql
+-rw-rw-rw-   0        0        0    13888 2023-04-01 15:50:11.000000 Metamorf-0.4.4.1/metamorf/initialization/mysql/init_example_metadata_mysql.sql
+-rw-rw-rw-   0        0        0    20854 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/initialization/mysql/init_mysql.sql
+-rw-rw-rw-   0        0        0       39 2023-03-21 19:01:38.000000 Metamorf-0.4.4.1/metamorf/initialization/mysql/pre_init_mysql.sql
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.284065 Metamorf-0.4.4.1/metamorf/initialization/postgresql/
+-rw-rw-rw-   0        0        0     5699 2023-04-01 15:51:44.000000 Metamorf-0.4.4.1/metamorf/initialization/postgresql/init_example_data_postgresql.sql
+-rw-rw-rw-   0        0        0    12868 2023-06-03 11:17:50.000000 Metamorf-0.4.4.1/metamorf/initialization/postgresql/init_example_metadata_postgresql.sql
+-rw-rw-rw-   0        0        0    19601 2023-06-03 11:17:50.000000 Metamorf-0.4.4.1/metamorf/initialization/postgresql/init_postgresql.sql
+-rw-rw-rw-   0        0        0        0 2023-03-30 11:30:16.000000 Metamorf-0.4.4.1/metamorf/initialization/postgresql/pre_init_postgresql.sql
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.297066 Metamorf-0.4.4.1/metamorf/initialization/snowflake/
+-rw-rw-rw-   0        0        0     6625 2023-04-01 15:51:44.000000 Metamorf-0.4.4.1/metamorf/initialization/snowflake/init_example_data_snowflake.sql
+-rw-rw-rw-   0        0        0    13679 2023-04-01 15:50:03.000000 Metamorf-0.4.4.1/metamorf/initialization/snowflake/init_example_metadata_snowflake.sql
+-rw-rw-rw-   0        0        0    18039 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/initialization/snowflake/init_snowflake.sql
+-rw-rw-rw-   0        0        0      139 2023-02-18 17:45:07.000000 Metamorf-0.4.4.1/metamorf/initialization/snowflake/pre_init_snowflake.sql
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.313066 Metamorf-0.4.4.1/metamorf/initialization/sqlite/
+-rw-rw-rw-   0        0        0     6086 2023-04-01 15:51:18.000000 Metamorf-0.4.4.1/metamorf/initialization/sqlite/init_example_data_sqlite.sql
+-rw-rw-rw-   0        0        0    13577 2023-04-01 15:50:00.000000 Metamorf-0.4.4.1/metamorf/initialization/sqlite/init_example_metadata_sqlite.sql
+-rw-rw-rw-   0        0        0    24483 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/initialization/sqlite/init_sqlite.sql
+-rw-rw-rw-   0        0        0        0 2023-03-21 19:01:29.000000 Metamorf-0.4.4.1/metamorf/initialization/sqlite/pre_init_sqlite.sql
+-rw-rw-rw-   0        0        0     4110 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/main.py
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.326069 Metamorf-0.4.4.1/metamorf/tools/
+-rw-rw-rw-   0        0        0        0 2023-01-31 18:29:02.000000 Metamorf-0.4.4.1/metamorf/tools/__init__.py
+-rw-rw-rw-   0        0        0     4269 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/tools/argparser.py
+-rw-rw-rw-   0        0        0    14845 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/tools/configvalidator.py
+-rw-rw-rw-   0        0        0    17228 2023-06-03 12:39:24.000000 Metamorf-0.4.4.1/metamorf/tools/connection.py
+-rw-rw-rw-   0        0        0    32970 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/tools/database_objects.py
+-rw-rw-rw-   0        0        0     6654 2023-06-03 22:08:07.000000 Metamorf-0.4.4.1/metamorf/tools/filecontroller.py
+-rw-rw-rw-   0        0        0     2347 2023-06-03 21:44:06.000000 Metamorf-0.4.4.1/metamorf/tools/log.py
+-rw-rw-rw-   0        0        0     4310 2023-04-03 14:54:59.000000 Metamorf-0.4.4.1/metamorf/tools/manifest.py
+-rw-rw-rw-   0        0        0    43207 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/tools/metadata.py
+-rw-rw-rw-   0        0        0    10605 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/tools/metadata_validator.py
+-rw-rw-rw-   0        0        0      831 2023-02-26 12:59:21.000000 Metamorf-0.4.4.1/metamorf/tools/node.py
+-rw-rw-rw-   0        0        0    19573 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/tools/query.py
+-rw-rw-rw-   0        0        0    35424 2023-06-03 10:14:29.000000 Metamorf-0.4.4.1/metamorf/tools/utils.py
+-rw-rw-rw-   0        0        0     1000 2023-06-05 10:13:19.000000 Metamorf-0.4.4.1/pyproject.toml
+-rw-rw-rw-   0        0        0       42 2023-06-05 10:22:40.332069 Metamorf-0.4.4.1/setup.cfg
+drwxrwxrwx   0        0        0        0 2023-06-05 10:22:40.329067 Metamorf-0.4.4.1/tests/
+-rw-rw-rw-   0        0        0     2754 2023-01-31 23:34:10.000000 Metamorf-0.4.4.1/tests/tests.py
+-rw-rw-rw-   0        0        0     2316 2023-01-31 19:38:51.000000 Metamorf-0.4.4.1/tests/tests_query.py
+-rw-rw-rw-   0        0        0      643 2023-01-31 18:29:02.000000 Metamorf-0.4.4.1/tests/tests_validator.py
```

### Comparing `Metamorf-0.4.3.1/LICENSE.md` & `Metamorf-0.4.4.1/LICENSE.md`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/Metamorf.egg-info/PKG-INFO` & `Metamorf-0.4.4.1/Metamorf.egg-info/PKG-INFO`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: Metamorf
-Version: 0.4.3.1
+Version: 0.4.4.1
 Summary: Metadata Suite to build and manage your Datawarehouse
 Author-email: Guillermo Aumatell <gaumatellsalom@gmail.com>
 Project-URL: Homepage, https://github.com/gasalom/metamorf
 Project-URL: Bug Tracker, https://github.com/gasalom/metamorf/issues
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Operating System :: Microsoft :: Windows
@@ -40,29 +40,31 @@
 
 
 ### Databases
 
 Actually Metamorf supports the following databases:
 - Snowflake
 - SQLite
+- PostgreSQL
+- MySQL
 
 ## How to Start
 To install Metamorf, you need Python 3.10, and you can install it using pip. 
     
     pip install metamorf
 
 Once installed, you can see all the available commands typing:
 
     metamorf help
 
 For a quick start, create a directory where you want to locate all the configuration files.
 
     metamorf init
 
-You have initialized your environment to configure Metamorf. The basic configuration is through
+At this point, you have initialized your environment to configure Metamorf. The default configuration is through
 a SQLite database.
   
 Metamorf can be deployed where the configuration file says. If SQLite is selected (as default)
 and it doesn't exist, Metamorf will create the databases. Try it!
 
     metamorf deploy
 
@@ -77,40 +79,40 @@
 If you want to process these metadata, try the command:
 
     metamorf process
 
 Now all the metadata is processed and the main tables of Metamorf are populated.
 To see if all works, you can just type any of the features that Metamorf offers:
 
-If you want to run the processes indicated on the metadata, you can just type:
+If you want to run the processes indicated on the metadata to transform all the fake data, you can just type:
 
     metadata run
 
 Probably you just want the SQL Files to execute from other platforms, type then:
 
     metadata output
 
 The results are located on the output folder on your repository.  
 
 The configuration file permits you to configure Metamorf to adapt it to your needs.
-For example, one interesting option could be to generate all you datasets on *dbt* format.
+For example, one interesting option could be to generate all your datasets on *dbt* format.
 To achieve it, just change your *configuration.yml* file, **output** option, **type** value to **dbt**.
 
       output:
         type: dbt
 
 You can execute again 
     
     metadata output
 
 And now you have all the necessary files for your dbt project.  
 
 This tutorial is just a small demonstration about metamorf and its potential.
 
-*Note: First versions of Metamorf were only tested on Windows OS.*
+*Note: Metamorf works on Windows OS and Linux (tested on Ubuntu)*
 
 ## Commands
 
 Metamorf works with commands as:
 
     metamorf [command] [arguments]
 
@@ -139,29 +141,36 @@
 - **upload**: It uploads the metadata entry from the entry folder to the metadata database.
 - **commit**: It commits the metadata entry from the actual owner. It can be useful to save gold versions and develop new datasets without any risk.
 - **recover**: It recovers the last commit from the actual owner.
 - **output**: It generates all the dataset files on the *output* folder.
 - **delete**: It deletes all the metadata from the metadata entry.
 - **backup**: It downloads a backup from all the system.
 - **restore**: It uploads all the backup to the system.
+- **files**: Upload all the files indicated on the metadata.
+- **metadata**: Validates the Metadata Entry.
 
 <sup>1</sup> Actually Metamorf accepts the databases indicated on this [section](#databases)
 
+## New features
+
+- **Datavault** module to speed up the creation of a Datavault Model. New metadata entry was added.
+- File loader to upload csv files to the data database.
+- Added compatibility to PostgreSQL and MySQL for metadata and data databases.
+
+
 ## Roadmap
 
-- *[Under development]* Include Datavault 2.0 Module to simplify the metadata entry for this modelling.
-- *[Under development]* Include a metadata entry validator to avoid unexpected errors.
-- *[Near development]* Include File loader.
-- *[Near development]* Create a detailed documentation.
+- *[Under development]* Use case on Azure cloud.
+- *[Under development]* Improve the metadata entry validator to avoid unexpected errors.
+- *[Under development]* Create a detailed documentation.
 - *[Near development]* Include more materialization and more metadata transformation speeders.
 - *[Near development]* Include easier metadata entry system.
-- *[Near development]* Include some more databases as PostgreSQL and MySQL.
-- *[Future development]* Include more databases.
+- *[Near development]* Add an engine system to permits developpers add their own engines to speed up their own needs.
 - *[Future development]* Security Framework based on metadata for the datawarehouse
 
 ## Contact
 
 Creator: **Guillermo Aumatell Salom**  
-Email: **gaumatellsalom@gmail.com**
+Email: **guillermoaumatell@gmail.com**
 
 
-**Notice: Metamorf is in beta phase.**
+**Notice: Metamorf is in beta phase under development.**
```

### Comparing `Metamorf-0.4.3.1/Metamorf.egg-info/SOURCES.txt` & `Metamorf-0.4.4.1/Metamorf.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/PKG-INFO` & `Metamorf-0.4.4.1/PKG-INFO`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: Metamorf
-Version: 0.4.3.1
+Version: 0.4.4.1
 Summary: Metadata Suite to build and manage your Datawarehouse
 Author-email: Guillermo Aumatell <gaumatellsalom@gmail.com>
 Project-URL: Homepage, https://github.com/gasalom/metamorf
 Project-URL: Bug Tracker, https://github.com/gasalom/metamorf/issues
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Operating System :: Microsoft :: Windows
@@ -40,29 +40,31 @@
 
 
 ### Databases
 
 Actually Metamorf supports the following databases:
 - Snowflake
 - SQLite
+- PostgreSQL
+- MySQL
 
 ## How to Start
 To install Metamorf, you need Python 3.10, and you can install it using pip. 
     
     pip install metamorf
 
 Once installed, you can see all the available commands typing:
 
     metamorf help
 
 For a quick start, create a directory where you want to locate all the configuration files.
 
     metamorf init
 
-You have initialized your environment to configure Metamorf. The basic configuration is through
+At this point, you have initialized your environment to configure Metamorf. The default configuration is through
 a SQLite database.
   
 Metamorf can be deployed where the configuration file says. If SQLite is selected (as default)
 and it doesn't exist, Metamorf will create the databases. Try it!
 
     metamorf deploy
 
@@ -77,40 +79,40 @@
 If you want to process these metadata, try the command:
 
     metamorf process
 
 Now all the metadata is processed and the main tables of Metamorf are populated.
 To see if all works, you can just type any of the features that Metamorf offers:
 
-If you want to run the processes indicated on the metadata, you can just type:
+If you want to run the processes indicated on the metadata to transform all the fake data, you can just type:
 
     metadata run
 
 Probably you just want the SQL Files to execute from other platforms, type then:
 
     metadata output
 
 The results are located on the output folder on your repository.  
 
 The configuration file permits you to configure Metamorf to adapt it to your needs.
-For example, one interesting option could be to generate all you datasets on *dbt* format.
+For example, one interesting option could be to generate all your datasets on *dbt* format.
 To achieve it, just change your *configuration.yml* file, **output** option, **type** value to **dbt**.
 
       output:
         type: dbt
 
 You can execute again 
     
     metadata output
 
 And now you have all the necessary files for your dbt project.  
 
 This tutorial is just a small demonstration about metamorf and its potential.
 
-*Note: First versions of Metamorf were only tested on Windows OS.*
+*Note: Metamorf works on Windows OS and Linux (tested on Ubuntu)*
 
 ## Commands
 
 Metamorf works with commands as:
 
     metamorf [command] [arguments]
 
@@ -139,29 +141,36 @@
 - **upload**: It uploads the metadata entry from the entry folder to the metadata database.
 - **commit**: It commits the metadata entry from the actual owner. It can be useful to save gold versions and develop new datasets without any risk.
 - **recover**: It recovers the last commit from the actual owner.
 - **output**: It generates all the dataset files on the *output* folder.
 - **delete**: It deletes all the metadata from the metadata entry.
 - **backup**: It downloads a backup from all the system.
 - **restore**: It uploads all the backup to the system.
+- **files**: Upload all the files indicated on the metadata.
+- **metadata**: Validates the Metadata Entry.
 
 <sup>1</sup> Actually Metamorf accepts the databases indicated on this [section](#databases)
 
+## New features
+
+- **Datavault** module to speed up the creation of a Datavault Model. New metadata entry was added.
+- File loader to upload csv files to the data database.
+- Added compatibility to PostgreSQL and MySQL for metadata and data databases.
+
+
 ## Roadmap
 
-- *[Under development]* Include Datavault 2.0 Module to simplify the metadata entry for this modelling.
-- *[Under development]* Include a metadata entry validator to avoid unexpected errors.
-- *[Near development]* Include File loader.
-- *[Near development]* Create a detailed documentation.
+- *[Under development]* Use case on Azure cloud.
+- *[Under development]* Improve the metadata entry validator to avoid unexpected errors.
+- *[Under development]* Create a detailed documentation.
 - *[Near development]* Include more materialization and more metadata transformation speeders.
 - *[Near development]* Include easier metadata entry system.
-- *[Near development]* Include some more databases as PostgreSQL and MySQL.
-- *[Future development]* Include more databases.
+- *[Near development]* Add an engine system to permits developpers add their own engines to speed up their own needs.
 - *[Future development]* Security Framework based on metadata for the datawarehouse
 
 ## Contact
 
 Creator: **Guillermo Aumatell Salom**  
-Email: **gaumatellsalom@gmail.com**
+Email: **guillermoaumatell@gmail.com**
 
 
-**Notice: Metamorf is in beta phase.**
+**Notice: Metamorf is in beta phase under development.**
```

### Comparing `Metamorf-0.4.3.1/README.md` & `Metamorf-0.4.4.1/README.md`

 * *Files 5% similar despite different names*

```diff
@@ -26,29 +26,31 @@
 
 
 ### Databases
 
 Actually Metamorf supports the following databases:
 - Snowflake
 - SQLite
+- PostgreSQL
+- MySQL
 
 ## How to Start
 To install Metamorf, you need Python 3.10, and you can install it using pip. 
     
     pip install metamorf
 
 Once installed, you can see all the available commands typing:
 
     metamorf help
 
 For a quick start, create a directory where you want to locate all the configuration files.
 
     metamorf init
 
-You have initialized your environment to configure Metamorf. The basic configuration is through
+At this point, you have initialized your environment to configure Metamorf. The default configuration is through
 a SQLite database.
   
 Metamorf can be deployed where the configuration file says. If SQLite is selected (as default)
 and it doesn't exist, Metamorf will create the databases. Try it!
 
     metamorf deploy
 
@@ -63,40 +65,40 @@
 If you want to process these metadata, try the command:
 
     metamorf process
 
 Now all the metadata is processed and the main tables of Metamorf are populated.
 To see if all works, you can just type any of the features that Metamorf offers:
 
-If you want to run the processes indicated on the metadata, you can just type:
+If you want to run the processes indicated on the metadata to transform all the fake data, you can just type:
 
     metadata run
 
 Probably you just want the SQL Files to execute from other platforms, type then:
 
     metadata output
 
 The results are located on the output folder on your repository.  
 
 The configuration file permits you to configure Metamorf to adapt it to your needs.
-For example, one interesting option could be to generate all you datasets on *dbt* format.
+For example, one interesting option could be to generate all your datasets on *dbt* format.
 To achieve it, just change your *configuration.yml* file, **output** option, **type** value to **dbt**.
 
       output:
         type: dbt
 
 You can execute again 
     
     metadata output
 
 And now you have all the necessary files for your dbt project.  
 
 This tutorial is just a small demonstration about metamorf and its potential.
 
-*Note: First versions of Metamorf were only tested on Windows OS.*
+*Note: Metamorf works on Windows OS and Linux (tested on Ubuntu)*
 
 ## Commands
 
 Metamorf works with commands as:
 
     metamorf [command] [arguments]
 
@@ -125,29 +127,36 @@
 - **upload**: It uploads the metadata entry from the entry folder to the metadata database.
 - **commit**: It commits the metadata entry from the actual owner. It can be useful to save gold versions and develop new datasets without any risk.
 - **recover**: It recovers the last commit from the actual owner.
 - **output**: It generates all the dataset files on the *output* folder.
 - **delete**: It deletes all the metadata from the metadata entry.
 - **backup**: It downloads a backup from all the system.
 - **restore**: It uploads all the backup to the system.
+- **files**: Upload all the files indicated on the metadata.
+- **metadata**: Validates the Metadata Entry.
 
 <sup>1</sup> Actually Metamorf accepts the databases indicated on this [section](#databases)
 
+## New features
+
+- **Datavault** module to speed up the creation of a Datavault Model. New metadata entry was added.
+- File loader to upload csv files to the data database.
+- Added compatibility to PostgreSQL and MySQL for metadata and data databases.
+
+
 ## Roadmap
 
-- *[Under development]* Include Datavault 2.0 Module to simplify the metadata entry for this modelling.
-- *[Under development]* Include a metadata entry validator to avoid unexpected errors.
-- *[Near development]* Include File loader.
-- *[Near development]* Create a detailed documentation.
+- *[Under development]* Use case on Azure cloud.
+- *[Under development]* Improve the metadata entry validator to avoid unexpected errors.
+- *[Under development]* Create a detailed documentation.
 - *[Near development]* Include more materialization and more metadata transformation speeders.
 - *[Near development]* Include easier metadata entry system.
-- *[Near development]* Include some more databases as PostgreSQL and MySQL.
-- *[Future development]* Include more databases.
+- *[Near development]* Add an engine system to permits developpers add their own engines to speed up their own needs.
 - *[Future development]* Security Framework based on metadata for the datawarehouse
 
 ## Contact
 
 Creator: **Guillermo Aumatell Salom**  
-Email: **gaumatellsalom@gmail.com**
+Email: **guillermoaumatell@gmail.com**
 
 
-**Notice: Metamorf is in beta phase.**
+**Notice: Metamorf is in beta phase under development.**
```

### Comparing `Metamorf-0.4.3.1/metamorf/configuration/properties.yml` & `Metamorf-0.4.4.1/metamorf/configuration/properties.yml`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 name: "Metamorf"
 description: "Metadata Suite to build and manage your Datawarehouse metadata-driven"
-version: "0.4.3.1"
+version: "0.4.4.1"
 author: "Guillermo Aumatell Salom"
 contact: "guillermoaumatell@gmail.com"
 
 commands:
   - name: 'help'
     description: 'Shows all the commands available.'
   - name: 'manifest'
```

### Comparing `Metamorf-0.4.3.1/metamorf/constants.py` & `Metamorf-0.4.4.1/metamorf/constants.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 import os
 
 # METAMORF PROPERTIES
-VERSION = "0.4.3.1"
+VERSION = "0.4.4.1"
 
 # Constants for QUERY TYPES
 QUERY_TYPE_INSERT = 0
 QUERY_TYPE_UPDATE = 1
 QUERY_TYPE_VIEW = 2
 QUERY_TYPE_DELETE = 3
 QUERY_TYPE_SELECT = 4
```

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine.py` & `Metamorf-0.4.4.1/metamorf/engines/engine.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_api.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_api.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_backup.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_backup.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_commit.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_commit.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_delete.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_delete.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_deploy.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_deploy.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_deploy_example.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_deploy_example.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_download.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_download.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_files.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_files.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_init.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_init.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_manifest.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_manifest.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_metadata.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_metadata.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_output.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_output.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_process.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_process.py`

 * *Files 0% similar despite different names*

```diff
@@ -2623,20392 +2623,20530 @@
 0000a3e0: 0a20 2020 2020 2020 206d 6435 5f66 756e  .        md5_fun
 0000a3f0: 6374 696f 6e20 3d20 7365 6c66 2e67 6574  ction = self.get
 0000a400: 5f68 6173 685f 6b65 795f 6672 6f6d 5f63  _hash_key_from_c
 0000a410: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
 0000a420: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
 0000a430: 7361 745f 636f 645f 656e 7469 7479 5f74  sat_cod_entity_t
 0000a440: 6172 6765 742c 2073 6174 5b33 5d29 0d0a  arget, sat[3])..
-0000a450: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-0000a460: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0000a470: 5b73 6174 5f63 6f64 5f65 6e74 6974 795f  [sat_cod_entity_
-0000a480: 736f 7572 6365 2c20 6d64 355f 6675 6e63  source, md5_func
-0000a490: 7469 6f6e 2c20 7072 6566 6978 5f65 7420  tion, prefix_et 
-0000a4a0: 2b20 7361 745f 656e 7469 7479 5f74 6d70  + sat_entity_tmp
-0000a4b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4d0: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
+0000a450: 2020 2020 2020 2020 6861 7368 5f6d 6435          hash_md5
+0000a460: 5f66 756e 6374 696f 6e20 3d20 6d64 355f  _function = md5_
+0000a470: 6675 6e63 7469 6f6e 0d0a 2020 2020 2020  function..      
+0000a480: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0000a490: 7070 696e 6720 3d20 5b73 6174 5f63 6f64  pping = [sat_cod
+0000a4a0: 5f65 6e74 6974 795f 736f 7572 6365 2c20  _entity_source, 
+0000a4b0: 6d64 355f 6675 6e63 7469 6f6e 2c20 7072  md5_function, pr
+0000a4c0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+0000a4d0: 7469 7479 5f74 6d70 2c0d 0a20 2020 2020  tity_tmp,..     
 0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0000a500: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-0000a510: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-0000a520: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-0000a530: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
-0000a540: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-0000a550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a570: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-0000a580: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
-0000a590: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
-0000a5a0: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
-0000a5b0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0000a5c0: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-0000a5d0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0000a5e0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0000a5f0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0000a600: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0000a610: 290d 0a0d 0a20 2020 2020 2020 2073 7973  )....        sys
-0000a620: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-0000a630: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
-0000a640: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
-0000a650: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-0000a660: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0000a670: 7365 745f 6d61 7070 696e 6720 3d20 5b27  set_mapping = ['
-0000a680: 272c 2073 656c 662e 636f 6e6e 6563 7469  ', self.connecti
-0000a690: 6f6e 2e67 6574 5f73 7973 6461 7465 5f76  on.get_sysdate_v
-0000a6a0: 616c 7565 2829 2c20 7072 6566 6978 5f65  alue(), prefix_e
-0000a6b0: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
-0000a6c0: 6d70 2c0d 0a20 2020 2020 2020 2020 2020  mp,..           
-0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6e0: 2020 2020 2744 4154 455f 4352 4541 5445      'DATE_CREATE
-0000a6f0: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
-0000a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a710: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0000a720: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-0000a730: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
-0000a740: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0000a750: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
-0000a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a770: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-0000a780: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-0000a790: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-0000a7a0: 204b 4559 5f54 5950 455f 4e55 4c4c 2c20   KEY_TYPE_NULL, 
-0000a7b0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0000a7c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0000a7d0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0000a7e0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0000a7f0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0000a800: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0000a810: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0000a820: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-0000a830: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
-0000a840: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
-0000a850: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0000a860: 7069 6e67 203d 205b 7361 745f 636f 645f  ping = [sat_cod_
-0000a870: 656e 7469 7479 5f73 6f75 7263 652c 2072  entity_source, r
-0000a880: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-0000a890: 756d 6e5f 6e61 6d65 5f73 6f75 7263 652c  umn_name_source,
-0000a8a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8c0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-0000a8d0: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-0000a8e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a900: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-0000a910: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
-0000a920: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0000a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a940: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0000a950: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0000a960: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-0000a970: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
-0000a980: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-0000a990: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-0000a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9c0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-0000a9d0: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-0000a9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa00: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
-0000aa10: 6368 2c20 4b45 595f 5459 5045 5f52 4543  ch, KEY_TYPE_REC
-0000aa20: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
-0000aa30: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0000aa40: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0000aa50: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-0000aa60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000aa70: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0000aa80: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0000aa90: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0000aaa0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0000aab0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0000aac0: 6861 735f 6164 3a0d 0a20 2020 2020 2020  has_ad:..       
-0000aad0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0000aae0: 5f6d 6170 7069 6e67 203d 205b 7361 745f  _mapping = [sat_
-0000aaf0: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
-0000ab00: 652c 2061 7070 6c69 6564 5f64 6174 652e  e, applied_date.
-0000ab10: 636f 6c75 6d6e 5f6e 616d 655f 736f 7572  column_name_sour
-0000ab20: 6365 2c0d 0a20 2020 2020 2020 2020 2020  ce,..           
-0000ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab40: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0000ab50: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
-0000ab60: 6d70 2c0d 0a20 2020 2020 2020 2020 2020  mp,..           
-0000ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab80: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
-0000ab90: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0000aba0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-0000abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abc0: 2020 2020 2020 2020 2020 2020 2061 7070               app
-0000abd0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-0000abe0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-0000abf0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-0000ac00: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-0000ac10: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-0000ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac40: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-0000ac50: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac80: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
-0000ac90: 682c 204b 4559 5f54 5950 455f 4150 504c  h, KEY_TYPE_APPL
-0000aca0: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
-0000acb0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0000acc0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0000acd0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-0000ace0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0000acf0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0000ad00: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0000ad10: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0000ad20: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0000ad30: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
-0000ad40: 735f 746e 3a0d 0a20 2020 2020 2020 2020  s_tn:..         
-0000ad50: 2020 2066 6f72 2074 6e20 696e 2074 656e     for tn in ten
-0000ad60: 616e 745f 736f 7572 6365 3a0d 0a20 2020  ant_source:..   
-0000ad70: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000ad80: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000ad90: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
-0000ada0: 7479 5f73 6f75 7263 652c 2074 6e2e 636f  ty_source, tn.co
-0000adb0: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
-0000adc0: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
-0000add0: 745f 656e 7469 7479 5f74 6d70 2c0d 0a20  t_entity_tmp,.. 
-0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae00: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-0000ae10: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-0000ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae40: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f74       tn.column_t
-0000ae50: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-0000ae60: 6e61 6c5f 706f 7369 7469 6f6e 2c20 746e  nal_position, tn
-0000ae70: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0000ae80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-0000aeb0: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+0000a4f0: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+0000a500: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0000a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a520: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+0000a530: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+0000a540: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+0000a550: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+0000a560: 5d2c 2068 6173 685f 666f 725f 6d65 7461  ], hash_for_meta
+0000a570: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
+0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a590: 2020 2020 2020 2020 2073 6174 5f6e 756d           sat_num
+0000a5a0: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+0000a5b0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+0000a5c0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0000a5d0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0000a5e0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+0000a5f0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0000a600: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0000a610: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+0000a620: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+0000a630: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
+0000a640: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+0000a650: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
+0000a660: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
+0000a670: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0000a680: 6461 7461 2829 0d0a 2020 2020 2020 2020  data()..        
+0000a690: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0000a6a0: 696e 6720 3d20 5b27 272c 2073 656c 662e  ing = ['', self.
+0000a6b0: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+0000a6c0: 7973 6461 7465 5f76 616c 7565 2829 2c20  ysdate_value(), 
+0000a6d0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+0000a6e0: 656e 7469 7479 5f74 6d70 2c0d 0a20 2020  entity_tmp,..   
+0000a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a700: 2020 2020 2020 2020 2020 2020 2744 4154              'DAT
+0000a710: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
+0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a730: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+0000a740: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+0000a750: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
+0000a760: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
+0000a770: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
+0000a780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7a0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0000a7b0: 6461 7461 5b32 5d2c 2073 6174 5f6e 756d  data[2], sat_num
+0000a7c0: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+0000a7d0: 455f 4e55 4c4c 2c20 312c 2073 656c 662e  E_NULL, 1, self.
+0000a7e0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0000a7f0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0000a800: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0000a810: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+0000a820: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+0000a830: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+0000a840: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000a850: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+0000a860: 2069 6620 6861 735f 7273 3a0d 0a20 2020   if has_rs:..   
+0000a870: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+0000a880: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+0000a890: 7361 745f 636f 645f 656e 7469 7479 5f73  sat_cod_entity_s
+0000a8a0: 6f75 7263 652c 2072 6563 6f72 645f 736f  ource, record_so
+0000a8b0: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+0000a8c0: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
+0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8e0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000a8f0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+0000a900: 6974 795f 746d 702c 0d0a 2020 2020 2020  ity_tmp,..      
+0000a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a920: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+0000a930: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+0000a940: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+0000a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a970: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0000a980: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0000a990: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0000a9a0: 6974 696f 6e2c 2072 6563 6f72 645f 736f  ition, record_so
+0000a9b0: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+0000a9c0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0000a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9e0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+0000a9f0: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
+0000aa00: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0000aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa20: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
+0000aa30: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+0000aa40: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
+0000aa50: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
+0000aa60: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+0000aa70: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000aa80: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+0000aa90: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0000aaa0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0000aab0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+0000aac0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+0000aad0: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
+0000aae0: 2020 2020 2069 6620 6861 735f 6164 3a0d       if has_ad:.
+0000aaf0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0000ab00: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000ab10: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
+0000ab20: 7479 5f73 6f75 7263 652c 2061 7070 6c69  ty_source, appli
+0000ab30: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+0000ab40: 616d 655f 736f 7572 6365 2c0d 0a20 2020  ame_source,..   
+0000ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab70: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+0000ab80: 656e 7469 7479 5f74 6d70 2c0d 0a20 2020  entity_tmp,..   
+0000ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abb0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+0000abc0: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+0000abd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abf0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0000ac00: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
+0000ac10: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+0000ac20: 7369 7469 6f6e 2c20 6170 706c 6965 645f  sition, applied_
+0000ac30: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
+0000ac40: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0000ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac60: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0000ac70: 6461 7465 2e63 6f6c 756d 6e5f 7072 6563  date.column_prec
+0000ac80: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aca0: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+0000acb0: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
+0000acc0: 5950 455f 4150 504c 4945 445f 4441 5445  YPE_APPLIED_DATE
+0000acd0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+0000ace0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+0000acf0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0000ad00: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+0000ad10: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0000ad20: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0000ad30: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0000ad40: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0000ad50: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+0000ad60: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+0000ad70: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+0000ad80: 6e20 696e 2074 656e 616e 745f 736f 7572  n in tenant_sour
+0000ad90: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+0000ada0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0000adb0: 5f6d 6170 7069 6e67 203d 205b 7361 745f  _mapping = [sat_
+0000adc0: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
+0000add0: 652c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  e, tn.column_nam
+0000ade0: 655f 736f 7572 6365 2c20 7072 6566 6978  e_source, prefix
+0000adf0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0000ae00: 5f74 6d70 2c0d 0a20 2020 2020 2020 2020  _tmp,..         
+0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae20: 2020 2020 2020 2020 2020 2020 2020 746e                tn
+0000ae30: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0000ae40: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae60: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+0000ae70: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+0000ae80: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+0000ae90: 7469 6f6e 2c20 746e 2e63 6f6c 756d 6e5f  tion, tn.column_
+0000aea0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aee0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-0000aef0: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
-0000af00: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-0000af10: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0000af20: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0000af30: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0000af40: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0000af50: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0000af60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af70: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0000af80: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
-0000af90: 2020 6966 2068 6173 5f64 636b 3a0d 0a20    if has_dck:.. 
-0000afa0: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-0000afb0: 636b 2069 6e20 6465 7065 6e64 656e 745f  ck in dependent_
-0000afc0: 6368 696c 645f 6b65 793a 0d0a 2020 2020  child_key:..    
-0000afd0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000afe0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0000aff0: 3d20 5b73 6174 5f63 6f64 5f65 6e74 6974  = [sat_cod_entit
-0000b000: 795f 736f 7572 6365 2c20 6463 6b2e 636f  y_source, dck.co
-0000b010: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
-0000b020: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
-0000b030: 745f 656e 7469 7479 5f74 6d70 2c0d 0a20  t_entity_tmp,.. 
-0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b060: 2020 2020 2020 6463 6b2e 636f 6c75 6d6e        dck.column
-0000b070: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-0000b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0a0: 2020 2020 2020 6463 6b2e 636f 6c75 6d6e        dck.column
-0000b0b0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-0000b0c0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-0000b0d0: 6463 6b2e 636f 6c75 6d6e 5f6c 656e 6774  dck.column_lengt
-0000b0e0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b100: 2020 2020 2020 2020 2020 2064 636b 2e63             dck.c
-0000b110: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-0000b120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b140: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
-0000b150: 5459 5045 5f44 4550 454e 4445 4e54 5f43  TYPE_DEPENDENT_C
-0000b160: 4849 4c44 5f4b 4559 2c20 312c 2073 656c  HILD_KEY, 1, sel
-0000b170: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0000b180: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0000b190: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0000b1a0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-0000b1b0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-0000b1c0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-0000b1d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b1e0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0000b1f0: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-0000b200: 2020 2061 6c6c 5f61 7474 7269 6275 7465     all_attribute
-0000b210: 7320 3d20 7365 6c66 2e6d 6574 6164 6174  s = self.metadat
-0000b220: 615f 6163 7475 616c 2e67 6574 5f61 7474  a_actual.get_att
-0000b230: 7269 6275 7465 735f 6f6e 5f64 765f 6672  ributes_on_dv_fr
-0000b240: 6f6d 5f73 6174 656c 6c69 7465 5f6e 616d  om_satellite_nam
-0000b250: 6528 7361 745f 656e 7469 7479 290d 0a0d  e(sat_entity)...
-0000b260: 0a20 2020 2020 2020 2066 6f72 2061 7420  .        for at 
-0000b270: 696e 2061 6c6c 5f61 7474 7269 6275 7465  in all_attribute
-0000b280: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000b290: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0000b2a0: 696e 6720 3d20 5b61 742e 636f 645f 656e  ing = [at.cod_en
-0000b2b0: 7469 7479 5f73 6f75 7263 652c 2061 742e  tity_source, at.
-0000b2c0: 636f 6c75 6d6e 5f6e 616d 655f 736f 7572  column_name_sour
-0000b2d0: 6365 2c0d 0a20 2020 2020 2020 2020 2020  ce,..           
-0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2f0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0000b300: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
-0000b310: 6d70 2c0d 0a20 2020 2020 2020 2020 2020  mp,..           
-0000b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b330: 2020 2020 2020 2020 6174 2e63 6f6c 756d          at.colum
-0000b340: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0000b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b370: 2020 2061 742e 636f 6c75 6d6e 5f74 7970     at.column_typ
-0000b380: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-0000b390: 6c5f 706f 7369 7469 6f6e 2c20 6174 2e63  l_position, at.c
-0000b3a0: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+0000aed0: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
+0000aee0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af00: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
+0000af10: 4b45 595f 5459 5045 5f54 454e 414e 542c  KEY_TYPE_TENANT,
+0000af20: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+0000af30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000af40: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0000af50: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0000af60: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0000af70: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0000af80: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+0000af90: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+0000afa0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0000afb0: 0d0a 2020 2020 2020 2020 616c 6c5f 6463  ..        all_dc
+0000afc0: 6b5f 636f 6e63 6174 656e 6174 6520 3d20  k_concatenate = 
+0000afd0: 2727 0d0a 2020 2020 2020 2020 6966 2068  ''..        if h
+0000afe0: 6173 5f64 636b 3a0d 0a20 2020 2020 2020  as_dck:..       
+0000aff0: 2020 2020 2066 6f72 2064 636b 2069 6e20       for dck in 
+0000b000: 6465 7065 6e64 656e 745f 6368 696c 645f  dependent_child_
+0000b010: 6b65 793a 0d0a 2020 2020 2020 2020 2020  key:..          
+0000b020: 2020 2020 2020 616c 6c5f 6463 6b5f 636f        all_dck_co
+0000b030: 6e63 6174 656e 6174 6520 2b3d 2022 2c20  ncatenate += ", 
+0000b040: 2220 2b20 6463 6b2e 636f 6c75 6d6e 5f6e  " + dck.column_n
+0000b050: 616d 655f 7461 7267 6574 0d0a 2020 2020  ame_target..    
+0000b060: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000b070: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0000b080: 3d20 5b73 6174 5f63 6f64 5f65 6e74 6974  = [sat_cod_entit
+0000b090: 795f 736f 7572 6365 2c20 6463 6b2e 636f  y_source, dck.co
+0000b0a0: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
+0000b0b0: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
+0000b0c0: 745f 656e 7469 7479 5f74 6d70 2c0d 0a20  t_entity_tmp,.. 
+0000b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0f0: 2020 2020 2020 6463 6b2e 636f 6c75 6d6e        dck.column
+0000b100: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0000b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b130: 2020 2020 2020 6463 6b2e 636f 6c75 6d6e        dck.column
+0000b140: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+0000b150: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0000b160: 6463 6b2e 636f 6c75 6d6e 5f6c 656e 6774  dck.column_lengt
+0000b170: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b190: 2020 2020 2020 2020 2020 2064 636b 2e63             dck.c
+0000b1a0: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
+0000b1b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1d0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
+0000b1e0: 5459 5045 5f44 4550 454e 4445 4e54 5f43  TYPE_DEPENDENT_C
+0000b1f0: 4849 4c44 5f4b 4559 2c20 312c 2073 656c  HILD_KEY, 1, sel
+0000b200: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0000b210: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0000b220: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0000b230: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0000b240: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0000b250: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0000b260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b270: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0000b280: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+0000b290: 2020 2061 6c6c 5f61 7474 7269 6275 7465     all_attribute
+0000b2a0: 7320 3d20 7365 6c66 2e6d 6574 6164 6174  s = self.metadat
+0000b2b0: 615f 6163 7475 616c 2e67 6574 5f61 7474  a_actual.get_att
+0000b2c0: 7269 6275 7465 735f 6f6e 5f64 765f 6672  ributes_on_dv_fr
+0000b2d0: 6f6d 5f73 6174 656c 6c69 7465 5f6e 616d  om_satellite_nam
+0000b2e0: 6528 7361 745f 656e 7469 7479 290d 0a0d  e(sat_entity)...
+0000b2f0: 0a20 2020 2020 2020 2066 6f72 2061 7420  .        for at 
+0000b300: 696e 2061 6c6c 5f61 7474 7269 6275 7465  in all_attribute
+0000b310: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0000b320: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0000b330: 696e 6720 3d20 5b61 742e 636f 645f 656e  ing = [at.cod_en
+0000b340: 7469 7479 5f73 6f75 7263 652c 2061 742e  tity_source, at.
+0000b350: 636f 6c75 6d6e 5f6e 616d 655f 736f 7572  column_name_sour
+0000b360: 6365 2c0d 0a20 2020 2020 2020 2020 2020  ce,..           
+0000b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b380: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0000b390: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
+0000b3a0: 6d70 2c0d 0a20 2020 2020 2020 2020 2020  mp,..           
 0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3d0: 2020 6174 2e63 6f6c 756d 6e5f 7072 6563    at.column_prec
-0000b3e0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0000b3c0: 2020 2020 2020 2020 6174 2e63 6f6c 756d          at.colum
+0000b3d0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b400: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
-0000b410: 756d 5f62 7261 6e63 682c 2061 742e 6b65  um_branch, at.ke
-0000b420: 795f 7479 7065 2c20 312c 2073 656c 662e  y_type, 1, self.
-0000b430: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0000b440: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0000b450: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0000b460: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0000b470: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0000b480: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-0000b490: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0000b4a0: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-0000b4b0: 0a20 2020 2020 2020 206d 6435 5f66 756e  .        md5_fun
-0000b4c0: 6374 696f 6e20 3d20 7365 6c66 2e63 6f6e  ction = self.con
-0000b4d0: 6e65 6374 696f 6e2e 6765 745f 6d64 355f  nection.get_md5_
-0000b4e0: 6675 6e63 7469 6f6e 2829 0d0a 2020 2020  function()..    
-0000b4f0: 2020 2020 6361 7374 5f74 6f5f 7374 7269      cast_to_stri
-0000b500: 6e67 203d 2073 656c 662e 636f 6e6e 6563  ng = self.connec
-0000b510: 7469 6f6e 2e67 6574 5f63 6173 745f 7374  tion.get_cast_st
-0000b520: 7269 6e67 5f66 6f72 5f6d 6574 6164 6174  ring_for_metadat
-0000b530: 6128 290d 0a0d 0a20 2020 2020 2020 2062  a()....        b
-0000b540: 6b5f 636f 6e63 6174 656e 6174 6520 3d20  k_concatenate = 
-0000b550: 2727 0d0a 2020 2020 2020 2020 6174 5f63  ''..        at_c
-0000b560: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-0000b570: 203d 2027 270d 0a20 2020 2020 2020 2066   = ''..        f
-0000b580: 6f72 2061 7420 696e 2061 6c6c 5f61 7474  or at in all_att
-0000b590: 7269 6275 7465 733a 0d0a 2020 2020 2020  ributes:..      
-0000b5a0: 2020 2020 2020 626b 5f66 696e 616c 203d        bk_final =
-0000b5b0: 2063 6173 745f 746f 5f73 7472 696e 672e   cast_to_string.
-0000b5c0: 7265 706c 6163 6528 275b 785d 272c 2061  replace('[x]', a
-0000b5d0: 742e 636f 6c75 6d6e 5f6e 616d 655f 736f  t.column_name_so
-0000b5e0: 7572 6365 290d 0a20 2020 2020 2020 2020  urce)..         
-0000b5f0: 2020 2062 6b5f 636f 6e63 6174 656e 6174     bk_concatenat
-0000b600: 6520 2b3d 2062 6b5f 6669 6e61 6c20 2b20  e += bk_final + 
-0000b610: 227c 7c27 2220 2b20 7365 6c66 2e6d 6f64  "||'" + self.mod
-0000b620: 756c 655f 6476 5f63 6861 725f 7365 7061  ule_dv_char_sepa
-0000b630: 7261 746f 725f 6e61 6d69 6e67 202b 2022  rator_naming + "
-0000b640: 277c 7c22 0d0a 2020 2020 2020 2020 626b  '||"..        bk
-0000b650: 5f63 6f6e 6361 7465 6e61 7465 203d 2062  _concatenate = b
-0000b660: 6b5f 636f 6e63 6174 656e 6174 655b 3a2d  k_concatenate[:-
-0000b670: 362d 6c65 6e28 7365 6c66 2e6d 6f64 756c  6-len(self.modul
-0000b680: 655f 6476 5f63 6861 725f 7365 7061 7261  e_dv_char_separa
-0000b690: 746f 725f 6e61 6d69 6e67 295d 0d0a 2020  tor_naming)]..  
-0000b6a0: 2020 2020 2020 6861 7364 6966 6620 3d20        hasdiff = 
-0000b6b0: 6d64 355f 6675 6e63 7469 6f6e 2e72 6570  md5_function.rep
-0000b6c0: 6c61 6365 2827 5b78 5d27 2c20 626b 5f63  lace('[x]', bk_c
-0000b6d0: 6f6e 6361 7465 6e61 7465 290d 0a20 2020  oncatenate)..   
-0000b6e0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0000b6f0: 5f6d 6170 7069 6e67 203d 205b 616c 6c5f  _mapping = [all_
-0000b700: 6174 7472 6962 7574 6573 5b30 5d2e 636f  attributes[0].co
-0000b710: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
-0000b720: 2068 6173 6469 6666 2c0d 0a20 2020 2020   hasdiff,..     
-0000b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b740: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-0000b750: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-0000b760: 5f74 6d70 2c20 2748 4153 4844 4946 4627  _tmp, 'HASHDIFF'
-0000b770: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b790: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-0000b7a0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0000b7b0: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-0000b7c0: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-0000b7d0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-0000b7e0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b800: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
-0000b810: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
-0000b820: 4153 4844 4946 462c 2031 2c20 7365 6c66  ASHDIFF, 1, self
-0000b830: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-0000b840: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0000b850: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0000b860: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0000b870: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0000b880: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-0000b890: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-0000b8a0: 2323 2323 2323 2323 2323 2323 2323 2043  ############## C
-0000b8b0: 7265 6174 6520 456e 7469 7479 2053 5447  reate Entity STG
-0000b8c0: 204c 4153 5420 494d 4147 4520 3120 2323   LAST IMAGE 1 ##
-0000b8d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000b8e0: 2323 2323 2323 2323 230d 0a20 2020 2020  #########..     
-0000b8f0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0000b900: 696f 6e20 3d20 310d 0a20 2020 2020 2020  ion = 1..       
-0000b910: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0000b920: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0000b930: 7420 2b20 7361 745f 656e 7469 7479 2c20  t + sat_entity, 
-0000b940: 6861 7368 5f6e 616d 652c 2070 7265 6669  hash_name, prefi
-0000b950: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-0000b960: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
-0000b970: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b990: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
-0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9b0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0000b9c0: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-0000b9d0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-0000b9e0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-0000b9f0: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
-0000ba00: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-0000ba10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba30: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-0000ba40: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
-0000ba50: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
-0000ba60: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
-0000ba70: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0000ba80: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-0000ba90: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0000baa0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0000bab0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0000bac0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0000bad0: 290d 0a0d 0a20 2020 2020 2020 206e 6577  )....        new
-0000bae0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000baf0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0000bb00: 7361 745f 656e 7469 7479 2c20 2748 4153  sat_entity, 'HAS
-0000bb10: 4844 4946 4627 2c0d 0a20 2020 2020 2020  HDIFF',..       
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb30: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0000bb40: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
-0000bb50: 6374 7561 6c5f 696d 6167 655f 312c 2027  ctual_image_1, '
-0000bb60: 4841 5348 4449 4646 272c 0d0a 2020 2020  HASHDIFF',..    
-0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb80: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0000bb90: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-0000bba0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0000bbb0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-0000bbc0: 6461 7461 5b31 5d2c 2068 6173 685f 666f  data[1], hash_fo
-0000bbd0: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
-0000bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bc00: 6174 5f6e 756d 5f62 7261 6e63 682c 204b  at_num_branch, K
-0000bc10: 4559 5f54 5950 455f 4841 5348 4449 4646  EY_TYPE_HASHDIFF
-0000bc20: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-0000bc30: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
-0000bc40: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0000bc50: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-0000bc60: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0000bc70: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0000bc80: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0000bc90: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0000bca0: 0a0d 0a20 2020 2020 2020 2061 6c6c 5f64  ...        all_d
-0000bcb0: 636b 5f63 6f6e 6361 7465 6e61 7465 203d  ck_concatenate =
-0000bcc0: 2027 270d 0a20 2020 2020 2020 2069 6620   ''..        if 
-0000bcd0: 6861 735f 6463 6b3a 0d0a 2020 2020 2020  has_dck:..      
-0000bce0: 2020 2020 2020 666f 7220 6463 6b20 696e        for dck in
-0000bcf0: 2064 6570 656e 6465 6e74 5f63 6869 6c64   dependent_child
-0000bd00: 5f6b 6579 3a0d 0a20 2020 2020 2020 2020  _key:..         
-0000bd10: 2020 2020 2020 2061 6c6c 5f64 636b 5f63         all_dck_c
-0000bd20: 6f6e 6361 7465 6e61 7465 202b 3d20 222c  oncatenate += ",
-0000bd30: 222b 6463 6b2e 636f 6c75 6d6e 5f6e 616d  "+dck.column_nam
-0000bd40: 655f 7461 7267 6574 0d0a 2020 2020 2020  e_target..      
-0000bd50: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-0000bd60: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0000bd70: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-0000bd80: 5f65 6e74 6974 792c 2064 636b 2e63 6f6c  _entity, dck.col
-0000bd90: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-0000bda0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0000bdb0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0000bdc0: 6d61 6765 5f31 2c0d 0a20 2020 2020 2020  mage_1,..       
+0000b400: 2020 2061 742e 636f 6c75 6d6e 5f74 7970     at.column_typ
+0000b410: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+0000b420: 6c5f 706f 7369 7469 6f6e 2c20 6174 2e63  l_position, at.c
+0000b430: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+0000b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b460: 2020 6174 2e63 6f6c 756d 6e5f 7072 6563    at.column_prec
+0000b470: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b490: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+0000b4a0: 756d 5f62 7261 6e63 682c 2061 742e 6b65  um_branch, at.ke
+0000b4b0: 795f 7479 7065 2c20 312c 2073 656c 662e  y_type, 1, self.
+0000b4c0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0000b4d0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0000b4e0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0000b4f0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+0000b500: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+0000b510: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
+0000b520: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0000b530: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+0000b540: 0a20 2020 2020 2020 206d 6435 5f66 756e  .        md5_fun
+0000b550: 6374 696f 6e20 3d20 7365 6c66 2e63 6f6e  ction = self.con
+0000b560: 6e65 6374 696f 6e2e 6765 745f 6d64 355f  nection.get_md5_
+0000b570: 6675 6e63 7469 6f6e 2829 0d0a 2020 2020  function()..    
+0000b580: 2020 2020 6361 7374 5f74 6f5f 7374 7269      cast_to_stri
+0000b590: 6e67 203d 2073 656c 662e 636f 6e6e 6563  ng = self.connec
+0000b5a0: 7469 6f6e 2e67 6574 5f63 6173 745f 7374  tion.get_cast_st
+0000b5b0: 7269 6e67 5f66 6f72 5f6d 6574 6164 6174  ring_for_metadat
+0000b5c0: 6128 290d 0a0d 0a20 2020 2020 2020 2062  a()....        b
+0000b5d0: 6b5f 636f 6e63 6174 656e 6174 6520 3d20  k_concatenate = 
+0000b5e0: 2727 0d0a 2020 2020 2020 2020 6174 5f63  ''..        at_c
+0000b5f0: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
+0000b600: 203d 2027 270d 0a20 2020 2020 2020 2066   = ''..        f
+0000b610: 6f72 2061 7420 696e 2061 6c6c 5f61 7474  or at in all_att
+0000b620: 7269 6275 7465 733a 0d0a 2020 2020 2020  ributes:..      
+0000b630: 2020 2020 2020 626b 5f66 696e 616c 203d        bk_final =
+0000b640: 2063 6173 745f 746f 5f73 7472 696e 672e   cast_to_string.
+0000b650: 7265 706c 6163 6528 275b 785d 272c 2061  replace('[x]', a
+0000b660: 742e 636f 6c75 6d6e 5f6e 616d 655f 736f  t.column_name_so
+0000b670: 7572 6365 290d 0a20 2020 2020 2020 2020  urce)..         
+0000b680: 2020 2062 6b5f 636f 6e63 6174 656e 6174     bk_concatenat
+0000b690: 6520 2b3d 2062 6b5f 6669 6e61 6c20 2b20  e += bk_final + 
+0000b6a0: 227c 7c27 2220 2b20 7365 6c66 2e6d 6f64  "||'" + self.mod
+0000b6b0: 756c 655f 6476 5f63 6861 725f 7365 7061  ule_dv_char_sepa
+0000b6c0: 7261 746f 725f 6e61 6d69 6e67 202b 2022  rator_naming + "
+0000b6d0: 277c 7c22 0d0a 2020 2020 2020 2020 626b  '||"..        bk
+0000b6e0: 5f63 6f6e 6361 7465 6e61 7465 203d 2062  _concatenate = b
+0000b6f0: 6b5f 636f 6e63 6174 656e 6174 655b 3a2d  k_concatenate[:-
+0000b700: 362d 6c65 6e28 7365 6c66 2e6d 6f64 756c  6-len(self.modul
+0000b710: 655f 6476 5f63 6861 725f 7365 7061 7261  e_dv_char_separa
+0000b720: 746f 725f 6e61 6d69 6e67 295d 0d0a 2020  tor_naming)]..  
+0000b730: 2020 2020 2020 6861 7364 6966 6620 3d20        hasdiff = 
+0000b740: 6d64 355f 6675 6e63 7469 6f6e 2e72 6570  md5_function.rep
+0000b750: 6c61 6365 2827 5b78 5d27 2c20 626b 5f63  lace('[x]', bk_c
+0000b760: 6f6e 6361 7465 6e61 7465 290d 0a20 2020  oncatenate)..   
+0000b770: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0000b780: 5f6d 6170 7069 6e67 203d 205b 616c 6c5f  _mapping = [all_
+0000b790: 6174 7472 6962 7574 6573 5b30 5d2e 636f  attributes[0].co
+0000b7a0: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
+0000b7b0: 2068 6173 6469 6666 2c0d 0a20 2020 2020   hasdiff,..     
+0000b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7d0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0000b7e0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0000b7f0: 5f74 6d70 2c20 2748 4153 4844 4946 4627  _tmp, 'HASHDIFF'
+0000b800: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b820: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+0000b830: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+0000b840: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+0000b850: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
+0000b860: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0000b870: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b890: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+0000b8a0: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
+0000b8b0: 4153 4844 4946 462c 2031 2c20 7365 6c66  ASHDIFF, 1, self
+0000b8c0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0000b8d0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0000b8e0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0000b8f0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0000b900: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0000b910: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+0000b920: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0000b930: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+0000b940: 2020 6f72 6465 725f 6279 203d 2027 270d    order_by = ''.
+0000b950: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
+0000b960: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
+0000b970: 206f 7264 6572 5f62 7920 3d20 2720 6f72   order_by = ' or
+0000b980: 6465 7220 6279 2027 202b 2061 7070 6c69  der by ' + appli
+0000b990: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+0000b9a0: 616d 655f 736f 7572 6365 202b 2027 2064  ame_source + ' d
+0000b9b0: 6573 6327 0d0a 2020 2020 2020 2020 6966  esc'..        if
+0000b9c0: 2068 6173 5f64 636b 3a0d 0a20 2020 2020   has_dck:..     
+0000b9d0: 2020 2020 2020 2068 6173 685f 6d64 355f         hash_md5_
+0000b9e0: 6675 6e63 7469 6f6e 202b 3d20 616c 6c5f  function += all_
+0000b9f0: 6463 6b5f 636f 6e63 6174 656e 6174 650d  dck_concatenate.
+0000ba00: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+0000ba10: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+0000ba20: 7361 745f 636f 645f 656e 7469 7479 5f73  sat_cod_entity_s
+0000ba30: 6f75 7263 652c 0d0a 2020 2020 2020 2020  ource,..        
+0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba50: 2020 2020 2020 2027 524f 575f 4e55 4d42         'ROW_NUMB
+0000ba60: 4552 2829 206f 7665 7220 2870 6172 7469  ER() over (parti
+0000ba70: 7469 6f6e 2062 7920 2720 2b20 6861 7368  tion by ' + hash
+0000ba80: 5f6d 6435 5f66 756e 6374 696f 6e20 2b20  _md5_function + 
+0000ba90: 6f72 6465 725f 6279 202b 2027 2927 2c0d  order_by + ')',.
+0000baa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bac0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+0000bad0: 656e 7469 7479 5f74 6d70 2c20 2752 4e27  entity_tmp, 'RN'
+0000bae0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb00: 2020 696e 7465 6765 725f 666f 725f 6d65    integer_for_me
+0000bb10: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+0000bb20: 616c 5f70 6f73 6974 696f 6e2c 2069 6e74  al_position, int
+0000bb30: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
+0000bb40: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
+0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb60: 2020 2020 2020 696e 7465 6765 725f 666f        integer_fo
+0000bb70: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
+0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000bba0: 6174 5f6e 756d 5f62 7261 6e63 682c 204b  at_num_branch, K
+0000bbb0: 4559 5f54 5950 455f 4e55 4c4c 2c20 312c  EY_TYPE_NULL, 1,
+0000bbc0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0000bbd0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0000bbe0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0000bbf0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0000bc00: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+0000bc10: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+0000bc20: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+0000bc30: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+0000bc40: 2020 2020 2020 2023 2323 2323 2323 2323         #########
+0000bc50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000bc60: 2323 2043 7265 6174 6520 456e 7469 7479  ## Create Entity
+0000bc70: 2053 5447 204c 4153 5420 494d 4147 4520   STG LAST IMAGE 
+0000bc80: 3120 2323 2323 2323 2323 2323 2323 2323  1 ##############
+0000bc90: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
+0000bca0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0000bcb0: 6f73 6974 696f 6e20 3d20 310d 0a20 2020  osition = 1..   
+0000bcc0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0000bcd0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+0000bce0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+0000bcf0: 7479 2c20 6861 7368 5f6e 616d 652c 2070  ty, hash_name, p
+0000bd00: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+0000bd10: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
+0000bd20: 6765 5f31 2c0d 0a20 2020 2020 2020 2020  ge_1,..         
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd40: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+0000bd50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd70: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0000bd80: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0000bd90: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+0000bda0: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+0000bdb0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+0000bdc0: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
 0000bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdf0: 6463 6b2e 636f 6c75 6d6e 5f6e 616d 655f  dck.column_name_
-0000be00: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be30: 6463 6b2e 636f 6c75 6d6e 5f74 7970 655f  dck.column_type_
-0000be40: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-0000be50: 706f 7369 7469 6f6e 2c20 6463 6b2e 636f  position, dck.co
-0000be60: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-0000be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be90: 2020 2020 2064 636b 2e63 6f6c 756d 6e5f       dck.column_
-0000bea0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bed0: 2020 2031 2c20 4b45 595f 5459 5045 5f44     1, KEY_TYPE_D
-0000bee0: 4550 454e 4445 4e54 5f43 4849 4c44 5f4b  EPENDENT_CHILD_K
-0000bef0: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
-0000bf00: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-0000bf10: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0000bf20: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0000bf30: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0000bf40: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0000bf50: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-0000bf60: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0000bf70: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0000bf80: 310d 0a0d 0a20 2020 2020 2020 206e 6577  1....        new
-0000bf90: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000bfa0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0000bfb0: 7361 745f 656e 7469 7479 2c0d 0a20 2020  sat_entity,..   
-0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfd0: 2020 2020 2020 2020 2020 2020 2752 4f57              'ROW
-0000bfe0: 5f4e 554d 4245 5228 2920 6f76 6572 2028  _NUMBER() over (
-0000bff0: 7061 7274 6974 696f 6e20 6279 2027 202b  partition by ' +
-0000c000: 2068 6173 685f 6e61 6d65 202b 2027 2027   hash_name + ' '
-0000c010: 202b 2061 6c6c 5f64 636b 5f63 6f6e 6361   + all_dck_conca
-0000c020: 7465 6e61 7465 2b20 2720 4f52 4445 5220  tenate+ ' ORDER 
-0000c030: 4259 2044 4154 455f 4352 4541 5445 4420  BY DATE_CREATED 
-0000c040: 6465 7363 2927 2c0d 0a20 2020 2020 2020  desc)',..       
-0000c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c060: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0000c070: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
-0000c080: 6374 7561 6c5f 696d 6167 655f 312c 2027  ctual_image_1, '
-0000c090: 524e 272c 0d0a 2020 2020 2020 2020 2020  RN',..          
-0000c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0b0: 2020 2020 2069 6e74 6567 6572 5f66 6f72       integer_for
-0000c0c0: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
-0000c0d0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-0000c0e0: 696e 7465 6765 725f 666f 725f 6d65 7461  integer_for_meta
-0000c0f0: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
-0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c110: 2020 2020 2020 2020 2069 6e74 6567 6572           integer
-0000c120: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-0000c130: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c150: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
-0000c160: 2c20 4b45 595f 5459 5045 5f4e 554c 4c2c  , KEY_TYPE_NULL,
-0000c170: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0000c180: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-0000c190: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0000c1a0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0000c1b0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0000c1c0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0000c1d0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0000c1e0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0000c1f0: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
-0000c200: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c210: 2323 2323 2320 4372 6561 7465 2045 6e74  ##### Create Ent
-0000c220: 6974 7920 5354 4720 4c41 5354 2049 4d41  ity STG LAST IMA
-0000c230: 4745 2032 2023 2323 2323 2323 2323 2323  GE 2 ###########
-0000c240: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c250: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
-0000c260: 6c5f 706f 7369 7469 6f6e 203d 2031 0d0a  l_position = 1..
-0000c270: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0000c280: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0000c290: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0000c2a0: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-0000c2b0: 6765 5f31 2c20 6861 7368 5f6e 616d 652c  ge_1, hash_name,
-0000c2c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2e0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0000c2f0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0000c300: 6d61 6765 5f32 2c0d 0a20 2020 2020 2020  mage_2,..       
+0000bde0: 2020 2020 2073 6174 5f6e 756d 5f62 7261       sat_num_bra
+0000bdf0: 6e63 682c 204b 4559 5f54 5950 455f 4841  nch, KEY_TYPE_HA
+0000be00: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
+0000be10: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0000be20: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000be30: 202b 3d20 310d 0a20 2020 2020 2020 2073   += 1..        s
+0000be40: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0000be50: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+0000be60: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+0000be70: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0000be80: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
+0000be90: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0000bea0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0000beb0: 7420 2b20 7361 745f 656e 7469 7479 2c20  t + sat_entity, 
+0000bec0: 2748 4153 4844 4946 4627 2c0d 0a20 2020  'HASHDIFF',..   
+0000bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bee0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0000bef0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+0000bf00: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+0000bf10: 312c 2027 4841 5348 4449 4646 272c 0d0a  1, 'HASHDIFF',..
+0000bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf30: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0000bf40: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+0000bf50: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
+0000bf60: 6974 696f 6e2c 2068 6173 685f 666f 725f  ition, hash_for_
+0000bf70: 6d65 7461 6461 7461 5b31 5d2c 2068 6173  metadata[1], has
+0000bf80: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
+0000bf90: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0000bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfb0: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
+0000bfc0: 682c 204b 4559 5f54 5950 455f 4841 5348  h, KEY_TYPE_HASH
+0000bfd0: 4449 4646 2c20 312c 2073 656c 662e 6f77  DIFF, 1, self.ow
+0000bfe0: 6e65 725d 0d0a 2020 2020 2020 2020 6f72  ner]..        or
+0000bff0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0000c000: 3d20 310d 0a20 2020 2020 2020 2073 656c  = 1..        sel
+0000c010: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0000c020: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0000c030: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0000c040: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0000c050: 675d 290d 0a0d 0a20 2020 2020 2020 2061  g])....        a
+0000c060: 6c6c 5f64 636b 5f63 6f6e 6361 7465 6e61  ll_dck_concatena
+0000c070: 7465 203d 2027 270d 0a20 2020 2020 2020  te = ''..       
+0000c080: 2069 6620 6861 735f 6463 6b3a 0d0a 2020   if has_dck:..  
+0000c090: 2020 2020 2020 2020 2020 666f 7220 6463            for dc
+0000c0a0: 6b20 696e 2064 6570 656e 6465 6e74 5f63  k in dependent_c
+0000c0b0: 6869 6c64 5f6b 6579 3a0d 0a20 2020 2020  hild_key:..     
+0000c0c0: 2020 2020 2020 2020 2020 2061 6c6c 5f64             all_d
+0000c0d0: 636b 5f63 6f6e 6361 7465 6e61 7465 202b  ck_concatenate +
+0000c0e0: 3d20 222c 222b 6463 6b2e 636f 6c75 6d6e  = ","+dck.column
+0000c0f0: 5f6e 616d 655f 7461 7267 6574 0d0a 2020  _name_target..  
+0000c100: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000c110: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0000c120: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+0000c130: 2073 6174 5f65 6e74 6974 792c 2064 636b   sat_entity, dck
+0000c140: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0000c150: 6765 742c 2070 7265 6669 785f 6574 202b  get, prefix_et +
+0000c160: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
+0000c170: 616c 5f69 6d61 6765 5f31 2c0d 0a20 2020  al_image_1,..   
+0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1a0: 2020 2020 6463 6b2e 636f 6c75 6d6e 5f6e      dck.column_n
+0000c1b0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0000c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1e0: 2020 2020 6463 6b2e 636f 6c75 6d6e 5f74      dck.column_t
+0000c1f0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+0000c200: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6463  nal_position, dc
+0000c210: 6b2e 636f 6c75 6d6e 5f6c 656e 6774 682c  k.column_length,
+0000c220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c240: 2020 2020 2020 2020 2064 636b 2e63 6f6c           dck.col
+0000c250: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+0000c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c280: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+0000c290: 5045 5f44 4550 454e 4445 4e54 5f43 4849  PE_DEPENDENT_CHI
+0000c2a0: 4c44 5f4b 4559 2c20 312c 2073 656c 662e  LD_KEY, 1, self.
+0000c2b0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0000c2c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0000c2d0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0000c2e0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0000c2f0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0000c300: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
 0000c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c320: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
-0000c330: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c350: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-0000c360: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-0000c370: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
-0000c380: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-0000c390: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-0000c3a0: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
-0000c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3c0: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-0000c3d0: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-0000c3e0: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
-0000c3f0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0000c400: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0000c410: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-0000c420: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0000c430: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0000c440: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0000c450: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0000c460: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-0000c470: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0000c480: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-0000c490: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-0000c4a0: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
-0000c4b0: 2027 4841 5348 4449 4646 272c 0d0a 2020   'HASHDIFF',..  
-0000c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4d0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0000c4e0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-0000c4f0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-0000c500: 5f32 2c20 2748 4153 4844 4946 4627 2c0d  _2, 'HASHDIFF',.
-0000c510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c530: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-0000c540: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
-0000c550: 7369 7469 6f6e 2c20 6861 7368 5f66 6f72  sition, hash_for
-0000c560: 5f6d 6574 6164 6174 615b 315d 2c20 6861  _metadata[1], ha
-0000c570: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0000c580: 325d 2c0d 0a20 2020 2020 2020 2020 2020  2],..           
-0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5a0: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
-0000c5b0: 6368 2c20 4b45 595f 5459 5045 5f48 4153  ch, KEY_TYPE_HAS
-0000c5c0: 4844 4946 462c 2031 2c20 7365 6c66 2e6f  HDIFF, 1, self.o
-0000c5d0: 776e 6572 5d0d 0a20 2020 2020 2020 206f  wner]..        o
-0000c5e0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0000c5f0: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
-0000c600: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0000c610: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0000c620: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0000c630: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0000c640: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0000c650: 6966 2068 6173 5f64 636b 3a0d 0a20 2020  if has_dck:..   
-0000c660: 2020 2020 2020 2020 2066 6f72 2064 636b           for dck
-0000c670: 2069 6e20 6465 7065 6e64 656e 745f 6368   in dependent_ch
-0000c680: 696c 645f 6b65 793a 0d0a 2020 2020 2020  ild_key:..      
-0000c690: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-0000c6a0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0000c6b0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-0000c6c0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0000c6d0: 6d61 6765 5f31 2c20 6463 6b2e 636f 6c75  mage_1, dck.colu
-0000c6e0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c20  mn_name_target, 
-0000c6f0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-0000c700: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
-0000c710: 6167 655f 322c 0d0a 2020 2020 2020 2020  age_2,..        
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c730: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000c740: 636b 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ck.column_name_t
-0000c750: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0000c320: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000c330: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+0000c340: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0000c350: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0000c360: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
+0000c370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c390: 2752 4f57 5f4e 554d 4245 5228 2920 6f76  'ROW_NUMBER() ov
+0000c3a0: 6572 2028 7061 7274 6974 696f 6e20 6279  er (partition by
+0000c3b0: 2027 202b 2068 6173 685f 6e61 6d65 202b   ' + hash_name +
+0000c3c0: 2027 2027 202b 2061 6c6c 5f64 636b 5f63   ' ' + all_dck_c
+0000c3d0: 6f6e 6361 7465 6e61 7465 2b20 2720 4f52  oncatenate+ ' OR
+0000c3e0: 4445 5220 4259 2044 4154 455f 4352 4541  DER BY DATE_CREA
+0000c3f0: 5445 4420 6465 7363 2927 2c0d 0a20 2020  TED desc)',..   
+0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c410: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0000c420: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+0000c430: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+0000c440: 312c 2027 524e 272c 0d0a 2020 2020 2020  1, 'RN',..      
+0000c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c460: 2020 2020 2020 2020 2069 6e74 6567 6572           integer
+0000c470: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+0000c480: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+0000c490: 6f6e 2c20 696e 7465 6765 725f 666f 725f  on, integer_for_
+0000c4a0: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
+0000c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4c0: 2020 2020 2020 2020 2020 2020 2069 6e74               int
+0000c4d0: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
+0000c4e0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+0000c510: 616e 6368 2c20 4b45 595f 5459 5045 5f4e  anch, KEY_TYPE_N
+0000c520: 554c 4c2c 2031 2c20 7365 6c66 2e6f 776e  ULL, 1, self.own
+0000c530: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
+0000c540: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0000c550: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+0000c560: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0000c570: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0000c580: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0000c590: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000c5a0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2323  ])....        ##
+0000c5b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c5c0: 2323 2323 2323 2323 2320 4372 6561 7465  ######### Create
+0000c5d0: 2045 6e74 6974 7920 5354 4720 4c41 5354   Entity STG LAST
+0000c5e0: 2049 4d41 4745 2032 2023 2323 2323 2323   IMAGE 2 #######
+0000c5f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000c600: 2323 2323 0d0a 2020 2020 2020 2020 6f72  ####..        or
+0000c610: 6469 6e61 6c5f 706f 7369 7469 6f6e 203d  dinal_position =
+0000c620: 2031 0d0a 2020 2020 2020 2020 6e65 775f   1..        new_
+0000c630: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0000c640: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0000c650: 6174 5f65 6e74 6974 795f 6163 7475 616c  at_entity_actual
+0000c660: 5f69 6d61 6765 5f31 2c20 6861 7368 5f6e  _image_1, hash_n
+0000c670: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0000c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c690: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+0000c6a0: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
+0000c6b0: 616c 5f69 6d61 6765 5f32 2c0d 0a20 2020  al_image_2,..   
+0000c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6d0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0000c6e0: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
+0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c700: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
+0000c710: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
+0000c720: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
+0000c730: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+0000c740: 5b31 5d2c 2068 6173 685f 666f 725f 6d65  [1], hash_for_me
+0000c750: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
 0000c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c770: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000c780: 636b 2e63 6f6c 756d 6e5f 7479 7065 5f74  ck.column_type_t
-0000c790: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-0000c7a0: 6f73 6974 696f 6e2c 2064 636b 2e63 6f6c  osition, dck.col
-0000c7b0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-0000c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7e0: 2020 2020 6463 6b2e 636f 6c75 6d6e 5f70      dck.column_p
-0000c7f0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c820: 2020 312c 204b 4559 5f54 5950 455f 4445    1, KEY_TYPE_DE
-0000c830: 5045 4e44 454e 545f 4348 494c 445f 4b45  PENDENT_CHILD_KE
-0000c840: 592c 2031 2c20 7365 6c66 2e6f 776e 6572  Y, 1, self.owner
-0000c850: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000c860: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0000c870: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0000c880: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0000c890: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0000c8a0: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0000c8b0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-0000c8c0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0000c8d0: 0d0a 0d0a 2020 2020 2020 2020 6e65 775f  ....        new_
-0000c8e0: 6669 6c74 6572 203d 205b 7072 6566 6978  filter = [prefix
-0000c8f0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-0000c900: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
-0000c910: 2027 524e 203d 2031 272c 2073 6174 5f6e   'RN = 1', sat_n
-0000c920: 756d 5f62 7261 6e63 682c 2073 656c 662e  um_branch, self.
-0000c930: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0000c940: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0000c950: 7475 616c 2e61 6464 5f65 6e74 7279 5f66  tual.add_entry_f
-0000c960: 696c 7465 7273 285b 6e65 775f 6669 6c74  ilters([new_filt
-0000c970: 6572 5d29 0d0a 0d0a 2020 2020 2020 2020  er])....        
-0000c980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000c990: 2323 2323 2323 2323 2323 2320 4372 6561  ########### Crea
-0000c9a0: 7465 2045 6e74 6974 7920 5354 4720 4a4f  te Entity STG JO
-0000c9b0: 494e 2023 2323 2323 2323 2323 2323 2323  IN #############
-0000c9c0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-0000c9d0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0000c9e0: 706f 7369 7469 6f6e 203d 2031 0d0a 0d0a  position = 1....
-0000c9f0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0000ca00: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0000ca10: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0000ca20: 6e74 6974 795f 746d 702c 2068 6173 685f  ntity_tmp, hash_
-0000ca30: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-0000ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca50: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-0000ca60: 2b20 7361 745f 656e 7469 7479 5f6a 6f69  + sat_entity_joi
-0000ca70: 6e2c 2068 6173 685f 6e61 6d65 2c0d 0a20  n, hash_name,.. 
-0000ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca90: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0000caa0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0000cab0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-0000cac0: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
-0000cad0: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
-0000cae0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-0000caf0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb10: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
-0000cb20: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
-0000cb30: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
-0000cb40: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
-0000cb50: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-0000cb60: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
-0000cb70: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0000cb80: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0000cb90: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0000cba0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000cbb0: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
-0000cbc0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0000cbd0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-0000cbe0: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-0000cbf0: 2027 4841 5348 4449 4646 272c 0d0a 2020   'HASHDIFF',..  
-0000cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc10: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0000cc20: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-0000cc30: 6974 795f 6a6f 696e 2c20 2748 4153 4844  ity_join, 'HASHD
-0000cc40: 4946 4627 2c0d 0a20 2020 2020 2020 2020  IFF',..         
-0000cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc60: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-0000cc70: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-0000cc80: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-0000cc90: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0000cca0: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-0000ccb0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-0000ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ccd0: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-0000cce0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-0000ccf0: 5045 5f48 4153 4844 4946 462c 2031 2c20  PE_HASHDIFF, 1, 
-0000cd00: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0000cd10: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0000cd20: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-0000cd30: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0000cd40: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0000cd50: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0000cd60: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0000cd70: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-0000cd80: 2020 2020 2020 6966 2068 6173 5f72 733a        if has_rs:
-0000cd90: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-0000cda0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0000cdb0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-0000cdc0: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-0000cdd0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-0000cde0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0000cdf0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0000ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce10: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0000ce20: 202b 2073 6174 5f65 6e74 6974 795f 6a6f   + sat_entity_jo
-0000ce30: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
+0000c770: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+0000c780: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
+0000c790: 5950 455f 4841 5348 5f4b 4559 2c20 312c  YPE_HASH_KEY, 1,
+0000c7a0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0000c7b0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0000c7c0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0000c7d0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0000c7e0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+0000c7f0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+0000c800: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+0000c810: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+0000c820: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0000c830: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0000c840: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+0000c850: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+0000c860: 655f 312c 2027 4841 5348 4449 4646 272c  e_1, 'HASHDIFF',
+0000c870: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+0000c8a0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+0000c8b0: 6d61 6765 5f32 2c20 2748 4153 4844 4946  mage_2, 'HASHDIF
+0000c8c0: 4627 2c0d 0a20 2020 2020 2020 2020 2020  F',..           
+0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8e0: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
+0000c8f0: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+0000c900: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
+0000c910: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+0000c920: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0000c930: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
+0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c950: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
+0000c960: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
+0000c970: 5f48 4153 4844 4946 462c 2031 2c20 7365  _HASHDIFF, 1, se
+0000c980: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0000c990: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0000c9a0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0000c9b0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0000c9c0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0000c9d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000c9e0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0000c9f0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0000ca00: 2020 2020 6966 2068 6173 5f64 636b 3a0d      if has_dck:.
+0000ca10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000ca20: 2064 636b 2069 6e20 6465 7065 6e64 656e   dck in dependen
+0000ca30: 745f 6368 696c 645f 6b65 793a 0d0a 2020  t_child_key:..  
+0000ca40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000ca50: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0000ca60: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+0000ca70: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
+0000ca80: 616c 5f69 6d61 6765 5f31 2c20 6463 6b2e  al_image_1, dck.
+0000ca90: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+0000caa0: 6574 2c20 7072 6566 6978 5f65 7420 2b20  et, prefix_et + 
+0000cab0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+0000cac0: 6c5f 696d 6167 655f 322c 0d0a 2020 2020  l_image_2,..    
+0000cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000caf0: 2020 2064 636b 2e63 6f6c 756d 6e5f 6e61     dck.column_na
+0000cb00: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+0000cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb30: 2020 2064 636b 2e63 6f6c 756d 6e5f 7479     dck.column_ty
+0000cb40: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+0000cb50: 616c 5f70 6f73 6974 696f 6e2c 2064 636b  al_position, dck
+0000cb60: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+0000cb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb90: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
+0000cba0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+0000cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbd0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+0000cbe0: 455f 4445 5045 4e44 454e 545f 4348 494c  E_DEPENDENT_CHIL
+0000cbf0: 445f 4b45 592c 2031 2c20 7365 6c66 2e6f  D_KEY, 1, self.o
+0000cc00: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0000cc10: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0000cc20: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0000cc30: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0000cc40: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0000cc50: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+0000cc60: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000cc70: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+0000cc80: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+0000cc90: 6e65 775f 6669 6c74 6572 203d 205b 7072  new_filter = [pr
+0000cca0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+0000ccb0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+0000ccc0: 655f 322c 2027 524e 203d 2031 272c 2073  e_2, 'RN = 1', s
+0000ccd0: 6174 5f6e 756d 5f62 7261 6e63 682c 2073  at_num_branch, s
+0000cce0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0000ccf0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0000cd00: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0000cd10: 7279 5f66 696c 7465 7273 285b 6e65 775f  ry_filters([new_
+0000cd20: 6669 6c74 6572 5d29 0d0a 0d0a 2020 2020  filter])....    
+0000cd30: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+0000cd40: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+0000cd50: 4372 6561 7465 2045 6e74 6974 7920 5354  Create Entity ST
+0000cd60: 4720 4a4f 494e 2023 2323 2323 2323 2323  G JOIN #########
+0000cd70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000cd80: 2323 0d0a 2020 2020 2020 2020 6f72 6469  ##..        ordi
+0000cd90: 6e61 6c5f 706f 7369 7469 6f6e 203d 2031  nal_position = 1
+0000cda0: 0d0a 0d0a 2020 2020 2020 2020 6e65 775f  ....        new_
+0000cdb0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0000cdc0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0000cdd0: 6174 5f65 6e74 6974 795f 746d 702c 2068  at_entity_tmp, h
+0000cde0: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
+0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce00: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0000ce10: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0000ce20: 5f6a 6f69 6e2c 2068 6173 685f 6e61 6d65  _join, hash_name
+0000ce30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0000ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce50: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-0000ce60: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-0000ce70: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-0000ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ce90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000cea0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-0000ceb0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0000cec0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0000ced0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-0000cee0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf10: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-0000cf20: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-0000cf30: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0000cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf50: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-0000cf60: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-0000cf70: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
-0000cf80: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0000cf90: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-0000cfa0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0000cfb0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000cfc0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0000cfd0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0000cfe0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0000cff0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0000d000: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0000d010: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
-0000d020: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0000d030: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0000d040: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0000d050: 6e74 6974 795f 746d 702c 2061 7070 6c69  ntity_tmp, appli
-0000d060: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-0000d070: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0a0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-0000d0b0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0e0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-0000d0f0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-0000d100: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d120: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-0000d130: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
-0000d140: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-0000d150: 6f73 6974 696f 6e2c 2061 7070 6c69 6564  osition, applied
-0000d160: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
-0000d170: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d190: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-0000d1a0: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
-0000d1b0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1d0: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
-0000d1e0: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
-0000d1f0: 5459 5045 5f41 5050 4c49 4544 5f44 4154  TYPE_APPLIED_DAT
-0000d200: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
-0000d210: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
-0000d220: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0000d230: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-0000d240: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0000d250: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0000d260: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000d270: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0000d280: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0000d290: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0000d2a0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-0000d2b0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-0000d2c0: 795f 746d 702c 2027 4441 5445 5f43 5245  y_tmp, 'DATE_CRE
-0000d2d0: 4154 4544 272c 0d0a 2020 2020 2020 2020  ATED',..        
-0000d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2f0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0000d300: 202b 2073 6174 5f65 6e74 6974 795f 6a6f   + sat_entity_jo
-0000d310: 696e 2c20 2744 4154 455f 4352 4541 5445  in, 'DATE_CREATE
-0000d320: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
-0000d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d340: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-0000d350: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-0000d360: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
-0000d370: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-0000d380: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0000d390: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
-0000d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3b0: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
-0000d3c0: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-0000d3d0: 5f4e 554c 4c2c 2031 2c20 7365 6c66 2e6f  _NULL, 1, self.o
-0000d3e0: 776e 6572 5d0d 0a20 2020 2020 2020 206f  wner]..        o
-0000d3f0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0000d400: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
-0000d410: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0000d420: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0000d430: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0000d440: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0000d450: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0000d460: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
-0000d470: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
-0000d480: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
-0000d490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d4a0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0000d4b0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0000d4c0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-0000d4d0: 746d 702c 2074 6e2e 636f 6c75 6d6e 5f6e  tmp, tn.column_n
-0000d4e0: 616d 655f 7461 7267 6574 2c20 7072 6566  ame_target, pref
-0000d4f0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0000d500: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
-0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d530: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-0000d540: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-0000d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d570: 746e 2e63 6f6c 756d 6e5f 7479 7065 5f74  tn.column_type_t
-0000d580: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-0000d590: 6f73 6974 696f 6e2c 2074 6e2e 636f 6c75  osition, tn.colu
-0000d5a0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5d0: 2020 2074 6e2e 636f 6c75 6d6e 5f70 7265     tn.column_pre
-0000d5e0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-0000d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d610: 312c 204b 4559 5f54 5950 455f 5445 4e41  1, KEY_TYPE_TENA
-0000d620: 4e54 2c20 312c 2073 656c 662e 6f77 6e65  NT, 1, self.owne
-0000d630: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-0000d640: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0000d650: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0000d660: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0000d670: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0000d680: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-0000d690: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0000d6a0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0000d6b0: 310d 0a0d 0a20 2020 2020 2020 2069 6620  1....        if 
-0000d6c0: 6861 735f 6463 6b3a 0d0a 2020 2020 2020  has_dck:..      
-0000d6d0: 2020 2020 2020 666f 7220 6463 6b20 696e        for dck in
-0000d6e0: 2064 6570 656e 6465 6e74 5f63 6869 6c64   dependent_child
-0000d6f0: 5f6b 6579 3a0d 0a20 2020 2020 2020 2020  _key:..         
-0000d700: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0000d710: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0000d720: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-0000d730: 7469 7479 5f74 6d70 2c20 6463 6b2e 636f  tity_tmp, dck.co
-0000d740: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-0000d750: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
-0000d760: 745f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  t_entity_join,..
-0000d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d790: 2020 2020 2020 2064 636b 2e63 6f6c 756d         dck.colum
-0000d7a0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0000d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7d0: 2020 2020 2020 2064 636b 2e63 6f6c 756d         dck.colum
-0000d7e0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-0000d7f0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0000d800: 2064 636b 2e63 6f6c 756d 6e5f 6c65 6e67   dck.column_leng
-0000d810: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-0000d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d830: 2020 2020 2020 2020 2020 2020 6463 6b2e              dck.
-0000d840: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
-0000d850: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d870: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
-0000d880: 5f54 5950 455f 4445 5045 4e44 454e 545f  _TYPE_DEPENDENT_
-0000d890: 4348 494c 445f 4b45 592c 2031 2c20 7365  CHILD_KEY, 1, se
-0000d8a0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0000d8b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d8c0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0000d8d0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0000d8e0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0000d8f0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0000d900: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000d910: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0000d920: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-0000d930: 2020 2020 666f 7220 6174 2069 6e20 616c      for at in al
-0000d940: 6c5f 6174 7472 6962 7574 6573 3a0d 0a20  l_attributes:.. 
-0000d950: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-0000d960: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-0000d970: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-0000d980: 745f 656e 7469 7479 5f74 6d70 2c20 6174  t_entity_tmp, at
-0000d990: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0000d9a0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0000ce50: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+0000ce60: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+0000ce70: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+0000ce80: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
+0000ce90: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0000cea0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cec0: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+0000ced0: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
+0000cee0: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
+0000cef0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0000cf00: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0000cf10: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+0000cf20: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0000cf30: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0000cf40: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+0000cf50: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+0000cf60: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+0000cf70: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0000cf80: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0000cf90: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+0000cfa0: 746d 702c 2027 4841 5348 4449 4646 272c  tmp, 'HASHDIFF',
+0000cfb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfd0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+0000cfe0: 5f65 6e74 6974 795f 6a6f 696e 2c20 2748  _entity_join, 'H
+0000cff0: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
+0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d010: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+0000d020: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0000d030: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000d040: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0000d050: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
+0000d060: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d080: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0000d090: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+0000d0a0: 595f 5459 5045 5f48 4153 4844 4946 462c  Y_TYPE_HASHDIFF,
+0000d0b0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+0000d0c0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+0000d0d0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0000d0e0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0000d0f0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0000d100: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0000d110: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0000d120: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0000d130: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+0000d140: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
+0000d150: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0000d160: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0000d170: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+0000d180: 746d 702c 2072 6563 6f72 645f 736f 7572  tmp, record_sour
+0000d190: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
+0000d1a0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0000d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1c0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0000d1d0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0000d1e0: 795f 6a6f 696e 2c0d 0a20 2020 2020 2020  y_join,..       
+0000d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d200: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+0000d210: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+0000d220: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0000d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d250: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
+0000d260: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+0000d270: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+0000d280: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
+0000d290: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
+0000d2a0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0000d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2c0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+0000d2d0: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
+0000d2e0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0000d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d300: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+0000d310: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
+0000d320: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
+0000d330: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
+0000d340: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
+0000d350: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+0000d360: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+0000d370: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0000d380: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0000d390: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000d3a0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0000d3b0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0000d3c0: 2020 2020 6966 2068 6173 5f61 643a 0d0a      if has_ad:..
+0000d3d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000d3e0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0000d3f0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0000d400: 6174 5f65 6e74 6974 795f 746d 702c 2061  at_entity_tmp, a
+0000d410: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+0000d420: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+0000d430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d450: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0000d460: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
+0000d470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d490: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0000d4a0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+0000d4b0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4d0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+0000d4e0: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
+0000d4f0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+0000d500: 616c 5f70 6f73 6974 696f 6e2c 2061 7070  al_position, app
+0000d510: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0000d520: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+0000d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d540: 2020 2020 2020 2020 2020 2020 2061 7070               app
+0000d550: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0000d560: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+0000d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d590: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
+0000d5a0: 4b45 595f 5459 5045 5f41 5050 4c49 4544  KEY_TYPE_APPLIED
+0000d5b0: 5f44 4154 452c 2031 2c20 7365 6c66 2e6f  _DATE, 1, self.o
+0000d5c0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0000d5d0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0000d5e0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0000d5f0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0000d600: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0000d610: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0000d620: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0000d630: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+0000d640: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0000d650: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+0000d660: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+0000d670: 6e74 6974 795f 746d 702c 2027 4441 5445  ntity_tmp, 'DATE
+0000d680: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
+0000d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6a0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0000d6b0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0000d6c0: 795f 6a6f 696e 2c20 2744 4154 455f 4352  y_join, 'DATE_CR
+0000d6d0: 4541 5445 4427 2c0d 0a20 2020 2020 2020  EATED',..       
+0000d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6f0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+0000d700: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+0000d710: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0000d720: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0000d730: 615b 315d 2c20 6861 7368 5f66 6f72 5f6d  a[1], hash_for_m
+0000d740: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+0000d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d760: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
+0000d770: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+0000d780: 5459 5045 5f4e 554c 4c2c 2031 2c20 7365  TYPE_NULL, 1, se
+0000d790: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0000d7a0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0000d7b0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0000d7c0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0000d7d0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0000d7e0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000d7f0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0000d800: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0000d810: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
+0000d820: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000d830: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
+0000d840: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
+0000d850: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0000d860: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0000d870: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+0000d880: 6974 795f 746d 702c 2074 6e2e 636f 6c75  ity_tmp, tn.colu
+0000d890: 6d6e 5f6e 616d 655f 7461 7267 6574 2c20  mn_name_target, 
+0000d8a0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+0000d8b0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8e0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+0000d8f0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d920: 2020 2020 746e 2e63 6f6c 756d 6e5f 7479      tn.column_ty
+0000d930: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+0000d940: 616c 5f70 6f73 6974 696f 6e2c 2074 6e2e  al_position, tn.
+0000d950: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+0000d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d980: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+0000d990: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+0000d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9c0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-0000d9d0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-0000d9e0: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
-0000d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da00: 2020 2020 2020 2020 2020 6174 2e63 6f6c            at.col
-0000da10: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-0000da20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da40: 2020 2020 2061 742e 636f 6c75 6d6e 5f74       at.column_t
-0000da50: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-0000da60: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6174  nal_position, at
-0000da70: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0000da80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000daa0: 2020 2020 6174 2e63 6f6c 756d 6e5f 7072      at.column_pr
-0000dab0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-0000dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dad0: 2020 2020 2020 2020 2020 2020 2073 6174               sat
-0000dae0: 5f6e 756d 5f62 7261 6e63 682c 2061 742e  _num_branch, at.
-0000daf0: 6b65 795f 7479 7065 2c20 312c 2073 656c  key_type, 1, sel
-0000db00: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0000db10: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-0000db20: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-0000db30: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-0000db40: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-0000db50: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
-0000db60: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-0000db70: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0000db80: 0a0d 0a20 2020 2020 2020 206e 6577 5f64  ...        new_d
-0000db90: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-0000dba0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-0000dbb0: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
-0000dbc0: 696d 6167 655f 322c 2068 6173 685f 6e61  image_2, hash_na
-0000dbd0: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
+0000d9c0: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+0000d9d0: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
+0000d9e0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0000d9f0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0000da00: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0000da10: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0000da20: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0000da30: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0000da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da50: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000da60: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+0000da70: 2069 6620 6861 735f 6463 6b3a 0d0a 2020   if has_dck:..  
+0000da80: 2020 2020 2020 2020 2020 666f 7220 6463            for dc
+0000da90: 6b20 696e 2064 6570 656e 6465 6e74 5f63  k in dependent_c
+0000daa0: 6869 6c64 5f6b 6579 3a0d 0a20 2020 2020  hild_key:..     
+0000dab0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0000dac0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0000dad0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0000dae0: 745f 656e 7469 7479 5f74 6d70 2c20 6463  t_entity_tmp, dc
+0000daf0: 6b2e 636f 6c75 6d6e 5f6e 616d 655f 7461  k.column_name_ta
+0000db00: 7267 6574 2c20 7072 6566 6978 5f65 7420  rget, prefix_et 
+0000db10: 2b20 7361 745f 656e 7469 7479 5f6a 6f69  + sat_entity_joi
+0000db20: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+0000db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db40: 2020 2020 2020 2020 2020 2064 636b 2e63             dck.c
+0000db50: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+0000db60: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0000db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db80: 2020 2020 2020 2020 2020 2064 636b 2e63             dck.c
+0000db90: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+0000dba0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+0000dbb0: 696f 6e2c 2064 636b 2e63 6f6c 756d 6e5f  ion, dck.column_
+0000dbc0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+0000dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbf0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-0000dc00: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
-0000dc10: 2068 6173 685f 6e61 6d65 202b 2022 5f48   hash_name + "_H
-0000dc20: 4953 5422 2c0d 0a20 2020 2020 2020 2020  IST",..         
-0000dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc40: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-0000dc50: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-0000dc60: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-0000dc70: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0000dc80: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-0000dc90: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-0000dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dcb0: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-0000dcc0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-0000dcd0: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-0000dce0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0000dcf0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0000dd00: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-0000dd10: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0000dd20: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0000dd30: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0000dd40: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0000dd50: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-0000dd60: 2020 2020 2020 6e65 775f 7265 6c61 7469        new_relati
-0000dd70: 6f6e 7368 6970 203d 205b 7072 6566 6978  onship = [prefix
-0000dd80: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-0000dd90: 5f74 6d70 2c20 2748 4153 4844 4946 4627  _tmp, 'HASHDIFF'
-0000dda0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000ddb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ddc0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0000ddd0: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-0000dde0: 6765 5f32 2c0d 0a20 2020 2020 2020 2020  ge_2,..         
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de00: 2020 2027 4841 5348 4449 4646 272c 2022     'HASHDIFF', "
-0000de10: 4d41 5354 4552 204a 4f49 4e22 2c20 7365  MASTER JOIN", se
-0000de20: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0000de30: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0000de40: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0000de50: 795f 6461 7461 7365 745f 7265 6c61 7469  y_dataset_relati
-0000de60: 6f6e 7368 6970 285b 6e65 775f 7265 6c61  onship([new_rela
-0000de70: 7469 6f6e 7368 6970 5d29 0d0a 2020 2020  tionship])..    
-0000de80: 2020 2020 6e65 775f 7265 6c61 7469 6f6e      new_relation
-0000de90: 7368 6970 203d 205b 7072 6566 6978 5f65  ship = [prefix_e
-0000dea0: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
-0000deb0: 6d70 2c20 6861 7368 5f6e 616d 652c 0d0a  mp, hash_name,..
-0000dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ded0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0000dee0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0000def0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-0000df00: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
-0000df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df20: 6861 7368 5f6e 616d 652c 2022 4d41 5354  hash_name, "MAST
-0000df30: 4552 204a 4f49 4e22 2c20 7365 6c66 2e6f  ER JOIN", self.o
-0000df40: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-0000df50: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0000df60: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0000df70: 7461 7365 745f 7265 6c61 7469 6f6e 7368  taset_relationsh
-0000df80: 6970 285b 6e65 775f 7265 6c61 7469 6f6e  ip([new_relation
-0000df90: 7368 6970 5d29 0d0a 2020 2020 2020 2020  ship])..        
-0000dfa0: 6966 2068 6173 5f64 636b 3a0d 0a20 2020  if has_dck:..   
-0000dfb0: 2020 2020 2020 2020 2066 6f72 2064 636b           for dck
-0000dfc0: 2069 6e20 6465 7065 6e64 656e 745f 6368   in dependent_ch
-0000dfd0: 696c 645f 6b65 793a 0d0a 2020 2020 2020  ild_key:..      
-0000dfe0: 2020 2020 2020 2020 2020 6e65 775f 7265            new_re
-0000dff0: 6c61 7469 6f6e 7368 6970 203d 205b 7072  lationship = [pr
-0000e000: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-0000e010: 7469 7479 5f74 6d70 2c20 6463 6b2e 636f  tity_tmp, dck.co
-0000e020: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-0000e030: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e050: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0000e060: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
-0000e070: 7475 616c 5f69 6d61 6765 5f32 2c0d 0a20  tual_image_2,.. 
-0000e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0a0: 2020 2064 636b 2e63 6f6c 756d 6e5f 6e61     dck.column_na
-0000e0b0: 6d65 5f74 6172 6765 742c 2022 4d41 5354  me_target, "MAST
-0000e0c0: 4552 204a 4f49 4e22 2c20 7365 6c66 2e6f  ER JOIN", self.o
-0000e0d0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0000e0e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0000e0f0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0000e100: 656e 7472 795f 6461 7461 7365 745f 7265  entry_dataset_re
-0000e110: 6c61 7469 6f6e 7368 6970 285b 6e65 775f  lationship([new_
-0000e120: 7265 6c61 7469 6f6e 7368 6970 5d29 0d0a  relationship])..
-0000e130: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
-0000e140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e150: 2323 2323 2320 4372 6561 7465 2045 6e74  ##### Create Ent
-0000e160: 6974 7920 5341 5420 2323 2323 2323 2323  ity SAT ########
-0000e170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000e180: 2323 230d 0a20 2020 2020 2020 206f 7264  ###..        ord
-0000e190: 696e 616c 5f70 6f73 6974 696f 6e20 3d20  inal_position = 
-0000e1a0: 310d 0a0d 0a20 2020 2020 2020 206e 6577  1....        new
-0000e1b0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000e1c0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0000e1d0: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
-0000e1e0: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e200: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0000e210: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0000e220: 7479 2c20 6861 7368 5f6e 616d 652c 0d0a  ty, hash_name,..
-0000e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e240: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0000e250: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-0000e260: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-0000e270: 6974 696f 6e2c 2068 6173 685f 666f 725f  ition, hash_for_
-0000e280: 6d65 7461 6461 7461 5b31 5d2c 2068 6173  metadata[1], has
-0000e290: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
-0000e2a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0000e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2c0: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
-0000e2d0: 682c 204b 4559 5f54 5950 455f 4841 5348  h, KEY_TYPE_HASH
-0000e2e0: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
-0000e2f0: 6e65 725d 0d0a 2020 2020 2020 2020 6f72  ner]..        or
-0000e300: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0000e310: 3d20 310d 0a20 2020 2020 2020 2073 656c  = 1..        sel
-0000e320: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0000e330: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0000e340: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0000e350: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0000e360: 675d 290d 0a0d 0a20 2020 2020 2020 206e  g])....        n
-0000e370: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0000e380: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-0000e390: 2b20 7361 745f 656e 7469 7479 5f6a 6f69  + sat_entity_joi
-0000e3a0: 6e2c 2027 4841 5348 4449 4646 272c 0d0a  n, 'HASHDIFF',..
-0000e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000e3d0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0000e3e0: 6e74 6974 792c 2027 4841 5348 4449 4646  ntity, 'HASHDIFF
-0000e3f0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0000e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e410: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-0000e420: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-0000e430: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
-0000e440: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-0000e450: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-0000e460: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
-0000e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e480: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-0000e490: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-0000e4a0: 4841 5348 4449 4646 2c20 312c 2073 656c  HASHDIFF, 1, sel
-0000e4b0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0000e4c0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0000e4d0: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-0000e4e0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0000e4f0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0000e500: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0000e510: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0000e520: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-0000e530: 2020 2069 6620 6861 735f 7273 3a0d 0a20     if has_rs:.. 
-0000e540: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-0000e550: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-0000e560: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-0000e570: 745f 656e 7469 7479 5f6a 6f69 6e2c 2072  t_entity_join, r
-0000e580: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-0000e590: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-0000e5a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5c0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-0000e5d0: 2073 6174 5f65 6e74 6974 792c 0d0a 2020   sat_entity,..  
-0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e600: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-0000e610: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0000e620: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0000e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e640: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-0000e650: 7572 6365 2e63 6f6c 756d 6e5f 7479 7065  urce.column_type
-0000e660: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
-0000e670: 5f70 6f73 6974 696f 6e2c 2072 6563 6f72  _position, recor
-0000e680: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0000e690: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-0000e6c0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-0000e6d0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-0000e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e700: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
-0000e710: 4b45 595f 5459 5045 5f52 4543 4f52 445f  KEY_TYPE_RECORD_
-0000e720: 534f 5552 4345 2c20 312c 2073 656c 662e  SOURCE, 1, self.
-0000e730: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0000e740: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0000e750: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
-0000e760: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0000e770: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0000e780: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-0000e790: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-0000e7a0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-0000e7b0: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
-0000e7c0: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-0000e7d0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0000e7e0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0000e7f0: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
-0000e800: 6f69 6e2c 2061 7070 6c69 6564 5f64 6174  oin, applied_dat
-0000e810: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-0000e820: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-0000e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e840: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-0000e850: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-0000e860: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e880: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-0000e890: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
-0000e8a0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0000e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8c0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-0000e8d0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f74  ed_date.column_t
-0000e8e0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-0000e8f0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6170  nal_position, ap
-0000e900: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
-0000e910: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
-0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e930: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-0000e940: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
-0000e950: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-0000e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e980: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-0000e990: 204b 4559 5f54 5950 455f 4150 504c 4945   KEY_TYPE_APPLIE
-0000e9a0: 445f 4441 5445 2c20 312c 2073 656c 662e  D_DATE, 1, self.
-0000e9b0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0000e9c0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0000e9d0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
-0000e9e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0000e9f0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0000ea00: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-0000ea10: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-0000ea20: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-0000ea30: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
-0000ea40: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-0000ea50: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-0000ea60: 656e 7469 7479 5f6a 6f69 6e2c 2027 4441  entity_join, 'DA
-0000ea70: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
+0000dbf0: 6463 6b2e 636f 6c75 6d6e 5f70 7265 6369  dck.column_preci
+0000dc00: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+0000dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+0000dc30: 204b 4559 5f54 5950 455f 4445 5045 4e44   KEY_TYPE_DEPEND
+0000dc40: 454e 545f 4348 494c 445f 4b45 592c 2031  ENT_CHILD_KEY, 1
+0000dc50: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0000dc60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000dc70: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0000dc80: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+0000dc90: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+0000dca0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0000dcb0: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
+0000dcc0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0000dcd0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+0000dce0: 2020 2020 2020 2020 666f 7220 6174 2069          for at i
+0000dcf0: 6e20 616c 6c5f 6174 7472 6962 7574 6573  n all_attributes
+0000dd00: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
+0000dd10: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0000dd20: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0000dd30: 2b20 7361 745f 656e 7469 7479 5f74 6d70  + sat_entity_tmp
+0000dd40: 2c20 6174 2e63 6f6c 756d 6e5f 6e61 6d65  , at.column_name
+0000dd50: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+0000dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd70: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000dd80: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+0000dd90: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddb0: 2020 2020 2020 2020 2020 2020 2020 6174                at
+0000ddc0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0000ddd0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddf0: 2020 2020 2020 2020 2061 742e 636f 6c75           at.colu
+0000de00: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+0000de10: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000de20: 2c20 6174 2e63 6f6c 756d 6e5f 6c65 6e67  , at.column_leng
+0000de30: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0000de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de50: 2020 2020 2020 2020 6174 2e63 6f6c 756d          at.colum
+0000de60: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+0000de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de90: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+0000dea0: 2061 742e 6b65 795f 7479 7065 2c20 312c   at.key_type, 1,
+0000deb0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0000dec0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0000ded0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0000dee0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0000def0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0000df00: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0000df10: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+0000df20: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0000df30: 3d20 310d 0a0d 0a20 2020 2020 2020 206e  = 1....        n
+0000df40: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0000df50: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0000df60: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
+0000df70: 7561 6c5f 696d 6167 655f 322c 2068 6173  ual_image_2, has
+0000df80: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
+0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfa0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0000dfb0: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
+0000dfc0: 6f69 6e2c 2068 6173 685f 6e61 6d65 202b  oin, hash_name +
+0000dfd0: 2022 5f48 4953 5422 2c0d 0a20 2020 2020   "_HIST",..     
+0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dff0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+0000e000: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0000e010: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000e020: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0000e030: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
+0000e040: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e060: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0000e070: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+0000e080: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
+0000e090: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+0000e0a0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+0000e0b0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0000e0c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0000e0d0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0000e0e0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0000e0f0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0000e100: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0000e110: 0d0a 2020 2020 2020 2020 6e65 775f 7265  ..        new_re
+0000e120: 6c61 7469 6f6e 7368 6970 203d 205b 7072  lationship = [pr
+0000e130: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+0000e140: 7469 7479 5f74 6d70 2c20 2748 4153 4844  tity_tmp, 'HASHD
+0000e150: 4946 4627 2c0d 0a20 2020 2020 2020 2020  IFF',..         
+0000e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e170: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+0000e180: 6174 5f65 6e74 6974 795f 6163 7475 616c  at_entity_actual
+0000e190: 5f69 6d61 6765 5f32 2c0d 0a20 2020 2020  _image_2,..     
+0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1b0: 2020 2020 2020 2027 4841 5348 4449 4646         'HASHDIFF
+0000e1c0: 272c 2022 4d41 5354 4552 204a 4f49 4e22  ', "MASTER JOIN"
+0000e1d0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0000e1e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0000e1f0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0000e200: 656e 7472 795f 6461 7461 7365 745f 7265  entry_dataset_re
+0000e210: 6c61 7469 6f6e 7368 6970 285b 6e65 775f  lationship([new_
+0000e220: 7265 6c61 7469 6f6e 7368 6970 5d29 0d0a  relationship])..
+0000e230: 2020 2020 2020 2020 6e65 775f 7265 6c61          new_rela
+0000e240: 7469 6f6e 7368 6970 203d 205b 7072 6566  tionship = [pref
+0000e250: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+0000e260: 7479 5f74 6d70 2c20 6861 7368 5f6e 616d  ty_tmp, hash_nam
+0000e270: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e290: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+0000e2a0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+0000e2b0: 6167 655f 322c 0d0a 2020 2020 2020 2020  age_2,..        
+0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2d0: 2020 2020 6861 7368 5f6e 616d 652c 2022      hash_name, "
+0000e2e0: 4d41 5354 4552 204a 4f49 4e22 2c20 7365  MASTER JOIN", se
+0000e2f0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0000e300: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0000e310: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0000e320: 795f 6461 7461 7365 745f 7265 6c61 7469  y_dataset_relati
+0000e330: 6f6e 7368 6970 285b 6e65 775f 7265 6c61  onship([new_rela
+0000e340: 7469 6f6e 7368 6970 5d29 0d0a 2020 2020  tionship])..    
+0000e350: 2020 2020 6966 2068 6173 5f64 636b 3a0d      if has_dck:.
+0000e360: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000e370: 2064 636b 2069 6e20 6465 7065 6e64 656e   dck in dependen
+0000e380: 745f 6368 696c 645f 6b65 793a 0d0a 2020  t_child_key:..  
+0000e390: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000e3a0: 775f 7265 6c61 7469 6f6e 7368 6970 203d  w_relationship =
+0000e3b0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0000e3c0: 745f 656e 7469 7479 5f74 6d70 2c20 6463  t_entity_tmp, dc
+0000e3d0: 6b2e 636f 6c75 6d6e 5f6e 616d 655f 7461  k.column_name_ta
+0000e3e0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0000e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e400: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0000e410: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0000e420: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+0000e430: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e450: 2020 2020 2020 2064 636b 2e63 6f6c 756d         dck.colum
+0000e460: 6e5f 6e61 6d65 5f74 6172 6765 742c 2022  n_name_target, "
+0000e470: 4d41 5354 4552 204a 4f49 4e22 2c20 7365  MASTER JOIN", se
+0000e480: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0000e490: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e4a0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0000e4b0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0000e4c0: 745f 7265 6c61 7469 6f6e 7368 6970 285b  t_relationship([
+0000e4d0: 6e65 775f 7265 6c61 7469 6f6e 7368 6970  new_relationship
+0000e4e0: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
+0000e4f0: 775f 6669 6c74 6572 203d 205b 7072 6566  w_filter = [pref
+0000e500: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+0000e510: 7479 5f6a 6f69 6e2c 2027 524e 203d 2031  ty_join, 'RN = 1
+0000e520: 272c 2073 6174 5f6e 756d 5f62 7261 6e63  ', sat_num_branc
+0000e530: 6820 2c20 7365 6c66 2e6f 776e 6572 5d0d  h , self.owner].
+0000e540: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
+0000e550: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0000e560: 645f 656e 7472 795f 6669 6c74 6572 7328  d_entry_filters(
+0000e570: 5b6e 6577 5f66 696c 7465 725d 290d 0a0d  [new_filter])...
+0000e580: 0a20 2020 2020 2020 2023 2323 2323 2323  .        #######
+0000e590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e5a0: 2323 2323 2043 7265 6174 6520 456e 7469  #### Create Enti
+0000e5b0: 7479 2053 4154 2023 2323 2323 2323 2323  ty SAT #########
+0000e5c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0000e5d0: 2323 0d0a 2020 2020 2020 2020 6f72 6469  ##..        ordi
+0000e5e0: 6e61 6c5f 706f 7369 7469 6f6e 203d 2031  nal_position = 1
+0000e5f0: 0d0a 0d0a 2020 2020 2020 2020 6e65 775f  ....        new_
+0000e600: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0000e610: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0000e620: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
+0000e630: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
+0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e650: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0000e660: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0000e670: 792c 2068 6173 685f 6e61 6d65 2c0d 0a20  y, hash_name,.. 
+0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e690: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0000e6a0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+0000e6b0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+0000e6c0: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
+0000e6d0: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
+0000e6e0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+0000e6f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e710: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
+0000e720: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
+0000e730: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
+0000e740: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
+0000e750: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0000e760: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+0000e770: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0000e780: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0000e790: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0000e7a0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000e7b0: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
+0000e7c0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0000e7d0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+0000e7e0: 2073 6174 5f65 6e74 6974 795f 6a6f 696e   sat_entity_join
+0000e7f0: 2c20 2748 4153 4844 4946 4627 2c0d 0a20  , 'HASHDIFF',.. 
+0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e810: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000e820: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+0000e830: 7469 7479 2c20 2748 4153 4844 4946 4627  tity, 'HASHDIFF'
+0000e840: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e860: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+0000e870: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+0000e880: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+0000e890: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
+0000e8a0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0000e8b0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+0000e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8d0: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+0000e8e0: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
+0000e8f0: 4153 4844 4946 462c 2031 2c20 7365 6c66  ASHDIFF, 1, self
+0000e900: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0000e910: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0000e920: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+0000e930: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0000e940: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0000e950: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+0000e960: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+0000e970: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+0000e980: 2020 6966 2068 6173 5f72 733a 0d0a 2020    if has_rs:..  
+0000e990: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+0000e9a0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+0000e9b0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+0000e9c0: 5f65 6e74 6974 795f 6a6f 696e 2c20 7265  _entity_join, re
+0000e9d0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+0000e9e0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+0000e9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea10: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0000ea20: 7361 745f 656e 7469 7479 2c0d 0a20 2020  sat_entity,..   
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea50: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+0000ea60: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+0000ea70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea90: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0000eaa0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-0000eab0: 6974 792c 2027 4441 5445 5f43 5245 4154  ity, 'DATE_CREAT
-0000eac0: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
-0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eae0: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
-0000eaf0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-0000eb00: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
-0000eb10: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
-0000eb20: 5d2c 2068 6173 685f 666f 725f 6d65 7461  ], hash_for_meta
-0000eb30: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
-0000eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb50: 2020 2020 2020 2020 2073 6174 5f6e 756d           sat_num
-0000eb60: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
-0000eb70: 455f 4e55 4c4c 2c20 312c 2073 656c 662e  E_NULL, 1, self.
-0000eb80: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0000eb90: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0000eba0: 202b 3d20 310d 0a20 2020 2020 2020 2073   += 1..        s
-0000ebb0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0000ebc0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0000ebd0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0000ebe0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0000ebf0: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
-0000ec00: 2069 6620 6861 735f 746e 3a0d 0a20 2020   if has_tn:..   
-0000ec10: 2020 2020 2020 2020 2066 6f72 2074 6e20           for tn 
-0000ec20: 696e 2074 656e 616e 745f 736f 7572 6365  in tenant_source
-0000ec30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000ec40: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0000ec50: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-0000ec60: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-0000ec70: 5f6a 6f69 6e2c 2074 6e2e 636f 6c75 6d6e  _join, tn.column
-0000ec80: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-0000ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecb0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-0000ecc0: 2b20 7361 745f 656e 7469 7479 2c0d 0a20  + sat_entity,.. 
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecf0: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-0000ed00: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed30: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f74       tn.column_t
-0000ed40: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-0000ed50: 6e61 6c5f 706f 7369 7469 6f6e 2c20 746e  nal_position, tn
-0000ed60: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0000ed70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed90: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-0000eda0: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+0000ea90: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+0000eaa0: 7263 652e 636f 6c75 6d6e 5f74 7970 655f  rce.column_type_
+0000eab0: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
+0000eac0: 706f 7369 7469 6f6e 2c20 7265 636f 7264  position, record
+0000ead0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6c  _source.column_l
+0000eae0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+0000eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb00: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+0000eb10: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+0000eb20: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+0000eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000eb50: 6174 5f6e 756d 5f62 7261 6e63 682c 204b  at_num_branch, K
+0000eb60: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
+0000eb70: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
+0000eb80: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0000eb90: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0000eba0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0000ebb0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0000ebc0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0000ebd0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0000ebe0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0000ebf0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+0000ec00: 2020 2020 2020 2020 6966 2068 6173 5f61          if has_a
+0000ec10: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+0000ec20: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0000ec30: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0000ec40: 202b 2073 6174 5f65 6e74 6974 795f 6a6f   + sat_entity_jo
+0000ec50: 696e 2c20 6170 706c 6965 645f 6461 7465  in, applied_date
+0000ec60: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0000ec70: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0000ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec90: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+0000eca0: 6574 202b 2073 6174 5f65 6e74 6974 792c  et + sat_entity,
+0000ecb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecd0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0000ece0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+0000ecf0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0000ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed10: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+0000ed20: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
+0000ed30: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+0000ed40: 616c 5f70 6f73 6974 696f 6e2c 2061 7070  al_position, app
+0000ed50: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0000ed60: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+0000ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed80: 2020 2020 2020 2020 2020 2020 2061 7070               app
+0000ed90: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0000eda0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
 0000edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edd0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-0000ede0: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
-0000edf0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-0000ee00: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0000ee10: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0000ee20: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0000ee30: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0000ee40: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0000ee50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ee60: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0000ee70: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
-0000ee80: 2020 6966 2068 6173 5f64 636b 3a0d 0a20    if has_dck:.. 
-0000ee90: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-0000eea0: 636b 2069 6e20 6465 7065 6e64 656e 745f  ck in dependent_
-0000eeb0: 6368 696c 645f 6b65 793a 0d0a 2020 2020  child_key:..    
-0000eec0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000eed0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0000eee0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0000eef0: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
-0000ef00: 6463 6b2e 636f 6c75 6d6e 5f6e 616d 655f  dck.column_name_
-0000ef10: 7461 7267 6574 2c20 7072 6566 6978 5f65  target, prefix_e
-0000ef20: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
-0000ef30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef50: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
-0000ef60: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-0000ef70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef90: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
-0000efa0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0000efb0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0000efc0: 2c20 6463 6b2e 636f 6c75 6d6e 5f6c 656e  , dck.column_len
-0000efd0: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0000efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eff0: 2020 2020 2020 2020 2020 2020 2064 636b               dck
-0000f000: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-0000f010: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0000f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f030: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-0000f040: 595f 5459 5045 5f44 4550 454e 4445 4e54  Y_TYPE_DEPENDENT
-0000f050: 5f43 4849 4c44 5f4b 4559 2c20 312c 2073  _CHILD_KEY, 1, s
-0000f060: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0000f070: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f080: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0000f090: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0000f0a0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0000f0b0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0000f0c0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0000f0d0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0000f0e0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-0000f0f0: 2020 2020 2066 6f72 2061 7420 696e 2061       for at in a
-0000f100: 6c6c 5f61 7474 7269 6275 7465 733a 0d0a  ll_attributes:..
-0000f110: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000f120: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0000f130: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0000f140: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
-0000f150: 6174 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  at.column_name_t
-0000f160: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0000edd0: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
+0000ede0: 4b45 595f 5459 5045 5f41 5050 4c49 4544  KEY_TYPE_APPLIED
+0000edf0: 5f44 4154 452c 2031 2c20 7365 6c66 2e6f  _DATE, 1, self.o
+0000ee00: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0000ee10: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0000ee20: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0000ee30: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0000ee40: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0000ee50: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0000ee60: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0000ee70: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+0000ee80: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0000ee90: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+0000eea0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+0000eeb0: 6e74 6974 795f 6a6f 696e 2c20 2744 4154  ntity_join, 'DAT
+0000eec0: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
+0000eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eee0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0000eef0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+0000ef00: 7479 2c20 2744 4154 455f 4352 4541 5445  ty, 'DATE_CREATE
+0000ef10: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
+0000ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef30: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
+0000ef40: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+0000ef50: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
+0000ef60: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+0000ef70: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0000ef80: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
+0000ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efa0: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
+0000efb0: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
+0000efc0: 5f4e 554c 4c2c 2031 2c20 7365 6c66 2e6f  _NULL, 1, self.o
+0000efd0: 776e 6572 5d0d 0a20 2020 2020 2020 206f  wner]..        o
+0000efe0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+0000eff0: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
+0000f000: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0000f010: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+0000f020: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+0000f030: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0000f040: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+0000f050: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
+0000f060: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
+0000f070: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
+0000f080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f090: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0000f0a0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0000f0b0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+0000f0c0: 6a6f 696e 2c20 746e 2e63 6f6c 756d 6e5f  join, tn.column_
+0000f0d0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f100: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+0000f110: 2073 6174 5f65 6e74 6974 792c 0d0a 2020   sat_entity,..  
+0000f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f140: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+0000f150: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0000f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f180: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0000f190: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-0000f1a0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1c0: 2020 2020 2020 2061 742e 636f 6c75 6d6e         at.column
-0000f1d0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f200: 2020 6174 2e63 6f6c 756d 6e5f 7479 7065    at.column_type
-0000f210: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
-0000f220: 5f70 6f73 6974 696f 6e2c 2061 742e 636f  _position, at.co
-0000f230: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-0000f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f260: 2061 742e 636f 6c75 6d6e 5f70 7265 6369   at.column_preci
-0000f270: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f290: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-0000f2a0: 6d5f 6272 616e 6368 2c20 6174 2e6b 6579  m_branch, at.key
-0000f2b0: 5f74 7970 652c 2031 2c20 7365 6c66 2e6f  _type, 1, self.o
-0000f2c0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0000f2d0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0000f2e0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0000f2f0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0000f300: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0000f310: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0000f320: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0000f330: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-0000f340: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
-0000f350: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
-0000f360: 2b20 7361 745f 656e 7469 7479 2c20 6861  + sat_entity, ha
-0000f370: 7368 5f6e 616d 6520 2b20 225f 4849 5354  sh_name + "_HIST
-0000f380: 2069 7320 6e75 6c6c 222c 2073 6174 5f6e   is null", sat_n
-0000f390: 756d 5f62 7261 6e63 682c 2073 656c 662e  um_branch, self.
-0000f3a0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0000f3b0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0000f3c0: 7475 616c 2e61 6464 5f65 6e74 7279 5f66  tual.add_entry_f
-0000f3d0: 696c 7465 7273 285b 6e65 775f 6669 6c74  ilters([new_filt
-0000f3e0: 6572 5d29 0d0a 0d0a 2020 2020 2020 2020  er])....        
-0000f3f0: 7365 6c66 2e6c 6f67 2e6c 6f67 2873 656c  self.log.log(sel
-0000f400: 662e 656e 6769 6e65 5f6e 616d 652c 2022  f.engine_name, "
-0000f410: 4669 6e69 7368 6564 2074 6f20 7072 6f63  Finished to proc
-0000f420: 6573 7320 4d65 7461 6461 7461 205b 2048  ess Metadata [ H
-0000f430: 7562 2073 6174 656c 6c69 7465 7320 2d20  ub satellites - 
-0000f440: 6e6f 6e20 6364 6320 5d20 696e 666f 726d  non cdc ] inform
-0000f450: 6174 696f 6e22 2c20 4c4f 475f 4c45 5645  ation", LOG_LEVE
-0000f460: 4c5f 4f4e 4c59 5f4c 4f47 290d 0a0d 0a20  L_ONLY_LOG).... 
-0000f470: 2020 2064 6566 2070 726f 6365 7373 5f64     def process_d
-0000f480: 765f 6875 625f 6372 6561 7469 6f6e 5f73  v_hub_creation_s
-0000f490: 6174 5f63 6463 2873 656c 662c 2068 7562  at_cdc(self, hub
-0000f4a0: 2c20 7361 7429 3a0d 0a20 2020 2020 2020  , sat):..       
-0000f4b0: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
-0000f4c0: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
-0000f4d0: 2253 7461 7274 696e 6720 746f 2070 726f  "Starting to pro
-0000f4e0: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
-0000f4f0: 4875 6220 7361 7465 6c6c 6974 6573 202d  Hub satellites -
-0000f500: 2063 6463 205d 2069 6e66 6f72 6d61 7469   cdc ] informati
-0000f510: 6f6e 222c 204c 4f47 5f4c 4556 454c 5f4f  on", LOG_LEVEL_O
-0000f520: 4e4c 595f 4c4f 4729 0d0a 2020 2020 2020  NLY_LOG)..      
-0000f530: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0000f540: 6f6e 203d 2031 0d0a 2020 2020 2020 2020  on = 1..        
-0000f550: 7072 6566 6978 5f65 7420 3d20 2745 545f  prefix_et = 'ET_
-0000f560: 270d 0a20 2020 2020 2020 2073 6174 5f63  '..        sat_c
-0000f570: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-0000f580: 203d 2073 6174 5b30 5d0d 0a20 2020 2020   = sat[0]..     
-0000f590: 2020 2073 6174 5f63 6f64 5f65 6e74 6974     sat_cod_entit
-0000f5a0: 795f 7461 7267 6574 203d 2073 6174 5b31  y_target = sat[1
-0000f5b0: 5d0d 0a20 2020 2020 2020 2073 6174 5f6e  ]..        sat_n
-0000f5c0: 616d 6520 3d20 7361 745b 325d 0d0a 2020  ame = sat[2]..  
-0000f5d0: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
-0000f5e0: 616e 6368 203d 2031 2023 2053 6174 2063  anch = 1 # Sat c
-0000f5f0: 616e 2774 2068 6176 6520 6d6f 7265 2074  an't have more t
-0000f600: 6861 6e20 6f6e 6520 6272 616e 6368 202d  han one branch -
-0000f610: 3e20 7361 745b 335d 0d0a 2020 2020 2020  > sat[3]..      
-0000f620: 2020 7361 745f 656e 7469 7479 203d 2073    sat_entity = s
-0000f630: 6174 5f6e 616d 650d 0a0d 0a20 2020 2020  at_name....     
-0000f640: 2020 2068 6173 685f 6e61 6d65 203d 2027     hash_name = '
-0000f650: 4841 5348 5f27 202b 2068 7562 2e65 6e74  HASH_' + hub.ent
-0000f660: 6974 795f 6e61 6d65 0d0a 2020 2020 2020  ity_name..      
-0000f670: 2020 6476 5f70 726f 7065 7274 7920 3d20    dv_property = 
-0000f680: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0000f690: 7475 616c 2e67 6574 5f64 765f 7072 6f70  tual.get_dv_prop
-0000f6a0: 6572 7469 6573 5f66 726f 6d5f 636f 645f  erties_from_cod_
-0000f6b0: 656e 7469 7479 5f61 6e64 5f6e 756d 5f63  entity_and_num_c
-0000f6c0: 6f6e 6e65 6374 696f 6e28 6875 622e 636f  onnection(hub.co
-0000f6d0: 645f 656e 7469 7479 2c20 3029 0d0a 2020  d_entity, 0)..  
-0000f6e0: 2020 2020 2020 6966 2064 765f 7072 6f70        if dv_prop
-0000f6f0: 6572 7479 2069 7320 6e6f 7420 4e6f 6e65  erty is not None
-0000f700: 3a20 6861 7368 5f6e 616d 6520 3d20 6476  : hash_name = dv
-0000f710: 5f70 726f 7065 7274 792e 6861 7368 5f6e  _property.hash_n
-0000f720: 616d 650d 0a0d 0a20 2020 2020 2020 206e  ame....        n
-0000f730: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-0000f740: 7469 7479 5f74 6d70 203d 205b 7072 6566  tity_tmp = [pref
-0000f750: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0000f760: 7479 2c20 7361 745f 656e 7469 7479 2c20  ty, sat_entity, 
-0000f770: 454e 5449 5459 5f54 422c 2068 7562 2e63  ENTITY_TB, hub.c
-0000f780: 6f64 5f70 6174 682c 2027 494e 5345 5254  od_path, 'INSERT
-0000f790: 272c 2073 656c 662e 6f77 6e65 725d 0d0a  ', self.owner]..
-0000f7a0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0000f7b0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0000f7c0: 5f65 6e74 7279 5f65 6e74 6974 7928 5b6e  _entry_entity([n
-0000f7d0: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-0000f7e0: 7469 7479 5f74 6d70 5d29 0d0a 0d0a 2020  tity_tmp])....  
-0000f7f0: 2020 2020 2020 6861 735f 7273 203d 2046        has_rs = F
-0000f800: 616c 7365 0d0a 2020 2020 2020 2020 6861  alse..        ha
-0000f810: 735f 746e 203d 2046 616c 7365 0d0a 2020  s_tn = False..  
-0000f820: 2020 2020 2020 6861 735f 6164 203d 2046        has_ad = F
-0000f830: 616c 7365 0d0a 2020 2020 2020 2020 7465  alse..        te
-0000f840: 6e61 6e74 5f73 6f75 7263 6520 3d20 7365  nant_source = se
-0000f850: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0000f860: 616c 2e67 6574 5f74 656e 616e 745f 6f6e  al.get_tenant_on
-0000f870: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
-0000f880: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
-0000f890: 756d 5f62 7261 6e63 6828 7361 745f 636f  um_branch(sat_co
-0000f8a0: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
-0000f8b0: 2073 6174 5f6e 756d 5f62 7261 6e63 6829   sat_num_branch)
-0000f8c0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-0000f8d0: 2874 656e 616e 745f 736f 7572 6365 2920  (tenant_source) 
-0000f8e0: 213d 2030 3a20 6861 735f 746e 203d 2054  != 0: has_tn = T
-0000f8f0: 7275 650d 0a20 2020 2020 2020 2072 6563  rue..        rec
-0000f900: 6f72 645f 736f 7572 6365 203d 2073 656c  ord_source = sel
-0000f910: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0000f920: 6c2e 6765 745f 7265 636f 7264 5f73 6f75  l.get_record_sou
-0000f930: 7263 655f 6f6e 5f64 765f 6672 6f6d 5f63  rce_on_dv_from_c
-0000f940: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-0000f950: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
-0000f960: 7361 745f 636f 645f 656e 7469 7479 5f74  sat_cod_entity_t
-0000f970: 6172 6765 742c 2073 6174 5f6e 756d 5f62  arget, sat_num_b
-0000f980: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-0000f990: 6966 2072 6563 6f72 645f 736f 7572 6365  if record_source
-0000f9a0: 2069 7320 6e6f 7420 4e6f 6e65 3a20 6861   is not None: ha
-0000f9b0: 735f 7273 203d 2054 7275 650d 0a20 2020  s_rs = True..   
-0000f9c0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-0000f9d0: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-0000f9e0: 615f 6163 7475 616c 2e67 6574 5f61 7070  a_actual.get_app
-0000f9f0: 6c69 6564 5f64 6174 655f 6f6e 5f64 765f  lied_date_on_dv_
-0000fa00: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-0000fa10: 7461 7267 6574 2868 7562 2e63 6f64 5f65  target(hub.cod_e
-0000fa20: 6e74 6974 792c 2073 6174 5b33 5d29 0d0a  ntity, sat[3])..
-0000fa30: 2020 2020 2020 2020 6966 2061 7070 6c69          if appli
-0000fa40: 6564 5f64 6174 6520 6973 206e 6f74 204e  ed_date is not N
-0000fa50: 6f6e 653a 2068 6173 5f61 6420 3d20 5472  one: has_ad = Tr
-0000fa60: 7565 0d0a 0d0a 2020 2020 2020 2020 6861  ue....        ha
-0000fa70: 7368 5f66 6f72 5f6d 6574 6164 6174 6120  sh_for_metadata 
-0000fa80: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
-0000fa90: 6e2e 6765 745f 6861 7368 5f66 6f72 5f6d  n.get_hash_for_m
-0000faa0: 6574 6164 6174 6128 290d 0a20 2020 2020  etadata()..     
-0000fab0: 2020 206d 6435 5f66 756e 6374 696f 6e20     md5_function 
-0000fac0: 3d20 7365 6c66 2e67 6574 5f68 6173 685f  = self.get_hash_
-0000fad0: 6b65 795f 6672 6f6d 5f63 6f64 5f65 6e74  key_from_cod_ent
-0000fae0: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
-0000faf0: 756d 5f62 7261 6e63 6828 7361 745f 636f  um_branch(sat_co
-0000fb00: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
-0000fb10: 2073 6174 5b33 5d29 0d0a 0d0a 2020 2020   sat[3])....    
-0000fb20: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0000fb30: 6d61 7070 696e 6720 3d20 5b73 6174 5f63  mapping = [sat_c
-0000fb40: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-0000fb50: 2c20 6d64 355f 6675 6e63 7469 6f6e 2c20  , md5_function, 
-0000fb60: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-0000fb70: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-0000fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb90: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
-0000fba0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbc0: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-0000fbd0: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-0000fbe0: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
-0000fbf0: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-0000fc00: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-0000fc10: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc30: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-0000fc40: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-0000fc50: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
-0000fc60: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0000fc70: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0000fc80: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-0000fc90: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0000fca0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0000fcb0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0000fcc0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0000fcd0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-0000fce0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-0000fcf0: 6574 6164 6174 6120 3d20 7365 6c66 2e63  etadata = self.c
-0000fd00: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
-0000fd10: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-0000fd20: 7461 2829 0d0a 2020 2020 2020 2020 6e65  ta()..        ne
-0000fd30: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0000fd40: 6720 3d20 5b27 272c 2073 656c 662e 636f  g = ['', self.co
-0000fd50: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-0000fd60: 6461 7465 5f76 616c 7565 2829 2c20 7072  date_value(), pr
-0000fd70: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-0000fd80: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
-0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fda0: 2020 2020 2020 2744 4154 455f 4352 4541        'DATE_CREA
-0000fdb0: 5445 4427 2c0d 0a20 2020 2020 2020 2020  TED',..         
-0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdd0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-0000fde0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-0000fdf0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0000fe00: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-0000fe10: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-0000fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe30: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-0000fe40: 655f 666f 725f 6d65 7461 6461 7461 5b32  e_for_metadata[2
-0000fe50: 5d2c 2073 6174 5f6e 756d 5f62 7261 6e63  ], sat_num_branc
-0000fe60: 682c 204b 4559 5f54 5950 455f 4e55 4c4c  h, KEY_TYPE_NULL
-0000fe70: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-0000fe80: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-0000fe90: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0000fea0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-0000feb0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-0000fec0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-0000fed0: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
-0000fee0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0000fef0: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
-0000ff00: 735f 7273 3a0d 0a20 2020 2020 2020 2020  s_rs:..         
-0000ff10: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0000ff20: 6170 7069 6e67 203d 205b 7361 745f 636f  apping = [sat_co
-0000ff30: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
-0000ff40: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-0000ff50: 6f6c 756d 6e5f 6e61 6d65 5f73 6f75 7263  olumn_name_sourc
-0000ff60: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff80: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0000ff90: 202b 2073 6174 5f65 6e74 6974 792c 0d0a   + sat_entity,..
-0000ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffc0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-0000ffd0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0000ffe0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
-0000fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010000: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
-00010010: 736f 7572 6365 2e63 6f6c 756d 6e5f 7479  source.column_ty
-00010020: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-00010030: 616c 5f70 6f73 6974 696f 6e2c 2072 6563  al_position, rec
-00010040: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-00010050: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
-00010060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010070: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00010080: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00010090: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
-000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100c0: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
-000100d0: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
-000100e0: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
-000100f0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00010100: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00010110: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-00010120: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00010130: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00010140: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00010150: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-00010160: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00010170: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
-00010180: 735f 6164 3a0d 0a20 2020 2020 2020 2020  s_ad:..         
-00010190: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-000101a0: 6170 7069 6e67 203d 205b 7361 745f 636f  apping = [sat_co
-000101b0: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
-000101c0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-000101d0: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
-000101e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010200: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-00010210: 2b20 7361 745f 656e 7469 7479 2c0d 0a20  + sat_entity,.. 
-00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010240: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-00010250: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-00010260: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0000f180: 2020 2020 746e 2e63 6f6c 756d 6e5f 7479      tn.column_ty
+0000f190: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+0000f1a0: 616c 5f70 6f73 6974 696f 6e2c 2074 6e2e  al_position, tn.
+0000f1b0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+0000f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1e0: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+0000f1f0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f220: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+0000f230: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
+0000f240: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0000f250: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0000f260: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0000f270: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0000f280: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0000f290: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2b0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0000f2c0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+0000f2d0: 2069 6620 6861 735f 6463 6b3a 0d0a 2020   if has_dck:..  
+0000f2e0: 2020 2020 2020 2020 2020 666f 7220 6463            for dc
+0000f2f0: 6b20 696e 2064 6570 656e 6465 6e74 5f63  k in dependent_c
+0000f300: 6869 6c64 5f6b 6579 3a0d 0a20 2020 2020  hild_key:..     
+0000f310: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0000f320: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0000f330: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0000f340: 745f 656e 7469 7479 5f6a 6f69 6e2c 2064  t_entity_join, d
+0000f350: 636b 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ck.column_name_t
+0000f360: 6172 6765 742c 2070 7265 6669 785f 6574  arget, prefix_et
+0000f370: 202b 2073 6174 5f65 6e74 6974 792c 0d0a   + sat_entity,..
+0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3a0: 2020 2020 2020 2064 636b 2e63 6f6c 756d         dck.colum
+0000f3b0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+0000f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 2020 2020 2064 636b 2e63 6f6c 756d         dck.colum
+0000f3f0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+0000f400: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0000f410: 2064 636b 2e63 6f6c 756d 6e5f 6c65 6e67   dck.column_leng
+0000f420: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f440: 2020 2020 2020 2020 2020 2020 6463 6b2e              dck.
+0000f450: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+0000f460: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f480: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+0000f490: 5f54 5950 455f 4445 5045 4e44 454e 545f  _TYPE_DEPENDENT_
+0000f4a0: 4348 494c 445f 4b45 592c 2031 2c20 7365  CHILD_KEY, 1, se
+0000f4b0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0000f4c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f4d0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0000f4e0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0000f4f0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0000f500: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0000f510: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000f520: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0000f530: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+0000f540: 2020 2020 666f 7220 6174 2069 6e20 616c      for at in al
+0000f550: 6c5f 6174 7472 6962 7574 6573 3a0d 0a20  l_attributes:.. 
+0000f560: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0000f570: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0000f580: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0000f590: 745f 656e 7469 7479 5f6a 6f69 6e2c 2061  t_entity_join, a
+0000f5a0: 742e 636f 6c75 6d6e 5f6e 616d 655f 7461  t.column_name_ta
+0000f5b0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0000f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5d0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0000f5e0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0000f5f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f610: 2020 2020 2020 6174 2e63 6f6c 756d 6e5f        at.column_
+0000f620: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+0000f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f650: 2061 742e 636f 6c75 6d6e 5f74 7970 655f   at.column_type_
+0000f660: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
+0000f670: 706f 7369 7469 6f6e 2c20 6174 2e63 6f6c  position, at.col
+0000f680: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6b0: 6174 2e63 6f6c 756d 6e5f 7072 6563 6973  at.column_precis
+0000f6c0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0000f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6e0: 2020 2020 2020 2020 2073 6174 5f6e 756d           sat_num
+0000f6f0: 5f62 7261 6e63 682c 2061 742e 6b65 795f  _branch, at.key_
+0000f700: 7479 7065 2c20 312c 2073 656c 662e 6f77  type, 1, self.ow
+0000f710: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0000f720: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0000f730: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0000f740: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0000f750: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0000f760: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0000f770: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0000f780: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+0000f790: 2020 2020 2020 206e 6577 5f66 696c 7465         new_filte
+0000f7a0: 7220 3d20 5b70 7265 6669 785f 6574 202b  r = [prefix_et +
+0000f7b0: 2073 6174 5f65 6e74 6974 792c 2068 6173   sat_entity, has
+0000f7c0: 685f 6e61 6d65 202b 2022 5f48 4953 5420  h_name + "_HIST 
+0000f7d0: 6973 206e 756c 6c22 2c20 7361 745f 6e75  is null", sat_nu
+0000f7e0: 6d5f 6272 616e 6368 2c20 7365 6c66 2e6f  m_branch, self.o
+0000f7f0: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
+0000f800: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0000f810: 7561 6c2e 6164 645f 656e 7472 795f 6669  ual.add_entry_fi
+0000f820: 6c74 6572 7328 5b6e 6577 5f66 696c 7465  lters([new_filte
+0000f830: 725d 290d 0a0d 0a20 2020 2020 2020 2073  r])....        s
+0000f840: 656c 662e 6c6f 672e 6c6f 6728 7365 6c66  elf.log.log(self
+0000f850: 2e65 6e67 696e 655f 6e61 6d65 2c20 2246  .engine_name, "F
+0000f860: 696e 6973 6865 6420 746f 2070 726f 6365  inished to proce
+0000f870: 7373 204d 6574 6164 6174 6120 5b20 4875  ss Metadata [ Hu
+0000f880: 6220 7361 7465 6c6c 6974 6573 202d 206e  b satellites - n
+0000f890: 6f6e 2063 6463 205d 2069 6e66 6f72 6d61  on cdc ] informa
+0000f8a0: 7469 6f6e 222c 204c 4f47 5f4c 4556 454c  tion", LOG_LEVEL
+0000f8b0: 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a 2020  _ONLY_LOG)....  
+0000f8c0: 2020 6465 6620 7072 6f63 6573 735f 6476    def process_dv
+0000f8d0: 5f68 7562 5f63 7265 6174 696f 6e5f 7361  _hub_creation_sa
+0000f8e0: 745f 6364 6328 7365 6c66 2c20 6875 622c  t_cdc(self, hub,
+0000f8f0: 2073 6174 293a 0d0a 2020 2020 2020 2020   sat):..        
+0000f900: 7365 6c66 2e6c 6f67 2e6c 6f67 2873 656c  self.log.log(sel
+0000f910: 662e 656e 6769 6e65 5f6e 616d 652c 2022  f.engine_name, "
+0000f920: 5374 6172 7469 6e67 2074 6f20 7072 6f63  Starting to proc
+0000f930: 6573 7320 4d65 7461 6461 7461 205b 2048  ess Metadata [ H
+0000f940: 7562 2073 6174 656c 6c69 7465 7320 2d20  ub satellites - 
+0000f950: 6364 6320 5d20 696e 666f 726d 6174 696f  cdc ] informatio
+0000f960: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
+0000f970: 4c59 5f4c 4f47 290d 0a20 2020 2020 2020  LY_LOG)..       
+0000f980: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0000f990: 6e20 3d20 310d 0a20 2020 2020 2020 2070  n = 1..        p
+0000f9a0: 7265 6669 785f 6574 203d 2027 4554 5f27  refix_et = 'ET_'
+0000f9b0: 0d0a 2020 2020 2020 2020 7361 745f 636f  ..        sat_co
+0000f9c0: 645f 656e 7469 7479 5f73 6f75 7263 6520  d_entity_source 
+0000f9d0: 3d20 7361 745b 305d 0d0a 2020 2020 2020  = sat[0]..      
+0000f9e0: 2020 7361 745f 636f 645f 656e 7469 7479    sat_cod_entity
+0000f9f0: 5f74 6172 6765 7420 3d20 7361 745b 315d  _target = sat[1]
+0000fa00: 0d0a 2020 2020 2020 2020 7361 745f 6e61  ..        sat_na
+0000fa10: 6d65 203d 2073 6174 5b32 5d0d 0a20 2020  me = sat[2]..   
+0000fa20: 2020 2020 2073 6174 5f6e 756d 5f62 7261       sat_num_bra
+0000fa30: 6e63 6820 3d20 3120 2320 5361 7420 6361  nch = 1 # Sat ca
+0000fa40: 6e27 7420 6861 7665 206d 6f72 6520 7468  n't have more th
+0000fa50: 616e 206f 6e65 2062 7261 6e63 6820 2d3e  an one branch ->
+0000fa60: 2073 6174 5b33 5d0d 0a20 2020 2020 2020   sat[3]..       
+0000fa70: 2073 6174 5f65 6e74 6974 7920 3d20 7361   sat_entity = sa
+0000fa80: 745f 6e61 6d65 0d0a 0d0a 2020 2020 2020  t_name....      
+0000fa90: 2020 6861 7368 5f6e 616d 6520 3d20 2748    hash_name = 'H
+0000faa0: 4153 485f 2720 2b20 6875 622e 656e 7469  ASH_' + hub.enti
+0000fab0: 7479 5f6e 616d 650d 0a20 2020 2020 2020  ty_name..       
+0000fac0: 2064 765f 7072 6f70 6572 7479 203d 2073   dv_property = s
+0000fad0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0000fae0: 7561 6c2e 6765 745f 6476 5f70 726f 7065  ual.get_dv_prope
+0000faf0: 7274 6965 735f 6672 6f6d 5f63 6f64 5f65  rties_from_cod_e
+0000fb00: 6e74 6974 795f 616e 645f 6e75 6d5f 636f  ntity_and_num_co
+0000fb10: 6e6e 6563 7469 6f6e 2868 7562 2e63 6f64  nnection(hub.cod
+0000fb20: 5f65 6e74 6974 792c 2030 290d 0a20 2020  _entity, 0)..   
+0000fb30: 2020 2020 2069 6620 6476 5f70 726f 7065       if dv_prope
+0000fb40: 7274 7920 6973 206e 6f74 204e 6f6e 653a  rty is not None:
+0000fb50: 2068 6173 685f 6e61 6d65 203d 2064 765f   hash_name = dv_
+0000fb60: 7072 6f70 6572 7479 2e68 6173 685f 6e61  property.hash_na
+0000fb70: 6d65 0d0a 0d0a 2020 2020 2020 2020 6e65  me....        ne
+0000fb80: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+0000fb90: 6974 795f 746d 7020 3d20 5b70 7265 6669  ity_tmp = [prefi
+0000fba0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0000fbb0: 792c 2073 6174 5f65 6e74 6974 792c 2045  y, sat_entity, E
+0000fbc0: 4e54 4954 595f 5442 2c20 6875 622e 636f  NTITY_TB, hub.co
+0000fbd0: 645f 7061 7468 2c20 2749 4e53 4552 5427  d_path, 'INSERT'
+0000fbe0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0000fbf0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0000fc00: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0000fc10: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
+0000fc20: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+0000fc30: 6974 795f 746d 705d 290d 0a0d 0a20 2020  ity_tmp])....   
+0000fc40: 2020 2020 2068 6173 5f72 7320 3d20 4661       has_rs = Fa
+0000fc50: 6c73 650d 0a20 2020 2020 2020 2068 6173  lse..        has
+0000fc60: 5f74 6e20 3d20 4661 6c73 650d 0a20 2020  _tn = False..   
+0000fc70: 2020 2020 2068 6173 5f61 6420 3d20 4661       has_ad = Fa
+0000fc80: 6c73 650d 0a20 2020 2020 2020 2074 656e  lse..        ten
+0000fc90: 616e 745f 736f 7572 6365 203d 2073 656c  ant_source = sel
+0000fca0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0000fcb0: 6c2e 6765 745f 7465 6e61 6e74 5f6f 6e5f  l.get_tenant_on_
+0000fcc0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
+0000fcd0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
+0000fce0: 6d5f 6272 616e 6368 2873 6174 5f63 6f64  m_branch(sat_cod
+0000fcf0: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
+0000fd00: 7361 745f 6e75 6d5f 6272 616e 6368 290d  sat_num_branch).
+0000fd10: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000fd20: 7465 6e61 6e74 5f73 6f75 7263 6529 2021  tenant_source) !
+0000fd30: 3d20 303a 2068 6173 5f74 6e20 3d20 5472  = 0: has_tn = Tr
+0000fd40: 7565 0d0a 2020 2020 2020 2020 7265 636f  ue..        reco
+0000fd50: 7264 5f73 6f75 7263 6520 3d20 7365 6c66  rd_source = self
+0000fd60: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0000fd70: 2e67 6574 5f72 6563 6f72 645f 736f 7572  .get_record_sour
+0000fd80: 6365 5f6f 6e5f 6476 5f66 726f 6d5f 636f  ce_on_dv_from_co
+0000fd90: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
+0000fda0: 616e 645f 6e75 6d5f 6272 616e 6368 2873  and_num_branch(s
+0000fdb0: 6174 5f63 6f64 5f65 6e74 6974 795f 7461  at_cod_entity_ta
+0000fdc0: 7267 6574 2c20 7361 745f 6e75 6d5f 6272  rget, sat_num_br
+0000fdd0: 616e 6368 290d 0a20 2020 2020 2020 2069  anch)..        i
+0000fde0: 6620 7265 636f 7264 5f73 6f75 7263 6520  f record_source 
+0000fdf0: 6973 206e 6f74 204e 6f6e 653a 2068 6173  is not None: has
+0000fe00: 5f72 7320 3d20 5472 7565 0d0a 2020 2020  _rs = True..    
+0000fe10: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0000fe20: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+0000fe30: 5f61 6374 7561 6c2e 6765 745f 6170 706c  _actual.get_appl
+0000fe40: 6965 645f 6461 7465 5f6f 6e5f 6476 5f66  ied_date_on_dv_f
+0000fe50: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
+0000fe60: 6172 6765 7428 6875 622e 636f 645f 656e  arget(hub.cod_en
+0000fe70: 7469 7479 2c20 7361 745b 335d 290d 0a20  tity, sat[3]).. 
+0000fe80: 2020 2020 2020 2069 6620 6170 706c 6965         if applie
+0000fe90: 645f 6461 7465 2069 7320 6e6f 7420 4e6f  d_date is not No
+0000fea0: 6e65 3a20 6861 735f 6164 203d 2054 7275  ne: has_ad = Tru
+0000feb0: 650d 0a0d 0a20 2020 2020 2020 2068 6173  e....        has
+0000fec0: 685f 666f 725f 6d65 7461 6461 7461 203d  h_for_metadata =
+0000fed0: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
+0000fee0: 2e67 6574 5f68 6173 685f 666f 725f 6d65  .get_hash_for_me
+0000fef0: 7461 6461 7461 2829 0d0a 2020 2020 2020  tadata()..      
+0000ff00: 2020 6d64 355f 6675 6e63 7469 6f6e 203d    md5_function =
+0000ff10: 2073 656c 662e 6765 745f 6861 7368 5f6b   self.get_hash_k
+0000ff20: 6579 5f66 726f 6d5f 636f 645f 656e 7469  ey_from_cod_enti
+0000ff30: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
+0000ff40: 6d5f 6272 616e 6368 2873 6174 5f63 6f64  m_branch(sat_cod
+0000ff50: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
+0000ff60: 7361 745b 335d 290d 0a0d 0a20 2020 2020  sat[3])....     
+0000ff70: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0000ff80: 6170 7069 6e67 203d 205b 7361 745f 636f  apping = [sat_co
+0000ff90: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
+0000ffa0: 206d 6435 5f66 756e 6374 696f 6e2c 2070   md5_function, p
+0000ffb0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+0000ffc0: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
+0000ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffe0: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
+0000fff0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010010: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+00010020: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+00010030: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+00010040: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
+00010050: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00010060: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+00010070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010080: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+00010090: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
+000100a0: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
+000100b0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+000100c0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+000100d0: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+000100e0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+000100f0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00010100: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00010110: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00010120: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00010130: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00010140: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
+00010150: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
+00010160: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00010170: 6128 290d 0a20 2020 2020 2020 206e 6577  a()..        new
+00010180: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00010190: 203d 205b 2727 2c20 7365 6c66 2e63 6f6e   = ['', self.con
+000101a0: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+000101b0: 6174 655f 7661 6c75 6528 292c 2070 7265  ate_value(), pre
+000101c0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+000101d0: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
+000101e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101f0: 2020 2020 2027 4441 5445 5f43 5245 4154       'DATE_CREAT
+00010200: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
+00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010220: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+00010230: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00010240: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00010250: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00010260: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
 00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010280: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-00010290: 6174 652e 636f 6c75 6d6e 5f74 7970 655f  ate.column_type_
-000102a0: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-000102b0: 706f 7369 7469 6f6e 2c20 6170 706c 6965  position, applie
-000102c0: 645f 6461 7465 2e63 6f6c 756d 6e5f 6c65  d_date.column_le
-000102d0: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
-000102e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102f0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-00010300: 645f 6461 7465 2e63 6f6c 756d 6e5f 7072  d_date.column_pr
-00010310: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010330: 2020 2020 2020 2020 2020 2020 2073 6174               sat
-00010340: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
-00010350: 5f54 5950 455f 4150 504c 4945 445f 4441  _TYPE_APPLIED_DA
-00010360: 5445 2c20 312c 2073 656c 662e 6f77 6e65  TE, 1, self.owne
-00010370: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-00010380: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00010390: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000103a0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-000103b0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-000103c0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-000103d0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-000103e0: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-000103f0: 2020 2020 2069 6620 6861 735f 746e 3a0d       if has_tn:.
-00010400: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00010410: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
-00010420: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
-00010430: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00010440: 6574 5f6d 6170 7069 6e67 203d 205b 7361  et_mapping = [sa
-00010450: 745f 636f 645f 656e 7469 7479 5f73 6f75  t_cod_entity_sou
-00010460: 7263 652c 2074 6e2e 636f 6c75 6d6e 5f6e  rce, tn.column_n
-00010470: 616d 655f 736f 7572 6365 2c20 7072 6566  ame_source, pref
-00010480: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-00010490: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104b0: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-000104c0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-000104d0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-000104e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104f0: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-00010500: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-00010510: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00010520: 6f6e 2c20 746e 2e63 6f6c 756d 6e5f 6c65  on, tn.column_le
-00010530: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
-00010540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010550: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-00010560: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-00010570: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00010580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010590: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-000105a0: 595f 5459 5045 5f54 454e 414e 542c 2031  Y_TYPE_TENANT, 1
-000105b0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000105d0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-000105e0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-000105f0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00010600: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00010610: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-00010620: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00010630: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-00010640: 2020 2020 2020 2020 616c 6c5f 6174 7472          all_attr
-00010650: 6962 7574 6573 203d 2073 656c 662e 6d65  ibutes = self.me
-00010660: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-00010670: 745f 6174 7472 6962 7574 6573 5f6f 6e5f  t_attributes_on_
-00010680: 6476 5f66 726f 6d5f 7361 7465 6c6c 6974  dv_from_satellit
-00010690: 655f 6e61 6d65 2873 6174 5f65 6e74 6974  e_name(sat_entit
-000106a0: 7929 0d0a 0d0a 2020 2020 2020 2020 666f  y)....        fo
-000106b0: 7220 6174 2069 6e20 616c 6c5f 6174 7472  r at in all_attr
-000106c0: 6962 7574 6573 3a0d 0a20 2020 2020 2020  ibutes:..       
-000106d0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-000106e0: 5f6d 6170 7069 6e67 203d 205b 6174 2e63  _mapping = [at.c
-000106f0: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-00010700: 2c20 6174 2e63 6f6c 756d 6e5f 6e61 6d65  , at.column_name
-00010710: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
-00010720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010730: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00010740: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-00010750: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
-00010760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010770: 2020 2020 2020 2020 2061 742e 636f 6c75           at.colu
-00010780: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00010790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000107a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107b0: 2020 2020 6174 2e63 6f6c 756d 6e5f 7479      at.column_ty
-000107c0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-000107d0: 616c 5f70 6f73 6974 696f 6e2c 2061 742e  al_position, at.
-000107e0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-000107f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010810: 2020 2061 742e 636f 6c75 6d6e 5f70 7265     at.column_pre
-00010820: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00010830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010840: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
-00010850: 6e75 6d5f 6272 616e 6368 2c20 6174 2e6b  num_branch, at.k
-00010860: 6579 5f74 7970 652c 2031 2c20 7365 6c66  ey_type, 1, self
-00010870: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00010880: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00010890: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-000108a0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-000108b0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-000108c0: 745f 6d61 7070 696e 675d 290d 0a20 2020  t_mapping])..   
-000108d0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-000108e0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000108f0: 0d0a 2020 2020 2020 2020 6d64 355f 6675  ..        md5_fu
-00010900: 6e63 7469 6f6e 203d 2073 656c 662e 636f  nction = self.co
-00010910: 6e6e 6563 7469 6f6e 2e67 6574 5f6d 6435  nnection.get_md5
-00010920: 5f66 756e 6374 696f 6e28 290d 0a20 2020  _function()..   
-00010930: 2020 2020 2063 6173 745f 746f 5f73 7472       cast_to_str
-00010940: 696e 6720 3d20 7365 6c66 2e63 6f6e 6e65  ing = self.conne
-00010950: 6374 696f 6e2e 6765 745f 6361 7374 5f73  ction.get_cast_s
-00010960: 7472 696e 675f 666f 725f 6d65 7461 6461  tring_for_metada
-00010970: 7461 2829 0d0a 0d0a 2020 2020 2020 2020  ta()....        
-00010980: 626b 5f63 6f6e 6361 7465 6e61 7465 203d  bk_concatenate =
-00010990: 2027 270d 0a20 2020 2020 2020 2066 6f72   ''..        for
-000109a0: 2061 7420 696e 2061 6c6c 5f61 7474 7269   at in all_attri
-000109b0: 6275 7465 733a 0d0a 2020 2020 2020 2020  butes:..        
-000109c0: 2020 2020 626b 5f66 696e 616c 203d 2063      bk_final = c
-000109d0: 6173 745f 746f 5f73 7472 696e 672e 7265  ast_to_string.re
-000109e0: 706c 6163 6528 275b 785d 272c 2061 742e  place('[x]', at.
-000109f0: 636f 6c75 6d6e 5f6e 616d 655f 736f 7572  column_name_sour
-00010a00: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
-00010a10: 2062 6b5f 636f 6e63 6174 656e 6174 6520   bk_concatenate 
-00010a20: 2b3d 2062 6b5f 6669 6e61 6c20 2b20 227c  += bk_final + "|
-00010a30: 7c27 2220 2b20 7365 6c66 2e6d 6f64 756c  |'" + self.modul
-00010a40: 655f 6476 5f63 6861 725f 7365 7061 7261  e_dv_char_separa
-00010a50: 746f 725f 6e61 6d69 6e67 202b 2022 277c  tor_naming + "'|
-00010a60: 7c22 0d0a 2020 2020 2020 2020 626b 5f63  |"..        bk_c
-00010a70: 6f6e 6361 7465 6e61 7465 203d 2062 6b5f  oncatenate = bk_
-00010a80: 636f 6e63 6174 656e 6174 655b 3a2d 325d  concatenate[:-2]
-00010a90: 0d0a 2020 2020 2020 2020 6861 7364 6966  ..        hasdif
-00010aa0: 6620 3d20 6d64 355f 6675 6e63 7469 6f6e  f = md5_function
-00010ab0: 2e72 6570 6c61 6365 2827 5b78 5d27 2c20  .replace('[x]', 
-00010ac0: 626b 5f63 6f6e 6361 7465 6e61 7465 290d  bk_concatenate).
-00010ad0: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
-00010ae0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00010af0: 616c 6c5f 6174 7472 6962 7574 6573 5b30  all_attributes[0
-00010b00: 5d2e 636f 645f 656e 7469 7479 5f73 6f75  ].cod_entity_sou
-00010b10: 7263 652c 2068 6173 6469 6666 2c0d 0a20  rce, hasdiff,.. 
-00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00010b40: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-00010b50: 7469 7479 2c20 2748 4153 4844 4946 4627  tity, 'HASHDIFF'
-00010b60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010280: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+00010290: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+000102a0: 2c20 7361 745f 6e75 6d5f 6272 616e 6368  , sat_num_branch
+000102b0: 2c20 4b45 595f 5459 5045 5f4e 554c 4c2c  , KEY_TYPE_NULL,
+000102c0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+000102d0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
+000102e0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+000102f0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00010300: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00010310: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+00010320: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+00010330: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00010340: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00010350: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
+00010360: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00010370: 7070 696e 6720 3d20 5b73 6174 5f63 6f64  pping = [sat_cod
+00010380: 5f65 6e74 6974 795f 736f 7572 6365 2c20  _entity_source, 
+00010390: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+000103a0: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
+000103b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000103c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103d0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+000103e0: 2b20 7361 745f 656e 7469 7479 2c0d 0a20  + sat_entity,.. 
+000103f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010410: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
+00010420: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+00010430: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
+00010440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010450: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+00010460: 6f75 7263 652e 636f 6c75 6d6e 5f74 7970  ource.column_typ
+00010470: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+00010480: 6c5f 706f 7369 7469 6f6e 2c20 7265 636f  l_position, reco
+00010490: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+000104a0: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+000104b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104c0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+000104d0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+000104e0: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+000104f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010510: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+00010520: 204b 4559 5f54 5950 455f 5245 434f 5244   KEY_TYPE_RECORD
+00010530: 5f53 4f55 5243 452c 2031 2c20 7365 6c66  _SOURCE, 1, self
+00010540: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00010550: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+00010560: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+00010570: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00010580: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00010590: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+000105a0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+000105b0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+000105c0: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+000105d0: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
+000105e0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+000105f0: 7070 696e 6720 3d20 5b73 6174 5f63 6f64  pping = [sat_cod
+00010600: 5f65 6e74 6974 795f 736f 7572 6365 2c20  _entity_source, 
+00010610: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00010620: 756d 6e5f 6e61 6d65 5f73 6f75 7263 652c  umn_name_source,
+00010630: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010650: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+00010660: 2073 6174 5f65 6e74 6974 792c 0d0a 2020   sat_entity,..  
+00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010690: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+000106a0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+000106b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106d0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+000106e0: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
+000106f0: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
+00010700: 6f73 6974 696f 6e2c 2061 7070 6c69 6564  osition, applied
+00010710: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
+00010720: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
+00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010740: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+00010750: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
+00010760: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00010770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010780: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
+00010790: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+000107a0: 5459 5045 5f41 5050 4c49 4544 5f44 4154  TYPE_APPLIED_DAT
+000107b0: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
+000107c0: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
+000107d0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+000107e0: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+000107f0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00010800: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00010810: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00010820: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00010830: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00010840: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
+00010850: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00010860: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
+00010870: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
+00010880: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00010890: 745f 6d61 7070 696e 6720 3d20 5b73 6174  t_mapping = [sat
+000108a0: 5f63 6f64 5f65 6e74 6974 795f 736f 7572  _cod_entity_sour
+000108b0: 6365 2c20 746e 2e63 6f6c 756d 6e5f 6e61  ce, tn.column_na
+000108c0: 6d65 5f73 6f75 7263 652c 2070 7265 6669  me_source, prefi
+000108d0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+000108e0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+000108f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010900: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+00010910: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00010920: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010940: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+00010950: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+00010960: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00010970: 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c 656e  n, tn.column_len
+00010980: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
+00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109a0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+000109b0: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+000109c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000109d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109e0: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+000109f0: 5f54 5950 455f 5445 4e41 4e54 2c20 312c  _TYPE_TENANT, 1,
+00010a00: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00010a10: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00010a20: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00010a30: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00010a40: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00010a50: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00010a60: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+00010a70: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00010a80: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+00010a90: 2020 2020 2020 2061 6c6c 5f61 7474 7269         all_attri
+00010aa0: 6275 7465 7320 3d20 7365 6c66 2e6d 6574  butes = self.met
+00010ab0: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+00010ac0: 5f61 7474 7269 6275 7465 735f 6f6e 5f64  _attributes_on_d
+00010ad0: 765f 6672 6f6d 5f73 6174 656c 6c69 7465  v_from_satellite
+00010ae0: 5f6e 616d 6528 7361 745f 656e 7469 7479  _name(sat_entity
+00010af0: 290d 0a0d 0a20 2020 2020 2020 2066 6f72  )....        for
+00010b00: 2061 7420 696e 2061 6c6c 5f61 7474 7269   at in all_attri
+00010b10: 6275 7465 733a 0d0a 2020 2020 2020 2020  butes:..        
+00010b20: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00010b30: 6d61 7070 696e 6720 3d20 5b61 742e 636f  mapping = [at.co
+00010b40: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
+00010b50: 2061 742e 636f 6c75 6d6e 5f6e 616d 655f   at.column_name_
+00010b60: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
 00010b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b80: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-00010b90: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00010ba0: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-00010bb0: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-00010bc0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-00010bd0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+00010b80: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00010b90: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+00010ba0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
+00010bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bc0: 2020 2020 2020 2020 6174 2e63 6f6c 756d          at.colum
+00010bd0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
 00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bf0: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
-00010c00: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
-00010c10: 4153 4844 4946 462c 2031 2c20 7365 6c66  ASHDIFF, 1, self
-00010c20: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00010c30: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00010c40: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00010c50: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-00010c60: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00010c70: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-00010c80: 2020 2073 656c 662e 6c6f 672e 6c6f 6728     self.log.log(
-00010c90: 7365 6c66 2e65 6e67 696e 655f 6e61 6d65  self.engine_name
-00010ca0: 2c20 2246 696e 6973 6865 6420 746f 2070  , "Finished to p
-00010cb0: 726f 6365 7373 204d 6574 6164 6174 6120  rocess Metadata 
-00010cc0: 5b20 4875 6220 7361 7465 6c6c 6974 6573  [ Hub satellites
-00010cd0: 202d 2063 6463 205d 2069 6e66 6f72 6d61   - cdc ] informa
-00010ce0: 7469 6f6e 222c 204c 4f47 5f4c 4556 454c  tion", LOG_LEVEL
-00010cf0: 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a 2020  _ONLY_LOG)....  
-00010d00: 2020 6465 6620 7072 6f63 6573 735f 6476    def process_dv
-00010d10: 5f68 7562 2873 656c 6629 3a0d 0a20 2020  _hub(self):..   
-00010d20: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
-00010d30: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
-00010d40: 6d65 2c20 2253 7461 7274 696e 6720 746f  me, "Starting to
-00010d50: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
-00010d60: 6120 5b20 4875 6220 5d20 696e 666f 726d  a [ Hub ] inform
-00010d70: 6174 696f 6e22 2c20 4c4f 475f 4c45 5645  ation", LOG_LEVE
-00010d80: 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20 2020  L_ONLY_LOG)..   
-00010d90: 2020 2020 2066 6f72 2068 7562 2069 6e20       for hub in 
-00010da0: 5b78 2066 6f72 2078 2069 6e20 7365 6c66  [x for x in self
-00010db0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00010dc0: 2e65 6e74 7279 5f64 765f 656e 7469 7479  .entry_dv_entity
-00010dd0: 2069 6620 782e 656e 7469 7479 5f74 7970   if x.entity_typ
-00010de0: 653d 3d45 4e54 4954 595f 4855 425d 3a0d  e==ENTITY_HUB]:.
-00010df0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00010e00: 662e 7072 6f63 6573 735f 6476 5f68 7562  f.process_dv_hub
-00010e10: 5f63 7265 6174 696f 6e5f 6875 6228 6875  _creation_hub(hu
-00010e20: 6229 0d0a 2020 2020 2020 2020 2020 2020  b)..            
-00010e30: 7365 6c66 2e70 726f 6365 7373 5f64 765f  self.process_dv_
-00010e40: 6875 625f 6372 6561 7469 6f6e 5f73 6174  hub_creation_sat
-00010e50: 2868 7562 290d 0a20 2020 2020 2020 2020  (hub)..         
-00010e60: 2020 2073 656c 662e 7072 6f63 6573 735f     self.process_
-00010e70: 6476 5f73 7473 2868 7562 290d 0a20 2020  dv_sts(hub)..   
-00010e80: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00010e90: 6f63 6573 735f 6476 5f72 7473 2868 7562  ocess_dv_rts(hub
-00010ea0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00010eb0: 6c6f 672e 6c6f 6728 7365 6c66 2e65 6e67  log.log(self.eng
-00010ec0: 696e 655f 6e61 6d65 2c20 2246 696e 6973  ine_name, "Finis
-00010ed0: 6865 6420 746f 2070 726f 6365 7373 204d  hed to process M
-00010ee0: 6574 6164 6174 6120 5b20 4875 6220 5d20  etadata [ Hub ] 
-00010ef0: 696e 666f 726d 6174 696f 6e22 2c20 4c4f  information", LO
-00010f00: 475f 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47  G_LEVEL_ONLY_LOG
-00010f10: 290d 0a0d 0a20 2020 2064 6566 2070 726f  )....    def pro
-00010f20: 6365 7373 5f64 765f 6c69 6e6b 2873 656c  cess_dv_link(sel
-00010f30: 6629 3a0d 0a20 2020 2020 2020 2073 656c  f):..        sel
-00010f40: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
-00010f50: 6e67 696e 655f 6e61 6d65 2c20 2253 7461  ngine_name, "Sta
-00010f60: 7274 696e 6720 746f 2070 726f 6365 7373  rting to process
-00010f70: 204d 6574 6164 6174 6120 5b20 4c69 6e6b   Metadata [ Link
-00010f80: 205d 2069 6e66 6f72 6d61 7469 6f6e 222c   ] information",
-00010f90: 204c 4f47 5f4c 4556 454c 5f4f 4e4c 595f   LOG_LEVEL_ONLY_
-00010fa0: 4c4f 4729 0d0a 0d0a 2020 2020 2020 2020  LOG)....        
-00010fb0: 666f 7220 6c69 6e6b 2069 6e20 5b78 2066  for link in [x f
-00010fc0: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-00010fd0: 6164 6174 615f 6163 7475 616c 2e65 6e74  adata_actual.ent
-00010fe0: 7279 5f64 765f 656e 7469 7479 2069 6620  ry_dv_entity if 
-00010ff0: 782e 656e 7469 7479 5f74 7970 6520 3d3d  x.entity_type ==
-00011000: 2045 4e54 4954 595f 4c49 4e4b 5d3a 0d0a   ENTITY_LINK]:..
-00011010: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011020: 2e70 726f 6365 7373 5f64 765f 6c69 6e6b  .process_dv_link
-00011030: 5f63 7265 6174 696f 6e5f 6c69 6e6b 286c  _creation_link(l
-00011040: 696e 6b29 0d0a 2020 2020 2020 2020 2020  ink)..          
-00011050: 2020 7365 6c66 2e70 726f 6365 7373 5f64    self.process_d
-00011060: 765f 6c69 6e6b 5f63 7265 6174 696f 6e5f  v_link_creation_
-00011070: 7361 7428 6c69 6e6b 290d 0a20 2020 2020  sat(link)..     
-00011080: 2020 2020 2020 2073 656c 662e 7072 6f63         self.proc
-00011090: 6573 735f 6476 5f73 7473 286c 696e 6b29  ess_dv_sts(link)
-000110a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000110b0: 6c66 2e70 726f 6365 7373 5f64 765f 7274  lf.process_dv_rt
-000110c0: 7328 6c69 6e6b 290d 0a20 2020 2020 2020  s(link)..       
-000110d0: 2020 2020 2073 656c 662e 7072 6f63 6573       self.proces
-000110e0: 735f 6476 5f73 6174 6528 6c69 6e6b 290d  s_dv_sate(link).
-000110f0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00011100: 6c6f 672e 6c6f 6728 7365 6c66 2e65 6e67  log.log(self.eng
-00011110: 696e 655f 6e61 6d65 2c20 2246 696e 6973  ine_name, "Finis
-00011120: 6865 6420 746f 2070 726f 6365 7373 204d  hed to process M
-00011130: 6574 6164 6174 6120 5b20 4c69 6e6b 205d  etadata [ Link ]
-00011140: 2069 6e66 6f72 6d61 7469 6f6e 222c 204c   information", L
-00011150: 4f47 5f4c 4556 454c 5f4f 4e4c 595f 4c4f  OG_LEVEL_ONLY_LO
-00011160: 4729 0d0a 0d0a 2020 2020 6465 6620 7072  G)....    def pr
-00011170: 6f63 6573 735f 6476 5f73 6174 6528 7365  ocess_dv_sate(se
-00011180: 6c66 2c20 6476 5f65 6e74 6974 7929 3a0d  lf, dv_entity):.
-00011190: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-000111a0: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
-000111b0: 655f 6e61 6d65 2c20 2253 7461 7274 696e  e_name, "Startin
-000111c0: 6720 746f 2070 726f 6365 7373 204d 6574  g to process Met
-000111d0: 6164 6174 6120 5b20 4566 6665 6374 6976  adata [ Effectiv
-000111e0: 6974 7920 5361 7465 6c6c 6974 6520 5d20  ity Satellite ] 
-000111f0: 696e 666f 726d 6174 696f 6e22 2c20 4c4f  information", LO
-00011200: 475f 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47  G_LEVEL_ONLY_LOG
-00011210: 290d 0a20 2020 2020 2020 206f 7264 696e  )..        ordin
-00011220: 616c 5f70 6f73 6974 696f 6e20 3d20 310d  al_position = 1.
-00011230: 0a20 2020 2020 2020 2070 7265 6669 785f  .        prefix_
-00011240: 6574 203d 2027 4554 5f27 0d0a 2020 2020  et = 'ET_'..    
-00011250: 2020 2020 7361 7465 5f6e 616d 6520 3d20      sate_name = 
-00011260: 6476 5f65 6e74 6974 792e 6e61 6d65 5f65  dv_entity.name_e
-00011270: 6666 6563 7469 7669 7479 5f73 6174 656c  ffectivity_satel
-00011280: 6c69 7465 0d0a 2020 2020 2020 2020 7361  lite..        sa
-00011290: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
-000112a0: 5f69 6d61 6765 5f31 203d 2027 5354 475f  _image_1 = 'STG_
-000112b0: 544d 505f 4c41 5354 5f49 4d41 4745 5f31  TMP_LAST_IMAGE_1
-000112c0: 5f27 202b 2073 6174 655f 6e61 6d65 0d0a  _' + sate_name..
-000112d0: 2020 2020 2020 2020 7361 7465 5f65 6e74          sate_ent
-000112e0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-000112f0: 5f32 203d 2027 5354 475f 544d 505f 4c41  _2 = 'STG_TMP_LA
-00011300: 5354 5f49 4d41 4745 5f32 5f27 202b 2073  ST_IMAGE_2_' + s
-00011310: 6174 655f 6e61 6d65 0d0a 2020 2020 2020  ate_name..      
-00011320: 2020 7361 7465 5f65 6e74 6974 795f 6163    sate_entity_ac
-00011330: 7475 616c 5f69 6d61 6765 5f33 203d 2027  tual_image_3 = '
-00011340: 5354 475f 544d 505f 4c41 5354 5f49 4d41  STG_TMP_LAST_IMA
-00011350: 4745 5f33 5f27 202b 2073 6174 655f 6e61  GE_3_' + sate_na
-00011360: 6d65 0d0a 2020 2020 2020 2020 7361 7465  me..        sate
-00011370: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-00011380: 7572 6365 7320 3d20 2753 5447 5f54 4d50  urces = 'STG_TMP
-00011390: 5f55 4e49 4f4e 5f27 202b 2073 6174 655f  _UNION_' + sate_
-000113a0: 6e61 6d65 0d0a 2020 2020 2020 2020 7361  name..        sa
-000113b0: 7465 5f65 6e74 6974 795f 6a6f 696e 203d  te_entity_join =
-000113c0: 2027 5354 475f 544d 505f 4a4f 494e 5f27   'STG_TMP_JOIN_'
-000113d0: 202b 2073 6174 655f 6e61 6d65 0d0a 2020   + sate_name..  
-000113e0: 2020 2020 2020 7361 7465 5f65 6e74 6974        sate_entit
-000113f0: 795f 6c61 7374 5f69 6d61 6765 203d 2027  y_last_image = '
-00011400: 5354 475f 544d 505f 4c41 5354 5f49 4d41  STG_TMP_LAST_IMA
-00011410: 4745 5f27 202b 2073 6174 655f 6e61 6d65  GE_' + sate_name
-00011420: 0d0a 2020 2020 2020 2020 7361 7465 5f65  ..        sate_e
-00011430: 6e74 6974 7920 3d20 7361 7465 5f6e 616d  ntity = sate_nam
-00011440: 650d 0a20 2020 2020 2020 2063 6f64 5f65  e..        cod_e
-00011450: 6e74 6974 795f 7461 7267 6574 203d 2064  ntity_target = d
-00011460: 765f 656e 7469 7479 2e63 6f64 5f65 6e74  v_entity.cod_ent
-00011470: 6974 790d 0a0d 0a20 2020 2020 2020 2068  ity....        h
-00011480: 6173 685f 6e61 6d65 203d 2027 4841 5348  ash_name = 'HASH
-00011490: 5f27 202b 2064 765f 656e 7469 7479 2e65  _' + dv_entity.e
-000114a0: 6e74 6974 795f 6e61 6d65 0d0a 2020 2020  ntity_name..    
-000114b0: 2020 2020 6476 5f70 726f 7065 7274 7920      dv_property 
-000114c0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
-000114d0: 6163 7475 616c 2e67 6574 5f64 765f 7072  actual.get_dv_pr
-000114e0: 6f70 6572 7469 6573 5f66 726f 6d5f 636f  operties_from_co
-000114f0: 645f 656e 7469 7479 5f61 6e64 5f6e 756d  d_entity_and_num
-00011500: 5f63 6f6e 6e65 6374 696f 6e28 6476 5f65  _connection(dv_e
-00011510: 6e74 6974 792e 636f 645f 656e 7469 7479  ntity.cod_entity
-00011520: 2c20 3029 0d0a 2020 2020 2020 2020 6966  , 0)..        if
-00011530: 2064 765f 7072 6f70 6572 7479 2069 7320   dv_property is 
-00011540: 6e6f 7420 4e6f 6e65 3a20 6861 7368 5f6e  not None: hash_n
-00011550: 616d 6520 3d20 6476 5f70 726f 7065 7274  ame = dv_propert
-00011560: 792e 6861 7368 5f6e 616d 650d 0a0d 0a20  y.hash_name.... 
-00011570: 2020 2020 2020 206f 7269 6769 6e5f 7479         origin_ty
-00011580: 7065 7320 3d20 7365 6c66 2e6d 6574 6164  pes = self.metad
-00011590: 6174 615f 6163 7475 616c 2e67 6574 5f64  ata_actual.get_d
-000115a0: 6963 745f 6f72 6967 696e 5f74 7970 655f  ict_origin_type_
-000115b0: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-000115c0: 6f6e 5f64 7628 6476 5f65 6e74 6974 792e  on_dv(dv_entity.
-000115d0: 636f 645f 656e 7469 7479 290d 0a0d 0a20  cod_entity).... 
-000115e0: 2020 2020 2020 2069 6620 7361 7465 5f6e         if sate_n
-000115f0: 616d 6520 6973 204e 6f6e 6520 6f72 2073  ame is None or s
-00011600: 6174 655f 6e61 6d65 203d 3d20 2727 3a20  ate_name == '': 
-00011610: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-00011620: 2020 6966 206f 7269 6769 6e5f 7479 7065    if origin_type
-00011630: 735b 276f 7269 6769 6e5f 6973 5f74 6f74  s['origin_is_tot
-00011640: 616c 275d 203d 3d20 3120 616e 6420 6f72  al'] == 1 and or
-00011650: 6967 696e 5f74 7970 6573 5b27 6f72 6967  igin_types['orig
-00011660: 696e 5f69 735f 696e 6372 656d 656e 7461  in_is_incrementa
-00011670: 6c27 5d20 3d3d 2030 2061 6e64 206f 7269  l'] == 0 and ori
-00011680: 6769 6e5f 7479 7065 735b 276f 7269 6769  gin_types['origi
-00011690: 6e5f 6973 5f63 6463 275d 203d 3d20 303a  n_is_cdc'] == 0:
-000116a0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-000116b0: 775f 656e 7469 7479 203d 205b 7072 6566  w_entity = [pref
-000116c0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-000116d0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-000116e0: 5f31 2c20 7361 7465 5f65 6e74 6974 795f  _1, sate_entity_
-000116f0: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
-00011700: 454e 5449 5459 5f57 4954 482c 2064 765f  ENTITY_WITH, dv_
-00011710: 656e 7469 7479 2e63 6f64 5f70 6174 682c  entity.cod_path,
-00011720: 2027 272c 2073 656c 662e 6f77 6e65 725d   '', self.owner]
-00011730: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00011740: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00011750: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
-00011760: 6974 7928 5b6e 6577 5f65 6e74 6974 795d  ity([new_entity]
-00011770: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00011780: 6577 5f65 6e74 6974 7920 3d20 5b70 7265  ew_entity = [pre
-00011790: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-000117a0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-000117b0: 655f 322c 2073 6174 655f 656e 7469 7479  e_2, sate_entity
-000117c0: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
-000117d0: 2045 4e54 4954 595f 5749 5448 2c20 6476   ENTITY_WITH, dv
-000117e0: 5f65 6e74 6974 792e 636f 645f 7061 7468  _entity.cod_path
-000117f0: 2c20 2727 2c20 7365 6c66 2e6f 776e 6572  , '', self.owner
-00011800: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
-00011810: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00011820: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
-00011830: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
-00011840: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00011850: 6e65 775f 656e 7469 7479 203d 205b 7072  new_entity = [pr
-00011860: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00011870: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
-00011880: 6365 732c 2073 6174 655f 656e 7469 7479  ces, sate_entity
-00011890: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c20  _union_sources, 
-000118a0: 454e 5449 5459 5f57 4954 482c 2064 765f  ENTITY_WITH, dv_
-000118b0: 656e 7469 7479 2e63 6f64 5f70 6174 682c  entity.cod_path,
-000118c0: 2027 272c 2073 656c 662e 6f77 6e65 725d   '', self.owner]
-000118d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000118e0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-000118f0: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
-00011900: 6974 7928 5b6e 6577 5f65 6e74 6974 795d  ity([new_entity]
-00011910: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00011920: 6577 5f65 6e74 6974 7920 3d20 5b70 7265  ew_entity = [pre
-00011930: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-00011940: 7469 7479 5f6a 6f69 6e2c 2073 6174 655f  tity_join, sate_
-00011950: 656e 7469 7479 5f6a 6f69 6e2c 2045 4e54  entity_join, ENT
-00011960: 4954 595f 5749 5448 2c20 6476 5f65 6e74  ITY_WITH, dv_ent
-00011970: 6974 792e 636f 645f 7061 7468 2c20 2727  ity.cod_path, ''
-00011980: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00011990: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000119a0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-000119b0: 6164 645f 656e 7472 795f 656e 7469 7479  add_entry_entity
-000119c0: 285b 6e65 775f 656e 7469 7479 5d29 0d0a  ([new_entity])..
-000119d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000119e0: 656e 7469 7479 203d 205b 7072 6566 6978  entity = [prefix
-000119f0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00011a00: 795f 6c61 7374 5f69 6d61 6765 2c20 7361  y_last_image, sa
-00011a10: 7465 5f65 6e74 6974 795f 6c61 7374 5f69  te_entity_last_i
-00011a20: 6d61 6765 2c20 454e 5449 5459 5f57 4954  mage, ENTITY_WIT
-00011a30: 482c 2064 765f 656e 7469 7479 2e63 6f64  H, dv_entity.cod
-00011a40: 5f70 6174 682c 2027 272c 2073 656c 662e  _path, '', self.
-00011a50: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00011a60: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00011a70: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00011a80: 7279 5f65 6e74 6974 7928 5b6e 6577 5f65  ry_entity([new_e
-00011a90: 6e74 6974 795d 290d 0a20 2020 2020 2020  ntity])..       
-00011aa0: 2020 2020 206e 6577 5f65 6e74 6974 7920       new_entity 
-00011ab0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00011ac0: 6174 655f 656e 7469 7479 2c20 7361 7465  ate_entity, sate
-00011ad0: 5f65 6e74 6974 792c 2045 4e54 4954 595f  _entity, ENTITY_
-00011ae0: 5442 2c20 6476 5f65 6e74 6974 792e 636f  TB, dv_entity.co
-00011af0: 645f 7061 7468 2c20 2749 4e53 4552 5427  d_path, 'INSERT'
-00011b00: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00011b10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011b20: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00011b30: 6164 645f 656e 7472 795f 656e 7469 7479  add_entry_entity
-00011b40: 285b 6e65 775f 656e 7469 7479 5d29 0d0a  ([new_entity])..
-00011b50: 0d0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
-00011b60: 735f 7273 203d 2046 616c 7365 0d0a 2020  s_rs = False..  
-00011b70: 2020 2020 2020 2020 2020 6861 735f 746e            has_tn
-00011b80: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00011b90: 2020 2020 2020 6861 735f 6164 203d 2046        has_ad = F
-00011ba0: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
-00011bb0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-00011bc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011bd0: 2323 2323 2323 2323 2320 556e 696f 6e20  ######### Union 
-00011be0: 616c 6c20 736f 7572 6365 7320 2323 2323  all sources ####
-00011bf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00011c10: 230d 0a20 2020 2020 2020 2020 2020 2061  #..            a
-00011c20: 6c6c 5f73 6f75 7263 6573 203d 2073 656c  ll_sources = sel
-00011c30: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00011c40: 6c2e 6765 745f 616c 6c5f 636f 645f 656e  l.get_all_cod_en
-00011c50: 7469 7479 5f73 6f75 7263 655f 6672 6f6d  tity_source_from
-00011c60: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
-00011c70: 6574 5f6f 6e5f 656e 7472 795f 6476 2863  et_on_entry_dv(c
-00011c80: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-00011c90: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00011ca0: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
-00011cb0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00011cc0: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
-00011cd0: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
-00011ce0: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
-00011cf0: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
-00011d00: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
-00011d10: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00011d20: 206c 656e 2874 656e 616e 745f 736f 7572   len(tenant_sour
-00011d30: 6365 2920 213d 2030 3a20 6861 735f 746e  ce) != 0: has_tn
-00011d40: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00011d50: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-00011d60: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
-00011d70: 7461 5f61 6374 7561 6c2e 6765 745f 7265  ta_actual.get_re
-00011d80: 636f 7264 5f73 6f75 7263 655f 6f6e 5f64  cord_source_on_d
-00011d90: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-00011da0: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
-00011db0: 5f62 7261 6e63 6828 636f 645f 656e 7469  _branch(cod_enti
-00011dc0: 7479 5f74 6172 6765 742c 2031 290d 0a20  ty_target, 1).. 
-00011dd0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00011de0: 636f 7264 5f73 6f75 7263 6520 6973 206e  cord_source is n
-00011df0: 6f74 204e 6f6e 653a 2068 6173 5f72 7320  ot None: has_rs 
-00011e00: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00011e10: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-00011e20: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00011e30: 5f61 6374 7561 6c2e 6765 745f 6170 706c  _actual.get_appl
-00011e40: 6965 645f 6461 7465 5f6f 6e5f 6476 5f66  ied_date_on_dv_f
-00011e50: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
-00011e60: 6172 6765 7428 6476 5f65 6e74 6974 792e  arget(dv_entity.
-00011e70: 636f 645f 656e 7469 7479 2c20 3129 0d0a  cod_entity, 1)..
-00011e80: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00011e90: 7070 6c69 6564 5f64 6174 6520 6973 206e  pplied_date is n
-00011ea0: 6f74 204e 6f6e 653a 2068 6173 5f61 6420  ot None: has_ad 
-00011eb0: 3d20 5472 7565 0d0a 0d0a 2020 2020 2020  = True....      
-00011ec0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-00011ed0: 6574 6164 6174 6120 3d20 7365 6c66 2e63  etadata = self.c
-00011ee0: 6f6e 6e65 6374 696f 6e2e 6765 745f 6861  onnection.get_ha
-00011ef0: 7368 5f66 6f72 5f6d 6574 6164 6174 6128  sh_for_metadata(
-00011f00: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00011f10: 206e 756d 5f62 7261 6e63 6865 7320 3d20   num_branches = 
-00011f20: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00011f30: 7475 616c 2e67 6574 5f6e 756d 5f62 7261  tual.get_num_bra
-00011f40: 6e63 6865 735f 6f6e 5f65 6e74 7279 5f64  nches_on_entry_d
-00011f50: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-00011f60: 795f 6e61 6d65 2864 765f 656e 7469 7479  y_name(dv_entity
-00011f70: 2e63 6f64 5f65 6e74 6974 7929 0d0a 0d0a  .cod_entity)....
-00011f80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011f90: 6e75 6d5f 6272 616e 6368 2069 6e20 7261  num_branch in ra
-00011fa0: 6e67 6528 312c 206e 756d 5f62 7261 6e63  nge(1, num_branc
-00011fb0: 6865 7320 2b20 3129 3a0d 0a20 2020 2020  hes + 1):..     
-00011fc0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
-00011fd0: 5f64 765f 6d61 7070 696e 675f 626b 203d  _dv_mapping_bk =
-00011fe0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00011ff0: 6374 7561 6c2e 6765 745f 616c 6c5f 626b  ctual.get_all_bk
-00012000: 5f66 726f 6d5f 656e 7472 795f 6476 5f63  _from_entry_dv_c
-00012010: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-00012020: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
-00012030: 6476 5f65 6e74 6974 792e 636f 645f 656e  dv_entity.cod_en
-00012040: 7469 7479 2c20 6e75 6d5f 6272 616e 6368  tity, num_branch
-00012050: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00012060: 2020 2065 6e74 7279 5f64 765f 6d61 7070     entry_dv_mapp
-00012070: 696e 675f 626b 2e73 6f72 7428 6b65 793d  ing_bk.sort(key=
-00012080: 6c61 6d62 6461 2078 3a20 782e 6f72 6469  lambda x: x.ordi
-00012090: 6e61 6c5f 706f 7369 7469 6f6e 290d 0a20  nal_position).. 
-000120a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000120b0: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-000120c0: 203d 2065 6e74 7279 5f64 765f 6d61 7070   = entry_dv_mapp
-000120d0: 696e 675f 626b 5b30 5d2e 636f 645f 656e  ing_bk[0].cod_en
-000120e0: 7469 7479 5f73 6f75 7263 650d 0a20 2020  tity_source..   
-000120f0: 2020 2020 2020 2020 2020 2020 206d 6435               md5
-00012100: 5f66 756e 6374 696f 6e20 3d20 7365 6c66  _function = self
-00012110: 2e67 6574 5f68 6173 685f 6b65 795f 6672  .get_hash_key_fr
-00012120: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
-00012130: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
-00012140: 6e63 6828 636f 645f 656e 7469 7479 5f74  nch(cod_entity_t
-00012150: 6172 6765 742c 206e 756d 5f62 7261 6e63  arget, num_branc
-00012160: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
-00012170: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00012180: 6d61 7070 696e 6720 3d20 5b63 6f64 5f65  mapping = [cod_e
-00012190: 6e74 6974 795f 736f 7572 6365 2c20 6d64  ntity_source, md
-000121a0: 355f 6675 6e63 7469 6f6e 2c20 7072 6566  5_function, pref
-000121b0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-000121c0: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-000121d0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-000121e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121f0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00012200: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012220: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00012230: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00012240: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-00012250: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
-00012260: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
-00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012290: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-000122a0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-000122b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122d0: 2020 6e75 6d5f 6272 616e 6368 2c20 4b45    num_branch, KE
-000122e0: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-000122f0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00012300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012310: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00012320: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-00012330: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00012340: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00012350: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00012360: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00012370: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00012380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012390: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-000123a0: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
-000123b0: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-000123c0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-000123d0: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-000123e0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-000123f0: 5f6d 6170 7069 6e67 203d 205b 2727 2c20  _mapping = ['', 
-00012400: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
-00012410: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
-00012420: 6528 292c 2070 7265 6669 785f 6574 202b  e(), prefix_et +
-00012430: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-00012440: 6f6e 5f73 6f75 7263 6573 2c0d 0a20 2020  on_sources,..   
-00012450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012470: 2020 2020 2744 4154 455f 4352 4541 5445      'DATE_CREATE
-00012480: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
-00012490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124a0: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-000124b0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-000124c0: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-000124d0: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
-000124e0: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-000124f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012510: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-00012520: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-00012530: 206e 756d 5f62 7261 6e63 682c 204e 6f6e   num_branch, Non
-00012540: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
-00012550: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00012560: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00012570: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00012580: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00012590: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-000125a0: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-000125b0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-000125c0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-000125d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000125e0: 2020 2020 6966 2068 6173 5f72 733a 0d0a      if has_rs:..
-000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012600: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00012610: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-00012620: 615f 6163 7475 616c 2e67 6574 5f72 6563  a_actual.get_rec
-00012630: 6f72 645f 736f 7572 6365 5f6f 6e5f 6476  ord_source_on_dv
-00012640: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
-00012650: 5f74 6172 6765 745f 616e 645f 6e75 6d5f  _target_and_num_
-00012660: 6272 616e 6368 2820 636f 645f 656e 7469  branch( cod_enti
-00012670: 7479 5f74 6172 6765 742c 206e 756d 5f62  ty_target, num_b
-00012680: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-00012690: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-000126a0: 6563 6f72 645f 736f 7572 6365 2069 7320  ecord_source is 
-000126b0: 6e6f 7420 4e6f 6e65 3a20 6861 735f 7273  not None: has_rs
-000126c0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-000126d0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-000126e0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000126f0: 203d 205b 636f 645f 656e 7469 7479 5f73   = [cod_entity_s
-00012700: 6f75 7263 652c 2072 6563 6f72 645f 736f  ource, record_so
-00012710: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-00012720: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
-00012730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012750: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00012760: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-00012770: 6f6e 5f73 6f75 7263 6573 2c0d 0a20 2020  on_sources,..   
-00012780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127a0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-000127b0: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-000127c0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127f0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00012800: 7263 652e 636f 6c75 6d6e 5f74 7970 655f  rce.column_type_
-00012810: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-00012820: 706f 7369 7469 6f6e 2c0d 0a20 2020 2020  position,..     
-00012830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012850: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00012860: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-00012870: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00012880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000128a0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-000128b0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-000128c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128e0: 2020 2020 2020 2020 2020 206e 756d 5f62             num_b
-000128f0: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-00012900: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
-00012910: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00012920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012930: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00012940: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00012950: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012960: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00012970: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00012980: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00012990: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-000129a0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-000129b0: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
-000129c0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-000129d0: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
-000129e0: 656e 616e 745f 736f 7572 6365 2920 213d  enant_source) !=
-000129f0: 2030 3a20 6861 735f 746e 203d 2054 7275   0: has_tn = Tru
-00012a00: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00012a10: 2020 2020 2020 2074 656e 616e 745f 736f         tenant_so
-00012a20: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
-00012a30: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
-00012a40: 7465 6e61 6e74 5f6f 6e5f 6476 5f66 726f  tenant_on_dv_fro
-00012a50: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
-00012a60: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
-00012a70: 6368 2863 6f64 5f65 6e74 6974 795f 7461  ch(cod_entity_ta
-00012a80: 7267 6574 2c20 6e75 6d5f 6272 616e 6368  rget, num_branch
-00012a90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00012aa0: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
-00012ab0: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
-00012ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012ad0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-00012ae0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00012af0: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
-00012b00: 652c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  e, tn.column_nam
-00012b10: 655f 736f 7572 6365 2c0d 0a20 2020 2020  e_source,..     
-00012b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b40: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00012b50: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00012b60: 795f 756e 696f 6e5f 736f 7572 6365 732c  y_union_sources,
-00012b70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c00: 2020 2061 742e 636f 6c75 6d6e 5f74 7970     at.column_typ
+00010c10: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+00010c20: 6c5f 706f 7369 7469 6f6e 2c20 6174 2e63  l_position, at.c
+00010c30: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00010c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c60: 2020 6174 2e63 6f6c 756d 6e5f 7072 6563    at.column_prec
+00010c70: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c90: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+00010ca0: 756d 5f62 7261 6e63 682c 2061 742e 6b65  um_branch, at.ke
+00010cb0: 795f 7479 7065 2c20 312c 2073 656c 662e  y_type, 1, self.
+00010cc0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00010cd0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00010ce0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00010cf0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00010d00: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00010d10: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
+00010d20: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00010d30: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+00010d40: 0a20 2020 2020 2020 206d 6435 5f66 756e  .        md5_fun
+00010d50: 6374 696f 6e20 3d20 7365 6c66 2e63 6f6e  ction = self.con
+00010d60: 6e65 6374 696f 6e2e 6765 745f 6d64 355f  nection.get_md5_
+00010d70: 6675 6e63 7469 6f6e 2829 0d0a 2020 2020  function()..    
+00010d80: 2020 2020 6361 7374 5f74 6f5f 7374 7269      cast_to_stri
+00010d90: 6e67 203d 2073 656c 662e 636f 6e6e 6563  ng = self.connec
+00010da0: 7469 6f6e 2e67 6574 5f63 6173 745f 7374  tion.get_cast_st
+00010db0: 7269 6e67 5f66 6f72 5f6d 6574 6164 6174  ring_for_metadat
+00010dc0: 6128 290d 0a0d 0a20 2020 2020 2020 2062  a()....        b
+00010dd0: 6b5f 636f 6e63 6174 656e 6174 6520 3d20  k_concatenate = 
+00010de0: 2727 0d0a 2020 2020 2020 2020 666f 7220  ''..        for 
+00010df0: 6174 2069 6e20 616c 6c5f 6174 7472 6962  at in all_attrib
+00010e00: 7574 6573 3a0d 0a20 2020 2020 2020 2020  utes:..         
+00010e10: 2020 2062 6b5f 6669 6e61 6c20 3d20 6361     bk_final = ca
+00010e20: 7374 5f74 6f5f 7374 7269 6e67 2e72 6570  st_to_string.rep
+00010e30: 6c61 6365 2827 5b78 5d27 2c20 6174 2e63  lace('[x]', at.c
+00010e40: 6f6c 756d 6e5f 6e61 6d65 5f73 6f75 7263  olumn_name_sourc
+00010e50: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00010e60: 626b 5f63 6f6e 6361 7465 6e61 7465 202b  bk_concatenate +
+00010e70: 3d20 626b 5f66 696e 616c 202b 2022 7c7c  = bk_final + "||
+00010e80: 2722 202b 2073 656c 662e 6d6f 6475 6c65  '" + self.module
+00010e90: 5f64 765f 6368 6172 5f73 6570 6172 6174  _dv_char_separat
+00010ea0: 6f72 5f6e 616d 696e 6720 2b20 2227 7c7c  or_naming + "'||
+00010eb0: 220d 0a20 2020 2020 2020 2062 6b5f 636f  "..        bk_co
+00010ec0: 6e63 6174 656e 6174 6520 3d20 626b 5f63  ncatenate = bk_c
+00010ed0: 6f6e 6361 7465 6e61 7465 5b3a 2d32 5d0d  oncatenate[:-2].
+00010ee0: 0a20 2020 2020 2020 2068 6173 6469 6666  .        hasdiff
+00010ef0: 203d 206d 6435 5f66 756e 6374 696f 6e2e   = md5_function.
+00010f00: 7265 706c 6163 6528 275b 785d 272c 2062  replace('[x]', b
+00010f10: 6b5f 636f 6e63 6174 656e 6174 6529 0d0a  k_concatenate)..
+00010f20: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00010f30: 7365 745f 6d61 7070 696e 6720 3d20 5b61  set_mapping = [a
+00010f40: 6c6c 5f61 7474 7269 6275 7465 735b 305d  ll_attributes[0]
+00010f50: 2e63 6f64 5f65 6e74 6974 795f 736f 7572  .cod_entity_sour
+00010f60: 6365 2c20 6861 7364 6966 662c 0d0a 2020  ce, hasdiff,..  
+00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f80: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00010f90: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+00010fa0: 6974 792c 2027 4841 5348 4449 4646 272c  ity, 'HASHDIFF',
+00010fb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fd0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00010fe0: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00010ff0: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+00011000: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+00011010: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+00011020: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
+00011030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011040: 2020 2020 2073 6174 5f6e 756d 5f62 7261       sat_num_bra
+00011050: 6e63 682c 204b 4559 5f54 5950 455f 4841  nch, KEY_TYPE_HA
+00011060: 5348 4449 4646 2c20 312c 2073 656c 662e  SHDIFF, 1, self.
+00011070: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00011080: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00011090: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+000110a0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+000110b0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+000110c0: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+000110d0: 2020 7365 6c66 2e6c 6f67 2e6c 6f67 2873    self.log.log(s
+000110e0: 656c 662e 656e 6769 6e65 5f6e 616d 652c  elf.engine_name,
+000110f0: 2022 4669 6e69 7368 6564 2074 6f20 7072   "Finished to pr
+00011100: 6f63 6573 7320 4d65 7461 6461 7461 205b  ocess Metadata [
+00011110: 2048 7562 2073 6174 656c 6c69 7465 7320   Hub satellites 
+00011120: 2d20 6364 6320 5d20 696e 666f 726d 6174  - cdc ] informat
+00011130: 696f 6e22 2c20 4c4f 475f 4c45 5645 4c5f  ion", LOG_LEVEL_
+00011140: 4f4e 4c59 5f4c 4f47 290d 0a0d 0a20 2020  ONLY_LOG)....   
+00011150: 2064 6566 2070 726f 6365 7373 5f64 765f   def process_dv_
+00011160: 6875 6228 7365 6c66 293a 0d0a 2020 2020  hub(self):..    
+00011170: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
+00011180: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
+00011190: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
+000111a0: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
+000111b0: 205b 2048 7562 205d 2069 6e66 6f72 6d61   [ Hub ] informa
+000111c0: 7469 6f6e 222c 204c 4f47 5f4c 4556 454c  tion", LOG_LEVEL
+000111d0: 5f4f 4e4c 595f 4c4f 4729 0d0a 2020 2020  _ONLY_LOG)..    
+000111e0: 2020 2020 666f 7220 6875 6220 696e 205b      for hub in [
+000111f0: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
+00011200: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00011210: 656e 7472 795f 6476 5f65 6e74 6974 7920  entry_dv_entity 
+00011220: 6966 2078 2e65 6e74 6974 795f 7479 7065  if x.entity_type
+00011230: 3d3d 454e 5449 5459 5f48 5542 5d3a 0d0a  ==ENTITY_HUB]:..
+00011240: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011250: 2e70 726f 6365 7373 5f64 765f 6875 625f  .process_dv_hub_
+00011260: 6372 6561 7469 6f6e 5f68 7562 2868 7562  creation_hub(hub
+00011270: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00011280: 656c 662e 7072 6f63 6573 735f 6476 5f68  elf.process_dv_h
+00011290: 7562 5f63 7265 6174 696f 6e5f 7361 7428  ub_creation_sat(
+000112a0: 6875 6229 0d0a 2020 2020 2020 2020 2020  hub)..          
+000112b0: 2020 7365 6c66 2e70 726f 6365 7373 5f64    self.process_d
+000112c0: 765f 7374 7328 6875 6229 0d0a 2020 2020  v_sts(hub)..    
+000112d0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+000112e0: 6365 7373 5f64 765f 7274 7328 6875 6229  cess_dv_rts(hub)
+000112f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00011300: 6f67 2e6c 6f67 2873 656c 662e 656e 6769  og.log(self.engi
+00011310: 6e65 5f6e 616d 652c 2022 4669 6e69 7368  ne_name, "Finish
+00011320: 6564 2074 6f20 7072 6f63 6573 7320 4d65  ed to process Me
+00011330: 7461 6461 7461 205b 2048 7562 205d 2069  tadata [ Hub ] i
+00011340: 6e66 6f72 6d61 7469 6f6e 222c 204c 4f47  nformation", LOG
+00011350: 5f4c 4556 454c 5f4f 4e4c 595f 4c4f 4729  _LEVEL_ONLY_LOG)
+00011360: 0d0a 0d0a 2020 2020 6465 6620 7072 6f63  ....    def proc
+00011370: 6573 735f 6476 5f6c 696e 6b28 7365 6c66  ess_dv_link(self
+00011380: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00011390: 2e6c 6f67 2e6c 6f67 2873 656c 662e 656e  .log.log(self.en
+000113a0: 6769 6e65 5f6e 616d 652c 2022 5374 6172  gine_name, "Star
+000113b0: 7469 6e67 2074 6f20 7072 6f63 6573 7320  ting to process 
+000113c0: 4d65 7461 6461 7461 205b 204c 696e 6b20  Metadata [ Link 
+000113d0: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+000113e0: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+000113f0: 4f47 290d 0a0d 0a20 2020 2020 2020 2066  OG)....        f
+00011400: 6f72 206c 696e 6b20 696e 205b 7820 666f  or link in [x fo
+00011410: 7220 7820 696e 2073 656c 662e 6d65 7461  r x in self.meta
+00011420: 6461 7461 5f61 6374 7561 6c2e 656e 7472  data_actual.entr
+00011430: 795f 6476 5f65 6e74 6974 7920 6966 2078  y_dv_entity if x
+00011440: 2e65 6e74 6974 795f 7479 7065 203d 3d20  .entity_type == 
+00011450: 454e 5449 5459 5f4c 494e 4b5d 3a0d 0a20  ENTITY_LINK]:.. 
+00011460: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011470: 7072 6f63 6573 735f 6476 5f6c 696e 6b5f  process_dv_link_
+00011480: 6372 6561 7469 6f6e 5f6c 696e 6b28 6c69  creation_link(li
+00011490: 6e6b 290d 0a20 2020 2020 2020 2020 2020  nk)..           
+000114a0: 2073 656c 662e 7072 6f63 6573 735f 6476   self.process_dv
+000114b0: 5f6c 696e 6b5f 6372 6561 7469 6f6e 5f73  _link_creation_s
+000114c0: 6174 286c 696e 6b29 0d0a 2020 2020 2020  at(link)..      
+000114d0: 2020 2020 2020 7365 6c66 2e70 726f 6365        self.proce
+000114e0: 7373 5f64 765f 7374 7328 6c69 6e6b 290d  ss_dv_sts(link).
+000114f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00011500: 662e 7072 6f63 6573 735f 6476 5f72 7473  f.process_dv_rts
+00011510: 286c 696e 6b29 0d0a 2020 2020 2020 2020  (link)..        
+00011520: 2020 2020 7365 6c66 2e70 726f 6365 7373      self.process
+00011530: 5f64 765f 7361 7465 286c 696e 6b29 0d0a  _dv_sate(link)..
+00011540: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00011550: 6f67 2e6c 6f67 2873 656c 662e 656e 6769  og.log(self.engi
+00011560: 6e65 5f6e 616d 652c 2022 4669 6e69 7368  ne_name, "Finish
+00011570: 6564 2074 6f20 7072 6f63 6573 7320 4d65  ed to process Me
+00011580: 7461 6461 7461 205b 204c 696e 6b20 5d20  tadata [ Link ] 
+00011590: 696e 666f 726d 6174 696f 6e22 2c20 4c4f  information", LO
+000115a0: 475f 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47  G_LEVEL_ONLY_LOG
+000115b0: 290d 0a0d 0a20 2020 2064 6566 2070 726f  )....    def pro
+000115c0: 6365 7373 5f64 765f 7361 7465 2873 656c  cess_dv_sate(sel
+000115d0: 662c 2064 765f 656e 7469 7479 293a 0d0a  f, dv_entity):..
+000115e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000115f0: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
+00011600: 5f6e 616d 652c 2022 5374 6172 7469 6e67  _name, "Starting
+00011610: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
+00011620: 6461 7461 205b 2045 6666 6563 7469 7669  data [ Effectivi
+00011630: 7479 2053 6174 656c 6c69 7465 205d 2069  ty Satellite ] i
+00011640: 6e66 6f72 6d61 7469 6f6e 222c 204c 4f47  nformation", LOG
+00011650: 5f4c 4556 454c 5f4f 4e4c 595f 4c4f 4729  _LEVEL_ONLY_LOG)
+00011660: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
+00011670: 6c5f 706f 7369 7469 6f6e 203d 2031 0d0a  l_position = 1..
+00011680: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00011690: 7420 3d20 2745 545f 270d 0a20 2020 2020  t = 'ET_'..     
+000116a0: 2020 2073 6174 655f 6e61 6d65 203d 2064     sate_name = d
+000116b0: 765f 656e 7469 7479 2e6e 616d 655f 6566  v_entity.name_ef
+000116c0: 6665 6374 6976 6974 795f 7361 7465 6c6c  fectivity_satell
+000116d0: 6974 650d 0a20 2020 2020 2020 2073 6174  ite..        sat
+000116e0: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
+000116f0: 696d 6167 655f 3120 3d20 2753 5447 5f54  image_1 = 'STG_T
+00011700: 4d50 5f4c 4153 545f 494d 4147 455f 315f  MP_LAST_IMAGE_1_
+00011710: 2720 2b20 7361 7465 5f6e 616d 650d 0a20  ' + sate_name.. 
+00011720: 2020 2020 2020 2073 6174 655f 656e 7469         sate_enti
+00011730: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00011740: 3220 3d20 2753 5447 5f54 4d50 5f4c 4153  2 = 'STG_TMP_LAS
+00011750: 545f 494d 4147 455f 325f 2720 2b20 7361  T_IMAGE_2_' + sa
+00011760: 7465 5f6e 616d 650d 0a20 2020 2020 2020  te_name..       
+00011770: 2073 6174 655f 656e 7469 7479 5f61 6374   sate_entity_act
+00011780: 7561 6c5f 696d 6167 655f 3320 3d20 2753  ual_image_3 = 'S
+00011790: 5447 5f54 4d50 5f4c 4153 545f 494d 4147  TG_TMP_LAST_IMAG
+000117a0: 455f 335f 2720 2b20 7361 7465 5f6e 616d  E_3_' + sate_nam
+000117b0: 650d 0a20 2020 2020 2020 2073 6174 655f  e..        sate_
+000117c0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+000117d0: 7263 6573 203d 2027 5354 475f 544d 505f  rces = 'STG_TMP_
+000117e0: 554e 494f 4e5f 2720 2b20 7361 7465 5f6e  UNION_' + sate_n
+000117f0: 616d 650d 0a20 2020 2020 2020 2073 6174  ame..        sat
+00011800: 655f 656e 7469 7479 5f6a 6f69 6e20 3d20  e_entity_join = 
+00011810: 2753 5447 5f54 4d50 5f4a 4f49 4e5f 2720  'STG_TMP_JOIN_' 
+00011820: 2b20 7361 7465 5f6e 616d 650d 0a20 2020  + sate_name..   
+00011830: 2020 2020 2073 6174 655f 656e 7469 7479       sate_entity
+00011840: 5f6c 6173 745f 696d 6167 6520 3d20 2753  _last_image = 'S
+00011850: 5447 5f54 4d50 5f4c 4153 545f 494d 4147  TG_TMP_LAST_IMAG
+00011860: 455f 2720 2b20 7361 7465 5f6e 616d 650d  E_' + sate_name.
+00011870: 0a20 2020 2020 2020 2073 6174 655f 656e  .        sate_en
+00011880: 7469 7479 203d 2073 6174 655f 6e61 6d65  tity = sate_name
+00011890: 0d0a 2020 2020 2020 2020 636f 645f 656e  ..        cod_en
+000118a0: 7469 7479 5f74 6172 6765 7420 3d20 6476  tity_target = dv
+000118b0: 5f65 6e74 6974 792e 636f 645f 656e 7469  _entity.cod_enti
+000118c0: 7479 0d0a 0d0a 2020 2020 2020 2020 6861  ty....        ha
+000118d0: 7368 5f6e 616d 6520 3d20 2748 4153 485f  sh_name = 'HASH_
+000118e0: 2720 2b20 6476 5f65 6e74 6974 792e 656e  ' + dv_entity.en
+000118f0: 7469 7479 5f6e 616d 650d 0a20 2020 2020  tity_name..     
+00011900: 2020 2064 765f 7072 6f70 6572 7479 203d     dv_property =
+00011910: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00011920: 6374 7561 6c2e 6765 745f 6476 5f70 726f  ctual.get_dv_pro
+00011930: 7065 7274 6965 735f 6672 6f6d 5f63 6f64  perties_from_cod
+00011940: 5f65 6e74 6974 795f 616e 645f 6e75 6d5f  _entity_and_num_
+00011950: 636f 6e6e 6563 7469 6f6e 2864 765f 656e  connection(dv_en
+00011960: 7469 7479 2e63 6f64 5f65 6e74 6974 792c  tity.cod_entity,
+00011970: 2030 290d 0a20 2020 2020 2020 2069 6620   0)..        if 
+00011980: 6476 5f70 726f 7065 7274 7920 6973 206e  dv_property is n
+00011990: 6f74 204e 6f6e 653a 2068 6173 685f 6e61  ot None: hash_na
+000119a0: 6d65 203d 2064 765f 7072 6f70 6572 7479  me = dv_property
+000119b0: 2e68 6173 685f 6e61 6d65 0d0a 0d0a 2020  .hash_name....  
+000119c0: 2020 2020 2020 6f72 6967 696e 5f74 7970        origin_typ
+000119d0: 6573 203d 2073 656c 662e 6d65 7461 6461  es = self.metada
+000119e0: 7461 5f61 6374 7561 6c2e 6765 745f 6469  ta_actual.get_di
+000119f0: 6374 5f6f 7269 6769 6e5f 7479 7065 5f66  ct_origin_type_f
+00011a00: 726f 6d5f 636f 645f 656e 7469 7479 5f6f  rom_cod_entity_o
+00011a10: 6e5f 6476 2864 765f 656e 7469 7479 2e63  n_dv(dv_entity.c
+00011a20: 6f64 5f65 6e74 6974 7929 0d0a 0d0a 2020  od_entity)....  
+00011a30: 2020 2020 2020 6966 2073 6174 655f 6e61        if sate_na
+00011a40: 6d65 2069 7320 4e6f 6e65 206f 7220 7361  me is None or sa
+00011a50: 7465 5f6e 616d 6520 3d3d 2027 273a 2072  te_name == '': r
+00011a60: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00011a70: 2069 6620 6f72 6967 696e 5f74 7970 6573   if origin_types
+00011a80: 5b27 6f72 6967 696e 5f69 735f 746f 7461  ['origin_is_tota
+00011a90: 6c27 5d20 3d3d 2031 2061 6e64 206f 7269  l'] == 1 and ori
+00011aa0: 6769 6e5f 7479 7065 735b 276f 7269 6769  gin_types['origi
+00011ab0: 6e5f 6973 5f69 6e63 7265 6d65 6e74 616c  n_is_incremental
+00011ac0: 275d 203d 3d20 3020 616e 6420 6f72 6967  '] == 0 and orig
+00011ad0: 696e 5f74 7970 6573 5b27 6f72 6967 696e  in_types['origin
+00011ae0: 5f69 735f 6364 6327 5d20 3d3d 2030 3a0d  _is_cdc'] == 0:.
+00011af0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00011b00: 5f65 6e74 6974 7920 3d20 5b70 7265 6669  _entity = [prefi
+00011b10: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00011b20: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00011b30: 312c 2073 6174 655f 656e 7469 7479 5f61  1, sate_entity_a
+00011b40: 6374 7561 6c5f 696d 6167 655f 312c 2045  ctual_image_1, E
+00011b50: 4e54 4954 595f 5749 5448 2c20 6476 5f65  NTITY_WITH, dv_e
+00011b60: 6e74 6974 792e 636f 645f 7061 7468 2c20  ntity.cod_path, 
+00011b70: 2727 2c20 7365 6c66 2e6f 776e 6572 5d0d  '', self.owner].
+00011b80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00011b90: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00011ba0: 6c2e 6164 645f 656e 7472 795f 656e 7469  l.add_entry_enti
+00011bb0: 7479 285b 6e65 775f 656e 7469 7479 5d29  ty([new_entity])
+00011bc0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00011bd0: 775f 656e 7469 7479 203d 205b 7072 6566  w_entity = [pref
+00011be0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00011bf0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+00011c00: 5f32 2c20 7361 7465 5f65 6e74 6974 795f  _2, sate_entity_
+00011c10: 6163 7475 616c 5f69 6d61 6765 5f32 2c20  actual_image_2, 
+00011c20: 454e 5449 5459 5f57 4954 482c 2064 765f  ENTITY_WITH, dv_
+00011c30: 656e 7469 7479 2e63 6f64 5f70 6174 682c  entity.cod_path,
+00011c40: 2027 272c 2073 656c 662e 6f77 6e65 725d   '', self.owner]
+00011c50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00011c60: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00011c70: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
+00011c80: 6974 7928 5b6e 6577 5f65 6e74 6974 795d  ity([new_entity]
+00011c90: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
+00011ca0: 6577 5f65 6e74 6974 7920 3d20 5b70 7265  ew_entity = [pre
+00011cb0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00011cc0: 7469 7479 5f75 6e69 6f6e 5f73 6f75 7263  tity_union_sourc
+00011cd0: 6573 2c20 7361 7465 5f65 6e74 6974 795f  es, sate_entity_
+00011ce0: 756e 696f 6e5f 736f 7572 6365 732c 2045  union_sources, E
+00011cf0: 4e54 4954 595f 5749 5448 2c20 6476 5f65  NTITY_WITH, dv_e
+00011d00: 6e74 6974 792e 636f 645f 7061 7468 2c20  ntity.cod_path, 
+00011d10: 2727 2c20 7365 6c66 2e6f 776e 6572 5d0d  '', self.owner].
+00011d20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00011d30: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00011d40: 6c2e 6164 645f 656e 7472 795f 656e 7469  l.add_entry_enti
+00011d50: 7479 285b 6e65 775f 656e 7469 7479 5d29  ty([new_entity])
+00011d60: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00011d70: 775f 656e 7469 7479 203d 205b 7072 6566  w_entity = [pref
+00011d80: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00011d90: 6974 795f 6a6f 696e 2c20 7361 7465 5f65  ity_join, sate_e
+00011da0: 6e74 6974 795f 6a6f 696e 2c20 454e 5449  ntity_join, ENTI
+00011db0: 5459 5f57 4954 482c 2064 765f 656e 7469  TY_WITH, dv_enti
+00011dc0: 7479 2e63 6f64 5f70 6174 682c 2027 272c  ty.cod_path, '',
+00011dd0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00011de0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00011df0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+00011e00: 6464 5f65 6e74 7279 5f65 6e74 6974 7928  dd_entry_entity(
+00011e10: 5b6e 6577 5f65 6e74 6974 795d 290d 0a20  [new_entity]).. 
+00011e20: 2020 2020 2020 2020 2020 206e 6577 5f65             new_e
+00011e30: 6e74 6974 7920 3d20 5b70 7265 6669 785f  ntity = [prefix_
+00011e40: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00011e50: 5f6c 6173 745f 696d 6167 652c 2073 6174  _last_image, sat
+00011e60: 655f 656e 7469 7479 5f6c 6173 745f 696d  e_entity_last_im
+00011e70: 6167 652c 2045 4e54 4954 595f 5749 5448  age, ENTITY_WITH
+00011e80: 2c20 6476 5f65 6e74 6974 792e 636f 645f  , dv_entity.cod_
+00011e90: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
+00011ea0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00011eb0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00011ec0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00011ed0: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
+00011ee0: 7469 7479 5d29 0d0a 2020 2020 2020 2020  tity])..        
+00011ef0: 2020 2020 6e65 775f 656e 7469 7479 203d      new_entity =
+00011f00: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00011f10: 7465 5f65 6e74 6974 792c 2073 6174 655f  te_entity, sate_
+00011f20: 656e 7469 7479 2c20 454e 5449 5459 5f54  entity, ENTITY_T
+00011f30: 422c 2064 765f 656e 7469 7479 2e63 6f64  B, dv_entity.cod
+00011f40: 5f70 6174 682c 2027 494e 5345 5254 272c  _path, 'INSERT',
+00011f50: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00011f60: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00011f70: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+00011f80: 6464 5f65 6e74 7279 5f65 6e74 6974 7928  dd_entry_entity(
+00011f90: 5b6e 6577 5f65 6e74 6974 795d 290d 0a0d  [new_entity])...
+00011fa0: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
+00011fb0: 5f72 7320 3d20 4661 6c73 650d 0a20 2020  _rs = False..   
+00011fc0: 2020 2020 2020 2020 2068 6173 5f74 6e20           has_tn 
+00011fd0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00011fe0: 2020 2020 2068 6173 5f61 6420 3d20 4661       has_ad = Fa
+00011ff0: 6c73 650d 0a0d 0a20 2020 2020 2020 2020  lse....         
+00012000: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00012010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012020: 2323 2323 2323 2323 2055 6e69 6f6e 2061  ######## Union a
+00012030: 6c6c 2073 6f75 7263 6573 2023 2323 2323  ll sources #####
+00012040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012060: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
+00012070: 6c5f 736f 7572 6365 7320 3d20 7365 6c66  l_sources = self
+00012080: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00012090: 2e67 6574 5f61 6c6c 5f63 6f64 5f65 6e74  .get_all_cod_ent
+000120a0: 6974 795f 736f 7572 6365 5f66 726f 6d5f  ity_source_from_
+000120b0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+000120c0: 745f 6f6e 5f65 6e74 7279 5f64 7628 636f  t_on_entry_dv(co
+000120d0: 645f 656e 7469 7479 5f74 6172 6765 7429  d_entity_target)
+000120e0: 0d0a 2020 2020 2020 2020 2020 2020 7465  ..            te
+000120f0: 6e61 6e74 5f73 6f75 7263 6520 3d20 7365  nant_source = se
+00012100: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00012110: 616c 2e67 6574 5f74 656e 616e 745f 6f6e  al.get_tenant_on
+00012120: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
+00012130: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
+00012140: 756d 5f62 7261 6e63 6828 636f 645f 656e  um_branch(cod_en
+00012150: 7469 7479 5f74 6172 6765 742c 2031 290d  tity_target, 1).
+00012160: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012170: 6c65 6e28 7465 6e61 6e74 5f73 6f75 7263  len(tenant_sourc
+00012180: 6529 2021 3d20 303a 2068 6173 5f74 6e20  e) != 0: has_tn 
+00012190: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+000121a0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+000121b0: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+000121c0: 615f 6163 7475 616c 2e67 6574 5f72 6563  a_actual.get_rec
+000121d0: 6f72 645f 736f 7572 6365 5f6f 6e5f 6476  ord_source_on_dv
+000121e0: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+000121f0: 5f74 6172 6765 745f 616e 645f 6e75 6d5f  _target_and_num_
+00012200: 6272 616e 6368 2863 6f64 5f65 6e74 6974  branch(cod_entit
+00012210: 795f 7461 7267 6574 2c20 3129 0d0a 2020  y_target, 1)..  
+00012220: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
+00012230: 6f72 645f 736f 7572 6365 2069 7320 6e6f  ord_source is no
+00012240: 7420 4e6f 6e65 3a20 6861 735f 7273 203d  t None: has_rs =
+00012250: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00012260: 2020 2061 7070 6c69 6564 5f64 6174 6520     applied_date 
+00012270: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00012280: 6163 7475 616c 2e67 6574 5f61 7070 6c69  actual.get_appli
+00012290: 6564 5f64 6174 655f 6f6e 5f64 765f 6672  ed_date_on_dv_fr
+000122a0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
+000122b0: 7267 6574 2864 765f 656e 7469 7479 2e63  rget(dv_entity.c
+000122c0: 6f64 5f65 6e74 6974 792c 2031 290d 0a20  od_entity, 1).. 
+000122d0: 2020 2020 2020 2020 2020 2069 6620 6170             if ap
+000122e0: 706c 6965 645f 6461 7465 2069 7320 6e6f  plied_date is no
+000122f0: 7420 4e6f 6e65 3a20 6861 735f 6164 203d  t None: has_ad =
+00012300: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
+00012310: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00012320: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
+00012330: 6e6e 6563 7469 6f6e 2e67 6574 5f68 6173  nnection.get_has
+00012340: 685f 666f 725f 6d65 7461 6461 7461 2829  h_for_metadata()
+00012350: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00012360: 6e75 6d5f 6272 616e 6368 6573 203d 2073  num_branches = s
+00012370: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00012380: 7561 6c2e 6765 745f 6e75 6d5f 6272 616e  ual.get_num_bran
+00012390: 6368 6573 5f6f 6e5f 656e 7472 795f 6476  ches_on_entry_dv
+000123a0: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+000123b0: 5f6e 616d 6528 6476 5f65 6e74 6974 792e  _name(dv_entity.
+000123c0: 636f 645f 656e 7469 7479 290d 0a0d 0a20  cod_entity).... 
+000123d0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+000123e0: 756d 5f62 7261 6e63 6820 696e 2072 616e  um_branch in ran
+000123f0: 6765 2831 2c20 6e75 6d5f 6272 616e 6368  ge(1, num_branch
+00012400: 6573 202b 2031 293a 0d0a 2020 2020 2020  es + 1):..      
+00012410: 2020 2020 2020 2020 2020 656e 7472 795f            entry_
+00012420: 6476 5f6d 6170 7069 6e67 5f62 6b20 3d20  dv_mapping_bk = 
+00012430: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00012440: 7475 616c 2e67 6574 5f61 6c6c 5f62 6b5f  tual.get_all_bk_
+00012450: 6672 6f6d 5f65 6e74 7279 5f64 765f 636f  from_entry_dv_co
+00012460: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
+00012470: 616e 645f 6e75 6d5f 6272 616e 6368 2864  and_num_branch(d
+00012480: 765f 656e 7469 7479 2e63 6f64 5f65 6e74  v_entity.cod_ent
+00012490: 6974 792c 206e 756d 5f62 7261 6e63 6829  ity, num_branch)
+000124a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000124b0: 2020 656e 7472 795f 6476 5f6d 6170 7069    entry_dv_mappi
+000124c0: 6e67 5f62 6b2e 736f 7274 286b 6579 3d6c  ng_bk.sort(key=l
+000124d0: 616d 6264 6120 783a 2078 2e6f 7264 696e  ambda x: x.ordin
+000124e0: 616c 5f70 6f73 6974 696f 6e29 0d0a 2020  al_position)..  
+000124f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00012500: 645f 656e 7469 7479 5f73 6f75 7263 6520  d_entity_source 
+00012510: 3d20 656e 7472 795f 6476 5f6d 6170 7069  = entry_dv_mappi
+00012520: 6e67 5f62 6b5b 305d 2e63 6f64 5f65 6e74  ng_bk[0].cod_ent
+00012530: 6974 795f 736f 7572 6365 0d0a 2020 2020  ity_source..    
+00012540: 2020 2020 2020 2020 2020 2020 6d64 355f              md5_
+00012550: 6675 6e63 7469 6f6e 203d 2073 656c 662e  function = self.
+00012560: 6765 745f 6861 7368 5f6b 6579 5f66 726f  get_hash_key_fro
+00012570: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
+00012580: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
+00012590: 6368 2863 6f64 5f65 6e74 6974 795f 7461  ch(cod_entity_ta
+000125a0: 7267 6574 2c20 6e75 6d5f 6272 616e 6368  rget, num_branch
+000125b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000125c0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+000125d0: 6170 7069 6e67 203d 205b 636f 645f 656e  apping = [cod_en
+000125e0: 7469 7479 5f73 6f75 7263 652c 206d 6435  tity_source, md5
+000125f0: 5f66 756e 6374 696f 6e2c 2070 7265 6669  _function, prefi
+00012600: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00012610: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+00012620: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00012630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012640: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+00012650: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+00012660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012670: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00012680: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+00012690: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+000126a0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+000126b0: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+000126c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126e0: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
+000126f0: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
+00012700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012720: 206e 756d 5f62 7261 6e63 682c 204b 4559   num_branch, KEY
+00012730: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+00012740: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00012750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012760: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00012770: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+00012780: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00012790: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+000127a0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+000127b0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+000127c0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+000127d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000127e0: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+000127f0: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
+00012800: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+00012810: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00012820: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00012830: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00012840: 6d61 7070 696e 6720 3d20 5b27 272c 2073  mapping = ['', s
+00012850: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
+00012860: 6574 5f73 7973 6461 7465 5f76 616c 7565  et_sysdate_value
+00012870: 2829 2c20 7072 6566 6978 5f65 7420 2b20  (), prefix_et + 
+00012880: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+00012890: 6e5f 736f 7572 6365 732c 0d0a 2020 2020  n_sources,..    
+000128a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128c0: 2020 2027 4441 5445 5f43 5245 4154 4544     'DATE_CREATED
+000128d0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+000128e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128f0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+00012900: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+00012910: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+00012920: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
+00012930: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+00012940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012960: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+00012970: 6f72 5f6d 6574 6164 6174 615b 325d 2c20  or_metadata[2], 
+00012980: 6e75 6d5f 6272 616e 6368 2c20 4e6f 6e65  num_branch, None
+00012990: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+000129a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000129b0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+000129c0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+000129d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+000129e0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+000129f0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+00012a00: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00012a10: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+00012a20: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00012a30: 2020 2069 6620 6861 735f 7273 3a0d 0a20     if has_rs:.. 
+00012a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a50: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00012a60: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+00012a70: 5f61 6374 7561 6c2e 6765 745f 7265 636f  _actual.get_reco
+00012a80: 7264 5f73 6f75 7263 655f 6f6e 5f64 765f  rd_source_on_dv_
+00012a90: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+00012aa0: 7461 7267 6574 5f61 6e64 5f6e 756d 5f62  target_and_num_b
+00012ab0: 7261 6e63 6828 2063 6f64 5f65 6e74 6974  ranch( cod_entit
+00012ac0: 795f 7461 7267 6574 2c20 6e75 6d5f 6272  y_target, num_br
+00012ad0: 616e 6368 290d 0a20 2020 2020 2020 2020  anch)..         
+00012ae0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+00012af0: 636f 7264 5f73 6f75 7263 6520 6973 206e  cord_source is n
+00012b00: 6f74 204e 6f6e 653a 2068 6173 5f72 7320  ot None: has_rs 
+00012b10: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00012b20: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00012b30: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00012b40: 3d20 5b63 6f64 5f65 6e74 6974 795f 736f  = [cod_entity_so
+00012b50: 7572 6365 2c20 7265 636f 7264 5f73 6f75  urce, record_sou
+00012b60: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00012b70: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
 00012b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ba0: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-00012bb0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00012bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ba0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00012bb0: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+00012bc0: 6e5f 736f 7572 6365 732c 0d0a 2020 2020  n_sources,..    
 00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012be0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-00012bf0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-00012c00: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00012c10: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
-00012c20: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00012be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bf0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00012c00: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+00012c10: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+00012c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c50: 2020 2074 6e2e 636f 6c75 6d6e 5f70 7265     tn.column_pre
-00012c60: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c40: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+00012c50: 6365 2e63 6f6c 756d 6e5f 7479 7065 5f74  ce.column_type_t
+00012c60: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
+00012c70: 6f73 6974 696f 6e2c 0d0a 2020 2020 2020  osition,..      
 00012c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c90: 2020 2020 2020 2020 6e75 6d5f 6272 616e          num_bran
-00012ca0: 6368 2c20 4b45 595f 5459 5045 5f54 454e  ch, KEY_TYPE_TEN
-00012cb0: 414e 542c 2031 2c20 7365 6c66 2e6f 776e  ANT, 1, self.own
-00012cc0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00012cd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012ce0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00012cf0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00012d00: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-00012d10: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00012d20: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
-00012d30: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00012d40: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00012d50: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
-00012d60: 2020 2020 2020 6966 2068 6173 5f61 643a        if has_ad:
-00012d70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012d80: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00012d90: 7465 203d 2073 656c 662e 6d65 7461 6461  te = self.metada
-00012da0: 7461 5f61 6374 7561 6c2e 6765 745f 6170  ta_actual.get_ap
-00012db0: 706c 6965 645f 6461 7465 5f6f 6e5f 6476  plied_date_on_dv
-00012dc0: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
-00012dd0: 5f74 6172 6765 7428 6476 5f65 6e74 6974  _target(dv_entit
-00012de0: 792e 636f 645f 656e 7469 7479 2c20 6e75  y.cod_entity, nu
-00012df0: 6d5f 6272 616e 6368 290d 0a20 2020 2020  m_branch)..     
-00012e00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00012e10: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00012e20: 6e67 203d 205b 636f 645f 656e 7469 7479  ng = [cod_entity
-00012e30: 5f73 6f75 7263 652c 2061 7070 6c69 6564  _source, applied
-00012e40: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
-00012e50: 655f 736f 7572 6365 2c0d 0a20 2020 2020  e_source,..     
-00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e80: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-00012e90: 2b20 7361 7465 5f65 6e74 6974 795f 756e  + sate_entity_un
-00012ea0: 696f 6e5f 736f 7572 6365 732c 0d0a 2020  ion_sources,..  
-00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00012ee0: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
-00012ef0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-00012f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ca0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+00012cb0: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
+00012cc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00012cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ce0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00012cf0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00012d00: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+00012d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d30: 2020 2020 2020 2020 2020 6e75 6d5f 6272            num_br
+00012d40: 616e 6368 2c20 4b45 595f 5459 5045 5f52  anch, KEY_TYPE_R
+00012d50: 4543 4f52 445f 534f 5552 4345 2c20 312c  ECORD_SOURCE, 1,
+00012d60: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d80: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00012d90: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+00012da0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012db0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00012dc0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00012dd0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00012de0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00012df0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+00012e00: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
+00012e10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012e20: 2020 2020 2020 2069 6620 6c65 6e28 7465         if len(te
+00012e30: 6e61 6e74 5f73 6f75 7263 6529 2021 3d20  nant_source) != 
+00012e40: 303a 2068 6173 5f74 6e20 3d20 5472 7565  0: has_tn = True
+00012e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012e60: 2020 2020 2020 7465 6e61 6e74 5f73 6f75        tenant_sou
+00012e70: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
+00012e80: 6174 615f 6163 7475 616c 2e67 6574 5f74  ata_actual.get_t
+00012e90: 656e 616e 745f 6f6e 5f64 765f 6672 6f6d  enant_on_dv_from
+00012ea0: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
+00012eb0: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
+00012ec0: 6828 636f 645f 656e 7469 7479 5f74 6172  h(cod_entity_tar
+00012ed0: 6765 742c 206e 756d 5f62 7261 6e63 6829  get, num_branch)
+00012ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012ef0: 2020 2020 2020 666f 7220 746e 2069 6e20        for tn in 
+00012f00: 7465 6e61 6e74 5f73 6f75 7263 653a 0d0a  tenant_source:..
 00012f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f20: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00012f30: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
-00012f40: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-00012f50: 6f73 6974 696f 6e2c 0d0a 2020 2020 2020  osition,..      
-00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f20: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00012f30: 7365 745f 6d61 7070 696e 6720 3d20 5b63  set_mapping = [c
+00012f40: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
+00012f50: 2c20 746e 2e63 6f6c 756d 6e5f 6e61 6d65  , tn.column_name
+00012f60: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
 00012f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f80: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00012f90: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00012fa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fc0: 2020 2020 2020 2020 2020 2020 2061 7070               app
-00012fd0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00012fe0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013010: 2020 2020 2020 2020 6e75 6d5f 6272 616e          num_bran
-00013020: 6368 2c20 4b45 595f 5459 5045 5f41 5050  ch, KEY_TYPE_APP
-00013030: 4c49 4544 5f44 4154 452c 2031 2c20 7365  LIED_DATE, 1, se
-00013040: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00013050: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00013060: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-00013070: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-00013080: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00013090: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-000130a0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-000130b0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-000130c0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-000130d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000130e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000130f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013100: 2323 2323 2320 4c41 5354 2049 4d41 4745  ##### LAST IMAGE
-00013110: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00013120: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00013130: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00013140: 2020 2020 696e 7465 6765 725f 666f 725f      integer_for_
-00013150: 6d65 7461 6461 7461 203d 2073 656c 662e  metadata = self.
-00013160: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f69  connection.get_i
-00013170: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
-00013180: 6174 6128 290d 0a20 2020 2020 2020 2020  ata()..         
-00013190: 2020 2023 204c 6173 7420 496d 6167 6520     # Last Image 
-000131a0: 310d 0a20 2020 2020 2020 2020 2020 206f  1..            o
-000131b0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-000131c0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-000131d0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-000131e0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-000131f0: 7420 2b20 7361 7465 5f65 6e74 6974 792c  t + sate_entity,
-00013200: 2068 6173 685f 6e61 6d65 2c20 7072 6566   hash_name, pref
-00013210: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00013220: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00013230: 5f31 2c0d 0a20 2020 2020 2020 2020 2020  _1,..           
-00013240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013250: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
-00013260: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00013270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013280: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
-00013290: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-000132a0: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
-000132b0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-000132c0: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
-000132d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132e0: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-000132f0: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
+00012f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f90: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00012fa0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00012fb0: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c0d  _union_sources,.
+00012fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ff0: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+00013000: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00013010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013030: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+00013040: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+00013050: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00013060: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
+00013070: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130a0: 2020 746e 2e63 6f6c 756d 6e5f 7072 6563    tn.column_prec
+000130b0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+000130c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130e0: 2020 2020 2020 206e 756d 5f62 7261 6e63         num_branc
+000130f0: 682c 204b 4559 5f54 5950 455f 5445 4e41  h, KEY_TYPE_TENA
+00013100: 4e54 2c20 312c 2073 656c 662e 6f77 6e65  NT, 1, self.owne
+00013110: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00013120: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00013130: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00013140: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00013150: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+00013160: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00013170: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00013180: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+00013190: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+000131a0: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
+000131b0: 2020 2020 2069 6620 6861 735f 6164 3a0d       if has_ad:.
+000131c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000131d0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+000131e0: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+000131f0: 615f 6163 7475 616c 2e67 6574 5f61 7070  a_actual.get_app
+00013200: 6c69 6564 5f64 6174 655f 6f6e 5f64 765f  lied_date_on_dv_
+00013210: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+00013220: 7461 7267 6574 2864 765f 656e 7469 7479  target(dv_entity
+00013230: 2e63 6f64 5f65 6e74 6974 792c 206e 756d  .cod_entity, num
+00013240: 5f62 7261 6e63 6829 0d0a 2020 2020 2020  _branch)..      
+00013250: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00013260: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00013270: 6720 3d20 5b63 6f64 5f65 6e74 6974 795f  g = [cod_entity_
+00013280: 736f 7572 6365 2c20 6170 706c 6965 645f  source, applied_
+00013290: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
+000132a0: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
+000132b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132d0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+000132e0: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
+000132f0: 6f6e 5f73 6f75 7263 6573 2c0d 0a20 2020  on_sources,..   
 00013300: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013320: 2020 2031 2c20 4b45 595f 5459 5045 5f48     1, KEY_TYPE_H
-00013330: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
-00013340: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00013350: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00013360: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00013370: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00013380: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00013390: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-000133a0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-000133b0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-000133c0: 0d0a 2020 2020 2020 2020 2020 2020 7379  ..            sy
-000133d0: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-000133e0: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-000133f0: 7469 6f6e 2e67 6574 5f73 7973 6461 7465  tion.get_sysdate
-00013400: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
-00013410: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00013420: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00013430: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00013440: 7361 7465 5f65 6e74 6974 792c 2027 4441  sate_entity, 'DA
-00013450: 5445 5f53 5441 5254 272c 2070 7265 6669  TE_START', prefi
-00013460: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00013470: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-00013480: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
-00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134a0: 2020 2020 2020 2027 4441 5445 5f53 5441         'DATE_STA
-000134b0: 5254 272c 0d0a 2020 2020 2020 2020 2020  RT',..          
-000134c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134d0: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
-000134e0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-000134f0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00013500: 6f6e 2c20 7379 7364 6174 655f 666f 725f  on, sysdate_for_
-00013510: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
-00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013540: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00013550: 6164 6174 615b 325d 2c20 312c 204e 6f6e  adata[2], 1, Non
-00013560: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
-00013570: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
-00013580: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00013590: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-000135a0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-000135b0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-000135c0: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-000135d0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-000135e0: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-000135f0: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-00013600: 666f 725f 6d65 7461 6461 7461 203d 2073  for_metadata = s
-00013610: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
-00013620: 6574 5f73 7973 6461 7465 5f66 6f72 5f6d  et_sysdate_for_m
-00013630: 6574 6164 6174 6128 290d 0a20 2020 2020  etadata()..     
-00013640: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00013650: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-00013660: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00013670: 6e74 6974 792c 2027 4441 5445 5f45 4e44  ntity, 'DATE_END
-00013680: 272c 2070 7265 6669 785f 6574 202b 2073  ', prefix_et + s
-00013690: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-000136a0: 6c5f 696d 6167 655f 312c 0d0a 2020 2020  l_image_1,..    
-000136b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000136d0: 4441 5445 5f45 4e44 272c 0d0a 2020 2020  DATE_END',..    
-000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013700: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-00013710: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00013720: 706f 7369 7469 6f6e 2c20 7379 7364 6174  position, sysdat
-00013730: 655f 666f 725f 6d65 7461 6461 7461 5b31  e_for_metadata[1
-00013740: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00013320: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+00013330: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
+00013340: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013370: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00013380: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
+00013390: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+000133a0: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
+000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133d0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+000133e0: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+000133f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013410: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+00013420: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00013430: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+00013440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013460: 2020 2020 2020 206e 756d 5f62 7261 6e63         num_branc
+00013470: 682c 204b 4559 5f54 5950 455f 4150 504c  h, KEY_TYPE_APPL
+00013480: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
+00013490: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000134a0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000134b0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+000134c0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+000134d0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+000134e0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+000134f0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00013500: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00013510: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+00013520: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+00013530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013550: 2323 2323 204c 4153 5420 494d 4147 4520  #### LAST IMAGE 
+00013560: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00013580: 2323 2323 230d 0a20 2020 2020 2020 2020  #####..         
+00013590: 2020 2069 6e74 6567 6572 5f66 6f72 5f6d     integer_for_m
+000135a0: 6574 6164 6174 6120 3d20 7365 6c66 2e63  etadata = self.c
+000135b0: 6f6e 6e65 6374 696f 6e2e 6765 745f 696e  onnection.get_in
+000135c0: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
+000135d0: 7461 2829 0d0a 2020 2020 2020 2020 2020  ta()..          
+000135e0: 2020 2320 4c61 7374 2049 6d61 6765 2031    # Last Image 1
+000135f0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+00013600: 6469 6e61 6c5f 706f 7369 7469 6f6e 203d  dinal_position =
+00013610: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00013620: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00013630: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00013640: 202b 2073 6174 655f 656e 7469 7479 2c20   + sate_entity, 
+00013650: 6861 7368 5f6e 616d 652c 2070 7265 6669  hash_name, prefi
+00013660: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00013670: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00013680: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00013690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136a0: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
+000136b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000136c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136d0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
+000136e0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+000136f0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
+00013700: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00013710: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+00013720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013730: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+00013740: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
 00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013760: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
-00013770: 6f72 5f6d 6574 6164 6174 615b 325d 2c20  or_metadata[2], 
-00013780: 312c 204e 6f6e 652c 2031 2c20 7365 6c66  1, None, 1, self
-00013790: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-000137a0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-000137b0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-000137c0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-000137d0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-000137e0: 745f 6d61 7070 696e 675d 290d 0a20 2020  t_mapping])..   
-000137f0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-00013800: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00013810: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00013820: 2068 6173 5f72 733a 0d0a 2020 2020 2020   has_rs:..      
-00013830: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00013840: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00013850: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00013860: 655f 656e 7469 7479 2c20 7265 636f 7264  e_entity, record
-00013870: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
-00013880: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00013890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138b0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-000138c0: 7361 7465 5f65 6e74 6974 795f 6163 7475  sate_entity_actu
-000138d0: 616c 5f69 6d61 6765 5f31 2c0d 0a20 2020  al_image_1,..   
+00013760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013770: 2020 312c 204b 4559 5f54 5950 455f 4841    1, KEY_TYPE_HA
+00013780: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
+00013790: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+000137a0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+000137b0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+000137c0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+000137d0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+000137e0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+000137f0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00013800: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00013810: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+00013820: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00013830: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+00013840: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
+00013850: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+00013860: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00013870: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00013880: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+00013890: 6174 655f 656e 7469 7479 2c20 2744 4154  ate_entity, 'DAT
+000138a0: 455f 5354 4152 5427 2c20 7072 6566 6978  E_START', prefix
+000138b0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+000138c0: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
+000138d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013900: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00013910: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-00013920: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013940: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013950: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00013960: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-00013970: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00013980: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-00013990: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139c0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-000139d0: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-000139e0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a00: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-00013a10: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
-00013a20: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
-00013a30: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00013a40: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00013a50: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00013a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013a70: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00013a80: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00013a90: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-00013aa0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00013ab0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-00013ac0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00013ad0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-00013ae0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00013af0: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
+000138f0: 2020 2020 2020 2744 4154 455f 5354 4152        'DATE_STAR
+00013900: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
+00013910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013920: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+00013930: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+00013940: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00013950: 6e2c 2073 7973 6461 7465 5f66 6f72 5f6d  n, sysdate_for_m
+00013960: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
+00013970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013990: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+000139a0: 6461 7461 5b32 5d2c 2031 2c20 4e6f 6e65  data[2], 1, None
+000139b0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+000139c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000139d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000139e0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+000139f0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00013a00: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00013a10: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+00013a20: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00013a30: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+00013a40: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+00013a50: 6f72 5f6d 6574 6164 6174 6120 3d20 7365  or_metadata = se
+00013a60: 6c66 2e63 6f6e 6e65 6374 696f 6e2e 6765  lf.connection.ge
+00013a70: 745f 7379 7364 6174 655f 666f 725f 6d65  t_sysdate_for_me
+00013a80: 7461 6461 7461 2829 0d0a 2020 2020 2020  tadata()..      
+00013a90: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00013aa0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+00013ab0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00013ac0: 7469 7479 2c20 2744 4154 455f 454e 4427  tity, 'DATE_END'
+00013ad0: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
+00013ae0: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+00013af0: 5f69 6d61 6765 5f31 2c0d 0a20 2020 2020  _image_1,..     
 00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b10: 2020 2020 2020 2020 2020 2027 524f 575f             'ROW_
-00013b20: 4e55 4d42 4552 2829 206f 7665 7220 2870  NUMBER() over (p
-00013b30: 6172 7469 7469 6f6e 2062 7920 2720 2b20  artition by ' + 
-00013b40: 6861 7368 5f6e 616d 6520 2b20 2720 4f52  hash_name + ' OR
-00013b50: 4445 5220 4259 2044 4154 455f 4352 4541  DER BY DATE_CREA
-00013b60: 5445 4420 6465 7363 2927 2c0d 0a20 2020  TED desc)',..   
-00013b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b90: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00013ba0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-00013bb0: 6d61 6765 5f31 2c20 2752 4e27 2c0d 0a20  mage_1, 'RN',.. 
-00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013be0: 2020 696e 7465 6765 725f 666f 725f 6d65    integer_for_me
-00013bf0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-00013c00: 616c 5f70 6f73 6974 696f 6e2c 2069 6e74  al_position, int
-00013c10: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
-00013c20: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
-00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c40: 2020 2020 2020 2020 2020 696e 7465 6765            intege
-00013c50: 725f 666f 725f 6d65 7461 6461 7461 5b32  r_for_metadata[2
-00013c60: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-00013c90: 5045 5f4e 554c 4c2c 2031 2c20 7365 6c66  PE_NULL, 1, self
-00013ca0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00013cb0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00013cc0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00013cd0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00013ce0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00013cf0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00013d00: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00013d10: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00013d20: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00013d30: 4c61 7374 2049 6d61 6765 2032 0d0a 2020  Last Image 2..  
-00013d40: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00013d50: 6c5f 706f 7369 7469 6f6e 203d 2031 0d0a  l_position = 1..
-00013d60: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00013d70: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00013d80: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00013d90: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-00013da0: 6c5f 696d 6167 655f 312c 2068 6173 685f  l_image_1, hash_
-00013db0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00013dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013dd0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00013de0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00013df0: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
-00013e00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e20: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
-00013e30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013b10: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00013b20: 4154 455f 454e 4427 2c0d 0a20 2020 2020  ATE_END',..     
+00013b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b40: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00013b50: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+00013b60: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00013b70: 6f73 6974 696f 6e2c 2073 7973 6461 7465  osition, sysdate
+00013b80: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+00013b90: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013bb0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
+00013bc0: 725f 6d65 7461 6461 7461 5b32 5d2c 2031  r_metadata[2], 1
+00013bd0: 2c20 4e6f 6e65 2c20 312c 2073 656c 662e  , None, 1, self.
+00013be0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00013bf0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00013c00: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00013c10: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00013c20: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00013c30: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
+00013c40: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00013c50: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+00013c60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013c70: 6861 735f 7273 3a0d 0a20 2020 2020 2020  has_rs:..       
+00013c80: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+00013c90: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00013ca0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+00013cb0: 5f65 6e74 6974 792c 2072 6563 6f72 645f  _entity, record_
+00013cc0: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
+00013cd0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00013ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d00: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+00013d10: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
+00013d20: 6c5f 696d 6167 655f 312c 0d0a 2020 2020  l_image_1,..    
+00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d50: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00013d60: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00013d70: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00013da0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+00013db0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+00013dc0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00013dd0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00013de0: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e10: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+00013e20: 7263 652e 636f 6c75 6d6e 5f70 7265 6369  rce.column_preci
+00013e30: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
 00013e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e50: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
-00013e60: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-00013e70: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
-00013e80: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
-00013e90: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00013ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013eb0: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
-00013ec0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
-00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ef0: 2031 2c20 4b45 595f 5459 5045 5f48 4153   1, KEY_TYPE_HAS
-00013f00: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
-00013f10: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00013f20: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00013f30: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00013f40: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00013f50: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00013f60: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-00013f70: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-00013f80: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-00013f90: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-00013fa0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-00013fb0: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
-00013fc0: 6f6e 2e67 6574 5f73 7973 6461 7465 5f66  on.get_sysdate_f
-00013fd0: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
-00013fe0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-00013ff0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-00014000: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00014010: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
-00014020: 5f69 6d61 6765 5f31 2c20 2744 4154 455f  _image_1, 'DATE_
-00014030: 5354 4152 5427 2c20 7072 6566 6978 5f65  START', prefix_e
-00014040: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00014050: 6163 7475 616c 5f69 6d61 6765 5f32 2c0d  actual_image_2,.
-00014060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014080: 2020 2020 2744 4154 455f 5354 4152 5427      'DATE_START'
-00014090: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000140a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140b0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-000140c0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-000140d0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-000140e0: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-000140f0: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-00014100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014110: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00014120: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00014130: 7461 5b32 5d2c 2031 2c20 4e6f 6e65 2c20  ta[2], 1, None, 
-00014140: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00014150: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014160: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00014170: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00014180: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00014190: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000141a0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000141b0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000141c0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-000141d0: 2020 2020 2069 6620 6861 735f 7273 3a0d       if has_rs:.
-000141e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000141f0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00014200: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00014210: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00014220: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
-00014230: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00014240: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-00014250: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013e50: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00013e60: 204b 4559 5f54 5950 455f 5245 434f 5244   KEY_TYPE_RECORD
+00013e70: 5f53 4f55 5243 452c 2031 2c20 7365 6c66  _SOURCE, 1, self
+00013e80: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00013e90: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+00013ea0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00013eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ec0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00013ed0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00013ee0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00013ef0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00013f00: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00013f10: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00013f20: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+00013f30: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00013f40: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
+00013f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f60: 2020 2020 2020 2020 2020 2752 4f57 5f4e            'ROW_N
+00013f70: 554d 4245 5228 2920 6f76 6572 2028 7061  UMBER() over (pa
+00013f80: 7274 6974 696f 6e20 6279 2027 202b 2068  rtition by ' + h
+00013f90: 6173 685f 6e61 6d65 202b 2027 204f 5244  ash_name + ' ORD
+00013fa0: 4552 2042 5920 4441 5445 5f43 5245 4154  ER BY DATE_CREAT
+00013fb0: 4544 2064 6573 6329 272c 0d0a 2020 2020  ED desc)',..    
+00013fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013fe0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00013ff0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+00014000: 6167 655f 312c 2027 524e 272c 0d0a 2020  age_1, 'RN',..  
+00014010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014030: 2069 6e74 6567 6572 5f66 6f72 5f6d 6574   integer_for_met
+00014040: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+00014050: 6c5f 706f 7369 7469 6f6e 2c20 696e 7465  l_position, inte
+00014060: 6765 725f 666f 725f 6d65 7461 6461 7461  ger_for_metadata
+00014070: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
+00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014090: 2020 2020 2020 2020 2069 6e74 6567 6572           integer
+000140a0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+000140b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000140c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140d0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+000140e0: 455f 4e55 4c4c 2c20 312c 2073 656c 662e  E_NULL, 1, self.
+000140f0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00014100: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00014110: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+00014120: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00014130: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00014140: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00014150: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00014160: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00014170: 0a20 2020 2020 2020 2020 2020 2023 204c  .            # L
+00014180: 6173 7420 496d 6167 6520 320d 0a20 2020  ast Image 2..   
+00014190: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+000141a0: 5f70 6f73 6974 696f 6e20 3d20 310d 0a20  _position = 1.. 
+000141b0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+000141c0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+000141d0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+000141e0: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+000141f0: 5f69 6d61 6765 5f31 2c20 6861 7368 5f6e  _image_1, hash_n
+00014200: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+00014210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014220: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00014230: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00014240: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
+00014250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014270: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00014280: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00014290: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
-000142a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000142b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142c0: 2020 2020 2020 2020 2020 7265 636f 7264            record
-000142d0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
-000142e0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00014270: 2020 2020 2068 6173 685f 6e61 6d65 2c0d       hash_name,.
+00014280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142a0: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
+000142b0: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+000142c0: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
+000142d0: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+000142e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014310: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00014320: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00014330: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00014340: 7369 7469 6f6e 2c20 7265 636f 7264 5f73  sition, record_s
-00014350: 6f75 7263 652e 636f 6c75 6d6e 5f6c 656e  ource.column_len
-00014360: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014380: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-00014390: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-000143a0: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143d0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-000143e0: 5f52 4543 4f52 445f 534f 5552 4345 2c20  _RECORD_SOURCE, 
-000143f0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00014420: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-00014430: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00014440: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00014450: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00014460: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00014470: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00014480: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00014490: 5f66 696c 7465 7220 3d20 5b70 7265 6669  _filter = [prefi
-000144a0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-000144b0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-000144c0: 322c 2027 524e 203d 2031 2061 6e64 2044  2, 'RN = 1 and D
-000144d0: 4154 455f 454e 4420 3d27 202b 2073 656c  ATE_END =' + sel
-000144e0: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
-000144f0: 5f73 7973 6461 7465 5f76 616c 7565 5f69  _sysdate_value_i
-00014500: 6e66 696e 6974 6528 292c 2031 2c20 7365  nfinite(), 1, se
-00014510: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00014520: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00014530: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00014540: 656e 7472 795f 6669 6c74 6572 7328 5b6e  entry_filters([n
-00014550: 6577 5f66 696c 7465 725d 290d 0a0d 0a20  ew_filter]).... 
-00014560: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-00014570: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014580: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00014590: 204a 4f49 4e20 2323 2323 2323 2323 2323   JOIN ##########
-000145a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000145b0: 2323 2323 2323 2323 2323 230d 0a0d 0a20  ###########.... 
-000145c0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-000145d0: 616c 5f70 6f73 6974 696f 6e20 3d20 310d  al_position = 1.
-000145e0: 0a0d 0a20 2020 2020 2020 2020 2020 206e  ...            n
-000145f0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00014600: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00014610: 2b20 7361 7465 5f65 6e74 6974 795f 756e  + sate_entity_un
-00014620: 696f 6e5f 736f 7572 6365 732c 2068 6173  ion_sources, has
-00014630: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
-00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014650: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00014660: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00014670: 6974 795f 6a6f 696e 2c20 6861 7368 5f6e  ity_join, hash_n
-00014680: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-00014690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146a0: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-000146b0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-000146c0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-000146d0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-000146e0: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
-000146f0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+00014300: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
+00014310: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+00014320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014340: 312c 204b 4559 5f54 5950 455f 4841 5348  1, KEY_TYPE_HASH
+00014350: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
+00014360: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00014370: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00014380: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+00014390: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000143a0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+000143b0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+000143c0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+000143d0: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+000143e0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+000143f0: 7465 5f66 6f72 5f6d 6574 6164 6174 6120  te_for_metadata 
+00014400: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
+00014410: 6e2e 6765 745f 7379 7364 6174 655f 666f  n.get_sysdate_fo
+00014420: 725f 6d65 7461 6461 7461 2829 0d0a 2020  r_metadata()..  
+00014430: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00014440: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00014450: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00014460: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
+00014470: 696d 6167 655f 312c 2027 4441 5445 5f53  image_1, 'DATE_S
+00014480: 5441 5254 272c 2070 7265 6669 785f 6574  TART', prefix_et
+00014490: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
+000144a0: 6374 7561 6c5f 696d 6167 655f 322c 0d0a  ctual_image_2,..
+000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144d0: 2020 2027 4441 5445 5f53 5441 5254 272c     'DATE_START',
+000144e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000144f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014500: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+00014510: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00014520: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00014530: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00014540: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014560: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00014570: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00014580: 615b 325d 2c20 312c 204e 6f6e 652c 2031  a[2], 1, None, 1
+00014590: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000145a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000145b0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000145c0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+000145d0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+000145e0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+000145f0: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+00014600: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00014610: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+00014620: 2020 2020 6966 2068 6173 5f72 733a 0d0a      if has_rs:..
+00014630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014640: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00014650: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00014660: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
+00014670: 6374 7561 6c5f 696d 6167 655f 312c 2072  ctual_image_1, r
+00014680: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00014690: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+000146a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000146b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146c0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+000146d0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+000146e0: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
+000146f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00014700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014720: 2031 2c20 4b45 595f 5459 5045 5f48 4153   1, KEY_TYPE_HAS
-00014730: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
-00014740: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00014750: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00014760: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00014770: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00014780: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00014790: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-000147a0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-000147b0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-000147c0: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-000147d0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-000147e0: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
-000147f0: 6f6e 2e67 6574 5f73 7973 6461 7465 5f66  on.get_sysdate_f
-00014800: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
-00014810: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-00014820: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-00014830: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00014840: 7465 5f65 6e74 6974 795f 756e 696f 6e5f  te_entity_union_
-00014850: 736f 7572 6365 732c 2027 4441 5445 5f43  sources, 'DATE_C
-00014860: 5245 4154 4544 272c 0d0a 2020 2020 2020  REATED',..      
-00014870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014880: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00014890: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-000148a0: 7469 7479 5f6a 6f69 6e2c 2027 4441 5445  tity_join, 'DATE
-000148b0: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
-000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000148e0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-000148f0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00014900: 706f 7369 7469 6f6e 2c20 7379 7364 6174  position, sysdat
-00014910: 655f 666f 725f 6d65 7461 6461 7461 5b31  e_for_metadata[1
-00014920: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
-00014950: 6f72 5f6d 6574 6164 6174 615b 325d 2c20  or_metadata[2], 
-00014960: 312c 204e 6f6e 652c 2031 2c20 7365 6c66  1, None, 1, self
-00014970: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00014980: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00014990: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-000149a0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-000149b0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-000149c0: 745f 6d61 7070 696e 675d 290d 0a20 2020  t_mapping])..   
-000149d0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-000149e0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000149f0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-00014a00: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00014a10: 6720 3d20 5b27 272c 2073 656c 662e 636f  g = ['', self.co
-00014a20: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-00014a30: 6461 7465 5f76 616c 7565 2829 2c0d 0a20  date_value(),.. 
-00014a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a60: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-00014a70: 7465 5f65 6e74 6974 795f 6a6f 696e 2c20  te_entity_join, 
-00014a80: 2744 4154 455f 5354 4152 5427 2c0d 0a20  'DATE_START',.. 
+00014710: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+00014720: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
+00014730: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014760: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00014770: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00014780: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00014790: 6974 696f 6e2c 2072 6563 6f72 645f 736f  ition, record_so
+000147a0: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+000147b0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147d0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+000147e0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+000147f0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+00014800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014820: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+00014830: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
+00014840: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00014850: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00014860: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00014870: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00014880: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00014890: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+000148a0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+000148b0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+000148c0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+000148d0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000148e0: 6669 6c74 6572 203d 205b 7072 6566 6978  filter = [prefix
+000148f0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00014900: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+00014910: 2c20 2752 4e20 3d20 3120 616e 6420 4441  , 'RN = 1 and DA
+00014920: 5445 5f45 4e44 203d 2720 2b20 7365 6c66  TE_END =' + self
+00014930: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
+00014940: 7379 7364 6174 655f 7661 6c75 655f 696e  sysdate_value_in
+00014950: 6669 6e69 7465 2829 2c20 312c 2073 656c  finite(), 1, sel
+00014960: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00014970: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00014980: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00014990: 6e74 7279 5f66 696c 7465 7273 285b 6e65  ntry_filters([ne
+000149a0: 775f 6669 6c74 6572 5d29 0d0a 0d0a 2020  w_filter])....  
+000149b0: 2020 2020 2020 2020 2020 2323 2323 2323            ######
+000149c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000149d0: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+000149e0: 4a4f 494e 2023 2323 2323 2323 2323 2323  JOIN ###########
+000149f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00014a00: 2323 2323 2323 2323 2323 0d0a 0d0a 2020  ##########....  
+00014a10: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00014a20: 6c5f 706f 7369 7469 6f6e 203d 2031 0d0a  l_position = 1..
+00014a30: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00014a40: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00014a50: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+00014a60: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
+00014a70: 6f6e 5f73 6f75 7263 6573 2c20 6861 7368  on_sources, hash
+00014a80: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
 00014a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ab0: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-00014ac0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-00014ad0: 616c 5f70 6f73 6974 696f 6e2c 2073 7973  al_position, sys
-00014ae0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00014af0: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
-00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b10: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-00014b20: 655f 666f 725f 6d65 7461 6461 7461 5b32  e_for_metadata[2
-00014b30: 5d2c 2031 2c20 4e6f 6e65 2c20 312c 2073  ], 1, None, 1, s
-00014b40: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00014b50: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00014b60: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00014b70: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00014b80: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00014b90: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00014ba0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00014bb0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00014bc0: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
-00014bd0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00014be0: 7069 6e67 203d 205b 2727 2c20 7365 6c66  ping = ['', self
-00014bf0: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-00014c00: 7379 7364 6174 655f 7661 6c75 655f 696e  sysdate_value_in
-00014c10: 6669 6e69 7465 2829 2c0d 0a20 2020 2020  finite(),..     
-00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00014c40: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00014c50: 6e74 6974 795f 6a6f 696e 2c20 2744 4154  ntity_join, 'DAT
-00014c60: 455f 454e 4427 2c0d 0a20 2020 2020 2020  E_END',..       
-00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c80: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-00014c90: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-00014ca0: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-00014cb0: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
-00014cc0: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-00014cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cf0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-00014d00: 6d65 7461 6461 7461 5b32 5d2c 2031 2c20  metadata[2], 1, 
-00014d10: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
-00014d20: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00014d30: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00014d40: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00014d50: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00014d60: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00014d70: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-00014d80: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00014d90: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a0d  sition += 1.....
-00014da0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00014db0: 6861 735f 7273 3a0d 0a20 2020 2020 2020  has_rs:..       
-00014dc0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-00014dd0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00014de0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00014df0: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-00014e00: 7572 6365 732c 2072 6563 6f72 645f 736f  urces, record_so
-00014e10: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-00014e20: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-00014e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e50: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-00014e60: 655f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  e_entity_join,..
-00014e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e90: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-00014ea0: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-00014eb0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-00014ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ee0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-00014ef0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00014f00: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00014f10: 696f 6e2c 2072 6563 6f72 645f 736f 7572  ion, record_sour
-00014f20: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
-00014f30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f50: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00014f60: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f70  _source.column_p
-00014f70: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014fa0: 2020 312c 204b 4559 5f54 5950 455f 5245    1, KEY_TYPE_RE
-00014fb0: 434f 5244 5f53 4f55 5243 452c 2031 2c20  CORD_SOURCE, 1, 
-00014fc0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00014fd0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00014fe0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00014ff0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-00015000: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00015010: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00015020: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00015030: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00015040: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 0d0a  _mapping])......
-00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015060: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00015070: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-00015080: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
-00015090: 6374 7561 6c5f 696d 6167 655f 322c 2072  ctual_image_2, r
-000150a0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-000150b0: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-000150c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000150d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150e0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-000150f0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-00015100: 5f6a 6f69 6e2c 0d0a 2020 2020 2020 2020  _join,..        
-00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015120: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00015130: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-00015140: 756d 6e5f 6e61 6d65 5f74 6172 6765 7420  umn_name_target 
-00015150: 2b20 225f 4849 5354 222c 0d0a 2020 2020  + "_HIST",..    
-00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-00015190: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-000151a0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-000151b0: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
-000151c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000151e0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-000151f0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015220: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00015230: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-00015240: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015260: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-00015270: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-00015280: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-00015290: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-000152a0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-000152b0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-000152c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000152d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-000152e0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-000152f0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00015300: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00015310: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00015320: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
-00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015340: 666f 7220 746e 2069 6e20 7465 6e61 6e74  for tn in tenant
-00015350: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
-00015360: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00015370: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00015380: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-00015390: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-000153a0: 6f6e 5f73 6f75 7263 6573 2c20 746e 2e63  on_sources, tn.c
-000153b0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-000153c0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00014aa0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00014ab0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00014ac0: 7479 5f6a 6f69 6e2c 2068 6173 685f 6e61  ty_join, hash_na
+00014ad0: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
+00014ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014af0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+00014b00: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00014b10: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00014b20: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00014b30: 615b 315d 2c20 6861 7368 5f66 6f72 5f6d  a[1], hash_for_m
+00014b40: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b70: 312c 204b 4559 5f54 5950 455f 4841 5348  1, KEY_TYPE_HASH
+00014b80: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
+00014b90: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00014ba0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00014bb0: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+00014bc0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+00014bd0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+00014be0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+00014bf0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+00014c00: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+00014c10: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+00014c20: 7465 5f66 6f72 5f6d 6574 6164 6174 6120  te_for_metadata 
+00014c30: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
+00014c40: 6e2e 6765 745f 7379 7364 6174 655f 666f  n.get_sysdate_fo
+00014c50: 725f 6d65 7461 6461 7461 2829 0d0a 2020  r_metadata()..  
+00014c60: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00014c70: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00014c80: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00014c90: 655f 656e 7469 7479 5f75 6e69 6f6e 5f73  e_entity_union_s
+00014ca0: 6f75 7263 6573 2c20 2744 4154 455f 4352  ources, 'DATE_CR
+00014cb0: 4541 5445 4427 2c0d 0a20 2020 2020 2020  EATED',..       
+00014cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cd0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00014ce0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00014cf0: 6974 795f 6a6f 696e 2c20 2744 4154 455f  ity_join, 'DATE_
+00014d00: 4352 4541 5445 4427 2c0d 0a20 2020 2020  CREATED',..     
+00014d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d20: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00014d30: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+00014d40: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00014d50: 6f73 6974 696f 6e2c 2073 7973 6461 7465  osition, sysdate
+00014d60: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+00014d70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d90: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
+00014da0: 725f 6d65 7461 6461 7461 5b32 5d2c 2031  r_metadata[2], 1
+00014db0: 2c20 4e6f 6e65 2c20 312c 2073 656c 662e  , None, 1, self.
+00014dc0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00014dd0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00014de0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00014df0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00014e00: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00014e10: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
+00014e20: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00014e30: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+00014e40: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00014e50: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00014e60: 203d 205b 2727 2c20 7365 6c66 2e63 6f6e   = ['', self.con
+00014e70: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+00014e80: 6174 655f 7661 6c75 6528 292c 0d0a 2020  ate_value(),..  
+00014e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014eb0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00014ec0: 655f 656e 7469 7479 5f6a 6f69 6e2c 2027  e_entity_join, '
+00014ed0: 4441 5445 5f53 5441 5254 272c 0d0a 2020  DATE_START',..  
+00014ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f00: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00014f10: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+00014f20: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
+00014f30: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00014f40: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
+00014f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f60: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+00014f70: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00014f80: 2c20 312c 204e 6f6e 652c 2031 2c20 7365  , 1, None, 1, se
+00014f90: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00014fa0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00014fb0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00014fc0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00014fd0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00014fe0: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00014ff0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00015000: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00015010: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00015020: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00015030: 696e 6720 3d20 5b27 272c 2073 656c 662e  ing = ['', self.
+00015040: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+00015050: 7973 6461 7465 5f76 616c 7565 5f69 6e66  ysdate_value_inf
+00015060: 696e 6974 6528 292c 0d0a 2020 2020 2020  inite(),..      
+00015070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015080: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00015090: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+000150a0: 7469 7479 5f6a 6f69 6e2c 2027 4441 5445  tity_join, 'DATE
+000150b0: 5f45 4e44 272c 0d0a 2020 2020 2020 2020  _END',..        
+000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150d0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+000150e0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+000150f0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+00015100: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
+00015110: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+00015120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015140: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+00015150: 6574 6164 6174 615b 325d 2c20 312c 204e  etadata[2], 1, N
+00015160: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
+00015170: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00015180: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00015190: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+000151a0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+000151b0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+000151c0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+000151d0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+000151e0: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 0d0a  ition += 1......
+000151f0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00015200: 6173 5f72 733a 0d0a 2020 2020 2020 2020  as_rs:..        
+00015210: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00015220: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00015230: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00015240: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+00015250: 7263 6573 2c20 7265 636f 7264 5f73 6f75  rces, record_sou
+00015260: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00015270: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00015280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152a0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+000152b0: 5f65 6e74 6974 795f 6a6f 696e 2c0d 0a20  _entity_join,.. 
+000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+000152f0: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00015300: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00015310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015330: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+00015340: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+00015350: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00015360: 6f6e 2c20 7265 636f 7264 5f73 6f75 7263  on, record_sourc
+00015370: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
+00015380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153a0: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+000153b0: 736f 7572 6365 2e63 6f6c 756d 6e5f 7072  source.column_pr
+000153c0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
 000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000153f0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-00015400: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
-00015410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015430: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-00015440: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00015450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015470: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-00015480: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00015490: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-000154a0: 696f 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c  ion, tn.column_l
-000154b0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-000154c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154e0: 2020 2074 6e2e 636f 6c75 6d6e 5f70 7265     tn.column_pre
-000154f0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015520: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-00015530: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
-00015540: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00015550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015560: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00015570: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00015580: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00015590: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000155a0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000155b0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-000155c0: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-000155d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000155e0: 6861 735f 6164 3a0d 0a20 2020 2020 2020  has_ad:..       
-000155f0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-00015600: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00015610: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00015620: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-00015630: 7572 6365 732c 2061 7070 6c69 6564 5f64  urces, applied_d
-00015640: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-00015650: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+000153e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153f0: 2031 2c20 4b45 595f 5459 5045 5f52 4543   1, KEY_TYPE_REC
+00015400: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
+00015410: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00015420: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+00015430: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00015440: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+00015450: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00015460: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00015470: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00015480: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00015490: 6d61 7070 696e 675d 290d 0a0d 0a0d 0a20  mapping])...... 
+000154a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000154b0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+000154c0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+000154d0: 2b20 7361 7465 5f65 6e74 6974 795f 6163  + sate_entity_ac
+000154e0: 7475 616c 5f69 6d61 6765 5f32 2c20 7265  tual_image_2, re
+000154f0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00015500: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+00015510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015530: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00015540: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+00015550: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
+00015560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015570: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00015580: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00015590: 6d6e 5f6e 616d 655f 7461 7267 6574 202b  mn_name_target +
+000155a0: 2022 5f48 4953 5422 2c0d 0a20 2020 2020   "_HIST",..     
+000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155d0: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
+000155e0: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+000155f0: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+00015600: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
+00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015620: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00015630: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00015640: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+00015650: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015680: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00015690: 5f65 6e74 6974 795f 6a6f 696e 2c0d 0a20  _entity_join,.. 
+00015670: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00015680: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+00015690: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
 000156a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156c0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-000156d0: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
-000156e0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-000156f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015700: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015710: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-00015720: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-00015730: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00015740: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
-00015750: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015780: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00015790: 7465 2e63 6f6c 756d 6e5f 7072 6563 6973  te.column_precis
-000157a0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-000157b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157c0: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
-000157d0: 4b45 595f 5459 5045 5f41 5050 4c49 4544  KEY_TYPE_APPLIED
-000157e0: 5f44 4154 452c 2031 2c20 7365 6c66 2e6f  _DATE, 1, self.o
-000157f0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00015800: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00015810: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00015820: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00015830: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00015840: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00015850: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00015860: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00015870: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00015880: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00015890: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-000158a0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-000158b0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-000158c0: 322c 2068 6173 685f 6e61 6d65 2c20 7072  2, hash_name, pr
-000158d0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-000158e0: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
-000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015910: 6861 7368 5f6e 616d 6520 2b20 275f 4849  hash_name + '_HI
-00015920: 5354 272c 0d0a 2020 2020 2020 2020 2020  ST',..          
-00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015940: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-00015950: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-00015960: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00015970: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-00015980: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
-00015990: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
-000159a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159c0: 2031 2c20 4b45 595f 5459 5045 5f48 4153   1, KEY_TYPE_HAS
-000159d0: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
-000159e0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-000159f0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00015a00: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00015a10: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00015a20: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00015a30: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-00015a40: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-00015a50: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-00015a60: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00015a70: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00015a80: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00015a90: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-00015aa0: 6c5f 696d 6167 655f 322c 2027 4441 5445  l_image_2, 'DATE
-00015ab0: 5f53 5441 5254 272c 2070 7265 6669 785f  _START', prefix_
-00015ac0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-00015ad0: 5f6a 6f69 6e2c 0d0a 2020 2020 2020 2020  _join,..        
-00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015af0: 2020 2020 2020 2020 2020 2027 4441 5445             'DATE
-00015b00: 5f53 5441 5254 5f48 4953 5427 2c0d 0a20  _START_HIST',.. 
-00015b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b30: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-00015b40: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00015b50: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-00015b60: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-00015b70: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-00015b80: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-00015b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ba0: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
-00015bb0: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00015bc0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00015bd0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00015be0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00015bf0: 310d 0a20 2020 2020 2020 2020 2020 2073  1..            s
-00015c00: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00015c10: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-00015c20: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00015c30: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00015c40: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
-00015c50: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00015c60: 2323 2323 2323 2323 2323 2323 2043 6173  ############ Cas
-00015c70: 6520 666f 7220 4461 7461 6261 7365 7320  e for Databases 
-00015c80: 7468 6174 2064 6f65 736e 2774 2068 6176  that doesn't hav
-00015c90: 6520 4f55 5445 5220 4a4f 494e 2023 2323  e OUTER JOIN ###
-00015ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015cb0: 2323 2323 0d0a 2020 2020 2020 2020 2020  ####..          
-00015cc0: 2020 6966 2073 656c 662e 636f 6e6e 6563    if self.connec
-00015cd0: 7469 6f6e 2e67 6574 5f63 6f6e 6e65 6374  tion.get_connect
-00015ce0: 696f 6e5f 7479 7065 2829 2069 6e20 434f  ion_type() in CO
-00015cf0: 4e4e 4543 5449 4f4e 535f 5749 5448 4f55  NNECTIONS_WITHOU
-00015d00: 545f 4f55 5445 525f 4a4f 494e 3a0d 0a0d  T_OUTER_JOIN:...
-00015d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015d20: 206e 6577 5f72 656c 6174 696f 6e73 6869   new_relationshi
-00015d30: 7020 3d20 5b70 7265 6669 785f 6574 202b  p = [prefix_et +
-00015d40: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-00015d50: 6f6e 5f73 6f75 7263 6573 2c20 6861 7368  on_sources, hash
-00015d60: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-00015d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d80: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00015d90: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00015da0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00015db0: 5f32 2c0d 0a20 2020 2020 2020 2020 2020  _2,..           
-00015dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015dd0: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
-00015de0: 6d65 2c20 224d 4153 5445 5220 4a4f 494e  me, "MASTER JOIN
-00015df0: 222c 2073 656c 662e 6f77 6e65 725d 0d0a  ", self.owner]..
+000156b0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+000156c0: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+000156d0: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+000156e0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+000156f0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00015700: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00015710: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015720: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00015730: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00015740: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00015750: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00015760: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+00015770: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+00015780: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015790: 6f72 2074 6e20 696e 2074 656e 616e 745f  or tn in tenant_
+000157a0: 736f 7572 6365 3a0d 0a20 2020 2020 2020  source:..       
+000157b0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+000157c0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+000157d0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+000157e0: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+000157f0: 6e5f 736f 7572 6365 732c 2074 6e2e 636f  n_sources, tn.co
+00015800: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00015810: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00015820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015830: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00015840: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00015850: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+00015860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015880: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+00015890: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158c0: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+000158d0: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+000158e0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+000158f0: 6f6e 2c20 746e 2e63 6f6c 756d 6e5f 6c65  on, tn.column_le
+00015900: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
+00015910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015930: 2020 746e 2e63 6f6c 756d 6e5f 7072 6563    tn.column_prec
+00015940: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015970: 2020 2031 2c20 4b45 595f 5459 5045 5f54     1, KEY_TYPE_T
+00015980: 454e 414e 542c 2031 2c20 7365 6c66 2e6f  ENANT, 1, self.o
+00015990: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+000159a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000159b0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000159c0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+000159d0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+000159e0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+000159f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00015a00: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00015a10: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00015a20: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00015a30: 6173 5f61 643a 0d0a 2020 2020 2020 2020  as_ad:..        
+00015a40: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00015a50: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00015a60: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00015a70: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+00015a80: 7263 6573 2c20 6170 706c 6965 645f 6461  rces, applied_da
+00015a90: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
+00015aa0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00015ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ac0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00015ad0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00015ae0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+00015af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b10: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00015b20: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+00015b30: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+00015b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b50: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+00015b60: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
+00015b70: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+00015b80: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00015b90: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+00015ba0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bd0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00015be0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+00015bf0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00015c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c10: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+00015c20: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
+00015c30: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
+00015c40: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00015c50: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00015c60: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00015c70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015c80: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00015c90: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00015ca0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00015cb0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00015cc0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+00015cd0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00015ce0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+00015cf0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00015d00: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+00015d10: 2c20 6861 7368 5f6e 616d 652c 2070 7265  , hash_name, pre
+00015d20: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00015d30: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
+00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d50: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00015d60: 6173 685f 6e61 6d65 202b 2027 5f48 4953  ash_name + '_HIS
+00015d70: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
+00015d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d90: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+00015da0: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00015db0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00015dc0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00015dd0: 615b 315d 2c20 6861 7368 5f66 6f72 5f6d  a[1], hash_for_m
+00015de0: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e10: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00015e20: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-00015e30: 6174 6173 6574 5f72 656c 6174 696f 6e73  ataset_relations
-00015e40: 6869 7028 5b6e 6577 5f72 656c 6174 696f  hip([new_relatio
-00015e50: 6e73 6869 705d 290d 0a0d 0a20 2020 2020  nship])....     
-00015e60: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-00015e70: 2047 6574 2061 6e6f 7468 6572 2055 4e49   Get another UNI
-00015e80: 4f4e 2053 5453 2074 6f20 7365 7420 6e65  ON STS to set ne
-00015e90: 7720 7265 6c61 7469 6f6e 7368 6970 0d0a  w relationship..
-00015ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015eb0: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
-00015ec0: 6e5f 736f 7572 6365 735f 3220 3d20 2753  n_sources_2 = 'S
-00015ed0: 5447 5f54 4d50 5f55 4e49 4f4e 5f32 5f27  TG_TMP_UNION_2_'
-00015ee0: 202b 2073 6174 655f 6e61 6d65 0d0a 2020   + sate_name..  
-00015ef0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00015f00: 775f 656e 7469 7479 5f73 7473 5f65 6e74  w_entity_sts_ent
-00015f10: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-00015f20: 7320 3d20 5b70 7265 6669 785f 6574 202b  s = [prefix_et +
-00015f30: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-00015f40: 6f6e 5f73 6f75 7263 6573 5f32 2c0d 0a20  on_sources_2,.. 
-00015f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e10: 312c 204b 4559 5f54 5950 455f 4841 5348  1, KEY_TYPE_HASH
+00015e20: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
+00015e30: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00015e40: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00015e50: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+00015e60: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+00015e70: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+00015e80: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+00015e90: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+00015ea0: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+00015eb0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00015ec0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00015ed0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00015ee0: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+00015ef0: 5f69 6d61 6765 5f32 2c20 2744 4154 455f  _image_2, 'DATE_
+00015f00: 5354 4152 5427 2c20 7072 6566 6978 5f65  START', prefix_e
+00015f10: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+00015f20: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
+00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f40: 2020 2020 2020 2020 2020 2744 4154 455f            'DATE_
+00015f50: 5354 4152 545f 4849 5354 272c 0d0a 2020  START_HIST',..  
 00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f80: 2020 2020 2020 7361 7465 5f65 6e74 6974        sate_entit
-00015f90: 795f 756e 696f 6e5f 736f 7572 6365 735f  y_union_sources_
-00015fa0: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
-00015fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fd0: 2020 2020 2020 2020 2020 2045 4e54 4954             ENTIT
-00015fe0: 595f 5749 5448 2c20 6476 5f65 6e74 6974  Y_WITH, dv_entit
-00015ff0: 792e 636f 645f 7061 7468 2c20 2727 2c20  y.cod_path, '', 
-00016000: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00016010: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00016020: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00016030: 6c2e 6164 645f 656e 7472 795f 656e 7469  l.add_entry_enti
-00016040: 7479 285b 6e65 775f 656e 7469 7479 5f73  ty([new_entity_s
-00016050: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
-00016060: 736f 7572 6365 735d 290d 0a0d 0a20 2020  sources])....   
-00016070: 2020 2020 2020 2020 2020 2020 2074 656e               ten
-00016080: 616e 745f 736f 7572 6365 203d 2073 656c  ant_source = sel
-00016090: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-000160a0: 6c2e 6765 745f 7465 6e61 6e74 5f6f 6e5f  l.get_tenant_on_
-000160b0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
-000160c0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
-000160d0: 6d5f 6272 616e 6368 280d 0a20 2020 2020  m_branch(..     
-000160e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000160f0: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-00016100: 2c20 3129 0d0a 2020 2020 2020 2020 2020  , 1)..          
-00016110: 2020 2020 2020 6966 206c 656e 2874 656e        if len(ten
-00016120: 616e 745f 736f 7572 6365 2920 213d 2030  ant_source) != 0
-00016130: 3a20 6861 735f 746e 203d 2054 7275 650d  : has_tn = True.
-00016140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016150: 2072 6563 6f72 645f 736f 7572 6365 203d   record_source =
-00016160: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00016170: 6374 7561 6c2e 6765 745f 7265 636f 7264  ctual.get_record
-00016180: 5f73 6f75 7263 655f 6f6e 5f64 765f 6672  _source_on_dv_fr
-00016190: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
-000161a0: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
-000161b0: 6e63 6828 0d0a 2020 2020 2020 2020 2020  nch(..          
-000161c0: 2020 2020 2020 2020 2020 636f 645f 656e            cod_en
-000161d0: 7469 7479 5f74 6172 6765 742c 2031 290d  tity_target, 1).
-000161e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000161f0: 2069 6620 7265 636f 7264 5f73 6f75 7263   if record_sourc
-00016200: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
-00016210: 6173 5f72 7320 3d20 5472 7565 0d0a 0d0a  as_rs = True....
-00016220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016230: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-00016240: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
-00016250: 696f 6e2e 6765 745f 6861 7368 5f66 6f72  ion.get_hash_for
-00016260: 5f6d 6574 6164 6174 6128 290d 0a0d 0a20  _metadata().... 
-00016270: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016280: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00016290: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-000162a0: 2b20 7361 7465 5f65 6e74 6974 795f 756e  + sate_entity_un
-000162b0: 696f 6e5f 736f 7572 6365 732c 2068 6173  ion_sources, has
-000162c0: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
-000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162f0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00016300: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-00016310: 7572 6365 735f 322c 0d0a 2020 2020 2020  urces_2,..      
-00016320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016340: 2068 6173 685f 6e61 6d65 202b 2022 5f32   hash_name + "_2
-00016350: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00016360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016370: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00016380: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-00016390: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-000163a0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-000163b0: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00015f80: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00015f90: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00015fa0: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+00015fb0: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+00015fc0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+00015fd0: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
+00015fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ff0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
+00016000: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+00016010: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00016020: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00016030: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00016040: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00016050: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00016060: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00016070: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00016080: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00016090: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+000160a0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+000160b0: 2323 2323 2323 2323 2323 2320 4361 7365  ########### Case
+000160c0: 2066 6f72 2044 6174 6162 6173 6573 2074   for Databases t
+000160d0: 6861 7420 646f 6573 6e27 7420 6861 7665  hat doesn't have
+000160e0: 204f 5554 4552 204a 4f49 4e20 2323 2323   OUTER JOIN ####
+000160f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00016100: 2323 230d 0a20 2020 2020 2020 2020 2020  ###..           
+00016110: 2069 6620 7365 6c66 2e63 6f6e 6e65 6374   if self.connect
+00016120: 696f 6e2e 6765 745f 636f 6e6e 6563 7469  ion.get_connecti
+00016130: 6f6e 5f74 7970 6528 2920 696e 2043 4f4e  on_type() in CON
+00016140: 4e45 4354 494f 4e53 5f57 4954 484f 5554  NECTIONS_WITHOUT
+00016150: 5f4f 5554 4552 5f4a 4f49 4e3a 0d0a 0d0a  _OUTER_JOIN:....
+00016160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016170: 6e65 775f 7265 6c61 7469 6f6e 7368 6970  new_relationship
+00016180: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+00016190: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+000161a0: 6e5f 736f 7572 6365 732c 2068 6173 685f  n_sources, hash_
+000161b0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161d0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+000161e0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+000161f0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00016200: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+00016210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016220: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
+00016230: 652c 2022 4d41 5354 4552 204a 4f49 4e22  e, "MASTER JOIN"
+00016240: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00016250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016260: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00016270: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+00016280: 7461 7365 745f 7265 6c61 7469 6f6e 7368  taset_relationsh
+00016290: 6970 285b 6e65 775f 7265 6c61 7469 6f6e  ip([new_relation
+000162a0: 7368 6970 5d29 0d0a 0d0a 2020 2020 2020  ship])....      
+000162b0: 2020 2020 2020 2020 2020 2323 2323 2320            ##### 
+000162c0: 4765 7420 616e 6f74 6865 7220 554e 494f  Get another UNIO
+000162d0: 4e20 5354 5320 746f 2073 6574 206e 6577  N STS to set new
+000162e0: 2072 656c 6174 696f 6e73 6869 700d 0a20   relationship.. 
+000162f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016300: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
+00016310: 5f73 6f75 7263 6573 5f32 203d 2027 5354  _sources_2 = 'ST
+00016320: 475f 544d 505f 554e 494f 4e5f 325f 2720  G_TMP_UNION_2_' 
+00016330: 2b20 7361 7465 5f6e 616d 650d 0a20 2020  + sate_name..   
+00016340: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00016350: 5f65 6e74 6974 795f 7374 735f 656e 7469  _entity_sts_enti
+00016360: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+00016370: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+00016380: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+00016390: 6e5f 736f 7572 6365 735f 322c 0d0a 2020  n_sources_2,..  
+000163a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000163c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163e0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-000163f0: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
+000163d0: 2020 2020 2073 6174 655f 656e 7469 7479       sate_entity
+000163e0: 5f75 6e69 6f6e 5f73 6f75 7263 6573 5f32  _union_sources_2
+000163f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00016400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016410: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-00016420: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
-00016430: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
-00016440: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00016450: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00016460: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00016470: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016480: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00016490: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000164a0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-000164b0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000164c0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-000164d0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-000164e0: 725f 6d65 7461 6461 7461 203d 2073 656c  r_metadata = sel
-000164f0: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
-00016500: 5f73 7973 6461 7465 5f66 6f72 5f6d 6574  _sysdate_for_met
-00016510: 6164 6174 6128 290d 0a20 2020 2020 2020  adata()..       
-00016520: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-00016530: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00016540: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00016550: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-00016560: 7572 6365 732c 2027 4441 5445 5f43 5245  urces, 'DATE_CRE
-00016570: 4154 4544 272c 0d0a 2020 2020 2020 2020  ATED',..        
-00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016590: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000165a0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-000165b0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
-000165c0: 7263 6573 5f32 2c0d 0a20 2020 2020 2020  rces_2,..       
-000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165f0: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
-00016600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016620: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-00016630: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-00016640: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00016650: 6e2c 2073 7973 6461 7465 5f66 6f72 5f6d  n, sysdate_for_m
-00016660: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
-00016670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016690: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-000166a0: 6d65 7461 6461 7461 5b32 5d2c 2031 2c20  metadata[2], 1, 
-000166b0: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
-000166c0: 6e65 725d 0d0a 0d0a 2020 2020 2020 2020  ner]....        
-000166d0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000166e0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000166f0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00016700: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00016710: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00016410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016420: 2020 2020 2020 2020 2020 454e 5449 5459            ENTITY
+00016430: 5f57 4954 482c 2064 765f 656e 7469 7479  _WITH, dv_entity
+00016440: 2e63 6f64 5f70 6174 682c 2027 272c 2073  .cod_path, '', s
+00016450: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00016460: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016470: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00016480: 2e61 6464 5f65 6e74 7279 5f65 6e74 6974  .add_entry_entit
+00016490: 7928 5b6e 6577 5f65 6e74 6974 795f 7374  y([new_entity_st
+000164a0: 735f 656e 7469 7479 5f75 6e69 6f6e 5f73  s_entity_union_s
+000164b0: 6f75 7263 6573 5d29 0d0a 0d0a 2020 2020  ources])....    
+000164c0: 2020 2020 2020 2020 2020 2020 7465 6e61              tena
+000164d0: 6e74 5f73 6f75 7263 6520 3d20 7365 6c66  nt_source = self
+000164e0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+000164f0: 2e67 6574 5f74 656e 616e 745f 6f6e 5f64  .get_tenant_on_d
+00016500: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
+00016510: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
+00016520: 5f62 7261 6e63 6828 0d0a 2020 2020 2020  _branch(..      
+00016530: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016540: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
+00016550: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
+00016560: 2020 2020 2069 6620 6c65 6e28 7465 6e61       if len(tena
+00016570: 6e74 5f73 6f75 7263 6529 2021 3d20 303a  nt_source) != 0:
+00016580: 2068 6173 5f74 6e20 3d20 5472 7565 0d0a   has_tn = True..
+00016590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165a0: 7265 636f 7264 5f73 6f75 7263 6520 3d20  record_source = 
+000165b0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+000165c0: 7475 616c 2e67 6574 5f72 6563 6f72 645f  tual.get_record_
+000165d0: 736f 7572 6365 5f6f 6e5f 6476 5f66 726f  source_on_dv_fro
+000165e0: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
+000165f0: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
+00016600: 6368 280d 0a20 2020 2020 2020 2020 2020  ch(..           
+00016610: 2020 2020 2020 2020 2063 6f64 5f65 6e74           cod_ent
+00016620: 6974 795f 7461 7267 6574 2c20 3129 0d0a  ity_target, 1)..
+00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016640: 6966 2072 6563 6f72 645f 736f 7572 6365  if record_source
+00016650: 2069 7320 6e6f 7420 4e6f 6e65 3a20 6861   is not None: ha
+00016660: 735f 7273 203d 2054 7275 650d 0a0d 0a20  s_rs = True.... 
+00016670: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00016680: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+00016690: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
+000166a0: 6f6e 2e67 6574 5f68 6173 685f 666f 725f  on.get_hash_for_
+000166b0: 6d65 7461 6461 7461 2829 0d0a 0d0a 2020  metadata()....  
+000166c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000166d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000166e0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+000166f0: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
+00016700: 6f6e 5f73 6f75 7263 6573 2c20 6861 7368  on_sources, hash
+00016710: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
 00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016730: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00016740: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-00016750: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
-00016760: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
-00016770: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-00016780: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00016790: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-000167a0: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-000167b0: 7572 6365 732c 2072 6563 6f72 645f 736f  urces, record_so
-000167c0: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-000167d0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-000167e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016800: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00016810: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-00016820: 6f6e 5f73 6f75 7263 6573 5f32 2c0d 0a20  on_sources_2,.. 
-00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016850: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00016860: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
-00016870: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168a0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-000168b0: 6f75 7263 652e 636f 6c75 6d6e 5f74 7970  ource.column_typ
-000168c0: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-000168d0: 6c5f 706f 7369 7469 6f6e 2c0d 0a20 2020  l_position,..   
-000168e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016900: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00016910: 6f75 7263 652e 636f 6c75 6d6e 5f6c 656e  ource.column_len
-00016920: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00016930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016950: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-00016960: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-00016970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016990: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
-000169a0: 4b45 595f 5459 5045 5f52 4543 4f52 445f  KEY_TYPE_RECORD_
-000169b0: 534f 5552 4345 2c20 312c 2073 656c 662e  SOURCE, 1, self.
-000169c0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-000169d0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-000169e0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-000169f0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00016a00: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00016a10: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00016a20: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00016a30: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00016a40: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00016a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016a60: 2069 6620 6861 735f 746e 3a0d 0a20 2020   if has_tn:..   
-00016a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a80: 2066 6f72 2074 6e20 696e 2074 656e 616e   for tn in tenan
-00016a90: 745f 736f 7572 6365 3a0d 0a20 2020 2020  t_source:..     
-00016aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ab0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-00016ac0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-00016ad0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00016ae0: 795f 756e 696f 6e5f 736f 7572 6365 732c  y_union_sources,
-00016af0: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-00016b00: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-00016b40: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00016b50: 756e 696f 6e5f 736f 7572 6365 735f 322c  union_sources_2,
-00016b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b90: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-00016ba0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00016bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bd0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-00016be0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-00016bf0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00016c00: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
-00016c10: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00016c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016730: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016740: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00016750: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+00016760: 7263 6573 5f32 2c0d 0a20 2020 2020 2020  rces_2,..       
+00016770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016790: 6861 7368 5f6e 616d 6520 2b20 225f 3222  hash_name + "_2"
+000167a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000167b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167c0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+000167d0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+000167e0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+000167f0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+00016800: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+00016810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016830: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00016840: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+00016850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016860: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00016870: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
+00016880: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
+00016890: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+000168a0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+000168b0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+000168c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000168d0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000168e0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+000168f0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00016900: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00016910: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00016920: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+00016930: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
+00016940: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
+00016950: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00016960: 6461 7461 2829 0d0a 2020 2020 2020 2020  data()..        
+00016970: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00016980: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00016990: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+000169a0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+000169b0: 7263 6573 2c20 2744 4154 455f 4352 4541  rces, 'DATE_CREA
+000169c0: 5445 4427 2c0d 0a20 2020 2020 2020 2020  TED',..         
+000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000169f0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00016a00: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
+00016a10: 6365 735f 322c 0d0a 2020 2020 2020 2020  ces_2,..        
+00016a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016a40: 4441 5445 5f43 5245 4154 4544 272c 0d0a  DATE_CREATED',..
+00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a70: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+00016a80: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+00016a90: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00016aa0: 2c20 7379 7364 6174 655f 666f 725f 6d65  , sysdate_for_me
+00016ab0: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ae0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+00016af0: 6574 6164 6174 615b 325d 2c20 312c 204e  etadata[2], 1, N
+00016b00: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
+00016b10: 6572 5d0d 0a0d 0a20 2020 2020 2020 2020  er]....         
+00016b20: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00016b30: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00016b40: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00016b50: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00016b60: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00016b70: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00016b80: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00016b90: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+00016ba0: 2020 2020 2020 2020 6966 2068 6173 5f72          if has_r
+00016bb0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00016bc0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00016bd0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00016be0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00016bf0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+00016c00: 7263 6573 2c20 7265 636f 7264 5f73 6f75  rces, record_sou
+00016c10: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00016c20: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
 00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c40: 2020 2074 6e2e 636f 6c75 6d6e 5f70 7265     tn.column_pre
-00016c50: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c80: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-00016c90: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
-00016ca0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cc0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00016cd0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00016ce0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00016cf0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00016d00: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d20: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00016d30: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-00016d40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00016d50: 6861 735f 6164 3a0d 0a20 2020 2020 2020  has_ad:..       
-00016d60: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00016d70: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00016d80: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00016d90: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
-00016da0: 6e5f 736f 7572 6365 732c 2061 7070 6c69  n_sources, appli
-00016db0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-00016dc0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00016c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c50: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00016c60: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+00016c70: 6e5f 736f 7572 6365 735f 322c 0d0a 2020  n_sources_2,..  
+00016c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ca0: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+00016cb0: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
+00016cc0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cf0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00016d00: 7572 6365 2e63 6f6c 756d 6e5f 7479 7065  urce.column_type
+00016d10: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+00016d20: 5f70 6f73 6974 696f 6e2c 0d0a 2020 2020  _position,..    
+00016d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d50: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00016d60: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+00016d70: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+00016d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016da0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+00016db0: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+00016dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016df0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-00016e00: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00016e10: 756e 696f 6e5f 736f 7572 6365 735f 322c  union_sources_2,
-00016e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e40: 2020 2020 2020 2020 2020 2020 2061 7070               app
-00016e50: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00016e60: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e90: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-00016ea0: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
-00016eb0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-00016ec0: 616c 5f70 6f73 6974 696f 6e2c 0d0a 2020  al_position,..  
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ef0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00016f00: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
-00016f10: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00016f50: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-00016f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016de0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+00016df0: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
+00016e00: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
+00016e10: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00016e20: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00016e30: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00016e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016e50: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00016e60: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00016e70: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00016e80: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00016e90: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016eb0: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
+00016ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ed0: 666f 7220 746e 2069 6e20 7465 6e61 6e74  for tn in tenant
+00016ee0: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
+00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f00: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00016f10: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+00016f20: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00016f30: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c20  _union_sources, 
+00016f40: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+00016f50: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00016f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f80: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-00016f90: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
-00016fa0: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
-00016fb0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00016fc0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00016fd0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00016fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ff0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00017000: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-00017010: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-00017020: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-00017030: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-00017040: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00017050: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
-00017060: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00017070: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-00017080: 6c5f 696d 6167 655f 322c 2068 6173 685f  l_image_2, hash_
-00017090: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170b0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-000170c0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-000170d0: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
-000170e0: 5f32 2c0d 0a20 2020 2020 2020 2020 2020  _2,..           
-000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
-00017110: 6d65 202b 2022 5f32 222c 2022 4d41 5354  me + "_2", "MAST
-00017120: 4552 204a 4f49 4e22 2c20 7365 6c66 2e6f  ER JOIN", self.o
-00017130: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00017140: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00017150: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00017160: 656e 7472 795f 6461 7461 7365 745f 7265  entry_dataset_re
-00017170: 6c61 7469 6f6e 7368 6970 285b 6e65 775f  lationship([new_
-00017180: 7265 6c61 7469 6f6e 7368 6970 5d29 0d0a  relationship])..
-00017190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000171a0: 2020 2323 2323 2320 5365 7420 6f75 7465    ##### Set oute
-000171b0: 7220 6a6f 696e 2073 696d 756c 6174 696f  r join simulatio
-000171c0: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-000171d0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-000171e0: 696f 6e20 3d20 310d 0a0d 0a20 2020 2020  ion = 1....     
-000171f0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-00017200: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-00017210: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00017220: 7465 5f65 6e74 6974 795f 756e 696f 6e5f  te_entity_union_
-00017230: 736f 7572 6365 735f 322c 2068 6173 685f  sources_2, hash_
-00017240: 6e61 6d65 202b 2022 5f32 222c 0d0a 2020  name + "_2",..  
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017270: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00017280: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
-00017290: 6e2c 2068 6173 685f 6e61 6d65 2c0d 0a20  n, hash_name,.. 
-000172a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172c0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-000172d0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-000172e0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-000172f0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00017300: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
-00017310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017320: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00017330: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-00017340: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00017350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017360: 2020 2020 2020 2020 2020 322c 204b 4559            2, KEY
-00017370: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00017380: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000173b0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000173c0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000173d0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000173e0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000173f0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00017400: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00017410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017420: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00017430: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
-00017440: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
-00017450: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-00017460: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
-00017470: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00017480: 745f 6d61 7070 696e 6720 3d20 5b27 272c  t_mapping = ['',
-00017490: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
-000174a0: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
-000174b0: 7565 2829 2c20 7072 6566 6978 5f65 7420  ue(), prefix_et 
-000174c0: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
-000174d0: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
-000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174f0: 2020 2020 2020 2020 2020 2020 2744 4154              'DAT
-00017500: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
-00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017530: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-00017540: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-00017550: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
-00017560: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-00017570: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
-00017580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175a0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-000175b0: 6461 7461 5b32 5d2c 2032 2c20 4e6f 6e65  data[2], 2, None
-000175c0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-000175d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000175e0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-000175f0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00017600: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00017610: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00017620: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-00017630: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00017640: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00017650: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
-00017660: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-00017670: 5f6d 6170 7069 6e67 203d 205b 2727 2c20  _mapping = ['', 
-00017680: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
-00017690: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
-000176a0: 6528 292c 0d0a 2020 2020 2020 2020 2020  e(),..          
+00016f80: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00016f90: 202b 2073 6174 655f 656e 7469 7479 5f75   + sate_entity_u
+00016fa0: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c0d  nion_sources_2,.
+00016fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fe0: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+00016ff0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00017000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017020: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+00017030: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+00017040: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00017050: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
+00017060: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017090: 2020 746e 2e63 6f6c 756d 6e5f 7072 6563    tn.column_prec
+000170a0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+000170b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170d0: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+000170e0: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
+000170f0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00017100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017110: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00017120: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00017130: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00017140: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00017150: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+00017160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017170: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+00017180: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+00017190: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+000171a0: 6173 5f61 643a 0d0a 2020 2020 2020 2020  as_ad:..        
+000171b0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000171c0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+000171d0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+000171e0: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
+000171f0: 5f73 6f75 7263 6573 2c20 6170 706c 6965  _sources, applie
+00017200: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+00017210: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017240: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00017250: 202b 2073 6174 655f 656e 7469 7479 5f75   + sate_entity_u
+00017260: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c0d  nion_sources_2,.
+00017270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017290: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+000172a0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+000172b0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172e0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+000172f0: 5f64 6174 652e 636f 6c75 6d6e 5f74 7970  _date.column_typ
+00017300: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+00017310: 6c5f 706f 7369 7469 6f6e 2c0d 0a20 2020  l_position,..   
+00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017340: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+00017350: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
+00017360: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017390: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+000173a0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173d0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+000173e0: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
+000173f0: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
+00017400: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00017410: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+00017420: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00017430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017440: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00017450: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00017460: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00017470: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00017480: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+00017490: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000174a0: 775f 7265 6c61 7469 6f6e 7368 6970 203d  w_relationship =
+000174b0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+000174c0: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+000174d0: 5f69 6d61 6765 5f32 2c20 6861 7368 5f6e  _image_2, hash_n
+000174e0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017500: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00017510: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00017520: 795f 756e 696f 6e5f 736f 7572 6365 735f  y_union_sources_
+00017530: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017550: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
+00017560: 6520 2b20 225f 3222 2c20 224d 4153 5445  e + "_2", "MASTE
+00017570: 5220 4a4f 494e 222c 2073 656c 662e 6f77  R JOIN", self.ow
+00017580: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00017590: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+000175a0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+000175b0: 6e74 7279 5f64 6174 6173 6574 5f72 656c  ntry_dataset_rel
+000175c0: 6174 696f 6e73 6869 7028 5b6e 6577 5f72  ationship([new_r
+000175d0: 656c 6174 696f 6e73 6869 705d 290d 0a0d  elationship])...
+000175e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000175f0: 2023 2323 2323 2053 6574 206f 7574 6572   ##### Set outer
+00017600: 206a 6f69 6e20 7369 6d75 6c61 7469 6f6e   join simulation
+00017610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017620: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00017630: 6f6e 203d 2031 0d0a 0d0a 2020 2020 2020  on = 1....      
+00017640: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00017650: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00017660: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00017670: 655f 656e 7469 7479 5f75 6e69 6f6e 5f73  e_entity_union_s
+00017680: 6f75 7263 6573 5f32 2c20 6861 7368 5f6e  ources_2, hash_n
+00017690: 616d 6520 2b20 225f 3222 2c0d 0a20 2020  ame + "_2",..   
+000176a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-000176d0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-000176e0: 7469 7479 5f6a 6f69 6e2c 2027 4441 5445  tity_join, 'DATE
-000176f0: 5f53 5441 5254 272c 0d0a 2020 2020 2020  _START',..      
+000176c0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+000176d0: 7361 7465 5f65 6e74 6974 795f 6a6f 696e  sate_entity_join
+000176e0: 2c20 6861 7368 5f6e 616d 652c 0d0a 2020  , hash_name,..  
+000176f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017720: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00017730: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-00017740: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
-00017750: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-00017760: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
-00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017780: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00017790: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-000177a0: 615b 325d 2c20 322c 204e 6f6e 652c 2031  a[2], 2, None, 1
-000177b0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-000177c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000177d0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-000177e0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-000177f0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00017800: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00017810: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-00017820: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00017830: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-00017840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017850: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00017860: 696e 6720 3d20 5b27 272c 2073 656c 662e  ing = ['', self.
-00017870: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
-00017880: 7973 6461 7465 5f76 616c 7565 5f69 6e66  ysdate_value_inf
-00017890: 696e 6974 6528 292c 0d0a 2020 2020 2020  inite(),..      
-000178a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178c0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-000178d0: 655f 656e 7469 7479 5f6a 6f69 6e2c 2027  e_entity_join, '
-000178e0: 4441 5445 5f45 4e44 272c 0d0a 2020 2020  DATE_END',..    
-000178f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017910: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-00017920: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00017930: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7379  nal_position, sy
-00017940: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00017950: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
+00017710: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00017720: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00017730: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+00017740: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+00017750: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00017760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017770: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00017780: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00017790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177b0: 2020 2020 2020 2020 2032 2c20 4b45 595f           2, KEY_
+000177c0: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+000177d0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000177e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000177f0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00017800: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00017810: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00017820: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00017830: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00017840: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00017850: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00017860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017870: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00017880: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
+00017890: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
+000178a0: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
+000178b0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+000178c0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+000178d0: 5f6d 6170 7069 6e67 203d 205b 2727 2c20  _mapping = ['', 
+000178e0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+000178f0: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
+00017900: 6528 292c 2070 7265 6669 785f 6574 202b  e(), prefix_et +
+00017910: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
+00017920: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00017930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017940: 2020 2020 2020 2020 2020 2027 4441 5445             'DATE
+00017950: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
 00017960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017970: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017980: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-00017990: 6174 615b 325d 2c20 322c 204e 6f6e 652c  ata[2], 2, None,
-000179a0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-000179b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000179c0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-000179d0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-000179e0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-000179f0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00017a00: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
-00017a10: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-00017a20: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00017a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017a40: 2020 6966 2068 6173 5f72 733a 0d0a 2020    if has_rs:..  
-00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a60: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00017a70: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00017a80: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-00017a90: 5f75 6e69 6f6e 5f73 6f75 7263 6573 5f32  _union_sources_2
-00017aa0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-00017ab0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00017ac0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-00017ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017af0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00017b00: 5f65 6e74 6974 795f 6a6f 696e 2c0d 0a20  _entity_join,.. 
-00017b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b30: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00017b40: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
-00017b50: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00017970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017980: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+00017990: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+000179a0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7379  nal_position, sy
+000179b0: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+000179c0: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
+000179d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000179f0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+00017a00: 6174 615b 325d 2c20 322c 204e 6f6e 652c  ata[2], 2, None,
+00017a10: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00017a20: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00017a30: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00017a40: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00017a50: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00017a60: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00017a70: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+00017a80: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00017a90: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00017aa0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00017ab0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00017ac0: 6d61 7070 696e 6720 3d20 5b27 272c 2073  mapping = ['', s
+00017ad0: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
+00017ae0: 6574 5f73 7973 6461 7465 5f76 616c 7565  et_sysdate_value
+00017af0: 2829 2c0d 0a20 2020 2020 2020 2020 2020  (),..           
+00017b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b10: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00017b20: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00017b30: 6974 795f 6a6f 696e 2c20 2744 4154 455f  ity_join, 'DATE_
+00017b40: 5354 4152 5427 2c0d 0a20 2020 2020 2020  START',..       
+00017b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b80: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00017b90: 6f75 7263 652e 636f 6c75 6d6e 5f74 7970  ource.column_typ
-00017ba0: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-00017bb0: 6c5f 706f 7369 7469 6f6e 2c0d 0a20 2020  l_position,..   
+00017b70: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00017b80: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+00017b90: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
+00017ba0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+00017bb0: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
 00017bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017be0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00017bf0: 6f75 7263 652e 636f 6c75 6d6e 5f6c 656e  ource.column_len
-00017c00: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00017c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c30: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-00017c40: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-00017c50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2020 2020 2020 2020 2020 2020 2032 2c20               2, 
-00017c80: 4b45 595f 5459 5045 5f52 4543 4f52 445f  KEY_TYPE_RECORD_
-00017c90: 534f 5552 4345 2c20 312c 2073 656c 662e  SOURCE, 1, self.
-00017ca0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00017cb0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00017cc0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00017cd0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00017ce0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00017cf0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00017d00: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00017d10: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00017d20: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00017d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017d40: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-00017d50: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-00017d60: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00017d70: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00017d80: 5f32 2c20 7265 636f 7264 5f73 6f75 7263  _2, record_sourc
-00017d90: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-00017da0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+00017bd0: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+00017be0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00017bf0: 5b32 5d2c 2032 2c20 4e6f 6e65 2c20 312c  [2], 2, None, 1,
+00017c00: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00017c10: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00017c20: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00017c30: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00017c40: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00017c50: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00017c60: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+00017c70: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00017c80: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+00017c90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017ca0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00017cb0: 6e67 203d 205b 2727 2c20 7365 6c66 2e63  ng = ['', self.c
+00017cc0: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
+00017cd0: 7364 6174 655f 7661 6c75 655f 696e 6669  sdate_value_infi
+00017ce0: 6e69 7465 2829 2c0d 0a20 2020 2020 2020  nite(),..       
+00017cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d10: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+00017d20: 5f65 6e74 6974 795f 6a6f 696e 2c20 2744  _entity_join, 'D
+00017d30: 4154 455f 454e 4427 2c0d 0a20 2020 2020  ATE_END',..     
+00017d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d60: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00017d70: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00017d80: 616c 5f70 6f73 6974 696f 6e2c 2073 7973  al_position, sys
+00017d90: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00017da0: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
 00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dd0: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-00017de0: 7465 5f65 6e74 6974 795f 6a6f 696e 2c0d  te_entity_join,.
-00017df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017dc0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00017dd0: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+00017de0: 7461 5b32 5d2c 2032 2c20 4e6f 6e65 2c20  ta[2], 2, None, 
+00017df0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
 00017e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e10: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00017e20: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-00017e30: 5f6e 616d 655f 7461 7267 6574 202b 2022  _name_target + "
-00017e40: 5f48 4953 5422 2c0d 0a20 2020 2020 2020  _HIST",..       
-00017e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e70: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00017e80: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00017e90: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00017ea0: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
-00017eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ed0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00017ee0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00017ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f10: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-00017f20: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-00017f30: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f60: 2020 2020 2020 2020 2032 2c20 4b45 595f           2, KEY_
-00017f70: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
-00017f80: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
-00017f90: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-00017fa0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00017fb0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00017e10: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00017e20: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00017e30: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00017e40: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00017e50: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+00017e60: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00017e70: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+00017e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017e90: 2069 6620 6861 735f 7273 3a0d 0a20 2020   if has_rs:..   
+00017ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017eb0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+00017ec0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+00017ed0: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+00017ee0: 756e 696f 6e5f 736f 7572 6365 735f 322c  union_sources_2,
+00017ef0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00017f00: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00017f10: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00017f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017f40: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00017f50: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+00017f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f80: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+00017f90: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
+00017fa0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00017fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fd0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00017fe0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00017ff0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00018000: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00018010: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00018020: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00018030: 6861 735f 746e 3a0d 0a20 2020 2020 2020  has_tn:..       
-00018040: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00018050: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
-00018060: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
-00018070: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00018080: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00018090: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-000180a0: 2b20 7361 7465 5f65 6e74 6974 795f 756e  + sate_entity_un
-000180b0: 696f 6e5f 736f 7572 6365 735f 322c 2074  ion_sources_2, t
-000180c0: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-000180d0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-000180e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018100: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-00018110: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
-00018120: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
-00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018150: 2020 2020 746e 2e63 6f6c 756d 6e5f 6e61      tn.column_na
-00018160: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-00018170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fd0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00017fe0: 7572 6365 2e63 6f6c 756d 6e5f 7479 7065  urce.column_type
+00017ff0: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+00018000: 5f70 6f73 6974 696f 6e2c 0d0a 2020 2020  _position,..    
+00018010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018030: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00018040: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+00018050: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+00018060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018080: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+00018090: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+000180a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180c0: 2020 2020 2020 2020 2020 2020 322c 204b              2, K
+000180d0: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
+000180e0: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
+000180f0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00018100: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00018110: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00018120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018130: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00018140: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00018150: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00018160: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00018170: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
 00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018190: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-000181a0: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-000181b0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-000181c0: 6f6e 2c20 746e 2e63 6f6c 756d 6e5f 6c65  on, tn.column_le
-000181d0: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
-000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018200: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-00018210: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-00018220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018240: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
-00018250: 595f 5459 5045 5f54 454e 414e 542c 2031  Y_TYPE_TENANT, 1
-00018260: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018280: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00018290: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000182a0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000182b0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-000182c0: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-000182d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182e0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-000182f0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00018190: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+000181a0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+000181b0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+000181c0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+000181d0: 322c 2072 6563 6f72 645f 736f 7572 6365  2, record_source
+000181e0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+000181f0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+00018200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018220: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00018230: 655f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  e_entity_join,..
+00018240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018260: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00018270: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+00018280: 6e61 6d65 5f74 6172 6765 7420 2b20 225f  name_target + "_
+00018290: 4849 5354 222c 0d0a 2020 2020 2020 2020  HIST",..        
+000182a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182c0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+000182d0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+000182e0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+000182f0: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
 00018300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018310: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
-00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018330: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00018340: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-00018350: 202b 2073 6174 655f 656e 7469 7479 5f75   + sate_entity_u
-00018360: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c20  nion_sources_2, 
-00018370: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00018380: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-00018390: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018320: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00018330: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00018340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018360: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00018370: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+00018380: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+00018390: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000183a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183b0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-000183c0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-000183d0: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
-000183e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018400: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-00018410: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-00018420: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00018430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018450: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-00018460: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-00018470: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-00018480: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
-00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184b0: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
-000184c0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184f0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00018500: 6564 5f64 6174 652e 636f 6c75 6d6e 5f70  ed_date.column_p
-00018510: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183b0: 2020 2020 2020 2020 322c 204b 4559 5f54          2, KEY_T
+000183c0: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
+000183d0: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
+000183e0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000183f0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00018400: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+00018410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018420: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00018430: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00018440: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00018450: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00018460: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00018470: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00018480: 6173 5f74 6e3a 0d0a 2020 2020 2020 2020  as_tn:..        
+00018490: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000184a0: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
+000184b0: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
+000184c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000184d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000184e0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+000184f0: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
+00018500: 6f6e 5f73 6f75 7263 6573 5f32 2c20 746e  on_sources_2, tn
+00018510: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00018520: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
 00018530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018540: 2020 2020 2020 322c 204b 4559 5f54 5950        2, KEY_TYP
-00018550: 455f 4150 504c 4945 445f 4441 5445 2c20  E_APPLIED_DATE, 
-00018560: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018580: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00018590: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
-000185a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000185b0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-000185c0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-000185d0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-000185e0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-000185f0: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
-00018600: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-00018610: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00018620: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00018630: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-00018640: 6d61 6765 5f32 2c20 6861 7368 5f6e 616d  mage_2, hash_nam
-00018650: 652c 2070 7265 6669 785f 6574 202b 2073  e, prefix_et + s
-00018660: 6174 655f 656e 7469 7479 5f6a 6f69 6e2c  ate_entity_join,
-00018670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018550: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+00018560: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
+00018570: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00018580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185a0: 2020 2074 6e2e 636f 6c75 6d6e 5f6e 616d     tn.column_nam
+000185b0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185e0: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+000185f0: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+00018600: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00018610: 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c 656e  n, tn.column_len
+00018620: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
+00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018650: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
+00018660: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+00018670: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018690: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
-000186a0: 6d65 202b 2027 5f48 4953 5427 2c0d 0a20  me + '_HIST',.. 
-000186b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018690: 2020 2020 2020 2020 2020 322c 204b 4559            2, KEY
+000186a0: 5f54 5950 455f 5445 4e41 4e54 2c20 312c  _TYPE_TENANT, 1,
+000186b0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
 000186c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186d0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-000186e0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-000186f0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-00018700: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00018710: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+000186d0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+000186e0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+000186f0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00018700: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00018710: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
 00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018730: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00018740: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-00018750: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018770: 2020 2020 2020 2020 2020 322c 204b 4559            2, KEY
-00018780: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00018790: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187b0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000187c0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000187d0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000187e0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000187f0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00018800: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00018810: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00018820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018830: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00018840: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00018850: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00018860: 6163 7475 616c 5f69 6d61 6765 5f32 2c20  actual_image_2, 
-00018870: 2744 4154 455f 5354 4152 5427 2c20 7072  'DATE_START', pr
-00018880: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00018890: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
-000188a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188c0: 2020 2020 2744 4154 455f 5354 4152 545f      'DATE_START_
-000188d0: 4849 5354 272c 0d0a 2020 2020 2020 2020  HIST',..        
+00018730: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00018740: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+00018750: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018760: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
+00018770: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00018780: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00018790: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+000187a0: 2b20 7361 7465 5f65 6e74 6974 795f 756e  + sate_entity_un
+000187b0: 696f 6e5f 736f 7572 6365 735f 322c 2061  ion_sources_2, a
+000187c0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+000187d0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+000187e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000187f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018800: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00018810: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00018820: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
+00018830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018850: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+00018860: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
+00018870: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188a0: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
+000188b0: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+000188c0: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+000188d0: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
 000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00018900: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-00018910: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-00018920: 6974 696f 6e2c 2068 6173 685f 666f 725f  ition, hash_for_
-00018930: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
-00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018960: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
-00018970: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
+000188f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018900: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
+00018910: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00018920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018940: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+00018950: 645f 6461 7465 2e63 6f6c 756d 6e5f 7072  d_date.column_pr
+00018960: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189a0: 2020 2032 2c20 4b45 595f 5459 5045 5f48     2, KEY_TYPE_H
-000189b0: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
-000189c0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-000189d0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-000189e0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a00: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00018a10: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-00018a20: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-00018a30: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-00018a40: 7069 6e67 5d29 0d0a 0d0a 0d0a 2020 2020  ping])......    
-00018a50: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
-00018a60: 7420 4669 6c74 6572 2074 6f20 7468 6520  t Filter to the 
-00018a70: 7365 636f 6e64 2075 6e69 6f6e 0d0a 2020  second union..  
-00018a80: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00018a90: 6c74 6572 203d 2068 6173 685f 6e61 6d65  lter = hash_name
-00018aa0: 202b 2027 5f32 2069 7320 6e75 6c6c 270d   + '_2 is null'.
-00018ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ac0: 206e 6577 5f66 696c 7465 7220 3d20 5b70   new_filter = [p
-00018ad0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-00018ae0: 656e 7469 7479 5f6a 6f69 6e2c 2066 696c  entity_join, fil
-00018af0: 7465 722c 2032 2c20 7365 6c66 2e6f 776e  ter, 2, self.own
-00018b00: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00018b10: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00018b20: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-00018b30: 7472 795f 6669 6c74 6572 7328 5b6e 6577  try_filters([new
-00018b40: 5f66 696c 7465 725d 290d 0a0d 0a20 2020  _filter])....   
-00018b50: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00018b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b70: 6e65 775f 7265 6c61 7469 6f6e 7368 6970  new_relationship
-00018b80: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00018b90: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
-00018ba0: 6e5f 736f 7572 6365 732c 2068 6173 685f  n_sources, hash_
-00018bb0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00018bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bd0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00018be0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00018bf0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-00018c00: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
-00018c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c20: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
-00018c30: 652c 2022 4f55 5445 5220 4a4f 494e 222c  e, "OUTER JOIN",
-00018c40: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00018c50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00018c60: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00018c70: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00018c80: 6173 6574 5f72 656c 6174 696f 6e73 6869  aset_relationshi
-00018c90: 7028 5b6e 6577 5f72 656c 6174 696f 6e73  p([new_relations
-00018ca0: 6869 705d 290d 0a0d 0a0d 0a20 2020 2020  hip])......     
-00018cb0: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-00018cc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018cd0: 2323 2323 2323 2323 2323 2323 2053 4154  ############ SAT
-00018ce0: 4520 4c41 5354 2049 4d41 4745 2023 2323  E LAST IMAGE ###
-00018cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018d10: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00018d20: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00018d30: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00018d40: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00018d50: 7479 5f6a 6f69 6e2c 2068 6173 685f 6e61  ty_join, hash_na
-00018d60: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
-00018d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d80: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-00018d90: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00018da0: 6c61 7374 5f69 6d61 6765 2c20 6861 7368  last_image, hash
-00018db0: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-00018dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dd0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00018de0: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-00018df0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00018e00: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-00018e10: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
-00018e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e30: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00018e40: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
-00018e50: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00018e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e70: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-00018e80: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-00018e90: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00018ea0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-00018eb0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00018ec0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018ed0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00018ee0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00018ef0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00018f00: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00018f10: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-00018f20: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-00018f30: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
-00018f40: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-00018f50: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00018f60: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-00018f70: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00018f80: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00018f90: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00018fa0: 6a6f 696e 2c20 2744 4154 455f 4352 4541  join, 'DATE_CREA
-00018fb0: 5445 4427 2c0d 0a20 2020 2020 2020 2020  TED',..         
-00018fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fd0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00018fe0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00018ff0: 795f 6c61 7374 5f69 6d61 6765 2c20 2744  y_last_image, 'D
-00019000: 4154 455f 4352 4541 5445 4427 2c0d 0a20  ATE_CREATED',.. 
+00018990: 2020 2020 2032 2c20 4b45 595f 5459 5045       2, KEY_TYPE
+000189a0: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
+000189b0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189d0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+000189e0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+000189f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00018a00: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00018a10: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00018a20: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00018a30: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00018a40: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+00018a50: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00018a60: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00018a70: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00018a80: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+00018a90: 6167 655f 322c 2068 6173 685f 6e61 6d65  age_2, hash_name
+00018aa0: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
+00018ab0: 7465 5f65 6e74 6974 795f 6a6f 696e 2c0d  te_entity_join,.
+00018ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ae0: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
+00018af0: 6520 2b20 275f 4849 5354 272c 0d0a 2020  e + '_HIST',..  
+00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b20: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00018b30: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00018b40: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+00018b50: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+00018b60: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00018b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b80: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00018b90: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00018ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bc0: 2020 2020 2020 2020 2032 2c20 4b45 595f           2, KEY_
+00018bd0: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+00018be0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00018bf0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00018c00: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00018c10: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00018c20: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00018c30: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00018c40: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00018c50: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00018c60: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00018c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c80: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00018c90: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00018ca0: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
+00018cb0: 6374 7561 6c5f 696d 6167 655f 322c 2027  ctual_image_2, '
+00018cc0: 4441 5445 5f53 5441 5254 272c 2070 7265  DATE_START', pre
+00018cd0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00018ce0: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
+00018cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d10: 2020 2027 4441 5445 5f53 5441 5254 5f48     'DATE_START_H
+00018d20: 4953 5427 2c0d 0a20 2020 2020 2020 2020  IST',..         
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00018d50: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00018d60: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+00018d70: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
+00018d80: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
+00018d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018db0: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
+00018dc0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
+00018dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018df0: 2020 322c 204b 4559 5f54 5950 455f 4841    2, KEY_TYPE_HA
+00018e00: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
+00018e10: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00018e20: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00018e30: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00018e40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018e50: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00018e60: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+00018e70: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+00018e80: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00018e90: 696e 675d 290d 0a0d 0a0d 0a20 2020 2020  ing])......     
+00018ea0: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
+00018eb0: 2046 696c 7465 7220 746f 2074 6865 2073   Filter to the s
+00018ec0: 6563 6f6e 6420 756e 696f 6e0d 0a20 2020  econd union..   
+00018ed0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00018ee0: 7465 7220 3d20 6861 7368 5f6e 616d 6520  ter = hash_name 
+00018ef0: 2b20 275f 3220 6973 206e 756c 6c27 0d0a  + '_2 is null'..
+00018f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f10: 6e65 775f 6669 6c74 6572 203d 205b 7072  new_filter = [pr
+00018f20: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00018f30: 6e74 6974 795f 6a6f 696e 2c20 6669 6c74  ntity_join, filt
+00018f40: 6572 2c20 322c 2073 656c 662e 6f77 6e65  er, 2, self.owne
+00018f50: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00018f60: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00018f70: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00018f80: 7279 5f66 696c 7465 7273 285b 6e65 775f  ry_filters([new_
+00018f90: 6669 6c74 6572 5d29 0d0a 0d0a 2020 2020  filter])....    
+00018fa0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00018fb0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00018fc0: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
+00018fd0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+00018fe0: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
+00018ff0: 5f73 6f75 7263 6573 2c20 6861 7368 5f6e  _sources, hash_n
+00019000: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
 00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019030: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-00019040: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-00019050: 616c 5f70 6f73 6974 696f 6e2c 2073 7973  al_position, sys
-00019060: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00019070: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
-00019080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019090: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-000190a0: 655f 666f 725f 6d65 7461 6461 7461 5b32  e_for_metadata[2
-000190b0: 5d2c 2031 2c20 4e6f 6e65 2c20 312c 2073  ], 1, None, 1, s
-000190c0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-000190d0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000190e0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000190f0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00019100: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00019110: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00019120: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00019130: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00019140: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
-00019150: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00019160: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00019170: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00019180: 6a6f 696e 2c20 2744 4154 455f 5354 4152  join, 'DATE_STAR
-00019190: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
-000191a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191b0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-000191c0: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-000191d0: 6c61 7374 5f69 6d61 6765 2c20 2744 4154  last_image, 'DAT
-000191e0: 455f 5354 4152 5427 2c0d 0a20 2020 2020  E_START',..     
-000191f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019200: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00019210: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00019220: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
-00019230: 6f73 6974 696f 6e2c 2073 7973 6461 7465  osition, sysdate
-00019240: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-00019250: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00019260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019270: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-00019280: 725f 6d65 7461 6461 7461 5b32 5d2c 2031  r_metadata[2], 1
-00019290: 2c20 4e6f 6e65 2c20 312c 2073 656c 662e  , None, 1, self.
-000192a0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-000192b0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-000192c0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-000192d0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-000192e0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-000192f0: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-00019300: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00019310: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00019320: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00019330: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00019340: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00019350: 7361 7465 5f65 6e74 6974 795f 6a6f 696e  sate_entity_join
-00019360: 2c20 2744 4154 455f 454e 4427 2c0d 0a20  , 'DATE_END',.. 
-00019370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019390: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-000193a0: 7465 5f65 6e74 6974 795f 6c61 7374 5f69  te_entity_last_i
-000193b0: 6d61 6765 2c20 2744 4154 455f 454e 4427  mage, 'DATE_END'
-000193c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000193d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193e0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-000193f0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-00019400: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00019410: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00019420: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019440: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00019450: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00019460: 7461 5b32 5d2c 2031 2c20 4e6f 6e65 2c20  ta[2], 1, None, 
-00019470: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00019480: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019490: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000194a0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000194b0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-000194c0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000194d0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000194e0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000194f0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-00019500: 2020 2020 2069 6620 6861 735f 7273 3a0d       if has_rs:.
-00019510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019520: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00019530: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00019540: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00019550: 6a6f 696e 2c20 7265 636f 7264 5f73 6f75  join, record_sou
-00019560: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-00019570: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195a0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-000195b0: 5f65 6e74 6974 795f 6c61 7374 5f69 6d61  _entity_last_ima
-000195c0: 6765 2c0d 0a20 2020 2020 2020 2020 2020  ge,..           
-000195d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195e0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-000195f0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-00019600: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019630: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00019640: 7263 652e 636f 6c75 6d6e 5f74 7970 655f  rce.column_type_
-00019650: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-00019660: 706f 7369 7469 6f6e 2c0d 0a20 2020 2020  position,..     
-00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019690: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-000196a0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+00019020: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00019030: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00019040: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+00019050: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00019060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019070: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
+00019080: 2c20 224f 5554 4552 204a 4f49 4e22 2c20  , "OUTER JOIN", 
+00019090: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+000190a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000190b0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+000190c0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+000190d0: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
+000190e0: 285b 6e65 775f 7265 6c61 7469 6f6e 7368  ([new_relationsh
+000190f0: 6970 5d29 0d0a 0d0a 0d0a 2020 2020 2020  ip])......      
+00019100: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+00019110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00019120: 2323 2323 2323 2323 2323 2320 5341 5445  ########### SATE
+00019130: 204c 4153 5420 494d 4147 4520 2323 2323   LAST IMAGE ####
+00019140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00019150: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00019160: 2323 2323 230d 0a20 2020 2020 2020 2020  #####..         
+00019170: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00019180: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+00019190: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+000191a0: 795f 6a6f 696e 2c20 6861 7368 5f6e 616d  y_join, hash_nam
+000191b0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+000191c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191d0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+000191e0: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
+000191f0: 6173 745f 696d 6167 652c 2068 6173 685f  ast_image, hash_
+00019200: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019220: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+00019230: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+00019240: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00019250: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+00019260: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+00019270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019280: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00019290: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+000192a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000192b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192c0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+000192d0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+000192e0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+000192f0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00019300: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00019310: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00019320: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00019330: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00019340: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00019350: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00019360: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00019370: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00019380: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
+00019390: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+000193a0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+000193b0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000193c0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+000193d0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+000193e0: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+000193f0: 6f69 6e2c 2027 4441 5445 5f43 5245 4154  oin, 'DATE_CREAT
+00019400: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
+00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019420: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00019430: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00019440: 5f6c 6173 745f 696d 6167 652c 2027 4441  _last_image, 'DA
+00019450: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
+00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019480: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00019490: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+000194a0: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
+000194b0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+000194c0: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
+000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194e0: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+000194f0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00019500: 2c20 312c 204e 6f6e 652c 2031 2c20 7365  , 1, None, 1, se
+00019510: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00019520: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00019530: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00019540: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00019550: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00019560: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00019570: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00019580: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00019590: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000195a0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+000195b0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+000195c0: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+000195d0: 6f69 6e2c 2027 4441 5445 5f53 5441 5254  oin, 'DATE_START
+000195e0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019600: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00019610: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
+00019620: 6173 745f 696d 6167 652c 2027 4441 5445  ast_image, 'DATE
+00019630: 5f53 5441 5254 272c 0d0a 2020 2020 2020  _START',..      
+00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019650: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00019660: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00019670: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+00019680: 7369 7469 6f6e 2c20 7379 7364 6174 655f  sition, sysdate_
+00019690: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+000196a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196d0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-000196e0: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-000196f0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
-00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019710: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-00019720: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
-00019730: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
-00019740: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00019750: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00019760: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00019770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019780: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00019790: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-000197a0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-000197b0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-000197c0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-000197d0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-000197e0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-000197f0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00019800: 7465 5f65 6e74 6974 795f 6a6f 696e 2c20  te_entity_join, 
-00019810: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00019820: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-00019830: 202b 2022 5f48 4953 5422 2c0d 0a20 2020   + "_HIST",..   
-00019840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019860: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-00019870: 7361 7465 5f65 6e74 6974 795f 6c61 7374  sate_entity_last
-00019880: 5f69 6d61 6765 2c0d 0a20 2020 2020 2020  _image,..       
-00019890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198b0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-000198c0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-000198d0: 202b 2022 5f48 4953 5422 2c0d 0a20 2020   + "_HIST",..   
-000198e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019900: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00019910: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00019920: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00019930: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
-00019940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019960: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00019970: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-00019980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199a0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-000199b0: 6365 2e63 6f6c 756d 6e5f 7072 6563 6973  ce.column_precis
-000199c0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+000196c0: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+000196d0: 5f6d 6574 6164 6174 615b 325d 2c20 312c  _metadata[2], 1,
+000196e0: 204e 6f6e 652c 2031 2c20 7365 6c66 2e6f   None, 1, self.o
+000196f0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00019700: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00019710: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00019720: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00019730: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00019740: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+00019750: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00019760: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00019770: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00019780: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00019790: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+000197a0: 6174 655f 656e 7469 7479 5f6a 6f69 6e2c  ate_entity_join,
+000197b0: 2027 4441 5445 5f45 4e44 272c 0d0a 2020   'DATE_END',..  
+000197c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197e0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+000197f0: 655f 656e 7469 7479 5f6c 6173 745f 696d  e_entity_last_im
+00019800: 6167 652c 2027 4441 5445 5f45 4e44 272c  age, 'DATE_END',
+00019810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019830: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+00019840: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00019850: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00019860: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00019870: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00019880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019890: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+000198a0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+000198b0: 615b 325d 2c20 312c 204e 6f6e 652c 2031  a[2], 1, None, 1
+000198c0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000198d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000198e0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000198f0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00019900: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00019910: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00019920: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+00019930: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00019940: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+00019950: 2020 2020 6966 2068 6173 5f72 733a 0d0a      if has_rs:..
+00019960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019970: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00019980: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00019990: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+000199a0: 6f69 6e2c 2072 6563 6f72 645f 736f 7572  oin, record_sour
+000199b0: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
+000199c0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
 000199d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199e0: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
-000199f0: 4b45 595f 5459 5045 5f52 4543 4f52 445f  KEY_TYPE_RECORD_
-00019a00: 534f 5552 4345 2c20 312c 2073 656c 662e  SOURCE, 1, self.
-00019a10: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00019a20: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00019a30: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-00019a40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00019a50: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00019a60: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-00019a70: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00019a80: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00019a90: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
-00019aa0: 2020 2020 2069 6620 6861 735f 746e 3a0d       if has_tn:.
-00019ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019ac0: 2066 6f72 2074 6e20 696e 2074 656e 616e   for tn in tenan
-00019ad0: 745f 736f 7572 6365 3a0d 0a20 2020 2020  t_source:..     
-00019ae0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00019af0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00019b00: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00019b10: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
-00019b20: 696e 2c20 746e 2e63 6f6c 756d 6e5f 6e61  in, tn.column_na
-00019b30: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-00019b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000199f0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00019a00: 656e 7469 7479 5f6c 6173 745f 696d 6167  entity_last_imag
+00019a10: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00019a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a30: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00019a40: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+00019a50: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+00019a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a80: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+00019a90: 6365 2e63 6f6c 756d 6e5f 7479 7065 5f74  ce.column_type_t
+00019aa0: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
+00019ab0: 6f73 6974 696f 6e2c 0d0a 2020 2020 2020  osition,..      
+00019ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ae0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00019af0: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00019b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b20: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+00019b30: 7263 652e 636f 6c75 6d6e 5f70 7265 6369  rce.column_preci
+00019b40: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
 00019b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b60: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-00019b70: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
-00019b80: 6173 745f 696d 6167 652c 0d0a 2020 2020  ast_image,..    
-00019b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bb0: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-00019bc0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00019bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bf0: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-00019c00: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-00019c10: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00019c20: 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c 656e  n, tn.column_len
-00019c30: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00019c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c60: 2074 6e2e 636f 6c75 6d6e 5f70 7265 6369   tn.column_preci
-00019c70: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-00019c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b60: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00019b70: 204b 4559 5f54 5950 455f 5245 434f 5244   KEY_TYPE_RECORD
+00019b80: 5f53 4f55 5243 452c 2031 2c20 7365 6c66  _SOURCE, 1, self
+00019b90: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00019ba0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+00019bb0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bd0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00019be0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00019bf0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00019c00: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00019c10: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00019c20: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00019c30: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00019c40: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00019c50: 655f 656e 7469 7479 5f6a 6f69 6e2c 2072  e_entity_join, r
+00019c60: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00019c70: 756d 6e5f 6e61 6d65 5f74 6172 6765 7420  umn_name_target 
+00019c80: 2b20 225f 4849 5354 222c 0d0a 2020 2020  + "_HIST",..    
 00019c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ca0: 2020 312c 204b 4559 5f54 5950 455f 5445    1, KEY_TYPE_TE
-00019cb0: 4e41 4e54 2c20 312c 2073 656c 662e 6f77  NANT, 1, self.ow
-00019cc0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00019cd0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00019ce0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00019cf0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00019d00: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-00019d10: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-00019d20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019d30: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00019d40: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-00019d50: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-00019d60: 735f 6164 3a0d 0a20 2020 2020 2020 2020  s_ad:..         
-00019d70: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00019d80: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-00019d90: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00019da0: 6e74 6974 795f 6a6f 696e 2c20 6170 706c  ntity_join, appl
-00019db0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-00019dc0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+00019ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cb0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+00019cc0: 6174 655f 656e 7469 7479 5f6c 6173 745f  ate_entity_last_
+00019cd0: 696d 6167 652c 0d0a 2020 2020 2020 2020  image,..        
+00019ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019cf0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00019d00: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00019d10: 756d 6e5f 6e61 6d65 5f74 6172 6765 7420  umn_name_target 
+00019d20: 2b20 225f 4849 5354 222c 0d0a 2020 2020  + "_HIST",..    
+00019d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d50: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00019d60: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00019d70: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00019d80: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
+00019d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019da0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00019db0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00019dc0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
 00019dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019df0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00019e00: 2073 6174 655f 656e 7469 7479 5f6c 6173   sate_entity_las
-00019e10: 745f 696d 6167 652c 0d0a 2020 2020 2020  t_image,..      
+00019df0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+00019e00: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+00019e10: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
 00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e40: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00019e50: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-00019e60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e80: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-00019e90: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
-00019ea0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-00019eb0: 616c 5f70 6f73 6974 696f 6e2c 0d0a 2020  al_position,..  
-00019ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ee0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00019ef0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00019f00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f20: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00019f30: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
-00019f40: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f70: 312c 204b 4559 5f54 5950 455f 4150 504c  1, KEY_TYPE_APPL
-00019f80: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
-00019f90: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00019fa0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00019fb0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00019fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019fd0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00019fe0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00019ff0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0001a000: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0001a010: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-0001a020: 2020 2020 2020 2069 6e74 6567 6572 5f66         integer_f
-0001a030: 6f72 5f6d 6574 6164 6174 6120 3d20 7365  or_metadata = se
-0001a040: 6c66 2e63 6f6e 6e65 6374 696f 6e2e 6765  lf.connection.ge
-0001a050: 745f 696e 7465 6765 725f 666f 725f 6d65  t_integer_for_me
-0001a060: 7461 6461 7461 2829 0d0a 2020 2020 2020  tadata()..      
-0001a070: 2020 2020 2020 6461 7465 5f66 6f72 5f6c        date_for_l
-0001a080: 6173 745f 696d 6167 6520 3d20 2744 4154  ast_image = 'DAT
-0001a090: 455f 4352 4541 5445 4427 0d0a 2020 2020  E_CREATED'..    
-0001a0a0: 2020 2020 2020 2020 6966 2068 6173 5f61          if has_a
-0001a0b0: 643a 2064 6174 655f 666f 725f 6c61 7374  d: date_for_last
-0001a0c0: 5f69 6d61 6765 203d 2061 7070 6c69 6564  _image = applied
-0001a0d0: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
-0001a0e0: 655f 7461 7267 6574 0d0a 2020 2020 2020  e_target..      
-0001a0f0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-0001a100: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-0001a110: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-0001a120: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
-0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a140: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001a150: 524f 575f 4e55 4d42 4552 2829 206f 7665  ROW_NUMBER() ove
-0001a160: 7220 2870 6172 7469 7469 6f6e 2062 7920  r (partition by 
-0001a170: 2720 2b20 6861 7368 5f6e 616d 6520 2b20  ' + hash_name + 
-0001a180: 272c 272b 2068 6173 685f 6e61 6d65 202b  ','+ hash_name +
-0001a190: 2027 5f48 4953 5420 4f52 4445 5220 4259   '_HIST ORDER BY
-0001a1a0: 2027 202b 2064 6174 655f 666f 725f 6c61   ' + date_for_la
-0001a1b0: 7374 5f69 6d61 6765 202b 2027 2064 6573  st_image + ' des
-0001a1c0: 6329 272c 0d0a 2020 2020 2020 2020 2020  c)',..          
-0001a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1e0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-0001a1f0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-0001a200: 5f6c 6173 745f 696d 6167 652c 2027 524e  _last_image, 'RN
-0001a210: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00019e30: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+00019e40: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
+00019e50: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
+00019e60: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00019e70: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00019e80: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+00019e90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00019ea0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00019eb0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00019ec0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00019ed0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00019ee0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+00019ef0: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
+00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f10: 666f 7220 746e 2069 6e20 7465 6e61 6e74  for tn in tenant
+00019f20: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
+00019f30: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00019f40: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00019f50: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+00019f60: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
+00019f70: 6e2c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  n, tn.column_nam
+00019f80: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+00019f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fb0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+00019fc0: 2b20 7361 7465 5f65 6e74 6974 795f 6c61  + sate_entity_la
+00019fd0: 7374 5f69 6d61 6765 2c0d 0a20 2020 2020  st_image,..     
+00019fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a000: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+0001a010: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+0001a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a040: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+0001a050: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+0001a060: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001a070: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
+0001a080: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0b0: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
+0001a0c0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0001a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0f0: 2031 2c20 4b45 595f 5459 5045 5f54 454e   1, KEY_TYPE_TEN
+0001a100: 414e 542c 2031 2c20 7365 6c66 2e6f 776e  ANT, 1, self.own
+0001a110: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001a120: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0001a130: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0001a140: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+0001a150: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+0001a160: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+0001a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a180: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001a190: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0001a1a0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0001a1b0: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
+0001a1c0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0001a1d0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0001a1e0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+0001a1f0: 7469 7479 5f6a 6f69 6e2c 2061 7070 6c69  tity_join, appli
+0001a200: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+0001a210: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
 0001a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a230: 2020 2020 2020 2069 6e74 6567 6572 5f66         integer_f
-0001a240: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-0001a250: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0001a260: 2c20 696e 7465 6765 725f 666f 725f 6d65  , integer_for_me
-0001a270: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+0001a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a240: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0001a250: 7361 7465 5f65 6e74 6974 795f 6c61 7374  sate_entity_last
+0001a260: 5f69 6d61 6765 2c0d 0a20 2020 2020 2020  _image,..       
+0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a2a0: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
-0001a2b0: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
+0001a290: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+0001a2a0: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+0001a2b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0001a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2d0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-0001a2e0: 4559 5f54 5950 455f 4e55 4c4c 2c20 312c  EY_TYPE_NULL, 1,
-0001a2f0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0001a300: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0001a310: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0001a320: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-0001a330: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-0001a340: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-0001a350: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-0001a360: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0001a370: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
-0001a380: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0001a390: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-0001a3a0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-0001a3b0: 795f 6a6f 696e 2c20 6861 7368 5f6e 616d  y_join, hash_nam
-0001a3c0: 6520 2b20 275f 4849 5354 272c 2070 7265  e + '_HIST', pre
-0001a3d0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-0001a3e0: 7469 7479 5f6c 6173 745f 696d 6167 652c  tity_last_image,
-0001a3f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a410: 2020 2020 2068 6173 685f 6e61 6d65 202b       hash_name +
-0001a420: 2027 5f48 4953 5427 2c0d 0a20 2020 2020   '_HIST',..     
-0001a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a440: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0001a450: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0001a460: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-0001a470: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
-0001a480: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
-0001a490: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-0001a4a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4c0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-0001a4d0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-0001a4e0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0001a4f0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0001a500: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-0001a510: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001a520: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0001a530: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0001a540: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0001a550: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0001a560: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0001a570: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0001a580: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0001a590: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-0001a5a0: 6a6f 696e 2c20 2744 4154 455f 5354 4152  join, 'DATE_STAR
-0001a5b0: 545f 4849 5354 272c 0d0a 2020 2020 2020  T_HIST',..      
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5d0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0001a5e0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-0001a5f0: 7469 7479 5f6c 6173 745f 696d 6167 652c  tity_last_image,
-0001a600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a620: 2020 2020 2027 4441 5445 5f53 5441 5254       'DATE_START
-0001a630: 5f48 4953 5427 2c0d 0a20 2020 2020 2020  _HIST',..       
-0001a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a650: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-0001a660: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-0001a670: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0001a680: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
-0001a690: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
-0001a6a0: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
-0001a6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6d0: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-0001a6e0: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
-0001a6f0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0001a700: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0001a710: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-0001a720: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0001a730: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0001a740: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0001a750: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0001a760: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0001a770: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0001a780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a7a0: 2323 2323 2320 5341 5445 2020 2323 2323  ##### SATE  ####
-0001a7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a7c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a7d0: 2323 0d0a 2020 2020 2020 2020 2020 2020  ##..            
-0001a7e0: 2320 4272 616e 6368 2031 3a20 496e 7365  # Branch 1: Inse
-0001a7f0: 7274 2069 6620 6f6e 6c79 2065 7869 7374  rt if only exist
-0001a800: 7320 6f6e 2073 6f75 7263 650d 0a20 2020  s on source..   
-0001a810: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-0001a820: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-0001a830: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-0001a840: 5f65 6e74 6974 795f 6c61 7374 5f69 6d61  _entity_last_ima
-0001a850: 6765 2c20 6861 7368 5f6e 616d 652c 0d0a  ge, hash_name,..
-0001a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a880: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0001a890: 6174 655f 656e 7469 7479 2c20 6861 7368  ate_entity, hash
-0001a8a0: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8c0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0001a8d0: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-0001a8e0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001a8f0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-0001a900: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
-0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a920: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0001a930: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
-0001a940: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0001a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a960: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-0001a970: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-0001a980: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0001a990: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-0001a9a0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0001a9b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001a9c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0001a9d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0001a9e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0001a9f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001aa00: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-0001aa10: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-0001aa20: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
-0001aa30: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-0001aa40: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-0001aa50: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-0001aa60: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0001aa70: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0001aa80: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-0001aa90: 6c61 7374 5f69 6d61 6765 2c20 2744 4154  last_image, 'DAT
-0001aaa0: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
-0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aad0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-0001aae0: 5f65 6e74 6974 792c 2027 4441 5445 5f43  _entity, 'DATE_C
-0001aaf0: 5245 4154 4544 272c 0d0a 2020 2020 2020  REATED',..      
+0001a2d0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+0001a2e0: 5f64 6174 652e 636f 6c75 6d6e 5f74 7970  _date.column_typ
+0001a2f0: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+0001a300: 6c5f 706f 7369 7469 6f6e 2c0d 0a20 2020  l_position,..   
+0001a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a330: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0001a340: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+0001a350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a370: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0001a380: 6461 7465 2e63 6f6c 756d 6e5f 7072 6563  date.column_prec
+0001a390: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3b0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+0001a3c0: 2c20 4b45 595f 5459 5045 5f41 5050 4c49  , KEY_TYPE_APPLI
+0001a3d0: 4544 5f44 4154 452c 2031 2c20 7365 6c66  ED_DATE, 1, self
+0001a3e0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0001a3f0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+0001a400: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0001a410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a420: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0001a430: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0001a440: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+0001a450: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+0001a460: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+0001a470: 2020 2020 2020 696e 7465 6765 725f 666f        integer_fo
+0001a480: 725f 6d65 7461 6461 7461 203d 2073 656c  r_metadata = sel
+0001a490: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
+0001a4a0: 5f69 6e74 6567 6572 5f66 6f72 5f6d 6574  _integer_for_met
+0001a4b0: 6164 6174 6128 290d 0a20 2020 2020 2020  adata()..       
+0001a4c0: 2020 2020 2064 6174 655f 666f 725f 6c61       date_for_la
+0001a4d0: 7374 5f69 6d61 6765 203d 2027 4441 5445  st_image = 'DATE
+0001a4e0: 5f43 5245 4154 4544 270d 0a20 2020 2020  _CREATED'..     
+0001a4f0: 2020 2020 2020 2069 6620 6861 735f 6164         if has_ad
+0001a500: 3a20 6461 7465 5f66 6f72 5f6c 6173 745f  : date_for_last_
+0001a510: 696d 6167 6520 3d20 6170 706c 6965 645f  image = applied_
+0001a520: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
+0001a530: 5f74 6172 6765 740d 0a20 2020 2020 2020  _target..       
+0001a540: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0001a550: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+0001a560: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+0001a570: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
+0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a590: 2020 2020 2020 2020 2020 2020 2020 2752                'R
+0001a5a0: 4f57 5f4e 554d 4245 5228 2920 6f76 6572  OW_NUMBER() over
+0001a5b0: 2028 7061 7274 6974 696f 6e20 6279 2027   (partition by '
+0001a5c0: 202b 2068 6173 685f 6e61 6d65 202b 2027   + hash_name + '
+0001a5d0: 2c27 2b20 6861 7368 5f6e 616d 6520 2b20  ,'+ hash_name + 
+0001a5e0: 275f 4849 5354 204f 5244 4552 2042 5920  '_HIST ORDER BY 
+0001a5f0: 2720 2b20 6461 7465 5f66 6f72 5f6c 6173  ' + date_for_las
+0001a600: 745f 696d 6167 6520 2b20 2720 6465 7363  t_image + ' desc
+0001a610: 2927 2c0d 0a20 2020 2020 2020 2020 2020  )',..           
+0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a630: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0001a640: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+0001a650: 6c61 7374 5f69 6d61 6765 2c20 2752 4e27  last_image, 'RN'
+0001a660: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a680: 2020 2020 2020 696e 7465 6765 725f 666f        integer_fo
+0001a690: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+0001a6a0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0001a6b0: 2069 6e74 6567 6572 5f66 6f72 5f6d 6574   integer_for_met
+0001a6c0: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
+0001a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001a6f0: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
+0001a700: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
+0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a720: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+0001a730: 595f 5459 5045 5f4e 554c 4c2c 2031 2c20  Y_TYPE_NULL, 1, 
+0001a740: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0001a750: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0001a760: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0001a770: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+0001a780: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+0001a790: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+0001a7a0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0001a7b0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0001a7c0: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
+0001a7d0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0001a7e0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0001a7f0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+0001a800: 5f6a 6f69 6e2c 2068 6173 685f 6e61 6d65  _join, hash_name
+0001a810: 202b 2027 5f48 4953 5427 2c20 7072 6566   + '_HIST', pref
+0001a820: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+0001a830: 6974 795f 6c61 7374 5f69 6d61 6765 2c0d  ity_last_image,.
+0001a840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a860: 2020 2020 6861 7368 5f6e 616d 6520 2b20      hash_name + 
+0001a870: 275f 4849 5354 272c 0d0a 2020 2020 2020  '_HIST',..      
+0001a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a890: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0001a8a0: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+0001a8b0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+0001a8c0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+0001a8d0: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
+0001a8e0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0001a8f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a910: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+0001a920: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+0001a930: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0001a940: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0001a950: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+0001a960: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0001a970: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0001a980: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0001a990: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0001a9a0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0001a9b0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0001a9c0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0001a9d0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0001a9e0: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+0001a9f0: 6f69 6e2c 2027 4441 5445 5f53 5441 5254  oin, 'DATE_START
+0001aa00: 5f48 4953 5427 2c0d 0a20 2020 2020 2020  _HIST',..       
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa20: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0001aa30: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+0001aa40: 6974 795f 6c61 7374 5f69 6d61 6765 2c0d  ity_last_image,.
+0001aa50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa70: 2020 2020 2744 4154 455f 5354 4152 545f      'DATE_START_
+0001aa80: 4849 5354 272c 0d0a 2020 2020 2020 2020  HIST',..        
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaa0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+0001aab0: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+0001aac0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0001aad0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
+0001aae0: 6461 7461 5b31 5d2c 2068 6173 685f 666f  data[1], hash_fo
+0001aaf0: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
 0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab10: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0001ab20: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-0001ab30: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
-0001ab40: 7369 7469 6f6e 2c20 7379 7364 6174 655f  sition, sysdate_
-0001ab50: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-0001ab60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab80: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-0001ab90: 5f6d 6574 6164 6174 615b 325d 2c20 312c  _metadata[2], 1,
-0001aba0: 204e 6f6e 652c 2031 2c20 7365 6c66 2e6f   None, 1, self.o
-0001abb0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0001abc0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001abd0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001abe0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0001abf0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0001ac00: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0001ac10: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0001ac20: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-0001ac30: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0001ac40: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0001ac50: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0001ac60: 6174 655f 656e 7469 7479 5f6c 6173 745f  ate_entity_last_
-0001ac70: 696d 6167 652c 2027 4441 5445 5f53 5441  image, 'DATE_STA
-0001ac80: 5254 272c 0d0a 2020 2020 2020 2020 2020  RT',..          
-0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aca0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-0001acb0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-0001acc0: 2c20 2744 4154 455f 5354 4152 5427 2c0d  , 'DATE_START',.
-0001acd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acf0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0001ad00: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-0001ad10: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
-0001ad20: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0001ad30: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
-0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad50: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-0001ad60: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-0001ad70: 5b32 5d2c 2031 2c20 4e6f 6e65 2c20 312c  [2], 1, None, 1,
-0001ad80: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0001ad90: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0001ada0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0001adb0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-0001adc0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-0001add0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-0001ade0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-0001adf0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0001ae00: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
-0001ae10: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0001ae20: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-0001ae30: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-0001ae40: 795f 6c61 7374 5f69 6d61 6765 2c20 2744  y_last_image, 'D
-0001ae50: 4154 455f 454e 4427 2c0d 0a20 2020 2020  ATE_END',..     
-0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001ae80: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-0001ae90: 6e74 6974 792c 2027 4441 5445 5f45 4e44  ntity, 'DATE_END
-0001aea0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aec0: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
-0001aed0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-0001aee0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0001aef0: 2c20 7379 7364 6174 655f 666f 725f 6d65  , sysdate_for_me
-0001af00: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
-0001af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001af30: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0001af40: 6174 615b 325d 2c20 312c 204e 6f6e 652c  ata[2], 1, None,
-0001af50: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0001af60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001af70: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0001af80: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0001af90: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0001afa0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001afb0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
-0001afc0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001afd0: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
-0001afe0: 2020 2020 2020 6966 2068 6173 5f72 733a        if has_rs:
-0001aff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b000: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0001b010: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0001b020: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-0001b030: 5f6c 6173 745f 696d 6167 652c 2072 6563  _last_image, rec
-0001b040: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-0001b050: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b080: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0001b090: 202b 2073 6174 655f 656e 7469 7479 2c0d   + sate_entity,.
-0001b0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0c0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-0001b0d0: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-0001b0e0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b110: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-0001b120: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-0001b130: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-0001b140: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
-0001b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b160: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001b170: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-0001b180: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab20: 2020 2031 2c20 4b45 595f 5459 5045 5f48     1, KEY_TYPE_H
+0001ab30: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
+0001ab40: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0001ab50: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001ab60: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+0001ab70: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0001ab80: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0001ab90: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0001aba0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0001abb0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0001abc0: 0d0a 2020 2020 2020 2020 2020 2020 2323  ..            ##
+0001abd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001abe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001abf0: 2323 2323 2053 4154 4520 2023 2323 2323  #### SATE  #####
+0001ac00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ac10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ac20: 230d 0a20 2020 2020 2020 2020 2020 2023  #..            #
+0001ac30: 2042 7261 6e63 6820 313a 2049 6e73 6572   Branch 1: Inser
+0001ac40: 7420 6966 206f 6e6c 7920 6578 6973 7473  t if only exists
+0001ac50: 206f 6e20 736f 7572 6365 0d0a 2020 2020   on source..    
+0001ac60: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0001ac70: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+0001ac80: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+0001ac90: 656e 7469 7479 5f6c 6173 745f 696d 6167  entity_last_imag
+0001aca0: 652c 2068 6173 685f 6e61 6d65 2c0d 0a20  e, hash_name,.. 
+0001acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acd0: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+0001ace0: 7465 5f65 6e74 6974 792c 2068 6173 685f  te_entity, hash_
+0001acf0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad10: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+0001ad20: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0001ad30: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001ad40: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0001ad50: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+0001ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad70: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0001ad80: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+0001ad90: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adb0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+0001adc0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+0001add0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0001ade0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0001adf0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+0001ae00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001ae10: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0001ae20: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0001ae30: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0001ae40: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0001ae50: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0001ae60: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+0001ae70: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
+0001ae80: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+0001ae90: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+0001aea0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0001aeb0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0001aec0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0001aed0: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
+0001aee0: 6173 745f 696d 6167 652c 2027 4441 5445  ast_image, 'DATE
+0001aef0: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
+0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001af20: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+0001af30: 656e 7469 7479 2c20 2744 4154 455f 4352  entity, 'DATE_CR
+0001af40: 4541 5445 4427 2c0d 0a20 2020 2020 2020  EATED',..       
+0001af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af60: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+0001af70: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+0001af80: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
+0001af90: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
+0001afa0: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
+0001afb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afd0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+0001afe0: 6d65 7461 6461 7461 5b32 5d2c 2031 2c20  metadata[2], 1, 
+0001aff0: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
+0001b000: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0001b010: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001b020: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001b030: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001b040: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0001b050: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0001b060: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0001b070: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+0001b080: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0001b090: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0001b0a0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0001b0b0: 7465 5f65 6e74 6974 795f 6c61 7374 5f69  te_entity_last_i
+0001b0c0: 6d61 6765 2c20 2744 4154 455f 5354 4152  mage, 'DATE_STAR
+0001b0d0: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
+0001b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0f0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0001b100: 7420 2b20 7361 7465 5f65 6e74 6974 792c  t + sate_entity,
+0001b110: 2027 4441 5445 5f53 5441 5254 272c 0d0a   'DATE_START',..
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+0001b150: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+0001b160: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7379  nal_position, sy
+0001b170: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+0001b180: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
 0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1b0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-0001b1c0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-0001b1d0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0001b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1f0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-0001b200: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
-0001b210: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
-0001b220: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001b230: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0001b240: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-0001b250: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001b260: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0001b270: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0001b280: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0001b290: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001b2a0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
-0001b2b0: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
-0001b2c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001b2d0: 6f72 2074 6e20 696e 2074 656e 616e 745f  or tn in tenant_
-0001b2e0: 736f 7572 6365 3a0d 0a20 2020 2020 2020  source:..       
-0001b2f0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0001b300: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001b310: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0001b320: 7361 7465 5f65 6e74 6974 795f 6c61 7374  sate_entity_last
-0001b330: 5f69 6d61 6765 2c20 746e 2e63 6f6c 756d  _image, tn.colum
-0001b340: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1a0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+0001b1b0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+0001b1c0: 325d 2c20 312c 204e 6f6e 652c 2031 2c20  2], 1, None, 1, 
+0001b1d0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0001b1e0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0001b1f0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0001b200: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+0001b210: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+0001b220: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+0001b230: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0001b240: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0001b250: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
+0001b260: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0001b270: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0001b280: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+0001b290: 5f6c 6173 745f 696d 6167 652c 2027 4441  _last_image, 'DA
+0001b2a0: 5445 5f45 4e44 272c 0d0a 2020 2020 2020  TE_END',..      
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0001b2d0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+0001b2e0: 7469 7479 2c20 2744 4154 455f 454e 4427  tity, 'DATE_END'
+0001b2f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b310: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
+0001b320: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+0001b330: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0001b340: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+0001b350: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
 0001b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b370: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0001b380: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-0001b390: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-0001b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3c0: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
-0001b3d0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b400: 2020 2074 6e2e 636f 6c75 6d6e 5f74 7970     tn.column_typ
-0001b410: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-0001b420: 6c5f 706f 7369 7469 6f6e 2c20 746e 2e63  l_position, tn.c
-0001b430: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-0001b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b460: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-0001b470: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-0001b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4a0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-0001b4b0: 595f 5459 5045 5f54 454e 414e 542c 2031  Y_TYPE_TENANT, 1
-0001b4c0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4e0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001b4f0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001b500: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0001b510: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0001b520: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0001b530: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0001b540: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0001b550: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-0001b560: 2020 2020 6966 2068 6173 5f61 643a 0d0a      if has_ad:..
-0001b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b580: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001b590: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0001b5a0: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
-0001b5b0: 6173 745f 696d 6167 652c 2061 7070 6c69  ast_image, appli
-0001b5c0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-0001b5d0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0001b370: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0001b380: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+0001b390: 7461 5b32 5d2c 2031 2c20 4e6f 6e65 2c20  ta[2], 1, None, 
+0001b3a0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0001b3b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001b3c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0001b3d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0001b3e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0001b3f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001b400: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0001b410: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001b420: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+0001b430: 2020 2020 2069 6620 6861 735f 7273 3a0d       if has_rs:.
+0001b440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b450: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0001b460: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0001b470: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+0001b480: 6c61 7374 5f69 6d61 6765 2c20 7265 636f  last_image, reco
+0001b490: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+0001b4a0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0001b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4d0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+0001b4e0: 2b20 7361 7465 5f65 6e74 6974 792c 0d0a  + sate_entity,..
+0001b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b510: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+0001b520: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+0001b530: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+0001b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b560: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+0001b570: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+0001b580: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+0001b590: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5b0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+0001b5c0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+0001b5d0: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
 0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b600: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-0001b610: 7361 7465 5f65 6e74 6974 792c 0d0a 2020  sate_entity,..  
-0001b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b600: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
+0001b610: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+0001b620: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0001b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b640: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-0001b650: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-0001b660: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-0001b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b680: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-0001b690: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
-0001b6a0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-0001b6b0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0001b6c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6e0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-0001b6f0: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
-0001b700: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0001b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b720: 2020 2020 2020 2020 2020 2020 2061 7070               app
-0001b730: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-0001b740: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-0001b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b770: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-0001b780: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
-0001b790: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0001b7a0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0001b7b0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0001b7c0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0001b7d0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0001b7e0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-0001b7f0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-0001b800: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-0001b810: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-0001b820: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0001b830: 7220 3d20 6861 7368 5f6e 616d 6520 2b20  r = hash_name + 
-0001b840: 225f 4849 5354 2069 7320 6e75 6c6c 2061  "_HIST is null a
-0001b850: 6e64 2052 4e20 3d20 3122 0d0a 2020 2020  nd RN = 1"..    
-0001b860: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
-0001b870: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
-0001b880: 2b20 7361 7465 5f65 6e74 6974 792c 2066  + sate_entity, f
-0001b890: 696c 7465 722c 2031 2c20 7365 6c66 2e6f  ilter, 1, self.o
-0001b8a0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0001b8b0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001b8c0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001b8d0: 795f 6669 6c74 6572 7328 5b6e 6577 5f66  y_filters([new_f
-0001b8e0: 696c 7465 725d 290d 0a0d 0a20 2020 2020  ilter])....     
-0001b8f0: 2020 2020 2020 2023 2042 7261 6e63 6820         # Branch 
-0001b900: 323a 2049 6e73 6572 7420 6966 206f 6e6c  2: Insert if onl
-0001b910: 7920 6578 6973 7473 206f 6e20 7461 7267  y exists on targ
-0001b920: 6574 0d0a 2020 2020 2020 2020 2020 2020  et..            
-0001b930: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001b940: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0001b950: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
-0001b960: 6173 745f 696d 6167 652c 2068 6173 685f  ast_image, hash_
-0001b970: 6e61 6d65 2b22 5f48 4953 5422 2c0d 0a20  name+"_HIST",.. 
-0001b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9a0: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-0001b9b0: 7465 5f65 6e74 6974 792c 2068 6173 685f  te_entity, hash_
-0001b9c0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9e0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-0001b9f0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-0001ba00: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0001ba10: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0001ba20: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+0001b640: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+0001b650: 5f54 5950 455f 5245 434f 5244 5f53 4f55  _TYPE_RECORD_SOU
+0001b660: 5243 452c 2031 2c20 7365 6c66 2e6f 776e  RCE, 1, self.own
+0001b670: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001b680: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001b690: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+0001b6a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001b6b0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0001b6c0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0001b6d0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0001b6e0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001b6f0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+0001b700: 2020 6966 2068 6173 5f74 6e3a 0d0a 2020    if has_tn:..  
+0001b710: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001b720: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
+0001b730: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
+0001b740: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0001b750: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0001b760: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0001b770: 6174 655f 656e 7469 7479 5f6c 6173 745f  ate_entity_last_
+0001b780: 696d 6167 652c 2074 6e2e 636f 6c75 6d6e  image, tn.column
+0001b790: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0001b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7c0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0001b7d0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+0001b7e0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b800: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001b810: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
+0001b820: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0001b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b850: 2020 746e 2e63 6f6c 756d 6e5f 7479 7065    tn.column_type
+0001b860: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+0001b870: 5f70 6f73 6974 696f 6e2c 2074 6e2e 636f  _position, tn.co
+0001b880: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8b0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+0001b8c0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+0001b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8f0: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+0001b900: 5f54 5950 455f 5445 4e41 4e54 2c20 312c  _TYPE_TENANT, 1,
+0001b910: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0001b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b930: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001b940: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001b950: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001b960: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0001b970: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0001b980: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0001b990: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0001b9a0: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
+0001b9b0: 2020 2069 6620 6861 735f 6164 3a0d 0a20     if has_ad:.. 
+0001b9c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001b9d0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001b9e0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0001b9f0: 2b20 7361 7465 5f65 6e74 6974 795f 6c61  + sate_entity_la
+0001ba00: 7374 5f69 6d61 6765 2c20 6170 706c 6965  st_image, applie
+0001ba10: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+0001ba20: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
 0001ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba40: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-0001ba50: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-0001ba60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba50: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+0001ba60: 6174 655f 656e 7469 7479 2c0d 0a20 2020  ate_entity,..   
 0001ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba80: 2020 2020 2020 322c 204b 4559 5f54 5950        2, KEY_TYP
-0001ba90: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-0001baa0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0001bab0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0001bac0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-0001bad0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001bae0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0001baf0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0001bb00: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0001bb10: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0001bb20: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0001bb30: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-0001bb40: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
-0001bb50: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
-0001bb60: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-0001bb70: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0001bb80: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001bb90: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0001bba0: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
-0001bbb0: 6173 745f 696d 6167 652c 2027 4441 5445  ast_image, 'DATE
-0001bbc0: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
-0001bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbe0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001bbf0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-0001bc00: 656e 7469 7479 2c20 2744 4154 455f 4352  entity, 'DATE_CR
-0001bc10: 4541 5445 4427 2c0d 0a20 2020 2020 2020  EATED',..       
-0001bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc30: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-0001bc40: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-0001bc50: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-0001bc60: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
-0001bc70: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-0001bc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bca0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0001bcb0: 6d65 7461 6461 7461 5b32 5d2c 2032 2c20  metadata[2], 2, 
-0001bcc0: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
-0001bcd0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001bce0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0001bcf0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0001bd00: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001bd10: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0001bd20: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-0001bd30: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0001bd40: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-0001bd50: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-0001bd60: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-0001bd70: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-0001bd80: 7465 5f65 6e74 6974 795f 6c61 7374 5f69  te_entity_last_i
-0001bd90: 6d61 6765 2c20 2744 4154 455f 5354 4152  mage, 'DATE_STAR
-0001bda0: 545f 4849 5354 272c 0d0a 2020 2020 2020  T_HIST',..      
-0001bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdc0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0001bdd0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-0001bde0: 7469 7479 2c20 2744 4154 455f 5354 4152  tity, 'DATE_STAR
-0001bdf0: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-0001be20: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-0001be30: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001be40: 6e2c 2073 7973 6461 7465 5f66 6f72 5f6d  n, sysdate_for_m
-0001be50: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
-0001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-0001be90: 6461 7461 5b32 5d2c 2032 2c20 4e6f 6e65  data[2], 2, None
-0001bea0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-0001beb0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0001bec0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0001bed0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0001bee0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0001bef0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0001bf00: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-0001bf10: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0001bf20: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-0001bf30: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0001bf40: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0001bf50: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-0001bf60: 6e74 6974 795f 6c61 7374 5f69 6d61 6765  ntity_last_image
-0001bf70: 2c20 2744 4154 455f 5354 4152 5427 2c0d  , 'DATE_START',.
-0001bf80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfa0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-0001bfb0: 7361 7465 5f65 6e74 6974 792c 2027 4441  sate_entity, 'DA
-0001bfc0: 5445 5f45 4e44 272c 0d0a 2020 2020 2020  TE_END',..      
-0001bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfe0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0001bff0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-0001c000: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
-0001c010: 7369 7469 6f6e 2c20 7379 7364 6174 655f  sition, sysdate_
-0001c020: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-0001c030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c050: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-0001c060: 5f6d 6574 6164 6174 615b 325d 2c20 322c  _metadata[2], 2,
-0001c070: 204e 6f6e 652c 2031 2c20 7365 6c66 2e6f   None, 1, self.o
-0001c080: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0001c090: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001c0a0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001c0b0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0001c0c0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0001c0d0: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0001c0e0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0001c0f0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-0001c100: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0001c110: 6173 5f72 733a 0d0a 2020 2020 2020 2020  as_rs:..        
-0001c120: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0001c130: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0001c140: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-0001c150: 656e 7469 7479 5f6c 6173 745f 696d 6167  entity_last_imag
-0001c160: 652c 2072 6563 6f72 645f 736f 7572 6365  e, record_source
-0001c170: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0001c180: 6765 7420 2b20 225f 4849 5354 222c 0d0a  get + "_HIST",..
-0001c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1b0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0001c1c0: 202b 2073 6174 655f 656e 7469 7479 2c0d   + sate_entity,.
-0001c1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1f0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-0001c200: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-0001c210: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-0001c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c240: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-0001c250: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-0001c260: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-0001c270: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
-0001c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c290: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001c2a0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-0001c2b0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2e0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-0001c2f0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-0001c300: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0001c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c320: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
-0001c330: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
-0001c340: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
-0001c350: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001c360: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0001c370: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-0001c380: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001c390: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0001c3a0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0001c3b0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0001c3c0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001c3d0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
-0001c3e0: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
-0001c3f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001c400: 6f72 2074 6e20 696e 2074 656e 616e 745f  or tn in tenant_
-0001c410: 736f 7572 6365 3a0d 0a20 2020 2020 2020  source:..       
-0001c420: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0001c430: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001c440: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0001c450: 7361 7465 5f65 6e74 6974 795f 6c61 7374  sate_entity_last
-0001c460: 5f69 6d61 6765 2c20 746e 2e63 6f6c 756d  _image, tn.colum
-0001c470: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0001c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba90: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0001baa0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0001bab0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bad0: 2020 2020 2020 2020 2020 2020 2061 7070               app
+0001bae0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0001baf0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+0001bb00: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c0d  dinal_position,.
+0001bb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb30: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0001bb40: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
+0001bb50: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0001bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb70: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+0001bb80: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+0001bb90: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbc0: 2020 2031 2c20 4b45 595f 5459 5045 5f41     1, KEY_TYPE_A
+0001bbd0: 5050 4c49 4544 5f44 4154 452c 2031 2c20  PPLIED_DATE, 1, 
+0001bbe0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0001bbf0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0001bc00: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0001bc10: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+0001bc20: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0001bc30: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0001bc40: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+0001bc50: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+0001bc60: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+0001bc70: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0001bc80: 203d 2068 6173 685f 6e61 6d65 202b 2022   = hash_name + "
+0001bc90: 5f48 4953 5420 6973 206e 756c 6c20 616e  _HIST is null an
+0001bca0: 6420 524e 203d 2031 220d 0a20 2020 2020  d RN = 1"..     
+0001bcb0: 2020 2020 2020 206e 6577 5f66 696c 7465         new_filte
+0001bcc0: 7220 3d20 5b70 7265 6669 785f 6574 202b  r = [prefix_et +
+0001bcd0: 2073 6174 655f 656e 7469 7479 2c20 6669   sate_entity, fi
+0001bce0: 6c74 6572 2c20 312c 2073 656c 662e 6f77  lter, 1, self.ow
+0001bcf0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0001bd00: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001bd10: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001bd20: 5f66 696c 7465 7273 285b 6e65 775f 6669  _filters([new_fi
+0001bd30: 6c74 6572 5d29 0d0a 0d0a 2020 2020 2020  lter])....      
+0001bd40: 2020 2020 2020 2320 4272 616e 6368 2032        # Branch 2
+0001bd50: 3a20 496e 7365 7274 2069 6620 6f6e 6c79  : Insert if only
+0001bd60: 2065 7869 7374 7320 6f6e 2074 6172 6765   exists on targe
+0001bd70: 740d 0a20 2020 2020 2020 2020 2020 206e  t..            n
+0001bd80: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001bd90: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0001bda0: 2b20 7361 7465 5f65 6e74 6974 795f 6c61  + sate_entity_la
+0001bdb0: 7374 5f69 6d61 6765 2c20 6861 7368 5f6e  st_image, hash_n
+0001bdc0: 616d 652b 225f 4849 5354 222c 0d0a 2020  ame+"_HIST",..  
+0001bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bdf0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+0001be00: 655f 656e 7469 7479 2c20 6861 7368 5f6e  e_entity, hash_n
+0001be10: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0001be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be30: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+0001be40: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+0001be50: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0001be60: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0001be70: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
+0001be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be90: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+0001bea0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0001beb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bed0: 2020 2020 2032 2c20 4b45 595f 5459 5045       2, KEY_TYPE
+0001bee0: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+0001bef0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0001bf00: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0001bf10: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+0001bf20: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0001bf30: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0001bf40: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0001bf50: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0001bf60: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0001bf70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0001bf80: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0001bf90: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
+0001bfa0: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
+0001bfb0: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
+0001bfc0: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
+0001bfd0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001bfe0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0001bff0: 2b20 7361 7465 5f65 6e74 6974 795f 6c61  + sate_entity_la
+0001c000: 7374 5f69 6d61 6765 2c20 2744 4154 455f  st_image, 'DATE_
+0001c010: 4352 4541 5445 4427 2c0d 0a20 2020 2020  CREATED',..     
+0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c030: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001c040: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+0001c050: 6e74 6974 792c 2027 4441 5445 5f43 5245  ntity, 'DATE_CRE
+0001c060: 4154 4544 272c 0d0a 2020 2020 2020 2020  ATED',..        
+0001c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c080: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+0001c090: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+0001c0a0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+0001c0b0: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
+0001c0c0: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+0001c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0f0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+0001c100: 6574 6164 6174 615b 325d 2c20 322c 204e  etadata[2], 2, N
+0001c110: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
+0001c120: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001c130: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0001c140: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0001c150: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0001c160: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0001c170: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+0001c180: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001c190: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0001c1a0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+0001c1b0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+0001c1c0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+0001c1d0: 655f 656e 7469 7479 5f6c 6173 745f 696d  e_entity_last_im
+0001c1e0: 6167 652c 2027 4441 5445 5f53 5441 5254  age, 'DATE_START
+0001c1f0: 5f48 4953 5427 2c0d 0a20 2020 2020 2020  _HIST',..       
+0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c210: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0001c220: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+0001c230: 6974 792c 2027 4441 5445 5f53 5441 5254  ity, 'DATE_START
+0001c240: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+0001c270: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0001c280: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001c290: 2c20 7379 7364 6174 655f 666f 725f 6d65  , sysdate_for_me
+0001c2a0: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c2d0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+0001c2e0: 6174 615b 325d 2c20 322c 204e 6f6e 652c  ata[2], 2, None,
+0001c2f0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+0001c300: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001c310: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0001c320: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0001c330: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0001c340: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0001c350: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+0001c360: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0001c370: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+0001c380: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0001c390: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0001c3a0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+0001c3b0: 7469 7479 5f6c 6173 745f 696d 6167 652c  tity_last_image,
+0001c3c0: 2027 4441 5445 5f53 5441 5254 272c 0d0a   'DATE_START',..
+0001c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3f0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+0001c400: 6174 655f 656e 7469 7479 2c20 2744 4154  ate_entity, 'DAT
+0001c410: 455f 454e 4427 2c0d 0a20 2020 2020 2020  E_END',..       
+0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c430: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+0001c440: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+0001c450: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
+0001c460: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
+0001c470: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
+0001c480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4a0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0001c4b0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-0001c4c0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4f0: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
-0001c500: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0001c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c530: 2020 2074 6e2e 636f 6c75 6d6e 5f74 7970     tn.column_typ
-0001c540: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-0001c550: 6c5f 706f 7369 7469 6f6e 2c20 746e 2e63  l_position, tn.c
-0001c560: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c590: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-0001c5a0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5d0: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
-0001c5e0: 595f 5459 5045 5f54 454e 414e 542c 2031  Y_TYPE_TENANT, 1
-0001c5f0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0001c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c610: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001c620: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001c630: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0001c640: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0001c650: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0001c660: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0001c670: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0001c680: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-0001c690: 2020 2020 6966 2068 6173 5f61 643a 0d0a      if has_ad:..
-0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6b0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001c6c0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0001c6d0: 202b 2073 6174 655f 656e 7469 7479 5f6c   + sate_entity_l
-0001c6e0: 6173 745f 696d 6167 652c 2061 7070 6c69  ast_image, appli
-0001c6f0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-0001c700: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0001c4a0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+0001c4b0: 6d65 7461 6461 7461 5b32 5d2c 2032 2c20  metadata[2], 2, 
+0001c4c0: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
+0001c4d0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0001c4e0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001c4f0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001c500: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001c510: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0001c520: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0001c530: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0001c540: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+0001c550: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+0001c560: 735f 7273 3a0d 0a20 2020 2020 2020 2020  s_rs:..         
+0001c570: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0001c580: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0001c590: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+0001c5a0: 6e74 6974 795f 6c61 7374 5f69 6d61 6765  ntity_last_image
+0001c5b0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
+0001c5c0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+0001c5d0: 6574 202b 2022 5f48 4953 5422 2c0d 0a20  et + "_HIST",.. 
+0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c600: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+0001c610: 2b20 7361 7465 5f65 6e74 6974 792c 0d0a  + sate_entity,..
+0001c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c640: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+0001c650: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+0001c660: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+0001c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c690: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+0001c6a0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+0001c6b0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+0001c6c0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6e0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+0001c6f0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+0001c700: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
 0001c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c730: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-0001c740: 7361 7465 5f65 6e74 6974 792c 0d0a 2020  sate_entity,..  
-0001c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c730: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
+0001c740: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+0001c750: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c770: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-0001c780: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-0001c790: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-0001c7c0: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
-0001c7d0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-0001c7e0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0001c7f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c810: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-0001c820: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
-0001c830: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0001c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c850: 2020 2020 2020 2020 2020 2020 2061 7070               app
-0001c860: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-0001c870: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8a0: 2020 2020 322c 204b 4559 5f54 5950 455f      2, KEY_TYPE_
-0001c8b0: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
-0001c8c0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0001c8d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0001c8e0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0001c8f0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0001c900: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0001c910: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-0001c920: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-0001c930: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-0001c940: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-0001c950: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-0001c960: 7220 3d20 6861 7368 5f6e 616d 6520 2b20  r = hash_name + 
-0001c970: 2220 6973 206e 756c 6c20 616e 6420 524e  " is null and RN
-0001c980: 203d 2031 220d 0a20 2020 2020 2020 2020   = 1"..         
-0001c990: 2020 206e 6577 5f66 696c 7465 7220 3d20     new_filter = 
-0001c9a0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-0001c9b0: 655f 656e 7469 7479 2c20 6669 6c74 6572  e_entity, filter
-0001c9c0: 2c20 322c 2073 656c 662e 6f77 6e65 725d  , 2, self.owner]
-0001c9d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0001c9e0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0001c9f0: 616c 2e61 6464 5f65 6e74 7279 5f66 696c  al.add_entry_fil
-0001ca00: 7465 7273 285b 6e65 775f 6669 6c74 6572  ters([new_filter
-0001ca10: 5d29 0d0a 0d0a 2020 2020 2020 2020 656c  ])....        el
-0001ca20: 6966 206f 7269 6769 6e5f 7479 7065 735b  if origin_types[
-0001ca30: 276f 7269 6769 6e5f 6973 5f69 6e63 7265  'origin_is_incre
-0001ca40: 6d65 6e74 616c 275d 203d 3d20 3120 6f72  mental'] == 1 or
-0001ca50: 206f 7269 6769 6e5f 7479 7065 735b 276f   origin_types['o
-0001ca60: 7269 6769 6e5f 6973 5f63 6463 275d 203d  rigin_is_cdc'] =
-0001ca70: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
-0001ca80: 2020 6e65 775f 656e 7469 7479 203d 205b    new_entity = [
-0001ca90: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-0001caa0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0001cab0: 6d61 6765 5f31 2c20 7361 7465 5f65 6e74  mage_1, sate_ent
-0001cac0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-0001cad0: 5f31 2c20 454e 5449 5459 5f57 4954 482c  _1, ENTITY_WITH,
-0001cae0: 2064 765f 656e 7469 7479 2e63 6f64 5f70   dv_entity.cod_p
-0001caf0: 6174 682c 2027 272c 2073 656c 662e 6f77  ath, '', self.ow
-0001cb00: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001cb10: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0001cb20: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0001cb30: 5f65 6e74 6974 7928 5b6e 6577 5f65 6e74  _entity([new_ent
-0001cb40: 6974 795d 290d 0a20 2020 2020 2020 2020  ity])..         
-0001cb50: 2020 206e 6577 5f65 6e74 6974 7920 3d20     new_entity = 
-0001cb60: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-0001cb70: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
-0001cb80: 696d 6167 655f 322c 2073 6174 655f 656e  image_2, sate_en
-0001cb90: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0001cba0: 655f 322c 2045 4e54 4954 595f 5749 5448  e_2, ENTITY_WITH
-0001cbb0: 2c20 6476 5f65 6e74 6974 792e 636f 645f  , dv_entity.cod_
-0001cbc0: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
-0001cbd0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0001cbe0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001cbf0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001cc00: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
-0001cc10: 7469 7479 5d29 0d0a 2020 2020 2020 2020  tity])..        
-0001cc20: 2020 2020 6e65 775f 656e 7469 7479 203d      new_entity =
-0001cc30: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-0001cc40: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
-0001cc50: 5f69 6d61 6765 5f33 2c20 7361 7465 5f65  _image_3, sate_e
-0001cc60: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-0001cc70: 6765 5f33 2c20 454e 5449 5459 5f57 4954  ge_3, ENTITY_WIT
-0001cc80: 482c 2064 765f 656e 7469 7479 2e63 6f64  H, dv_entity.cod
-0001cc90: 5f70 6174 682c 2027 272c 2073 656c 662e  _path, '', self.
-0001cca0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0001ccb0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0001ccc0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0001ccd0: 7279 5f65 6e74 6974 7928 5b6e 6577 5f65  ry_entity([new_e
-0001cce0: 6e74 6974 795d 290d 0a20 2020 2020 2020  ntity])..       
-0001ccf0: 2020 2020 206e 6577 5f65 6e74 6974 7920       new_entity 
-0001cd00: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0001cd10: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
-0001cd20: 5f73 6f75 7263 6573 2c20 7361 7465 5f65  _sources, sate_e
-0001cd30: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
-0001cd40: 6365 732c 2045 4e54 4954 595f 5749 5448  ces, ENTITY_WITH
-0001cd50: 2c20 6476 5f65 6e74 6974 792e 636f 645f  , dv_entity.cod_
-0001cd60: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
-0001cd70: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0001cd80: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001cd90: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001cda0: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
-0001cdb0: 7469 7479 5d29 0d0a 2020 2020 2020 2020  tity])..        
-0001cdc0: 2020 2020 6e65 775f 656e 7469 7479 203d      new_entity =
-0001cdd0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-0001cde0: 7465 5f65 6e74 6974 795f 6a6f 696e 2c20  te_entity_join, 
-0001cdf0: 7361 7465 5f65 6e74 6974 795f 6a6f 696e  sate_entity_join
-0001ce00: 2c20 454e 5449 5459 5f57 4954 482c 2064  , ENTITY_WITH, d
-0001ce10: 765f 656e 7469 7479 2e63 6f64 5f70 6174  v_entity.cod_pat
-0001ce20: 682c 2027 272c 2073 656c 662e 6f77 6e65  h, '', self.owne
-0001ce30: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-0001ce40: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0001ce50: 7475 616c 2e61 6464 5f65 6e74 7279 5f65  tual.add_entry_e
-0001ce60: 6e74 6974 7928 5b6e 6577 5f65 6e74 6974  ntity([new_entit
-0001ce70: 795d 290d 0a20 2020 2020 2020 2020 2020  y])..           
-0001ce80: 206e 6577 5f65 6e74 6974 7920 3d20 5b70   new_entity = [p
-0001ce90: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-0001cea0: 656e 7469 7479 2c20 7361 7465 5f65 6e74  entity, sate_ent
-0001ceb0: 6974 792c 2045 4e54 4954 595f 5442 2c20  ity, ENTITY_TB, 
-0001cec0: 6476 5f65 6e74 6974 792e 636f 645f 7061  dv_entity.cod_pa
-0001ced0: 7468 2c20 2749 4e53 4552 5427 2c20 7365  th, 'INSERT', se
-0001cee0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0001cef0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0001cf00: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0001cf10: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
-0001cf20: 775f 656e 7469 7479 5d29 0d0a 0d0a 2020  w_entity])....  
-0001cf30: 2020 2020 2020 2020 2020 6861 735f 7273            has_rs
-0001cf40: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-0001cf50: 2020 2020 2020 6861 735f 746e 203d 2046        has_tn = F
-0001cf60: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0001cf70: 2020 6861 735f 6164 203d 2046 616c 7365    has_ad = False
-0001cf80: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0001cf90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001cfa0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001cfb0: 2323 2323 2320 556e 696f 6e20 616c 6c20  ##### Union all 
-0001cfc0: 736f 7572 6365 7320 2323 2323 2323 2323  sources ########
-0001cfd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001cfe0: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
-0001cff0: 2020 2020 2020 2020 2020 2074 656e 616e             tenan
-0001d000: 745f 736f 7572 6365 203d 2073 656c 662e  t_source = self.
-0001d010: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0001d020: 6765 745f 7465 6e61 6e74 5f6f 6e5f 6476  get_tenant_on_dv
-0001d030: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
-0001d040: 5f74 6172 6765 745f 616e 645f 6e75 6d5f  _target_and_num_
-0001d050: 6272 616e 6368 2863 6f64 5f65 6e74 6974  branch(cod_entit
-0001d060: 795f 7461 7267 6574 2c20 3129 0d0a 2020  y_target, 1)..  
-0001d070: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001d080: 2874 656e 616e 745f 736f 7572 6365 2920  (tenant_source) 
-0001d090: 213d 2030 3a20 6861 735f 746e 203d 2054  != 0: has_tn = T
-0001d0a0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-0001d0b0: 2072 6563 6f72 645f 736f 7572 6365 203d   record_source =
-0001d0c0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0001d0d0: 6374 7561 6c2e 6765 745f 7265 636f 7264  ctual.get_record
-0001d0e0: 5f73 6f75 7263 655f 6f6e 5f64 765f 6672  _source_on_dv_fr
-0001d0f0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
-0001d100: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
-0001d110: 6e63 6828 636f 645f 656e 7469 7479 5f74  nch(cod_entity_t
-0001d120: 6172 6765 742c 2031 290d 0a20 2020 2020  arget, 1)..     
-0001d130: 2020 2020 2020 2069 6620 7265 636f 7264         if record
-0001d140: 5f73 6f75 7263 6520 6973 206e 6f74 204e  _source is not N
-0001d150: 6f6e 653a 2068 6173 5f72 7320 3d20 5472  one: has_rs = Tr
-0001d160: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0001d170: 6170 706c 6965 645f 6461 7465 203d 2073  applied_date = s
-0001d180: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0001d190: 7561 6c2e 6765 745f 6170 706c 6965 645f  ual.get_applied_
-0001d1a0: 6461 7465 5f6f 6e5f 6476 5f66 726f 6d5f  date_on_dv_from_
-0001d1b0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-0001d1c0: 7428 6476 5f65 6e74 6974 792e 636f 645f  t(dv_entity.cod_
-0001d1d0: 656e 7469 7479 2c20 3129 0d0a 2020 2020  entity, 1)..    
-0001d1e0: 2020 2020 2020 2020 6966 2061 7070 6c69          if appli
-0001d1f0: 6564 5f64 6174 6520 6973 206e 6f74 204e  ed_date is not N
-0001d200: 6f6e 653a 2068 6173 5f61 6420 3d20 5472  one: has_ad = Tr
-0001d210: 7565 0d0a 0d0a 2020 2020 2020 2020 2020  ue....          
-0001d220: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-0001d230: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
-0001d240: 6374 696f 6e2e 6765 745f 6861 7368 5f66  ction.get_hash_f
-0001d250: 6f72 5f6d 6574 6164 6174 6128 290d 0a0d  or_metadata()...
-0001d260: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
-0001d270: 5f62 7261 6e63 6865 7320 3d20 7365 6c66  _branches = self
-0001d280: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0001d290: 2e67 6574 5f6e 756d 5f62 7261 6e63 6865  .get_num_branche
-0001d2a0: 735f 6f6e 5f65 6e74 7279 5f64 765f 6672  s_on_entry_dv_fr
-0001d2b0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6e61  om_cod_entity_na
-0001d2c0: 6d65 2864 765f 656e 7469 7479 2e63 6f64  me(dv_entity.cod
-0001d2d0: 5f65 6e74 6974 7929 0d0a 0d0a 2020 2020  _entity)....    
-0001d2e0: 2020 2020 2020 2020 666f 7220 6e75 6d5f          for num_
-0001d2f0: 6272 616e 6368 2069 6e20 7261 6e67 6528  branch in range(
-0001d300: 312c 206e 756d 5f62 7261 6e63 6865 7320  1, num_branches 
-0001d310: 2b20 3129 3a0d 0a20 2020 2020 2020 2020  + 1):..         
-0001d320: 2020 2020 2020 2065 6e74 7279 5f64 765f         entry_dv_
-0001d330: 6d61 7070 696e 675f 626b 203d 2073 656c  mapping_bk = sel
-0001d340: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0001d350: 6c2e 6765 745f 616c 6c5f 626b 5f66 726f  l.get_all_bk_fro
-0001d360: 6d5f 656e 7472 795f 6476 5f63 6f64 5f65  m_entry_dv_cod_e
-0001d370: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-0001d380: 5f6e 756d 5f62 7261 6e63 6828 6476 5f65  _num_branch(dv_e
-0001d390: 6e74 6974 792e 636f 645f 656e 7469 7479  ntity.cod_entity
-0001d3a0: 2c20 6e75 6d5f 6272 616e 6368 290d 0a20  , num_branch).. 
-0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001d3c0: 6e74 7279 5f64 765f 6d61 7070 696e 675f  ntry_dv_mapping_
-0001d3d0: 626b 2e73 6f72 7428 6b65 793d 6c61 6d62  bk.sort(key=lamb
-0001d3e0: 6461 2078 3a20 782e 6f72 6469 6e61 6c5f  da x: x.ordinal_
-0001d3f0: 706f 7369 7469 6f6e 290d 0a20 2020 2020  position)..     
-0001d400: 2020 2020 2020 2020 2020 2063 6f64 5f65             cod_e
-0001d410: 6e74 6974 795f 736f 7572 6365 203d 2065  ntity_source = e
-0001d420: 6e74 7279 5f64 765f 6d61 7070 696e 675f  ntry_dv_mapping_
-0001d430: 626b 5b30 5d2e 636f 645f 656e 7469 7479  bk[0].cod_entity
-0001d440: 5f73 6f75 7263 650d 0a20 2020 2020 2020  _source..       
-0001d450: 2020 2020 2020 2020 206d 6435 5f66 756e           md5_fun
-0001d460: 6374 696f 6e20 3d20 7365 6c66 2e67 6574  ction = self.get
-0001d470: 5f68 6173 685f 6b65 795f 6672 6f6d 5f63  _hash_key_from_c
-0001d480: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-0001d490: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
-0001d4a0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-0001d4b0: 742c 206e 756d 5f62 7261 6e63 6829 0d0a  t, num_branch)..
-0001d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4d0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001d4e0: 696e 6720 3d20 5b63 6f64 5f65 6e74 6974  ing = [cod_entit
-0001d4f0: 795f 736f 7572 6365 2c20 6d64 355f 6675  y_source, md5_fu
-0001d500: 6e63 7469 6f6e 2c20 7072 6566 6978 5f65  nction, prefix_e
-0001d510: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-0001d520: 756e 696f 6e5f 736f 7572 6365 732c 0d0a  union_sources,..
-0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d550: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-0001d560: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d580: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-0001d590: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-0001d5a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0001d5b0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0001d5c0: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
-0001d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5f0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-0001d600: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-0001d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d620: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-0001d630: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-0001d640: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-0001d650: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0001d660: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-0001d670: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-0001d680: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-0001d690: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0001d6a0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0001d6b0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0001d6c0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0001d6d0: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-0001d6e0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0001d6f0: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-0001d700: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-0001d710: 7469 6f6e 2e67 6574 5f73 7973 6461 7465  tion.get_sysdate
-0001d720: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
-0001d730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d740: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0001d750: 7069 6e67 203d 205b 2727 2c20 7365 6c66  ping = ['', self
-0001d760: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-0001d770: 7379 7364 6174 655f 7661 6c75 6528 292c  sysdate_value(),
-0001d780: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0001d790: 655f 656e 7469 7479 5f75 6e69 6f6e 5f73  e_entity_union_s
-0001d7a0: 6f75 7263 6573 2c0d 0a20 2020 2020 2020  ources,..       
-0001d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7d0: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
-0001d7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d800: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-0001d810: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-0001d820: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001d830: 6e2c 2073 7973 6461 7465 5f66 6f72 5f6d  n, sysdate_for_m
-0001d840: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
-0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d870: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0001d880: 6d65 7461 6461 7461 5b32 5d2c 206e 756d  metadata[2], num
-0001d890: 5f62 7261 6e63 682c 204e 6f6e 652c 2031  _branch, None, 1
-0001d8a0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0001d8b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d8c0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0001d8d0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0001d8e0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0001d8f0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001d900: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-0001d910: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0001d920: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-0001d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d940: 6966 2068 6173 5f72 733a 0d0a 2020 2020  if has_rs:..    
-0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d960: 7265 636f 7264 5f73 6f75 7263 6520 3d20  record_source = 
-0001d970: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0001d980: 7475 616c 2e67 6574 5f72 6563 6f72 645f  tual.get_record_
-0001d990: 736f 7572 6365 5f6f 6e5f 6476 5f66 726f  source_on_dv_fro
-0001d9a0: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
-0001d9b0: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
-0001d9c0: 6368 280d 0a20 2020 2020 2020 2020 2020  ch(..           
-0001d9d0: 2020 2020 2020 2020 2020 2020 2063 6f64               cod
-0001d9e0: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
-0001d9f0: 6e75 6d5f 6272 616e 6368 290d 0a20 2020  num_branch)..   
-0001da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da10: 2069 6620 7265 636f 7264 5f73 6f75 7263   if record_sourc
-0001da20: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
-0001da30: 6173 5f72 7320 3d20 5472 7565 0d0a 2020  as_rs = True..  
-0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da50: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0001da60: 7070 696e 6720 3d20 5b63 6f64 5f65 6e74  pping = [cod_ent
-0001da70: 6974 795f 736f 7572 6365 2c20 7265 636f  ity_source, reco
-0001da80: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-0001da90: 5f6e 616d 655f 736f 7572 6365 2c0d 0a20  _name_source,.. 
-0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dac0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-0001dad0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-0001dae0: 795f 756e 696f 6e5f 736f 7572 6365 732c  y_union_sources,
-0001daf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db10: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-0001db20: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-0001db30: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0001db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db60: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0001db70: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0001db80: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-0001db90: 696e 616c 5f70 6f73 6974 696f 6e2c 0d0a  inal_position,..
-0001dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbc0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0001dbd0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0001dbe0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c770: 2020 2020 2020 2020 2020 322c 204b 4559            2, KEY
+0001c780: 5f54 5950 455f 5245 434f 5244 5f53 4f55  _TYPE_RECORD_SOU
+0001c790: 5243 452c 2031 2c20 7365 6c66 2e6f 776e  RCE, 1, self.own
+0001c7a0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001c7b0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001c7c0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+0001c7d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001c7e0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0001c7f0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0001c800: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0001c810: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001c820: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+0001c830: 2020 6966 2068 6173 5f74 6e3a 0d0a 2020    if has_tn:..  
+0001c840: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001c850: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
+0001c860: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
+0001c870: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0001c880: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0001c890: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0001c8a0: 6174 655f 656e 7469 7479 5f6c 6173 745f  ate_entity_last_
+0001c8b0: 696d 6167 652c 2074 6e2e 636f 6c75 6d6e  image, tn.column
+0001c8c0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8f0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0001c900: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+0001c910: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c930: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001c940: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
+0001c950: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0001c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c980: 2020 746e 2e63 6f6c 756d 6e5f 7479 7065    tn.column_type
+0001c990: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+0001c9a0: 5f70 6f73 6974 696f 6e2c 2074 6e2e 636f  _position, tn.co
+0001c9b0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9e0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+0001c9f0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 2020 2020 2020 2020 2020 322c 204b 4559            2, KEY
+0001ca30: 5f54 5950 455f 5445 4e41 4e54 2c20 312c  _TYPE_TENANT, 1,
+0001ca40: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0001ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca60: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001ca70: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001ca80: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001ca90: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0001caa0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0001cab0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0001cac0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0001cad0: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
+0001cae0: 2020 2069 6620 6861 735f 6164 3a0d 0a20     if has_ad:.. 
+0001caf0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001cb00: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001cb10: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0001cb20: 2b20 7361 7465 5f65 6e74 6974 795f 6c61  + sate_entity_la
+0001cb30: 7374 5f69 6d61 6765 2c20 6170 706c 6965  st_image, applie
+0001cb40: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+0001cb50: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+0001cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb80: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+0001cb90: 6174 655f 656e 7469 7479 2c0d 0a20 2020  ate_entity,..   
+0001cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbc0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0001cbd0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0001cbe0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc00: 2020 2020 2020 2020 2020 2020 2061 7070               app
+0001cc10: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0001cc20: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+0001cc30: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c0d  dinal_position,.
+0001cc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc60: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0001cc70: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
+0001cc80: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cca0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+0001ccb0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+0001ccc0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccf0: 2020 2032 2c20 4b45 595f 5459 5045 5f41     2, KEY_TYPE_A
+0001cd00: 5050 4c49 4544 5f44 4154 452c 2031 2c20  PPLIED_DATE, 1, 
+0001cd10: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0001cd20: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0001cd30: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0001cd40: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+0001cd50: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0001cd60: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0001cd70: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+0001cd80: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+0001cd90: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+0001cda0: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+0001cdb0: 203d 2068 6173 685f 6e61 6d65 202b 2022   = hash_name + "
+0001cdc0: 2069 7320 6e75 6c6c 2061 6e64 2052 4e20   is null and RN 
+0001cdd0: 3d20 3122 0d0a 2020 2020 2020 2020 2020  = 1"..          
+0001cde0: 2020 6e65 775f 6669 6c74 6572 203d 205b    new_filter = [
+0001cdf0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+0001ce00: 5f65 6e74 6974 792c 2066 696c 7465 722c  _entity, filter,
+0001ce10: 2032 2c20 7365 6c66 2e6f 776e 6572 5d0d   2, self.owner].
+0001ce20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001ce30: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0001ce40: 6c2e 6164 645f 656e 7472 795f 6669 6c74  l.add_entry_filt
+0001ce50: 6572 7328 5b6e 6577 5f66 696c 7465 725d  ers([new_filter]
+0001ce60: 290d 0a0d 0a20 2020 2020 2020 2065 6c69  )....        eli
+0001ce70: 6620 6f72 6967 696e 5f74 7970 6573 5b27  f origin_types['
+0001ce80: 6f72 6967 696e 5f69 735f 696e 6372 656d  origin_is_increm
+0001ce90: 656e 7461 6c27 5d20 3d3d 2031 206f 7220  ental'] == 1 or 
+0001cea0: 6f72 6967 696e 5f74 7970 6573 5b27 6f72  origin_types['or
+0001ceb0: 6967 696e 5f69 735f 6364 6327 5d20 3d3d  igin_is_cdc'] ==
+0001cec0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+0001ced0: 206e 6577 5f65 6e74 6974 7920 3d20 5b70   new_entity = [p
+0001cee0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+0001cef0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+0001cf00: 6167 655f 312c 2073 6174 655f 656e 7469  age_1, sate_enti
+0001cf10: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+0001cf20: 312c 2045 4e54 4954 595f 5749 5448 2c20  1, ENTITY_WITH, 
+0001cf30: 6476 5f65 6e74 6974 792e 636f 645f 7061  dv_entity.cod_pa
+0001cf40: 7468 2c20 2727 2c20 7365 6c66 2e6f 776e  th, '', self.own
+0001cf50: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001cf60: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0001cf70: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0001cf80: 656e 7469 7479 285b 6e65 775f 656e 7469  entity([new_enti
+0001cf90: 7479 5d29 0d0a 2020 2020 2020 2020 2020  ty])..          
+0001cfa0: 2020 6e65 775f 656e 7469 7479 203d 205b    new_entity = [
+0001cfb0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+0001cfc0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+0001cfd0: 6d61 6765 5f32 2c20 7361 7465 5f65 6e74  mage_2, sate_ent
+0001cfe0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+0001cff0: 5f32 2c20 454e 5449 5459 5f57 4954 482c  _2, ENTITY_WITH,
+0001d000: 2064 765f 656e 7469 7479 2e63 6f64 5f70   dv_entity.cod_p
+0001d010: 6174 682c 2027 272c 2073 656c 662e 6f77  ath, '', self.ow
+0001d020: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0001d030: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001d040: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001d050: 5f65 6e74 6974 7928 5b6e 6577 5f65 6e74  _entity([new_ent
+0001d060: 6974 795d 290d 0a20 2020 2020 2020 2020  ity])..         
+0001d070: 2020 206e 6577 5f65 6e74 6974 7920 3d20     new_entity = 
+0001d080: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+0001d090: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
+0001d0a0: 696d 6167 655f 332c 2073 6174 655f 656e  image_3, sate_en
+0001d0b0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+0001d0c0: 655f 332c 2045 4e54 4954 595f 5749 5448  e_3, ENTITY_WITH
+0001d0d0: 2c20 6476 5f65 6e74 6974 792e 636f 645f  , dv_entity.cod_
+0001d0e0: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
+0001d0f0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0001d100: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0001d110: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0001d120: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
+0001d130: 7469 7479 5d29 0d0a 2020 2020 2020 2020  tity])..        
+0001d140: 2020 2020 6e65 775f 656e 7469 7479 203d      new_entity =
+0001d150: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0001d160: 7465 5f65 6e74 6974 795f 756e 696f 6e5f  te_entity_union_
+0001d170: 736f 7572 6365 732c 2073 6174 655f 656e  sources, sate_en
+0001d180: 7469 7479 5f75 6e69 6f6e 5f73 6f75 7263  tity_union_sourc
+0001d190: 6573 2c20 454e 5449 5459 5f57 4954 482c  es, ENTITY_WITH,
+0001d1a0: 2064 765f 656e 7469 7479 2e63 6f64 5f70   dv_entity.cod_p
+0001d1b0: 6174 682c 2027 272c 2073 656c 662e 6f77  ath, '', self.ow
+0001d1c0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0001d1d0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001d1e0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001d1f0: 5f65 6e74 6974 7928 5b6e 6577 5f65 6e74  _entity([new_ent
+0001d200: 6974 795d 290d 0a20 2020 2020 2020 2020  ity])..         
+0001d210: 2020 206e 6577 5f65 6e74 6974 7920 3d20     new_entity = 
+0001d220: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+0001d230: 655f 656e 7469 7479 5f6a 6f69 6e2c 2073  e_entity_join, s
+0001d240: 6174 655f 656e 7469 7479 5f6a 6f69 6e2c  ate_entity_join,
+0001d250: 2045 4e54 4954 595f 5749 5448 2c20 6476   ENTITY_WITH, dv
+0001d260: 5f65 6e74 6974 792e 636f 645f 7061 7468  _entity.cod_path
+0001d270: 2c20 2727 2c20 7365 6c66 2e6f 776e 6572  , '', self.owner
+0001d280: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+0001d290: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0001d2a0: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
+0001d2b0: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
+0001d2c0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0001d2d0: 6e65 775f 656e 7469 7479 203d 205b 7072  new_entity = [pr
+0001d2e0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+0001d2f0: 6e74 6974 792c 2073 6174 655f 656e 7469  ntity, sate_enti
+0001d300: 7479 2c20 454e 5449 5459 5f54 422c 2064  ty, ENTITY_TB, d
+0001d310: 765f 656e 7469 7479 2e63 6f64 5f70 6174  v_entity.cod_pat
+0001d320: 682c 2027 494e 5345 5254 272c 2073 656c  h, 'INSERT', sel
+0001d330: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0001d340: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0001d350: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0001d360: 6e74 7279 5f65 6e74 6974 7928 5b6e 6577  ntry_entity([new
+0001d370: 5f65 6e74 6974 795d 290d 0a0d 0a20 2020  _entity])....   
+0001d380: 2020 2020 2020 2020 2068 6173 5f72 7320           has_rs 
+0001d390: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+0001d3a0: 2020 2020 2068 6173 5f74 6e20 3d20 4661       has_tn = Fa
+0001d3b0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+0001d3c0: 2068 6173 5f61 6420 3d20 4661 6c73 650d   has_ad = False.
+0001d3d0: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0001d3e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001d3f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001d400: 2323 2323 2055 6e69 6f6e 2061 6c6c 2073  #### Union all s
+0001d410: 6f75 7263 6573 2023 2323 2323 2323 2323  ources #########
+0001d420: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001d430: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
+0001d440: 2020 2020 2020 2020 2020 7465 6e61 6e74            tenant
+0001d450: 5f73 6f75 7263 6520 3d20 7365 6c66 2e6d  _source = self.m
+0001d460: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0001d470: 6574 5f74 656e 616e 745f 6f6e 5f64 765f  et_tenant_on_dv_
+0001d480: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+0001d490: 7461 7267 6574 5f61 6e64 5f6e 756d 5f62  target_and_num_b
+0001d4a0: 7261 6e63 6828 636f 645f 656e 7469 7479  ranch(cod_entity
+0001d4b0: 5f74 6172 6765 742c 2031 290d 0a20 2020  _target, 1)..   
+0001d4c0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0001d4d0: 7465 6e61 6e74 5f73 6f75 7263 6529 2021  tenant_source) !
+0001d4e0: 3d20 303a 2068 6173 5f74 6e20 3d20 5472  = 0: has_tn = Tr
+0001d4f0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+0001d500: 7265 636f 7264 5f73 6f75 7263 6520 3d20  record_source = 
+0001d510: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0001d520: 7475 616c 2e67 6574 5f72 6563 6f72 645f  tual.get_record_
+0001d530: 736f 7572 6365 5f6f 6e5f 6476 5f66 726f  source_on_dv_fro
+0001d540: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
+0001d550: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
+0001d560: 6368 2863 6f64 5f65 6e74 6974 795f 7461  ch(cod_entity_ta
+0001d570: 7267 6574 2c20 3129 0d0a 2020 2020 2020  rget, 1)..      
+0001d580: 2020 2020 2020 6966 2072 6563 6f72 645f        if record_
+0001d590: 736f 7572 6365 2069 7320 6e6f 7420 4e6f  source is not No
+0001d5a0: 6e65 3a20 6861 735f 7273 203d 2054 7275  ne: has_rs = Tru
+0001d5b0: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
+0001d5c0: 7070 6c69 6564 5f64 6174 6520 3d20 7365  pplied_date = se
+0001d5d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0001d5e0: 616c 2e67 6574 5f61 7070 6c69 6564 5f64  al.get_applied_d
+0001d5f0: 6174 655f 6f6e 5f64 765f 6672 6f6d 5f63  ate_on_dv_from_c
+0001d600: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+0001d610: 2864 765f 656e 7469 7479 2e63 6f64 5f65  (dv_entity.cod_e
+0001d620: 6e74 6974 792c 2031 290d 0a20 2020 2020  ntity, 1)..     
+0001d630: 2020 2020 2020 2069 6620 6170 706c 6965         if applie
+0001d640: 645f 6461 7465 2069 7320 6e6f 7420 4e6f  d_date is not No
+0001d650: 6e65 3a20 6861 735f 6164 203d 2054 7275  ne: has_ad = Tru
+0001d660: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+0001d670: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0001d680: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
+0001d690: 7469 6f6e 2e67 6574 5f68 6173 685f 666f  tion.get_hash_fo
+0001d6a0: 725f 6d65 7461 6461 7461 2829 0d0a 0d0a  r_metadata()....
+0001d6b0: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0001d6c0: 6272 616e 6368 6573 203d 2073 656c 662e  branches = self.
+0001d6d0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0001d6e0: 6765 745f 6e75 6d5f 6272 616e 6368 6573  get_num_branches
+0001d6f0: 5f6f 6e5f 656e 7472 795f 6476 5f66 726f  _on_entry_dv_fro
+0001d700: 6d5f 636f 645f 656e 7469 7479 5f6e 616d  m_cod_entity_nam
+0001d710: 6528 6476 5f65 6e74 6974 792e 636f 645f  e(dv_entity.cod_
+0001d720: 656e 7469 7479 290d 0a0d 0a20 2020 2020  entity)....     
+0001d730: 2020 2020 2020 2066 6f72 206e 756d 5f62         for num_b
+0001d740: 7261 6e63 6820 696e 2072 616e 6765 2831  ranch in range(1
+0001d750: 2c20 6e75 6d5f 6272 616e 6368 6573 202b  , num_branches +
+0001d760: 2031 293a 0d0a 2020 2020 2020 2020 2020   1):..          
+0001d770: 2020 2020 2020 656e 7472 795f 6476 5f6d        entry_dv_m
+0001d780: 6170 7069 6e67 5f62 6b20 3d20 7365 6c66  apping_bk = self
+0001d790: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0001d7a0: 2e67 6574 5f61 6c6c 5f62 6b5f 6672 6f6d  .get_all_bk_from
+0001d7b0: 5f65 6e74 7279 5f64 765f 636f 645f 656e  _entry_dv_cod_en
+0001d7c0: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+0001d7d0: 6e75 6d5f 6272 616e 6368 2864 765f 656e  num_branch(dv_en
+0001d7e0: 7469 7479 2e63 6f64 5f65 6e74 6974 792c  tity.cod_entity,
+0001d7f0: 206e 756d 5f62 7261 6e63 6829 0d0a 2020   num_branch)..  
+0001d800: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0001d810: 7472 795f 6476 5f6d 6170 7069 6e67 5f62  try_dv_mapping_b
+0001d820: 6b2e 736f 7274 286b 6579 3d6c 616d 6264  k.sort(key=lambd
+0001d830: 6120 783a 2078 2e6f 7264 696e 616c 5f70  a x: x.ordinal_p
+0001d840: 6f73 6974 696f 6e29 0d0a 2020 2020 2020  osition)..      
+0001d850: 2020 2020 2020 2020 2020 636f 645f 656e            cod_en
+0001d860: 7469 7479 5f73 6f75 7263 6520 3d20 656e  tity_source = en
+0001d870: 7472 795f 6476 5f6d 6170 7069 6e67 5f62  try_dv_mapping_b
+0001d880: 6b5b 305d 2e63 6f64 5f65 6e74 6974 795f  k[0].cod_entity_
+0001d890: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
+0001d8a0: 2020 2020 2020 2020 6d64 355f 6675 6e63          md5_func
+0001d8b0: 7469 6f6e 203d 2073 656c 662e 6765 745f  tion = self.get_
+0001d8c0: 6861 7368 5f6b 6579 5f66 726f 6d5f 636f  hash_key_from_co
+0001d8d0: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
+0001d8e0: 616e 645f 6e75 6d5f 6272 616e 6368 2863  and_num_branch(c
+0001d8f0: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+0001d900: 2c20 6e75 6d5f 6272 616e 6368 290d 0a20  , num_branch).. 
+0001d910: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001d920: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001d930: 6e67 203d 205b 636f 645f 656e 7469 7479  ng = [cod_entity
+0001d940: 5f73 6f75 7263 652c 206d 6435 5f66 756e  _source, md5_fun
+0001d950: 6374 696f 6e2c 2070 7265 6669 785f 6574  ction, prefix_et
+0001d960: 202b 2073 6174 655f 656e 7469 7479 5f75   + sate_entity_u
+0001d970: 6e69 6f6e 5f73 6f75 7263 6573 2c0d 0a20  nion_sources,.. 
+0001d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9a0: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+0001d9b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9d0: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+0001d9e0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+0001d9f0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0001da00: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0001da10: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
+0001da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da30: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0001da40: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+0001da50: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
+0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da70: 2020 2020 2020 2020 2020 2020 206e 756d               num
+0001da80: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+0001da90: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+0001daa0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0001dab0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+0001dac0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+0001dad0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+0001dae0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0001daf0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0001db00: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+0001db10: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+0001db20: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
+0001db30: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0001db40: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+0001db50: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+0001db60: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
+0001db70: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+0001db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db90: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0001dba0: 696e 6720 3d20 5b27 272c 2073 656c 662e  ing = ['', self.
+0001dbb0: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+0001dbc0: 7973 6461 7465 5f76 616c 7565 2829 2c20  ysdate_value(), 
+0001dbd0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+0001dbe0: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
+0001dbf0: 7572 6365 732c 0d0a 2020 2020 2020 2020  urces,..        
 0001dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc10: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-0001dc20: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-0001dc30: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0001dc10: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001dc20: 4441 5445 5f43 5245 4154 4544 272c 0d0a  DATE_CREATED',..
+0001dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc60: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
-0001dc70: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
-0001dc80: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
-0001dc90: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-0001dca0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0001dcb0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcd0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0001dce0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0001dcf0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0001dd00: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0001dd10: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-0001dd20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001dd30: 6861 735f 746e 3a0d 0a20 2020 2020 2020  has_tn:..       
-0001dd40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001dd50: 6c65 6e28 7465 6e61 6e74 5f73 6f75 7263  len(tenant_sourc
-0001dd60: 6529 2021 3d20 303a 2068 6173 5f74 6e20  e) != 0: has_tn 
-0001dd70: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0001dd80: 2020 2020 2020 2020 2020 2020 7465 6e61              tena
-0001dd90: 6e74 5f73 6f75 7263 6520 3d20 7365 6c66  nt_source = self
-0001dda0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0001ddb0: 2e67 6574 5f74 656e 616e 745f 6f6e 5f64  .get_tenant_on_d
-0001ddc0: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-0001ddd0: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
-0001dde0: 5f62 7261 6e63 6828 636f 645f 656e 7469  _branch(cod_enti
-0001ddf0: 7479 5f74 6172 6765 742c 206e 756d 5f62  ty_target, num_b
-0001de00: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-0001de10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001de20: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
-0001de30: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-0001de40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001de50: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001de60: 6720 3d20 5b63 6f64 5f65 6e74 6974 795f  g = [cod_entity_
-0001de70: 736f 7572 6365 2c20 746e 2e63 6f6c 756d  source, tn.colum
-0001de80: 6e5f 6e61 6d65 5f73 6f75 7263 652c 0d0a  n_name_source,..
+0001dc50: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+0001dc60: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0001dc70: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001dc80: 2c20 7379 7364 6174 655f 666f 725f 6d65  , sysdate_for_me
+0001dc90: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+0001dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcc0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+0001dcd0: 6574 6164 6174 615b 325d 2c20 6e75 6d5f  etadata[2], num_
+0001dce0: 6272 616e 6368 2c20 4e6f 6e65 2c20 312c  branch, None, 1,
+0001dcf0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0001dd00: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001dd10: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0001dd20: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+0001dd30: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+0001dd40: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001dd50: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+0001dd60: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0001dd70: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
+0001dd80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001dd90: 6620 6861 735f 7273 3a0d 0a20 2020 2020  f has_rs:..     
+0001dda0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001ddb0: 6563 6f72 645f 736f 7572 6365 203d 2073  ecord_source = s
+0001ddc0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0001ddd0: 7561 6c2e 6765 745f 7265 636f 7264 5f73  ual.get_record_s
+0001dde0: 6f75 7263 655f 6f6e 5f64 765f 6672 6f6d  ource_on_dv_from
+0001ddf0: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
+0001de00: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
+0001de10: 6828 0d0a 2020 2020 2020 2020 2020 2020  h(..            
+0001de20: 2020 2020 2020 2020 2020 2020 636f 645f              cod_
+0001de30: 656e 7469 7479 5f74 6172 6765 742c 206e  entity_target, n
+0001de40: 756d 5f62 7261 6e63 6829 0d0a 2020 2020  um_branch)..    
+0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de60: 6966 2072 6563 6f72 645f 736f 7572 6365  if record_source
+0001de70: 2069 7320 6e6f 7420 4e6f 6e65 3a20 6861   is not None: ha
+0001de80: 735f 7273 203d 2054 7275 650d 0a20 2020  s_rs = True..   
 0001de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001deb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001dec0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-0001ded0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
-0001dee0: 7263 6573 2c0d 0a20 2020 2020 2020 2020  rces,..         
+0001dea0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0001deb0: 7069 6e67 203d 205b 636f 645f 656e 7469  ping = [cod_enti
+0001dec0: 7479 5f73 6f75 7263 652c 2072 6563 6f72  ty_source, recor
+0001ded0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+0001dee0: 6e61 6d65 5f73 6f75 7263 652c 0d0a 2020  name_source,..  
 0001def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001df00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df10: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-0001df20: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df50: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
-0001df60: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-0001df70: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-0001df80: 7469 6f6e 2c20 746e 2e63 6f6c 756d 6e5f  tion, tn.column_
-0001df90: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+0001df10: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+0001df20: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+0001df30: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c0d  _union_sources,.
+0001df40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df60: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+0001df70: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+0001df80: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0001df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfc0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-0001dfd0: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfb0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+0001dfc0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
+0001dfd0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+0001dfe0: 6e61 6c5f 706f 7369 7469 6f6e 2c0d 0a20  nal_position,.. 
 0001dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e000: 2020 2020 2020 2020 2020 2020 206e 756d               num
-0001e010: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
-0001e020: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
-0001e030: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2020 2020 2020 2020 2020 7265 636f 7264            record
+0001e020: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6c  _source.column_l
+0001e030: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
 0001e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e050: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0001e060: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0001e070: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001e080: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0001e090: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0b0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0001e0c0: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-0001e0d0: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-0001e0e0: 735f 6164 3a0d 0a20 2020 2020 2020 2020  s_ad:..         
-0001e0f0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-0001e100: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
-0001e110: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0001e120: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
-0001e130: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-0001e140: 6e74 6974 795f 7461 7267 6574 280d 0a20  ntity_target(.. 
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2020 2020 2064 765f 656e 7469 7479         dv_entity
-0001e170: 2e63 6f64 5f65 6e74 6974 792c 206e 756d  .cod_entity, num
-0001e180: 5f62 7261 6e63 6829 0d0a 2020 2020 2020  _branch)..      
-0001e190: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001e1a0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001e1b0: 6720 3d20 5b63 6f64 5f65 6e74 6974 795f  g = [cod_entity_
-0001e1c0: 736f 7572 6365 2c20 6170 706c 6965 645f  source, applied_
-0001e1d0: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0001e1e0: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
-0001e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e210: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-0001e220: 2073 6174 655f 656e 7469 7479 5f75 6e69   sate_entity_uni
-0001e230: 6f6e 5f73 6f75 7263 6573 2c0d 0a20 2020  on_sources,..   
-0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e260: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
-0001e270: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0001e280: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-0001e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2b0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-0001e2c0: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-0001e2d0: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-0001e2e0: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
+0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e060: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0001e070: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+0001e080: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+0001e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001e0b0: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
+0001e0c0: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
+0001e0d0: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
+0001e0e0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0001e0f0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0001e100: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+0001e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e120: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0001e130: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0001e140: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001e150: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0001e160: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0001e170: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0001e180: 6173 5f74 6e3a 0d0a 2020 2020 2020 2020  as_tn:..        
+0001e190: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0001e1a0: 656e 2874 656e 616e 745f 736f 7572 6365  en(tenant_source
+0001e1b0: 2920 213d 2030 3a20 6861 735f 746e 203d  ) != 0: has_tn =
+0001e1c0: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+0001e1d0: 2020 2020 2020 2020 2020 2074 656e 616e             tenan
+0001e1e0: 745f 736f 7572 6365 203d 2073 656c 662e  t_source = self.
+0001e1f0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0001e200: 6765 745f 7465 6e61 6e74 5f6f 6e5f 6476  get_tenant_on_dv
+0001e210: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+0001e220: 5f74 6172 6765 745f 616e 645f 6e75 6d5f  _target_and_num_
+0001e230: 6272 616e 6368 2863 6f64 5f65 6e74 6974  branch(cod_entit
+0001e240: 795f 7461 7267 6574 2c20 6e75 6d5f 6272  y_target, num_br
+0001e250: 616e 6368 290d 0a20 2020 2020 2020 2020  anch)..         
+0001e260: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+0001e270: 6e20 696e 2074 656e 616e 745f 736f 7572  n in tenant_sour
+0001e280: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+0001e290: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0001e2a0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001e2b0: 203d 205b 636f 645f 656e 7469 7479 5f73   = [cod_entity_s
+0001e2c0: 6f75 7263 652c 2074 6e2e 636f 6c75 6d6e  ource, tn.column
+0001e2d0: 5f6e 616d 655f 736f 7572 6365 2c0d 0a20  _name_source,.. 
+0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e310: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-0001e320: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0001e330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e300: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001e310: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+0001e320: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
+0001e330: 6365 732c 0d0a 2020 2020 2020 2020 2020  ces,..          
 0001e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e350: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0001e360: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-0001e370: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+0001e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e360: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+0001e370: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
 0001e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3a0: 2020 2020 2020 206e 756d 5f62 7261 6e63         num_branc
-0001e3b0: 682c 204b 4559 5f54 5950 455f 4150 504c  h, KEY_TYPE_APPL
-0001e3c0: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
-0001e3d0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0001e3e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0001e3f0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0001e400: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0001e410: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0001e420: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0001e430: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0001e440: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0001e450: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0001e460: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0001e470: 2020 2023 2047 6574 2044 7269 7665 6e20     # Get Driven 
-0001e480: 4b65 7920 6e75 6d5f 636f 6e6e 6563 7469  Key num_connecti
-0001e490: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-0001e4a0: 2020 2020 616c 6c5f 636f 6e6e 6563 7469      all_connecti
-0001e4b0: 6f6e 735f 7769 7468 5f64 6b20 3d20 7365  ons_with_dk = se
-0001e4c0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0001e4d0: 616c 2e67 6574 5f6c 6973 745f 6e75 6d5f  al.get_list_num_
-0001e4e0: 636f 6e6e 6563 7469 6f6e 5f77 6974 685f  connection_with_
-0001e4f0: 6472 6976 656e 5f6b 6579 5f66 726f 6d5f  driven_key_from_
-0001e500: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-0001e510: 7428 6476 5f65 6e74 6974 792e 636f 645f  t(dv_entity.cod_
-0001e520: 656e 7469 7479 290d 0a20 2020 2020 2020  entity)..       
-0001e530: 2020 2020 2020 2020 2061 6c6c 5f68 6173           all_has
-0001e540: 6865 735f 6672 6f6d 5f64 6b20 3d20 5b5d  hes_from_dk = []
-0001e550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e560: 2020 666f 7220 6e75 6d5f 636f 6e20 696e    for num_con in
-0001e570: 2061 6c6c 5f63 6f6e 6e65 6374 696f 6e73   all_connections
-0001e580: 5f77 6974 685f 646b 3a0d 0a20 2020 2020  _with_dk:..     
-0001e590: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0001e5a0: 6173 685f 6e61 6d65 5f68 7562 203d 2027  ash_name_hub = '
-0001e5b0: 4841 5348 5f27 202b 2073 7472 286e 756d  HASH_' + str(num
-0001e5c0: 5f63 6f6e 290d 0a20 2020 2020 2020 2020  _con)..         
-0001e5d0: 2020 2020 2020 2020 2020 2064 765f 7072             dv_pr
-0001e5e0: 6f70 6572 7479 203d 2073 656c 662e 6d65  operty = self.me
-0001e5f0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-0001e600: 745f 6476 5f70 726f 7065 7274 6965 735f  t_dv_properties_
-0001e610: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-0001e620: 616e 645f 6e75 6d5f 636f 6e6e 6563 7469  and_num_connecti
-0001e630: 6f6e 2864 765f 656e 7469 7479 2e63 6f64  on(dv_entity.cod
-0001e640: 5f65 6e74 6974 792c 206e 756d 5f63 6f6e  _entity, num_con
-0001e650: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001e660: 2020 2020 2020 2069 6620 6476 5f70 726f         if dv_pro
-0001e670: 7065 7274 7920 6973 206e 6f74 204e 6f6e  perty is not Non
-0001e680: 653a 2068 6173 685f 6e61 6d65 5f68 7562  e: hash_name_hub
-0001e690: 203d 2064 765f 7072 6f70 6572 7479 2e68   = dv_property.h
-0001e6a0: 6173 685f 6e61 6d65 0d0a 2020 2020 2020  ash_name..      
-0001e6b0: 2020 2020 2020 2020 2020 2020 2020 616c                al
-0001e6c0: 6c5f 6861 7368 6573 5f66 726f 6d5f 646b  l_hashes_from_dk
-0001e6d0: 2e61 7070 656e 6428 6861 7368 5f6e 616d  .append(hash_nam
-0001e6e0: 655f 6875 6229 0d0a 2020 2020 2020 2020  e_hub)..        
-0001e6f0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-0001e700: 5f6b 6579 203d 2073 656c 662e 6765 745f  _key = self.get_
-0001e710: 6861 7368 5f6b 6579 5f66 726f 6d5f 636f  hash_key_from_co
-0001e720: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
-0001e730: 616e 645f 6e75 6d5f 6272 616e 6368 5f61  and_num_branch_a
-0001e740: 6e64 5f6e 756d 5f63 6f6e 6e65 6374 696f  nd_num_connectio
-0001e750: 6e28 636f 645f 656e 7469 7479 5f74 6172  n(cod_entity_tar
-0001e760: 6765 742c 206e 756d 5f62 7261 6e63 682c  get, num_branch,
-0001e770: 206e 756d 5f63 6f6e 290d 0a20 2020 2020   num_con)..     
-0001e780: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001e790: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0001e7a0: 6e67 203d 205b 636f 645f 656e 7469 7479  ng = [cod_entity
-0001e7b0: 5f73 6f75 7263 652c 2068 6173 685f 6b65  _source, hash_ke
-0001e7c0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+0001e3a0: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
+0001e3b0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+0001e3c0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+0001e3d0: 696f 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c  ion, tn.column_l
+0001e3e0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e410: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+0001e420: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e450: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0001e460: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
+0001e470: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
+0001e480: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0001e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4a0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0001e4b0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0001e4c0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0001e4d0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0001e4e0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+0001e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e500: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0001e510: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+0001e520: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0001e530: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
+0001e540: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+0001e550: 645f 6461 7465 203d 2073 656c 662e 6d65  d_date = self.me
+0001e560: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+0001e570: 745f 6170 706c 6965 645f 6461 7465 5f6f  t_applied_date_o
+0001e580: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+0001e590: 7469 7479 5f74 6172 6765 7428 0d0a 2020  tity_target(..  
+0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5b0: 2020 2020 2020 6476 5f65 6e74 6974 792e        dv_entity.
+0001e5c0: 636f 645f 656e 7469 7479 2c20 6e75 6d5f  cod_entity, num_
+0001e5d0: 6272 616e 6368 290d 0a20 2020 2020 2020  branch)..       
+0001e5e0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0001e5f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001e600: 203d 205b 636f 645f 656e 7469 7479 5f73   = [cod_entity_s
+0001e610: 6f75 7263 652c 2061 7070 6c69 6564 5f64  ource, applied_d
+0001e620: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+0001e630: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
+0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e660: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0001e670: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
+0001e680: 6e5f 736f 7572 6365 732c 0d0a 2020 2020  n_sources,..    
+0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6b0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
+0001e6c0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+0001e6d0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e700: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0001e710: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0001e720: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0001e730: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
+0001e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e760: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
+0001e770: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7a0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0001e7b0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f70  ed_date.column_p
+0001e7c0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
 0001e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e7e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001e7f0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-0001e800: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
-0001e810: 7263 6573 2c0d 0a20 2020 2020 2020 2020  rces,..         
-0001e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e840: 2020 6861 7368 5f6e 616d 655f 6875 622c    hash_name_hub,
-0001e850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e870: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0001e880: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-0001e890: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-0001e8a0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-0001e8b0: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
-0001e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8e0: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
-0001e8f0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
-0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e920: 2020 2020 2020 2020 206e 756d 5f62 7261           num_bra
-0001e930: 6e63 682c 204b 4559 5f54 5950 455f 4841  nch, KEY_TYPE_HA
-0001e940: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
-0001e950: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0001e960: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0001e970: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0001e980: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-0001e990: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0001e9a0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0001e9b0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-0001e9c0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-0001e9d0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-0001e9e0: 0a20 2020 2020 2020 2020 2020 2023 2323  .            ###
-0001e9f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ea00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ea10: 2323 204c 4153 5420 494d 4147 4520 2323  ## LAST IMAGE ##
-0001ea20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ea30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001ea40: 2323 230d 0a20 2020 2020 2020 2020 2020  ###..           
-0001ea50: 2069 6e74 6567 6572 5f66 6f72 5f6d 6574   integer_for_met
-0001ea60: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
-0001ea70: 6e65 6374 696f 6e2e 6765 745f 696e 7465  nection.get_inte
-0001ea80: 6765 725f 666f 725f 6d65 7461 6461 7461  ger_for_metadata
-0001ea90: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0001eaa0: 2320 4c61 7374 2049 6d61 6765 2031 0d0a  # Last Image 1..
-0001eab0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0001eac0: 6e61 6c5f 706f 7369 7469 6f6e 203d 2031  nal_position = 1
-0001ead0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-0001eae0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001eaf0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-0001eb00: 2073 6174 655f 656e 7469 7479 2c20 6861   sate_entity, ha
-0001eb10: 7368 5f6e 616d 652c 2070 7265 6669 785f  sh_name, prefix_
-0001eb20: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-0001eb30: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
-0001eb40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb60: 2020 2020 2068 6173 685f 6e61 6d65 2c0d       hash_name,.
-0001eb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb90: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-0001eba0: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-0001ebb0: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
-0001ebc0: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-0001ebd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ebf0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-0001ec00: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
-0001ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7f0: 2020 2020 2020 6e75 6d5f 6272 616e 6368        num_branch
+0001e800: 2c20 4b45 595f 5459 5045 5f41 5050 4c49  , KEY_TYPE_APPLI
+0001e810: 4544 5f44 4154 452c 2031 2c20 7365 6c66  ED_DATE, 1, self
+0001e820: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0001e830: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0001e840: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0001e850: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+0001e860: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0001e870: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0001e880: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0001e890: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0001e8a0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0001e8b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001e8c0: 2020 2320 4765 7420 4472 6976 656e 204b    # Get Driven K
+0001e8d0: 6579 206e 756d 5f63 6f6e 6e65 6374 696f  ey num_connectio
+0001e8e0: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+0001e8f0: 2020 2061 6c6c 5f63 6f6e 6e65 6374 696f     all_connectio
+0001e900: 6e73 5f77 6974 685f 646b 203d 2073 656c  ns_with_dk = sel
+0001e910: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0001e920: 6c2e 6765 745f 6c69 7374 5f6e 756d 5f63  l.get_list_num_c
+0001e930: 6f6e 6e65 6374 696f 6e5f 7769 7468 5f64  onnection_with_d
+0001e940: 7269 7665 6e5f 6b65 795f 6672 6f6d 5f63  riven_key_from_c
+0001e950: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+0001e960: 2864 765f 656e 7469 7479 2e63 6f64 5f65  (dv_entity.cod_e
+0001e970: 6e74 6974 7929 0d0a 2020 2020 2020 2020  ntity)..        
+0001e980: 2020 2020 2020 2020 616c 6c5f 6861 7368          all_hash
+0001e990: 6573 5f66 726f 6d5f 646b 203d 205b 5d0d  es_from_dk = [].
+0001e9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e9b0: 2066 6f72 206e 756d 5f63 6f6e 2069 6e20   for num_con in 
+0001e9c0: 616c 6c5f 636f 6e6e 6563 7469 6f6e 735f  all_connections_
+0001e9d0: 7769 7468 5f64 6b3a 0d0a 2020 2020 2020  with_dk:..      
+0001e9e0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0001e9f0: 7368 5f6e 616d 655f 6875 6220 3d20 2748  sh_name_hub = 'H
+0001ea00: 4153 485f 2720 2b20 7374 7228 6e75 6d5f  ASH_' + str(num_
+0001ea10: 636f 6e29 0d0a 2020 2020 2020 2020 2020  con)..          
+0001ea20: 2020 2020 2020 2020 2020 6476 5f70 726f            dv_pro
+0001ea30: 7065 7274 7920 3d20 7365 6c66 2e6d 6574  perty = self.met
+0001ea40: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+0001ea50: 5f64 765f 7072 6f70 6572 7469 6573 5f66  _dv_properties_f
+0001ea60: 726f 6d5f 636f 645f 656e 7469 7479 5f61  rom_cod_entity_a
+0001ea70: 6e64 5f6e 756d 5f63 6f6e 6e65 6374 696f  nd_num_connectio
+0001ea80: 6e28 6476 5f65 6e74 6974 792e 636f 645f  n(dv_entity.cod_
+0001ea90: 656e 7469 7479 2c20 6e75 6d5f 636f 6e29  entity, num_con)
+0001eaa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001eab0: 2020 2020 2020 6966 2064 765f 7072 6f70        if dv_prop
+0001eac0: 6572 7479 2069 7320 6e6f 7420 4e6f 6e65  erty is not None
+0001ead0: 3a20 6861 7368 5f6e 616d 655f 6875 6220  : hash_name_hub 
+0001eae0: 3d20 6476 5f70 726f 7065 7274 792e 6861  = dv_property.ha
+0001eaf0: 7368 5f6e 616d 650d 0a20 2020 2020 2020  sh_name..       
+0001eb00: 2020 2020 2020 2020 2020 2020 2061 6c6c               all
+0001eb10: 5f68 6173 6865 735f 6672 6f6d 5f64 6b2e  _hashes_from_dk.
+0001eb20: 6170 7065 6e64 2868 6173 685f 6e61 6d65  append(hash_name
+0001eb30: 5f68 7562 290d 0a20 2020 2020 2020 2020  _hub)..         
+0001eb40: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+0001eb50: 6b65 7920 3d20 7365 6c66 2e67 6574 5f68  key = self.get_h
+0001eb60: 6173 685f 6b65 795f 6672 6f6d 5f63 6f64  ash_key_from_cod
+0001eb70: 5f65 6e74 6974 795f 7461 7267 6574 5f61  _entity_target_a
+0001eb80: 6e64 5f6e 756d 5f62 7261 6e63 685f 616e  nd_num_branch_an
+0001eb90: 645f 6e75 6d5f 636f 6e6e 6563 7469 6f6e  d_num_connection
+0001eba0: 2863 6f64 5f65 6e74 6974 795f 7461 7267  (cod_entity_targ
+0001ebb0: 6574 2c20 6e75 6d5f 6272 616e 6368 2c20  et, num_branch, 
+0001ebc0: 6e75 6d5f 636f 6e29 0d0a 2020 2020 2020  num_con)..      
+0001ebd0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001ebe0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0001ebf0: 6720 3d20 5b63 6f64 5f65 6e74 6974 795f  g = [cod_entity_
+0001ec00: 736f 7572 6365 2c20 6861 7368 5f6b 6579  source, hash_key
+0001ec10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0001ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec30: 312c 204b 4559 5f54 5950 455f 4841 5348  1, KEY_TYPE_HASH
-0001ec40: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
-0001ec50: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001ec60: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0001ec70: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-0001ec80: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0001ec90: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-0001eca0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-0001ecb0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-0001ecc0: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-0001ecd0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
-0001ece0: 7465 5f66 6f72 5f6d 6574 6164 6174 6120  te_for_metadata 
-0001ecf0: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
-0001ed00: 6e2e 6765 745f 7379 7364 6174 655f 666f  n.get_sysdate_fo
-0001ed10: 725f 6d65 7461 6461 7461 2829 0d0a 2020  r_metadata()..  
-0001ed20: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-0001ed30: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0001ed40: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-0001ed50: 655f 656e 7469 7479 2c20 2744 4154 455f  e_entity, 'DATE_
-0001ed60: 5354 4152 5427 2c20 7072 6566 6978 5f65  START', prefix_e
-0001ed70: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-0001ed80: 6163 7475 616c 5f69 6d61 6765 5f31 2c0d  actual_image_1,.
-0001ed90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001edb0: 2020 2020 2744 4154 455f 5354 4152 5427      'DATE_START'
-0001edc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ede0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-0001edf0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-0001ee00: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0001ee10: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-0001ee20: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee40: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0001ee50: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-0001ee60: 7461 5b32 5d2c 2031 2c20 4e6f 6e65 2c20  ta[2], 1, None, 
-0001ee70: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0001ee80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001ee90: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0001eea0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0001eeb0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0001eec0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001eed0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0001eee0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0001eef0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-0001ef00: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-0001ef10: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
-0001ef20: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-0001ef30: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-0001ef40: 6461 7461 2829 0d0a 2020 2020 2020 2020  data()..        
-0001ef50: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0001ef60: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-0001ef70: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-0001ef80: 7479 2c20 2744 4154 455f 454e 4427 2c20  ty, 'DATE_END', 
-0001ef90: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-0001efa0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0001efb0: 6d61 6765 5f31 2c0d 0a20 2020 2020 2020  mage_1,..       
+0001ec30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001ec40: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+0001ec50: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
+0001ec60: 6365 732c 0d0a 2020 2020 2020 2020 2020  ces,..          
+0001ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ec90: 2068 6173 685f 6e61 6d65 5f68 7562 2c0d   hash_name_hub,.
+0001eca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecc0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0001ecd0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+0001ece0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+0001ecf0: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
+0001ed00: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
+0001ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed30: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
+0001ed40: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+0001ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed70: 2020 2020 2020 2020 6e75 6d5f 6272 616e          num_bran
+0001ed80: 6368 2c20 4b45 595f 5459 5045 5f48 4153  ch, KEY_TYPE_HAS
+0001ed90: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
+0001eda0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0001edb0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+0001edc0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+0001edd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ede0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0001edf0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0001ee00: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0001ee10: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0001ee20: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+0001ee30: 2020 2020 2020 2020 2020 2020 2323 2323              ####
+0001ee40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee60: 2320 4c41 5354 2049 4d41 4745 2023 2323  # LAST IMAGE ###
+0001ee70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ee90: 2323 0d0a 2020 2020 2020 2020 2020 2020  ##..            
+0001eea0: 696e 7465 6765 725f 666f 725f 6d65 7461  integer_for_meta
+0001eeb0: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
+0001eec0: 6563 7469 6f6e 2e67 6574 5f69 6e74 6567  ection.get_integ
+0001eed0: 6572 5f66 6f72 5f6d 6574 6164 6174 6128  er_for_metadata(
+0001eee0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0001eef0: 204c 6173 7420 496d 6167 6520 310d 0a20   Last Image 1.. 
+0001ef00: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+0001ef10: 616c 5f70 6f73 6974 696f 6e20 3d20 310d  al_position = 1.
+0001ef20: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0001ef30: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001ef40: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+0001ef50: 7361 7465 5f65 6e74 6974 792c 2068 6173  sate_entity, has
+0001ef60: 685f 6e61 6d65 2c20 7072 6566 6978 5f65  h_name, prefix_e
+0001ef70: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+0001ef80: 6163 7475 616c 5f69 6d61 6765 5f31 2c0d  actual_image_1,.
+0001ef90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efb0: 2020 2020 6861 7368 5f6e 616d 652c 0d0a      hash_name,..
 0001efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efd0: 2020 2020 2020 2020 2020 2020 2744 4154              'DAT
-0001efe0: 455f 454e 4427 2c0d 0a20 2020 2020 2020  E_END',..       
-0001eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f000: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-0001f010: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-0001f020: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-0001f030: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
-0001f040: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-0001f050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efe0: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
+0001eff0: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+0001f000: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
+0001f010: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+0001f020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f040: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+0001f050: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
 0001f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f070: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0001f080: 6d65 7461 6461 7461 5b32 5d2c 2031 2c20  metadata[2], 1, 
-0001f090: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
-0001f0a0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001f0b0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0001f0c0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0001f0d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0001f0e0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0001f0f0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-0001f100: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0001f110: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-0001f120: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-0001f130: 735f 7273 3a0d 0a20 2020 2020 2020 2020  s_rs:..         
-0001f140: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0001f150: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0001f160: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-0001f170: 6e74 6974 792c 2072 6563 6f72 645f 736f  ntity, record_so
-0001f180: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-0001f190: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-0001f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1c0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0001f1d0: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
-0001f1e0: 696d 6167 655f 312c 0d0a 2020 2020 2020  image_1,..      
+0001f070: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+0001f080: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
+0001f090: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
+0001f0a0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001f0b0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0001f0c0: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+0001f0d0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0001f0e0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0001f0f0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+0001f100: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+0001f110: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+0001f120: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
+0001f130: 655f 666f 725f 6d65 7461 6461 7461 203d  e_for_metadata =
+0001f140: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
+0001f150: 2e67 6574 5f73 7973 6461 7465 5f66 6f72  .get_sysdate_for
+0001f160: 5f6d 6574 6164 6174 6128 290d 0a20 2020  _metadata()..   
+0001f170: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+0001f180: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+0001f190: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+0001f1a0: 5f65 6e74 6974 792c 2027 4441 5445 5f53  _entity, 'DATE_S
+0001f1b0: 5441 5254 272c 2070 7265 6669 785f 6574  TART', prefix_et
+0001f1c0: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
+0001f1d0: 6374 7561 6c5f 696d 6167 655f 312c 0d0a  ctual_image_1,..
+0001f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f210: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-0001f220: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0001f230: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0001f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f250: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0001f260: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0001f270: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-0001f280: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
-0001f290: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-0001f2a0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-0001f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f2d0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-0001f2e0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-0001f2f0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0001f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f310: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-0001f320: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-0001f330: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-0001f340: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0001f350: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0001f360: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-0001f370: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001f380: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0001f390: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0001f3a0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0001f3b0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0001f3c0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0001f3d0: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
-0001f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3f0: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
-0001f400: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0001f410: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
-0001f420: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-0001f430: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-0001f440: 5f6e 756d 5f62 7261 6e63 6828 636f 645f  _num_branch(cod_
-0001f450: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
-0001f460: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001f470: 2020 2066 6f72 2074 6e20 696e 2074 656e     for tn in ten
-0001f480: 616e 745f 736f 7572 6365 3a0d 0a20 2020  ant_source:..   
-0001f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4a0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0001f4b0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0001f4c0: 7420 2b20 7361 7465 5f65 6e74 6974 792c  t + sate_entity,
-0001f4d0: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-0001f4e0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-0001f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f510: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-0001f520: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
-0001f530: 6e5f 736f 7572 6365 732c 0d0a 2020 2020  n_sources,..    
-0001f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f560: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-0001f570: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-0001f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5a0: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-0001f5b0: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-0001f5c0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001f5d0: 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c 656e  n, tn.column_len
-0001f5e0: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
+0001f200: 2020 2027 4441 5445 5f53 5441 5254 272c     'DATE_START',
+0001f210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f230: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+0001f240: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+0001f250: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0001f260: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0001f270: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+0001f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f290: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0001f2a0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+0001f2b0: 615b 325d 2c20 312c 204e 6f6e 652c 2031  a[2], 1, None, 1
+0001f2c0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0001f2d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001f2e0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0001f2f0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0001f300: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0001f310: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0001f320: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+0001f330: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+0001f340: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+0001f350: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+0001f360: 6d65 7461 6461 7461 203d 2073 656c 662e  metadata = self.
+0001f370: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+0001f380: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+0001f390: 6174 6128 290d 0a20 2020 2020 2020 2020  ata()..         
+0001f3a0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0001f3b0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+0001f3c0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+0001f3d0: 792c 2027 4441 5445 5f45 4e44 272c 2070  y, 'DATE_END', p
+0001f3e0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+0001f3f0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+0001f400: 6167 655f 312c 0d0a 2020 2020 2020 2020  age_1,..        
+0001f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f420: 2020 2020 2020 2020 2020 2027 4441 5445             'DATE
+0001f430: 5f45 4e44 272c 0d0a 2020 2020 2020 2020  _END',..        
+0001f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f450: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+0001f460: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+0001f470: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+0001f480: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
+0001f490: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+0001f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4c0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+0001f4d0: 6574 6164 6174 615b 325d 2c20 312c 204e  etadata[2], 1, N
+0001f4e0: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
+0001f4f0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001f500: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0001f510: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0001f520: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0001f530: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0001f540: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+0001f550: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001f560: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0001f570: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0001f580: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
+0001f590: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0001f5a0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0001f5b0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+0001f5c0: 7469 7479 2c20 7265 636f 7264 5f73 6f75  tity, record_sou
+0001f5d0: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+0001f5e0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
 0001f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f610: 2074 6e2e 636f 6c75 6d6e 5f70 7265 6369   tn.column_preci
-0001f620: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-0001f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f610: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+0001f620: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+0001f630: 6d61 6765 5f31 2c0d 0a20 2020 2020 2020  mage_1,..       
 0001f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f650: 2020 312c 204b 4559 5f54 5950 455f 5445    1, KEY_TYPE_TE
-0001f660: 4e41 4e54 2c20 312c 2073 656c 662e 6f77  NANT, 1, self.ow
-0001f670: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0001f680: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0001f690: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0001f6a0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-0001f6b0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-0001f6c0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-0001f6d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001f6e0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0001f6f0: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-0001f700: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-0001f710: 735f 6164 3a0d 0a20 2020 2020 2020 2020  s_ad:..         
-0001f720: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-0001f730: 6174 6520 3d20 7365 6c66 2e6d 6574 6164  ate = self.metad
-0001f740: 6174 615f 6163 7475 616c 2e67 6574 5f61  ata_actual.get_a
-0001f750: 7070 6c69 6564 5f64 6174 655f 6f6e 5f64  pplied_date_on_d
-0001f760: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-0001f770: 795f 7461 7267 6574 2863 6f64 5f65 6e74  y_target(cod_ent
-0001f780: 6974 795f 7461 7267 6574 2c20 3129 0d0a  ity_target, 1)..
-0001f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7a0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001f7b0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0001f7c0: 202b 2073 6174 655f 656e 7469 7479 2c20   + sate_entity, 
-0001f7d0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-0001f7e0: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-0001f7f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f810: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-0001f820: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-0001f830: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c0d  _union_sources,.
-0001f840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f860: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
-0001f870: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0001f880: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-0001f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8b0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-0001f8c0: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-0001f8d0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0001f8e0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0001f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f900: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0001f910: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-0001f920: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0001f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f660: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+0001f670: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+0001f680: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f6a0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+0001f6b0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
+0001f6c0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+0001f6d0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7265  nal_position, re
+0001f6e0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+0001f6f0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+0001f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f720: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0001f730: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+0001f740: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+0001f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f760: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+0001f770: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+0001f780: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+0001f790: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0001f7a0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0001f7b0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0001f7c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001f7d0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0001f7e0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0001f7f0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0001f800: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0001f810: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+0001f820: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+0001f830: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001f840: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
+0001f850: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0001f860: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
+0001f870: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+0001f880: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+0001f890: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
+0001f8a0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
+0001f8b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f8c0: 2020 666f 7220 746e 2069 6e20 7465 6e61    for tn in tena
+0001f8d0: 6e74 5f73 6f75 7263 653a 0d0a 2020 2020  nt_source:..    
+0001f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8f0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0001f900: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0001f910: 202b 2073 6174 655f 656e 7469 7479 2c20   + sate_entity, 
+0001f920: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+0001f930: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
 0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f950: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-0001f960: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-0001f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f990: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-0001f9a0: 5045 5f41 5050 4c49 4544 5f44 4154 452c  PE_APPLIED_DATE,
-0001f9b0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0001f9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f9d0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001f9e0: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-0001f9f0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0001fa00: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0001fa10: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0001fa20: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0001fa30: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0001fa40: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-0001fa50: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001fa60: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-0001fa70: 2073 6174 655f 656e 7469 7479 2c0d 0a20   sate_entity,.. 
+0001f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f960: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+0001f970: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
+0001f980: 5f73 6f75 7263 6573 2c0d 0a20 2020 2020  _sources,..     
+0001f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9b0: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+0001f9c0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+0001f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9f0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+0001fa00: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+0001fa10: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001fa20: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
+0001fa30: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0001fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa60: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
+0001fa70: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
 0001fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001faa0: 2020 2752 4f57 5f4e 554d 4245 5228 2920    'ROW_NUMBER() 
-0001fab0: 6f76 6572 2028 7061 7274 6974 696f 6e20  over (partition 
-0001fac0: 6279 2027 202b 2068 6173 685f 6e61 6d65  by ' + hash_name
-0001fad0: 202b 2027 204f 5244 4552 2042 5920 4441   + ' ORDER BY DA
-0001fae0: 5445 5f43 5245 4154 4544 2064 6573 6329  TE_CREATED desc)
-0001faf0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0001fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb10: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0001fb20: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
-0001fb30: 6374 7561 6c5f 696d 6167 655f 312c 2027  ctual_image_1, '
-0001fb40: 524e 272c 0d0a 2020 2020 2020 2020 2020  RN',..          
-0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb60: 2020 2020 2020 2020 2069 6e74 6567 6572           integer
-0001fb70: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-0001fb80: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0001fb90: 6f6e 2c20 696e 7465 6765 725f 666f 725f  on, integer_for_
-0001fba0: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
-0001fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbd0: 2069 6e74 6567 6572 5f66 6f72 5f6d 6574   integer_for_met
-0001fbe0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-0001fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc00: 2020 2020 2020 2020 2020 2020 2020 312c                1,
-0001fc10: 204b 4559 5f54 5950 455f 4e55 4c4c 2c20   KEY_TYPE_NULL, 
-0001fc20: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0001fc30: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0001fc40: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0001fc50: 310d 0a20 2020 2020 2020 2020 2020 2073  1..            s
-0001fc60: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0001fc70: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0001fc80: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0001fc90: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0001fca0: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
-0001fcb0: 2020 2020 2023 204c 6173 7420 496d 6167       # Last Imag
-0001fcc0: 6520 320d 0a20 2020 2020 2020 2020 2020  e 2..           
-0001fcd0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0001fce0: 6e20 3d20 310d 0a20 2020 2020 2020 2020  n = 1..         
-0001fcf0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0001fd00: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-0001fd10: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-0001fd20: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
-0001fd30: 2c20 6861 7368 5f6e 616d 652c 0d0a 2020  , hash_name,..  
+0001faa0: 2031 2c20 4b45 595f 5459 5045 5f54 454e   1, KEY_TYPE_TEN
+0001fab0: 414e 542c 2031 2c20 7365 6c66 2e6f 776e  ANT, 1, self.own
+0001fac0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0001fad0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0001fae0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0001faf0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+0001fb00: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+0001fb10: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+0001fb20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fb30: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0001fb40: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0001fb50: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+0001fb60: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
+0001fb70: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+0001fb80: 7465 203d 2073 656c 662e 6d65 7461 6461  te = self.metada
+0001fb90: 7461 5f61 6374 7561 6c2e 6765 745f 6170  ta_actual.get_ap
+0001fba0: 706c 6965 645f 6461 7465 5f6f 6e5f 6476  plied_date_on_dv
+0001fbb0: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+0001fbc0: 5f74 6172 6765 7428 636f 645f 656e 7469  _target(cod_enti
+0001fbd0: 7479 5f74 6172 6765 742c 2031 290d 0a20  ty_target, 1).. 
+0001fbe0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001fbf0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0001fc00: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0001fc10: 2b20 7361 7465 5f65 6e74 6974 792c 2061  + sate_entity, a
+0001fc20: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+0001fc30: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+0001fc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc60: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0001fc70: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+0001fc80: 756e 696f 6e5f 736f 7572 6365 732c 0d0a  union_sources,..
+0001fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fcb0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
+0001fcc0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+0001fcd0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+0001fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd00: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+0001fd10: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+0001fd20: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0001fd30: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
 0001fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd60: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0001fd70: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
-0001fd80: 696d 6167 655f 322c 0d0a 2020 2020 2020  image_2,..      
-0001fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fda0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0001fdb0: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
+0001fd50: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0001fd60: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6c  ed_date.column_l
+0001fd70: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+0001fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001fda0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+0001fdb0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
 0001fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdd0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-0001fde0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-0001fdf0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0001fe00: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
-0001fe10: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-0001fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe30: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0001fe40: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0001fe50: 325d 2c0d 0a20 2020 2020 2020 2020 2020  2],..           
-0001fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe70: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-0001fe80: 5950 455f 4841 5348 5f4b 4559 2c20 312c  YPE_HASH_KEY, 1,
-0001fe90: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0001fea0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-0001feb0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0001fec0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001fed0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0001fee0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0001fef0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0001ff00: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0001ff10: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
-0001ff20: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-0001ff30: 6574 6164 6174 6120 3d20 7365 6c66 2e63  etadata = self.c
-0001ff40: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
-0001ff50: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-0001ff60: 7461 2829 0d0a 2020 2020 2020 2020 2020  ta()..          
-0001ff70: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0001ff80: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0001ff90: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-0001ffa0: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
-0001ffb0: 2027 4441 5445 5f53 5441 5254 272c 0d0a   'DATE_START',..
-0001ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ffe0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0001fff0: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-00020000: 6c5f 696d 6167 655f 322c 0d0a 2020 2020  l_image_2,..    
+0001fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fde0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+0001fdf0: 455f 4150 504c 4945 445f 4441 5445 2c20  E_APPLIED_DATE, 
+0001fe00: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0001fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fe20: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0001fe30: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+0001fe40: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0001fe50: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0001fe60: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0001fe70: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0001fe80: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+0001fe90: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0001fea0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0001feb0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+0001fec0: 7361 7465 5f65 6e74 6974 792c 0d0a 2020  sate_entity,..  
+0001fed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fef0: 2027 524f 575f 4e55 4d42 4552 2829 206f   'ROW_NUMBER() o
+0001ff00: 7665 7220 2870 6172 7469 7469 6f6e 2062  ver (partition b
+0001ff10: 7920 2720 2b20 6861 7368 5f6e 616d 6520  y ' + hash_name 
+0001ff20: 2b20 2720 4f52 4445 5220 4259 2044 4154  + ' ORDER BY DAT
+0001ff30: 455f 4352 4541 5445 4420 6465 7363 2927  E_CREATED desc)'
+0001ff40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff60: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+0001ff70: 2b20 7361 7465 5f65 6e74 6974 795f 6163  + sate_entity_ac
+0001ff80: 7475 616c 5f69 6d61 6765 5f31 2c20 2752  tual_image_1, 'R
+0001ff90: 4e27 2c0d 0a20 2020 2020 2020 2020 2020  N',..           
+0001ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffb0: 2020 2020 2020 2020 696e 7465 6765 725f          integer_
+0001ffc0: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+0001ffd0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0001ffe0: 6e2c 2069 6e74 6567 6572 5f66 6f72 5f6d  n, integer_for_m
+0001fff0: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
+00020000: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020020: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00020030: 4441 5445 5f53 5441 5254 272c 0d0a 2020  DATE_START',..  
+00020020: 696e 7465 6765 725f 666f 725f 6d65 7461  integer_for_meta
+00020030: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
 00020040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020060: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00020070: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-00020080: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
-00020090: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-000200a0: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
-000200b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200c0: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
-000200d0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-000200e0: 2c20 312c 204e 6f6e 652c 2031 2c20 7365  , 1, None, 1, se
-000200f0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00020100: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00020110: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00020120: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00020130: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00020140: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-00020150: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00020160: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00020170: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00020180: 6966 2068 6173 5f72 733a 0d0a 2020 2020  if has_rs:..    
-00020190: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000201a0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-000201b0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-000201c0: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-000201d0: 6c5f 696d 6167 655f 312c 2072 6563 6f72  l_image_1, recor
-000201e0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-000201f0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00020200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020050: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
+00020060: 4b45 595f 5459 5045 5f4e 554c 4c2c 2031  KEY_TYPE_NULL, 1
+00020070: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00020080: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00020090: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+000200a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000200b0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000200c0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+000200d0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+000200e0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+000200f0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+00020100: 2020 2020 2320 4c61 7374 2049 6d61 6765      # Last Image
+00020110: 2032 0d0a 2020 2020 2020 2020 2020 2020   2..            
+00020120: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00020130: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
+00020140: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00020150: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+00020160: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00020170: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
+00020180: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+00020190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201b0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+000201c0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+000201d0: 6d61 6765 5f32 2c0d 0a20 2020 2020 2020  mage_2,..       
+000201e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000201f0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00020200: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
 00020210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020220: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00020230: 2073 6174 655f 656e 7469 7479 5f61 6374   sate_entity_act
-00020240: 7561 6c5f 696d 6167 655f 322c 0d0a 2020  ual_image_2,..  
-00020250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020270: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-00020280: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
-00020290: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-000202a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000202c0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-000202d0: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-000202e0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-000202f0: 6e2c 2072 6563 6f72 645f 736f 7572 6365  n, record_source
-00020300: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-00020310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020330: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00020340: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
-00020350: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00020360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020380: 312c 204b 4559 5f54 5950 455f 5245 434f  1, KEY_TYPE_RECO
-00020390: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
-000203a0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-000203b0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-000203c0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-000203d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000203e0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-000203f0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00020400: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00020410: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00020420: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00020430: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
-00020440: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00020450: 2020 2020 7465 6e61 6e74 5f73 6f75 7263      tenant_sourc
-00020460: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-00020470: 615f 6163 7475 616c 2e67 6574 5f74 656e  a_actual.get_ten
-00020480: 616e 745f 6f6e 5f64 765f 6672 6f6d 5f63  ant_on_dv_from_c
-00020490: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-000204a0: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
-000204b0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-000204c0: 742c 2031 290d 0a20 2020 2020 2020 2020  t, 1)..         
-000204d0: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
-000204e0: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
-000204f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020500: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-00020510: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-00020520: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00020530: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00020540: 5f31 2c20 746e 2e63 6f6c 756d 6e5f 6e61  _1, tn.column_na
-00020550: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-00020560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020580: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-00020590: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
-000205a0: 6374 7561 6c5f 696d 6167 655f 322c 0d0a  ctual_image_2,..
-000205b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205d0: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-000205e0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-000205f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00020600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020610: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-00020620: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-00020630: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-00020640: 6974 696f 6e2c 2074 6e2e 636f 6c75 6d6e  ition, tn.column
-00020650: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+00020220: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00020230: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+00020240: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00020250: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
+00020260: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00020270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020280: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00020290: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
+000202a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+000202b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000202c0: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+000202d0: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
+000202e0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+000202f0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+00020300: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00020310: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00020320: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00020330: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00020340: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+00020350: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00020360: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+00020370: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00020380: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
+00020390: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
+000203a0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+000203b0: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
+000203c0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+000203d0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+000203e0: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+000203f0: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
+00020400: 2744 4154 455f 5354 4152 5427 2c0d 0a20  'DATE_START',.. 
+00020410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020430: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+00020440: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+00020450: 5f69 6d61 6765 5f32 2c0d 0a20 2020 2020  _image_2,..     
+00020460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020470: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00020480: 4154 455f 5354 4152 5427 2c0d 0a20 2020  ATE_START',..   
+00020490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204b0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+000204c0: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+000204d0: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
+000204e0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+000204f0: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+00020500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020510: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+00020520: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00020530: 2031 2c20 4e6f 6e65 2c20 312c 2073 656c   1, None, 1, sel
+00020540: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00020550: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00020560: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00020570: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00020580: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00020590: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
+000205a0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+000205b0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+000205c0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+000205d0: 6620 6861 735f 7273 3a0d 0a20 2020 2020  f has_rs:..     
+000205e0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+000205f0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00020600: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00020610: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+00020620: 5f69 6d61 6765 5f31 2c20 7265 636f 7264  _image_1, record
+00020630: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
+00020640: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00020650: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020680: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
-00020690: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+00020670: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00020680: 7361 7465 5f65 6e74 6974 795f 6163 7475  sate_entity_actu
+00020690: 616c 5f69 6d61 6765 5f32 2c0d 0a20 2020  al_image_2,..   
 000206a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000206b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000206c0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-000206d0: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
-000206e0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-000206f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00020700: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00020710: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00020720: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00020730: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00020740: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-00020750: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00020760: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00020770: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00020780: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
-00020790: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-000207a0: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
-000207b0: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-000207c0: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
-000207d0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-000207e0: 6e74 6974 795f 7461 7267 6574 2863 6f64  ntity_target(cod
-000207f0: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
-00020800: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00020810: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00020820: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00020830: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00020840: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-00020850: 312c 2061 7070 6c69 6564 5f64 6174 652e  1, applied_date.
-00020860: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00020870: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-00020880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020890: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-000208a0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-000208b0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-000208c0: 5f32 2c0d 0a20 2020 2020 2020 2020 2020  _2,..           
-000208d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208e0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-000208f0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-00020900: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00020910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020930: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00020940: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00020950: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00020960: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
-00020970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020990: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-000209a0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+000206c0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+000206d0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+000206e0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+000206f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020700: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00020710: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00020720: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+00020730: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00020740: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
+00020750: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+00020760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020780: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00020790: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
+000207a0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+000207b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207c0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+000207d0: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
+000207e0: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
+000207f0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00020800: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00020810: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+00020820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020830: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00020840: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00020850: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00020860: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+00020870: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00020880: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
+00020890: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000208a0: 2020 2074 656e 616e 745f 736f 7572 6365     tenant_source
+000208b0: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+000208c0: 5f61 6374 7561 6c2e 6765 745f 7465 6e61  _actual.get_tena
+000208d0: 6e74 5f6f 6e5f 6476 5f66 726f 6d5f 636f  nt_on_dv_from_co
+000208e0: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
+000208f0: 616e 645f 6e75 6d5f 6272 616e 6368 2863  and_num_branch(c
+00020900: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+00020910: 2c20 3129 0d0a 2020 2020 2020 2020 2020  , 1)..          
+00020920: 2020 2020 2020 666f 7220 746e 2069 6e20        for tn in 
+00020930: 7465 6e61 6e74 5f73 6f75 7263 653a 0d0a  tenant_source:..
+00020940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020950: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00020960: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+00020970: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00020980: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00020990: 312c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  1, tn.column_nam
+000209a0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
 000209b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000209c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209d0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-000209e0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-000209f0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000209d0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+000209e0: 2b20 7361 7465 5f65 6e74 6974 795f 6163  + sate_entity_ac
+000209f0: 7475 616c 5f69 6d61 6765 5f32 2c0d 0a20  tual_image_2,.. 
 00020a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a10: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-00020a20: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
-00020a30: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
-00020a40: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00020a50: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00020a60: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00020a70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00020a80: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00020a90: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00020aa0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00020ab0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00020ac0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-00020ad0: 2020 6e65 775f 6669 6c74 6572 203d 205b    new_filter = [
-00020ae0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00020af0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-00020b00: 6d61 6765 5f32 2c0d 0a20 2020 2020 2020  mage_2,..       
-00020b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b20: 2020 2027 524e 203d 2031 2061 6e64 2044     'RN = 1 and D
-00020b30: 4154 455f 454e 4420 3d27 202b 2073 656c  ATE_END =' + sel
-00020b40: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
-00020b50: 5f73 7973 6461 7465 5f76 616c 7565 5f69  _sysdate_value_i
-00020b60: 6e66 696e 6974 6528 292c 2031 2c20 7365  nfinite(), 1, se
-00020b70: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00020b80: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00020b90: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00020ba0: 656e 7472 795f 6669 6c74 6572 7328 5b6e  entry_filters([n
-00020bb0: 6577 5f66 696c 7465 725d 290d 0a0d 0a20  ew_filter]).... 
-00020bc0: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-00020bd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020be0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020bf0: 204c 4153 5420 494d 4147 4520 2d20 496e   LAST IMAGE - In
-00020c00: 636c 7564 696e 6720 4472 6976 656e 204b  cluding Driven K
-00020c10: 6579 2023 2323 2323 2323 2323 2323 2323  ey #############
-00020c20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00020c30: 2323 2323 2323 2323 0d0a 0d0a 2020 2020  ########....    
-00020c40: 2020 2020 2020 2020 2320 5265 6c61 7469          # Relati
-00020c50: 6f6e 7368 6970 2074 6f20 6765 7420 4472  onship to get Dr
-00020c60: 6976 656e 204b 6579 2048 6173 680d 0a20  iven Key Hash.. 
-00020c70: 2020 2020 2020 2020 2020 206e 6577 5f72             new_r
-00020c80: 656c 6174 696f 6e73 6869 7020 3d20 5b70  elationship = [p
-00020c90: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-00020ca0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
-00020cb0: 6167 655f 322c 2068 6173 685f 6e61 6d65  age_2, hash_name
-00020cc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00020a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a20: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+00020a30: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+00020a40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00020a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a60: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+00020a70: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+00020a80: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+00020a90: 7469 6f6e 2c20 746e 2e63 6f6c 756d 6e5f  tion, tn.column_
+00020aa0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+00020ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ad0: 2020 2020 746e 2e63 6f6c 756d 6e5f 7072      tn.column_pr
+00020ae0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+00020af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b10: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+00020b20: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
+00020b30: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00020b40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020b50: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00020b60: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00020b70: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00020b80: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00020b90: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+00020ba0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+00020bb0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00020bc0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00020bd0: 2068 6173 5f61 643a 0d0a 2020 2020 2020   has_ad:..      
+00020be0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+00020bf0: 645f 6461 7465 203d 2073 656c 662e 6d65  d_date = self.me
+00020c00: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+00020c10: 745f 6170 706c 6965 645f 6461 7465 5f6f  t_applied_date_o
+00020c20: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+00020c30: 7469 7479 5f74 6172 6765 7428 636f 645f  tity_target(cod_
+00020c40: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
+00020c50: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00020c60: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00020c70: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+00020c80: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00020c90: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
+00020ca0: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
+00020cb0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00020cc0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
 00020cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ce0: 2020 2063 6f64 5f65 6e74 6974 795f 7461     cod_entity_ta
-00020cf0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-00020d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d10: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-00020d20: 2c20 224d 4153 5445 5220 4a4f 494e 222c  , "MASTER JOIN",
-00020d30: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00020d40: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00020d50: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00020d60: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00020d70: 5f72 656c 6174 696f 6e73 6869 7028 5b6e  _relationship([n
-00020d80: 6577 5f72 656c 6174 696f 6e73 6869 705d  ew_relationship]
-00020d90: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00020da0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00020db0: 6e20 3d20 310d 0a20 2020 2020 2020 2020  n = 1..         
-00020dc0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-00020dd0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-00020de0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00020df0: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
-00020e00: 2c20 6861 7368 5f6e 616d 652c 0d0a 2020  , hash_name,..  
+00020ce0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00020cf0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00020d00: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00020d10: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+00020d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d30: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00020d40: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+00020d50: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00020d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d80: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+00020d90: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00020da0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00020db0: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
+00020dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020dd0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00020de0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00020df0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+00020e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e30: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-00020e40: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
-00020e50: 696d 6167 655f 332c 0d0a 2020 2020 2020  image_3,..      
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e70: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00020e80: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
-00020e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ea0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00020eb0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-00020ec0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00020ed0: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
-00020ee0: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-00020ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f00: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00020f10: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00020f20: 325d 2c0d 0a20 2020 2020 2020 2020 2020  2],..           
-00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f40: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-00020f50: 5950 455f 4841 5348 5f4b 4559 2c20 312c  YPE_HASH_KEY, 1,
-00020f60: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00020f70: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00020f80: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00020f90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00020fa0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00020fb0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00020fc0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-00020fd0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00020fe0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
-00020ff0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-00021000: 6574 6164 6174 6120 3d20 7365 6c66 2e63  etadata = self.c
-00021010: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
-00021020: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00021030: 7461 2829 0d0a 2020 2020 2020 2020 2020  ta()..          
-00021040: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00021050: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00021060: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-00021070: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
-00021080: 2027 4441 5445 5f53 5441 5254 272c 0d0a   'DATE_START',..
-00021090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210b0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-000210c0: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-000210d0: 6c5f 696d 6167 655f 332c 0d0a 2020 2020  l_image_3,..    
-000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00021100: 4441 5445 5f53 5441 5254 272c 0d0a 2020  DATE_START',..  
-00021110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e20: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
+00020e30: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+00020e40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00020e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e60: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+00020e70: 5f54 5950 455f 4150 504c 4945 445f 4441  _TYPE_APPLIED_DA
+00020e80: 5445 2c20 312c 2073 656c 662e 6f77 6e65  TE, 1, self.owne
+00020e90: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00020ea0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00020eb0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+00020ec0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00020ed0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00020ee0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00020ef0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00020f00: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00020f10: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00020f20: 206e 6577 5f66 696c 7465 7220 3d20 5b70   new_filter = [p
+00020f30: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00020f40: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+00020f50: 6167 655f 322c 0d0a 2020 2020 2020 2020  age_2,..        
+00020f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f70: 2020 2752 4e20 3d20 3120 616e 6420 4441    'RN = 1 and DA
+00020f80: 5445 5f45 4e44 203d 2720 2b20 7365 6c66  TE_END =' + self
+00020f90: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
+00020fa0: 7379 7364 6174 655f 7661 6c75 655f 696e  sysdate_value_in
+00020fb0: 6669 6e69 7465 2829 2c20 312c 2073 656c  finite(), 1, sel
+00020fc0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00020fd0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00020fe0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00020ff0: 6e74 7279 5f66 696c 7465 7273 285b 6e65  ntry_filters([ne
+00021000: 775f 6669 6c74 6572 5d29 0d0a 0d0a 2020  w_filter])....  
+00021010: 2020 2020 2020 2020 2020 2323 2323 2323            ######
+00021020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00021030: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+00021040: 4c41 5354 2049 4d41 4745 202d 2049 6e63  LAST IMAGE - Inc
+00021050: 6c75 6469 6e67 2044 7269 7665 6e20 4b65  luding Driven Ke
+00021060: 7920 2323 2323 2323 2323 2323 2323 2323  y ##############
+00021070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00021080: 2323 2323 2323 230d 0a0d 0a20 2020 2020  #######....     
+00021090: 2020 2020 2020 2023 2052 656c 6174 696f         # Relatio
+000210a0: 6e73 6869 7020 746f 2067 6574 2044 7269  nship to get Dri
+000210b0: 7665 6e20 4b65 7920 4861 7368 0d0a 2020  ven Key Hash..  
+000210c0: 2020 2020 2020 2020 2020 6e65 775f 7265            new_re
+000210d0: 6c61 7469 6f6e 7368 6970 203d 205b 7072  lationship = [pr
+000210e0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+000210f0: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
+00021100: 6765 5f32 2c20 6861 7368 5f6e 616d 652c  ge_2, hash_name,
+00021110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00021120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021130: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00021140: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-00021150: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
-00021160: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-00021170: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
-00021180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021190: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
-000211a0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-000211b0: 2c20 312c 204e 6f6e 652c 2031 2c20 7365  , 1, None, 1, se
-000211c0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-000211d0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000211e0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000211f0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00021200: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00021210: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-00021220: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00021230: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00021240: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00021250: 6966 2068 6173 5f72 733a 0d0a 2020 2020  if has_rs:..    
-00021260: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00021270: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00021280: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00021290: 6174 655f 656e 7469 7479 5f61 6374 7561  ate_entity_actua
-000212a0: 6c5f 696d 6167 655f 322c 2072 6563 6f72  l_image_2, recor
-000212b0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-000212c0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021130: 2020 636f 645f 656e 7469 7479 5f74 6172    cod_entity_tar
+00021140: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+00021150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021160: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+00021170: 2022 4d41 5354 4552 204a 4f49 4e22 2c20   "MASTER JOIN", 
+00021180: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+00021190: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+000211a0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+000211b0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+000211c0: 7265 6c61 7469 6f6e 7368 6970 285b 6e65  relationship([ne
+000211d0: 775f 7265 6c61 7469 6f6e 7368 6970 5d29  w_relationship])
+000211e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000211f0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00021200: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
+00021210: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00021220: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+00021230: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00021240: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
+00021250: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+00021260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021280: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+00021290: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+000212a0: 6d61 6765 5f33 2c0d 0a20 2020 2020 2020  mage_3,..       
+000212b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212c0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+000212d0: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
 000212e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000212f0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00021300: 2073 6174 655f 656e 7469 7479 5f61 6374   sate_entity_act
-00021310: 7561 6c5f 696d 6167 655f 332c 0d0a 2020  ual_image_3,..  
-00021320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021340: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-00021350: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
-00021360: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-00021370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021380: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00021390: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-000213a0: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-000213b0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-000213c0: 6e2c 2072 6563 6f72 645f 736f 7572 6365  n, record_source
-000213d0: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-000213e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000213f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021400: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00021410: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
-00021420: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00021430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021450: 312c 204b 4559 5f54 5950 455f 5245 434f  1, KEY_TYPE_RECO
-00021460: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
-00021470: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00021480: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00021490: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-000214a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000214b0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-000214c0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-000214d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000214e0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-000214f0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00021500: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
-00021510: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00021520: 2020 2020 7465 6e61 6e74 5f73 6f75 7263      tenant_sourc
-00021530: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-00021540: 615f 6163 7475 616c 2e67 6574 5f74 656e  a_actual.get_ten
-00021550: 616e 745f 6f6e 5f64 765f 6672 6f6d 5f63  ant_on_dv_from_c
-00021560: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-00021570: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
-00021580: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-00021590: 742c 2031 290d 0a20 2020 2020 2020 2020  t, 1)..         
-000215a0: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
-000215b0: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
-000215c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000215d0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-000215e0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-000215f0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00021600: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00021610: 5f32 2c20 746e 2e63 6f6c 756d 6e5f 6e61  _2, tn.column_na
-00021620: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-00021630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021650: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-00021660: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
-00021670: 6374 7561 6c5f 696d 6167 655f 332c 0d0a  ctual_image_3,..
-00021680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216a0: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-000216b0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-000216c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000216d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216e0: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-000216f0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-00021700: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-00021710: 6974 696f 6e2c 2074 6e2e 636f 6c75 6d6e  ition, tn.column
-00021720: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+000212f0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00021300: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+00021310: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00021320: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
+00021330: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00021340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021350: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00021360: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
+00021370: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00021380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021390: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+000213a0: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
+000213b0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+000213c0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+000213d0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+000213e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000213f0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00021400: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00021410: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+00021420: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00021430: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+00021440: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00021450: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
+00021460: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
+00021470: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00021480: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
+00021490: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+000214a0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+000214b0: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+000214c0: 6163 7475 616c 5f69 6d61 6765 5f32 2c20  actual_image_2, 
+000214d0: 2744 4154 455f 5354 4152 5427 2c0d 0a20  'DATE_START',.. 
+000214e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021500: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+00021510: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+00021520: 5f69 6d61 6765 5f33 2c0d 0a20 2020 2020  _image_3,..     
+00021530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021540: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00021550: 4154 455f 5354 4152 5427 2c0d 0a20 2020  ATE_START',..   
+00021560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021580: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00021590: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+000215a0: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
+000215b0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+000215c0: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+000215d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000215e0: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+000215f0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00021600: 2031 2c20 4e6f 6e65 2c20 312c 2073 656c   1, None, 1, sel
+00021610: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00021620: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00021630: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00021640: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00021650: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00021660: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
+00021670: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00021680: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+00021690: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+000216a0: 6620 6861 735f 7273 3a0d 0a20 2020 2020  f has_rs:..     
+000216b0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+000216c0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+000216d0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+000216e0: 7465 5f65 6e74 6974 795f 6163 7475 616c  te_entity_actual
+000216f0: 5f69 6d61 6765 5f32 2c20 7265 636f 7264  _image_2, record
+00021700: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
+00021710: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00021720: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00021730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021750: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
-00021760: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+00021740: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00021750: 7361 7465 5f65 6e74 6974 795f 6163 7475  sate_entity_actu
+00021760: 616c 5f69 6d61 6765 5f33 2c0d 0a20 2020  al_image_3,..   
 00021770: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00021780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021790: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-000217a0: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
-000217b0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-000217c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000217d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-000217e0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-000217f0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00021800: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00021810: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-00021820: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00021830: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00021840: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00021850: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
-00021860: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00021870: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
-00021880: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-00021890: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
-000218a0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-000218b0: 6e74 6974 795f 7461 7267 6574 2863 6f64  ntity_target(cod
-000218c0: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
-000218d0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-000218e0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-000218f0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00021900: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00021910: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-00021920: 322c 2061 7070 6c69 6564 5f64 6174 652e  2, applied_date.
-00021930: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00021940: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-00021950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021960: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00021970: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00021980: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00021990: 5f33 2c0d 0a20 2020 2020 2020 2020 2020  _3,..           
-000219a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219b0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-000219c0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-000219d0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-000219e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000219f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a00: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00021a10: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00021a20: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00021a30: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
-00021a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a60: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00021a70: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+00021790: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+000217a0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+000217b0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+000217c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000217d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000217e0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+000217f0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+00021800: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00021810: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
+00021820: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+00021830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021850: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00021860: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
+00021870: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+00021880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021890: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+000218a0: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
+000218b0: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
+000218c0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000218d0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+000218e0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+000218f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021900: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00021910: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00021920: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00021930: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+00021940: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00021950: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
+00021960: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00021970: 2020 2074 656e 616e 745f 736f 7572 6365     tenant_source
+00021980: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+00021990: 5f61 6374 7561 6c2e 6765 745f 7465 6e61  _actual.get_tena
+000219a0: 6e74 5f6f 6e5f 6476 5f66 726f 6d5f 636f  nt_on_dv_from_co
+000219b0: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
+000219c0: 616e 645f 6e75 6d5f 6272 616e 6368 2863  and_num_branch(c
+000219d0: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+000219e0: 2c20 3129 0d0a 2020 2020 2020 2020 2020  , 1)..          
+000219f0: 2020 2020 2020 666f 7220 746e 2069 6e20        for tn in 
+00021a00: 7465 6e61 6e74 5f73 6f75 7263 653a 0d0a  tenant_source:..
+00021a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a20: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00021a30: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+00021a40: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00021a50: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00021a60: 322c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  2, tn.column_nam
+00021a70: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
 00021a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00021a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021aa0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-00021ab0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-00021ac0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00021aa0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+00021ab0: 2b20 7361 7465 5f65 6e74 6974 795f 6163  + sate_entity_ac
+00021ac0: 7475 616c 5f69 6d61 6765 5f33 2c0d 0a20  tual_image_3,.. 
 00021ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ae0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-00021af0: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
-00021b00: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
-00021b10: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00021b20: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00021b30: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00021b40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00021b50: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00021b60: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00021b70: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00021b80: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00021b90: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-00021ba0: 2020 2347 6574 2044 7269 7665 6e20 4b65    #Get Driven Ke
-00021bb0: 7920 6e75 6d5f 636f 6e6e 6563 7469 6f6e  y num_connection
-00021bc0: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
-00021bd0: 6c5f 636f 6e6e 6563 7469 6f6e 735f 7769  l_connections_wi
-00021be0: 7468 5f64 6b20 3d20 7365 6c66 2e6d 6574  th_dk = self.met
-00021bf0: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
-00021c00: 5f6c 6973 745f 6e75 6d5f 636f 6e6e 6563  _list_num_connec
-00021c10: 7469 6f6e 5f77 6974 685f 6472 6976 656e  tion_with_driven
-00021c20: 5f6b 6579 5f66 726f 6d5f 636f 645f 656e  _key_from_cod_en
-00021c30: 7469 7479 5f74 6172 6765 7428 6476 5f65  tity_target(dv_e
-00021c40: 6e74 6974 792e 636f 645f 656e 7469 7479  ntity.cod_entity
-00021c50: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-00021c60: 6c6c 5f68 6173 6865 735f 6672 6f6d 5f64  ll_hashes_from_d
-00021c70: 6b20 3d20 5b5d 0d0a 2020 2020 2020 2020  k = []..        
-00021c80: 2020 2020 666f 7220 6e75 6d5f 636f 6e20      for num_con 
-00021c90: 696e 2061 6c6c 5f63 6f6e 6e65 6374 696f  in all_connectio
-00021ca0: 6e73 5f77 6974 685f 646b 3a0d 0a20 2020  ns_with_dk:..   
-00021cb0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00021cc0: 685f 6e61 6d65 5f68 7562 203d 2027 4841  h_name_hub = 'HA
-00021cd0: 5348 5f27 202b 2073 7472 286e 756d 5f63  SH_' + str(num_c
-00021ce0: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
-00021cf0: 2020 2020 2064 765f 7072 6f70 6572 7479       dv_property
-00021d00: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00021d10: 5f61 6374 7561 6c2e 6765 745f 6476 5f70  _actual.get_dv_p
-00021d20: 726f 7065 7274 6965 735f 6672 6f6d 5f63  roperties_from_c
-00021d30: 6f64 5f65 6e74 6974 795f 616e 645f 6e75  od_entity_and_nu
-00021d40: 6d5f 636f 6e6e 6563 7469 6f6e 2864 765f  m_connection(dv_
-00021d50: 656e 7469 7479 2e63 6f64 5f65 6e74 6974  entity.cod_entit
-00021d60: 792c 206e 756d 5f63 6f6e 290d 0a20 2020  y, num_con)..   
-00021d70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00021d80: 6476 5f70 726f 7065 7274 7920 6973 206e  dv_property is n
-00021d90: 6f74 204e 6f6e 653a 2068 6173 685f 6e61  ot None: hash_na
-00021da0: 6d65 5f68 7562 203d 2064 765f 7072 6f70  me_hub = dv_prop
-00021db0: 6572 7479 2e68 6173 685f 6e61 6d65 0d0a  erty.hash_name..
-00021dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021dd0: 616c 6c5f 6861 7368 6573 5f66 726f 6d5f  all_hashes_from_
-00021de0: 646b 2e61 7070 656e 6428 6861 7368 5f6e  dk.append(hash_n
-00021df0: 616d 655f 6875 6229 0d0a 2020 2020 2020  ame_hub)..      
-00021e00: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00021e10: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00021e20: 5b63 6f64 5f65 6e74 6974 795f 7461 7267  [cod_entity_targ
-00021e30: 6574 2c20 6861 7368 5f6e 616d 655f 6875  et, hash_name_hu
-00021e40: 622c 0d0a 2020 2020 2020 2020 2020 2020  b,..            
-00021e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e60: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00021e70: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00021e80: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-00021e90: 332c 0d0a 2020 2020 2020 2020 2020 2020  3,..            
-00021ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021eb0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00021ec0: 6e61 6d65 5f68 7562 2c0d 0a20 2020 2020  name_hub,..     
+00021ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021af0: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+00021b00: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+00021b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00021b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b30: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+00021b40: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+00021b50: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+00021b60: 7469 6f6e 2c20 746e 2e63 6f6c 756d 6e5f  tion, tn.column_
+00021b70: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+00021b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ba0: 2020 2020 746e 2e63 6f6c 756d 6e5f 7072      tn.column_pr
+00021bb0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+00021bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021be0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+00021bf0: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
+00021c00: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00021c10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00021c20: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00021c30: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00021c40: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00021c50: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00021c60: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+00021c70: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+00021c80: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00021c90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00021ca0: 2068 6173 5f61 643a 0d0a 2020 2020 2020   has_ad:..      
+00021cb0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+00021cc0: 645f 6461 7465 203d 2073 656c 662e 6d65  d_date = self.me
+00021cd0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+00021ce0: 745f 6170 706c 6965 645f 6461 7465 5f6f  t_applied_date_o
+00021cf0: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+00021d00: 7469 7479 5f74 6172 6765 7428 636f 645f  tity_target(cod_
+00021d10: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
+00021d20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00021d30: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00021d40: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+00021d50: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00021d60: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+00021d70: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
+00021d80: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00021d90: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00021da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021db0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00021dc0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00021dd0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00021de0: 332c 0d0a 2020 2020 2020 2020 2020 2020  3,..            
+00021df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e00: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00021e10: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+00021e20: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00021e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e50: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+00021e60: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00021e70: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00021e80: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
+00021e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ea0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00021eb0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00021ec0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
 00021ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00021ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ef0: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-00021f00: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00021f10: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-00021f20: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-00021f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f50: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
-00021f60: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-00021f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f90: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-00021fa0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-00021fb0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00021fc0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00021fd0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00021fe0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00021ff0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00022000: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00022010: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00022020: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00022030: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00022040: 2020 2020 2020 2020 2023 2323 2323 2323           #######
-00022050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022060: 2323 2323 2323 2323 2323 2320 4a4f 494e  ########### JOIN
-00022070: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00022080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00022090: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-000220a0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-000220b0: 6469 6e61 6c5f 706f 7369 7469 6f6e 203d  dinal_position =
-000220c0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-000220d0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-000220e0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-000220f0: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
-00022100: 6374 7561 6c5f 696d 6167 655f 332c 2068  ctual_image_3, h
-00022110: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
-00022120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022130: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00022140: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00022150: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
-00022160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022180: 6861 7368 5f6e 616d 6520 2b22 5f48 4953  hash_name +"_HIS
-00022190: 5422 2c0d 0a20 2020 2020 2020 2020 2020  T",..           
-000221a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000221b0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
-000221c0: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
-000221d0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-000221e0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-000221f0: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
-00022200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022210: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00022220: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
-00022230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022250: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-00022260: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
-00022270: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00022280: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00022290: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-000222a0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-000222b0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-000222c0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-000222d0: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-000222e0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-000222f0: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
-00022300: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-00022310: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
-00022320: 6374 696f 6e2e 6765 745f 7379 7364 6174  ction.get_sysdat
-00022330: 655f 666f 725f 6d65 7461 6461 7461 2829  e_for_metadata()
-00022340: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-00022350: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00022360: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-00022370: 2073 6174 655f 656e 7469 7479 5f61 6374   sate_entity_act
-00022380: 7561 6c5f 696d 6167 655f 332c 2027 4441  ual_image_3, 'DA
-00022390: 5445 5f53 5441 5254 272c 0d0a 2020 2020  TE_START',..    
-000223a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000223b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000223c0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-000223d0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
-000223e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000223f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022400: 2027 4441 5445 5f53 5441 5254 5f48 4953   'DATE_START_HIS
-00022410: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
-00022420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022430: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-00022440: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-00022450: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00022460: 6e2c 2073 7973 6461 7465 5f66 6f72 5f6d  n, sysdate_for_m
-00022470: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
-00022480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000224a0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-000224b0: 6461 7461 5b32 5d2c 2031 2c20 4e6f 6e65  data[2], 1, None
-000224c0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-000224d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000224e0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-000224f0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00022500: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00022510: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00022520: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-00022530: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00022540: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-00022550: 2020 2020 2020 2069 6620 6861 735f 7273         if has_rs
-00022560: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00022570: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-00022580: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-00022590: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-000225a0: 795f 6163 7475 616c 5f69 6d61 6765 5f33  y_actual_image_3
-000225b0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-000225c0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-000225d0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-000225e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000225f0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00022600: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00022610: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
-00022620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022640: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-00022650: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00022660: 6574 2b22 5f48 4953 5422 2c0d 0a20 2020  et+"_HIST",..   
-00022670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021ef0: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
+00021f00: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+00021f10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00021f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f30: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+00021f40: 5f54 5950 455f 4150 504c 4945 445f 4441  _TYPE_APPLIED_DA
+00021f50: 5445 2c20 312c 2073 656c 662e 6f77 6e65  TE, 1, self.owne
+00021f60: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00021f70: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00021f80: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+00021f90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00021fa0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00021fb0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00021fc0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00021fd0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00021fe0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00021ff0: 2023 4765 7420 4472 6976 656e 204b 6579   #Get Driven Key
+00022000: 206e 756d 5f63 6f6e 6e65 6374 696f 6e0d   num_connection.
+00022010: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
+00022020: 5f63 6f6e 6e65 6374 696f 6e73 5f77 6974  _connections_wit
+00022030: 685f 646b 203d 2073 656c 662e 6d65 7461  h_dk = self.meta
+00022040: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
+00022050: 6c69 7374 5f6e 756d 5f63 6f6e 6e65 6374  list_num_connect
+00022060: 696f 6e5f 7769 7468 5f64 7269 7665 6e5f  ion_with_driven_
+00022070: 6b65 795f 6672 6f6d 5f63 6f64 5f65 6e74  key_from_cod_ent
+00022080: 6974 795f 7461 7267 6574 2864 765f 656e  ity_target(dv_en
+00022090: 7469 7479 2e63 6f64 5f65 6e74 6974 7929  tity.cod_entity)
+000220a0: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
+000220b0: 6c5f 6861 7368 6573 5f66 726f 6d5f 646b  l_hashes_from_dk
+000220c0: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+000220d0: 2020 2066 6f72 206e 756d 5f63 6f6e 2069     for num_con i
+000220e0: 6e20 616c 6c5f 636f 6e6e 6563 7469 6f6e  n all_connection
+000220f0: 735f 7769 7468 5f64 6b3a 0d0a 2020 2020  s_with_dk:..    
+00022100: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00022110: 5f6e 616d 655f 6875 6220 3d20 2748 4153  _name_hub = 'HAS
+00022120: 485f 2720 2b20 7374 7228 6e75 6d5f 636f  H_' + str(num_co
+00022130: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
+00022140: 2020 2020 6476 5f70 726f 7065 7274 7920      dv_property 
+00022150: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00022160: 6163 7475 616c 2e67 6574 5f64 765f 7072  actual.get_dv_pr
+00022170: 6f70 6572 7469 6573 5f66 726f 6d5f 636f  operties_from_co
+00022180: 645f 656e 7469 7479 5f61 6e64 5f6e 756d  d_entity_and_num
+00022190: 5f63 6f6e 6e65 6374 696f 6e28 6476 5f65  _connection(dv_e
+000221a0: 6e74 6974 792e 636f 645f 656e 7469 7479  ntity.cod_entity
+000221b0: 2c20 6e75 6d5f 636f 6e29 0d0a 2020 2020  , num_con)..    
+000221c0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+000221d0: 765f 7072 6f70 6572 7479 2069 7320 6e6f  v_property is no
+000221e0: 7420 4e6f 6e65 3a20 6861 7368 5f6e 616d  t None: hash_nam
+000221f0: 655f 6875 6220 3d20 6476 5f70 726f 7065  e_hub = dv_prope
+00022200: 7274 792e 6861 7368 5f6e 616d 650d 0a20  rty.hash_name.. 
+00022210: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00022220: 6c6c 5f68 6173 6865 735f 6672 6f6d 5f64  ll_hashes_from_d
+00022230: 6b2e 6170 7065 6e64 2868 6173 685f 6e61  k.append(hash_na
+00022240: 6d65 5f68 7562 290d 0a20 2020 2020 2020  me_hub)..       
+00022250: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+00022260: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00022270: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+00022280: 742c 2068 6173 685f 6e61 6d65 5f68 7562  t, hash_name_hub
+00022290: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000222a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000222b0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+000222c0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+000222d0: 795f 6163 7475 616c 5f69 6d61 6765 5f33  y_actual_image_3
+000222e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000222f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022300: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+00022310: 616d 655f 6875 622c 0d0a 2020 2020 2020  ame_hub,..      
+00022320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022340: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00022350: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00022360: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+00022370: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+00022380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000223a0: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
+000223b0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+000223c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000223d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000223e0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+000223f0: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+00022400: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00022410: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00022420: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00022430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00022440: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00022450: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00022460: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00022470: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00022480: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00022490: 2020 2020 2020 2020 2323 2323 2323 2323          ########
+000224a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000224b0: 2323 2323 2323 2323 2323 204a 4f49 4e20  ########## JOIN 
+000224c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000224d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000224e0: 2323 2323 2323 2323 2323 2323 230d 0a0d  #############...
+000224f0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+00022500: 696e 616c 5f70 6f73 6974 696f 6e20 3d20  inal_position = 
+00022510: 310d 0a20 2020 2020 2020 2020 2020 206e  1..            n
+00022520: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00022530: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+00022540: 2b20 7361 7465 5f65 6e74 6974 795f 6163  + sate_entity_ac
+00022550: 7475 616c 5f69 6d61 6765 5f33 2c20 6861  tual_image_3, ha
+00022560: 7368 5f6e 616d 652c 0d0a 2020 2020 2020  sh_name,..      
+00022570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022580: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00022590: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+000225a0: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
+000225b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000225c0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+000225d0: 6173 685f 6e61 6d65 202b 225f 4849 5354  ash_name +"_HIST
+000225e0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000225f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022600: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
+00022610: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
+00022620: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
+00022630: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+00022640: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
+00022650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022660: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+00022670: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
 00022680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022690: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-000226a0: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-000226b0: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-000226c0: 7369 7469 6f6e 2c20 7265 636f 7264 5f73  sition, record_s
-000226d0: 6f75 7263 652e 636f 6c75 6d6e 5f6c 656e  ource.column_len
-000226e0: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-000226f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022700: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-00022710: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-00022720: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-00022730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022750: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-00022760: 5f52 4543 4f52 445f 534f 5552 4345 2c20  _RECORD_SOURCE, 
-00022770: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00022780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022790: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000227a0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000227b0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000227c0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000227d0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000227e0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-000227f0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00022800: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00022810: 6861 735f 746e 3a0d 0a20 2020 2020 2020  has_tn:..       
-00022820: 2020 2020 2020 2020 2074 656e 616e 745f           tenant_
-00022830: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
-00022840: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-00022850: 745f 7465 6e61 6e74 5f6f 6e5f 6476 5f66  t_tenant_on_dv_f
-00022860: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
-00022870: 6172 6765 745f 616e 645f 6e75 6d5f 6272  arget_and_num_br
-00022880: 616e 6368 2863 6f64 5f65 6e74 6974 795f  anch(cod_entity_
-00022890: 7461 7267 6574 2c20 3129 0d0a 2020 2020  target, 1)..    
-000228a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000228b0: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
-000228c0: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-000228d0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-000228e0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-000228f0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00022900: 655f 656e 7469 7479 5f61 6374 7561 6c5f  e_entity_actual_
-00022910: 696d 6167 655f 332c 2074 6e2e 636f 6c75  image_3, tn.colu
-00022920: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00022930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022950: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00022960: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00022970: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
-00022980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229a0: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-000229b0: 6e61 6d65 5f74 6172 6765 742b 225f 4849  name_target+"_HI
-000229c0: 5354 222c 0d0a 2020 2020 2020 2020 2020  ST",..          
-000229d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229f0: 2074 6e2e 636f 6c75 6d6e 5f74 7970 655f   tn.column_type_
-00022a00: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-00022a10: 706f 7369 7469 6f6e 2c20 746e 2e63 6f6c  position, tn.col
-00022a20: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+00022690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226a0: 2020 2031 2c20 4b45 595f 5459 5045 5f48     1, KEY_TYPE_H
+000226b0: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
+000226c0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+000226d0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+000226e0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+000226f0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00022700: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00022710: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00022720: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00022730: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00022740: 0d0a 2020 2020 2020 2020 2020 2020 7379  ..            sy
+00022750: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+00022760: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
+00022770: 7469 6f6e 2e67 6574 5f73 7973 6461 7465  tion.get_sysdate
+00022780: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
+00022790: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+000227a0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+000227b0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+000227c0: 7361 7465 5f65 6e74 6974 795f 6163 7475  sate_entity_actu
+000227d0: 616c 5f69 6d61 6765 5f33 2c20 2744 4154  al_image_3, 'DAT
+000227e0: 455f 5354 4152 5427 2c0d 0a20 2020 2020  E_START',..     
+000227f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022800: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00022810: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00022820: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+00022830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022850: 2744 4154 455f 5354 4152 545f 4849 5354  'DATE_START_HIST
+00022860: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00022870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022880: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+00022890: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+000228a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+000228b0: 2c20 7379 7364 6174 655f 666f 725f 6d65  , sysdate_for_me
+000228c0: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+000228d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000228e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000228f0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+00022900: 6174 615b 325d 2c20 312c 204e 6f6e 652c  ata[2], 1, None,
+00022910: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00022920: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00022930: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00022940: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00022950: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00022960: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00022970: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+00022980: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00022990: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+000229a0: 2020 2020 2020 6966 2068 6173 5f72 733a        if has_rs:
+000229b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000229c0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+000229d0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+000229e0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+000229f0: 5f61 6374 7561 6c5f 696d 6167 655f 332c  _actual_image_3,
+00022a00: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00022a10: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00022a20: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
 00022a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a50: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-00022a60: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+00022a40: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00022a50: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00022a60: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
 00022a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00022a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a90: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
-00022aa0: 5459 5045 5f54 454e 414e 542c 2031 2c20  TYPE_TENANT, 1, 
-00022ab0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+00022a90: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00022aa0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00022ab0: 742b 225f 4849 5354 222c 0d0a 2020 2020  t+"_HIST",..    
 00022ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ad0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00022ae0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00022af0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-00022b00: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00022b10: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
-00022b20: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00022b30: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00022b40: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
-00022b50: 2020 6966 2068 6173 5f61 643a 0d0a 2020    if has_ad:..  
-00022b60: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-00022b70: 706c 6965 645f 6461 7465 203d 2073 656c  plied_date = sel
-00022b80: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00022b90: 6c2e 6765 745f 6170 706c 6965 645f 6461  l.get_applied_da
-00022ba0: 7465 5f6f 6e5f 6476 5f66 726f 6d5f 636f  te_on_dv_from_co
-00022bb0: 645f 656e 7469 7479 5f74 6172 6765 7428  d_entity_target(
-00022bc0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-00022bd0: 742c 2031 290d 0a20 2020 2020 2020 2020  t, 1)..         
-00022be0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00022bf0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-00022c00: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00022c10: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-00022c20: 6765 5f33 2c20 6170 706c 6965 645f 6461  ge_3, applied_da
-00022c30: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
-00022c40: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-00022c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00022c70: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-00022c80: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
-00022c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022cb0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00022cc0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-00022cd0: 7267 6574 2b22 5f48 4953 5422 2c0d 0a20  rget+"_HIST",.. 
-00022ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d00: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00022d10: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
-00022d20: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-00022d30: 6f73 6974 696f 6e2c 0d0a 2020 2020 2020  osition,..      
-00022d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d60: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00022d70: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+00022ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ae0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00022af0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00022b00: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00022b10: 6974 696f 6e2c 2072 6563 6f72 645f 736f  ition, record_so
+00022b20: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+00022b30: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+00022b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b50: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00022b60: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+00022b70: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+00022b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ba0: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+00022bb0: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
+00022bc0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00022bd0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00022be0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00022bf0: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00022c00: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00022c10: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00022c20: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00022c30: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00022c40: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00022c50: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00022c60: 6173 5f74 6e3a 0d0a 2020 2020 2020 2020  as_tn:..        
+00022c70: 2020 2020 2020 2020 7465 6e61 6e74 5f73          tenant_s
+00022c80: 6f75 7263 6520 3d20 7365 6c66 2e6d 6574  ource = self.met
+00022c90: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+00022ca0: 5f74 656e 616e 745f 6f6e 5f64 765f 6672  _tenant_on_dv_fr
+00022cb0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
+00022cc0: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
+00022cd0: 6e63 6828 636f 645f 656e 7469 7479 5f74  nch(cod_entity_t
+00022ce0: 6172 6765 742c 2031 290d 0a20 2020 2020  arget, 1)..     
+00022cf0: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00022d00: 6e20 696e 2074 656e 616e 745f 736f 7572  n in tenant_sour
+00022d10: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+00022d20: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+00022d30: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00022d40: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+00022d50: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+00022d60: 6d61 6765 5f33 2c20 746e 2e63 6f6c 756d  mage_3, tn.colum
+00022d70: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
 00022d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00022d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022da0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00022db0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-00022dc0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00022da0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00022db0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00022dc0: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
 00022dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022de0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-00022df0: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
-00022e00: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
-00022e10: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00022e20: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00022e30: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-00022e40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00022e50: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00022e60: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00022e70: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-00022e80: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00022e90: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
-00022ea0: 2020 2066 6f72 2068 6173 685f 646b 2069     for hash_dk i
-00022eb0: 6e20 616c 6c5f 6861 7368 6573 5f66 726f  n all_hashes_fro
-00022ec0: 6d5f 646b 3a0d 0a20 2020 2020 2020 2020  m_dk:..         
-00022ed0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00022ee0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-00022ef0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00022f00: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-00022f10: 6765 5f33 2c20 6861 7368 5f64 6b2c 0d0a  ge_3, hash_dk,..
-00022f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f40: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-00022f50: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
-00022f60: 6f69 6e2c 0d0a 2020 2020 2020 2020 2020  oin,..          
-00022f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f80: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00022f90: 685f 646b 2b22 5f48 4953 5422 2c0d 0a20  h_dk+"_HIST",.. 
-00022fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022fc0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-00022fd0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00022fe0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-00022ff0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00023000: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
-00023010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023020: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00023030: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-00023040: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00023050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023060: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
-00023070: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00023080: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00023090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000230a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000230b0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000230c0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000230d0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000230e0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000230f0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00023100: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00023110: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00023120: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00023130: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00023140: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
-00023150: 6e5f 736f 7572 6365 732c 2068 6173 685f  n_sources, hash_
-00023160: 6e61 6d65 2c20 7072 6566 6978 5f65 7420  name, prefix_et 
-00023170: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
-00023180: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
+00022de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022df0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+00022e00: 616d 655f 7461 7267 6574 2b22 5f48 4953  ame_target+"_HIS
+00022e10: 5422 2c0d 0a20 2020 2020 2020 2020 2020  T",..           
+00022e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e40: 746e 2e63 6f6c 756d 6e5f 7479 7065 5f74  tn.column_type_t
+00022e50: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
+00022e60: 6f73 6974 696f 6e2c 2074 6e2e 636f 6c75  osition, tn.colu
+00022e70: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+00022e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ea0: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+00022eb0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+00022ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ee0: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
+00022ef0: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
+00022f00: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00022f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f20: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00022f30: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00022f40: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00022f50: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00022f60: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+00022f70: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+00022f80: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00022f90: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
+00022fa0: 2069 6620 6861 735f 6164 3a0d 0a20 2020   if has_ad:..   
+00022fb0: 2020 2020 2020 2020 2020 2020 2061 7070               app
+00022fc0: 6c69 6564 5f64 6174 6520 3d20 7365 6c66  lied_date = self
+00022fd0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00022fe0: 2e67 6574 5f61 7070 6c69 6564 5f64 6174  .get_applied_dat
+00022ff0: 655f 6f6e 5f64 765f 6672 6f6d 5f63 6f64  e_on_dv_from_cod
+00023000: 5f65 6e74 6974 795f 7461 7267 6574 2863  _entity_target(c
+00023010: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+00023020: 2c20 3129 0d0a 2020 2020 2020 2020 2020  , 1)..          
+00023030: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00023040: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+00023050: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00023060: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+00023070: 655f 332c 2061 7070 6c69 6564 5f64 6174  e_3, applied_dat
+00023080: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+00023090: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+000230a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000230c0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+000230d0: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+000230e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023100: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+00023110: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00023120: 6765 742b 225f 4849 5354 222c 0d0a 2020  get+"_HIST",..  
+00023130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023150: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00023160: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
+00023170: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+00023180: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
 00023190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000231a0: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
-000231b0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-000231c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000231d0: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
-000231e0: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-000231f0: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
-00023200: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-00023210: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
+000231a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231b0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+000231c0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+000231d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000231f0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+00023200: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+00023210: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
 00023220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023230: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-00023240: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
-00023250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023270: 2020 2031 2c20 4b45 595f 5459 5045 5f48     1, KEY_TYPE_H
-00023280: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
-00023290: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-000232a0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-000232b0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-000232c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000232d0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000232e0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-000232f0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00023300: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00023310: 0d0a 2020 2020 2020 2020 2020 2020 7379  ..            sy
-00023320: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00023330: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-00023340: 7469 6f6e 2e67 6574 5f73 7973 6461 7465  tion.get_sysdate
-00023350: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
-00023360: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00023370: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00023380: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00023390: 7361 7465 5f65 6e74 6974 795f 756e 696f  sate_entity_unio
-000233a0: 6e5f 736f 7572 6365 732c 2027 4441 5445  n_sources, 'DATE
-000233b0: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
+00023230: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+00023240: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
+00023250: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
+00023260: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00023270: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+00023280: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+00023290: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000232a0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+000232b0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+000232c0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+000232d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+000232e0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+000232f0: 2020 666f 7220 6861 7368 5f64 6b20 696e    for hash_dk in
+00023300: 2061 6c6c 5f68 6173 6865 735f 6672 6f6d   all_hashes_from
+00023310: 5f64 6b3a 0d0a 2020 2020 2020 2020 2020  _dk:..          
+00023320: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00023330: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+00023340: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+00023350: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+00023360: 655f 332c 2068 6173 685f 646b 2c0d 0a20  e_3, hash_dk,.. 
+00023370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023390: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+000233a0: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
+000233b0: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
 000233c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000233d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000233e0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-000233f0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+000233d0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+000233e0: 5f64 6b2b 225f 4849 5354 222c 0d0a 2020  _dk+"_HIST",..  
+000233f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00023400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023420: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
-00023430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00023440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023450: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-00023460: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
-00023470: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-00023480: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-00023490: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00023410: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00023420: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00023430: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+00023440: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+00023450: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00023460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023470: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00023480: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00023490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000234a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234b0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-000234c0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-000234d0: 615b 325d 2c20 312c 204e 6f6e 652c 2031  a[2], 1, None, 1
-000234e0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-000234f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00023500: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00023510: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-00023520: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-00023530: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-00023540: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
-00023550: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-00023560: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-00023570: 2020 2020 6966 2068 6173 5f72 733a 0d0a      if has_rs:..
-00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023590: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-000235a0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-000235b0: 202b 2073 6174 655f 656e 7469 7479 5f75   + sate_entity_u
-000235c0: 6e69 6f6e 5f73 6f75 7263 6573 2c20 7265  nion_sources, re
-000235d0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-000235e0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-000235f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023610: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-00023620: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00023630: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
-00023640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023650: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00023660: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00023670: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00023680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236a0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-000236b0: 6f75 7263 652e 636f 6c75 6d6e 5f74 7970  ource.column_typ
-000236c0: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-000236d0: 6c5f 706f 7369 7469 6f6e 2c0d 0a20 2020  l_position,..   
-000236e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000236f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023700: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00023710: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00023720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00023730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023740: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
-00023750: 736f 7572 6365 2e63 6f6c 756d 6e5f 7072  source.column_pr
-00023760: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-00023770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023790: 2031 2c20 4b45 595f 5459 5045 5f52 4543   1, KEY_TYPE_REC
-000237a0: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
-000237b0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-000237c0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-000237d0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-000237e0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-000237f0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00023800: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00023810: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00023820: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00023830: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00023840: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
-00023850: 746e 3a0d 0a20 2020 2020 2020 2020 2020  tn:..           
-00023860: 2020 2020 2069 6620 6c65 6e28 7465 6e61       if len(tena
-00023870: 6e74 5f73 6f75 7263 6529 2021 3d20 303a  nt_source) != 0:
-00023880: 2068 6173 5f74 6e20 3d20 5472 7565 0d0a   has_tn = True..
+000234b0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
+000234c0: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+000234d0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000234e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000234f0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00023500: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00023510: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00023520: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00023530: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00023540: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00023550: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00023560: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00023570: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00023580: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+00023590: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
+000235a0: 5f73 6f75 7263 6573 2c20 6861 7368 5f6e  _sources, hash_n
+000235b0: 616d 652c 2070 7265 6669 785f 6574 202b  ame, prefix_et +
+000235c0: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
+000235d0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000235e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235f0: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
+00023600: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00023610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023620: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
+00023630: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+00023640: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
+00023650: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00023660: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+00023670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023680: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+00023690: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+000236a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000236c0: 2020 312c 204b 4559 5f54 5950 455f 4841    1, KEY_TYPE_HA
+000236d0: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
+000236e0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+000236f0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00023700: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+00023710: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00023720: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00023730: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00023740: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00023750: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00023760: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
+00023770: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00023780: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+00023790: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
+000237a0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+000237b0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000237c0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+000237d0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+000237e0: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
+000237f0: 5f73 6f75 7263 6573 2c20 2744 4154 455f  _sources, 'DATE_
+00023800: 4352 4541 5445 4427 2c0d 0a20 2020 2020  CREATED',..     
+00023810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023820: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00023830: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00023840: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+00023850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023870: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
+00023880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00023890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238a0: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
-000238b0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-000238c0: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
-000238d0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-000238e0: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-000238f0: 5f6e 756d 5f62 7261 6e63 6828 636f 645f  _num_branch(cod_
-00023900: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
-00023910: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00023920: 2020 2066 6f72 2074 6e20 696e 2074 656e     for tn in ten
-00023930: 616e 745f 736f 7572 6365 3a0d 0a20 2020  ant_source:..   
-00023940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023950: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00023960: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00023970: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00023980: 756e 696f 6e5f 736f 7572 6365 732c 2074  union_sources, t
-00023990: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-000239a0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-000239b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000239d0: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-000239e0: 7465 5f65 6e74 6974 795f 6a6f 696e 2c0d  te_entity_join,.
-000239f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a10: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-00023a20: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-00023a30: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+000238a0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+000238b0: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
+000238c0: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
+000238d0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+000238e0: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+000238f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023900: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+00023910: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00023920: 5b32 5d2c 2031 2c20 4e6f 6e65 2c20 312c  [2], 1, None, 1,
+00023930: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00023940: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00023950: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+00023960: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+00023970: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+00023980: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+00023990: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+000239a0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+000239b0: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
+000239c0: 2020 2069 6620 6861 735f 7273 3a0d 0a20     if has_rs:.. 
+000239d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000239e0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+000239f0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+00023a00: 2b20 7361 7465 5f65 6e74 6974 795f 756e  + sate_entity_un
+00023a10: 696f 6e5f 736f 7572 6365 732c 2072 6563  ion_sources, rec
+00023a20: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+00023a30: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
 00023a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023a50: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00023a60: 6e2e 636f 6c75 6d6e 5f74 7970 655f 7461  n.column_type_ta
-00023a70: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00023a80: 7369 7469 6f6e 2c20 746e 2e63 6f6c 756d  sition, tn.colum
-00023a90: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
-00023aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ac0: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-00023ad0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+00023a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a60: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00023a70: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+00023a80: 6f69 6e2c 0d0a 2020 2020 2020 2020 2020  oin,..          
+00023a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023aa0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00023ab0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+00023ac0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+00023ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00023ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023b00: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-00023b10: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
-00023b20: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00023b30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00023b40: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00023b50: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-00023b60: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00023b70: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00023b80: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-00023b90: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00023ba0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00023bb0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00023bc0: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
-00023bd0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-00023be0: 6965 645f 6461 7465 203d 2073 656c 662e  ied_date = self.
-00023bf0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00023c00: 6765 745f 6170 706c 6965 645f 6461 7465  get_applied_date
-00023c10: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
-00023c20: 656e 7469 7479 5f74 6172 6765 7428 636f  entity_target(co
-00023c30: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
-00023c40: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
-00023c50: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-00023c60: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-00023c70: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00023c80: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-00023c90: 732c 2061 7070 6c69 6564 5f64 6174 652e  s, applied_date.
-00023ca0: 636f 6c75 6d6e 5f6e 616d 655f 736f 7572  column_name_sour
-00023cb0: 6365 2c0d 0a20 2020 2020 2020 2020 2020  ce,..           
-00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cd0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00023ce0: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
-00023cf0: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
-00023d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d20: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-00023d30: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-00023d40: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00023d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d60: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00023d70: 6564 5f64 6174 652e 636f 6c75 6d6e 5f74  ed_date.column_t
-00023d80: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-00023d90: 6e61 6c5f 706f 7369 7469 6f6e 2c0d 0a20  nal_position,.. 
-00023da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023dc0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00023dd0: 7465 2e63 6f6c 756d 6e5f 6c65 6e67 7468  te.column_length
-00023de0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00023df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e00: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-00023e10: 645f 6461 7465 2e63 6f6c 756d 6e5f 7072  d_date.column_pr
-00023e20: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-00023e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023af0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00023b00: 7572 6365 2e63 6f6c 756d 6e5f 7479 7065  urce.column_type
+00023b10: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+00023b20: 5f70 6f73 6974 696f 6e2c 0d0a 2020 2020  _position,..    
+00023b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b50: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00023b60: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00023b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b90: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+00023ba0: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
+00023bb0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00023bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023be0: 312c 204b 4559 5f54 5950 455f 5245 434f  1, KEY_TYPE_RECO
+00023bf0: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
+00023c00: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00023c10: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00023c20: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00023c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023c40: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00023c50: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00023c60: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00023c70: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00023c80: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00023c90: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
+00023ca0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00023cb0: 2020 2020 6966 206c 656e 2874 656e 616e      if len(tenan
+00023cc0: 745f 736f 7572 6365 2920 213d 2030 3a20  t_source) != 0: 
+00023cd0: 6861 735f 746e 203d 2054 7275 650d 0a20  has_tn = True.. 
+00023ce0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00023cf0: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
+00023d00: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00023d10: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
+00023d20: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+00023d30: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+00023d40: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
+00023d50: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
+00023d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023d70: 2020 666f 7220 746e 2069 6e20 7465 6e61    for tn in tena
+00023d80: 6e74 5f73 6f75 7263 653a 0d0a 2020 2020  nt_source:..    
+00023d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023da0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00023db0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00023dc0: 202b 2073 6174 655f 656e 7469 7479 5f75   + sate_entity_u
+00023dd0: 6e69 6f6e 5f73 6f75 7263 6573 2c20 746e  nion_sources, tn
+00023de0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00023df0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+00023e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e20: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00023e30: 655f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  e_entity_join,..
 00023e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e50: 2031 2c20 4b45 595f 5459 5045 5f41 5050   1, KEY_TYPE_APP
-00023e60: 4c49 4544 5f44 4154 452c 2031 2c20 7365  LIED_DATE, 1, se
-00023e70: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00023e80: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00023e90: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00023ea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00023eb0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00023ec0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00023ed0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00023ee0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00023ef0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00023f00: 2020 2020 2020 2020 666f 7220 6861 7368          for hash
-00023f10: 5f64 6b20 696e 2061 6c6c 5f68 6173 6865  _dk in all_hashe
-00023f20: 735f 6672 6f6d 5f64 6b3a 0d0a 2020 2020  s_from_dk:..    
-00023f30: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00023f40: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00023f50: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00023f60: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
-00023f70: 5f73 6f75 7263 6573 2c20 6861 7368 5f64  _sources, hash_d
-00023f80: 6b2c 0d0a 2020 2020 2020 2020 2020 2020  k,..            
-00023f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023fa0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00023fb0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-00023fc0: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
-00023fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023ff0: 2068 6173 685f 646b 2c0d 0a20 2020 2020   hash_dk,..     
-00024000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024020: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-00024030: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00024040: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-00024050: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-00024060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024080: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
-00024090: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-000240a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240c0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-000240d0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-000240e0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-000240f0: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00024100: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00024110: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00024120: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00024130: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00024140: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00024150: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00024160: 6d61 7070 696e 675d 290d 0a0d 0a0d 0a20  mapping])...... 
-00024170: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00024180: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
-00024190: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-000241a0: 6174 655f 656e 7469 7479 5f75 6e69 6f6e  ate_entity_union
-000241b0: 5f73 6f75 7263 6573 2c20 6861 7368 5f64  _sources, hash_d
-000241c0: 6b2c 0d0a 2020 2020 2020 2020 2020 2020  k,..            
-000241d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000241e0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-000241f0: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00024200: 6163 7475 616c 5f69 6d61 6765 5f33 2c0d  actual_image_3,.
-00024210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024230: 2020 2020 2068 6173 685f 646b 2c20 224d       hash_dk, "M
-00024240: 4153 5445 5220 4a4f 494e 222c 2073 656c  ASTER JOIN", sel
-00024250: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00024260: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00024270: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00024280: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00024290: 5f72 656c 6174 696f 6e73 6869 7028 5b6e  _relationship([n
-000242a0: 6577 5f72 656c 6174 696f 6e73 6869 705d  ew_relationship]
-000242b0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-000242c0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-000242d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000242e0: 2323 2323 2323 2053 4154 4520 2323 2323  ###### SATE ####
-000242f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00024310: 230d 0a0d 0a20 2020 2020 2020 2020 2020  #....           
-00024320: 2023 2042 7261 6e63 6820 3120 2d20 6578   # Branch 1 - ex
-00024330: 7369 7473 206f 6e6c 7920 6f6e 2073 6f75  sits only on sou
-00024340: 7263 650d 0a20 2020 2020 2020 2020 2020  rce..           
-00024350: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00024360: 6e20 3d20 310d 0a20 2020 2020 2020 2020  n = 1..         
-00024370: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-00024380: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-00024390: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-000243a0: 795f 6a6f 696e 2c20 6861 7368 5f6e 616d  y_join, hash_nam
-000243b0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-000243c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243d0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-000243e0: 202b 2073 6174 655f 656e 7469 7479 2c0d   + sate_entity,.
-000243f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024410: 2020 2020 6861 7368 5f6e 616d 652c 0d0a      hash_name,..
+00023e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e60: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+00023e70: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00023e80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00023e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ea0: 2020 2020 2020 2020 2020 2020 2020 746e                tn
+00023eb0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00023ec0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00023ed0: 6974 696f 6e2c 2074 6e2e 636f 6c75 6d6e  ition, tn.column
+00023ee0: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+00023ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f10: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
+00023f20: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+00023f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f50: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+00023f60: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
+00023f70: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00023f80: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00023f90: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00023fa0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00023fb0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00023fc0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00023fd0: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+00023fe0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00023ff0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+00024000: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00024010: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
+00024020: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00024030: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
+00024040: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+00024050: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
+00024060: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
+00024070: 6e74 6974 795f 7461 7267 6574 2863 6f64  ntity_target(cod
+00024080: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
+00024090: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+000240a0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+000240b0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+000240c0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+000240d0: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+000240e0: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
+000240f0: 6f6c 756d 6e5f 6e61 6d65 5f73 6f75 7263  olumn_name_sourc
+00024100: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00024110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024120: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00024130: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
+00024140: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
+00024150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024170: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+00024180: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00024190: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000241a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000241b0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+000241c0: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
+000241d0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+000241e0: 616c 5f70 6f73 6974 696f 6e2c 0d0a 2020  al_position,..  
+000241f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024210: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00024220: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
+00024230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024250: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+00024260: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
+00024270: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00024280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000242a0: 312c 204b 4559 5f54 5950 455f 4150 504c  1, KEY_TYPE_APPL
+000242b0: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
+000242c0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000242d0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+000242e0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+000242f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024300: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00024310: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00024320: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00024330: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+00024340: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00024350: 2020 2020 2020 2066 6f72 2068 6173 685f         for hash_
+00024360: 646b 2069 6e20 616c 6c5f 6861 7368 6573  dk in all_hashes
+00024370: 5f66 726f 6d5f 646b 3a0d 0a20 2020 2020  _from_dk:..     
+00024380: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00024390: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+000243a0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+000243b0: 7465 5f65 6e74 6974 795f 756e 696f 6e5f  te_entity_union_
+000243c0: 736f 7572 6365 732c 2068 6173 685f 646b  sources, hash_dk
+000243d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000243e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000243f0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00024400: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00024410: 795f 6a6f 696e 2c0d 0a20 2020 2020 2020  y_join,..       
 00024420: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00024430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024440: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-00024450: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-00024460: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
-00024470: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-00024480: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244a0: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
-000244b0: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
+00024440: 6861 7368 5f64 6b2c 0d0a 2020 2020 2020  hash_dk,..      
+00024450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024470: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00024480: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00024490: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+000244a0: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000244c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244d0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-000244e0: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
-000244f0: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
-00024500: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00024510: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00024520: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-00024530: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00024540: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00024550: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00024560: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00024570: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-00024580: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-00024590: 655f 666f 725f 6d65 7461 6461 7461 203d  e_for_metadata =
-000245a0: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
-000245b0: 2e67 6574 5f73 7973 6461 7465 5f66 6f72  .get_sysdate_for
-000245c0: 5f6d 6574 6164 6174 6128 290d 0a20 2020  _metadata()..   
-000245d0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-000245e0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-000245f0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00024600: 5f65 6e74 6974 795f 6a6f 696e 2c20 2744  _entity_join, 'D
-00024610: 4154 455f 4352 4541 5445 4427 2c0d 0a20  ATE_CREATED',.. 
+000244d0: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
+000244e0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+000244f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024510: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+00024520: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+00024530: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00024540: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00024550: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00024560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024570: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00024580: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00024590: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+000245a0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+000245b0: 6170 7069 6e67 5d29 0d0a 0d0a 0d0a 2020  apping])......  
+000245c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000245d0: 775f 7265 6c61 7469 6f6e 7368 6970 203d  w_relationship =
+000245e0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+000245f0: 7465 5f65 6e74 6974 795f 756e 696f 6e5f  te_entity_union_
+00024600: 736f 7572 6365 732c 2068 6173 685f 646b  sources, hash_dk
+00024610: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00024620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024640: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-00024650: 7465 5f65 6e74 6974 792c 0d0a 2020 2020  te_entity,..    
+00024630: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00024640: 202b 2073 6174 655f 656e 7469 7479 5f61   + sate_entity_a
+00024650: 6374 7561 6c5f 696d 6167 655f 332c 0d0a  ctual_image_3,..
 00024660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024670: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00024680: 4441 5445 5f53 5441 5254 272c 0d0a 2020  DATE_START',..  
-00024690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000246a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000246b0: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-000246c0: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-000246d0: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
-000246e0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-000246f0: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
-00024700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024710: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
-00024720: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-00024730: 2c20 312c 204e 6f6e 652c 2031 2c20 7365  , 1, None, 1, se
-00024740: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00024750: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00024760: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00024770: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00024780: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00024790: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-000247a0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-000247b0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-000247c0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000247d0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-000247e0: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-000247f0: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
-00024800: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
-00024810: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00024820: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00024830: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00024840: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
-00024850: 696e 2c20 7365 6c66 2e63 6f6e 6e65 6374  in, self.connect
-00024860: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
-00024870: 7661 6c75 655f 696e 6669 6e69 7465 2829  value_infinite()
-00024880: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00024890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000248a0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-000248b0: 2b20 7361 7465 5f65 6e74 6974 792c 0d0a  + sate_entity,..
-000248c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000248d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000248e0: 2020 2027 4441 5445 5f45 4e44 272c 0d0a     'DATE_END',..
-000248f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024910: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-00024920: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00024930: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7379  nal_position, sy
-00024940: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00024950: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
-00024960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024970: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
-00024980: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
-00024990: 325d 2c20 312c 204e 6f6e 652c 2031 2c20  2], 1, None, 1, 
-000249a0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-000249b0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-000249c0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-000249d0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-000249e0: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-000249f0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00024a00: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-00024a10: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00024a20: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
-00024a30: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-00024a40: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
-00024a50: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-00024a60: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00024a70: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-00024a80: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00024a90: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00024aa0: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00024ab0: 6a6f 696e 2c20 2744 4154 455f 4352 4541  join, 'DATE_CREA
-00024ac0: 5445 4427 2c0d 0a20 2020 2020 2020 2020  TED',..         
-00024ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ae0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00024af0: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
-00024b00: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-00024b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b20: 2020 2020 2020 2027 4441 5445 5f43 5245         'DATE_CRE
-00024b30: 4154 4544 272c 0d0a 2020 2020 2020 2020  ATED',..        
-00024b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024b50: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
-00024b60: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
-00024b70: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-00024b80: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
-00024b90: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
-00024ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024bc0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-00024bd0: 6574 6164 6174 615b 325d 2c20 312c 204e  etadata[2], 1, N
-00024be0: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
-00024bf0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00024c00: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00024c10: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00024c20: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-00024c30: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00024c40: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
-00024c50: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00024c60: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
-00024c70: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-00024c80: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
-00024c90: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00024ca0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-00024cb0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-00024cc0: 7469 7479 5f6a 6f69 6e2c 2072 6563 6f72  tity_join, recor
-00024cd0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00024ce0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00024cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d10: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00024d20: 2073 6174 655f 656e 7469 7479 2c0d 0a20   sate_entity,.. 
-00024d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024680: 2020 2020 6861 7368 5f64 6b2c 2022 4d41      hash_dk, "MA
+00024690: 5354 4552 204a 4f49 4e22 2c20 7365 6c66  STER JOIN", self
+000246a0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+000246b0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+000246c0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+000246d0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+000246e0: 7265 6c61 7469 6f6e 7368 6970 285b 6e65  relationship([ne
+000246f0: 775f 7265 6c61 7469 6f6e 7368 6970 5d29  w_relationship])
+00024700: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00024710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024730: 2323 2323 2320 5341 5445 2023 2323 2323  ##### SATE #####
+00024740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00024760: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00024770: 2320 4272 616e 6368 2031 202d 2065 7873  # Branch 1 - exs
+00024780: 6974 7320 6f6e 6c79 206f 6e20 736f 7572  its only on sour
+00024790: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
+000247a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+000247b0: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
+000247c0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+000247d0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+000247e0: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+000247f0: 5f6a 6f69 6e2c 2068 6173 685f 6e61 6d65  _join, hash_name
+00024800: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00024810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024820: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+00024830: 2b20 7361 7465 5f65 6e74 6974 792c 0d0a  + sate_entity,..
+00024840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024860: 2020 2068 6173 685f 6e61 6d65 2c0d 0a20     hash_name,.. 
+00024870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024890: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+000248a0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+000248b0: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+000248c0: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
+000248d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000248e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000248f0: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
+00024900: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
+00024910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024920: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00024930: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
+00024940: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
+00024950: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00024960: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00024970: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+00024980: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00024990: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+000249a0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+000249b0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+000249c0: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
+000249d0: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+000249e0: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
+000249f0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+00024a00: 6765 745f 7379 7364 6174 655f 666f 725f  get_sysdate_for_
+00024a10: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
+00024a20: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00024a30: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00024a40: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00024a50: 656e 7469 7479 5f6a 6f69 6e2c 2027 4441  entity_join, 'DA
+00024a60: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
+00024a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a90: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00024aa0: 655f 656e 7469 7479 2c0d 0a20 2020 2020  e_entity,..     
+00024ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024ac0: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00024ad0: 4154 455f 5354 4152 5427 2c0d 0a20 2020  ATE_START',..   
+00024ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b00: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00024b10: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+00024b20: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
+00024b30: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+00024b40: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+00024b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024b60: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+00024b70: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00024b80: 2031 2c20 4e6f 6e65 2c20 312c 2073 656c   1, None, 1, sel
+00024b90: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00024ba0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00024bb0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00024bc0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00024bd0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00024be0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
+00024bf0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00024c00: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+00024c10: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00024c20: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+00024c30: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+00024c40: 6374 696f 6e2e 6765 745f 7379 7364 6174  ction.get_sysdat
+00024c50: 655f 666f 725f 6d65 7461 6461 7461 2829  e_for_metadata()
+00024c60: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00024c70: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00024c80: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+00024c90: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
+00024ca0: 6e2c 2073 656c 662e 636f 6e6e 6563 7469  n, self.connecti
+00024cb0: 6f6e 2e67 6574 5f73 7973 6461 7465 5f76  on.get_sysdate_v
+00024cc0: 616c 7565 5f69 6e66 696e 6974 6528 292c  alue_infinite(),
+00024cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024cf0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+00024d00: 2073 6174 655f 656e 7469 7479 2c0d 0a20   sate_entity,.. 
+00024d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d30: 2020 2744 4154 455f 454e 4427 2c0d 0a20    'DATE_END',.. 
 00024d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d50: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00024d60: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-00024d70: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00024d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024da0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00024db0: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-00024dc0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00024dd0: 6f6e 2c20 7265 636f 7264 5f73 6f75 7263  on, record_sourc
-00024de0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00024df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e10: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
-00024e20: 736f 7572 6365 2e63 6f6c 756d 6e5f 7072  source.column_pr
-00024e30: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-00024e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e60: 2031 2c20 4b45 595f 5459 5045 5f52 4543   1, KEY_TYPE_REC
-00024e70: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
-00024e80: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00024e90: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00024ea0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00024eb0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00024ec0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00024ed0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00024ee0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00024ef0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00024f00: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00024f10: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
-00024f20: 746e 3a0d 0a20 2020 2020 2020 2020 2020  tn:..           
-00024f30: 2020 2020 2074 656e 616e 745f 736f 7572       tenant_sour
-00024f40: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
-00024f50: 7461 5f61 6374 7561 6c2e 6765 745f 7465  ta_actual.get_te
-00024f60: 6e61 6e74 5f6f 6e5f 6476 5f66 726f 6d5f  nant_on_dv_from_
-00024f70: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-00024f80: 745f 616e 645f 6e75 6d5f 6272 616e 6368  t_and_num_branch
-00024f90: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00024fa0: 2020 2020 2020 2063 6f64 5f65 6e74 6974         cod_entit
-00024fb0: 795f 7461 7267 6574 2c20 3129 0d0a 2020  y_target, 1)..  
-00024fc0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00024fd0: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
-00024fe0: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
-00024ff0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00025000: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00025010: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00025020: 6174 655f 656e 7469 7479 5f6a 6f69 6e2c  ate_entity_join,
-00025030: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-00025040: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00025050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025070: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-00025080: 7361 7465 5f65 6e74 6974 792c 0d0a 2020  sate_entity,..  
-00025090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000250a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000250b0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-000250c0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-000250d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000250e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000250f0: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-00025100: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00025110: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00025120: 696f 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c  ion, tn.column_l
-00025130: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+00024d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d60: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00024d70: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00024d80: 616c 5f70 6f73 6974 696f 6e2c 2073 7973  al_position, sys
+00024d90: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00024da0: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
+00024db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024dc0: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
+00024dd0: 655f 666f 725f 6d65 7461 6461 7461 5b32  e_for_metadata[2
+00024de0: 5d2c 2031 2c20 4e6f 6e65 2c20 312c 2073  ], 1, None, 1, s
+00024df0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00024e00: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00024e10: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00024e20: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00024e30: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00024e40: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00024e50: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+00024e60: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00024e70: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
+00024e80: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00024e90: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
+00024ea0: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+00024eb0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00024ec0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00024ed0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00024ee0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00024ef0: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+00024f00: 6f69 6e2c 2027 4441 5445 5f43 5245 4154  oin, 'DATE_CREAT
+00024f10: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
+00024f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024f30: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00024f40: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
+00024f50: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00024f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024f70: 2020 2020 2020 2744 4154 455f 4352 4541        'DATE_CREA
+00024f80: 5445 4427 2c0d 0a20 2020 2020 2020 2020  TED',..         
+00024f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024fa0: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
+00024fb0: 655f 666f 725f 6d65 7461 6461 7461 5b30  e_for_metadata[0
+00024fc0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+00024fd0: 696f 6e2c 2073 7973 6461 7465 5f66 6f72  ion, sysdate_for
+00024fe0: 5f6d 6574 6164 6174 615b 315d 2c0d 0a20  _metadata[1],.. 
+00024ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025010: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00025020: 7461 6461 7461 5b32 5d2c 2031 2c20 4e6f  tadata[2], 1, No
+00025030: 6e65 2c20 312c 2073 656c 662e 6f77 6e65  ne, 1, self.owne
+00025040: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00025050: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00025060: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00025070: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00025080: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00025090: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+000250a0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+000250b0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+000250c0: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
+000250d0: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
+000250e0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+000250f0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+00025100: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00025110: 6974 795f 6a6f 696e 2c20 7265 636f 7264  ity_join, record
+00025120: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
+00025130: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
 00025140: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00025150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025160: 2020 2074 6e2e 636f 6c75 6d6e 5f70 7265     tn.column_pre
-00025170: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00025160: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00025170: 7361 7465 5f65 6e74 6974 792c 0d0a 2020  sate_entity,..  
 00025180: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251a0: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-000251b0: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
-000251c0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-000251d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000251e0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000251f0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00025200: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00025210: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00025220: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00025230: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00025240: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00025250: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00025260: 6861 735f 6164 3a0d 0a20 2020 2020 2020  has_ad:..       
-00025270: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00025280: 5f64 6174 6520 3d20 7365 6c66 2e6d 6574  _date = self.met
-00025290: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
-000252a0: 5f61 7070 6c69 6564 5f64 6174 655f 6f6e  _applied_date_on
-000252b0: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
-000252c0: 6974 795f 7461 7267 6574 2863 6f64 5f65  ity_target(cod_e
-000252d0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
-000252e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000252f0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00025300: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00025310: 6574 202b 2073 6174 655f 656e 7469 7479  et + sate_entity
-00025320: 5f6a 6f69 6e2c 2061 7070 6c69 6564 5f64  _join, applied_d
-00025330: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-00025340: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00025350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025370: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00025380: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00025390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253b0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-000253c0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-000253d0: 202c 0d0a 2020 2020 2020 2020 2020 2020   ,..            
-000253e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253f0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00025400: 6564 5f64 6174 652e 636f 6c75 6d6e 5f74  ed_date.column_t
-00025410: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-00025420: 6e61 6c5f 706f 7369 7469 6f6e 2c0d 0a20  nal_position,.. 
-00025430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025450: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00025460: 7465 2e63 6f6c 756d 6e5f 6c65 6e67 7468  te.column_length
-00025470: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00025480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025490: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-000254a0: 645f 6461 7465 2e63 6f6c 756d 6e5f 7072  d_date.column_pr
-000254b0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-000254c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000254d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000254e0: 2031 2c20 4b45 595f 5459 5045 5f41 5050   1, KEY_TYPE_APP
-000254f0: 4c49 4544 5f44 4154 452c 2031 2c20 7365  LIED_DATE, 1, se
-00025500: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00025510: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00025520: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00025530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025540: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00025550: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00025560: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00025570: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00025580: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00025590: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
-000255a0: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
-000255b0: 2b20 7361 7465 5f65 6e74 6974 792c 2068  + sate_entity, h
-000255c0: 6173 685f 6e61 6d65 202b 2027 203c 3e20  ash_name + ' <> 
-000255d0: 2720 2b20 6861 7368 5f6e 616d 652b 275f  ' + hash_name+'_
-000255e0: 4849 5354 206f 7220 2720 2b20 6861 7368  HIST or ' + hash
-000255f0: 5f6e 616d 6520 2b20 275f 4849 5354 2069  _name + '_HIST i
-00025600: 7320 6e75 6c6c 272c 2031 2c20 7365 6c66  s null', 1, self
-00025610: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00025620: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00025630: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-00025640: 7472 795f 6669 6c74 6572 7328 5b6e 6577  try_filters([new
-00025650: 5f66 696c 7465 725d 290d 0a0d 0a20 2020  _filter])....   
-00025660: 2020 2020 2020 2020 2023 2042 7261 6e63           # Branc
-00025670: 6820 3220 2d20 7265 6c61 7469 6f6e 2075  h 2 - relation u
-00025680: 6470 6174 6564 202d 3e20 4445 4c45 5445  dpated -> DELETE
-00025690: 2061 6374 7561 6c20 7265 6c61 7469 6f6e   actual relation
-000256a0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-000256b0: 6469 6e61 6c5f 706f 7369 7469 6f6e 203d  dinal_position =
-000256c0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-000256d0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-000256e0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-000256f0: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
-00025700: 6f69 6e2c 2068 6173 685f 6e61 6d65 202b  oin, hash_name +
-00025710: 275f 4849 5354 272c 0d0a 2020 2020 2020  '_HIST',..      
-00025720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025730: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00025740: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
-00025750: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
-00025760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025770: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
-00025780: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-00025790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000257a0: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-000257b0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-000257c0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-000257d0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-000257e0: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
+000251a0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+000251b0: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
+000251c0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+000251d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000251f0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00025200: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+00025210: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00025220: 6e2c 2072 6563 6f72 645f 736f 7572 6365  n, record_source
+00025230: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00025240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025260: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+00025270: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
+00025280: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00025290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000252a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000252b0: 312c 204b 4559 5f54 5950 455f 5245 434f  1, KEY_TYPE_RECO
+000252c0: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
+000252d0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+000252e0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+000252f0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00025300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025310: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00025320: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00025330: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00025340: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00025350: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00025360: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
+00025370: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00025380: 2020 2020 7465 6e61 6e74 5f73 6f75 7263      tenant_sourc
+00025390: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+000253a0: 615f 6163 7475 616c 2e67 6574 5f74 656e  a_actual.get_ten
+000253b0: 616e 745f 6f6e 5f64 765f 6672 6f6d 5f63  ant_on_dv_from_c
+000253c0: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+000253d0: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
+000253e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000253f0: 2020 2020 2020 636f 645f 656e 7469 7479        cod_entity
+00025400: 5f74 6172 6765 742c 2031 290d 0a20 2020  _target, 1)..   
+00025410: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00025420: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
+00025430: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
+00025440: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00025450: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00025460: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00025470: 7465 5f65 6e74 6974 795f 6a6f 696e 2c20  te_entity_join, 
+00025480: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+00025490: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+000254a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254c0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+000254d0: 6174 655f 656e 7469 7479 2c0d 0a20 2020  ate_entity,..   
+000254e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000254f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025500: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+00025510: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+00025520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025540: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+00025550: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+00025560: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00025570: 6f6e 2c20 746e 2e63 6f6c 756d 6e5f 6c65  on, tn.column_le
+00025580: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
+00025590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255b0: 2020 746e 2e63 6f6c 756d 6e5f 7072 6563    tn.column_prec
+000255c0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+000255d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255f0: 2020 2031 2c20 4b45 595f 5459 5045 5f54     1, KEY_TYPE_T
+00025600: 454e 414e 542c 2031 2c20 7365 6c66 2e6f  ENANT, 1, self.o
+00025610: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00025620: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00025630: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00025640: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00025650: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00025660: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00025670: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00025680: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00025690: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+000256a0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+000256b0: 6173 5f61 643a 0d0a 2020 2020 2020 2020  as_ad:..        
+000256c0: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+000256d0: 6461 7465 203d 2073 656c 662e 6d65 7461  date = self.meta
+000256e0: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
+000256f0: 6170 706c 6965 645f 6461 7465 5f6f 6e5f  applied_date_on_
+00025700: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
+00025710: 7479 5f74 6172 6765 7428 636f 645f 656e  ty_target(cod_en
+00025720: 7469 7479 5f74 6172 6765 742c 2031 290d  tity_target, 1).
+00025730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025740: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+00025750: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+00025760: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
+00025770: 6a6f 696e 2c20 6170 706c 6965 645f 6461  join, applied_da
+00025780: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
+00025790: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+000257a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000257b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000257c0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+000257d0: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+000257e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000257f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025800: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00025810: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-00025820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025800: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00025810: 756d 6e5f 6e61 6d65 5f74 6172 6765 7420  umn_name_target 
+00025820: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00025830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025840: 2020 2020 2032 2c20 4b45 595f 5459 5045       2, KEY_TYPE
-00025850: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
-00025860: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00025870: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00025880: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00025890: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-000258a0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-000258b0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-000258c0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-000258d0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-000258e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000258f0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-00025900: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-00025910: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
-00025920: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
-00025930: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00025940: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00025950: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00025960: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
-00025970: 696e 2c20 2744 4154 455f 5354 4152 545f  in, 'DATE_START_
-00025980: 4849 5354 272c 0d0a 2020 2020 2020 2020  HIST',..        
-00025990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000259a0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-000259b0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-000259c0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-000259d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000259e0: 2020 2020 2020 2020 2744 4154 455f 5354          'DATE_ST
-000259f0: 4152 5427 2c0d 0a20 2020 2020 2020 2020  ART',..         
-00025a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a10: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-00025a20: 655f 666f 725f 6d65 7461 6461 7461 5b30  e_for_metadata[0
-00025a30: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-00025a40: 696f 6e2c 2073 7973 6461 7465 5f66 6f72  ion, sysdate_for
-00025a50: 5f6d 6574 6164 6174 615b 315d 2c0d 0a20  _metadata[1],.. 
-00025a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a80: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-00025a90: 7461 6461 7461 5b32 5d2c 2032 2c20 4e6f  tadata[2], 2, No
-00025aa0: 6e65 2c20 312c 2073 656c 662e 6f77 6e65  ne, 1, self.owne
-00025ab0: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-00025ac0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00025ad0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-00025ae0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-00025af0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-00025b00: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
-00025b10: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00025b20: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-00025b30: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
-00025b40: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
-00025b50: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
-00025b60: 6765 745f 7379 7364 6174 655f 666f 725f  get_sysdate_for_
-00025b70: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
-00025b80: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00025b90: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00025ba0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-00025bb0: 656e 7469 7479 5f6a 6f69 6e2c 2027 4441  entity_join, 'DA
-00025bc0: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
-00025bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025840: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+00025850: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
+00025860: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+00025870: 616c 5f70 6f73 6974 696f 6e2c 0d0a 2020  al_position,..  
+00025880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000258a0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+000258b0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
+000258c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000258d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000258e0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+000258f0: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
+00025900: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00025910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025930: 312c 204b 4559 5f54 5950 455f 4150 504c  1, KEY_TYPE_APPL
+00025940: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
+00025950: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00025960: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+00025970: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+00025980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025990: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+000259a0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+000259b0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+000259c0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+000259d0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+000259e0: 2020 2020 2020 206e 6577 5f66 696c 7465         new_filte
+000259f0: 7220 3d20 5b70 7265 6669 785f 6574 202b  r = [prefix_et +
+00025a00: 2073 6174 655f 656e 7469 7479 2c20 6861   sate_entity, ha
+00025a10: 7368 5f6e 616d 6520 2b20 2720 3c3e 2027  sh_name + ' <> '
+00025a20: 202b 2068 6173 685f 6e61 6d65 2b27 5f48   + hash_name+'_H
+00025a30: 4953 5420 6f72 2027 202b 2068 6173 685f  IST or ' + hash_
+00025a40: 6e61 6d65 202b 2027 5f48 4953 5420 6973  name + '_HIST is
+00025a50: 206e 756c 6c27 2c20 312c 2073 656c 662e   null', 1, self.
+00025a60: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00025a70: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00025a80: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00025a90: 7279 5f66 696c 7465 7273 285b 6e65 775f  ry_filters([new_
+00025aa0: 6669 6c74 6572 5d29 0d0a 0d0a 2020 2020  filter])....    
+00025ab0: 2020 2020 2020 2020 2320 4272 616e 6368          # Branch
+00025ac0: 2032 202d 2072 656c 6174 696f 6e20 7564   2 - relation ud
+00025ad0: 7061 7465 6420 2d3e 2044 454c 4554 4520  pated -> DELETE 
+00025ae0: 6163 7475 616c 2072 656c 6174 696f 6e0d  actual relation.
+00025af0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+00025b00: 696e 616c 5f70 6f73 6974 696f 6e20 3d20  inal_position = 
+00025b10: 310d 0a20 2020 2020 2020 2020 2020 206e  1..            n
+00025b20: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00025b30: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+00025b40: 2b20 7361 7465 5f65 6e74 6974 795f 6a6f  + sate_entity_jo
+00025b50: 696e 2c20 6861 7368 5f6e 616d 6520 2b27  in, hash_name +'
+00025b60: 5f48 4953 5427 2c0d 0a20 2020 2020 2020  _HIST',..       
+00025b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b80: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00025b90: 6978 5f65 7420 2b20 7361 7465 5f65 6e74  ix_et + sate_ent
+00025ba0: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
+00025bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025bc0: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
+00025bd0: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
 00025be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025bf0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-00025c00: 655f 656e 7469 7479 2c0d 0a20 2020 2020  e_entity,..     
-00025c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c20: 2020 2020 2020 2020 2020 2020 2020 2744                'D
-00025c30: 4154 455f 454e 4427 2c0d 0a20 2020 2020  ATE_END',..     
+00025bf0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+00025c00: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00025c10: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00025c20: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00025c30: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
 00025c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c50: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00025c60: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00025c70: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
-00025c80: 6f73 6974 696f 6e2c 2073 7973 6461 7465  osition, sysdate
-00025c90: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-00025ca0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00025cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025cc0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-00025cd0: 725f 6d65 7461 6461 7461 5b32 5d2c 2032  r_metadata[2], 2
-00025ce0: 2c20 4e6f 6e65 2c20 312c 2073 656c 662e  , None, 1, self.
-00025cf0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00025d00: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00025d10: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00025d20: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00025d30: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00025d40: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-00025d50: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00025d60: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00025d70: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
-00025d80: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00025d90: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
-00025da0: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
-00025db0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-00025dc0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00025dd0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00025de0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00025df0: 6174 655f 656e 7469 7479 5f6a 6f69 6e2c  ate_entity_join,
-00025e00: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
-00025e10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025c50: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+00025c60: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
+00025c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025c90: 2020 2020 322c 204b 4559 5f54 5950 455f      2, KEY_TYPE_
+00025ca0: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
+00025cb0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00025cc0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00025cd0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00025ce0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00025cf0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+00025d00: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00025d10: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00025d20: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+00025d30: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00025d40: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+00025d50: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+00025d60: 6374 696f 6e2e 6765 745f 7379 7364 6174  ction.get_sysdat
+00025d70: 655f 666f 725f 6d65 7461 6461 7461 2829  e_for_metadata()
+00025d80: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00025d90: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00025da0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+00025db0: 2073 6174 655f 656e 7469 7479 5f6a 6f69   sate_entity_joi
+00025dc0: 6e2c 2027 4441 5445 5f53 5441 5254 5f48  n, 'DATE_START_H
+00025dd0: 4953 5427 2c0d 0a20 2020 2020 2020 2020  IST',..         
+00025de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025df0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00025e00: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00025e10: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
 00025e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e30: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00025e40: 2073 6174 655f 656e 7469 7479 2c0d 0a20   sate_entity,.. 
+00025e30: 2020 2020 2020 2027 4441 5445 5f53 5441         'DATE_STA
+00025e40: 5254 272c 0d0a 2020 2020 2020 2020 2020  RT',..          
 00025e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e70: 2020 2744 4154 455f 4352 4541 5445 4427    'DATE_CREATED'
-00025e80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00025e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ea0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-00025eb0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-00025ec0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00025e60: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+00025e70: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+00025e80: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00025e90: 6f6e 2c20 7379 7364 6174 655f 666f 725f  on, sysdate_for_
+00025ea0: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
+00025eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00025ed0: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00025ee0: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-00025ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f00: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00025f10: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00025f20: 7461 5b32 5d2c 2032 2c20 4e6f 6e65 2c20  ta[2], 2, None, 
-00025f30: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00025f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00025f50: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00025f60: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00025f70: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00025f80: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00025f90: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00025fa0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00025fb0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-00025fc0: 2020 2020 2069 6620 6861 735f 7273 3a0d       if has_rs:.
-00025fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025fe0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00025ff0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00026000: 7420 2b20 7361 7465 5f65 6e74 6974 795f  t + sate_entity_
-00026010: 6a6f 696e 2c20 7265 636f 7264 5f73 6f75  join, record_sou
-00026020: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-00026030: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00026040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026060: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00026070: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00026080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ee0: 6164 6174 615b 325d 2c20 322c 204e 6f6e  adata[2], 2, Non
+00025ef0: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
+00025f00: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+00025f10: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00025f20: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+00025f30: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+00025f40: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00025f50: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
+00025f60: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+00025f70: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+00025f80: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+00025f90: 666f 725f 6d65 7461 6461 7461 203d 2073  for_metadata = s
+00025fa0: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
+00025fb0: 6574 5f73 7973 6461 7465 5f66 6f72 5f6d  et_sysdate_for_m
+00025fc0: 6574 6164 6174 6128 290d 0a20 2020 2020  etadata()..     
+00025fd0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+00025fe0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+00025ff0: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00026000: 6e74 6974 795f 6a6f 696e 2c20 2744 4154  ntity_join, 'DAT
+00026010: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
+00026020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026040: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
+00026050: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
+00026060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026070: 2020 2020 2020 2020 2020 2020 2027 4441               'DA
+00026080: 5445 5f45 4e44 272c 0d0a 2020 2020 2020  TE_END',..      
 00026090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260a0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-000260b0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-000260c0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-000260d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260e0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-000260f0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00026100: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-00026110: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
-00026120: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-00026130: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-00026140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026160: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00026170: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-00026180: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-00026190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261a0: 2020 2020 2020 2020 2020 2020 322c 204b              2, K
-000261b0: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-000261c0: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-000261d0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-000261e0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-000261f0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00026200: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00026210: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00026220: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00026230: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00026240: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00026250: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00026260: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
+000260a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+000260b0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+000260c0: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+000260d0: 7369 7469 6f6e 2c20 7379 7364 6174 655f  sition, sysdate_
+000260e0: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+000260f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026110: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+00026120: 5f6d 6574 6164 6174 615b 325d 2c20 322c  _metadata[2], 2,
+00026130: 204e 6f6e 652c 2031 2c20 7365 6c66 2e6f   None, 1, self.o
+00026140: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00026150: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00026160: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00026170: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00026180: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00026190: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+000261a0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+000261b0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+000261c0: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+000261d0: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+000261e0: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
+000261f0: 6f6e 2e67 6574 5f73 7973 6461 7465 5f66  on.get_sysdate_f
+00026200: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
+00026210: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00026220: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00026230: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00026240: 7465 5f65 6e74 6974 795f 6a6f 696e 2c20  te_entity_join, 
+00026250: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
+00026260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00026270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026280: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
-00026290: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-000262a0: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
-000262b0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-000262c0: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-000262d0: 5f6e 756d 5f62 7261 6e63 6828 0d0a 2020  _num_branch(..  
+00026280: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00026290: 7361 7465 5f65 6e74 6974 792c 0d0a 2020  sate_entity,..  
+000262a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262c0: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
+000262d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000262e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262f0: 2020 636f 645f 656e 7469 7479 5f74 6172    cod_entity_tar
-00026300: 6765 742c 2031 290d 0a20 2020 2020 2020  get, 1)..       
-00026310: 2020 2020 2020 2020 2066 6f72 2074 6e20           for tn 
-00026320: 696e 2074 656e 616e 745f 736f 7572 6365  in tenant_source
-00026330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00026340: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-00026350: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-00026360: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
-00026370: 6e74 6974 795f 6a6f 696e 2c20 746e 2e63  ntity_join, tn.c
-00026380: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-00026390: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-000263a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000263c0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
-000263d0: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-000263e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026400: 2020 2020 746e 2e63 6f6c 756d 6e5f 6e61      tn.column_na
-00026410: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+000262f0: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+00026300: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00026310: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00026320: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00026330: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00026340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026350: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00026360: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00026370: 615b 325d 2c20 322c 204e 6f6e 652c 2031  a[2], 2, None, 1
+00026380: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00026390: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000263a0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000263b0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+000263c0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+000263d0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+000263e0: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
+000263f0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00026400: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+00026410: 2020 2020 6966 2068 6173 5f72 733a 0d0a      if has_rs:..
 00026420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026440: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-00026450: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-00026460: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-00026470: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
-00026480: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00026430: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00026440: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00026450: 202b 2073 6174 655f 656e 7469 7479 5f6a   + sate_entity_j
+00026460: 6f69 6e2c 2072 6563 6f72 645f 736f 7572  oin, record_sour
+00026470: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
+00026480: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
 00026490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264a0: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-000264b0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-000264c0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000264a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000264b0: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+000264c0: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
 000264d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264e0: 2020 2020 2020 2020 2020 2020 2020 2032                 2
-000264f0: 2c20 4b45 595f 5459 5045 5f54 454e 414e  , KEY_TYPE_TENAN
-00026500: 542c 2031 2c20 7365 6c66 2e6f 776e 6572  T, 1, self.owner
-00026510: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00026520: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00026530: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00026540: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00026550: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00026560: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-00026570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026580: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00026590: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-000265a0: 2020 2020 2020 2020 6966 2068 6173 5f61          if has_a
-000265b0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-000265c0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-000265d0: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-000265e0: 5f61 6374 7561 6c2e 6765 745f 6170 706c  _actual.get_appl
-000265f0: 6965 645f 6461 7465 5f6f 6e5f 6476 5f66  ied_date_on_dv_f
-00026600: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
-00026610: 6172 6765 7428 636f 645f 656e 7469 7479  arget(cod_entity
-00026620: 5f74 6172 6765 742c 2031 290d 0a20 2020  _target, 1)..   
-00026630: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00026640: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00026650: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00026660: 7361 7465 5f65 6e74 6974 795f 6a6f 696e  sate_entity_join
-00026670: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
-00026680: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-00026690: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-000266a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266b0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-000266c0: 785f 6574 202b 2073 6174 655f 656e 7469  x_et + sate_enti
-000266d0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-000266e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266f0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-00026700: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-00026710: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00026720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264f0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+00026500: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00026510: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00026520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026530: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00026540: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
+00026550: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+00026560: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7265  nal_position, re
+00026570: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00026580: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+00026590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000265a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000265b0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+000265c0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+000265d0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000265e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000265f0: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
+00026600: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+00026610: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+00026620: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00026630: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00026640: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00026650: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00026660: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00026670: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00026680: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00026690: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000266a0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+000266b0: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+000266c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000266d0: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
+000266e0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+000266f0: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
+00026700: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+00026710: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+00026720: 6e75 6d5f 6272 616e 6368 280d 0a20 2020  num_branch(..   
 00026730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026740: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00026750: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00026760: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00026770: 7369 7469 6f6e 2c0d 0a20 2020 2020 2020  sition,..       
-00026780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267a0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-000267b0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-000267c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267e0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-000267f0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-00026800: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00026810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026820: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
-00026830: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
-00026840: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
-00026850: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00026860: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00026870: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00026880: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00026890: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000268a0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000268b0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-000268c0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000268d0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-000268e0: 2020 6e65 775f 6669 6c74 6572 203d 205b    new_filter = [
-000268f0: 7072 6566 6978 5f65 7420 2b20 7361 7465  prefix_et + sate
-00026900: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00026910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026920: 2020 2020 6861 7368 5f6e 616d 6520 2b20      hash_name + 
-00026930: 2720 3c3e 2027 202b 2068 6173 685f 6e61  ' <> ' + hash_na
-00026940: 6d65 202b 2027 5f48 4953 5427 2c20 322c  me + '_HIST', 2,
-00026950: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00026960: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00026970: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00026980: 6464 5f65 6e74 7279 5f66 696c 7465 7273  dd_entry_filters
-00026990: 285b 6e65 775f 6669 6c74 6572 5d29 0d0a  ([new_filter])..
-000269a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-000269b0: 6f67 2e6c 6f67 2873 656c 662e 656e 6769  og.log(self.engi
-000269c0: 6e65 5f6e 616d 652c 2022 4669 6e69 7368  ne_name, "Finish
-000269d0: 6564 2074 6f20 7072 6f63 6573 7320 4d65  ed to process Me
-000269e0: 7461 6461 7461 205b 2045 6666 6563 7469  tadata [ Effecti
-000269f0: 7669 7479 2053 6174 656c 6c69 7465 205d  vity Satellite ]
-00026a00: 2069 6e66 6f72 6d61 7469 6f6e 222c 204c   information", L
-00026a10: 4f47 5f4c 4556 454c 5f4f 4e4c 595f 4c4f  OG_LEVEL_ONLY_LO
-00026a20: 4729 0d0a 0d0a 2020 2020 6465 6620 7072  G)....    def pr
-00026a30: 6f63 6573 735f 6476 5f73 7473 2873 656c  ocess_dv_sts(sel
-00026a40: 662c 2064 765f 656e 7469 7479 293a 0d0a  f, dv_entity):..
-00026a50: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00026a60: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
-00026a70: 5f6e 616d 652c 2022 5374 6172 7469 6e67  _name, "Starting
-00026a80: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
-00026a90: 6461 7461 205b 2053 7461 7475 7320 5472  data [ Status Tr
-00026aa0: 6163 6b69 6e67 2053 6174 656c 6c69 7465  acking Satellite
-00026ab0: 205d 2069 6e66 6f72 6d61 7469 6f6e 222c   ] information",
-00026ac0: 204c 4f47 5f4c 4556 454c 5f4f 4e4c 595f   LOG_LEVEL_ONLY_
-00026ad0: 4c4f 4729 0d0a 0d0a 2020 2020 2020 2020  LOG)....        
-00026ae0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00026af0: 203d 2031 0d0a 2020 2020 2020 2020 7072   = 1..        pr
-00026b00: 6566 6978 5f65 7420 3d20 2745 545f 270d  efix_et = 'ET_'.
-00026b10: 0a20 2020 2020 2020 2073 7473 5f6e 616d  .        sts_nam
-00026b20: 6520 3d20 6476 5f65 6e74 6974 792e 6e61  e = dv_entity.na
-00026b30: 6d65 5f73 7461 7475 735f 7472 6163 6b69  me_status_tracki
-00026b40: 6e67 5f73 6174 656c 6c69 7465 0d0a 2020  ng_satellite..  
-00026b50: 2020 2020 2020 7374 735f 656e 7469 7479        sts_entity
-00026b60: 5f61 6374 7561 6c5f 696d 6167 655f 3120  _actual_image_1 
-00026b70: 3d20 2753 5447 5f54 4d50 5f4c 4153 545f  = 'STG_TMP_LAST_
-00026b80: 494d 4147 455f 315f 2720 2b20 7374 735f  IMAGE_1_' + sts_
-00026b90: 6e61 6d65 0d0a 2020 2020 2020 2020 7374  name..        st
-00026ba0: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
-00026bb0: 696d 6167 655f 3220 3d20 2753 5447 5f54  image_2 = 'STG_T
-00026bc0: 4d50 5f4c 4153 545f 494d 4147 455f 325f  MP_LAST_IMAGE_2_
-00026bd0: 2720 2b20 7374 735f 6e61 6d65 0d0a 2020  ' + sts_name..  
-00026be0: 2020 2020 2020 7374 735f 656e 7469 7479        sts_entity
-00026bf0: 5f75 6e69 6f6e 5f73 6f75 7263 6573 203d  _union_sources =
-00026c00: 2027 5354 475f 544d 505f 554e 494f 4e5f   'STG_TMP_UNION_
-00026c10: 2720 2b20 7374 735f 6e61 6d65 0d0a 2020  ' + sts_name..  
-00026c20: 2020 2020 2020 7374 735f 656e 7469 7479        sts_entity
-00026c30: 5f6a 6f69 6e20 3d20 2753 5447 5f54 4d50  _join = 'STG_TMP
-00026c40: 5f4a 4f49 4e5f 2720 2b20 7374 735f 6e61  _JOIN_' + sts_na
-00026c50: 6d65 0d0a 2020 2020 2020 2020 7374 735f  me..        sts_
-00026c60: 656e 7469 7479 203d 2073 7473 5f6e 616d  entity = sts_nam
-00026c70: 650d 0a20 2020 2020 2020 2063 6f64 5f65  e..        cod_e
-00026c80: 6e74 6974 795f 7461 7267 6574 203d 2064  ntity_target = d
-00026c90: 765f 656e 7469 7479 2e63 6f64 5f65 6e74  v_entity.cod_ent
-00026ca0: 6974 790d 0a0d 0a20 2020 2020 2020 2068  ity....        h
-00026cb0: 6173 685f 6e61 6d65 203d 2027 4841 5348  ash_name = 'HASH
-00026cc0: 5f27 202b 2064 765f 656e 7469 7479 2e65  _' + dv_entity.e
-00026cd0: 6e74 6974 795f 6e61 6d65 0d0a 2020 2020  ntity_name..    
-00026ce0: 2020 2020 6476 5f70 726f 7065 7274 7920      dv_property 
-00026cf0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
-00026d00: 6163 7475 616c 2e67 6574 5f64 765f 7072  actual.get_dv_pr
-00026d10: 6f70 6572 7469 6573 5f66 726f 6d5f 636f  operties_from_co
-00026d20: 645f 656e 7469 7479 5f61 6e64 5f6e 756d  d_entity_and_num
-00026d30: 5f63 6f6e 6e65 6374 696f 6e28 6476 5f65  _connection(dv_e
-00026d40: 6e74 6974 792e 636f 645f 656e 7469 7479  ntity.cod_entity
-00026d50: 2c20 3029 0d0a 2020 2020 2020 2020 6966  , 0)..        if
-00026d60: 2064 765f 7072 6f70 6572 7479 2069 7320   dv_property is 
-00026d70: 6e6f 7420 4e6f 6e65 3a20 6861 7368 5f6e  not None: hash_n
-00026d80: 616d 6520 3d20 6476 5f70 726f 7065 7274  ame = dv_propert
-00026d90: 792e 6861 7368 5f6e 616d 650d 0a0d 0a20  y.hash_name.... 
-00026da0: 2020 2020 2020 2069 6620 7374 735f 6e61         if sts_na
-00026db0: 6d65 2069 7320 4e6f 6e65 206f 7220 7374  me is None or st
-00026dc0: 735f 6e61 6d65 203d 3d20 2727 3a20 7265  s_name == '': re
-00026dd0: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-00026de0: 6e65 775f 656e 7469 7479 5f73 7473 5f65  new_entity_sts_e
-00026df0: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-00026e00: 6765 5f31 203d 205b 7072 6566 6978 5f65  ge_1 = [prefix_e
-00026e10: 7420 2b20 7374 735f 656e 7469 7479 5f61  t + sts_entity_a
-00026e20: 6374 7561 6c5f 696d 6167 655f 312c 2073  ctual_image_1, s
-00026e30: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-00026e40: 5f69 6d61 6765 5f31 2c20 454e 5449 5459  _image_1, ENTITY
-00026e50: 5f57 4954 482c 2064 765f 656e 7469 7479  _WITH, dv_entity
-00026e60: 2e63 6f64 5f70 6174 682c 2027 272c 2073  .cod_path, '', s
-00026e70: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00026e80: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00026e90: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00026ea0: 7279 5f65 6e74 6974 7928 5b6e 6577 5f65  ry_entity([new_e
-00026eb0: 6e74 6974 795f 7374 735f 656e 7469 7479  ntity_sts_entity
-00026ec0: 5f61 6374 7561 6c5f 696d 6167 655f 315d  _actual_image_1]
-00026ed0: 290d 0a20 2020 2020 2020 206e 6577 5f65  )..        new_e
-00026ee0: 6e74 6974 795f 7374 735f 656e 7469 7479  ntity_sts_entity
-00026ef0: 5f61 6374 7561 6c5f 696d 6167 655f 3220  _actual_image_2 
-00026f00: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00026f10: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-00026f20: 5f69 6d61 6765 5f32 2c20 7374 735f 656e  _image_2, sts_en
-00026f30: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-00026f40: 655f 322c 2045 4e54 4954 595f 5749 5448  e_2, ENTITY_WITH
-00026f50: 2c20 6476 5f65 6e74 6974 792e 636f 645f  , dv_entity.cod_
-00026f60: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
-00026f70: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-00026f80: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00026f90: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
-00026fa0: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
-00026fb0: 5f73 7473 5f65 6e74 6974 795f 6163 7475  _sts_entity_actu
-00026fc0: 616c 5f69 6d61 6765 5f32 5d29 0d0a 2020  al_image_2])..  
-00026fd0: 2020 2020 2020 6e65 775f 656e 7469 7479        new_entity
-00026fe0: 5f73 7473 5f65 6e74 6974 795f 756e 696f  _sts_entity_unio
-00026ff0: 6e5f 736f 7572 6365 7320 3d20 5b70 7265  n_sources = [pre
-00027000: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-00027010: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-00027020: 732c 2073 7473 5f65 6e74 6974 795f 756e  s, sts_entity_un
-00027030: 696f 6e5f 736f 7572 6365 732c 2045 4e54  ion_sources, ENT
-00027040: 4954 595f 5749 5448 2c20 6476 5f65 6e74  ITY_WITH, dv_ent
-00027050: 6974 792e 636f 645f 7061 7468 2c20 2727  ity.cod_path, ''
-00027060: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00027070: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00027080: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00027090: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
-000270a0: 775f 656e 7469 7479 5f73 7473 5f65 6e74  w_entity_sts_ent
-000270b0: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-000270c0: 735d 290d 0a20 2020 2020 2020 206e 6577  s])..        new
-000270d0: 5f65 6e74 6974 795f 7374 735f 656e 7469  _entity_sts_enti
-000270e0: 7479 5f6a 6f69 6e20 3d20 5b70 7265 6669  ty_join = [prefi
-000270f0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-00027100: 795f 6a6f 696e 2c20 7374 735f 656e 7469  y_join, sts_enti
-00027110: 7479 5f6a 6f69 6e2c 2045 4e54 4954 595f  ty_join, ENTITY_
-00027120: 5749 5448 2c20 6476 5f65 6e74 6974 792e  WITH, dv_entity.
-00027130: 636f 645f 7061 7468 2c20 2727 2c20 7365  cod_path, '', se
-00027140: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00027150: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00027160: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00027170: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
-00027180: 7469 7479 5f73 7473 5f65 6e74 6974 795f  tity_sts_entity_
-00027190: 6a6f 696e 5d29 0d0a 2020 2020 2020 2020  join])..        
-000271a0: 6e65 775f 656e 7469 7479 5f73 7473 5f65  new_entity_sts_e
-000271b0: 6e74 6974 7920 3d20 5b70 7265 6669 785f  ntity = [prefix_
-000271c0: 6574 202b 2073 7473 5f65 6e74 6974 792c  et + sts_entity,
-000271d0: 2073 7473 5f65 6e74 6974 792c 2045 4e54   sts_entity, ENT
-000271e0: 4954 595f 5442 2c20 6476 5f65 6e74 6974  ITY_TB, dv_entit
-000271f0: 792e 636f 645f 7061 7468 2c20 2749 4e53  y.cod_path, 'INS
-00027200: 4552 5427 2c20 7365 6c66 2e6f 776e 6572  ERT', self.owner
-00027210: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-00027220: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00027230: 6164 645f 656e 7472 795f 656e 7469 7479  add_entry_entity
-00027240: 285b 6e65 775f 656e 7469 7479 5f73 7473  ([new_entity_sts
-00027250: 5f65 6e74 6974 795d 290d 0a0d 0a20 2020  _entity])....   
-00027260: 2020 2020 2068 6173 5f72 7320 3d20 4661       has_rs = Fa
-00027270: 6c73 650d 0a20 2020 2020 2020 2068 6173  lse..        has
-00027280: 5f74 6e20 3d20 4661 6c73 650d 0a20 2020  _tn = False..   
-00027290: 2020 2020 2068 6173 5f61 6420 3d20 4661       has_ad = Fa
-000272a0: 6c73 650d 0a0d 0a20 2020 2020 2020 2023  lse....        #
-000272b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000272c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000272d0: 2323 2323 2055 6e69 6f6e 2061 6c6c 2073  #### Union all s
-000272e0: 6f75 7263 6573 2023 2323 2323 2323 2323  ources #########
-000272f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00027300: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
-00027310: 2020 2020 2020 616c 6c5f 736f 7572 6365        all_source
-00027320: 7320 3d20 7365 6c66 2e6d 6574 6164 6174  s = self.metadat
-00027330: 615f 6163 7475 616c 2e67 6574 5f61 6c6c  a_actual.get_all
-00027340: 5f63 6f64 5f65 6e74 6974 795f 736f 7572  _cod_entity_sour
-00027350: 6365 5f66 726f 6d5f 636f 645f 656e 7469  ce_from_cod_enti
-00027360: 7479 5f74 6172 6765 745f 6f6e 5f65 6e74  ty_target_on_ent
-00027370: 7279 5f64 7628 636f 645f 656e 7469 7479  ry_dv(cod_entity
-00027380: 5f74 6172 6765 7429 0d0a 2020 2020 2020  _target)..      
-00027390: 2020 7465 6e61 6e74 5f73 6f75 7263 6520    tenant_source 
-000273a0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
-000273b0: 6163 7475 616c 2e67 6574 5f74 656e 616e  actual.get_tenan
-000273c0: 745f 6f6e 5f64 765f 6672 6f6d 5f63 6f64  t_on_dv_from_cod
-000273d0: 5f65 6e74 6974 795f 7461 7267 6574 5f61  _entity_target_a
-000273e0: 6e64 5f6e 756d 5f62 7261 6e63 6828 636f  nd_num_branch(co
-000273f0: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
-00027400: 2031 290d 0a20 2020 2020 2020 2069 6620   1)..        if 
-00027410: 6c65 6e28 7465 6e61 6e74 5f73 6f75 7263  len(tenant_sourc
-00027420: 6529 2021 3d20 303a 2068 6173 5f74 6e20  e) != 0: has_tn 
-00027430: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00027440: 7265 636f 7264 5f73 6f75 7263 6520 3d20  record_source = 
-00027450: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00027460: 7475 616c 2e67 6574 5f72 6563 6f72 645f  tual.get_record_
-00027470: 736f 7572 6365 5f6f 6e5f 6476 5f66 726f  source_on_dv_fro
-00027480: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
-00027490: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
-000274a0: 6368 2863 6f64 5f65 6e74 6974 795f 7461  ch(cod_entity_ta
-000274b0: 7267 6574 2c20 3129 0d0a 2020 2020 2020  rget, 1)..      
-000274c0: 2020 6966 2072 6563 6f72 645f 736f 7572    if record_sour
-000274d0: 6365 2069 7320 6e6f 7420 4e6f 6e65 3a20  ce is not None: 
-000274e0: 6861 735f 7273 203d 2054 7275 650d 0a20  has_rs = True.. 
-000274f0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-00027500: 6174 6520 3d20 7365 6c66 2e6d 6574 6164  ate = self.metad
-00027510: 6174 615f 6163 7475 616c 2e67 6574 5f61  ata_actual.get_a
-00027520: 7070 6c69 6564 5f64 6174 655f 6f6e 5f64  pplied_date_on_d
-00027530: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-00027540: 795f 7461 7267 6574 2864 765f 656e 7469  y_target(dv_enti
-00027550: 7479 2e63 6f64 5f65 6e74 6974 792c 2031  ty.cod_entity, 1
-00027560: 290d 0a20 2020 2020 2020 2069 6620 6170  )..        if ap
-00027570: 706c 6965 645f 6461 7465 2069 7320 6e6f  plied_date is no
-00027580: 7420 4e6f 6e65 3a20 6861 735f 6164 203d  t None: has_ad =
-00027590: 2054 7275 650d 0a0d 0a0d 0a20 2020 2020   True......     
-000275a0: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-000275b0: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-000275c0: 6563 7469 6f6e 2e67 6574 5f68 6173 685f  ection.get_hash_
-000275d0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-000275e0: 0d0a 2020 2020 2020 2020 6e75 6d5f 6272  ..        num_br
-000275f0: 616e 6368 6573 203d 2073 656c 662e 6d65  anches = self.me
-00027600: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-00027610: 745f 6e75 6d5f 6272 616e 6368 6573 5f6f  t_num_branches_o
-00027620: 6e5f 656e 7472 795f 6476 5f66 726f 6d5f  n_entry_dv_from_
-00027630: 636f 645f 656e 7469 7479 5f6e 616d 6528  cod_entity_name(
-00027640: 6476 5f65 6e74 6974 792e 636f 645f 656e  dv_entity.cod_en
-00027650: 7469 7479 290d 0a0d 0a20 2020 2020 2020  tity)....       
-00027660: 2066 6f72 206e 756d 5f62 7261 6e63 6820   for num_branch 
-00027670: 696e 2072 616e 6765 2831 2c20 6e75 6d5f  in range(1, num_
-00027680: 6272 616e 6368 6573 202b 2031 293a 0d0a  branches + 1):..
-00027690: 2020 2020 2020 2020 2020 2020 656e 7472              entr
-000276a0: 795f 6476 5f6d 6170 7069 6e67 5f62 6b20  y_dv_mapping_bk 
-000276b0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
-000276c0: 6163 7475 616c 2e67 6574 5f61 6c6c 5f62  actual.get_all_b
-000276d0: 6b5f 6672 6f6d 5f65 6e74 7279 5f64 765f  k_from_entry_dv_
-000276e0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-000276f0: 745f 616e 645f 6e75 6d5f 6272 616e 6368  t_and_num_branch
-00027700: 2864 765f 656e 7469 7479 2e63 6f64 5f65  (dv_entity.cod_e
-00027710: 6e74 6974 792c 206e 756d 5f62 7261 6e63  ntity, num_branc
-00027720: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
-00027730: 656e 7472 795f 6476 5f6d 6170 7069 6e67  entry_dv_mapping
-00027740: 5f62 6b2e 736f 7274 286b 6579 3d6c 616d  _bk.sort(key=lam
-00027750: 6264 6120 783a 2078 2e6f 7264 696e 616c  bda x: x.ordinal
-00027760: 5f70 6f73 6974 696f 6e29 0d0a 2020 2020  _position)..    
-00027770: 2020 2020 2020 2020 636f 645f 656e 7469          cod_enti
-00027780: 7479 5f73 6f75 7263 6520 3d20 656e 7472  ty_source = entr
-00027790: 795f 6476 5f6d 6170 7069 6e67 5f62 6b5b  y_dv_mapping_bk[
-000277a0: 305d 2e63 6f64 5f65 6e74 6974 795f 736f  0].cod_entity_so
-000277b0: 7572 6365 0d0a 2020 2020 2020 2020 2020  urce..          
-000277c0: 2020 6d64 355f 6675 6e63 7469 6f6e 203d    md5_function =
-000277d0: 2073 656c 662e 6765 745f 6861 7368 5f6b   self.get_hash_k
-000277e0: 6579 5f66 726f 6d5f 636f 645f 656e 7469  ey_from_cod_enti
-000277f0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
-00027800: 6d5f 6272 616e 6368 2863 6f64 5f65 6e74  m_branch(cod_ent
-00027810: 6974 795f 7461 7267 6574 2c20 6e75 6d5f  ity_target, num_
-00027820: 6272 616e 6368 290d 0a20 2020 2020 2020  branch)..       
-00027830: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-00027840: 5f6d 6170 7069 6e67 203d 205b 636f 645f  _mapping = [cod_
-00027850: 656e 7469 7479 5f73 6f75 7263 652c 206d  entity_source, m
-00027860: 6435 5f66 756e 6374 696f 6e2c 2070 7265  d5_function, pre
-00027870: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-00027880: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-00027890: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-000278a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278b0: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-000278c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000278d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000278e0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-000278f0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00027900: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-00027910: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00027920: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-00027930: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-00027940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027950: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-00027960: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-00027970: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-00027980: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00027990: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-000279a0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000279b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000279c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000279d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000279e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-000279f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00027a00: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-00027a10: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-00027a20: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
-00027a30: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-00027a40: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00027a50: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-00027a60: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00027a70: 7069 6e67 203d 205b 2727 2c20 7365 6c66  ping = ['', self
-00027a80: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-00027a90: 7379 7364 6174 655f 7661 6c75 6528 292c  sysdate_value(),
-00027aa0: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
-00027ab0: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-00027ac0: 7572 6365 732c 0d0a 2020 2020 2020 2020  urces,..        
-00027ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ae0: 2020 2020 2020 2020 2020 2027 4441 5445             'DATE
-00027af0: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
-00027b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00027b20: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-00027b30: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00027b40: 706f 7369 7469 6f6e 2c20 7379 7364 6174  position, sysdat
-00027b50: 655f 666f 725f 6d65 7461 6461 7461 5b31  e_for_metadata[1
-00027b60: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00027b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027b80: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
-00027b90: 6f72 5f6d 6574 6164 6174 615b 325d 2c20  or_metadata[2], 
-00027ba0: 6e75 6d5f 6272 616e 6368 2c20 4e6f 6e65  num_branch, None
-00027bb0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-00027bc0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00027bd0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00027be0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00027bf0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00027c00: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00027c10: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-00027c20: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00027c30: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-00027c40: 2020 2020 2020 2069 6620 6861 735f 7273         if has_rs
-00027c50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00027c60: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-00027c70: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00027c80: 5f61 6374 7561 6c2e 6765 745f 7265 636f  _actual.get_reco
-00027c90: 7264 5f73 6f75 7263 655f 6f6e 5f64 765f  rd_source_on_dv_
-00027ca0: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-00027cb0: 7461 7267 6574 5f61 6e64 5f6e 756d 5f62  target_and_num_b
-00027cc0: 7261 6e63 6828 636f 645f 656e 7469 7479  ranch(cod_entity
-00027cd0: 5f74 6172 6765 742c 206e 756d 5f62 7261  _target, num_bra
-00027ce0: 6e63 6829 0d0a 2020 2020 2020 2020 2020  nch)..          
-00027cf0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00027d00: 745f 6d61 7070 696e 6720 3d20 5b63 6f64  t_mapping = [cod
-00027d10: 5f65 6e74 6974 795f 736f 7572 6365 2c20  _entity_source, 
-00027d20: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00027d30: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
-00027d40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00027d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d60: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00027d70: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
-00027d80: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c0d  _union_sources,.
-00027d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027db0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00027dc0: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-00027dd0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-00027de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e00: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-00027e10: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-00027e20: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-00027e30: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
-00027e40: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-00027e50: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00027e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027e70: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-00027e80: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00027e90: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-00027ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ec0: 2020 206e 756d 5f62 7261 6e63 682c 204b     num_branch, K
-00027ed0: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-00027ee0: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-00027ef0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00027f00: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00027f10: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00027f20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00027f30: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00027f40: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00027f50: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00027f60: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00027f70: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00027f80: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
-00027f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fa0: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
-00027fb0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00027fc0: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
-00027fd0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-00027fe0: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-00027ff0: 5f6e 756d 5f62 7261 6e63 6828 636f 645f  _num_branch(cod_
-00028000: 656e 7469 7479 5f74 6172 6765 742c 206e  entity_target, n
-00028010: 756d 5f62 7261 6e63 6829 0d0a 2020 2020  um_branch)..    
-00028020: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00028030: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
-00028040: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-00028050: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00028060: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00028070: 5b63 6f64 5f65 6e74 6974 795f 736f 7572  [cod_entity_sour
-00028080: 6365 2c20 746e 2e63 6f6c 756d 6e5f 6e61  ce, tn.column_na
-00028090: 6d65 5f73 6f75 7263 652c 2070 7265 6669  me_source, prefi
-000280a0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-000280b0: 795f 756e 696f 6e5f 736f 7572 6365 732c  y_union_sources,
-000280c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000280d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000280e0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
-000280f0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00028100: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-00028110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028130: 746e 2e63 6f6c 756d 6e5f 7479 7065 5f74  tn.column_type_t
-00028140: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-00028150: 6f73 6974 696f 6e2c 2074 6e2e 636f 6c75  osition, tn.colu
-00028160: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-00028170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028190: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-000281a0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-000281b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281d0: 2020 2020 2020 2020 6e75 6d5f 6272 616e          num_bran
-000281e0: 6368 2c20 4b45 595f 5459 5045 5f54 454e  ch, KEY_TYPE_TEN
-000281f0: 414e 542c 2031 2c20 7365 6c66 2e6f 776e  ANT, 1, self.own
-00028200: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00028210: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00028220: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00028230: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00028240: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-00028250: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00028260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028270: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00028280: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
-00028290: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-000282a0: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
-000282b0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-000282c0: 7465 203d 2073 656c 662e 6d65 7461 6461  te = self.metada
-000282d0: 7461 5f61 6374 7561 6c2e 6765 745f 6170  ta_actual.get_ap
-000282e0: 706c 6965 645f 6461 7465 5f6f 6e5f 6476  plied_date_on_dv
-000282f0: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
-00028300: 5f74 6172 6765 7428 6476 5f65 6e74 6974  _target(dv_entit
-00028310: 792e 636f 645f 656e 7469 7479 2c20 6e75  y.cod_entity, nu
-00028320: 6d5f 6272 616e 6368 290d 0a20 2020 2020  m_branch)..     
-00028330: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-00028340: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-00028350: 205b 636f 645f 656e 7469 7479 5f73 6f75   [cod_entity_sou
-00028360: 7263 652c 2061 7070 6c69 6564 5f64 6174  rce, applied_dat
-00028370: 652e 636f 6c75 6d6e 5f6e 616d 655f 736f  e.column_name_so
-00028380: 7572 6365 2c0d 0a20 2020 2020 2020 2020  urce,..         
-00028390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283a0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000283b0: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-000283c0: 7469 7479 5f75 6e69 6f6e 5f73 6f75 7263  tity_union_sourc
-000283d0: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
-000283e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000283f0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-00028400: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-00028410: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028440: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00028450: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-00028460: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00028470: 7369 7469 6f6e 2c20 6170 706c 6965 645f  sition, applied_
-00028480: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
-00028490: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-000284a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284b0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-000284c0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-000284d0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-000284e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000284f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028500: 2020 206e 756d 5f62 7261 6e63 682c 204b     num_branch, K
-00028510: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
-00028520: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
-00028530: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00028540: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00028550: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-00028560: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00028570: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00028580: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00028590: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-000285a0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-000285b0: 675d 290d 0a0d 0a20 2020 2020 2020 2023  g])....        #
-000285c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000285d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000285e0: 2323 2323 204c 4153 5420 494d 4147 4520  #### LAST IMAGE 
-000285f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00028610: 2323 2323 230d 0a20 2020 2020 2020 2069  #####..        i
-00028620: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
-00028630: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
-00028640: 6374 696f 6e2e 6765 745f 696e 7465 6765  ction.get_intege
-00028650: 725f 666f 725f 6d65 7461 6461 7461 2829  r_for_metadata()
-00028660: 0d0a 2020 2020 2020 2020 2320 4c61 7374  ..        # Last
-00028670: 2049 6d61 6765 2031 0d0a 2020 2020 2020   Image 1..      
-00028680: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00028690: 6f6e 203d 2031 0d0a 2020 2020 2020 2020  on = 1..        
-000286a0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-000286b0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-000286c0: 202b 2073 7473 5f65 6e74 6974 792c 2068   + sts_entity, h
-000286d0: 6173 685f 6e61 6d65 2c20 7072 6566 6978  ash_name, prefix
-000286e0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
-000286f0: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
-00028700: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
-00028710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028720: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00028730: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-00028740: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00028750: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
-00028760: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
-00028770: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
-00028780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000287a0: 312c 204b 4559 5f54 5950 455f 4841 5348  1, KEY_TYPE_HASH
-000287b0: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
-000287c0: 6e65 725d 0d0a 2020 2020 2020 2020 6f72  ner]..        or
-000287d0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-000287e0: 3d20 310d 0a20 2020 2020 2020 2073 656c  = 1..        sel
-000287f0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00028800: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00028810: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-00028820: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00028830: 675d 290d 0a0d 0a20 2020 2020 2020 2076  g])....        v
-00028840: 6172 6368 6172 5f66 6f72 5f6d 6574 6164  archar_for_metad
-00028850: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
-00028860: 6374 696f 6e2e 6765 745f 7374 7269 6e67  ction.get_string
-00028870: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
-00028880: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
-00028890: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-000288a0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-000288b0: 656e 7469 7479 2c20 2744 565f 5354 4154  entity, 'DV_STAT
-000288c0: 5553 272c 2070 7265 6669 785f 6574 202b  US', prefix_et +
-000288d0: 2073 7473 5f65 6e74 6974 795f 6163 7475   sts_entity_actu
-000288e0: 616c 5f69 6d61 6765 5f31 2c20 2744 565f  al_image_1, 'DV_
-000288f0: 5354 4154 5553 272c 0d0a 2020 2020 2020  STATUS',..      
-00028900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028910: 2020 2020 2020 2020 2076 6172 6368 6172           varchar
-00028920: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-00028930: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00028940: 6f6e 2c20 312c 2030 2c0d 0a20 2020 2020  on, 1, 0,..     
-00028950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028960: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
-00028970: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00028980: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00028990: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-000289a0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-000289b0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000289c0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000289d0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000289e0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-000289f0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00028a00: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
-00028a10: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00028a20: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-00028a30: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-00028a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a50: 2020 2020 2020 2020 2752 4f57 5f4e 554d          'ROW_NUM
-00028a60: 4245 5228 2920 6f76 6572 2028 7061 7274  BER() over (part
-00028a70: 6974 696f 6e20 6279 2027 202b 2068 6173  ition by ' + has
-00028a80: 685f 6e61 6d65 202b 2027 204f 5244 4552  h_name + ' ORDER
-00028a90: 2042 5920 4441 5445 5f43 5245 4154 4544   BY DATE_CREATED
-00028aa0: 2064 6573 6329 272c 0d0a 2020 2020 2020   desc)',..      
-00028ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ac0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-00028ad0: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-00028ae0: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
-00028af0: 2752 4e27 2c0d 0a20 2020 2020 2020 2020  'RN',..         
-00028b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b10: 2020 2020 2020 696e 7465 6765 725f 666f        integer_fo
-00028b20: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-00028b30: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00028b40: 2069 6e74 6567 6572 5f66 6f72 5f6d 6574   integer_for_met
-00028b50: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
+00026740: 2063 6f64 5f65 6e74 6974 795f 7461 7267   cod_entity_targ
+00026750: 6574 2c20 3129 0d0a 2020 2020 2020 2020  et, 1)..        
+00026760: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
+00026770: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
+00026780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026790: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+000267a0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+000267b0: 6669 785f 6574 202b 2073 6174 655f 656e  fix_et + sate_en
+000267c0: 7469 7479 5f6a 6f69 6e2c 2074 6e2e 636f  tity_join, tn.co
+000267d0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+000267e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000267f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026800: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00026810: 6566 6978 5f65 7420 2b20 7361 7465 5f65  efix_et + sate_e
+00026820: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
+00026830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026850: 2020 2074 6e2e 636f 6c75 6d6e 5f6e 616d     tn.column_nam
+00026860: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+00026870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026890: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+000268a0: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+000268b0: 696e 616c 5f70 6f73 6974 696f 6e2c 2074  inal_position, t
+000268c0: 6e2e 636f 6c75 6d6e 5f6c 656e 6774 682c  n.column_length,
+000268d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000268e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000268f0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+00026900: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+00026910: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00026920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026930: 2020 2020 2020 2020 2020 2020 2020 322c                2,
+00026940: 204b 4559 5f54 5950 455f 5445 4e41 4e54   KEY_TYPE_TENANT
+00026950: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+00026960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026970: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00026980: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00026990: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+000269a0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+000269b0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
+000269c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000269d0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+000269e0: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+000269f0: 2020 2020 2020 2069 6620 6861 735f 6164         if has_ad
+00026a00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00026a10: 2020 2061 7070 6c69 6564 5f64 6174 6520     applied_date 
+00026a20: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00026a30: 6163 7475 616c 2e67 6574 5f61 7070 6c69  actual.get_appli
+00026a40: 6564 5f64 6174 655f 6f6e 5f64 765f 6672  ed_date_on_dv_fr
+00026a50: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
+00026a60: 7267 6574 2863 6f64 5f65 6e74 6974 795f  rget(cod_entity_
+00026a70: 7461 7267 6574 2c20 3129 0d0a 2020 2020  target, 1)..    
+00026a80: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00026a90: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00026aa0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+00026ab0: 6174 655f 656e 7469 7479 5f6a 6f69 6e2c  ate_entity_join,
+00026ac0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+00026ad0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00026ae0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00026af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b00: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00026b10: 5f65 7420 2b20 7361 7465 5f65 6e74 6974  _et + sate_entit
+00026b20: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+00026b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b40: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00026b50: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+00026b60: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00026b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b90: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+00026ba0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00026bb0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00026bc0: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
+00026bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026be0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00026bf0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00026c00: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+00026c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c30: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
+00026c40: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+00026c50: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00026c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c70: 2020 2020 2020 2020 2020 322c 204b 4559            2, KEY
+00026c80: 5f54 5950 455f 4150 504c 4945 445f 4441  _TYPE_APPLIED_DA
+00026c90: 5445 2c20 312c 2073 656c 662e 6f77 6e65  TE, 1, self.owne
+00026ca0: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00026cb0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00026cc0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+00026cd0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00026ce0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00026cf0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00026d00: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00026d10: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00026d20: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00026d30: 206e 6577 5f66 696c 7465 7220 3d20 5b70   new_filter = [p
+00026d40: 7265 6669 785f 6574 202b 2073 6174 655f  refix_et + sate_
+00026d50: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+00026d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026d70: 2020 2068 6173 685f 6e61 6d65 202b 2027     hash_name + '
+00026d80: 203c 3e20 2720 2b20 6861 7368 5f6e 616d   <> ' + hash_nam
+00026d90: 6520 2b20 275f 4849 5354 272c 2032 2c20  e + '_HIST', 2, 
+00026da0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+00026db0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00026dc0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+00026dd0: 645f 656e 7472 795f 6669 6c74 6572 7328  d_entry_filters(
+00026de0: 5b6e 6577 5f66 696c 7465 725d 290d 0a0d  [new_filter])...
+00026df0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00026e00: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
+00026e10: 655f 6e61 6d65 2c20 2246 696e 6973 6865  e_name, "Finishe
+00026e20: 6420 746f 2070 726f 6365 7373 204d 6574  d to process Met
+00026e30: 6164 6174 6120 5b20 4566 6665 6374 6976  adata [ Effectiv
+00026e40: 6974 7920 5361 7465 6c6c 6974 6520 5d20  ity Satellite ] 
+00026e50: 696e 666f 726d 6174 696f 6e22 2c20 4c4f  information", LO
+00026e60: 475f 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47  G_LEVEL_ONLY_LOG
+00026e70: 290d 0a0d 0a20 2020 2064 6566 2070 726f  )....    def pro
+00026e80: 6365 7373 5f64 765f 7374 7328 7365 6c66  cess_dv_sts(self
+00026e90: 2c20 6476 5f65 6e74 6974 7929 3a0d 0a20  , dv_entity):.. 
+00026ea0: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
+00026eb0: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
+00026ec0: 6e61 6d65 2c20 2253 7461 7274 696e 6720  name, "Starting 
+00026ed0: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
+00026ee0: 6174 6120 5b20 5374 6174 7573 2054 7261  ata [ Status Tra
+00026ef0: 636b 696e 6720 5361 7465 6c6c 6974 6520  cking Satellite 
+00026f00: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+00026f10: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+00026f20: 4f47 290d 0a0d 0a20 2020 2020 2020 206f  OG)....        o
+00026f30: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00026f40: 3d20 310d 0a20 2020 2020 2020 2070 7265  = 1..        pre
+00026f50: 6669 785f 6574 203d 2027 4554 5f27 0d0a  fix_et = 'ET_'..
+00026f60: 2020 2020 2020 2020 7374 735f 6e61 6d65          sts_name
+00026f70: 203d 2064 765f 656e 7469 7479 2e6e 616d   = dv_entity.nam
+00026f80: 655f 7374 6174 7573 5f74 7261 636b 696e  e_status_trackin
+00026f90: 675f 7361 7465 6c6c 6974 650d 0a20 2020  g_satellite..   
+00026fa0: 2020 2020 2073 7473 5f65 6e74 6974 795f       sts_entity_
+00026fb0: 6163 7475 616c 5f69 6d61 6765 5f31 203d  actual_image_1 =
+00026fc0: 2027 5354 475f 544d 505f 4c41 5354 5f49   'STG_TMP_LAST_I
+00026fd0: 4d41 4745 5f31 5f27 202b 2073 7473 5f6e  MAGE_1_' + sts_n
+00026fe0: 616d 650d 0a20 2020 2020 2020 2073 7473  ame..        sts
+00026ff0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+00027000: 6d61 6765 5f32 203d 2027 5354 475f 544d  mage_2 = 'STG_TM
+00027010: 505f 4c41 5354 5f49 4d41 4745 5f32 5f27  P_LAST_IMAGE_2_'
+00027020: 202b 2073 7473 5f6e 616d 650d 0a20 2020   + sts_name..   
+00027030: 2020 2020 2073 7473 5f65 6e74 6974 795f       sts_entity_
+00027040: 756e 696f 6e5f 736f 7572 6365 7320 3d20  union_sources = 
+00027050: 2753 5447 5f54 4d50 5f55 4e49 4f4e 5f27  'STG_TMP_UNION_'
+00027060: 202b 2073 7473 5f6e 616d 650d 0a20 2020   + sts_name..   
+00027070: 2020 2020 2073 7473 5f65 6e74 6974 795f       sts_entity_
+00027080: 6a6f 696e 203d 2027 5354 475f 544d 505f  join = 'STG_TMP_
+00027090: 4a4f 494e 5f27 202b 2073 7473 5f6e 616d  JOIN_' + sts_nam
+000270a0: 650d 0a20 2020 2020 2020 2073 7473 5f65  e..        sts_e
+000270b0: 6e74 6974 7920 3d20 7374 735f 6e61 6d65  ntity = sts_name
+000270c0: 0d0a 2020 2020 2020 2020 636f 645f 656e  ..        cod_en
+000270d0: 7469 7479 5f74 6172 6765 7420 3d20 6476  tity_target = dv
+000270e0: 5f65 6e74 6974 792e 636f 645f 656e 7469  _entity.cod_enti
+000270f0: 7479 0d0a 0d0a 2020 2020 2020 2020 6861  ty....        ha
+00027100: 7368 5f6e 616d 6520 3d20 2748 4153 485f  sh_name = 'HASH_
+00027110: 2720 2b20 6476 5f65 6e74 6974 792e 656e  ' + dv_entity.en
+00027120: 7469 7479 5f6e 616d 650d 0a20 2020 2020  tity_name..     
+00027130: 2020 2064 765f 7072 6f70 6572 7479 203d     dv_property =
+00027140: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00027150: 6374 7561 6c2e 6765 745f 6476 5f70 726f  ctual.get_dv_pro
+00027160: 7065 7274 6965 735f 6672 6f6d 5f63 6f64  perties_from_cod
+00027170: 5f65 6e74 6974 795f 616e 645f 6e75 6d5f  _entity_and_num_
+00027180: 636f 6e6e 6563 7469 6f6e 2864 765f 656e  connection(dv_en
+00027190: 7469 7479 2e63 6f64 5f65 6e74 6974 792c  tity.cod_entity,
+000271a0: 2030 290d 0a20 2020 2020 2020 2069 6620   0)..        if 
+000271b0: 6476 5f70 726f 7065 7274 7920 6973 206e  dv_property is n
+000271c0: 6f74 204e 6f6e 653a 2068 6173 685f 6e61  ot None: hash_na
+000271d0: 6d65 203d 2064 765f 7072 6f70 6572 7479  me = dv_property
+000271e0: 2e68 6173 685f 6e61 6d65 0d0a 0d0a 2020  .hash_name....  
+000271f0: 2020 2020 2020 6966 2073 7473 5f6e 616d        if sts_nam
+00027200: 6520 6973 204e 6f6e 6520 6f72 2073 7473  e is None or sts
+00027210: 5f6e 616d 6520 3d3d 2027 273a 2072 6574  _name == '': ret
+00027220: 7572 6e0d 0a0d 0a20 2020 2020 2020 206e  urn....        n
+00027230: 6577 5f65 6e74 6974 795f 7374 735f 656e  ew_entity_sts_en
+00027240: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+00027250: 655f 3120 3d20 5b70 7265 6669 785f 6574  e_1 = [prefix_et
+00027260: 202b 2073 7473 5f65 6e74 6974 795f 6163   + sts_entity_ac
+00027270: 7475 616c 5f69 6d61 6765 5f31 2c20 7374  tual_image_1, st
+00027280: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+00027290: 696d 6167 655f 312c 2045 4e54 4954 595f  image_1, ENTITY_
+000272a0: 5749 5448 2c20 6476 5f65 6e74 6974 792e  WITH, dv_entity.
+000272b0: 636f 645f 7061 7468 2c20 2727 2c20 7365  cod_path, '', se
+000272c0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+000272d0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+000272e0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+000272f0: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
+00027300: 7469 7479 5f73 7473 5f65 6e74 6974 795f  tity_sts_entity_
+00027310: 6163 7475 616c 5f69 6d61 6765 5f31 5d29  actual_image_1])
+00027320: 0d0a 2020 2020 2020 2020 6e65 775f 656e  ..        new_en
+00027330: 7469 7479 5f73 7473 5f65 6e74 6974 795f  tity_sts_entity_
+00027340: 6163 7475 616c 5f69 6d61 6765 5f32 203d  actual_image_2 =
+00027350: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+00027360: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+00027370: 696d 6167 655f 322c 2073 7473 5f65 6e74  image_2, sts_ent
+00027380: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+00027390: 5f32 2c20 454e 5449 5459 5f57 4954 482c  _2, ENTITY_WITH,
+000273a0: 2064 765f 656e 7469 7479 2e63 6f64 5f70   dv_entity.cod_p
+000273b0: 6174 682c 2027 272c 2073 656c 662e 6f77  ath, '', self.ow
+000273c0: 6e65 725d 0d0a 2020 2020 2020 2020 7365  ner]..        se
+000273d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000273e0: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
+000273f0: 6974 7928 5b6e 6577 5f65 6e74 6974 795f  ity([new_entity_
+00027400: 7374 735f 656e 7469 7479 5f61 6374 7561  sts_entity_actua
+00027410: 6c5f 696d 6167 655f 325d 290d 0a20 2020  l_image_2])..   
+00027420: 2020 2020 206e 6577 5f65 6e74 6974 795f       new_entity_
+00027430: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
+00027440: 5f73 6f75 7263 6573 203d 205b 7072 6566  _sources = [pref
+00027450: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+00027460: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+00027470: 2c20 7374 735f 656e 7469 7479 5f75 6e69  , sts_entity_uni
+00027480: 6f6e 5f73 6f75 7263 6573 2c20 454e 5449  on_sources, ENTI
+00027490: 5459 5f57 4954 482c 2064 765f 656e 7469  TY_WITH, dv_enti
+000274a0: 7479 2e63 6f64 5f70 6174 682c 2027 272c  ty.cod_path, '',
+000274b0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+000274c0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+000274d0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+000274e0: 6e74 7279 5f65 6e74 6974 7928 5b6e 6577  ntry_entity([new
+000274f0: 5f65 6e74 6974 795f 7374 735f 656e 7469  _entity_sts_enti
+00027500: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+00027510: 5d29 0d0a 2020 2020 2020 2020 6e65 775f  ])..        new_
+00027520: 656e 7469 7479 5f73 7473 5f65 6e74 6974  entity_sts_entit
+00027530: 795f 6a6f 696e 203d 205b 7072 6566 6978  y_join = [prefix
+00027540: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+00027550: 5f6a 6f69 6e2c 2073 7473 5f65 6e74 6974  _join, sts_entit
+00027560: 795f 6a6f 696e 2c20 454e 5449 5459 5f57  y_join, ENTITY_W
+00027570: 4954 482c 2064 765f 656e 7469 7479 2e63  ITH, dv_entity.c
+00027580: 6f64 5f70 6174 682c 2027 272c 2073 656c  od_path, '', sel
+00027590: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000275a0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+000275b0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+000275c0: 5f65 6e74 6974 7928 5b6e 6577 5f65 6e74  _entity([new_ent
+000275d0: 6974 795f 7374 735f 656e 7469 7479 5f6a  ity_sts_entity_j
+000275e0: 6f69 6e5d 290d 0a20 2020 2020 2020 206e  oin])..        n
+000275f0: 6577 5f65 6e74 6974 795f 7374 735f 656e  ew_entity_sts_en
+00027600: 7469 7479 203d 205b 7072 6566 6978 5f65  tity = [prefix_e
+00027610: 7420 2b20 7374 735f 656e 7469 7479 2c20  t + sts_entity, 
+00027620: 7374 735f 656e 7469 7479 2c20 454e 5449  sts_entity, ENTI
+00027630: 5459 5f54 422c 2064 765f 656e 7469 7479  TY_TB, dv_entity
+00027640: 2e63 6f64 5f70 6174 682c 2027 494e 5345  .cod_path, 'INSE
+00027650: 5254 272c 2073 656c 662e 6f77 6e65 725d  RT', self.owner]
+00027660: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+00027670: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+00027680: 6464 5f65 6e74 7279 5f65 6e74 6974 7928  dd_entry_entity(
+00027690: 5b6e 6577 5f65 6e74 6974 795f 7374 735f  [new_entity_sts_
+000276a0: 656e 7469 7479 5d29 0d0a 0d0a 2020 2020  entity])....    
+000276b0: 2020 2020 6861 735f 7273 203d 2046 616c      has_rs = Fal
+000276c0: 7365 0d0a 2020 2020 2020 2020 6861 735f  se..        has_
+000276d0: 746e 203d 2046 616c 7365 0d0a 2020 2020  tn = False..    
+000276e0: 2020 2020 6861 735f 6164 203d 2046 616c      has_ad = Fal
+000276f0: 7365 0d0a 0d0a 2020 2020 2020 2020 2323  se....        ##
+00027700: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027720: 2323 2320 556e 696f 6e20 616c 6c20 736f  ### Union all so
+00027730: 7572 6365 7320 2323 2323 2323 2323 2323  urces ##########
+00027740: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00027750: 2323 2323 2323 2323 2323 230d 0a20 2020  ###########..   
+00027760: 2020 2020 2061 6c6c 5f73 6f75 7263 6573       all_sources
+00027770: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+00027780: 5f61 6374 7561 6c2e 6765 745f 616c 6c5f  _actual.get_all_
+00027790: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
+000277a0: 655f 6672 6f6d 5f63 6f64 5f65 6e74 6974  e_from_cod_entit
+000277b0: 795f 7461 7267 6574 5f6f 6e5f 656e 7472  y_target_on_entr
+000277c0: 795f 6476 2863 6f64 5f65 6e74 6974 795f  y_dv(cod_entity_
+000277d0: 7461 7267 6574 290d 0a20 2020 2020 2020  target)..       
+000277e0: 2074 656e 616e 745f 736f 7572 6365 203d   tenant_source =
+000277f0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00027800: 6374 7561 6c2e 6765 745f 7465 6e61 6e74  ctual.get_tenant
+00027810: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
+00027820: 656e 7469 7479 5f74 6172 6765 745f 616e  entity_target_an
+00027830: 645f 6e75 6d5f 6272 616e 6368 2863 6f64  d_num_branch(cod
+00027840: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
+00027850: 3129 0d0a 2020 2020 2020 2020 6966 206c  1)..        if l
+00027860: 656e 2874 656e 616e 745f 736f 7572 6365  en(tenant_source
+00027870: 2920 213d 2030 3a20 6861 735f 746e 203d  ) != 0: has_tn =
+00027880: 2054 7275 650d 0a20 2020 2020 2020 2072   True..        r
+00027890: 6563 6f72 645f 736f 7572 6365 203d 2073  ecord_source = s
+000278a0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+000278b0: 7561 6c2e 6765 745f 7265 636f 7264 5f73  ual.get_record_s
+000278c0: 6f75 7263 655f 6f6e 5f64 765f 6672 6f6d  ource_on_dv_from
+000278d0: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
+000278e0: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
+000278f0: 6828 636f 645f 656e 7469 7479 5f74 6172  h(cod_entity_tar
+00027900: 6765 742c 2031 290d 0a20 2020 2020 2020  get, 1)..       
+00027910: 2069 6620 7265 636f 7264 5f73 6f75 7263   if record_sourc
+00027920: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
+00027930: 6173 5f72 7320 3d20 5472 7565 0d0a 2020  as_rs = True..  
+00027940: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+00027950: 7465 203d 2073 656c 662e 6d65 7461 6461  te = self.metada
+00027960: 7461 5f61 6374 7561 6c2e 6765 745f 6170  ta_actual.get_ap
+00027970: 706c 6965 645f 6461 7465 5f6f 6e5f 6476  plied_date_on_dv
+00027980: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+00027990: 5f74 6172 6765 7428 6476 5f65 6e74 6974  _target(dv_entit
+000279a0: 792e 636f 645f 656e 7469 7479 2c20 3129  y.cod_entity, 1)
+000279b0: 0d0a 2020 2020 2020 2020 6966 2061 7070  ..        if app
+000279c0: 6c69 6564 5f64 6174 6520 6973 206e 6f74  lied_date is not
+000279d0: 204e 6f6e 653a 2068 6173 5f61 6420 3d20   None: has_ad = 
+000279e0: 5472 7565 0d0a 0d0a 0d0a 2020 2020 2020  True......      
+000279f0: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+00027a00: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+00027a10: 6374 696f 6e2e 6765 745f 6861 7368 5f66  ction.get_hash_f
+00027a20: 6f72 5f6d 6574 6164 6174 6128 290d 0a0d  or_metadata()...
+00027a30: 0a20 2020 2020 2020 206e 756d 5f62 7261  .        num_bra
+00027a40: 6e63 6865 7320 3d20 7365 6c66 2e6d 6574  nches = self.met
+00027a50: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+00027a60: 5f6e 756d 5f62 7261 6e63 6865 735f 6f6e  _num_branches_on
+00027a70: 5f65 6e74 7279 5f64 765f 6672 6f6d 5f63  _entry_dv_from_c
+00027a80: 6f64 5f65 6e74 6974 795f 6e61 6d65 2864  od_entity_name(d
+00027a90: 765f 656e 7469 7479 2e63 6f64 5f65 6e74  v_entity.cod_ent
+00027aa0: 6974 7929 0d0a 0d0a 2020 2020 2020 2020  ity)....        
+00027ab0: 666f 7220 6e75 6d5f 6272 616e 6368 2069  for num_branch i
+00027ac0: 6e20 7261 6e67 6528 312c 206e 756d 5f62  n range(1, num_b
+00027ad0: 7261 6e63 6865 7320 2b20 3129 3a0d 0a20  ranches + 1):.. 
+00027ae0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+00027af0: 5f64 765f 6d61 7070 696e 675f 626b 203d  _dv_mapping_bk =
+00027b00: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00027b10: 6374 7561 6c2e 6765 745f 616c 6c5f 626b  ctual.get_all_bk
+00027b20: 5f66 726f 6d5f 656e 7472 795f 6476 5f63  _from_entry_dv_c
+00027b30: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+00027b40: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
+00027b50: 6476 5f65 6e74 6974 792e 636f 645f 656e  dv_entity.cod_en
+00027b60: 7469 7479 2c20 6e75 6d5f 6272 616e 6368  tity, num_branch
+00027b70: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00027b80: 6e74 7279 5f64 765f 6d61 7070 696e 675f  ntry_dv_mapping_
+00027b90: 626b 2e73 6f72 7428 6b65 793d 6c61 6d62  bk.sort(key=lamb
+00027ba0: 6461 2078 3a20 782e 6f72 6469 6e61 6c5f  da x: x.ordinal_
+00027bb0: 706f 7369 7469 6f6e 290d 0a20 2020 2020  position)..     
+00027bc0: 2020 2020 2020 2063 6f64 5f65 6e74 6974         cod_entit
+00027bd0: 795f 736f 7572 6365 203d 2065 6e74 7279  y_source = entry
+00027be0: 5f64 765f 6d61 7070 696e 675f 626b 5b30  _dv_mapping_bk[0
+00027bf0: 5d2e 636f 645f 656e 7469 7479 5f73 6f75  ].cod_entity_sou
+00027c00: 7263 650d 0a20 2020 2020 2020 2020 2020  rce..           
+00027c10: 206d 6435 5f66 756e 6374 696f 6e20 3d20   md5_function = 
+00027c20: 7365 6c66 2e67 6574 5f68 6173 685f 6b65  self.get_hash_ke
+00027c30: 795f 6672 6f6d 5f63 6f64 5f65 6e74 6974  y_from_cod_entit
+00027c40: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
+00027c50: 5f62 7261 6e63 6828 636f 645f 656e 7469  _branch(cod_enti
+00027c60: 7479 5f74 6172 6765 742c 206e 756d 5f62  ty_target, num_b
+00027c70: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
+00027c80: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00027c90: 6d61 7070 696e 6720 3d20 5b63 6f64 5f65  mapping = [cod_e
+00027ca0: 6e74 6974 795f 736f 7572 6365 2c20 6d64  ntity_source, md
+00027cb0: 355f 6675 6e63 7469 6f6e 2c20 7072 6566  5_function, pref
+00027cc0: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+00027cd0: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+00027ce0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00027cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d00: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+00027d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00027d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d30: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00027d40: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00027d50: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+00027d60: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+00027d70: 5d2c 2068 6173 685f 666f 725f 6d65 7461  ], hash_for_meta
+00027d80: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
+00027d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027da0: 2020 2020 2020 2020 2020 2020 206e 756d               num
+00027db0: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+00027dc0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+00027dd0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00027de0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00027df0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00027e00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00027e10: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00027e20: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00027e30: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00027e40: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00027e50: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00027e60: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00027e70: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
+00027e80: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+00027e90: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00027ea0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00027eb0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00027ec0: 696e 6720 3d20 5b27 272c 2073 656c 662e  ing = ['', self.
+00027ed0: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+00027ee0: 7973 6461 7465 5f76 616c 7565 2829 2c20  ysdate_value(), 
+00027ef0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+00027f00: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+00027f10: 7263 6573 2c0d 0a20 2020 2020 2020 2020  rces,..         
+00027f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f30: 2020 2020 2020 2020 2020 2744 4154 455f            'DATE_
+00027f40: 4352 4541 5445 4427 2c0d 0a20 2020 2020  CREATED',..     
+00027f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f60: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00027f70: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+00027f80: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00027f90: 6f73 6974 696f 6e2c 2073 7973 6461 7465  osition, sysdate
+00027fa0: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+00027fb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00027fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027fd0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
+00027fe0: 725f 6d65 7461 6461 7461 5b32 5d2c 206e  r_metadata[2], n
+00027ff0: 756d 5f62 7261 6e63 682c 204e 6f6e 652c  um_branch, None,
+00028000: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00028010: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00028020: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00028030: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00028040: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00028050: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00028060: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+00028070: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00028080: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+00028090: 2020 2020 2020 6966 2068 6173 5f72 733a        if has_rs:
+000280a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000280b0: 2020 7265 636f 7264 5f73 6f75 7263 6520    record_source 
+000280c0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+000280d0: 6163 7475 616c 2e67 6574 5f72 6563 6f72  actual.get_recor
+000280e0: 645f 736f 7572 6365 5f6f 6e5f 6476 5f66  d_source_on_dv_f
+000280f0: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
+00028100: 6172 6765 745f 616e 645f 6e75 6d5f 6272  arget_and_num_br
+00028110: 616e 6368 2863 6f64 5f65 6e74 6974 795f  anch(cod_entity_
+00028120: 7461 7267 6574 2c20 6e75 6d5f 6272 616e  target, num_bran
+00028130: 6368 290d 0a20 2020 2020 2020 2020 2020  ch)..           
+00028140: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+00028150: 5f6d 6170 7069 6e67 203d 205b 636f 645f  _mapping = [cod_
+00028160: 656e 7469 7479 5f73 6f75 7263 652c 2072  entity_source, r
+00028170: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00028180: 756d 6e5f 6e61 6d65 5f73 6f75 7263 652c  umn_name_source,
+00028190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000281a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281b0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+000281c0: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
+000281d0: 756e 696f 6e5f 736f 7572 6365 732c 0d0a  union_sources,..
+000281e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028200: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00028210: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+00028220: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+00028230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028250: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00028260: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+00028270: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+00028280: 696f 6e2c 2072 6563 6f72 645f 736f 7572  ion, record_sour
+00028290: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
+000282a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000282b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000282c0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+000282d0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f70  _source.column_p
+000282e0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+000282f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028310: 2020 6e75 6d5f 6272 616e 6368 2c20 4b45    num_branch, KE
+00028320: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+00028330: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+00028340: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00028350: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00028360: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00028370: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00028380: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00028390: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+000283a0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+000283b0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000283c0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+000283d0: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+000283e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000283f0: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
+00028400: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00028410: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
+00028420: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+00028430: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+00028440: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
+00028450: 6e74 6974 795f 7461 7267 6574 2c20 6e75  ntity_target, nu
+00028460: 6d5f 6272 616e 6368 290d 0a20 2020 2020  m_branch)..     
+00028470: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00028480: 6e20 696e 2074 656e 616e 745f 736f 7572  n in tenant_sour
+00028490: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+000284a0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+000284b0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+000284c0: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
+000284d0: 652c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  e, tn.column_nam
+000284e0: 655f 736f 7572 6365 2c20 7072 6566 6978  e_source, prefix
+000284f0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+00028500: 5f75 6e69 6f6e 5f73 6f75 7263 6573 2c0d  _union_sources,.
+00028510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028530: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
+00028540: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00028550: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00028560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028570: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00028580: 6e2e 636f 6c75 6d6e 5f74 7970 655f 7461  n.column_type_ta
+00028590: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+000285a0: 7369 7469 6f6e 2c20 746e 2e63 6f6c 756d  sition, tn.colum
+000285b0: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
+000285c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000285d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000285e0: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+000285f0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
+00028600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028620: 2020 2020 2020 206e 756d 5f62 7261 6e63         num_branc
+00028630: 682c 204b 4559 5f54 5950 455f 5445 4e41  h, KEY_TYPE_TENA
+00028640: 4e54 2c20 312c 2073 656c 662e 6f77 6e65  NT, 1, self.owne
+00028650: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00028660: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00028670: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00028680: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00028690: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+000286a0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+000286b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000286c0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+000286d0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+000286e0: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
+000286f0: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
+00028700: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00028710: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+00028720: 615f 6163 7475 616c 2e67 6574 5f61 7070  a_actual.get_app
+00028730: 6c69 6564 5f64 6174 655f 6f6e 5f64 765f  lied_date_on_dv_
+00028740: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+00028750: 7461 7267 6574 2864 765f 656e 7469 7479  target(dv_entity
+00028760: 2e63 6f64 5f65 6e74 6974 792c 206e 756d  .cod_entity, num
+00028770: 5f62 7261 6e63 6829 0d0a 2020 2020 2020  _branch)..      
+00028780: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00028790: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+000287a0: 5b63 6f64 5f65 6e74 6974 795f 736f 7572  [cod_entity_sour
+000287b0: 6365 2c20 6170 706c 6965 645f 6461 7465  ce, applied_date
+000287c0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f73 6f75  .column_name_sou
+000287d0: 7263 652c 0d0a 2020 2020 2020 2020 2020  rce,..          
+000287e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287f0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+00028800: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+00028810: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
+00028820: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00028830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028840: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00028850: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+00028860: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00028870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028890: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+000288a0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+000288b0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+000288c0: 6974 696f 6e2c 2061 7070 6c69 6564 5f64  ition, applied_d
+000288d0: 6174 652e 636f 6c75 6d6e 5f6c 656e 6774  ate.column_lengt
+000288e0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028900: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00028910: 6564 5f64 6174 652e 636f 6c75 6d6e 5f70  ed_date.column_p
+00028920: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+00028930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028950: 2020 6e75 6d5f 6272 616e 6368 2c20 4b45    num_branch, KE
+00028960: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
+00028970: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
+00028980: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00028990: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+000289a0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+000289b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000289c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+000289d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+000289e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+000289f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00028a00: 5d29 0d0a 0d0a 2020 2020 2020 2020 2323  ])....        ##
+00028a10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028a20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028a30: 2323 2320 4c41 5354 2049 4d41 4745 2023  ### LAST IMAGE #
+00028a40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028a50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00028a60: 2323 2323 0d0a 2020 2020 2020 2020 696e  ####..        in
+00028a70: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
+00028a80: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
+00028a90: 7469 6f6e 2e67 6574 5f69 6e74 6567 6572  tion.get_integer
+00028aa0: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
+00028ab0: 0a20 2020 2020 2020 2023 204c 6173 7420  .        # Last 
+00028ac0: 496d 6167 6520 310d 0a20 2020 2020 2020  Image 1..       
+00028ad0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00028ae0: 6e20 3d20 310d 0a20 2020 2020 2020 206e  n = 1..        n
+00028af0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00028b00: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+00028b10: 2b20 7374 735f 656e 7469 7479 2c20 6861  + sts_entity, ha
+00028b20: 7368 5f6e 616d 652c 2070 7265 6669 785f  sh_name, prefix_
+00028b30: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
+00028b40: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
+00028b50: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
 00028b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b70: 2020 2020 2020 2020 2020 696e 7465 6765            intege
-00028b80: 725f 666f 725f 6d65 7461 6461 7461 5b32  r_for_metadata[2
-00028b90: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00028ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028bb0: 2020 2031 2c20 4b45 595f 5459 5045 5f4e     1, KEY_TYPE_N
-00028bc0: 554c 4c2c 2031 2c20 7365 6c66 2e6f 776e  ULL, 1, self.own
-00028bd0: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
-00028be0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00028bf0: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
-00028c00: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00028c10: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00028c20: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00028c30: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00028c40: 5d29 0d0a 0d0a 2020 2020 2020 2020 6966  ])....        if
-00028c50: 2068 6173 5f72 733a 0d0a 2020 2020 2020   has_rs:..      
-00028c60: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00028c70: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
-00028c80: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
-00028c90: 6563 6f72 645f 736f 7572 6365 5f6f 6e5f  ecord_source_on_
-00028ca0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
-00028cb0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
-00028cc0: 6d5f 6272 616e 6368 2863 6f64 5f65 6e74  m_branch(cod_ent
-00028cd0: 6974 795f 7461 7267 6574 2c20 3129 0d0a  ity_target, 1)..
-00028ce0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00028cf0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00028d00: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00028d10: 7473 5f65 6e74 6974 792c 2072 6563 6f72  ts_entity, recor
-00028d20: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00028d30: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00028d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b70: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00028b80: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+00028b90: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00028ba0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
+00028bb0: 6461 7461 5b31 5d2c 2068 6173 685f 666f  data[1], hash_fo
+00028bc0: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
+00028bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028be0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+00028bf0: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
+00028c00: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
+00028c10: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
+00028c20: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+00028c30: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+00028c40: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00028c50: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00028c60: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+00028c70: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00028c80: 5d29 0d0a 0d0a 2020 2020 2020 2020 7661  ])....        va
+00028c90: 7263 6861 725f 666f 725f 6d65 7461 6461  rchar_for_metada
+00028ca0: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
+00028cb0: 7469 6f6e 2e67 6574 5f73 7472 696e 675f  tion.get_string_
+00028cc0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+00028cd0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00028ce0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00028cf0: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+00028d00: 6e74 6974 792c 2027 4456 5f53 5441 5455  ntity, 'DV_STATU
+00028d10: 5327 2c20 7072 6566 6978 5f65 7420 2b20  S', prefix_et + 
+00028d20: 7374 735f 656e 7469 7479 5f61 6374 7561  sts_entity_actua
+00028d30: 6c5f 696d 6167 655f 312c 2027 4456 5f53  l_image_1, 'DV_S
+00028d40: 5441 5455 5327 2c0d 0a20 2020 2020 2020  TATUS',..       
 00028d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d60: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
-00028d70: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-00028d80: 6d61 6765 5f31 2c0d 0a20 2020 2020 2020  mage_1,..       
-00028d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028da0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00028db0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-00028dc0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00028dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028df0: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-00028e00: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-00028e10: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-00028e20: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
-00028e30: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-00028e40: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00028e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e60: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-00028e70: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-00028e80: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+00028d60: 2020 2020 2020 2020 7661 7263 6861 725f          varchar_
+00028d70: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+00028d80: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00028d90: 6e2c 2031 2c20 302c 0d0a 2020 2020 2020  n, 1, 0,..      
+00028da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028db0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
+00028dc0: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+00028dd0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00028de0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00028df0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+00028e00: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00028e10: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00028e20: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00028e30: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00028e40: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00028e50: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00028e60: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00028e70: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+00028e80: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
 00028e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ea0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-00028eb0: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
-00028ec0: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
-00028ed0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00028ee0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00028ef0: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-00028f00: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00028f10: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-00028f20: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-00028f30: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-00028f40: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-00028f50: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
-00028f60: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-00028f70: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
-00028f80: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00028f90: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
-00028fa0: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
-00028fb0: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
-00028fc0: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
-00028fd0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
-00028fe0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00028ff0: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
-00029000: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
-00029010: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00029020: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00029030: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-00029040: 6e74 6974 792c 2074 6e2e 636f 6c75 6d6e  ntity, tn.column
-00029050: 5f6e 616d 655f 7461 7267 6574 2c20 7072  _name_target, pr
-00029060: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-00029070: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-00029080: 655f 312c 0d0a 2020 2020 2020 2020 2020  e_1,..          
-00029090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290a0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
-000290b0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-000290c0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-000290d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290e0: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-000290f0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00029100: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00029110: 696f 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c  ion, tn.column_l
-00029120: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-00029130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029140: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00029150: 6e2e 636f 6c75 6d6e 5f70 7265 6369 7369  n.column_precisi
-00029160: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-00029170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029180: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-00029190: 4559 5f54 5950 455f 5445 4e41 4e54 2c20  EY_TYPE_TENANT, 
-000291a0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-000291b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291c0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-000291d0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-000291e0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-000291f0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-00029200: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
-00029210: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00029220: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00029230: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
-00029240: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00029250: 2061 7070 6c69 6564 5f64 6174 6520 3d20   applied_date = 
-00029260: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00029270: 7475 616c 2e67 6574 5f61 7070 6c69 6564  tual.get_applied
-00029280: 5f64 6174 655f 6f6e 5f64 765f 6672 6f6d  _date_on_dv_from
-00029290: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
-000292a0: 6574 2864 765f 656e 7469 7479 2e63 6f64  et(dv_entity.cod
-000292b0: 5f65 6e74 6974 792c 2031 290d 0a20 2020  _entity, 1)..   
-000292c0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-000292d0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-000292e0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-000292f0: 656e 7469 7479 2c20 6170 706c 6965 645f  entity, applied_
-00029300: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-00029310: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-00029320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029330: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00029340: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-00029350: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-00029360: 5f31 2c0d 0a20 2020 2020 2020 2020 2020  _1,..           
-00029370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029380: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
-00029390: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-000293a0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-000293b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000293c0: 2020 2020 2020 2020 2020 2020 2061 7070               app
-000293d0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-000293e0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-000293f0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-00029400: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00029410: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-00029420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029440: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00029450: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-00029460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029480: 2020 2031 2c20 4b45 595f 5459 5045 5f41     1, KEY_TYPE_A
-00029490: 5050 4c49 4544 5f44 4154 452c 2031 2c20  PPLIED_DATE, 1, 
-000294a0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-000294b0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-000294c0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000294d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000294e0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000294f0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00029500: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00029510: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00029520: 5d29 0d0a 0d0a 2020 2020 2020 2020 2320  ])....        # 
-00029530: 4c61 7374 2049 6d61 6765 2032 0d0a 2020  Last Image 2..  
-00029540: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00029550: 7369 7469 6f6e 203d 2031 0d0a 2020 2020  sition = 1..    
-00029560: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00029570: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00029580: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-00029590: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
-000295a0: 2c20 6861 7368 5f6e 616d 652c 0d0a 2020  , hash_name,..  
-000295b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000295c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-000295d0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-000295e0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-000295f0: 5f32 2c0d 0a20 2020 2020 2020 2020 2020  _2,..           
-00029600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029610: 2020 2020 6861 7368 5f6e 616d 652c 0d0a      hash_name,..
-00029620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029630: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00029640: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-00029650: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-00029660: 6974 696f 6e2c 2068 6173 685f 666f 725f  ition, hash_for_
-00029670: 6d65 7461 6461 7461 5b31 5d2c 2068 6173  metadata[1], has
-00029680: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
-00029690: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-000296a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000296b0: 2020 2031 2c20 4b45 595f 5459 5045 5f48     1, KEY_TYPE_H
-000296c0: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
-000296d0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-000296e0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-000296f0: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-00029700: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00029710: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-00029720: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-00029730: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-00029740: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
-00029750: 2020 7661 7263 6861 725f 666f 725f 6d65    varchar_for_me
-00029760: 7461 6461 7461 203d 2073 656c 662e 636f  tadata = self.co
-00029770: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7472  nnection.get_str
-00029780: 696e 675f 666f 725f 6d65 7461 6461 7461  ing_for_metadata
-00029790: 2829 0d0a 2020 2020 2020 2020 6e65 775f  ()..        new_
-000297a0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-000297b0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-000297c0: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-000297d0: 5f69 6d61 6765 5f31 2c20 2744 565f 5354  _image_1, 'DV_ST
-000297e0: 4154 5553 272c 2070 7265 6669 785f 6574  ATUS', prefix_et
-000297f0: 202b 2073 7473 5f65 6e74 6974 795f 6163   + sts_entity_ac
-00029800: 7475 616c 5f69 6d61 6765 5f32 2c20 2744  tual_image_2, 'D
-00029810: 565f 5354 4154 5553 272c 0d0a 2020 2020  V_STATUS',..    
-00029820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029830: 2020 2020 2020 2020 2020 2076 6172 6368             varch
-00029840: 6172 5f66 6f72 5f6d 6574 6164 6174 615b  ar_for_metadata[
-00029850: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-00029860: 7469 6f6e 2c20 312c 2030 2c0d 0a20 2020  tion, 1, 0,..   
+00028ea0: 2020 2020 2020 2027 524f 575f 4e55 4d42         'ROW_NUMB
+00028eb0: 4552 2829 206f 7665 7220 2870 6172 7469  ER() over (parti
+00028ec0: 7469 6f6e 2062 7920 2720 2b20 6861 7368  tion by ' + hash
+00028ed0: 5f6e 616d 6520 2b20 2720 4f52 4445 5220  _name + ' ORDER 
+00028ee0: 4259 2044 4154 455f 4352 4541 5445 4420  BY DATE_CREATED 
+00028ef0: 6465 7363 2927 2c0d 0a20 2020 2020 2020  desc)',..       
+00028f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f10: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00028f20: 7420 2b20 7374 735f 656e 7469 7479 5f61  t + sts_entity_a
+00028f30: 6374 7561 6c5f 696d 6167 655f 312c 2027  ctual_image_1, '
+00028f40: 524e 272c 0d0a 2020 2020 2020 2020 2020  RN',..          
+00028f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f60: 2020 2020 2069 6e74 6567 6572 5f66 6f72       integer_for
+00028f70: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00028f80: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00028f90: 696e 7465 6765 725f 666f 725f 6d65 7461  integer_for_meta
+00028fa0: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+00028fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028fc0: 2020 2020 2020 2020 2069 6e74 6567 6572           integer
+00028fd0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00028fe0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00028ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029000: 2020 312c 204b 4559 5f54 5950 455f 4e55    1, KEY_TYPE_NU
+00029010: 4c4c 2c20 312c 2073 656c 662e 6f77 6e65  LL, 1, self.owne
+00029020: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
+00029030: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00029040: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00029050: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00029060: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00029070: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00029080: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00029090: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+000290a0: 6861 735f 7273 3a0d 0a20 2020 2020 2020  has_rs:..       
+000290b0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+000290c0: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
+000290d0: 7461 5f61 6374 7561 6c2e 6765 745f 7265  ta_actual.get_re
+000290e0: 636f 7264 5f73 6f75 7263 655f 6f6e 5f64  cord_source_on_d
+000290f0: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
+00029100: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
+00029110: 5f62 7261 6e63 6828 636f 645f 656e 7469  _branch(cod_enti
+00029120: 7479 5f74 6172 6765 742c 2031 290d 0a20  ty_target, 1).. 
+00029130: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00029140: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00029150: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+00029160: 735f 656e 7469 7479 2c20 7265 636f 7264  s_entity, record
+00029170: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
+00029180: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00029190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291b0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+000291c0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+000291d0: 6167 655f 312c 0d0a 2020 2020 2020 2020  age_1,..        
+000291e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291f0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00029200: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+00029210: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+00029220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029240: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00029250: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+00029260: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+00029270: 696f 6e2c 2072 6563 6f72 645f 736f 7572  ion, record_sour
+00029280: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
+00029290: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000292a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292b0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+000292c0: 7263 652e 636f 6c75 6d6e 5f70 7265 6369  rce.column_preci
+000292d0: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+000292e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292f0: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+00029300: 5f54 5950 455f 5245 434f 5244 5f53 4f55  _TYPE_RECORD_SOU
+00029310: 5243 452c 2031 2c20 7365 6c66 2e6f 776e  RCE, 1, self.own
+00029320: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00029330: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00029340: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+00029350: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00029360: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00029370: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00029380: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00029390: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+000293a0: 2020 2020 2020 6966 2068 6173 5f74 6e3a        if has_tn:
+000293b0: 0d0a 2020 2020 2020 2020 2020 2020 7465  ..            te
+000293c0: 6e61 6e74 5f73 6f75 7263 6520 3d20 7365  nant_source = se
+000293d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000293e0: 616c 2e67 6574 5f74 656e 616e 745f 6f6e  al.get_tenant_on
+000293f0: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
+00029400: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
+00029410: 756d 5f62 7261 6e63 6828 636f 645f 656e  um_branch(cod_en
+00029420: 7469 7479 5f74 6172 6765 742c 2031 290d  tity_target, 1).
+00029430: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00029440: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
+00029450: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
+00029460: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+00029470: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+00029480: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+00029490: 7469 7479 2c20 746e 2e63 6f6c 756d 6e5f  tity, tn.column_
+000294a0: 6e61 6d65 5f74 6172 6765 742c 2070 7265  name_target, pre
+000294b0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+000294c0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+000294d0: 5f31 2c0d 0a20 2020 2020 2020 2020 2020  _1,..           
+000294e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000294f0: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
+00029500: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00029510: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00029520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029530: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+00029540: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+00029550: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00029560: 6f6e 2c20 746e 2e63 6f6c 756d 6e5f 6c65  on, tn.column_le
+00029570: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
+00029580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029590: 2020 2020 2020 2020 2020 2020 2020 746e                tn
+000295a0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+000295b0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000295c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000295d0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+000295e0: 595f 5459 5045 5f54 454e 414e 542c 2031  Y_TYPE_TENANT, 1
+000295f0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00029600: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00029610: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00029620: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+00029630: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+00029640: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00029650: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
+00029660: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00029670: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00029680: 2020 2020 2020 2020 6966 2068 6173 5f61          if has_a
+00029690: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+000296a0: 6170 706c 6965 645f 6461 7465 203d 2073  applied_date = s
+000296b0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+000296c0: 7561 6c2e 6765 745f 6170 706c 6965 645f  ual.get_applied_
+000296d0: 6461 7465 5f6f 6e5f 6476 5f66 726f 6d5f  date_on_dv_from_
+000296e0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+000296f0: 7428 6476 5f65 6e74 6974 792e 636f 645f  t(dv_entity.cod_
+00029700: 656e 7469 7479 2c20 3129 0d0a 2020 2020  entity, 1)..    
+00029710: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00029720: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00029730: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+00029740: 6e74 6974 792c 2061 7070 6c69 6564 5f64  ntity, applied_d
+00029750: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+00029760: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00029770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029780: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00029790: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+000297a0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+000297b0: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+000297c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297d0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
+000297e0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+000297f0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00029800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029810: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+00029820: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00029830: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+00029840: 696e 616c 5f70 6f73 6974 696f 6e2c 2061  inal_position, a
+00029850: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00029860: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
 00029870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029880: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-00029890: 4559 5f54 5950 455f 4841 5348 5f4b 4559  EY_TYPE_HASH_KEY
-000298a0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-000298b0: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
-000298c0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-000298d0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-000298e0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-000298f0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00029900: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-00029910: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00029920: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
-00029930: 735f 7273 3a0d 0a20 2020 2020 2020 2020  s_rs:..         
-00029940: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-00029950: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00029960: 5f61 6374 7561 6c2e 6765 745f 7265 636f  _actual.get_reco
-00029970: 7264 5f73 6f75 7263 655f 6f6e 5f64 765f  rd_source_on_dv_
-00029980: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-00029990: 7461 7267 6574 5f61 6e64 5f6e 756d 5f62  target_and_num_b
-000299a0: 7261 6e63 6828 0d0a 2020 2020 2020 2020  ranch(..        
-000299b0: 2020 2020 2020 2020 636f 645f 656e 7469          cod_enti
-000299c0: 7479 5f74 6172 6765 742c 2031 290d 0a20  ty_target, 1).. 
-000299d0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-000299e0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-000299f0: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
-00029a00: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
-00029a10: 696d 6167 655f 312c 2072 6563 6f72 645f  image_1, record_
-00029a20: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
-00029a30: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-00029a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029a50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00029a60: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-00029a70: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-00029a80: 6765 5f32 2c0d 0a20 2020 2020 2020 2020  ge_2,..         
-00029a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029aa0: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00029ab0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
-00029ac0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00029ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029af0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00029b00: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-00029b10: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00029b20: 6f6e 2c20 7265 636f 7264 5f73 6f75 7263  on, record_sourc
-00029b30: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00029b40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029b60: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-00029b70: 6365 2e63 6f6c 756d 6e5f 7072 6563 6973  ce.column_precis
-00029b80: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-00029b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ba0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
-00029bb0: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
-00029bc0: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
-00029bd0: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-00029be0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00029bf0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-00029c00: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00029c10: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00029c20: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00029c30: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00029c40: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00029c50: 2020 2020 2069 6620 6861 735f 746e 3a0d       if has_tn:.
-00029c60: 0a20 2020 2020 2020 2020 2020 2074 656e  .            ten
-00029c70: 616e 745f 736f 7572 6365 203d 2073 656c  ant_source = sel
-00029c80: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00029c90: 6c2e 6765 745f 7465 6e61 6e74 5f6f 6e5f  l.get_tenant_on_
-00029ca0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
-00029cb0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
-00029cc0: 6d5f 6272 616e 6368 280d 0a20 2020 2020  m_branch(..     
-00029cd0: 2020 2020 2020 2020 2020 2063 6f64 5f65             cod_e
-00029ce0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
-00029cf0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00029d00: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
-00029d10: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
-00029d20: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00029d30: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00029d40: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-00029d50: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-00029d60: 6765 5f31 2c20 746e 2e63 6f6c 756d 6e5f  ge_1, tn.column_
-00029d70: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00029d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029da0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00029db0: 2073 7473 5f65 6e74 6974 795f 6163 7475   sts_entity_actu
-00029dc0: 616c 5f69 6d61 6765 5f32 2c0d 0a20 2020  al_image_2,..   
-00029dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029df0: 2020 2020 746e 2e63 6f6c 756d 6e5f 6e61      tn.column_na
-00029e00: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-00029e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e30: 2020 2074 6e2e 636f 6c75 6d6e 5f74 7970     tn.column_typ
-00029e40: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-00029e50: 6c5f 706f 7369 7469 6f6e 2c20 746e 2e63  l_position, tn.c
-00029e60: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-00029e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029e90: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-00029ea0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-00029eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029ed0: 2020 2031 2c20 4b45 595f 5459 5045 5f54     1, KEY_TYPE_T
-00029ee0: 454e 414e 542c 2031 2c20 7365 6c66 2e6f  ENANT, 1, self.o
-00029ef0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00029f00: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00029f10: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-00029f20: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-00029f30: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00029f40: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-00029f50: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00029f60: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-00029f70: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-00029f80: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
-00029f90: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
-00029fa0: 6461 7465 203d 2073 656c 662e 6d65 7461  date = self.meta
-00029fb0: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
-00029fc0: 6170 706c 6965 645f 6461 7465 5f6f 6e5f  applied_date_on_
-00029fd0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
-00029fe0: 7479 5f74 6172 6765 7428 6476 5f65 6e74  ty_target(dv_ent
-00029ff0: 6974 792e 636f 645f 656e 7469 7479 2c20  ity.cod_entity, 
-0002a000: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-0002a010: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0002a020: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0002a030: 202b 2073 7473 5f65 6e74 6974 795f 6163   + sts_entity_ac
-0002a040: 7475 616c 5f69 6d61 6765 5f31 2c20 6170  tual_image_1, ap
-0002a050: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
-0002a060: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0002a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a090: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0002a0a0: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-0002a0b0: 5f69 6d61 6765 5f32 2c0d 0a20 2020 2020  _image_2,..     
-0002a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0d0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
-0002a0e0: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
-0002a0f0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0002a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a120: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
-0002a130: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-0002a140: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-0002a150: 7469 6f6e 2c20 6170 706c 6965 645f 6461  tion, applied_da
-0002a160: 7465 2e63 6f6c 756d 6e5f 6c65 6e67 7468  te.column_length
-0002a170: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a190: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-0002a1a0: 7465 2e63 6f6c 756d 6e5f 7072 6563 6973  te.column_precis
-0002a1b0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-0002a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1d0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
-0002a1e0: 5459 5045 5f41 5050 4c49 4544 5f44 4154  TYPE_APPLIED_DAT
-0002a1f0: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
-0002a200: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
-0002a210: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0002a220: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-0002a230: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0002a240: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0002a250: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0002a260: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0002a270: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0002a280: 2020 2020 6e65 775f 6669 6c74 6572 203d      new_filter =
-0002a290: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
-0002a2a0: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
-0002a2b0: 696d 6167 655f 322c 2027 524e 203d 2031  image_2, 'RN = 1
-0002a2c0: 272c 2031 2c20 7365 6c66 2e6f 776e 6572  ', 1, self.owner
-0002a2d0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-0002a2e0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0002a2f0: 6164 645f 656e 7472 795f 6669 6c74 6572  add_entry_filter
-0002a300: 7328 5b6e 6577 5f66 696c 7465 725d 290d  s([new_filter]).
-0002a310: 0a0d 0a20 2020 2020 2020 2023 2323 2323  ...        #####
-0002a320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002a330: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002a340: 204a 4f49 4e20 2323 2323 2323 2323 2323   JOIN ##########
-0002a350: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002a360: 2323 2323 2323 2323 2323 230d 0a0d 0a20  ###########.... 
-0002a370: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0002a380: 6f73 6974 696f 6e20 3d20 310d 0a0d 0a20  osition = 1.... 
-0002a390: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0002a3a0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0002a3b0: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-0002a3c0: 7469 7479 5f75 6e69 6f6e 5f73 6f75 7263  tity_union_sourc
-0002a3d0: 6573 2c20 6861 7368 5f6e 616d 652c 0d0a  es, hash_name,..
-0002a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a3f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0002a400: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-0002a410: 6e74 6974 795f 6a6f 696e 2c20 6861 7368  ntity_join, hash
-0002a420: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-0002a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a440: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
-0002a450: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-0002a460: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
-0002a470: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-0002a480: 5b31 5d2c 2068 6173 685f 666f 725f 6d65  [1], hash_for_me
-0002a490: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
-0002a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4b0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-0002a4c0: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-0002a4d0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0002a4e0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-0002a4f0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0002a500: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0002a510: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0002a520: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0002a530: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0002a540: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0002a550: 0d0a 2020 2020 2020 2020 7379 7364 6174  ..        sysdat
-0002a560: 655f 666f 725f 6d65 7461 6461 7461 203d  e_for_metadata =
-0002a570: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
-0002a580: 2e67 6574 5f73 7973 6461 7465 5f66 6f72  .get_sysdate_for
-0002a590: 5f6d 6574 6164 6174 6128 290d 0a20 2020  _metadata()..   
-0002a5a0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0002a5b0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-0002a5c0: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
-0002a5d0: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
-0002a5e0: 2c20 2744 4154 455f 4352 4541 5445 4427  , 'DATE_CREATED'
-0002a5f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a610: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
-0002a620: 735f 656e 7469 7479 5f6a 6f69 6e2c 2027  s_entity_join, '
-0002a630: 4441 5445 5f43 5245 4154 4544 272c 0d0a  DATE_CREATED',..
-0002a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a650: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002a660: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0002a670: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0002a680: 706f 7369 7469 6f6e 2c20 7379 7364 6174  position, sysdat
-0002a690: 655f 666f 725f 6d65 7461 6461 7461 5b31  e_for_metadata[1
-0002a6a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0002a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a6c0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-0002a6d0: 6574 6164 6174 615b 325d 2c20 312c 204e  etadata[2], 1, N
-0002a6e0: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
-0002a6f0: 6572 5d0d 0a20 2020 2020 2020 2073 656c  er]..        sel
-0002a700: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0002a710: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0002a720: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0002a730: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0002a740: 675d 290d 0a20 2020 2020 2020 206f 7264  g])..        ord
-0002a750: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-0002a760: 2031 0d0a 0d0a 2020 2020 2020 2020 7661   1....        va
-0002a770: 7263 6861 725f 666f 725f 6d65 7461 6461  rchar_for_metada
-0002a780: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-0002a790: 7469 6f6e 2e67 6574 5f73 7472 696e 675f  tion.get_string_
-0002a7a0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-0002a7b0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0002a7c0: 7365 745f 6d61 7070 696e 6720 3d20 5b27  set_mapping = ['
-0002a7d0: 272c 2022 2749 2722 2c0d 0a20 2020 2020  ', "'I'",..     
-0002a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a7f0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-0002a800: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
-0002a810: 5f6a 6f69 6e2c 2027 4456 5f53 5441 5455  _join, 'DV_STATU
-0002a820: 535f 494e 5345 5254 272c 0d0a 2020 2020  S_INSERT',..    
+00029880: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00029890: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+000298a0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+000298b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000298c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000298d0: 2020 312c 204b 4559 5f54 5950 455f 4150    1, KEY_TYPE_AP
+000298e0: 504c 4945 445f 4441 5445 2c20 312c 2073  PLIED_DATE, 1, s
+000298f0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00029900: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00029910: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00029920: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00029930: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00029940: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00029950: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00029960: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00029970: 290d 0a0d 0a20 2020 2020 2020 2023 204c  )....        # L
+00029980: 6173 7420 496d 6167 6520 320d 0a20 2020  ast Image 2..   
+00029990: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+000299a0: 6974 696f 6e20 3d20 310d 0a20 2020 2020  ition = 1..     
+000299b0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+000299c0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+000299d0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+000299e0: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
+000299f0: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+00029a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a10: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00029a20: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+00029a30: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00029a40: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+00029a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a60: 2020 2068 6173 685f 6e61 6d65 2c0d 0a20     hash_name,.. 
+00029a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029a80: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00029a90: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00029aa0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+00029ab0: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
+00029ac0: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
+00029ad0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00029ae0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00029af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b00: 2020 312c 204b 4559 5f54 5950 455f 4841    1, KEY_TYPE_HA
+00029b10: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
+00029b20: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00029b30: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00029b40: 202b 3d20 310d 0a20 2020 2020 2020 2073   += 1..        s
+00029b50: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00029b60: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+00029b70: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+00029b80: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00029b90: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
+00029ba0: 2076 6172 6368 6172 5f66 6f72 5f6d 6574   varchar_for_met
+00029bb0: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
+00029bc0: 6e65 6374 696f 6e2e 6765 745f 7374 7269  nection.get_stri
+00029bd0: 6e67 5f66 6f72 5f6d 6574 6164 6174 6128  ng_for_metadata(
+00029be0: 290d 0a20 2020 2020 2020 206e 6577 5f64  )..        new_d
+00029bf0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00029c00: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+00029c10: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+00029c20: 696d 6167 655f 312c 2027 4456 5f53 5441  image_1, 'DV_STA
+00029c30: 5455 5327 2c20 7072 6566 6978 5f65 7420  TUS', prefix_et 
+00029c40: 2b20 7374 735f 656e 7469 7479 5f61 6374  + sts_entity_act
+00029c50: 7561 6c5f 696d 6167 655f 322c 2027 4456  ual_image_2, 'DV
+00029c60: 5f53 5441 5455 5327 2c0d 0a20 2020 2020  _STATUS',..     
+00029c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c80: 2020 2020 2020 2020 2020 7661 7263 6861            varcha
+00029c90: 725f 666f 725f 6d65 7461 6461 7461 5b30  r_for_metadata[0
+00029ca0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+00029cb0: 696f 6e2c 2031 2c20 302c 0d0a 2020 2020  ion, 1, 0,..    
+00029cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029cd0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+00029ce0: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
+00029cf0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00029d00: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+00029d10: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00029d20: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00029d30: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00029d40: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00029d50: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00029d60: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00029d70: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00029d80: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
+00029d90: 2020 7265 636f 7264 5f73 6f75 7263 6520    record_source 
+00029da0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00029db0: 6163 7475 616c 2e67 6574 5f72 6563 6f72  actual.get_recor
+00029dc0: 645f 736f 7572 6365 5f6f 6e5f 6476 5f66  d_source_on_dv_f
+00029dd0: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
+00029de0: 6172 6765 745f 616e 645f 6e75 6d5f 6272  arget_and_num_br
+00029df0: 616e 6368 280d 0a20 2020 2020 2020 2020  anch(..         
+00029e00: 2020 2020 2020 2063 6f64 5f65 6e74 6974         cod_entit
+00029e10: 795f 7461 7267 6574 2c20 3129 0d0a 2020  y_target, 1)..  
+00029e20: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00029e30: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00029e40: 5b70 7265 6669 785f 6574 202b 2073 7473  [prefix_et + sts
+00029e50: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+00029e60: 6d61 6765 5f31 2c20 7265 636f 7264 5f73  mage_1, record_s
+00029e70: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
+00029e80: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+00029e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ea0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00029eb0: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+00029ec0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+00029ed0: 655f 322c 0d0a 2020 2020 2020 2020 2020  e_2,..          
+00029ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ef0: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+00029f00: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
+00029f10: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00029f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029f30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00029f40: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00029f50: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+00029f60: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00029f70: 6e2c 2072 6563 6f72 645f 736f 7572 6365  n, record_source
+00029f80: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00029f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029fb0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+00029fc0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+00029fd0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00029fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029ff0: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
+0002a000: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
+0002a010: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
+0002a020: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
+0002a030: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+0002a040: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+0002a050: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0002a060: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0002a070: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002a080: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0002a090: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0002a0a0: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
+0002a0b0: 2020 2020 2020 2020 2020 2020 7465 6e61              tena
+0002a0c0: 6e74 5f73 6f75 7263 6520 3d20 7365 6c66  nt_source = self
+0002a0d0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0002a0e0: 2e67 6574 5f74 656e 616e 745f 6f6e 5f64  .get_tenant_on_d
+0002a0f0: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
+0002a100: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
+0002a110: 5f62 7261 6e63 6828 0d0a 2020 2020 2020  _branch(..      
+0002a120: 2020 2020 2020 2020 2020 636f 645f 656e            cod_en
+0002a130: 7469 7479 5f74 6172 6765 742c 2031 290d  tity_target, 1).
+0002a140: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0002a150: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
+0002a160: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
+0002a170: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0002a180: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0002a190: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+0002a1a0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+0002a1b0: 655f 312c 2074 6e2e 636f 6c75 6d6e 5f6e  e_1, tn.column_n
+0002a1c0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0002a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1f0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0002a200: 7374 735f 656e 7469 7479 5f61 6374 7561  sts_entity_actua
+0002a210: 6c5f 696d 6167 655f 322c 0d0a 2020 2020  l_image_2,..    
+0002a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a240: 2020 2074 6e2e 636f 6c75 6d6e 5f6e 616d     tn.column_nam
+0002a250: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+0002a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a280: 2020 746e 2e63 6f6c 756d 6e5f 7479 7065    tn.column_type
+0002a290: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+0002a2a0: 5f70 6f73 6974 696f 6e2c 2074 6e2e 636f  _position, tn.co
+0002a2b0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+0002a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2e0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
+0002a2f0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+0002a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a320: 2020 312c 204b 4559 5f54 5950 455f 5445    1, KEY_TYPE_TE
+0002a330: 4e41 4e54 2c20 312c 2073 656c 662e 6f77  NANT, 1, self.ow
+0002a340: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002a350: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0002a360: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0002a370: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0002a380: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0002a390: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
+0002a3a0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0002a3b0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0002a3c0: 3d20 310d 0a0d 0a20 2020 2020 2020 2069  = 1....        i
+0002a3d0: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
+0002a3e0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
+0002a3f0: 6174 6520 3d20 7365 6c66 2e6d 6574 6164  ate = self.metad
+0002a400: 6174 615f 6163 7475 616c 2e67 6574 5f61  ata_actual.get_a
+0002a410: 7070 6c69 6564 5f64 6174 655f 6f6e 5f64  pplied_date_on_d
+0002a420: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
+0002a430: 795f 7461 7267 6574 2864 765f 656e 7469  y_target(dv_enti
+0002a440: 7479 2e63 6f64 5f65 6e74 6974 792c 2031  ty.cod_entity, 1
+0002a450: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
+0002a460: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0002a470: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0002a480: 2b20 7374 735f 656e 7469 7479 5f61 6374  + sts_entity_act
+0002a490: 7561 6c5f 696d 6167 655f 312c 2061 7070  ual_image_1, app
+0002a4a0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0002a4b0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0002a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4e0: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
+0002a4f0: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+0002a500: 696d 6167 655f 322c 0d0a 2020 2020 2020  image_2,..      
+0002a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a520: 2020 2020 2020 2020 2020 2020 2061 7070               app
+0002a530: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0002a540: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0002a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a570: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
+0002a580: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+0002a590: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+0002a5a0: 696f 6e2c 2061 7070 6c69 6564 5f64 6174  ion, applied_dat
+0002a5b0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
+0002a5c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a5e0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0002a5f0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+0002a600: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0002a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a620: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
+0002a630: 5950 455f 4150 504c 4945 445f 4441 5445  YPE_APPLIED_DATE
+0002a640: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+0002a650: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+0002a660: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0002a670: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+0002a680: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0002a690: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0002a6a0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0002a6b0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0002a6c0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+0002a6d0: 2020 206e 6577 5f66 696c 7465 7220 3d20     new_filter = 
+0002a6e0: 5b70 7265 6669 785f 6574 202b 2073 7473  [prefix_et + sts
+0002a6f0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+0002a700: 6d61 6765 5f32 2c20 2752 4e20 3d20 3127  mage_2, 'RN = 1'
+0002a710: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+0002a720: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+0002a730: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0002a740: 6464 5f65 6e74 7279 5f66 696c 7465 7273  dd_entry_filters
+0002a750: 285b 6e65 775f 6669 6c74 6572 5d29 0d0a  ([new_filter])..
+0002a760: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
+0002a770: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002a780: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+0002a790: 4a4f 494e 2023 2323 2323 2323 2323 2323  JOIN ###########
+0002a7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002a7b0: 2323 2323 2323 2323 2323 0d0a 0d0a 2020  ##########....  
+0002a7c0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0002a7d0: 7369 7469 6f6e 203d 2031 0d0a 0d0a 2020  sition = 1....  
+0002a7e0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0002a7f0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0002a800: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+0002a810: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
+0002a820: 732c 2068 6173 685f 6e61 6d65 2c0d 0a20  s, hash_name,.. 
 0002a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a840: 2020 2020 2020 2020 2020 2076 6172 6368             varch
-0002a850: 6172 5f66 6f72 5f6d 6574 6164 6174 615b  ar_for_metadata[
-0002a860: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-0002a870: 7469 6f6e 2c20 312c 0d0a 2020 2020 2020  tion, 1,..      
+0002a840: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0002a850: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+0002a860: 7469 7479 5f6a 6f69 6e2c 2068 6173 685f  tity_join, hash_
+0002a870: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
 0002a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a890: 2020 2020 2020 2020 2076 6172 6368 6172           varchar
-0002a8a0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-0002a8b0: 2c20 312c 204e 6f6e 652c 2031 2c20 7365  , 1, None, 1, se
-0002a8c0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0002a8d0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0002a8e0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0002a8f0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0002a900: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0002a910: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0002a920: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0002a930: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-0002a940: 2020 2020 7661 7263 6861 725f 666f 725f      varchar_for_
-0002a950: 6d65 7461 6461 7461 203d 2073 656c 662e  metadata = self.
-0002a960: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
-0002a970: 7472 696e 675f 666f 725f 6d65 7461 6461  tring_for_metada
-0002a980: 7461 2829 0d0a 2020 2020 2020 2020 6e65  ta()..        ne
-0002a990: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0002a9a0: 6720 3d20 5b27 272c 2022 2744 2722 2c0d  g = ['', "'D'",.
-0002a9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a9d0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002a9e0: 656e 7469 7479 5f6a 6f69 6e2c 2027 4456  entity_join, 'DV
-0002a9f0: 5f53 5441 5455 535f 4445 4c45 5445 272c  _STATUS_DELETE',
-0002aa00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aa20: 2076 6172 6368 6172 5f66 6f72 5f6d 6574   varchar_for_met
-0002aa30: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-0002aa40: 6c5f 706f 7369 7469 6f6e 2c20 312c 0d0a  l_position, 1,..
+0002a890: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
+0002a8a0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+0002a8b0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
+0002a8c0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+0002a8d0: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
+0002a8e0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
+0002a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a900: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+0002a910: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+0002a920: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0002a930: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0002a940: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+0002a950: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0002a960: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0002a970: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0002a980: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0002a990: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+0002a9a0: 0a20 2020 2020 2020 2073 7973 6461 7465  .        sysdate
+0002a9b0: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
+0002a9c0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+0002a9d0: 6765 745f 7379 7364 6174 655f 666f 725f  get_sysdate_for_
+0002a9e0: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
+0002a9f0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+0002aa00: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+0002aa10: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
+0002aa20: 795f 756e 696f 6e5f 736f 7572 6365 732c  y_union_sources,
+0002aa30: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
+0002aa40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0002aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aa60: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0002aa70: 6172 6368 6172 5f66 6f72 5f6d 6574 6164  archar_for_metad
-0002aa80: 6174 615b 325d 2c20 312c 204e 6f6e 652c  ata[2], 1, None,
-0002aa90: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0002aaa0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-0002aab0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0002aac0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0002aad0: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0002aae0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0002aaf0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-0002ab00: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0002ab10: 0d0a 2020 2020 2020 2020 7661 7263 6861  ..        varcha
-0002ab20: 725f 666f 725f 6d65 7461 6461 7461 203d  r_for_metadata =
-0002ab30: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
-0002ab40: 2e67 6574 5f73 7472 696e 675f 666f 725f  .get_string_for_
-0002ab50: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
-0002ab60: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0002ab70: 6d61 7070 696e 6720 3d20 5b27 272c 2022  mapping = ['', "
-0002ab80: 2755 2722 2c0d 0a20 2020 2020 2020 2020  'U'",..         
-0002ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aba0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-0002abb0: 2b20 7374 735f 656e 7469 7479 5f6a 6f69  + sts_entity_joi
-0002abc0: 6e2c 2027 4456 5f53 5441 5455 535f 5550  n, 'DV_STATUS_UP
-0002abd0: 4441 5445 272c 0d0a 2020 2020 2020 2020  DATE',..        
-0002abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002abf0: 2020 2020 2020 2076 6172 6368 6172 5f66         varchar_f
-0002ac00: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-0002ac10: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0002ac20: 2c20 312c 0d0a 2020 2020 2020 2020 2020  , 1,..          
+0002aa60: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
+0002aa70: 5f65 6e74 6974 795f 6a6f 696e 2c20 2744  _entity_join, 'D
+0002aa80: 4154 455f 4352 4541 5445 4427 2c0d 0a20  ATE_CREATED',.. 
+0002aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aaa0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0002aab0: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+0002aac0: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0002aad0: 6f73 6974 696f 6e2c 2073 7973 6461 7465  osition, sysdate
+0002aae0: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+0002aaf0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab10: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+0002ab20: 7461 6461 7461 5b32 5d2c 2031 2c20 4e6f  tadata[2], 1, No
+0002ab30: 6e65 2c20 312c 2073 656c 662e 6f77 6e65  ne, 1, self.owne
+0002ab40: 725d 0d0a 2020 2020 2020 2020 7365 6c66  r]..        self
+0002ab50: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0002ab60: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0002ab70: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0002ab80: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002ab90: 5d29 0d0a 2020 2020 2020 2020 6f72 6469  ])..        ordi
+0002aba0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+0002abb0: 310d 0a0d 0a20 2020 2020 2020 2076 6172  1....        var
+0002abc0: 6368 6172 5f66 6f72 5f6d 6574 6164 6174  char_for_metadat
+0002abd0: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+0002abe0: 696f 6e2e 6765 745f 7374 7269 6e67 5f66  ion.get_string_f
+0002abf0: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
+0002ac00: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0002ac10: 6574 5f6d 6170 7069 6e67 203d 205b 2727  et_mapping = [''
+0002ac20: 2c20 2227 4927 222c 0d0a 2020 2020 2020  , "'I'",..      
 0002ac30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ac40: 2020 2020 2076 6172 6368 6172 5f66 6f72       varchar_for
-0002ac50: 5f6d 6574 6164 6174 615b 325d 2c20 312c  _metadata[2], 1,
-0002ac60: 204e 6f6e 652c 2031 2c20 7365 6c66 2e6f   None, 1, self.o
-0002ac70: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-0002ac80: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0002ac90: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0002aca0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0002acb0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0002acc0: 696e 675d 290d 0a20 2020 2020 2020 206f  ing])..        o
-0002acd0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0002ace0: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-0002acf0: 6966 2068 6173 5f72 733a 0d0a 2020 2020  if has_rs:..    
-0002ad00: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0002ad10: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0002ad20: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-0002ad30: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
-0002ad40: 6365 732c 2072 6563 6f72 645f 736f 7572  ces, record_sour
-0002ad50: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
-0002ad60: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0002ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ad80: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0002ad90: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-0002ada0: 795f 6a6f 696e 2c0d 0a20 2020 2020 2020  y_join,..       
-0002adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002adc0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-0002add0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-0002ade0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-0002adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac40: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+0002ac50: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
+0002ac60: 6a6f 696e 2c20 2744 565f 5354 4154 5553  join, 'DV_STATUS
+0002ac70: 5f49 4e53 4552 5427 2c0d 0a20 2020 2020  _INSERT',..     
+0002ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ac90: 2020 2020 2020 2020 2020 7661 7263 6861            varcha
+0002aca0: 725f 666f 725f 6d65 7461 6461 7461 5b30  r_for_metadata[0
+0002acb0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+0002acc0: 696f 6e2c 2031 2c0d 0a20 2020 2020 2020  ion, 1,..       
+0002acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ace0: 2020 2020 2020 2020 7661 7263 6861 725f          varchar_
+0002acf0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0002ad00: 2031 2c20 4e6f 6e65 2c20 312c 2073 656c   1, None, 1, sel
+0002ad10: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0002ad20: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0002ad30: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0002ad40: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002ad50: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0002ad60: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0002ad70: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0002ad80: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+0002ad90: 2020 2076 6172 6368 6172 5f66 6f72 5f6d     varchar_for_m
+0002ada0: 6574 6164 6174 6120 3d20 7365 6c66 2e63  etadata = self.c
+0002adb0: 6f6e 6e65 6374 696f 6e2e 6765 745f 7374  onnection.get_st
+0002adc0: 7269 6e67 5f66 6f72 5f6d 6574 6164 6174  ring_for_metadat
+0002add0: 6128 290d 0a20 2020 2020 2020 206e 6577  a()..        new
+0002ade0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002adf0: 203d 205b 2727 2c20 2227 4427 222c 0d0a   = ['', "'D'",..
 0002ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ae10: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-0002ae20: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-0002ae30: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-0002ae40: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
-0002ae50: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-0002ae60: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-0002ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ae80: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-0002ae90: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-0002aea0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
-0002aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aec0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-0002aed0: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
-0002aee0: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
-0002aef0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0002af00: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0002af10: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-0002af20: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0002af30: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-0002af40: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-0002af50: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-0002af60: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-0002af70: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
-0002af80: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-0002af90: 6f72 2074 6e20 696e 2074 656e 616e 745f  or tn in tenant_
-0002afa0: 736f 7572 6365 3a0d 0a20 2020 2020 2020  source:..       
-0002afb0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-0002afc0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-0002afd0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002afe0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
-0002aff0: 7263 6573 2c20 746e 2e63 6f6c 756d 6e5f  rces, tn.column_
-0002b000: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-0002b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b030: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-0002b040: 2073 7473 5f65 6e74 6974 795f 6a6f 696e   sts_entity_join
-0002b050: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b070: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-0002b080: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-0002b090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b0b0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-0002b0c0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0002b0d0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0002b0e0: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
-0002b0f0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-0002b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b110: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-0002b120: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-0002b130: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b150: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
-0002b160: 5459 5045 5f54 454e 414e 542c 2031 2c20  TYPE_TENANT, 1, 
-0002b170: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0002b180: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0002b190: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0002b1a0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0002b1b0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0002b1c0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0002b1d0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
-0002b1e0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0002b1f0: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
-0002b200: 2020 2020 2020 6966 2068 6173 5f61 643a        if has_ad:
-0002b210: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-0002b220: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0002b230: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-0002b240: 2073 7473 5f65 6e74 6974 795f 756e 696f   sts_entity_unio
-0002b250: 6e5f 736f 7572 6365 732c 2061 7070 6c69  n_sources, appli
-0002b260: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-0002b270: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-0002b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b2a0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002b2b0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+0002ae10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002ae20: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+0002ae30: 6e74 6974 795f 6a6f 696e 2c20 2744 565f  ntity_join, 'DV_
+0002ae40: 5354 4154 5553 5f44 454c 4554 4527 2c0d  STATUS_DELETE',.
+0002ae50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae70: 7661 7263 6861 725f 666f 725f 6d65 7461  varchar_for_meta
+0002ae80: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+0002ae90: 5f70 6f73 6974 696f 6e2c 2031 2c0d 0a20  _position, 1,.. 
+0002aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aeb0: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0002aec0: 7263 6861 725f 666f 725f 6d65 7461 6461  rchar_for_metada
+0002aed0: 7461 5b32 5d2c 2031 2c20 4e6f 6e65 2c20  ta[2], 1, None, 
+0002aee0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0002aef0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0002af00: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0002af10: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0002af20: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0002af30: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0002af40: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0002af50: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+0002af60: 0a20 2020 2020 2020 2076 6172 6368 6172  .        varchar
+0002af70: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
+0002af80: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+0002af90: 6765 745f 7374 7269 6e67 5f66 6f72 5f6d  get_string_for_m
+0002afa0: 6574 6164 6174 6128 290d 0a20 2020 2020  etadata()..     
+0002afb0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0002afc0: 6170 7069 6e67 203d 205b 2727 2c20 2227  apping = ['', "'
+0002afd0: 5527 222c 0d0a 2020 2020 2020 2020 2020  U'",..          
+0002afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aff0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+0002b000: 2073 7473 5f65 6e74 6974 795f 6a6f 696e   sts_entity_join
+0002b010: 2c20 2744 565f 5354 4154 5553 5f55 5044  , 'DV_STATUS_UPD
+0002b020: 4154 4527 2c0d 0a20 2020 2020 2020 2020  ATE',..         
+0002b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b040: 2020 2020 2020 7661 7263 6861 725f 666f        varchar_fo
+0002b050: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+0002b060: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0002b070: 2031 2c0d 0a20 2020 2020 2020 2020 2020   1,..           
+0002b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b090: 2020 2020 7661 7263 6861 725f 666f 725f      varchar_for_
+0002b0a0: 6d65 7461 6461 7461 5b32 5d2c 2031 2c20  metadata[2], 1, 
+0002b0b0: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
+0002b0c0: 6e65 725d 0d0a 2020 2020 2020 2020 7365  ner]..        se
+0002b0d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0002b0e0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+0002b0f0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+0002b100: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0002b110: 6e67 5d29 0d0a 2020 2020 2020 2020 6f72  ng])..        or
+0002b120: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+0002b130: 3d20 310d 0a0d 0a20 2020 2020 2020 2069  = 1....        i
+0002b140: 6620 6861 735f 7273 3a0d 0a20 2020 2020  f has_rs:..     
+0002b150: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0002b160: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0002b170: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+0002b180: 7469 7479 5f75 6e69 6f6e 5f73 6f75 7263  tity_union_sourc
+0002b190: 6573 2c20 7265 636f 7264 5f73 6f75 7263  es, record_sourc
+0002b1a0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+0002b1b0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0002b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b1d0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0002b1e0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+0002b1f0: 5f6a 6f69 6e2c 0d0a 2020 2020 2020 2020  _join,..        
+0002b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b210: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+0002b220: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+0002b230: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+0002b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b260: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+0002b270: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+0002b280: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+0002b290: 696f 6e2c 2072 6563 6f72 645f 736f 7572  ion, record_sour
+0002b2a0: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
+0002b2b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0002b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b2e0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-0002b2f0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-0002b300: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b320: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-0002b330: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
-0002b340: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-0002b350: 6f73 6974 696f 6e2c 2061 7070 6c69 6564  osition, applied
-0002b360: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
-0002b370: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0002b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b390: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-0002b3a0: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
-0002b3b0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-0002b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b3d0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-0002b3e0: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
-0002b3f0: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
-0002b400: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0002b410: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0002b420: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-0002b430: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0002b440: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-0002b450: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-0002b460: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-0002b470: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-0002b480: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0002b490: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0002b4a0: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-0002b4b0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0002b4c0: 655f 322c 2068 6173 685f 6e61 6d65 2c20  e_2, hash_name, 
-0002b4d0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002b4e0: 656e 7469 7479 5f6a 6f69 6e2c 2068 6173  entity_join, has
-0002b4f0: 685f 6e61 6d65 202b 2027 5f48 4953 5427  h_name + '_HIST'
-0002b500: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b520: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-0002b530: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0002b540: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-0002b550: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-0002b560: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-0002b570: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-0002b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b590: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-0002b5a0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-0002b5b0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0002b5c0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0002b5d0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
-0002b5e0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0002b5f0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0002b600: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0002b610: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0002b620: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-0002b630: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0002b640: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-0002b650: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
-0002b660: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-0002b670: 322c 2027 4456 5f53 5441 5455 5327 2c0d  2, 'DV_STATUS',.
-0002b680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6a0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002b6b0: 656e 7469 7479 5f6a 6f69 6e2c 2027 4456  entity_join, 'DV
-0002b6c0: 5f53 5441 5455 535f 4849 5354 272c 0d0a  _STATUS_HIST',..
+0002b2d0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+0002b2e0: 7263 652e 636f 6c75 6d6e 5f70 7265 6369  rce.column_preci
+0002b2f0: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+0002b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b310: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+0002b320: 5f54 5950 455f 5245 434f 5244 5f53 4f55  _TYPE_RECORD_SOU
+0002b330: 5243 452c 2031 2c20 7365 6c66 2e6f 776e  RCE, 1, self.own
+0002b340: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0002b350: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0002b360: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+0002b370: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0002b380: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0002b390: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+0002b3a0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+0002b3b0: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+0002b3c0: 2020 2020 2020 6966 2068 6173 5f74 6e3a        if has_tn:
+0002b3d0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+0002b3e0: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
+0002b3f0: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
+0002b400: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0002b410: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+0002b420: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+0002b430: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
+0002b440: 6365 732c 2074 6e2e 636f 6c75 6d6e 5f6e  ces, tn.column_n
+0002b450: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0002b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b480: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0002b490: 7374 735f 656e 7469 7479 5f6a 6f69 6e2c  sts_entity_join,
+0002b4a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4c0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+0002b4d0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+0002b4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b500: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+0002b510: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+0002b520: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0002b530: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
+0002b540: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0002b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b560: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+0002b570: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+0002b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5a0: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
+0002b5b0: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
+0002b5c0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0002b5d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002b5e0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0002b5f0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0002b600: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0002b610: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002b620: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0002b630: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0002b640: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+0002b650: 2020 2020 2069 6620 6861 735f 6164 3a0d       if has_ad:.
+0002b660: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0002b670: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002b680: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+0002b690: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
+0002b6a0: 5f73 6f75 7263 6573 2c20 6170 706c 6965  _sources, applie
+0002b6b0: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+0002b6c0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
 0002b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0002b6f0: 6172 6368 6172 5f66 6f72 5f6d 6574 6164  archar_for_metad
-0002b700: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0002b710: 706f 7369 7469 6f6e 2c20 312c 2030 2c0d  position, 1, 0,.
-0002b720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b740: 312c 204b 4559 5f54 5950 455f 4841 5348  1, KEY_TYPE_HASH
-0002b750: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
-0002b760: 6e65 725d 0d0a 2020 2020 2020 2020 6f72  ner]..        or
-0002b770: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-0002b780: 3d20 310d 0a20 2020 2020 2020 2073 656c  = 1..        sel
-0002b790: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0002b7a0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0002b7b0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0002b7c0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0002b7d0: 675d 290d 0a0d 0a20 2020 2020 2020 2069  g])....        i
-0002b7e0: 6620 6861 735f 7273 3a0d 0a20 2020 2020  f has_rs:..     
-0002b7f0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-0002b800: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
-0002b810: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
-0002b820: 7265 636f 7264 5f73 6f75 7263 655f 6f6e  record_source_on
-0002b830: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
-0002b840: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
-0002b850: 756d 5f62 7261 6e63 6828 0d0a 2020 2020  um_branch(..    
-0002b860: 2020 2020 2020 2020 2020 2020 636f 645f              cod_
-0002b870: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
-0002b880: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-0002b890: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0002b8a0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-0002b8b0: 2b20 7374 735f 656e 7469 7479 5f61 6374  + sts_entity_act
-0002b8c0: 7561 6c5f 696d 6167 655f 322c 2072 6563  ual_image_2, rec
-0002b8d0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-0002b8e0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-0002b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b910: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0002b920: 7473 5f65 6e74 6974 795f 6a6f 696e 2c0d  ts_entity_join,.
-0002b930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b950: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-0002b960: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-0002b970: 7267 6574 202b 2022 5f48 4953 5422 2c0d  rget + "_HIST",.
-0002b980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b9a0: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-0002b9b0: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-0002b9c0: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-0002b9d0: 7369 7469 6f6e 2c20 7265 636f 7264 5f73  sition, record_s
-0002b9e0: 6f75 7263 652e 636f 6c75 6d6e 5f6c 656e  ource.column_len
-0002b9f0: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0002ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba10: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
-0002ba20: 736f 7572 6365 2e63 6f6c 756d 6e5f 7072  source.column_pr
-0002ba30: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-0002ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba50: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
-0002ba60: 4b45 595f 5459 5045 5f52 4543 4f52 445f  KEY_TYPE_RECORD_
-0002ba70: 534f 5552 4345 2c20 312c 2073 656c 662e  SOURCE, 1, self.
-0002ba80: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0002ba90: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0002baa0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
-0002bab0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0002bac0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0002bad0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-0002bae0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-0002baf0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-0002bb00: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
-0002bb10: 746e 3a0d 0a20 2020 2020 2020 2020 2020  tn:..           
-0002bb20: 2074 656e 616e 745f 736f 7572 6365 203d   tenant_source =
-0002bb30: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0002bb40: 6374 7561 6c2e 6765 745f 7465 6e61 6e74  ctual.get_tenant
-0002bb50: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
-0002bb60: 656e 7469 7479 5f74 6172 6765 745f 616e  entity_target_an
-0002bb70: 645f 6e75 6d5f 6272 616e 6368 280d 0a20  d_num_branch(.. 
-0002bb80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002bb90: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-0002bba0: 2c20 3129 0d0a 2020 2020 2020 2020 2020  , 1)..          
-0002bbb0: 2020 666f 7220 746e 2069 6e20 7465 6e61    for tn in tena
-0002bbc0: 6e74 5f73 6f75 7263 653a 0d0a 2020 2020  nt_source:..    
-0002bbd0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002bbe0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0002bbf0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0002bc00: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-0002bc10: 5f69 6d61 6765 5f32 2c20 746e 2e63 6f6c  _image_2, tn.col
-0002bc20: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-0002bc30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc50: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-0002bc60: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-0002bc70: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
-0002bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc90: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-0002bca0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0002bcb0: 6765 7420 2b20 225f 4849 5354 222c 0d0a  get + "_HIST",..
-0002bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bce0: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-0002bcf0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-0002bd00: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-0002bd10: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
-0002bd20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd40: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-0002bd50: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-0002bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd80: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-0002bd90: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
-0002bda0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0002bdb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002bdc0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0002bdd0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0002bde0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0002bdf0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0002be00: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0002be10: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0002be20: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-0002be30: 2020 2020 6966 2068 6173 5f61 643a 0d0a      if has_ad:..
-0002be40: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0002be50: 6965 645f 6461 7465 203d 2073 656c 662e  ied_date = self.
-0002be60: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0002be70: 6765 745f 6170 706c 6965 645f 6461 7465  get_applied_date
-0002be80: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
-0002be90: 656e 7469 7479 5f74 6172 6765 7428 6476  entity_target(dv
-0002bea0: 5f65 6e74 6974 792e 636f 645f 656e 7469  _entity.cod_enti
-0002beb0: 7479 2c20 3129 0d0a 2020 2020 2020 2020  ty, 1)..        
-0002bec0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0002bed0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-0002bee0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-0002bef0: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
-0002bf00: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
-0002bf10: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0002bf20: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0002bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf40: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0002bf50: 202b 2073 7473 5f65 6e74 6974 795f 6a6f   + sts_entity_jo
-0002bf60: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
-0002bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf80: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
-0002bf90: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0002bfa0: 5f74 6172 6765 7420 2b20 225f 4849 5354  _target + "_HIST
-0002bfb0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0002bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bfd0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-0002bfe0: 6174 652e 636f 6c75 6d6e 5f74 7970 655f  ate.column_type_
-0002bff0: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-0002c000: 706f 7369 7469 6f6e 2c20 6170 706c 6965  position, applie
-0002c010: 645f 6461 7465 2e63 6f6c 756d 6e5f 6c65  d_date.column_le
-0002c020: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
-0002c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c040: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-0002c050: 645f 6461 7465 2e63 6f6c 756d 6e5f 7072  d_date.column_pr
-0002c060: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-0002c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c080: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
-0002c090: 4b45 595f 5459 5045 5f41 5050 4c49 4544  KEY_TYPE_APPLIED
-0002c0a0: 5f44 4154 452c 2031 2c20 7365 6c66 2e6f  _DATE, 1, self.o
-0002c0b0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0002c0c0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0002c0d0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-0002c0e0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-0002c0f0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-0002c100: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-0002c110: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-0002c120: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-0002c130: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
-0002c140: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002c150: 2323 2320 4361 7365 2066 6f72 2044 6174  ### Case for Dat
-0002c160: 6162 6173 6573 2074 6861 7420 646f 6573  abases that does
-0002c170: 6e27 7420 6861 7665 204f 5554 4552 204a  n't have OUTER J
-0002c180: 4f49 4e20 2323 2323 2323 2323 2323 2323  OIN ############
-0002c190: 2323 2323 2323 2323 2323 230d 0a20 2020  ###########..   
-0002c1a0: 2020 2020 2069 6620 7365 6c66 2e63 6f6e       if self.con
-0002c1b0: 6e65 6374 696f 6e2e 6765 745f 636f 6e6e  nection.get_conn
-0002c1c0: 6563 7469 6f6e 5f74 7970 6528 2920 696e  ection_type() in
-0002c1d0: 2043 4f4e 4e45 4354 494f 4e53 5f57 4954   CONNECTIONS_WIT
-0002c1e0: 484f 5554 5f4f 5554 4552 5f4a 4f49 4e3a  HOUT_OUTER_JOIN:
-0002c1f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0002c200: 6e65 775f 7265 6c61 7469 6f6e 7368 6970  new_relationship
-0002c210: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0002c220: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
-0002c230: 5f73 6f75 7263 6573 2c20 6861 7368 5f6e  _sources, hash_n
-0002c240: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-0002c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c260: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-0002c270: 2b20 7374 735f 656e 7469 7479 5f61 6374  + sts_entity_act
-0002c280: 7561 6c5f 696d 6167 655f 322c 0d0a 2020  ual_image_2,..  
-0002c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c2a0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0002c2b0: 7368 5f6e 616d 652c 2022 4d41 5354 4552  sh_name, "MASTER
-0002c2c0: 204a 4f49 4e22 2c20 7365 6c66 2e6f 776e   JOIN", self.own
-0002c2d0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-0002c2e0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0002c2f0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0002c300: 6461 7461 7365 745f 7265 6c61 7469 6f6e  dataset_relation
-0002c310: 7368 6970 285b 6e65 775f 7265 6c61 7469  ship([new_relati
-0002c320: 6f6e 7368 6970 5d29 0d0a 0d0a 2020 2020  onship])....    
-0002c330: 2020 2020 2020 2020 2323 2323 2320 4765          ##### Ge
-0002c340: 7420 616e 6f74 6865 7220 554e 494f 4e20  t another UNION 
-0002c350: 5354 5320 746f 2073 6574 206e 6577 2072  STS to set new r
-0002c360: 656c 6174 696f 6e73 6869 700d 0a20 2020  elationship..   
-0002c370: 2020 2020 2020 2020 2073 7473 5f65 6e74           sts_ent
-0002c380: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-0002c390: 735f 3220 3d20 2753 5447 5f54 4d50 5f55  s_2 = 'STG_TMP_U
-0002c3a0: 4e49 4f4e 5f32 5f27 202b 2073 7473 5f6e  NION_2_' + sts_n
-0002c3b0: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-0002c3c0: 206e 6577 5f65 6e74 6974 795f 7374 735f   new_entity_sts_
-0002c3d0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
-0002c3e0: 7263 6573 203d 205b 7072 6566 6978 5f65  rces = [prefix_e
-0002c3f0: 7420 2b20 7374 735f 656e 7469 7479 5f75  t + sts_entity_u
-0002c400: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c20  nion_sources_2, 
-0002c410: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
-0002c420: 5f73 6f75 7263 6573 5f32 2c0d 0a20 2020  _sources_2,..   
-0002c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c460: 454e 5449 5459 5f57 4954 482c 2064 765f  ENTITY_WITH, dv_
-0002c470: 656e 7469 7479 2e63 6f64 5f70 6174 682c  entity.cod_path,
-0002c480: 2027 272c 2073 656c 662e 6f77 6e65 725d   '', self.owner]
-0002c490: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0002c4a0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0002c4b0: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
-0002c4c0: 6974 7928 5b6e 6577 5f65 6e74 6974 795f  ity([new_entity_
-0002c4d0: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
-0002c4e0: 5f73 6f75 7263 6573 5d29 0d0a 0d0a 2020  _sources])....  
-0002c4f0: 2020 2020 2020 2020 2020 7465 6e61 6e74            tenant
-0002c500: 5f73 6f75 7263 6520 3d20 7365 6c66 2e6d  _source = self.m
-0002c510: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0002c520: 6574 5f74 656e 616e 745f 6f6e 5f64 765f  et_tenant_on_dv_
-0002c530: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-0002c540: 7461 7267 6574 5f61 6e64 5f6e 756d 5f62  target_and_num_b
-0002c550: 7261 6e63 6828 636f 645f 656e 7469 7479  ranch(cod_entity
-0002c560: 5f74 6172 6765 742c 2031 290d 0a20 2020  _target, 1)..   
-0002c570: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0002c580: 7465 6e61 6e74 5f73 6f75 7263 6529 2021  tenant_source) !
-0002c590: 3d20 303a 2068 6173 5f74 6e20 3d20 5472  = 0: has_tn = Tr
-0002c5a0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0002c5b0: 7265 636f 7264 5f73 6f75 7263 6520 3d20  record_source = 
-0002c5c0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0002c5d0: 7475 616c 2e67 6574 5f72 6563 6f72 645f  tual.get_record_
-0002c5e0: 736f 7572 6365 5f6f 6e5f 6476 5f66 726f  source_on_dv_fro
-0002c5f0: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
-0002c600: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
-0002c610: 6368 2863 6f64 5f65 6e74 6974 795f 7461  ch(cod_entity_ta
-0002c620: 7267 6574 2c20 3129 0d0a 2020 2020 2020  rget, 1)..      
-0002c630: 2020 2020 2020 6966 2072 6563 6f72 645f        if record_
-0002c640: 736f 7572 6365 2069 7320 6e6f 7420 4e6f  source is not No
-0002c650: 6e65 3a20 6861 735f 7273 203d 2054 7275  ne: has_rs = Tru
-0002c660: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-0002c670: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-0002c680: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-0002c690: 7469 6f6e 2e67 6574 5f68 6173 685f 666f  tion.get_hash_fo
-0002c6a0: 725f 6d65 7461 6461 7461 2829 0d0a 0d0a  r_metadata()....
-0002c6b0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002c6c0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0002c6d0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0002c6e0: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
-0002c6f0: 736f 7572 6365 732c 2068 6173 685f 6e61  sources, hash_na
-0002c700: 6d65 202c 2070 7265 6669 785f 6574 202b  me , prefix_et +
-0002c710: 2073 7473 5f65 6e74 6974 795f 756e 696f   sts_entity_unio
-0002c720: 6e5f 736f 7572 6365 735f 322c 0d0a 2020  n_sources_2,..  
-0002c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c750: 2068 6173 685f 6e61 6d65 2b20 225f 3222   hash_name+ "_2"
-0002c760: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c780: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-0002c790: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-0002c7a0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-0002c7b0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0002c7c0: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
-0002c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c7e0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
-0002c7f0: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-0002c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c820: 2020 312c 204b 4559 5f54 5950 455f 4841    1, KEY_TYPE_HA
-0002c830: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
-0002c840: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0002c850: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0002c860: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
-0002c870: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0002c880: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0002c890: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-0002c8a0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-0002c8b0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-0002c8c0: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
-0002c8d0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-0002c8e0: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
-0002c8f0: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
-0002c900: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-0002c910: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002c920: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0002c930: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0002c940: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
-0002c950: 736f 7572 6365 732c 2027 4441 5445 5f43  sources, 'DATE_C
-0002c960: 5245 4154 4544 272c 2070 7265 6669 785f  REATED', prefix_
-0002c970: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-0002c980: 756e 696f 6e5f 736f 7572 6365 735f 322c  union_sources_2,
-0002c990: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c9b0: 2020 2020 2027 4441 5445 5f43 5245 4154       'DATE_CREAT
-0002c9c0: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
-0002c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c9e0: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
-0002c9f0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-0002ca00: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0002ca10: 6f6e 2c20 7379 7364 6174 655f 666f 725f  on, sysdate_for_
-0002ca20: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
-0002ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca50: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-0002ca60: 6164 6174 615b 325d 2c20 312c 204e 6f6e  adata[2], 1, Non
-0002ca70: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
-0002ca80: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
-0002ca90: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0002caa0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0002cab0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0002cac0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0002cad0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
-0002cae0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0002caf0: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
-0002cb00: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-0002cb10: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
-0002cb20: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-0002cb30: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-0002cb40: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-0002cb50: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-0002cb60: 732c 2072 6563 6f72 645f 736f 7572 6365  s, record_source
-0002cb70: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0002cb80: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0002b6e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002b6f0: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+0002b700: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+0002b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b730: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+0002b740: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+0002b750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b770: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0002b780: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
+0002b790: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+0002b7a0: 7369 7469 6f6e 2c20 6170 706c 6965 645f  sition, applied_
+0002b7b0: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
+0002b7c0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0002b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b7e0: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0002b7f0: 6461 7465 2e63 6f6c 756d 6e5f 7072 6563  date.column_prec
+0002b800: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0002b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b820: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+0002b830: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
+0002b840: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
+0002b850: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0002b860: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0002b870: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+0002b880: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0002b890: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+0002b8a0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+0002b8b0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+0002b8c0: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+0002b8d0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0002b8e0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0002b8f0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+0002b900: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+0002b910: 5f32 2c20 6861 7368 5f6e 616d 652c 2070  _2, hash_name, p
+0002b920: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+0002b930: 6e74 6974 795f 6a6f 696e 2c20 6861 7368  ntity_join, hash
+0002b940: 5f6e 616d 6520 2b20 275f 4849 5354 272c  _name + '_HIST',
+0002b950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b970: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0002b980: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0002b990: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+0002b9a0: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+0002b9b0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+0002b9c0: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
+0002b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b9e0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+0002b9f0: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+0002ba00: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0002ba10: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0002ba20: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0002ba30: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0002ba40: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0002ba50: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002ba60: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0002ba70: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0002ba80: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+0002ba90: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+0002baa0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
+0002bab0: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+0002bac0: 2c20 2744 565f 5354 4154 5553 272c 0d0a  , 'DV_STATUS',..
+0002bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bae0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002baf0: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+0002bb00: 6e74 6974 795f 6a6f 696e 2c20 2744 565f  ntity_join, 'DV_
+0002bb10: 5354 4154 5553 5f48 4953 5427 2c0d 0a20  STATUS_HIST',.. 
+0002bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bb30: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0002bb40: 7263 6861 725f 666f 725f 6d65 7461 6461  rchar_for_metada
+0002bb50: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0002bb60: 6f73 6974 696f 6e2c 2031 2c20 302c 0d0a  osition, 1, 0,..
+0002bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bb80: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+0002bb90: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
+0002bba0: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
+0002bbb0: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
+0002bbc0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+0002bbd0: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+0002bbe0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0002bbf0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0002bc00: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0002bc10: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0002bc20: 5d29 0d0a 0d0a 2020 2020 2020 2020 6966  ])....        if
+0002bc30: 2068 6173 5f72 733a 0d0a 2020 2020 2020   has_rs:..      
+0002bc40: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+0002bc50: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
+0002bc60: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
+0002bc70: 6563 6f72 645f 736f 7572 6365 5f6f 6e5f  ecord_source_on_
+0002bc80: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
+0002bc90: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
+0002bca0: 6d5f 6272 616e 6368 280d 0a20 2020 2020  m_branch(..     
+0002bcb0: 2020 2020 2020 2020 2020 2063 6f64 5f65             cod_e
+0002bcc0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
+0002bcd0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+0002bce0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0002bcf0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+0002bd00: 2073 7473 5f65 6e74 6974 795f 6163 7475   sts_entity_actu
+0002bd10: 616c 5f69 6d61 6765 5f32 2c20 7265 636f  al_image_2, reco
+0002bd20: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+0002bd30: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0002bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd60: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
+0002bd70: 735f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  s_entity_join,..
+0002bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bda0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0002bdb0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0002bdc0: 6765 7420 2b20 225f 4849 5354 222c 0d0a  get + "_HIST",..
+0002bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bdf0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0002be00: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0002be10: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0002be20: 6974 696f 6e2c 2072 6563 6f72 645f 736f  ition, record_so
+0002be30: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+0002be40: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0002be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be60: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+0002be70: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
+0002be80: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0002be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bea0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+0002beb0: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
+0002bec0: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
+0002bed0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0002bee0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0002bef0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0002bf00: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0002bf10: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0002bf20: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0002bf30: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0002bf40: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+0002bf50: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
+0002bf60: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+0002bf70: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
+0002bf80: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0002bf90: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
+0002bfa0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
+0002bfb0: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
+0002bfc0: 5f6e 756d 5f62 7261 6e63 6828 0d0a 2020  _num_branch(..  
+0002bfd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0002bfe0: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
+0002bff0: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
+0002c000: 2066 6f72 2074 6e20 696e 2074 656e 616e   for tn in tenan
+0002c010: 745f 736f 7572 6365 3a0d 0a20 2020 2020  t_source:..     
+0002c020: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0002c030: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0002c040: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+0002c050: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+0002c060: 696d 6167 655f 322c 2074 6e2e 636f 6c75  image_2, tn.colu
+0002c070: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+0002c080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c0a0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0002c0b0: 7420 2b20 7374 735f 656e 7469 7479 5f6a  t + sts_entity_j
+0002c0c0: 6f69 6e2c 0d0a 2020 2020 2020 2020 2020  oin,..          
+0002c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c0e0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+0002c0f0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+0002c100: 6574 202b 2022 5f48 4953 5422 2c0d 0a20  et + "_HIST",.. 
+0002c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c130: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+0002c140: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+0002c150: 696e 616c 5f70 6f73 6974 696f 6e2c 2074  inal_position, t
+0002c160: 6e2e 636f 6c75 6d6e 5f6c 656e 6774 682c  n.column_length,
+0002c170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c190: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+0002c1a0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+0002c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c1d0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+0002c1e0: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
+0002c1f0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0002c200: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0002c210: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0002c220: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0002c230: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0002c240: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0002c250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002c260: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0002c270: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+0002c280: 2020 2069 6620 6861 735f 6164 3a0d 0a20     if has_ad:.. 
+0002c290: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0002c2a0: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
+0002c2b0: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0002c2c0: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
+0002c2d0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
+0002c2e0: 6e74 6974 795f 7461 7267 6574 2864 765f  ntity_target(dv_
+0002c2f0: 656e 7469 7479 2e63 6f64 5f65 6e74 6974  entity.cod_entit
+0002c300: 792c 2031 290d 0a20 2020 2020 2020 2020  y, 1)..         
+0002c310: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0002c320: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+0002c330: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+0002c340: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
+0002c350: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+0002c360: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+0002c370: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c390: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+0002c3a0: 2b20 7374 735f 656e 7469 7479 5f6a 6f69  + sts_entity_joi
+0002c3b0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+0002c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c3d0: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
+0002c3e0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+0002c3f0: 7461 7267 6574 202b 2022 5f48 4953 5422  target + "_HIST"
+0002c400: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c420: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+0002c430: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
+0002c440: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
+0002c450: 6f73 6974 696f 6e2c 2061 7070 6c69 6564  osition, applied
+0002c460: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
+0002c470: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
+0002c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c490: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+0002c4a0: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
+0002c4b0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0002c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c4d0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+0002c4e0: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
+0002c4f0: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
+0002c500: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002c510: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0002c520: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+0002c530: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0002c540: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+0002c550: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+0002c560: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+0002c570: 745f 6d61 7070 696e 675d 290d 0a0d 0a0d  t_mapping]).....
+0002c580: 0a0d 0a20 2020 2020 2020 2023 2323 2323  ...        #####
+0002c590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002c5a0: 2323 2043 6173 6520 666f 7220 4461 7461  ## Case for Data
+0002c5b0: 6261 7365 7320 7468 6174 2064 6f65 736e  bases that doesn
+0002c5c0: 2774 2068 6176 6520 4f55 5445 5220 4a4f  't have OUTER JO
+0002c5d0: 494e 2023 2323 2323 2323 2323 2323 2323  IN #############
+0002c5e0: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
+0002c5f0: 2020 2020 6966 2073 656c 662e 636f 6e6e      if self.conn
+0002c600: 6563 7469 6f6e 2e67 6574 5f63 6f6e 6e65  ection.get_conne
+0002c610: 6374 696f 6e5f 7479 7065 2829 2069 6e20  ction_type() in 
+0002c620: 434f 4e4e 4543 5449 4f4e 535f 5749 5448  CONNECTIONS_WITH
+0002c630: 4f55 545f 4f55 5445 525f 4a4f 494e 3a0d  OUT_OUTER_JOIN:.
+0002c640: 0a0d 0a20 2020 2020 2020 2020 2020 206e  ...            n
+0002c650: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
+0002c660: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0002c670: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
+0002c680: 736f 7572 6365 732c 2068 6173 685f 6e61  sources, hash_na
+0002c690: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
+0002c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c6b0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+0002c6c0: 2073 7473 5f65 6e74 6974 795f 6163 7475   sts_entity_actu
+0002c6d0: 616c 5f69 6d61 6765 5f32 2c0d 0a20 2020  al_image_2,..   
+0002c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c6f0: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0002c700: 685f 6e61 6d65 2c20 224d 4153 5445 5220  h_name, "MASTER 
+0002c710: 4a4f 494e 222c 2073 656c 662e 6f77 6e65  JOIN", self.owne
+0002c720: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+0002c730: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0002c740: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0002c750: 6174 6173 6574 5f72 656c 6174 696f 6e73  ataset_relations
+0002c760: 6869 7028 5b6e 6577 5f72 656c 6174 696f  hip([new_relatio
+0002c770: 6e73 6869 705d 290d 0a0d 0a20 2020 2020  nship])....     
+0002c780: 2020 2020 2020 2023 2323 2323 2047 6574         ##### Get
+0002c790: 2061 6e6f 7468 6572 2055 4e49 4f4e 2053   another UNION S
+0002c7a0: 5453 2074 6f20 7365 7420 6e65 7720 7265  TS to set new re
+0002c7b0: 6c61 7469 6f6e 7368 6970 0d0a 2020 2020  lationship..    
+0002c7c0: 2020 2020 2020 2020 7374 735f 656e 7469          sts_enti
+0002c7d0: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+0002c7e0: 5f32 203d 2027 5354 475f 544d 505f 554e  _2 = 'STG_TMP_UN
+0002c7f0: 494f 4e5f 325f 2720 2b20 7374 735f 6e61  ION_2_' + sts_na
+0002c800: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+0002c810: 6e65 775f 656e 7469 7479 5f73 7473 5f65  new_entity_sts_e
+0002c820: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
+0002c830: 6365 7320 3d20 5b70 7265 6669 785f 6574  ces = [prefix_et
+0002c840: 202b 2073 7473 5f65 6e74 6974 795f 756e   + sts_entity_un
+0002c850: 696f 6e5f 736f 7572 6365 735f 322c 2073  ion_sources_2, s
+0002c860: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
+0002c870: 736f 7572 6365 735f 322c 0d0a 2020 2020  sources_2,..    
+0002c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c8a0: 2020 2020 2020 2020 2020 2020 2020 2045                 E
+0002c8b0: 4e54 4954 595f 5749 5448 2c20 6476 5f65  NTITY_WITH, dv_e
+0002c8c0: 6e74 6974 792e 636f 645f 7061 7468 2c20  ntity.cod_path, 
+0002c8d0: 2727 2c20 7365 6c66 2e6f 776e 6572 5d0d  '', self.owner].
+0002c8e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002c8f0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0002c900: 6c2e 6164 645f 656e 7472 795f 656e 7469  l.add_entry_enti
+0002c910: 7479 285b 6e65 775f 656e 7469 7479 5f73  ty([new_entity_s
+0002c920: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
+0002c930: 736f 7572 6365 735d 290d 0a0d 0a20 2020  sources])....   
+0002c940: 2020 2020 2020 2020 2074 656e 616e 745f           tenant_
+0002c950: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
+0002c960: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+0002c970: 745f 7465 6e61 6e74 5f6f 6e5f 6476 5f66  t_tenant_on_dv_f
+0002c980: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
+0002c990: 6172 6765 745f 616e 645f 6e75 6d5f 6272  arget_and_num_br
+0002c9a0: 616e 6368 2863 6f64 5f65 6e74 6974 795f  anch(cod_entity_
+0002c9b0: 7461 7267 6574 2c20 3129 0d0a 2020 2020  target, 1)..    
+0002c9c0: 2020 2020 2020 2020 6966 206c 656e 2874          if len(t
+0002c9d0: 656e 616e 745f 736f 7572 6365 2920 213d  enant_source) !=
+0002c9e0: 2030 3a20 6861 735f 746e 203d 2054 7275   0: has_tn = Tru
+0002c9f0: 650d 0a20 2020 2020 2020 2020 2020 2072  e..            r
+0002ca00: 6563 6f72 645f 736f 7572 6365 203d 2073  ecord_source = s
+0002ca10: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0002ca20: 7561 6c2e 6765 745f 7265 636f 7264 5f73  ual.get_record_s
+0002ca30: 6f75 7263 655f 6f6e 5f64 765f 6672 6f6d  ource_on_dv_from
+0002ca40: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
+0002ca50: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
+0002ca60: 6828 636f 645f 656e 7469 7479 5f74 6172  h(cod_entity_tar
+0002ca70: 6765 742c 2031 290d 0a20 2020 2020 2020  get, 1)..       
+0002ca80: 2020 2020 2069 6620 7265 636f 7264 5f73       if record_s
+0002ca90: 6f75 7263 6520 6973 206e 6f74 204e 6f6e  ource is not Non
+0002caa0: 653a 2068 6173 5f72 7320 3d20 5472 7565  e: has_rs = True
+0002cab0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0002cac0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0002cad0: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+0002cae0: 696f 6e2e 6765 745f 6861 7368 5f66 6f72  ion.get_hash_for
+0002caf0: 5f6d 6574 6164 6174 6128 290d 0a0d 0a20  _metadata().... 
+0002cb00: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0002cb10: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0002cb20: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+0002cb30: 735f 656e 7469 7479 5f75 6e69 6f6e 5f73  s_entity_union_s
+0002cb40: 6f75 7263 6573 2c20 6861 7368 5f6e 616d  ources, hash_nam
+0002cb50: 6520 2c20 7072 6566 6978 5f65 7420 2b20  e , prefix_et + 
+0002cb60: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
+0002cb70: 5f73 6f75 7263 6573 5f32 2c0d 0a20 2020  _sources_2,..   
+0002cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cba0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0002cbb0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-0002cbc0: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-0002cbd0: 735f 322c 0d0a 2020 2020 2020 2020 2020  s_2,..          
-0002cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cbf0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-0002cc00: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-0002cc10: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+0002cba0: 6861 7368 5f6e 616d 652b 2022 5f32 222c  hash_name+ "_2",
+0002cbb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cbd0: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+0002cbe0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+0002cbf0: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+0002cc00: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+0002cc10: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
 0002cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc40: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-0002cc50: 7572 6365 2e63 6f6c 756d 6e5f 7479 7065  urce.column_type
-0002cc60: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
-0002cc70: 5f70 6f73 6974 696f 6e2c 0d0a 2020 2020  _position,..    
-0002cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cca0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-0002ccb0: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0002ccc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cce0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-0002ccf0: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
-0002cd00: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-0002cd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cd30: 312c 204b 4559 5f54 5950 455f 5245 434f  1, KEY_TYPE_RECO
-0002cd40: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
-0002cd50: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0002cd60: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-0002cd70: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0002cd80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002cd90: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0002cda0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0002cdb0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0002cdc0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0002cdd0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0002cde0: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
-0002cdf0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-0002ce00: 2020 2020 666f 7220 746e 2069 6e20 7465      for tn in te
-0002ce10: 6e61 6e74 5f73 6f75 7263 653a 0d0a 2020  nant_source:..  
+0002cc30: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
+0002cc40: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+0002cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cc70: 2031 2c20 4b45 595f 5459 5045 5f48 4153   1, KEY_TYPE_HAS
+0002cc80: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
+0002cc90: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0002cca0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0002ccb0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0002ccc0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+0002ccd0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+0002cce0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+0002ccf0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+0002cd00: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+0002cd10: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
+0002cd20: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+0002cd30: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
+0002cd40: 6f6e 2e67 6574 5f73 7973 6461 7465 5f66  on.get_sysdate_f
+0002cd50: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
+0002cd60: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0002cd70: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0002cd80: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+0002cd90: 735f 656e 7469 7479 5f75 6e69 6f6e 5f73  s_entity_union_s
+0002cda0: 6f75 7263 6573 2c20 2744 4154 455f 4352  ources, 'DATE_CR
+0002cdb0: 4541 5445 4427 2c20 7072 6566 6978 5f65  EATED', prefix_e
+0002cdc0: 7420 2b20 7374 735f 656e 7469 7479 5f75  t + sts_entity_u
+0002cdd0: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c0d  nion_sources_2,.
+0002cde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ce00: 2020 2020 2744 4154 455f 4352 4541 5445      'DATE_CREATE
+0002ce10: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
 0002ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce30: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0002ce40: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0002ce50: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-0002ce60: 756e 696f 6e5f 736f 7572 6365 732c 2074  union_sources, t
-0002ce70: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-0002ce80: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0002ce30: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+0002ce40: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+0002ce50: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0002ce60: 6e2c 2073 7973 6461 7465 5f66 6f72 5f6d  n, sysdate_for_m
+0002ce70: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
+0002ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ceb0: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
-0002cec0: 735f 656e 7469 7479 5f75 6e69 6f6e 5f73  s_entity_union_s
-0002ced0: 6f75 7263 6573 5f32 2c0d 0a20 2020 2020  ources_2,..     
-0002cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf00: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-0002cf10: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-0002cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf40: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-0002cf50: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0002cf60: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0002cf70: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
-0002cf80: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-0002cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cfb0: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
-0002cfc0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-0002cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cea0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0002ceb0: 6461 7461 5b32 5d2c 2031 2c20 4e6f 6e65  data[2], 1, None
+0002cec0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+0002ced0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0002cee0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0002cef0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0002cf00: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+0002cf10: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+0002cf20: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+0002cf30: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0002cf40: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+0002cf50: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
+0002cf60: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
+0002cf70: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0002cf80: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+0002cf90: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+0002cfa0: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+0002cfb0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
+0002cfc0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+0002cfd0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
 0002cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cff0: 2031 2c20 4b45 595f 5459 5045 5f54 454e   1, KEY_TYPE_TEN
-0002d000: 414e 542c 2031 2c20 7365 6c66 2e6f 776e  ANT, 1, self.own
-0002d010: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-0002d020: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0002d030: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-0002d040: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-0002d050: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-0002d060: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-0002d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d080: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0002d090: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
-0002d0a0: 2020 2020 2020 2020 2020 6966 2068 6173            if has
-0002d0b0: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
-0002d0c0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-0002d0d0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-0002d0e0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-0002d0f0: 6974 795f 756e 696f 6e5f 736f 7572 6365  ity_union_source
-0002d100: 732c 2061 7070 6c69 6564 5f64 6174 652e  s, applied_date.
-0002d110: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-0002d120: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-0002d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d140: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0002d150: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
-0002d160: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
-0002d170: 5f32 2c0d 0a20 2020 2020 2020 2020 2020  _2,..           
-0002d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d190: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0002d1a0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-0002d1b0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-0002d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d1e0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-0002d1f0: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
-0002d200: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-0002d210: 7369 7469 6f6e 2c20 6170 706c 6965 645f  sition, applied_
-0002d220: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
-0002d230: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-0002d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d250: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0002d260: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-0002d270: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-0002d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d2a0: 2020 2031 2c20 4b45 595f 5459 5045 5f41     1, KEY_TYPE_A
-0002d2b0: 5050 4c49 4544 5f44 4154 452c 2031 2c20  PPLIED_DATE, 1, 
-0002d2c0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0002d2d0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-0002d2e0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-0002d2f0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-0002d300: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0002d310: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0002d320: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0002d330: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0002d340: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-0002d350: 2020 2020 2020 2020 2020 6e65 775f 7265            new_re
-0002d360: 6c61 7469 6f6e 7368 6970 203d 205b 7072  lationship = [pr
-0002d370: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-0002d380: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0002d390: 655f 322c 2068 6173 685f 6e61 6d65 2c0d  e_2, hash_name,.
-0002d3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d3c0: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
-0002d3d0: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-0002d3e0: 7572 6365 735f 322c 0d0a 2020 2020 2020  urces_2,..      
-0002d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d400: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
-0002d410: 616d 652b 2022 5f32 222c 2022 4d41 5354  ame+ "_2", "MAST
-0002d420: 4552 204a 4f49 4e22 2c20 7365 6c66 2e6f  ER JOIN", self.o
-0002d430: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0002d440: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0002d450: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0002d460: 795f 6461 7461 7365 745f 7265 6c61 7469  y_dataset_relati
-0002d470: 6f6e 7368 6970 285b 6e65 775f 7265 6c61  onship([new_rela
-0002d480: 7469 6f6e 7368 6970 5d29 0d0a 0d0a 0d0a  tionship])......
-0002d490: 2020 2020 2020 2020 2020 2020 2323 2323              ####
-0002d4a0: 2320 5365 7420 6f75 7465 7220 6a6f 696e  # Set outer join
-0002d4b0: 2073 696d 756c 6174 696f 6e0d 0a20 2020   simulation..   
-0002d4c0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-0002d4d0: 5f70 6f73 6974 696f 6e20 3d20 310d 0a0d  _position = 1...
-0002d4e0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-0002d4f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0002d500: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0002d510: 7374 735f 656e 7469 7479 5f75 6e69 6f6e  sts_entity_union
-0002d520: 5f73 6f75 7263 6573 5f32 2c20 6861 7368  _sources_2, hash
-0002d530: 5f6e 616d 6520 2b20 225f 3222 2c0d 0a20  _name + "_2",.. 
-0002d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d560: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
-0002d570: 735f 656e 7469 7479 5f6a 6f69 6e2c 2068  s_entity_join, h
-0002d580: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
-0002d590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d5a0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0002d5b0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0002d5c0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-0002d5d0: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
-0002d5e0: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
-0002d5f0: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-0002d600: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002cff0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0002d000: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+0002d010: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+0002d020: 5f32 2c0d 0a20 2020 2020 2020 2020 2020  _2,..           
+0002d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d040: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+0002d050: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+0002d060: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+0002d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d090: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+0002d0a0: 7263 652e 636f 6c75 6d6e 5f74 7970 655f  rce.column_type_
+0002d0b0: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
+0002d0c0: 706f 7369 7469 6f6e 2c0d 0a20 2020 2020  position,..     
+0002d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0f0: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
+0002d100: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+0002d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d130: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+0002d140: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
+0002d150: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+0002d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d170: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+0002d180: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
+0002d190: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
+0002d1a0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0002d1b0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+0002d1c0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+0002d1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d1e0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0002d1f0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0002d200: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0002d210: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0002d220: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+0002d230: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
+0002d240: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0002d250: 2020 2066 6f72 2074 6e20 696e 2074 656e     for tn in ten
+0002d260: 616e 745f 736f 7572 6365 3a0d 0a20 2020  ant_source:..   
+0002d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d280: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0002d290: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0002d2a0: 7420 2b20 7374 735f 656e 7469 7479 5f75  t + sts_entity_u
+0002d2b0: 6e69 6f6e 5f73 6f75 7263 6573 2c20 746e  nion_sources, tn
+0002d2c0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0002d2d0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0002d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d300: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
+0002d310: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
+0002d320: 7572 6365 735f 322c 0d0a 2020 2020 2020  urces_2,..      
+0002d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d350: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+0002d360: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0002d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d390: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+0002d3a0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+0002d3b0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0002d3c0: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
+0002d3d0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0002d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d3f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002d400: 6e2e 636f 6c75 6d6e 5f70 7265 6369 7369  n.column_precisi
+0002d410: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0002d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d440: 312c 204b 4559 5f54 5950 455f 5445 4e41  1, KEY_TYPE_TENA
+0002d450: 4e54 2c20 312c 2073 656c 662e 6f77 6e65  NT, 1, self.owne
+0002d460: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+0002d470: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0002d480: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0002d490: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0002d4a0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0002d4b0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0002d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d4d0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0002d4e0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+0002d4f0: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
+0002d500: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
+0002d510: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0002d520: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+0002d530: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+0002d540: 7479 5f75 6e69 6f6e 5f73 6f75 7263 6573  ty_union_sources
+0002d550: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
+0002d560: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+0002d570: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0002d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d590: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0002d5a0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
+0002d5b0: 795f 756e 696f 6e5f 736f 7572 6365 735f  y_union_sources_
+0002d5c0: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+0002d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d5e0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0002d5f0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+0002d600: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
 0002d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d620: 2020 2020 2020 322c 204b 4559 5f54 5950        2, KEY_TYP
-0002d630: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-0002d640: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0002d650: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0002d660: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-0002d670: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002d680: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0002d690: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0002d6a0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0002d6b0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0002d6c0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0002d6d0: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-0002d6e0: 6164 6174 6120 3d20 7365 6c66 2e63 6f6e  adata = self.con
-0002d6f0: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
-0002d700: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-0002d710: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
-0002d720: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0002d730: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0002d740: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-0002d750: 756e 696f 6e5f 736f 7572 6365 735f 322c  union_sources_2,
-0002d760: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
-0002d770: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
-0002d780: 5f65 6e74 6974 795f 6a6f 696e 2c0d 0a20  _entity_join,.. 
-0002d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d7b0: 2020 2744 4154 455f 4352 4541 5445 4427    'DATE_CREATED'
-0002d7c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d7e0: 2020 2020 2020 7379 7364 6174 655f 666f        sysdate_fo
-0002d7f0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-0002d800: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0002d810: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-0002d820: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
-0002d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d840: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0002d850: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-0002d860: 7461 5b32 5d2c 2032 2c20 4e6f 6e65 2c20  ta[2], 2, None, 
-0002d870: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0002d880: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0002d890: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0002d8a0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0002d8b0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0002d8c0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0002d8d0: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-0002d8e0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-0002d8f0: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-0002d900: 2020 2020 2020 2076 6172 6368 6172 5f66         varchar_f
-0002d910: 6f72 5f6d 6574 6164 6174 6120 3d20 7365  or_metadata = se
-0002d920: 6c66 2e63 6f6e 6e65 6374 696f 6e2e 6765  lf.connection.ge
-0002d930: 745f 7374 7269 6e67 5f66 6f72 5f6d 6574  t_string_for_met
-0002d940: 6164 6174 6128 290d 0a20 2020 2020 2020  adata()..       
-0002d950: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0002d960: 5f6d 6170 7069 6e67 203d 205b 2727 2c20  _mapping = ['', 
-0002d970: 2227 4927 222c 0d0a 2020 2020 2020 2020  "'I'",..        
-0002d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d990: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0002d9a0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-0002d9b0: 795f 6a6f 696e 2c20 2744 565f 5354 4154  y_join, 'DV_STAT
-0002d9c0: 5553 5f49 4e53 4552 5427 2c0d 0a20 2020  US_INSERT',..   
-0002d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d630: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0002d640: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0002d650: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0002d660: 6974 696f 6e2c 2061 7070 6c69 6564 5f64  ition, applied_d
+0002d670: 6174 652e 636f 6c75 6d6e 5f6c 656e 6774  ate.column_lengt
+0002d680: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0002d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d6a0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0002d6b0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f70  ed_date.column_p
+0002d6c0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+0002d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d6f0: 2020 312c 204b 4559 5f54 5950 455f 4150    1, KEY_TYPE_AP
+0002d700: 504c 4945 445f 4441 5445 2c20 312c 2073  PLIED_DATE, 1, s
+0002d710: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0002d720: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+0002d730: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+0002d740: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+0002d750: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0002d760: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0002d770: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+0002d780: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+0002d790: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
+0002d7a0: 2020 2020 2020 2020 206e 6577 5f72 656c           new_rel
+0002d7b0: 6174 696f 6e73 6869 7020 3d20 5b70 7265  ationship = [pre
+0002d7c0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+0002d7d0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+0002d7e0: 5f32 2c20 6861 7368 5f6e 616d 652c 0d0a  _2, hash_name,..
+0002d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d810: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+0002d820: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+0002d830: 7263 6573 5f32 2c0d 0a20 2020 2020 2020  rces_2,..       
+0002d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d850: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
+0002d860: 6d65 2b20 225f 3222 2c20 224d 4153 5445  me+ "_2", "MASTE
+0002d870: 5220 4a4f 494e 222c 2073 656c 662e 6f77  R JOIN", self.ow
+0002d880: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002d890: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0002d8a0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0002d8b0: 5f64 6174 6173 6574 5f72 656c 6174 696f  _dataset_relatio
+0002d8c0: 6e73 6869 7028 5b6e 6577 5f72 656c 6174  nship([new_relat
+0002d8d0: 696f 6e73 6869 705d 290d 0a0d 0a0d 0a20  ionship])...... 
+0002d8e0: 2020 2020 2020 2020 2020 2023 2323 2323             #####
+0002d8f0: 2053 6574 206f 7574 6572 206a 6f69 6e20   Set outer join 
+0002d900: 7369 6d75 6c61 7469 6f6e 0d0a 2020 2020  simulation..    
+0002d910: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0002d920: 706f 7369 7469 6f6e 203d 2031 0d0a 0d0a  position = 1....
+0002d930: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0002d940: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0002d950: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0002d960: 7473 5f65 6e74 6974 795f 756e 696f 6e5f  ts_entity_union_
+0002d970: 736f 7572 6365 735f 322c 2068 6173 685f  sources_2, hash_
+0002d980: 6e61 6d65 202b 2022 5f32 222c 0d0a 2020  name + "_2",..  
+0002d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d9b0: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
+0002d9c0: 5f65 6e74 6974 795f 6a6f 696e 2c20 6861  _entity_join, ha
+0002d9d0: 7368 5f6e 616d 652c 0d0a 2020 2020 2020  sh_name,..      
 0002d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d9f0: 7661 7263 6861 725f 666f 725f 6d65 7461  varchar_for_meta
-0002da00: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-0002da10: 5f70 6f73 6974 696f 6e2c 2031 2c0d 0a20  _position, 1,.. 
-0002da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002da40: 2020 7661 7263 6861 725f 666f 725f 6d65    varchar_for_me
-0002da50: 7461 6461 7461 5b32 5d2c 2032 2c20 4e6f  tadata[2], 2, No
-0002da60: 6e65 2c20 312c 2073 656c 662e 6f77 6e65  ne, 1, self.owne
-0002da70: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-0002da80: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0002da90: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-0002daa0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-0002dab0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-0002dac0: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
-0002dad0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0002dae0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-0002daf0: 2020 2020 2020 2020 2076 6172 6368 6172           varchar
-0002db00: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
-0002db10: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
-0002db20: 6765 745f 7374 7269 6e67 5f66 6f72 5f6d  get_string_for_m
-0002db30: 6574 6164 6174 6128 290d 0a20 2020 2020  etadata()..     
-0002db40: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0002db50: 6574 5f6d 6170 7069 6e67 203d 205b 2727  et_mapping = [''
-0002db60: 2c20 2227 4427 222c 0d0a 2020 2020 2020  , "'D'",..      
-0002db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db80: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-0002db90: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-0002dba0: 6974 795f 6a6f 696e 2c20 2744 565f 5354  ity_join, 'DV_ST
-0002dbb0: 4154 5553 5f44 454c 4554 4527 2c0d 0a20  ATUS_DELETE',.. 
-0002dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dbe0: 2020 7661 7263 6861 725f 666f 725f 6d65    varchar_for_me
-0002dbf0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-0002dc00: 616c 5f70 6f73 6974 696f 6e2c 2031 2c0d  al_position, 1,.
-0002dc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002d9f0: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0002da00: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+0002da10: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+0002da20: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+0002da30: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
+0002da40: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0002da50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002da70: 2020 2020 2032 2c20 4b45 595f 5459 5045       2, KEY_TYPE
+0002da80: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+0002da90: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0002daa0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0002dab0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+0002dac0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0002dad0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0002dae0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0002daf0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0002db00: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0002db10: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0002db20: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0002db30: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
+0002db40: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
+0002db50: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
+0002db60: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0002db70: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0002db80: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0002db90: 7420 2b20 7374 735f 656e 7469 7479 5f75  t + sts_entity_u
+0002dba0: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c20  nion_sources_2, 
+0002dbb0: 2744 4154 455f 4352 4541 5445 4427 2c20  'DATE_CREATED', 
+0002dbc0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+0002dbd0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+0002dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc00: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
+0002dc10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0002dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dc30: 2020 2020 7661 7263 6861 725f 666f 725f      varchar_for_
-0002dc40: 6d65 7461 6461 7461 5b32 5d2c 2032 2c20  metadata[2], 2, 
-0002dc50: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
-0002dc60: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-0002dc70: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0002dc80: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0002dc90: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0002dca0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0002dcb0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-0002dcc0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0002dcd0: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-0002dce0: 2020 2020 2020 2020 2020 2076 6172 6368             varch
-0002dcf0: 6172 5f66 6f72 5f6d 6574 6164 6174 6120  ar_for_metadata 
-0002dd00: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
-0002dd10: 6e2e 6765 745f 7374 7269 6e67 5f66 6f72  n.get_string_for
-0002dd20: 5f6d 6574 6164 6174 6128 290d 0a20 2020  _metadata()..   
-0002dd30: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-0002dd40: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-0002dd50: 2727 2c20 2227 5527 222c 0d0a 2020 2020  '', "'U'",..    
-0002dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dd70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0002dd80: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-0002dd90: 6e74 6974 795f 6a6f 696e 2c20 2744 565f  ntity_join, 'DV_
-0002dda0: 5354 4154 5553 5f55 5044 4154 4527 2c0d  STATUS_UPDATE',.
-0002ddb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ddd0: 2020 2020 7661 7263 6861 725f 666f 725f      varchar_for_
-0002dde0: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-0002ddf0: 696e 616c 5f70 6f73 6974 696f 6e2c 2031  inal_position, 1
-0002de00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002de10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de20: 2020 2020 2020 7661 7263 6861 725f 666f        varchar_fo
-0002de30: 725f 6d65 7461 6461 7461 5b32 5d2c 2032  r_metadata[2], 2
-0002de40: 2c20 4e6f 6e65 2c20 312c 2073 656c 662e  , None, 1, self.
-0002de50: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0002de60: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0002de70: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0002de80: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0002de90: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0002dea0: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-0002deb0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0002dec0: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-0002ded0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002dee0: 6861 735f 7273 3a0d 0a20 2020 2020 2020  has_rs:..       
-0002def0: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
-0002df00: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
-0002df10: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-0002df20: 745f 7265 636f 7264 5f73 6f75 7263 655f  t_record_source_
-0002df30: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-0002df40: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-0002df50: 5f6e 756d 5f62 7261 6e63 6828 636f 645f  _num_branch(cod_
-0002df60: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
-0002df70: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0002df80: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0002df90: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-0002dfa0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
-0002dfb0: 5f75 6e69 6f6e 5f73 6f75 7263 6573 5f32  _union_sources_2
-0002dfc0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-0002dfd0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-0002dfe0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-0002dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e000: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0002e010: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
-0002e020: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
-0002e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e050: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-0002e060: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0002e070: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0002e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e090: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0002e0a0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0002e0b0: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-0002e0c0: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
-0002e0d0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-0002e0e0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-0002e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e110: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-0002e120: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-0002e130: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0002e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e150: 2020 2020 2020 2020 2020 2020 322c 204b              2, K
-0002e160: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-0002e170: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-0002e180: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0002e190: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0002e1a0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-0002e1b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0002e1c0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0002e1d0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0002e1e0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0002e1f0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0002e200: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0002e210: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
-0002e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e230: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
-0002e240: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0002e250: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
-0002e260: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-0002e270: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-0002e280: 5f6e 756d 5f62 7261 6e63 6828 636f 645f  _num_branch(cod_
-0002e290: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
-0002e2a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0002e2b0: 2020 2066 6f72 2074 6e20 696e 2074 656e     for tn in ten
-0002e2c0: 616e 745f 736f 7572 6365 3a0d 0a20 2020  ant_source:..   
-0002e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e2e0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0002e2f0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0002e300: 7420 2b20 7374 735f 656e 7469 7479 5f75  t + sts_entity_u
-0002e310: 6e69 6f6e 5f73 6f75 7263 6573 5f32 2c20  nion_sources_2, 
-0002e320: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
-0002e330: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0002e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e360: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0002e370: 7473 5f65 6e74 6974 795f 6a6f 696e 2c0d  ts_entity_join,.
-0002e380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e3a0: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-0002e3b0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0002e3c0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0002e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e3e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0002e3f0: 6e2e 636f 6c75 6d6e 5f74 7970 655f 7461  n.column_type_ta
-0002e400: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-0002e410: 7369 7469 6f6e 2c20 746e 2e63 6f6c 756d  sition, tn.colum
-0002e420: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
-0002e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc30: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+0002dc40: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+0002dc50: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0002dc60: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+0002dc70: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+0002dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc90: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0002dca0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+0002dcb0: 615b 325d 2c20 322c 204e 6f6e 652c 2031  a[2], 2, None, 1
+0002dcc0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a0d  , self.owner]...
+0002dcd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002dce0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0002dcf0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0002dd00: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0002dd10: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0002dd20: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+0002dd30: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0002dd40: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+0002dd50: 2020 2020 2020 7661 7263 6861 725f 666f        varchar_fo
+0002dd60: 725f 6d65 7461 6461 7461 203d 2073 656c  r_metadata = sel
+0002dd70: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
+0002dd80: 5f73 7472 696e 675f 666f 725f 6d65 7461  _string_for_meta
+0002dd90: 6461 7461 2829 0d0a 2020 2020 2020 2020  data()..        
+0002dda0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+0002ddb0: 6d61 7070 696e 6720 3d20 5b27 272c 2022  mapping = ['', "
+0002ddc0: 2749 2722 2c0d 0a20 2020 2020 2020 2020  'I'",..         
+0002ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dde0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0002ddf0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+0002de00: 5f6a 6f69 6e2c 2027 4456 5f53 5441 5455  _join, 'DV_STATU
+0002de10: 535f 494e 5345 5254 272c 0d0a 2020 2020  S_INSERT',..    
+0002de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0002de40: 6172 6368 6172 5f66 6f72 5f6d 6574 6164  archar_for_metad
+0002de50: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+0002de60: 706f 7369 7469 6f6e 2c20 312c 0d0a 2020  position, 1,..  
+0002de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de90: 2076 6172 6368 6172 5f66 6f72 5f6d 6574   varchar_for_met
+0002dea0: 6164 6174 615b 325d 2c20 322c 204e 6f6e  adata[2], 2, Non
+0002deb0: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
+0002dec0: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+0002ded0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0002dee0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+0002def0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+0002df00: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0002df10: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
+0002df20: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0002df30: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+0002df40: 2020 2020 2020 2020 7661 7263 6861 725f          varchar_
+0002df50: 666f 725f 6d65 7461 6461 7461 203d 2073  for_metadata = s
+0002df60: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
+0002df70: 6574 5f73 7472 696e 675f 666f 725f 6d65  et_string_for_me
+0002df80: 7461 6461 7461 2829 0d0a 2020 2020 2020  tadata()..      
+0002df90: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0002dfa0: 745f 6d61 7070 696e 6720 3d20 5b27 272c  t_mapping = ['',
+0002dfb0: 2022 2744 2722 2c0d 0a20 2020 2020 2020   "'D'",..       
+0002dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dfd0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0002dfe0: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+0002dff0: 7479 5f6a 6f69 6e2c 2027 4456 5f53 5441  ty_join, 'DV_STA
+0002e000: 5455 535f 4445 4c45 5445 272c 0d0a 2020  TUS_DELETE',..  
+0002e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e030: 2076 6172 6368 6172 5f66 6f72 5f6d 6574   varchar_for_met
+0002e040: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+0002e050: 6c5f 706f 7369 7469 6f6e 2c20 312c 0d0a  l_position, 1,..
+0002e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e080: 2020 2076 6172 6368 6172 5f66 6f72 5f6d     varchar_for_m
+0002e090: 6574 6164 6174 615b 325d 2c20 322c 204e  etadata[2], 2, N
+0002e0a0: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
+0002e0b0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+0002e0c0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0002e0d0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+0002e0e0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+0002e0f0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+0002e100: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+0002e110: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0002e120: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0002e130: 2020 2020 2020 2020 2020 7661 7263 6861            varcha
+0002e140: 725f 666f 725f 6d65 7461 6461 7461 203d  r_for_metadata =
+0002e150: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
+0002e160: 2e67 6574 5f73 7472 696e 675f 666f 725f  .get_string_for_
+0002e170: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
+0002e180: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0002e190: 7365 745f 6d61 7070 696e 6720 3d20 5b27  set_mapping = ['
+0002e1a0: 272c 2022 2755 2722 2c0d 0a20 2020 2020  ', "'U'",..     
+0002e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e1c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0002e1d0: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+0002e1e0: 7469 7479 5f6a 6f69 6e2c 2027 4456 5f53  tity_join, 'DV_S
+0002e1f0: 5441 5455 535f 5550 4441 5445 272c 0d0a  TATUS_UPDATE',..
+0002e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e220: 2020 2076 6172 6368 6172 5f66 6f72 5f6d     varchar_for_m
+0002e230: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+0002e240: 6e61 6c5f 706f 7369 7469 6f6e 2c20 312c  nal_position, 1,
+0002e250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e270: 2020 2020 2076 6172 6368 6172 5f66 6f72       varchar_for
+0002e280: 5f6d 6574 6164 6174 615b 325d 2c20 322c  _metadata[2], 2,
+0002e290: 204e 6f6e 652c 2031 2c20 7365 6c66 2e6f   None, 1, self.o
+0002e2a0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0002e2b0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0002e2c0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0002e2d0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+0002e2e0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+0002e2f0: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+0002e300: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0002e310: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+0002e320: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+0002e330: 6173 5f72 733a 0d0a 2020 2020 2020 2020  as_rs:..        
+0002e340: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+0002e350: 6f75 7263 6520 3d20 7365 6c66 2e6d 6574  ource = self.met
+0002e360: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+0002e370: 5f72 6563 6f72 645f 736f 7572 6365 5f6f  _record_source_o
+0002e380: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+0002e390: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+0002e3a0: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
+0002e3b0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
+0002e3c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002e3d0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0002e3e0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0002e3f0: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
+0002e400: 756e 696f 6e5f 736f 7572 6365 735f 322c  union_sources_2,
+0002e410: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+0002e420: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+0002e430: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
 0002e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e450: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-0002e460: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-0002e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e450: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0002e460: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
+0002e470: 795f 6a6f 696e 2c0d 0a20 2020 2020 2020  y_join,..       
 0002e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e490: 2020 2020 2020 2032 2c20 4b45 595f 5459         2, KEY_TY
-0002e4a0: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
-0002e4b0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0002e4c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002e4d0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0002e4e0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0002e4f0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0002e500: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0002e510: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-0002e520: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-0002e530: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0002e540: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0002e550: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
-0002e560: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0002e570: 6965 645f 6461 7465 203d 2073 656c 662e  ied_date = self.
-0002e580: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0002e590: 6765 745f 6170 706c 6965 645f 6461 7465  get_applied_date
-0002e5a0: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
-0002e5b0: 656e 7469 7479 5f74 6172 6765 7428 6476  entity_target(dv
-0002e5c0: 5f65 6e74 6974 792e 636f 645f 656e 7469  _entity.cod_enti
-0002e5d0: 7479 2c20 3129 0d0a 2020 2020 2020 2020  ty, 1)..        
-0002e5e0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0002e5f0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0002e600: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-0002e610: 6e74 6974 795f 756e 696f 6e5f 736f 7572  ntity_union_sour
-0002e620: 6365 735f 322c 2061 7070 6c69 6564 5f64  ces_2, applied_d
-0002e630: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-0002e640: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-0002e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e670: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002e680: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
-0002e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e6b0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-0002e6c0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-0002e6d0: 7267 6574 202c 0d0a 2020 2020 2020 2020  rget ,..        
-0002e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e6f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0002e700: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-0002e710: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0002e720: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0002e730: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
-0002e740: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-0002e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e770: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-0002e780: 7465 2e63 6f6c 756d 6e5f 7072 6563 6973  te.column_precis
-0002e790: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0002e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e4a0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+0002e4b0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+0002e4c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e4e0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+0002e4f0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
+0002e500: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+0002e510: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7265  nal_position, re
+0002e520: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+0002e530: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+0002e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e560: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0002e570: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+0002e580: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+0002e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e5a0: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
+0002e5b0: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+0002e5c0: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+0002e5d0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002e5e0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0002e5f0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0002e600: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002e610: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0002e620: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0002e630: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0002e640: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0002e650: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+0002e660: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+0002e670: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002e680: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
+0002e690: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0002e6a0: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
+0002e6b0: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+0002e6c0: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+0002e6d0: 6e75 6d5f 6272 616e 6368 2863 6f64 5f65  num_branch(cod_e
+0002e6e0: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
+0002e6f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002e700: 2020 666f 7220 746e 2069 6e20 7465 6e61    for tn in tena
+0002e710: 6e74 5f73 6f75 7263 653a 0d0a 2020 2020  nt_source:..    
+0002e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e730: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0002e740: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0002e750: 202b 2073 7473 5f65 6e74 6974 795f 756e   + sts_entity_un
+0002e760: 696f 6e5f 736f 7572 6365 735f 322c 2074  ion_sources_2, t
+0002e770: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
+0002e780: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0002e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e7b0: 2020 2020 2020 2020 2020 2020 2032 2c20               2, 
-0002e7c0: 4b45 595f 5459 5045 5f41 5050 4c49 4544  KEY_TYPE_APPLIED
-0002e7d0: 5f44 4154 452c 2031 2c20 7365 6c66 2e6f  _DATE, 1, self.o
-0002e7e0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0002e7f0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0002e800: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-0002e810: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0002e820: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0002e830: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0002e840: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0002e850: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0002e860: 6e67 5d29 0d0a 0d0a 0d0a 2020 2020 2020  ng])......      
-0002e870: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-0002e880: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-0002e890: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-0002e8a0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-0002e8b0: 5f32 2c20 6861 7368 5f6e 616d 652c 2070  _2, hash_name, p
-0002e8c0: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-0002e8d0: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
-0002e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e900: 6861 7368 5f6e 616d 6520 2b20 275f 4849  hash_name + '_HI
-0002e910: 5354 272c 0d0a 2020 2020 2020 2020 2020  ST',..          
-0002e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e930: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-0002e940: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
-0002e950: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0002e960: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-0002e970: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
-0002e980: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
-0002e990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e9b0: 2032 2c20 4b45 595f 5459 5045 5f48 4153   2, KEY_TYPE_HAS
-0002e9c0: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
-0002e9d0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0002e9e0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0002e9f0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-0002ea00: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-0002ea10: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-0002ea20: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-0002ea30: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-0002ea40: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-0002ea50: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0002ea60: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0002ea70: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0002ea80: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-0002ea90: 5f69 6d61 6765 5f32 2c20 2744 565f 5354  _image_2, 'DV_ST
-0002eaa0: 4154 5553 272c 0d0a 2020 2020 2020 2020  ATUS',..        
-0002eab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eac0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0002ead0: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-0002eae0: 795f 6a6f 696e 2c20 2744 565f 5354 4154  y_join, 'DV_STAT
-0002eaf0: 5553 5f48 4953 5427 2c0d 0a20 2020 2020  US_HIST',..     
-0002eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eb10: 2020 2020 2020 2020 2020 2020 2020 7661                va
-0002eb20: 7263 6861 725f 666f 725f 6d65 7461 6461  rchar_for_metada
-0002eb30: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
-0002eb40: 6f73 6974 696f 6e2c 2031 2c20 302c 0d0a  osition, 1, 0,..
-0002eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eb70: 2020 2032 2c20 4b45 595f 5459 5045 5f48     2, KEY_TYPE_H
-0002eb80: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
-0002eb90: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-0002eba0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0002ebb0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-0002ebc0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0002ebd0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0002ebe0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0002ebf0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0002ec00: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0002ec10: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0002ec20: 2068 6173 5f72 733a 0d0a 2020 2020 2020   has_rs:..      
-0002ec30: 2020 2020 2020 2020 2020 7265 636f 7264            record
-0002ec40: 5f73 6f75 7263 6520 3d20 7365 6c66 2e6d  _source = self.m
-0002ec50: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0002ec60: 6574 5f72 6563 6f72 645f 736f 7572 6365  et_record_source
-0002ec70: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
-0002ec80: 656e 7469 7479 5f74 6172 6765 745f 616e  entity_target_an
-0002ec90: 645f 6e75 6d5f 6272 616e 6368 280d 0a20  d_num_branch(.. 
-0002eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ecb0: 2020 2063 6f64 5f65 6e74 6974 795f 7461     cod_entity_ta
-0002ecc0: 7267 6574 2c20 3129 0d0a 2020 2020 2020  rget, 1)..      
-0002ecd0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-0002ece0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0002ecf0: 5b70 7265 6669 785f 6574 202b 2073 7473  [prefix_et + sts
-0002ed00: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0002ed10: 6d61 6765 5f32 2c20 7265 636f 7264 5f73  mage_2, record_s
-0002ed20: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-0002ed30: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-0002ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed60: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
-0002ed70: 735f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  s_entity_join,..
-0002ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eda0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-0002edb0: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-0002edc0: 5f74 6172 6765 7420 2b20 225f 4849 5354  _target + "_HIST
-0002edd0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0002e7b0: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
+0002e7c0: 735f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  s_entity_join,..
+0002e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e7f0: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+0002e800: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+0002e810: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e830: 2020 2020 2020 2020 2020 2020 2020 746e                tn
+0002e840: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0002e850: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0002e860: 6974 696f 6e2c 2074 6e2e 636f 6c75 6d6e  ition, tn.column
+0002e870: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+0002e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e8a0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
+0002e8b0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+0002e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e8e0: 2020 2020 2020 322c 204b 4559 5f54 5950        2, KEY_TYP
+0002e8f0: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
+0002e900: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0002e910: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0002e920: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0002e930: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+0002e940: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+0002e950: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0002e960: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+0002e970: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+0002e980: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+0002e990: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+0002e9a0: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
+0002e9b0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+0002e9c0: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
+0002e9d0: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0002e9e0: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
+0002e9f0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
+0002ea00: 6e74 6974 795f 7461 7267 6574 2864 765f  ntity_target(dv_
+0002ea10: 656e 7469 7479 2e63 6f64 5f65 6e74 6974  entity.cod_entit
+0002ea20: 792c 2031 290d 0a20 2020 2020 2020 2020  y, 1)..         
+0002ea30: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0002ea40: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0002ea50: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+0002ea60: 7469 7479 5f75 6e69 6f6e 5f73 6f75 7263  tity_union_sourc
+0002ea70: 6573 5f32 2c20 6170 706c 6965 645f 6461  es_2, applied_da
+0002ea80: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
+0002ea90: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0002eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eab0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002eac0: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+0002ead0: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+0002eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eb00: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+0002eb10: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0002eb20: 6765 7420 2c0d 0a20 2020 2020 2020 2020  get ,..         
+0002eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002eb40: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+0002eb50: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
+0002eb60: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+0002eb70: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0002eb80: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+0002eb90: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+0002eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ebc0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0002ebd0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+0002ebe0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0002ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ec00: 2020 2020 2020 2020 2020 2020 322c 204b              2, K
+0002ec10: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
+0002ec20: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
+0002ec30: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002ec40: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0002ec50: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0002ec60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002ec70: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0002ec80: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0002ec90: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0002eca0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0002ecb0: 675d 290d 0a0d 0a0d 0a20 2020 2020 2020  g])......       
+0002ecc0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0002ecd0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+0002ece0: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+0002ecf0: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+0002ed00: 322c 2068 6173 685f 6e61 6d65 2c20 7072  2, hash_name, pr
+0002ed10: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+0002ed20: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
+0002ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ed40: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0002ed50: 6173 685f 6e61 6d65 202b 2027 5f48 4953  ash_name + '_HIS
+0002ed60: 5427 2c0d 0a20 2020 2020 2020 2020 2020  T',..           
+0002ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ed80: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+0002ed90: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+0002eda0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0002edb0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0002edc0: 615b 315d 2c20 6861 7368 5f66 6f72 5f6d  a[1], hash_for_m
+0002edd0: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
 0002ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002edf0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-0002ee00: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-0002ee10: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-0002ee20: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
-0002ee30: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-0002ee40: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-0002ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ee70: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-0002ee80: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-0002ee90: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0002eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eeb0: 2020 2020 2020 2020 2020 2020 322c 204b              2, K
-0002eec0: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-0002eed0: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-0002eee0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0002eef0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0002ef00: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-0002ef10: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0002ef20: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0002ef30: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0002ef40: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0002ef50: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0002ef60: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0002ef70: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
-0002ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ef90: 7465 6e61 6e74 5f73 6f75 7263 6520 3d20  tenant_source = 
-0002efa0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0002efb0: 7475 616c 2e67 6574 5f74 656e 616e 745f  tual.get_tenant_
-0002efc0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-0002efd0: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
-0002efe0: 5f6e 756d 5f62 7261 6e63 6828 0d0a 2020  _num_branch(..  
-0002eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f000: 2020 636f 645f 656e 7469 7479 5f74 6172    cod_entity_tar
-0002f010: 6765 742c 2031 290d 0a20 2020 2020 2020  get, 1)..       
-0002f020: 2020 2020 2020 2020 2066 6f72 2074 6e20           for tn 
-0002f030: 696e 2074 656e 616e 745f 736f 7572 6365  in tenant_source
-0002f040: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0002f050: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0002f060: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0002f070: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-0002f080: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0002f090: 655f 322c 2074 6e2e 636f 6c75 6d6e 5f6e  e_2, tn.column_n
-0002f0a0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-0002f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f0d0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0002f0e0: 7420 2b20 7374 735f 656e 7469 7479 5f6a  t + sts_entity_j
-0002f0f0: 6f69 6e2c 0d0a 2020 2020 2020 2020 2020  oin,..          
-0002f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f120: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-0002f130: 7461 7267 6574 202b 2022 5f48 4953 5422  target + "_HIST"
-0002f140: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f160: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-0002f170: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-0002f180: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-0002f190: 6974 696f 6e2c 2074 6e2e 636f 6c75 6d6e  ition, tn.column
-0002f1a0: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
-0002f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f1d0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
-0002f1e0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-0002f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f210: 2020 2020 2020 322c 204b 4559 5f54 5950        2, KEY_TYP
-0002f220: 455f 5445 4e41 4e54 2c20 312c 2073 656c  E_TENANT, 1, sel
-0002f230: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0002f240: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0002f250: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0002f260: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0002f270: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0002f280: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0002f290: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-0002f2a0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-0002f2b0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0002f2c0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-0002f2d0: 6620 6861 735f 6164 3a0d 0a20 2020 2020  f has_ad:..     
-0002f2e0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-0002f2f0: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
-0002f300: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0002f310: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
-0002f320: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
-0002f330: 6e74 6974 795f 7461 7267 6574 2864 765f  ntity_target(dv_
-0002f340: 656e 7469 7479 2e63 6f64 5f65 6e74 6974  entity.cod_entit
-0002f350: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-0002f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3b0: 2020 2020 2020 3129 0d0a 2020 2020 2020        1)..      
-0002f3c0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-0002f3d0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0002f3e0: 5b70 7265 6669 785f 6574 202b 2073 7473  [prefix_et + sts
-0002f3f0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0002f400: 6d61 6765 5f32 2c20 6170 706c 6965 645f  mage_2, applied_
-0002f410: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0002f420: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-0002f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ee00: 322c 204b 4559 5f54 5950 455f 4841 5348  2, KEY_TYPE_HASH
+0002ee10: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
+0002ee20: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002ee30: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0002ee40: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+0002ee50: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0002ee60: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+0002ee70: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+0002ee80: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+0002ee90: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+0002eea0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0002eeb0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0002eec0: 205b 7072 6566 6978 5f65 7420 2b20 7374   [prefix_et + st
+0002eed0: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+0002eee0: 696d 6167 655f 322c 2027 4456 5f53 5441  image_2, 'DV_STA
+0002eef0: 5455 5327 2c0d 0a20 2020 2020 2020 2020  TUS',..         
+0002ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ef10: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0002ef20: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+0002ef30: 5f6a 6f69 6e2c 2027 4456 5f53 5441 5455  _join, 'DV_STATU
+0002ef40: 535f 4849 5354 272c 0d0a 2020 2020 2020  S_HIST',..      
+0002ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ef60: 2020 2020 2020 2020 2020 2020 2076 6172               var
+0002ef70: 6368 6172 5f66 6f72 5f6d 6574 6164 6174  char_for_metadat
+0002ef80: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+0002ef90: 7369 7469 6f6e 2c20 312c 2030 2c0d 0a20  sition, 1, 0,.. 
+0002efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002efc0: 2020 322c 204b 4559 5f54 5950 455f 4841    2, KEY_TYPE_HA
+0002efd0: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
+0002efe0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0002eff0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0002f000: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+0002f010: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0002f020: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0002f030: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0002f040: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0002f050: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+0002f060: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002f070: 6861 735f 7273 3a0d 0a20 2020 2020 2020  has_rs:..       
+0002f080: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+0002f090: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
+0002f0a0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+0002f0b0: 745f 7265 636f 7264 5f73 6f75 7263 655f  t_record_source_
+0002f0c0: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
+0002f0d0: 6e74 6974 795f 7461 7267 6574 5f61 6e64  ntity_target_and
+0002f0e0: 5f6e 756d 5f62 7261 6e63 6828 0d0a 2020  _num_branch(..  
+0002f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f100: 2020 636f 645f 656e 7469 7479 5f74 6172    cod_entity_tar
+0002f110: 6765 742c 2031 290d 0a20 2020 2020 2020  get, 1)..       
+0002f120: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+0002f130: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+0002f140: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+0002f150: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+0002f160: 6167 655f 322c 2072 6563 6f72 645f 736f  age_2, record_so
+0002f170: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+0002f180: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+0002f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1b0: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
+0002f1c0: 5f65 6e74 6974 795f 6a6f 696e 2c0d 0a20  _entity_join,.. 
+0002f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f1f0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+0002f200: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+0002f210: 7461 7267 6574 202b 2022 5f48 4953 5422  target + "_HIST"
+0002f220: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0002f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f240: 2020 2020 2020 2020 2020 7265 636f 7264            record
+0002f250: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
+0002f260: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+0002f270: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7265  nal_position, re
+0002f280: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+0002f290: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+0002f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f2c0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+0002f2d0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+0002f2e0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+0002f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f300: 2020 2020 2020 2020 2020 2032 2c20 4b45             2, KE
+0002f310: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+0002f320: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+0002f330: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0002f340: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0002f350: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0002f360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002f370: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0002f380: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0002f390: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0002f3a0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0002f3b0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+0002f3c0: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+0002f3d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002f3e0: 656e 616e 745f 736f 7572 6365 203d 2073  enant_source = s
+0002f3f0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0002f400: 7561 6c2e 6765 745f 7465 6e61 6e74 5f6f  ual.get_tenant_o
+0002f410: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+0002f420: 7469 7479 5f74 6172 6765 745f 616e 645f  tity_target_and_
+0002f430: 6e75 6d5f 6272 616e 6368 280d 0a20 2020  num_branch(..   
 0002f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f450: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
-0002f460: 5f65 6e74 6974 795f 6a6f 696e 2c0d 0a20  _entity_join,.. 
-0002f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f490: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-0002f4a0: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
-0002f4b0: 6172 6765 7420 2b20 225f 4849 5354 222c  arget + "_HIST",
-0002f4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f4e0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-0002f4f0: 5f64 6174 652e 636f 6c75 6d6e 5f74 7970  _date.column_typ
-0002f500: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-0002f510: 6c5f 706f 7369 7469 6f6e 2c20 6170 706c  l_position, appl
-0002f520: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-0002f530: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0002f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f450: 2063 6f64 5f65 6e74 6974 795f 7461 7267   cod_entity_targ
+0002f460: 6574 2c20 3129 0d0a 2020 2020 2020 2020  et, 1)..        
+0002f470: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
+0002f480: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
+0002f490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002f4a0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0002f4b0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0002f4c0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+0002f4d0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+0002f4e0: 5f32 2c20 746e 2e63 6f6c 756d 6e5f 6e61  _2, tn.column_na
+0002f4f0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+0002f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f520: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+0002f530: 202b 2073 7473 5f65 6e74 6974 795f 6a6f   + sts_entity_jo
+0002f540: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
 0002f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f560: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-0002f570: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-0002f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f5a0: 2020 2020 2020 2032 2c20 4b45 595f 5459         2, KEY_TY
-0002f5b0: 5045 5f41 5050 4c49 4544 5f44 4154 452c  PE_APPLIED_DATE,
-0002f5c0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0002f5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f5e0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0002f5f0: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-0002f600: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0002f610: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0002f620: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0002f630: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0002f640: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0002f650: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0002f660: 5365 7420 4669 6c74 6572 2074 6f20 7468  Set Filter to th
-0002f670: 6520 7365 636f 6e64 2075 6e69 6f6e 0d0a  e second union..
-0002f680: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-0002f690: 6572 203d 2068 6173 685f 6e61 6d65 202b  er = hash_name +
-0002f6a0: 2027 5f32 2069 7320 6e75 6c6c 270d 0a20   '_2 is null'.. 
-0002f6b0: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
-0002f6c0: 696c 7465 7220 3d20 5b70 7265 6669 785f  ilter = [prefix_
-0002f6d0: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-0002f6e0: 6a6f 696e 2c20 6669 6c74 6572 2c20 322c  join, filter, 2,
-0002f6f0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0002f700: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0002f710: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0002f720: 6464 5f65 6e74 7279 5f66 696c 7465 7273  dd_entry_filters
-0002f730: 285b 6e65 775f 6669 6c74 6572 5d29 0d0a  ([new_filter])..
-0002f740: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0002f750: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-0002f760: 5f72 656c 6174 696f 6e73 6869 7020 3d20  _relationship = 
-0002f770: 5b70 7265 6669 785f 6574 202b 2073 7473  [prefix_et + sts
-0002f780: 5f65 6e74 6974 795f 756e 696f 6e5f 736f  _entity_union_so
-0002f790: 7572 6365 732c 2068 6173 685f 6e61 6d65  urces, hash_name
+0002f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f570: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+0002f580: 6172 6765 7420 2b20 225f 4849 5354 222c  arget + "_HIST",
+0002f590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f5b0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+0002f5c0: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
+0002f5d0: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
+0002f5e0: 7469 6f6e 2c20 746e 2e63 6f6c 756d 6e5f  tion, tn.column_
+0002f5f0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+0002f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f620: 2020 2020 746e 2e63 6f6c 756d 6e5f 7072      tn.column_pr
+0002f630: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+0002f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f660: 2020 2020 2032 2c20 4b45 595f 5459 5045       2, KEY_TYPE
+0002f670: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
+0002f680: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0002f690: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002f6a0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0002f6b0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0002f6c0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0002f6d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0002f6e0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+0002f6f0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+0002f700: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0002f710: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0002f720: 2068 6173 5f61 643a 0d0a 2020 2020 2020   has_ad:..      
+0002f730: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+0002f740: 645f 6461 7465 203d 2073 656c 662e 6d65  d_date = self.me
+0002f750: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+0002f760: 745f 6170 706c 6965 645f 6461 7465 5f6f  t_applied_date_o
+0002f770: 6e5f 6476 5f66 726f 6d5f 636f 645f 656e  n_dv_from_cod_en
+0002f780: 7469 7479 5f74 6172 6765 7428 6476 5f65  tity_target(dv_e
+0002f790: 6e74 6974 792e 636f 645f 656e 7469 7479  ntity.cod_entity
 0002f7a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0002f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f7c0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0002f7d0: 7473 5f65 6e74 6974 795f 6163 7475 616c  ts_entity_actual
-0002f7e0: 5f69 6d61 6765 5f32 2c0d 0a20 2020 2020  _image_2,..     
+0002f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002f7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f800: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0002f810: 6e61 6d65 2c20 224f 5554 4552 204a 4f49  name, "OUTER JOI
-0002f820: 4e22 2c20 7365 6c66 2e6f 776e 6572 5d0d  N", self.owner].
-0002f830: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002f840: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0002f850: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0002f860: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
-0002f870: 285b 6e65 775f 7265 6c61 7469 6f6e 7368  ([new_relationsh
-0002f880: 6970 5d29 0d0a 0d0a 2020 2020 2020 2020  ip])....        
-0002f890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002f8a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002f8b0: 2323 2323 2320 5354 5320 2323 2323 2323  ##### STS ######
-0002f8c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0002f8d0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
-0002f8e0: 0a0d 0a20 2020 2020 2020 206f 7269 6769  ...        origi
-0002f8f0: 6e5f 7479 7065 7320 3d20 7365 6c66 2e6d  n_types = self.m
-0002f900: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0002f910: 6574 5f64 6963 745f 6f72 6967 696e 5f74  et_dict_origin_t
-0002f920: 7970 655f 6672 6f6d 5f63 6f64 5f65 6e74  ype_from_cod_ent
-0002f930: 6974 795f 6f6e 5f64 7628 6476 5f65 6e74  ity_on_dv(dv_ent
-0002f940: 6974 792e 636f 645f 656e 7469 7479 290d  ity.cod_entity).
-0002f950: 0a20 2020 2020 2020 2066 6f72 206e 756d  .        for num
-0002f960: 5f62 7261 6e63 685f 7374 7320 696e 205b  _branch_sts in [
-0002f970: 312c 322c 335d 3a0d 0a20 2020 2020 2020  1,2,3]:..       
-0002f980: 2020 2020 2023 2049 6e63 7265 6d65 6e74       # Increment
-0002f990: 616c 2061 6e64 2043 4443 206f 7269 6769  al and CDC origi
-0002f9a0: 6e20 6361 6e27 7420 6861 7665 2027 4427  n can't have 'D'
-0002f9b0: 206f 7074 696f 6e73 2e0d 0a20 2020 2020   options...     
-0002f9c0: 2020 2020 2020 2069 6620 286f 7269 6769         if (origi
-0002f9d0: 6e5f 7479 7065 735b 276f 7269 6769 6e5f  n_types['origin_
-0002f9e0: 6973 5f69 6e63 7265 6d65 6e74 616c 275d  is_incremental']
-0002f9f0: 203d 3d20 3120 6f72 206f 7269 6769 6e5f   == 1 or origin_
-0002fa00: 7479 7065 735b 276f 7269 6769 6e5f 6973  types['origin_is
-0002fa10: 5f63 6463 275d 203d 3d20 3129 2061 6e64  _cdc'] == 1) and
-0002fa20: 206e 756d 5f62 7261 6e63 685f 7374 7320   num_branch_sts 
-0002fa30: 3d3d 2032 3a20 636f 6e74 696e 7565 0d0a  == 2: continue..
-0002fa40: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0002fa50: 6e61 6c5f 706f 7369 7469 6f6e 203d 2031  nal_position = 1
-0002fa60: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0002fa70: 6966 206e 756d 5f62 7261 6e63 685f 7374  if num_branch_st
-0002fa80: 7320 3d3d 2031 206f 7220 6e75 6d5f 6272  s == 1 or num_br
-0002fa90: 616e 6368 5f73 7473 203d 3d20 333a 0d0a  anch_sts == 3:..
-0002faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fab0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0002fac0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0002fad0: 202b 2073 7473 5f65 6e74 6974 795f 6a6f   + sts_entity_jo
-0002fae0: 696e 2c20 6861 7368 5f6e 616d 652c 0d0a  in, hash_name,..
-0002faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fb10: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-0002fb20: 202b 2073 7473 5f65 6e74 6974 792c 2068   + sts_entity, h
-0002fb30: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
-0002fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fb60: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-0002fb70: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0002fb80: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-0002fb90: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-0002fba0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-0002fbb0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-0002fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fbd0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-0002fbe0: 6d5f 6272 616e 6368 5f73 7473 2c20 4b45  m_branch_sts, KE
-0002fbf0: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-0002fc00: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0002fc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fc20: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0002fc30: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-0002fc40: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0002fc50: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0002fc60: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0002fc70: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0002fc80: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0002fc90: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0002fca0: 206e 756d 5f62 7261 6e63 685f 7374 7320   num_branch_sts 
-0002fcb0: 3d3d 2032 3a0d 0a20 2020 2020 2020 2020  == 2:..         
-0002fcc0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0002fcd0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0002fce0: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-0002fcf0: 7469 7479 5f6a 6f69 6e2c 2068 6173 685f  tity_join, hash_
-0002fd00: 6e61 6d65 202b 2022 5f48 4953 5422 2c0d  name + "_HIST",.
-0002fd10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd30: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0002fd40: 7420 2b20 7374 735f 656e 7469 7479 2c20  t + sts_entity, 
-0002fd50: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
-0002fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd80: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-0002fd90: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-0002fda0: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
-0002fdb0: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-0002fdc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fde0: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
-0002fdf0: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
-0002fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe20: 2020 2020 2020 206e 756d 5f62 7261 6e63         num_branc
-0002fe30: 685f 7374 732c 204b 4559 5f54 5950 455f  h_sts, KEY_TYPE_
-0002fe40: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
-0002fe50: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-0002fe60: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-0002fe70: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0002fe80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fe90: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0002fea0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0002feb0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0002fec0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0002fed0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-0002fee0: 2020 2020 2020 2064 6174 655f 6372 6561         date_crea
-0002fef0: 7465 6420 3d20 2744 4154 455f 4352 4541  ted = 'DATE_CREA
-0002ff00: 5445 4427 0d0a 2020 2020 2020 2020 2020  TED'..          
-0002ff10: 2020 6966 206e 756d 5f62 7261 6e63 685f    if num_branch_
-0002ff20: 7374 7320 3d3d 2032 3a20 6461 7465 5f63  sts == 2: date_c
-0002ff30: 7265 6174 6564 203d 2073 656c 662e 636f  reated = self.co
-0002ff40: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
-0002ff50: 6461 7465 5f76 616c 7565 2829 0d0a 2020  date_value()..  
-0002ff60: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-0002ff70: 655f 666f 725f 6d65 7461 6461 7461 203d  e_for_metadata =
-0002ff80: 2073 656c 662e 636f 6e6e 6563 7469 6f6e   self.connection
-0002ff90: 2e67 6574 5f73 7973 6461 7465 5f66 6f72  .get_sysdate_for
-0002ffa0: 5f6d 6574 6164 6174 6128 290d 0a20 2020  _metadata()..   
-0002ffb0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-0002ffc0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-0002ffd0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-0002ffe0: 656e 7469 7479 5f6a 6f69 6e2c 2064 6174  entity_join, dat
-0002fff0: 655f 6372 6561 7465 642c 0d0a 2020 2020  e_created,..    
-00030000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030010: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00030020: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
-00030030: 6e74 6974 792c 2027 4441 5445 5f43 5245  ntity, 'DATE_CRE
-00030040: 4154 4544 272c 0d0a 2020 2020 2020 2020  ATED',..        
-00030050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030060: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
-00030070: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
-00030080: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-00030090: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
-000300a0: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
-000300b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000300c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000300d0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-000300e0: 6574 6164 6174 615b 325d 2c20 6e75 6d5f  etadata[2], num_
-000300f0: 6272 616e 6368 5f73 7473 2c20 4e6f 6e65  branch_sts, None
-00030100: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-00030110: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00030120: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00030130: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00030140: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00030150: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00030160: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-00030170: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00030180: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-00030190: 2020 2020 2020 2069 6620 6861 735f 7273         if has_rs
-000301a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000301b0: 2020 2063 6f6c 756d 6e5f 6e61 6d65 5f74     column_name_t
-000301c0: 6172 6765 7420 3d20 7265 636f 7264 5f73  arget = record_s
-000301d0: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-000301e0: 655f 7461 7267 6574 0d0a 2020 2020 2020  e_target..      
-000301f0: 2020 2020 2020 2020 2020 6966 206e 756d            if num
-00030200: 5f62 7261 6e63 685f 7374 7320 3d3d 2032  _branch_sts == 2
-00030210: 3a20 636f 6c75 6d6e 5f6e 616d 655f 7461  : column_name_ta
-00030220: 7267 6574 203d 2072 6563 6f72 645f 736f  rget = record_so
-00030230: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-00030240: 5f74 6172 6765 7420 2b22 5f48 4953 5422  _target +"_HIST"
-00030250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00030260: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00030270: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00030280: 6574 202b 2073 7473 5f65 6e74 6974 795f  et + sts_entity_
-00030290: 6a6f 696e 2c20 636f 6c75 6d6e 5f6e 616d  join, column_nam
-000302a0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-000302b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000302c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000302d0: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
-000302e0: 735f 656e 7469 7479 2c0d 0a20 2020 2020  s_entity,..     
-000302f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030310: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-00030320: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00030330: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-00030340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030350: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00030360: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-00030370: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-00030380: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-00030390: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-000303a0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-000303b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000303c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000303d0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-000303e0: 6365 2e63 6f6c 756d 6e5f 7072 6563 6973  ce.column_precis
-000303f0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-00030400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030410: 2020 2020 2020 2020 2020 2020 206e 756d               num
-00030420: 5f62 7261 6e63 685f 7374 732c 204b 4559  _branch_sts, KEY
-00030430: 5f54 5950 455f 5245 434f 5244 5f53 4f55  _TYPE_RECORD_SOU
-00030440: 5243 452c 2031 2c20 7365 6c66 2e6f 776e  RCE, 1, self.own
-00030450: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
-00030460: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00030470: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00030480: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00030490: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000304a0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000304b0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-000304c0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000304d0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-000304e0: 2020 6966 2068 6173 5f74 6e3a 0d0a 2020    if has_tn:..  
-000304f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00030500: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
-00030510: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
-00030520: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-00030530: 6d6e 5f6e 616d 655f 7461 7267 6574 203d  mn_name_target =
-00030540: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
-00030550: 7461 7267 6574 0d0a 2020 2020 2020 2020  target..        
-00030560: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00030570: 756d 5f62 7261 6e63 685f 7374 7320 3d3d  um_branch_sts ==
-00030580: 2032 3a20 636f 6c75 6d6e 5f6e 616d 655f   2: column_name_
-00030590: 7461 7267 6574 203d 2074 6e2e 636f 6c75  target = tn.colu
-000305a0: 6d6e 5f6e 616d 655f 7461 7267 6574 202b  mn_name_target +
-000305b0: 2022 5f48 4953 5422 0d0a 2020 2020 2020   "_HIST"..      
-000305c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000305d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-000305e0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-000305f0: 2073 7473 5f65 6e74 6974 795f 6a6f 696e   sts_entity_join
-00030600: 2c20 636f 6c75 6d6e 5f6e 616d 655f 7461  , column_name_ta
-00030610: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-00030620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030640: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
-00030650: 735f 656e 7469 7479 2c0d 0a20 2020 2020  s_entity,..     
-00030660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030680: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-00030690: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-000306a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000306b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000306c0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-000306d0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-000306e0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000306f0: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
-00030700: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0002f800: 2020 2020 2031 290d 0a20 2020 2020 2020       1)..       
+0002f810: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+0002f820: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+0002f830: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+0002f840: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+0002f850: 6167 655f 322c 2061 7070 6c69 6564 5f64  age_2, applied_d
+0002f860: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+0002f870: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+0002f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f8a0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+0002f8b0: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
+0002f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f8e0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+0002f8f0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+0002f900: 7267 6574 202b 2022 5f48 4953 5422 2c0d  rget + "_HIST",.
+0002f910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f930: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0002f940: 6461 7465 2e63 6f6c 756d 6e5f 7479 7065  date.column_type
+0002f950: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+0002f960: 5f70 6f73 6974 696f 6e2c 2061 7070 6c69  _position, appli
+0002f970: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6c  ed_date.column_l
+0002f980: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+0002f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f9a0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0002f9b0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+0002f9c0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+0002f9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f9f0: 2020 2020 2020 322c 204b 4559 5f54 5950        2, KEY_TYP
+0002fa00: 455f 4150 504c 4945 445f 4441 5445 2c20  E_APPLIED_DATE, 
+0002fa10: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0002fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fa30: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0002fa40: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+0002fa50: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0002fa60: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0002fa70: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0002fa80: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0002fa90: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+0002faa0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+0002fab0: 6574 2046 696c 7465 7220 746f 2074 6865  et Filter to the
+0002fac0: 2073 6563 6f6e 6420 756e 696f 6e0d 0a20   second union.. 
+0002fad0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+0002fae0: 7220 3d20 6861 7368 5f6e 616d 6520 2b20  r = hash_name + 
+0002faf0: 275f 3220 6973 206e 756c 6c27 0d0a 2020  '_2 is null'..  
+0002fb00: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
+0002fb10: 6c74 6572 203d 205b 7072 6566 6978 5f65  lter = [prefix_e
+0002fb20: 7420 2b20 7374 735f 656e 7469 7479 5f6a  t + sts_entity_j
+0002fb30: 6f69 6e2c 2066 696c 7465 722c 2032 2c20  oin, filter, 2, 
+0002fb40: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0002fb50: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0002fb60: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0002fb70: 645f 656e 7472 795f 6669 6c74 6572 7328  d_entry_filters(
+0002fb80: 5b6e 6577 5f66 696c 7465 725d 290d 0a0d  [new_filter])...
+0002fb90: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0002fba0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0002fbb0: 7265 6c61 7469 6f6e 7368 6970 203d 205b  relationship = [
+0002fbc0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+0002fbd0: 656e 7469 7479 5f75 6e69 6f6e 5f73 6f75  entity_union_sou
+0002fbe0: 7263 6573 2c20 6861 7368 5f6e 616d 652c  rces, hash_name,
+0002fbf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fc10: 2020 7072 6566 6978 5f65 7420 2b20 7374    prefix_et + st
+0002fc20: 735f 656e 7469 7479 5f61 6374 7561 6c5f  s_entity_actual_
+0002fc30: 696d 6167 655f 322c 0d0a 2020 2020 2020  image_2,..      
+0002fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fc50: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+0002fc60: 616d 652c 2022 4f55 5445 5220 4a4f 494e  ame, "OUTER JOIN
+0002fc70: 222c 2073 656c 662e 6f77 6e65 725d 0d0a  ", self.owner]..
+0002fc80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002fc90: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0002fca0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0002fcb0: 6574 5f72 656c 6174 696f 6e73 6869 7028  et_relationship(
+0002fcc0: 5b6e 6577 5f72 656c 6174 696f 6e73 6869  [new_relationshi
+0002fcd0: 705d 290d 0a0d 0a20 2020 2020 2020 2023  p])....        #
+0002fce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002fcf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002fd00: 2323 2323 2053 5453 2023 2323 2323 2323  #### STS #######
+0002fd10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0002fd20: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+0002fd30: 0d0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
+0002fd40: 5f74 7970 6573 203d 2073 656c 662e 6d65  _types = self.me
+0002fd50: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+0002fd60: 745f 6469 6374 5f6f 7269 6769 6e5f 7479  t_dict_origin_ty
+0002fd70: 7065 5f66 726f 6d5f 636f 645f 656e 7469  pe_from_cod_enti
+0002fd80: 7479 5f6f 6e5f 6476 2864 765f 656e 7469  ty_on_dv(dv_enti
+0002fd90: 7479 2e63 6f64 5f65 6e74 6974 7929 0d0a  ty.cod_entity)..
+0002fda0: 2020 2020 2020 2020 666f 7220 6e75 6d5f          for num_
+0002fdb0: 6272 616e 6368 5f73 7473 2069 6e20 5b31  branch_sts in [1
+0002fdc0: 2c32 2c33 5d3a 0d0a 2020 2020 2020 2020  ,2,3]:..        
+0002fdd0: 2020 2020 2320 496e 6372 656d 656e 7461      # Incrementa
+0002fde0: 6c20 616e 6420 4344 4320 6f72 6967 696e  l and CDC origin
+0002fdf0: 2063 616e 2774 2068 6176 6520 2744 2720   can't have 'D' 
+0002fe00: 6f70 7469 6f6e 732e 0d0a 2020 2020 2020  options...      
+0002fe10: 2020 2020 2020 6966 2028 6f72 6967 696e        if (origin
+0002fe20: 5f74 7970 6573 5b27 6f72 6967 696e 5f69  _types['origin_i
+0002fe30: 735f 696e 6372 656d 656e 7461 6c27 5d20  s_incremental'] 
+0002fe40: 3d3d 2031 206f 7220 6f72 6967 696e 5f74  == 1 or origin_t
+0002fe50: 7970 6573 5b27 6f72 6967 696e 5f69 735f  ypes['origin_is_
+0002fe60: 6364 6327 5d20 3d3d 2031 2920 616e 6420  cdc'] == 1) and 
+0002fe70: 6e75 6d5f 6272 616e 6368 5f73 7473 203d  num_branch_sts =
+0002fe80: 3d20 323a 2063 6f6e 7469 6e75 650d 0a20  = 2: continue.. 
+0002fe90: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+0002fea0: 616c 5f70 6f73 6974 696f 6e20 3d20 310d  al_position = 1.
+0002feb0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+0002fec0: 6620 6e75 6d5f 6272 616e 6368 5f73 7473  f num_branch_sts
+0002fed0: 203d 3d20 3120 6f72 206e 756d 5f62 7261   == 1 or num_bra
+0002fee0: 6e63 685f 7374 7320 3d3d 2033 3a0d 0a20  nch_sts == 3:.. 
+0002fef0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0002ff00: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0002ff10: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0002ff20: 2b20 7374 735f 656e 7469 7479 5f6a 6f69  + sts_entity_joi
+0002ff30: 6e2c 2068 6173 685f 6e61 6d65 2c0d 0a20  n, hash_name,.. 
+0002ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ff60: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+0002ff70: 2b20 7374 735f 656e 7469 7479 2c20 6861  + sts_entity, ha
+0002ff80: 7368 5f6e 616d 652c 0d0a 2020 2020 2020  sh_name,..      
+0002ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ffb0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0002ffc0: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0002ffd0: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+0002ffe0: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+0002fff0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+00030000: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
+00030010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030020: 2020 2020 2020 2020 2020 2020 206e 756d               num
+00030030: 5f62 7261 6e63 685f 7374 732c 204b 4559  _branch_sts, KEY
+00030040: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+00030050: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00030060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030070: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00030080: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+00030090: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+000300a0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+000300b0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+000300c0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+000300d0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+000300e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000300f0: 6e75 6d5f 6272 616e 6368 5f73 7473 203d  num_branch_sts =
+00030100: 3d20 323a 0d0a 2020 2020 2020 2020 2020  = 2:..          
+00030110: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00030120: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+00030130: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+00030140: 6974 795f 6a6f 696e 2c20 6861 7368 5f6e  ity_join, hash_n
+00030150: 616d 6520 2b20 225f 4849 5354 222c 0d0a  ame + "_HIST",..
+00030160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030180: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00030190: 202b 2073 7473 5f65 6e74 6974 792c 2068   + sts_entity, h
+000301a0: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
+000301b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000301c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000301d0: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+000301e0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+000301f0: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+00030200: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
+00030210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030230: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+00030240: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+00030250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030270: 2020 2020 2020 6e75 6d5f 6272 616e 6368        num_branch
+00030280: 5f73 7473 2c20 4b45 595f 5459 5045 5f48  _sts, KEY_TYPE_H
+00030290: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
+000302a0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+000302b0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+000302c0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+000302d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000302e0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+000302f0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00030300: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00030310: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00030320: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00030330: 2020 2020 2020 6461 7465 5f63 7265 6174        date_creat
+00030340: 6564 203d 2027 4441 5445 5f43 5245 4154  ed = 'DATE_CREAT
+00030350: 4544 270d 0a20 2020 2020 2020 2020 2020  ED'..           
+00030360: 2069 6620 6e75 6d5f 6272 616e 6368 5f73   if num_branch_s
+00030370: 7473 203d 3d20 323a 2064 6174 655f 6372  ts == 2: date_cr
+00030380: 6561 7465 6420 3d20 7365 6c66 2e63 6f6e  eated = self.con
+00030390: 6e65 6374 696f 6e2e 6765 745f 7379 7364  nection.get_sysd
+000303a0: 6174 655f 7661 6c75 6528 290d 0a20 2020  ate_value()..   
+000303b0: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+000303c0: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
+000303d0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+000303e0: 6765 745f 7379 7364 6174 655f 666f 725f  get_sysdate_for_
+000303f0: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
+00030400: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00030410: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00030420: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+00030430: 6e74 6974 795f 6a6f 696e 2c20 6461 7465  ntity_join, date
+00030440: 5f63 7265 6174 6564 2c0d 0a20 2020 2020  _created,..     
+00030450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030460: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00030470: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
+00030480: 7469 7479 2c20 2744 4154 455f 4352 4541  tity, 'DATE_CREA
+00030490: 5445 4427 2c0d 0a20 2020 2020 2020 2020  TED',..         
+000304a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000304b0: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
+000304c0: 655f 666f 725f 6d65 7461 6461 7461 5b30  e_for_metadata[0
+000304d0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+000304e0: 696f 6e2c 2073 7973 6461 7465 5f66 6f72  ion, sysdate_for
+000304f0: 5f6d 6574 6164 6174 615b 315d 2c0d 0a20  _metadata[1],.. 
+00030500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030520: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00030530: 7461 6461 7461 5b32 5d2c 206e 756d 5f62  tadata[2], num_b
+00030540: 7261 6e63 685f 7374 732c 204e 6f6e 652c  ranch_sts, None,
+00030550: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00030560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00030570: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00030580: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00030590: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+000305a0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000305b0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+000305c0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+000305d0: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+000305e0: 2020 2020 2020 6966 2068 6173 5f72 733a        if has_rs:
+000305f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030600: 2020 636f 6c75 6d6e 5f6e 616d 655f 7461    column_name_ta
+00030610: 7267 6574 203d 2072 6563 6f72 645f 736f  rget = record_so
+00030620: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+00030630: 5f74 6172 6765 740d 0a20 2020 2020 2020  _target..       
+00030640: 2020 2020 2020 2020 2069 6620 6e75 6d5f           if num_
+00030650: 6272 616e 6368 5f73 7473 203d 3d20 323a  branch_sts == 2:
+00030660: 2063 6f6c 756d 6e5f 6e61 6d65 5f74 6172   column_name_tar
+00030670: 6765 7420 3d20 7265 636f 7264 5f73 6f75  get = record_sou
+00030680: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00030690: 7461 7267 6574 202b 225f 4849 5354 220d  target +"_HIST".
+000306a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000306b0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+000306c0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+000306d0: 7420 2b20 7374 735f 656e 7469 7479 5f6a  t + sts_entity_j
+000306e0: 6f69 6e2c 2063 6f6c 756d 6e5f 6e61 6d65  oin, column_name
+000306f0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+00030700: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00030710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030730: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
-00030740: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+00030720: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
+00030730: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
+00030740: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00030750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030770: 206e 756d 5f62 7261 6e63 685f 7374 732c   num_branch_sts,
-00030780: 204b 4559 5f54 5950 455f 5445 4e41 4e54   KEY_TYPE_TENANT
-00030790: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-000307a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000307b0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-000307c0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-000307d0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-000307e0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-000307f0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
+00030760: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00030770: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00030780: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00030790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000307a0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+000307b0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+000307c0: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+000307d0: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
+000307e0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+000307f0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
 00030800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030810: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00030820: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-00030830: 2020 2020 2020 2069 6620 6861 735f 6164         if has_ad
-00030840: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00030850: 2020 2063 6f6c 756d 6e5f 6e61 6d65 5f74     column_name_t
-00030860: 6172 6765 7420 3d20 6170 706c 6965 645f  arget = applied_
-00030870: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-00030880: 5f74 6172 6765 740d 0a20 2020 2020 2020  _target..       
-00030890: 2020 2020 2020 2020 2069 6620 6e75 6d5f           if num_
-000308a0: 6272 616e 6368 5f73 7473 203d 3d20 323a  branch_sts == 2:
-000308b0: 2063 6f6c 756d 6e5f 6e61 6d65 5f74 6172   column_name_tar
-000308c0: 6765 7420 3d20 6170 706c 6965 645f 6461  get = applied_da
-000308d0: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
-000308e0: 6172 6765 7420 2b20 225f 4849 5354 220d  arget + "_HIST".
-000308f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030900: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00030910: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00030920: 7420 2b20 7374 735f 656e 7469 7479 5f6a  t + sts_entity_j
-00030930: 6f69 6e2c 2063 6f6c 756d 6e5f 6e61 6d65  oin, column_name
-00030940: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-00030950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030970: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
-00030980: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00030990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000309a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000309b0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-000309c0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-000309d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000309e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000309f0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-00030a00: 645f 6461 7465 2e63 6f6c 756d 6e5f 7479  d_date.column_ty
-00030a10: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-00030a20: 616c 5f70 6f73 6974 696f 6e2c 2061 7070  al_position, app
-00030a30: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00030a40: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
-00030a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030a70: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00030a80: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-00030a90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030ab0: 2020 2020 2020 2020 6e75 6d5f 6272 616e          num_bran
-00030ac0: 6368 5f73 7473 2c20 4b45 595f 5459 5045  ch_sts, KEY_TYPE
-00030ad0: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
-00030ae0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00030af0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00030b00: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-00030b10: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-00030b20: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00030b30: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00030b40: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-00030b50: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-00030b60: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-00030b70: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
-00030b80: 7365 2049 4e53 4552 540d 0a20 2020 2020  se INSERT..     
-00030b90: 2020 2020 2020 2069 6620 6e75 6d5f 6272         if num_br
-00030ba0: 616e 6368 5f73 7473 203d 3d20 313a 0d0a  anch_sts == 1:..
+00030810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030820: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+00030830: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+00030840: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00030850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030860: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+00030870: 6272 616e 6368 5f73 7473 2c20 4b45 595f  branch_sts, KEY_
+00030880: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
+00030890: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
+000308a0: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+000308b0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+000308c0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+000308d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000308e0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000308f0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00030900: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00030910: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00030920: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00030930: 2069 6620 6861 735f 746e 3a0d 0a20 2020   if has_tn:..   
+00030940: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00030950: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
+00030960: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
+00030970: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00030980: 6e5f 6e61 6d65 5f74 6172 6765 7420 3d20  n_name_target = 
+00030990: 746e 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  tn.column_name_t
+000309a0: 6172 6765 740d 0a20 2020 2020 2020 2020  arget..         
+000309b0: 2020 2020 2020 2020 2020 2069 6620 6e75             if nu
+000309c0: 6d5f 6272 616e 6368 5f73 7473 203d 3d20  m_branch_sts == 
+000309d0: 323a 2063 6f6c 756d 6e5f 6e61 6d65 5f74  2: column_name_t
+000309e0: 6172 6765 7420 3d20 746e 2e63 6f6c 756d  arget = tn.colum
+000309f0: 6e5f 6e61 6d65 5f74 6172 6765 7420 2b20  n_name_target + 
+00030a00: 225f 4849 5354 220d 0a20 2020 2020 2020  "_HIST"..       
+00030a10: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00030a20: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00030a30: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+00030a40: 7374 735f 656e 7469 7479 5f6a 6f69 6e2c  sts_entity_join,
+00030a50: 2063 6f6c 756d 6e5f 6e61 6d65 5f74 6172   column_name_tar
+00030a60: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+00030a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030a90: 2070 7265 6669 785f 6574 202b 2073 7473   prefix_et + sts
+00030aa0: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
+00030ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ad0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+00030ae0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00030af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b10: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+00030b20: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+00030b30: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00030b40: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
+00030b50: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00030b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00030b80: 6e2e 636f 6c75 6d6e 5f70 7265 6369 7369  n.column_precisi
+00030b90: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00030ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00030bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030bc0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00030bd0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-00030be0: 202b 2073 7473 5f65 6e74 6974 795f 6a6f   + sts_entity_jo
-00030bf0: 696e 2c20 2744 565f 5354 4154 5553 5f49  in, 'DV_STATUS_I
-00030c00: 4e53 4552 5427 2c0d 0a20 2020 2020 2020  NSERT',..       
-00030c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030c30: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
-00030c40: 656e 7469 7479 2c20 2744 565f 5354 4154  entity, 'DV_STAT
-00030c50: 5553 272c 0d0a 2020 2020 2020 2020 2020  US',..          
-00030c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030c70: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00030c80: 6368 6172 5f66 6f72 5f6d 6574 6164 6174  char_for_metadat
-00030c90: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
-00030ca0: 7369 7469 6f6e 2c20 312c 0d0a 2020 2020  sition, 1,..    
-00030cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030cd0: 2020 2030 2c20 6e75 6d5f 6272 616e 6368     0, num_branch
-00030ce0: 5f73 7473 2c20 4e6f 6e65 2c20 312c 2073  _sts, None, 1, s
-00030cf0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00030d00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00030d10: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00030d20: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00030d30: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00030d40: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00030d50: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00030d60: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00030d70: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-00030d80: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00030d90: 7465 7220 3d20 6861 7368 5f6e 616d 6520  ter = hash_name 
-00030da0: 2b20 225f 4849 5354 2069 7320 6e75 6c6c  + "_HIST is null
-00030db0: 206f 7220 2820 4456 5f53 5441 5455 535f   or ( DV_STATUS_
-00030dc0: 4849 5354 203d 2044 565f 5354 4154 5553  HIST = DV_STATUS
-00030dd0: 5f44 454c 4554 4520 616e 6420 222b 2068  _DELETE and "+ h
-00030de0: 6173 685f 6e61 6d65 202b 2220 6973 206e  ash_name +" is n
-00030df0: 6f74 206e 756c 6c29 220d 0a20 2020 2020  ot null)"..     
-00030e00: 2020 2020 2020 2020 2020 206e 6577 5f66             new_f
-00030e10: 696c 7465 7220 3d20 5b70 7265 6669 785f  ilter = [prefix_
-00030e20: 6574 202b 2073 7473 5f65 6e74 6974 792c  et + sts_entity,
-00030e30: 2066 696c 7465 722c 206e 756d 5f62 7261   filter, num_bra
-00030e40: 6e63 685f 7374 732c 2073 656c 662e 6f77  nch_sts, self.ow
-00030e50: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00030e60: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00030e70: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00030e80: 6e74 7279 5f66 696c 7465 7273 285b 6e65  ntry_filters([ne
-00030e90: 775f 6669 6c74 6572 5d29 0d0a 0d0a 2020  w_filter])....  
-00030ea0: 2020 2020 2020 2020 2020 2320 4361 7365            # Case
-00030eb0: 2044 454c 4554 450d 0a20 2020 2020 2020   DELETE..       
-00030ec0: 2020 2020 2069 6620 6e75 6d5f 6272 616e       if num_bran
-00030ed0: 6368 5f73 7473 203d 3d20 323a 0d0a 2020  ch_sts == 2:..  
-00030ee0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00030ef0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00030f00: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-00030f10: 2073 7473 5f65 6e74 6974 795f 6a6f 696e   sts_entity_join
-00030f20: 2c20 2744 565f 5354 4154 5553 5f44 454c  , 'DV_STATUS_DEL
-00030f30: 4554 4527 2c0d 0a20 2020 2020 2020 2020  ETE',..         
-00030f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030f50: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00030f60: 6566 6978 5f65 7420 2b20 7374 735f 656e  efix_et + sts_en
-00030f70: 7469 7479 2c20 2744 565f 5354 4154 5553  tity, 'DV_STATUS
-00030f80: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00030f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030fa0: 2020 2020 2020 2020 2020 2076 6172 6368             varch
-00030fb0: 6172 5f66 6f72 5f6d 6574 6164 6174 615b  ar_for_metadata[
-00030fc0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-00030fd0: 7469 6f6e 2c20 312c 0d0a 2020 2020 2020  tion, 1,..      
-00030fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031000: 2030 2c20 6e75 6d5f 6272 616e 6368 5f73   0, num_branch_s
-00031010: 7473 2c20 4e6f 6e65 2c20 312c 2073 656c  ts, None, 1, sel
-00031020: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00031030: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00031040: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00031050: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00031060: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-00031070: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-00031080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00031090: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-000310a0: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
-000310b0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-000310c0: 7220 3d20 6861 7368 5f6e 616d 6520 2b20  r = hash_name + 
-000310d0: 2720 6973 206e 756c 6c20 616e 6420 4456  ' is null and DV
-000310e0: 5f53 5441 5455 535f 4445 4c45 5445 2021  _STATUS_DELETE !
-000310f0: 3d20 4456 5f53 5441 5455 535f 4849 5354  = DV_STATUS_HIST
-00031100: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-00031110: 2020 206e 6577 5f66 696c 7465 7220 3d20     new_filter = 
-00031120: 5b70 7265 6669 785f 6574 202b 2073 7473  [prefix_et + sts
-00031130: 5f65 6e74 6974 792c 2066 696c 7465 722c  _entity, filter,
-00031140: 206e 756d 5f62 7261 6e63 685f 7374 732c   num_branch_sts,
-00031150: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00031160: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00031170: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00031180: 616c 2e61 6464 5f65 6e74 7279 5f66 696c  al.add_entry_fil
-00031190: 7465 7273 285b 6e65 775f 6669 6c74 6572  ters([new_filter
-000311a0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-000311b0: 2020 2320 4361 7365 2055 5044 4154 450d    # Case UPDATE.
-000311c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000311d0: 6e75 6d5f 6272 616e 6368 5f73 7473 203d  num_branch_sts =
-000311e0: 3d20 333a 0d0a 2020 2020 2020 2020 2020  = 3:..          
-000311f0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00031200: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-00031210: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
-00031220: 6974 795f 6a6f 696e 2c20 2744 565f 5354  ity_join, 'DV_ST
-00031230: 4154 5553 5f55 5044 4154 4527 2c0d 0a20  ATUS_UPDATE',.. 
-00031240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031260: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-00031270: 2b20 7374 735f 656e 7469 7479 2c20 2744  + sts_entity, 'D
-00031280: 565f 5354 4154 5553 272c 0d0a 2020 2020  V_STATUS',..    
-00031290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000312a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000312b0: 2020 2076 6172 6368 6172 5f66 6f72 5f6d     varchar_for_m
-000312c0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-000312d0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 312c  nal_position, 1,
-000312e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000312f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031300: 2020 2020 2020 2020 2030 2c20 6e75 6d5f           0, num_
-00031310: 6272 616e 6368 5f73 7473 2c20 4e6f 6e65  branch_sts, None
-00031320: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-00031330: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00031340: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00031350: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00031360: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00031370: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00031380: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-00031390: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-000313a0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-000313b0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000313c0: 2020 2066 696c 7465 7220 3d20 6861 7368     filter = hash
-000313d0: 5f6e 616d 6520 2b20 2720 6973 206e 6f74  _name + ' is not
-000313e0: 206e 756c 6c20 616e 6420 2720 2b20 6861   null and ' + ha
-000313f0: 7368 5f6e 616d 6520 2b22 5f48 4953 5420  sh_name +"_HIST 
-00031400: 6973 206e 6f74 206e 756c 6c20 616e 6420  is not null and 
-00031410: 4456 5f53 5441 5455 535f 5550 4441 5445  DV_STATUS_UPDATE
-00031420: 2021 3d20 4456 5f53 5441 5455 535f 4849   != DV_STATUS_HI
-00031430: 5354 2061 6e64 2044 565f 5354 4154 5553  ST and DV_STATUS
-00031440: 5f48 4953 5420 213d 2044 565f 5354 4154  _HIST != DV_STAT
-00031450: 5553 5f44 454c 4554 4520 220d 0a20 2020  US_DELETE "..   
-00031460: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00031470: 5f66 696c 7465 7220 3d20 5b70 7265 6669  _filter = [prefi
-00031480: 785f 6574 202b 2073 7473 5f65 6e74 6974  x_et + sts_entit
-00031490: 792c 2066 696c 7465 722c 206e 756d 5f62  y, filter, num_b
-000314a0: 7261 6e63 685f 7374 732c 2073 656c 662e  ranch_sts, self.
-000314b0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-000314c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000314d0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000314e0: 5f65 6e74 7279 5f66 696c 7465 7273 285b  _entry_filters([
-000314f0: 6e65 775f 6669 6c74 6572 5d29 0d0a 0d0a  new_filter])....
-00031500: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00031510: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
-00031520: 5f6e 616d 652c 2022 4669 6e69 7368 6564  _name, "Finished
-00031530: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
-00031540: 6461 7461 205b 2053 7461 7475 7320 5472  data [ Status Tr
-00031550: 6163 6b69 6e67 2053 6174 656c 6c69 7465  acking Satellite
-00031560: 205d 2069 6e66 6f72 6d61 7469 6f6e 222c   ] information",
-00031570: 204c 4f47 5f4c 4556 454c 5f4f 4e4c 595f   LOG_LEVEL_ONLY_
-00031580: 4c4f 4729 0d0a 0d0a 2020 2020 6465 6620  LOG)....    def 
-00031590: 7072 6f63 6573 735f 6476 5f72 7473 2873  process_dv_rts(s
-000315a0: 656c 662c 2064 765f 656e 7469 7479 293a  elf, dv_entity):
-000315b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-000315c0: 6f67 2e6c 6f67 2873 656c 662e 656e 6769  og.log(self.engi
-000315d0: 6e65 5f6e 616d 652c 2022 5374 6172 7469  ne_name, "Starti
-000315e0: 6e67 2074 6f20 7072 6f63 6573 7320 4d65  ng to process Me
-000315f0: 7461 6461 7461 205b 2052 6563 6f72 6420  tadata [ Record 
-00031600: 5472 6163 6b69 6e67 2053 6174 656c 6c69  Tracking Satelli
-00031610: 7465 205d 2069 6e66 6f72 6d61 7469 6f6e  te ] information
-00031620: 222c 204c 4f47 5f4c 4556 454c 5f4f 4e4c  ", LOG_LEVEL_ONL
-00031630: 595f 4c4f 4729 0d0a 0d0a 2020 2020 2020  Y_LOG)....      
-00031640: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00031650: 6f6e 203d 2031 0d0a 2020 2020 2020 2020  on = 1..        
-00031660: 7072 6566 6978 5f65 7420 3d20 2745 545f  prefix_et = 'ET_
-00031670: 270d 0a20 2020 2020 2020 2073 6174 5f63  '..        sat_c
-00031680: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-00031690: 203d 2064 765f 656e 7469 7479 2e63 6f64   = dv_entity.cod
-000316a0: 5f65 6e74 6974 790d 0a20 2020 2020 2020  _entity..       
-000316b0: 2073 6174 5f6e 616d 6520 3d20 6476 5f65   sat_name = dv_e
-000316c0: 6e74 6974 792e 6e61 6d65 5f72 6563 6f72  ntity.name_recor
-000316d0: 645f 7472 6163 6b69 6e67 5f73 6174 656c  d_tracking_satel
-000316e0: 6c69 7465 0d0a 2020 2020 2020 2020 7361  lite..        sa
-000316f0: 745f 6e75 6d5f 6272 616e 6368 203d 2031  t_num_branch = 1
-00031700: 2020 2320 5361 7420 6361 6e27 7420 6861    # Sat can't ha
-00031710: 7665 206d 6f72 6520 7468 616e 206f 6e65  ve more than one
-00031720: 2062 7261 6e63 6820 2d3e 2073 6174 5b33   branch -> sat[3
-00031730: 5d0d 0a0d 0a20 2020 2020 2020 2068 6173  ]....        has
-00031740: 685f 6e61 6d65 203d 2027 4841 5348 5f27  h_name = 'HASH_'
-00031750: 202b 2064 765f 656e 7469 7479 2e65 6e74   + dv_entity.ent
-00031760: 6974 795f 6e61 6d65 0d0a 0d0a 2020 2020  ity_name....    
-00031770: 2020 2020 6966 2073 6174 5f6e 616d 6520      if sat_name 
-00031780: 6973 204e 6f6e 6520 6f72 2073 6174 5f6e  is None or sat_n
-00031790: 616d 6520 3d3d 2027 273a 2072 6574 7572  ame == '': retur
-000317a0: 6e0d 0a0d 0a20 2020 2020 2020 2064 765f  n....        dv_
-000317b0: 7072 6f70 6572 7479 203d 2073 656c 662e  property = self.
-000317c0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-000317d0: 6765 745f 6476 5f70 726f 7065 7274 6965  get_dv_propertie
-000317e0: 735f 6672 6f6d 5f63 6f64 5f65 6e74 6974  s_from_cod_entit
-000317f0: 795f 616e 645f 6e75 6d5f 636f 6e6e 6563  y_and_num_connec
-00031800: 7469 6f6e 2864 765f 656e 7469 7479 2e63  tion(dv_entity.c
-00031810: 6f64 5f65 6e74 6974 792c 2030 290d 0a20  od_entity, 0).. 
-00031820: 2020 2020 2020 2069 6620 6476 5f70 726f         if dv_pro
-00031830: 7065 7274 7920 6973 206e 6f74 204e 6f6e  perty is not Non
-00031840: 653a 2068 6173 685f 6e61 6d65 203d 2064  e: hash_name = d
-00031850: 765f 7072 6f70 6572 7479 2e68 6173 685f  v_property.hash_
-00031860: 6e61 6d65 0d0a 0d0a 0d0a 2020 2020 2020  name......      
-00031870: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-00031880: 2323 2323 2323 2323 2323 2323 2320 4372  ############# Cr
-00031890: 6561 7465 2061 6c6c 2065 6e74 6974 6965  eate all entitie
-000318a0: 7320 2323 2323 2323 2323 2323 2323 2323  s ##############
-000318b0: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
-000318c0: 2020 2020 2020 2073 6174 5f65 6e74 6974         sat_entit
-000318d0: 795f 746d 7020 3d20 2753 5447 5f54 4d50  y_tmp = 'STG_TMP
-000318e0: 5f27 202b 2073 6174 5f6e 616d 650d 0a20  _' + sat_name.. 
-000318f0: 2020 2020 2020 2073 6174 5f65 6e74 6974         sat_entit
-00031900: 795f 746d 705f 6c61 7374 5f61 7070 6c69  y_tmp_last_appli
-00031910: 6564 5f64 6174 6520 3d20 2753 5447 5f54  ed_date = 'STG_T
-00031920: 4d50 5f4c 4153 545f 4150 504c 4945 445f  MP_LAST_APPLIED_
-00031930: 4441 5445 5f27 202b 2073 6174 5f6e 616d  DATE_' + sat_nam
-00031940: 650d 0a20 2020 2020 2020 2073 6174 5f65  e..        sat_e
-00031950: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
-00031960: 6765 5f31 203d 2027 5354 475f 544d 505f  ge_1 = 'STG_TMP_
-00031970: 4c41 5354 5f49 4d41 4745 5f31 5f27 202b  LAST_IMAGE_1_' +
-00031980: 2073 6174 5f6e 616d 650d 0a20 2020 2020   sat_name..     
-00031990: 2020 2073 6174 5f65 6e74 6974 795f 6163     sat_entity_ac
-000319a0: 7475 616c 5f69 6d61 6765 5f32 203d 2027  tual_image_2 = '
-000319b0: 5354 475f 544d 505f 4c41 5354 5f49 4d41  STG_TMP_LAST_IMA
-000319c0: 4745 5f32 5f27 202b 2073 6174 5f6e 616d  GE_2_' + sat_nam
-000319d0: 650d 0a20 2020 2020 2020 2073 6174 5f65  e..        sat_e
-000319e0: 6e74 6974 795f 6a6f 696e 203d 2027 5354  ntity_join = 'ST
-000319f0: 475f 544d 505f 4a4f 494e 5f27 202b 2073  G_TMP_JOIN_' + s
-00031a00: 6174 5f6e 616d 650d 0a20 2020 2020 2020  at_name..       
-00031a10: 2073 6174 5f65 6e74 6974 7920 3d20 7361   sat_entity = sa
-00031a20: 745f 6e61 6d65 0d0a 0d0a 2020 2020 2020  t_name....      
-00031a30: 2020 6e65 775f 656e 7469 7479 5f73 6174    new_entity_sat
-00031a40: 5f65 6e74 6974 795f 746d 7020 3d20 5b70  _entity_tmp = [p
-00031a50: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-00031a60: 6e74 6974 795f 746d 702c 2073 6174 5f65  ntity_tmp, sat_e
-00031a70: 6e74 6974 795f 746d 702c 2045 4e54 4954  ntity_tmp, ENTIT
-00031a80: 595f 5749 5448 2c20 6476 5f65 6e74 6974  Y_WITH, dv_entit
-00031a90: 792e 636f 645f 7061 7468 2c20 2727 2c20  y.cod_path, '', 
-00031aa0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00031ab0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00031ac0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-00031ad0: 7472 795f 656e 7469 7479 285b 6e65 775f  try_entity([new_
-00031ae0: 656e 7469 7479 5f73 6174 5f65 6e74 6974  entity_sat_entit
-00031af0: 795f 746d 705d 290d 0a20 2020 2020 2020  y_tmp])..       
-00031b00: 206e 6577 5f65 6e74 6974 795f 7361 745f   new_entity_sat_
-00031b10: 656e 7469 7479 5f74 6d70 203d 205b 7072  entity_tmp = [pr
-00031b20: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-00031b30: 7469 7479 5f74 6d70 5f6c 6173 745f 6170  tity_tmp_last_ap
-00031b40: 706c 6965 645f 6461 7465 2c20 7361 745f  plied_date, sat_
-00031b50: 656e 7469 7479 5f74 6d70 5f6c 6173 745f  entity_tmp_last_
-00031b60: 6170 706c 6965 645f 6461 7465 2c20 454e  applied_date, EN
-00031b70: 5449 5459 5f57 4954 482c 2064 765f 656e  TITY_WITH, dv_en
-00031b80: 7469 7479 2e63 6f64 5f70 6174 682c 2027  tity.cod_path, '
-00031b90: 272c 2073 656c 662e 6f77 6e65 725d 0d0a  ', self.owner]..
-00031ba0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00031bb0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00031bc0: 5f65 6e74 7279 5f65 6e74 6974 7928 5b6e  _entry_entity([n
-00031bd0: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-00031be0: 7469 7479 5f74 6d70 5d29 0d0a 2020 2020  tity_tmp])..    
-00031bf0: 2020 2020 6e65 775f 656e 7469 7479 5f73      new_entity_s
-00031c00: 6174 5f65 6e74 6974 795f 6163 7475 616c  at_entity_actual
-00031c10: 5f69 6d61 6765 5f31 203d 205b 7072 6566  _image_1 = [pref
-00031c20: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-00031c30: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-00031c40: 312c 2073 6174 5f65 6e74 6974 795f 6163  1, sat_entity_ac
-00031c50: 7475 616c 5f69 6d61 6765 5f31 2c20 454e  tual_image_1, EN
-00031c60: 5449 5459 5f57 4954 482c 2064 765f 656e  TITY_WITH, dv_en
-00031c70: 7469 7479 2e63 6f64 5f70 6174 682c 2027  tity.cod_path, '
-00031c80: 272c 2073 656c 662e 6f77 6e65 725d 0d0a  ', self.owner]..
-00031c90: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00031ca0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00031cb0: 5f65 6e74 7279 5f65 6e74 6974 7928 5b6e  _entry_entity([n
-00031cc0: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-00031cd0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-00031ce0: 655f 315d 290d 0a20 2020 2020 2020 206e  e_1])..        n
-00031cf0: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-00031d00: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-00031d10: 655f 3220 3d20 5b70 7265 6669 785f 6574  e_2 = [prefix_et
-00031d20: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
-00031d30: 7475 616c 5f69 6d61 6765 5f32 2c20 7361  tual_image_2, sa
-00031d40: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
-00031d50: 696d 6167 655f 322c 2045 4e54 4954 595f  image_2, ENTITY_
-00031d60: 5749 5448 2c20 6476 5f65 6e74 6974 792e  WITH, dv_entity.
-00031d70: 636f 645f 7061 7468 2c20 2727 2c20 7365  cod_path, '', se
-00031d80: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00031d90: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00031da0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00031db0: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
-00031dc0: 7469 7479 5f73 6174 5f65 6e74 6974 795f  tity_sat_entity_
-00031dd0: 6163 7475 616c 5f69 6d61 6765 5f32 5d29  actual_image_2])
-00031de0: 0d0a 2020 2020 2020 2020 6e65 775f 656e  ..        new_en
-00031df0: 7469 7479 5f73 6174 5f65 6e74 6974 795f  tity_sat_entity_
-00031e00: 6a6f 696e 203d 205b 7072 6566 6978 5f65  join = [prefix_e
-00031e10: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
-00031e20: 6f69 6e2c 2073 6174 5f65 6e74 6974 795f  oin, sat_entity_
-00031e30: 6a6f 696e 2c20 454e 5449 5459 5f57 4954  join, ENTITY_WIT
-00031e40: 482c 2064 765f 656e 7469 7479 2e63 6f64  H, dv_entity.cod
-00031e50: 5f70 6174 682c 2027 272c 2073 656c 662e  _path, '', self.
-00031e60: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00031e70: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00031e80: 7475 616c 2e61 6464 5f65 6e74 7279 5f65  tual.add_entry_e
-00031e90: 6e74 6974 7928 5b6e 6577 5f65 6e74 6974  ntity([new_entit
-00031ea0: 795f 7361 745f 656e 7469 7479 5f6a 6f69  y_sat_entity_joi
-00031eb0: 6e5d 290d 0a20 2020 2020 2020 206e 6577  n])..        new
-00031ec0: 5f65 6e74 6974 795f 7361 745f 656e 7469  _entity_sat_enti
-00031ed0: 7479 203d 205b 7072 6566 6978 5f65 7420  ty = [prefix_et 
-00031ee0: 2b20 7361 745f 656e 7469 7479 2c20 7361  + sat_entity, sa
-00031ef0: 745f 656e 7469 7479 2c20 454e 5449 5459  t_entity, ENTITY
-00031f00: 5f54 422c 2064 765f 656e 7469 7479 2e63  _TB, dv_entity.c
-00031f10: 6f64 5f70 6174 682c 2027 494e 5345 5254  od_path, 'INSERT
-00031f20: 272c 2073 656c 662e 6f77 6e65 725d 0d0a  ', self.owner]..
-00031f30: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00031f40: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00031f50: 5f65 6e74 7279 5f65 6e74 6974 7928 5b6e  _entry_entity([n
-00031f60: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-00031f70: 7469 7479 5d29 0d0a 0d0a 2020 2020 2020  tity])....      
-00031f80: 2020 6861 735f 7273 203d 2046 616c 7365    has_rs = False
-00031f90: 0d0a 2020 2020 2020 2020 6861 735f 746e  ..        has_tn
-00031fa0: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
-00031fb0: 2020 2020 2320 5465 7374 2069 6620 6578      # Test if ex
-00031fc0: 6973 7473 206d 6574 6164 6174 6120 636f  ists metadata co
-00031fd0: 6c75 6d6e 7320 6f6e 6c79 206f 6e20 7468  lumns only on th
-00031fe0: 6520 6669 7273 7420 6272 616e 6368 2e20  e first branch. 
-00031ff0: 416c 6c20 7468 6520 6272 616e 6368 206e  All the branch n
-00032000: 6565 6420 746f 2068 6176 6520 7361 6d65  eed to have same
-00032010: 2063 6f6c 756d 6e73 210d 0a20 2020 2020   columns!..     
-00032020: 2020 2074 656e 616e 745f 736f 7572 6365     tenant_source
-00032030: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00032040: 5f61 6374 7561 6c2e 6765 745f 7465 6e61  _actual.get_tena
-00032050: 6e74 5f6f 6e5f 6476 5f66 726f 6d5f 636f  nt_on_dv_from_co
-00032060: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
-00032070: 616e 645f 6e75 6d5f 6272 616e 6368 2873  and_num_branch(s
-00032080: 6174 5f63 6f64 5f65 6e74 6974 795f 7461  at_cod_entity_ta
-00032090: 7267 6574 2c20 3129 0d0a 2020 2020 2020  rget, 1)..      
-000320a0: 2020 6966 206c 656e 2874 656e 616e 745f    if len(tenant_
-000320b0: 736f 7572 6365 2920 213d 2030 3a20 6861  source) != 0: ha
-000320c0: 735f 746e 203d 2054 7275 650d 0a20 2020  s_tn = True..   
-000320d0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-000320e0: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
-000320f0: 7461 5f61 6374 7561 6c2e 6765 745f 7265  ta_actual.get_re
-00032100: 636f 7264 5f73 6f75 7263 655f 6f6e 5f64  cord_source_on_d
-00032110: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-00032120: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
-00032130: 5f62 7261 6e63 6828 7361 745f 636f 645f  _branch(sat_cod_
-00032140: 656e 7469 7479 5f74 6172 6765 742c 2031  entity_target, 1
-00032150: 290d 0a20 2020 2020 2020 2069 6620 7265  )..        if re
-00032160: 636f 7264 5f73 6f75 7263 6520 6973 206e  cord_source is n
-00032170: 6f74 204e 6f6e 653a 2068 6173 5f72 7320  ot None: has_rs 
-00032180: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00032190: 6170 706c 6965 645f 6461 7465 203d 2073  applied_date = s
-000321a0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-000321b0: 7561 6c2e 6765 745f 6170 706c 6965 645f  ual.get_applied_
-000321c0: 6461 7465 5f6f 6e5f 6476 5f66 726f 6d5f  date_on_dv_from_
-000321d0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-000321e0: 7428 6476 5f65 6e74 6974 792e 636f 645f  t(dv_entity.cod_
-000321f0: 656e 7469 7479 2c20 3129 0d0a 2020 2020  entity, 1)..    
-00032200: 2020 2020 6966 2061 7070 6c69 6564 5f64      if applied_d
-00032210: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00032220: 2068 6173 5f61 6420 3d20 5472 7565 0d0a   has_ad = True..
-00032230: 0d0a 2020 2020 2020 2020 6861 7368 5f66  ..        hash_f
-00032240: 6f72 5f6d 6574 6164 6174 6120 3d20 7365  or_metadata = se
-00032250: 6c66 2e63 6f6e 6e65 6374 696f 6e2e 6765  lf.connection.ge
-00032260: 745f 6861 7368 5f66 6f72 5f6d 6574 6164  t_hash_for_metad
-00032270: 6174 6128 290d 0a20 2020 2020 2020 2069  ata()..        i
-00032280: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
-00032290: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
-000322a0: 6374 696f 6e2e 6765 745f 696e 7465 6765  ction.get_intege
-000322b0: 725f 666f 725f 6d65 7461 6461 7461 2829  r_for_metadata()
-000322c0: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
-000322d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000322e0: 2323 2323 2323 2320 4372 6561 7465 2045  ####### Create E
-000322f0: 6e74 6974 7920 5354 4720 544d 5020 2323  ntity STG TMP ##
-00032300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00032310: 2323 2323 2323 2323 230d 0a0d 0a20 2020  #########....   
-00032320: 2020 2020 206e 756d 5f62 7261 6e63 6865       num_branche
-00032330: 7320 3d20 7365 6c66 2e6d 6574 6164 6174  s = self.metadat
-00032340: 615f 6163 7475 616c 2e67 6574 5f6e 756d  a_actual.get_num
-00032350: 5f62 7261 6e63 6865 735f 6f6e 5f65 6e74  _branches_on_ent
-00032360: 7279 5f64 765f 6672 6f6d 5f63 6f64 5f65  ry_dv_from_cod_e
-00032370: 6e74 6974 795f 6e61 6d65 2864 765f 656e  ntity_name(dv_en
-00032380: 7469 7479 2e63 6f64 5f65 6e74 6974 7929  tity.cod_entity)
-00032390: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-000323a0: 6e75 6d5f 6272 616e 6368 2069 6e20 7261  num_branch in ra
-000323b0: 6e67 6528 312c 206e 756d 5f62 7261 6e63  nge(1, num_branc
-000323c0: 6865 7320 2b20 3129 3a0d 0a0d 0a20 2020  hes + 1):....   
-000323d0: 2020 2020 2020 2020 2074 656e 616e 745f           tenant_
-000323e0: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
-000323f0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-00032400: 745f 7465 6e61 6e74 5f6f 6e5f 6476 5f66  t_tenant_on_dv_f
-00032410: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
-00032420: 6172 6765 745f 616e 645f 6e75 6d5f 6272  arget_and_num_br
-00032430: 616e 6368 2864 765f 656e 7469 7479 2e63  anch(dv_entity.c
-00032440: 6f64 5f65 6e74 6974 792c 206e 756d 5f62  od_entity, num_b
-00032450: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-00032460: 2020 2020 6966 206c 656e 2874 656e 616e      if len(tenan
-00032470: 745f 736f 7572 6365 2920 213d 2030 3a0d  t_source) != 0:.
-00032480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032490: 2068 6173 5f74 6e20 3d20 5472 7565 0d0a   has_tn = True..
-000324a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000324b0: 2320 4765 7420 6469 7374 696e 6374 2066  # Get distinct f
-000324c0: 726f 6d20 5445 4e41 4e54 530d 0a20 2020  rom TENANTS..   
-000324d0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-000324e0: 616c 5f74 656e 616e 745f 6c69 7374 203d  al_tenant_list =
-000324f0: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
-00032500: 2020 2020 2066 6f72 2074 6e20 696e 2074       for tn in t
-00032510: 656e 616e 745f 736f 7572 6365 3a0d 0a20  enant_source:.. 
-00032520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032530: 2020 2069 6620 746e 2e63 6f6c 756d 6e5f     if tn.column_
-00032540: 6e61 6d65 5f74 6172 6765 7420 6e6f 7420  name_target not 
-00032550: 696e 205b 782e 636f 6c75 6d6e 5f6e 616d  in [x.column_nam
-00032560: 655f 7461 7267 6574 2066 6f72 2078 2069  e_target for x i
-00032570: 6e20 6669 6e61 6c5f 7465 6e61 6e74 5f6c  n final_tenant_l
-00032580: 6973 745d 3a20 6669 6e61 6c5f 7465 6e61  ist]: final_tena
-00032590: 6e74 5f6c 6973 742e 6170 7065 6e64 2874  nt_list.append(t
-000325a0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-000325b0: 2020 2020 7465 6e61 6e74 5f73 6f75 7263      tenant_sourc
-000325c0: 6520 3d20 6669 6e61 6c5f 7465 6e61 6e74  e = final_tenant
-000325d0: 5f6c 6973 740d 0a0d 0a20 2020 2020 2020  _list....       
-000325e0: 2020 2020 2062 6b5f 656e 7472 7920 3d20       bk_entry = 
-000325f0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00032600: 7475 616c 2e67 6574 5f66 6972 7374 5f65  tual.get_first_e
-00032610: 6e74 7279 5f64 765f 6d61 7070 696e 6773  ntry_dv_mappings
-00032620: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
-00032630: 5f74 6172 6765 745f 616e 645f 6b65 795f  _target_and_key_
-00032640: 7479 7065 5f61 6e64 5f6e 756d 5f62 7261  type_and_num_bra
-00032650: 6e63 6828 7361 745f 636f 645f 656e 7469  nch(sat_cod_enti
-00032660: 7479 5f74 6172 6765 742c 204b 4559 5f54  ty_target, KEY_T
-00032670: 5950 455f 4255 5349 4e45 5353 5f4b 4559  YPE_BUSINESS_KEY
-00032680: 2c20 6e75 6d5f 6272 616e 6368 290d 0a0d  , num_branch)...
-00032690: 0a20 2020 2020 2020 2020 2020 206d 6435  .            md5
-000326a0: 5f66 756e 6374 696f 6e20 3d20 7365 6c66  _function = self
-000326b0: 2e67 6574 5f68 6173 685f 6b65 795f 6672  .get_hash_key_fr
-000326c0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
-000326d0: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
-000326e0: 6e63 6828 7361 745f 636f 645f 656e 7469  nch(sat_cod_enti
-000326f0: 7479 5f74 6172 6765 742c 206e 756d 5f62  ty_target, num_b
-00032700: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-00032710: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00032720: 6d61 7070 696e 6720 3d20 5b62 6b5f 656e  mapping = [bk_en
-00032730: 7472 792e 636f 645f 656e 7469 7479 5f73  try.cod_entity_s
-00032740: 6f75 7263 652c 206d 6435 5f66 756e 6374  ource, md5_funct
-00032750: 696f 6e2c 2070 7265 6669 785f 6574 202b  ion, prefix_et +
-00032760: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-00032770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00032780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032790: 2020 2020 2068 6173 685f 6e61 6d65 2c0d       hash_name,.
-000327a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000327b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000327c0: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-000327d0: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-000327e0: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
-000327f0: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-00032800: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00032810: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
-00032820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032830: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
-00032840: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-00032850: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
-00032860: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00032870: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00032880: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00032890: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-000328a0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-000328b0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-000328c0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-000328d0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-000328e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000328f0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-00032900: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-00032910: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
-00032920: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
-00032930: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00032940: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00032950: 6e67 203d 205b 2727 2c20 7365 6c66 2e63  ng = ['', self.c
-00032960: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
-00032970: 7364 6174 655f 7661 6c75 6528 292c 2070  sdate_value(), p
-00032980: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-00032990: 6e74 6974 795f 746d 702c 0d0a 2020 2020  ntity_tmp,..    
-000329a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000329b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000329c0: 4441 5445 5f43 5245 4154 4544 272c 0d0a  DATE_CREATED',..
-000329d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000329e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000329f0: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
-00032a00: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00032a10: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7379  nal_position, sy
-00032a20: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
-00032a30: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
-00032a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032a50: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
-00032a60: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
-00032a70: 325d 2c20 6e75 6d5f 6272 616e 6368 2c20  2], num_branch, 
-00032a80: 4e6f 6e65 2c20 312c 2073 656c 662e 6f77  None, 1, self.ow
-00032a90: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-00032aa0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00032ab0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00032ac0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00032ad0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00032ae0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-00032af0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00032b00: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-00032b10: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-00032b20: 735f 7273 3a0d 0a20 2020 2020 2020 2020  s_rs:..         
-00032b30: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-00032b40: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
-00032b50: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
-00032b60: 7265 636f 7264 5f73 6f75 7263 655f 6f6e  record_source_on
-00032b70: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
-00032b80: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
-00032b90: 756d 5f62 7261 6e63 6828 7361 745f 636f  um_branch(sat_co
-00032ba0: 645f 656e 7469 7479 5f74 6172 6765 742c  d_entity_target,
-00032bb0: 206e 756d 5f62 7261 6e63 6829 0d0a 2020   num_branch)..  
-00032bc0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00032bd0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00032be0: 6720 3d20 5b72 6563 6f72 645f 736f 7572  g = [record_sour
-00032bf0: 6365 2e63 6f64 5f65 6e74 6974 795f 736f  ce.cod_entity_so
-00032c00: 7572 6365 2c20 7265 636f 7264 5f73 6f75  urce, record_sou
-00032c10: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-00032c20: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
-00032c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c50: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-00032c60: 656e 7469 7479 5f74 6d70 2c0d 0a20 2020  entity_tmp,..   
+00030bc0: 6e75 6d5f 6272 616e 6368 5f73 7473 2c20  num_branch_sts, 
+00030bd0: 4b45 595f 5459 5045 5f54 454e 414e 542c  KEY_TYPE_TENANT,
+00030be0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00030bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030c00: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+00030c10: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+00030c20: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+00030c30: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+00030c40: 745f 6d61 7070 696e 675d 290d 0a20 2020  t_mapping])..   
+00030c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c60: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00030c70: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+00030c80: 2020 2020 2020 6966 2068 6173 5f61 643a        if has_ad:
+00030c90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030ca0: 2020 636f 6c75 6d6e 5f6e 616d 655f 7461    column_name_ta
+00030cb0: 7267 6574 203d 2061 7070 6c69 6564 5f64  rget = applied_d
+00030cc0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+00030cd0: 7461 7267 6574 0d0a 2020 2020 2020 2020  target..        
+00030ce0: 2020 2020 2020 2020 6966 206e 756d 5f62          if num_b
+00030cf0: 7261 6e63 685f 7374 7320 3d3d 2032 3a20  ranch_sts == 2: 
+00030d00: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+00030d10: 6574 203d 2061 7070 6c69 6564 5f64 6174  et = applied_dat
+00030d20: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+00030d30: 7267 6574 202b 2022 5f48 4953 5422 0d0a  rget + "_HIST"..
+00030d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030d50: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00030d60: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00030d70: 202b 2073 7473 5f65 6e74 6974 795f 6a6f   + sts_entity_jo
+00030d80: 696e 2c20 636f 6c75 6d6e 5f6e 616d 655f  in, column_name_
+00030d90: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00030da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030dc0: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+00030dd0: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+00030de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030e00: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00030e10: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+00030e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030e40: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+00030e50: 5f64 6174 652e 636f 6c75 6d6e 5f74 7970  _date.column_typ
+00030e60: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+00030e70: 6c5f 706f 7369 7469 6f6e 2c20 6170 706c  l_position, appl
+00030e80: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00030e90: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+00030ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ec0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00030ed0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+00030ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030f00: 2020 2020 2020 206e 756d 5f62 7261 6e63         num_branc
+00030f10: 685f 7374 732c 204b 4559 5f54 5950 455f  h_sts, KEY_TYPE_
+00030f20: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
+00030f30: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00030f40: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00030f50: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+00030f60: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+00030f70: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+00030f80: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+00030f90: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+00030fa0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+00030fb0: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
+00030fc0: 2020 2020 2020 2020 2020 2023 2043 6173             # Cas
+00030fd0: 6520 494e 5345 5254 0d0a 2020 2020 2020  e INSERT..      
+00030fe0: 2020 2020 2020 6966 206e 756d 5f62 7261        if num_bra
+00030ff0: 6e63 685f 7374 7320 3d3d 2031 3a0d 0a20  nch_sts == 1:.. 
+00031000: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00031010: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00031020: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+00031030: 2b20 7374 735f 656e 7469 7479 5f6a 6f69  + sts_entity_joi
+00031040: 6e2c 2027 4456 5f53 5441 5455 535f 494e  n, 'DV_STATUS_IN
+00031050: 5345 5254 272c 0d0a 2020 2020 2020 2020  SERT',..        
+00031060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031070: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00031080: 7265 6669 785f 6574 202b 2073 7473 5f65  refix_et + sts_e
+00031090: 6e74 6974 792c 2027 4456 5f53 5441 5455  ntity, 'DV_STATU
+000310a0: 5327 2c0d 0a20 2020 2020 2020 2020 2020  S',..           
+000310b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000310c0: 2020 2020 2020 2020 2020 2020 7661 7263              varc
+000310d0: 6861 725f 666f 725f 6d65 7461 6461 7461  har_for_metadata
+000310e0: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
+000310f0: 6974 696f 6e2c 2031 2c0d 0a20 2020 2020  ition, 1,..     
+00031100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031120: 2020 302c 206e 756d 5f62 7261 6e63 685f    0, num_branch_
+00031130: 7374 732c 204e 6f6e 652c 2031 2c20 7365  sts, None, 1, se
+00031140: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00031150: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00031160: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00031170: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00031180: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00031190: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+000311a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000311b0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+000311c0: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+000311d0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+000311e0: 6572 203d 2068 6173 685f 6e61 6d65 202b  er = hash_name +
+000311f0: 2022 5f48 4953 5420 6973 206e 756c 6c20   "_HIST is null 
+00031200: 6f72 2028 2044 565f 5354 4154 5553 5f48  or ( DV_STATUS_H
+00031210: 4953 5420 3d20 4456 5f53 5441 5455 535f  IST = DV_STATUS_
+00031220: 4445 4c45 5445 2061 6e64 2022 2b20 6861  DELETE and "+ ha
+00031230: 7368 5f6e 616d 6520 2b22 2069 7320 6e6f  sh_name +" is no
+00031240: 7420 6e75 6c6c 2922 0d0a 2020 2020 2020  t null)"..      
+00031250: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
+00031260: 6c74 6572 203d 205b 7072 6566 6978 5f65  lter = [prefix_e
+00031270: 7420 2b20 7374 735f 656e 7469 7479 2c20  t + sts_entity, 
+00031280: 6669 6c74 6572 2c20 6e75 6d5f 6272 616e  filter, num_bran
+00031290: 6368 5f73 7473 2c20 7365 6c66 2e6f 776e  ch_sts, self.own
+000312a0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+000312b0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000312c0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+000312d0: 7472 795f 6669 6c74 6572 7328 5b6e 6577  try_filters([new
+000312e0: 5f66 696c 7465 725d 290d 0a0d 0a20 2020  _filter])....   
+000312f0: 2020 2020 2020 2020 2023 2043 6173 6520           # Case 
+00031300: 4445 4c45 5445 0d0a 2020 2020 2020 2020  DELETE..        
+00031310: 2020 2020 6966 206e 756d 5f62 7261 6e63      if num_branc
+00031320: 685f 7374 7320 3d3d 2032 3a0d 0a20 2020  h_sts == 2:..   
+00031330: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00031340: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00031350: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+00031360: 7374 735f 656e 7469 7479 5f6a 6f69 6e2c  sts_entity_join,
+00031370: 2027 4456 5f53 5441 5455 535f 4445 4c45   'DV_STATUS_DELE
+00031380: 5445 272c 0d0a 2020 2020 2020 2020 2020  TE',..          
+00031390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000313a0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+000313b0: 6669 785f 6574 202b 2073 7473 5f65 6e74  fix_et + sts_ent
+000313c0: 6974 792c 2027 4456 5f53 5441 5455 5327  ity, 'DV_STATUS'
+000313d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000313e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000313f0: 2020 2020 2020 2020 2020 7661 7263 6861            varcha
+00031400: 725f 666f 725f 6d65 7461 6461 7461 5b30  r_for_metadata[0
+00031410: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+00031420: 696f 6e2c 2031 2c0d 0a20 2020 2020 2020  ion, 1,..       
+00031430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031450: 302c 206e 756d 5f62 7261 6e63 685f 7374  0, num_branch_st
+00031460: 732c 204e 6f6e 652c 2031 2c20 7365 6c66  s, None, 1, self
+00031470: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00031480: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00031490: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+000314a0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+000314b0: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+000314c0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+000314d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000314e0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+000314f0: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+00031500: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00031510: 203d 2068 6173 685f 6e61 6d65 202b 2027   = hash_name + '
+00031520: 2069 7320 6e75 6c6c 2061 6e64 2044 565f   is null and DV_
+00031530: 5354 4154 5553 5f44 454c 4554 4520 213d  STATUS_DELETE !=
+00031540: 2044 565f 5354 4154 5553 5f48 4953 5427   DV_STATUS_HIST'
+00031550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00031560: 2020 6e65 775f 6669 6c74 6572 203d 205b    new_filter = [
+00031570: 7072 6566 6978 5f65 7420 2b20 7374 735f  prefix_et + sts_
+00031580: 656e 7469 7479 2c20 6669 6c74 6572 2c20  entity, filter, 
+00031590: 6e75 6d5f 6272 616e 6368 5f73 7473 2c20  num_branch_sts, 
+000315a0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+000315b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000315c0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+000315d0: 6c2e 6164 645f 656e 7472 795f 6669 6c74  l.add_entry_filt
+000315e0: 6572 7328 5b6e 6577 5f66 696c 7465 725d  ers([new_filter]
+000315f0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00031600: 2023 2043 6173 6520 5550 4441 5445 0d0a   # Case UPDATE..
+00031610: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00031620: 756d 5f62 7261 6e63 685f 7374 7320 3d3d  um_branch_sts ==
+00031630: 2033 3a0d 0a20 2020 2020 2020 2020 2020   3:..           
+00031640: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+00031650: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+00031660: 6978 5f65 7420 2b20 7374 735f 656e 7469  ix_et + sts_enti
+00031670: 7479 5f6a 6f69 6e2c 2027 4456 5f53 5441  ty_join, 'DV_STA
+00031680: 5455 535f 5550 4441 5445 272c 0d0a 2020  TUS_UPDATE',..  
+00031690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316b0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+000316c0: 2073 7473 5f65 6e74 6974 792c 2027 4456   sts_entity, 'DV
+000316d0: 5f53 5441 5455 5327 2c0d 0a20 2020 2020  _STATUS',..     
+000316e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031700: 2020 7661 7263 6861 725f 666f 725f 6d65    varchar_for_me
+00031710: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00031720: 616c 5f70 6f73 6974 696f 6e2c 2031 2c0d  al_position, 1,.
+00031730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031750: 2020 2020 2020 2020 302c 206e 756d 5f62          0, num_b
+00031760: 7261 6e63 685f 7374 732c 204e 6f6e 652c  ranch_sts, None,
+00031770: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00031780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031790: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+000317a0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+000317b0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+000317c0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+000317d0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+000317e0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+000317f0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00031800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00031810: 2020 6669 6c74 6572 203d 2068 6173 685f    filter = hash_
+00031820: 6e61 6d65 202b 2027 2069 7320 6e6f 7420  name + ' is not 
+00031830: 6e75 6c6c 2061 6e64 2027 202b 2068 6173  null and ' + has
+00031840: 685f 6e61 6d65 202b 225f 4849 5354 2069  h_name +"_HIST i
+00031850: 7320 6e6f 7420 6e75 6c6c 2061 6e64 2044  s not null and D
+00031860: 565f 5354 4154 5553 5f55 5044 4154 4520  V_STATUS_UPDATE 
+00031870: 213d 2044 565f 5354 4154 5553 5f48 4953  != DV_STATUS_HIS
+00031880: 5420 616e 6420 4456 5f53 5441 5455 535f  T and DV_STATUS_
+00031890: 4849 5354 2021 3d20 4456 5f53 5441 5455  HIST != DV_STATU
+000318a0: 535f 4445 4c45 5445 2022 0d0a 2020 2020  S_DELETE "..    
+000318b0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000318c0: 6669 6c74 6572 203d 205b 7072 6566 6978  filter = [prefix
+000318d0: 5f65 7420 2b20 7374 735f 656e 7469 7479  _et + sts_entity
+000318e0: 2c20 6669 6c74 6572 2c20 6e75 6d5f 6272  , filter, num_br
+000318f0: 616e 6368 5f73 7473 2c20 7365 6c66 2e6f  anch_sts, self.o
+00031900: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00031910: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00031920: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00031930: 656e 7472 795f 6669 6c74 6572 7328 5b6e  entry_filters([n
+00031940: 6577 5f66 696c 7465 725d 290d 0a0d 0a20  ew_filter]).... 
+00031950: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
+00031960: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
+00031970: 6e61 6d65 2c20 2246 696e 6973 6865 6420  name, "Finished 
+00031980: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
+00031990: 6174 6120 5b20 5374 6174 7573 2054 7261  ata [ Status Tra
+000319a0: 636b 696e 6720 5361 7465 6c6c 6974 6520  cking Satellite 
+000319b0: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+000319c0: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+000319d0: 4f47 290d 0a0d 0a20 2020 2064 6566 2070  OG)....    def p
+000319e0: 726f 6365 7373 5f64 765f 7274 7328 7365  rocess_dv_rts(se
+000319f0: 6c66 2c20 6476 5f65 6e74 6974 7929 3a0d  lf, dv_entity):.
+00031a00: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00031a10: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
+00031a20: 655f 6e61 6d65 2c20 2253 7461 7274 696e  e_name, "Startin
+00031a30: 6720 746f 2070 726f 6365 7373 204d 6574  g to process Met
+00031a40: 6164 6174 6120 5b20 5265 636f 7264 2054  adata [ Record T
+00031a50: 7261 636b 696e 6720 5361 7465 6c6c 6974  racking Satellit
+00031a60: 6520 5d20 696e 666f 726d 6174 696f 6e22  e ] information"
+00031a70: 2c20 4c4f 475f 4c45 5645 4c5f 4f4e 4c59  , LOG_LEVEL_ONLY
+00031a80: 5f4c 4f47 290d 0a0d 0a20 2020 2020 2020  _LOG)....       
+00031a90: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00031aa0: 6e20 3d20 310d 0a20 2020 2020 2020 2070  n = 1..        p
+00031ab0: 7265 6669 785f 6574 203d 2027 4554 5f27  refix_et = 'ET_'
+00031ac0: 0d0a 2020 2020 2020 2020 7361 745f 636f  ..        sat_co
+00031ad0: 645f 656e 7469 7479 5f74 6172 6765 7420  d_entity_target 
+00031ae0: 3d20 6476 5f65 6e74 6974 792e 636f 645f  = dv_entity.cod_
+00031af0: 656e 7469 7479 0d0a 2020 2020 2020 2020  entity..        
+00031b00: 7361 745f 6e61 6d65 203d 2064 765f 656e  sat_name = dv_en
+00031b10: 7469 7479 2e6e 616d 655f 7265 636f 7264  tity.name_record
+00031b20: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
+00031b30: 6974 650d 0a20 2020 2020 2020 2073 6174  ite..        sat
+00031b40: 5f6e 756d 5f62 7261 6e63 6820 3d20 3120  _num_branch = 1 
+00031b50: 2023 2053 6174 2063 616e 2774 2068 6176   # Sat can't hav
+00031b60: 6520 6d6f 7265 2074 6861 6e20 6f6e 6520  e more than one 
+00031b70: 6272 616e 6368 202d 3e20 7361 745b 335d  branch -> sat[3]
+00031b80: 0d0a 0d0a 2020 2020 2020 2020 6861 7368  ....        hash
+00031b90: 5f6e 616d 6520 3d20 2748 4153 485f 2720  _name = 'HASH_' 
+00031ba0: 2b20 6476 5f65 6e74 6974 792e 656e 7469  + dv_entity.enti
+00031bb0: 7479 5f6e 616d 650d 0a0d 0a20 2020 2020  ty_name....     
+00031bc0: 2020 2069 6620 7361 745f 6e61 6d65 2069     if sat_name i
+00031bd0: 7320 4e6f 6e65 206f 7220 7361 745f 6e61  s None or sat_na
+00031be0: 6d65 203d 3d20 2727 3a20 7265 7475 726e  me == '': return
+00031bf0: 0d0a 0d0a 2020 2020 2020 2020 6476 5f70  ....        dv_p
+00031c00: 726f 7065 7274 7920 3d20 7365 6c66 2e6d  roperty = self.m
+00031c10: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+00031c20: 6574 5f64 765f 7072 6f70 6572 7469 6573  et_dv_properties
+00031c30: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+00031c40: 5f61 6e64 5f6e 756d 5f63 6f6e 6e65 6374  _and_num_connect
+00031c50: 696f 6e28 6476 5f65 6e74 6974 792e 636f  ion(dv_entity.co
+00031c60: 645f 656e 7469 7479 2c20 3029 0d0a 2020  d_entity, 0)..  
+00031c70: 2020 2020 2020 6966 2064 765f 7072 6f70        if dv_prop
+00031c80: 6572 7479 2069 7320 6e6f 7420 4e6f 6e65  erty is not None
+00031c90: 3a20 6861 7368 5f6e 616d 6520 3d20 6476  : hash_name = dv
+00031ca0: 5f70 726f 7065 7274 792e 6861 7368 5f6e  _property.hash_n
+00031cb0: 616d 650d 0a0d 0a0d 0a20 2020 2020 2020  ame......       
+00031cc0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00031cd0: 2323 2323 2323 2323 2323 2323 2043 7265  ############ Cre
+00031ce0: 6174 6520 616c 6c20 656e 7469 7469 6573  ate all entities
+00031cf0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00031d00: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
+00031d10: 2020 2020 2020 7361 745f 656e 7469 7479        sat_entity
+00031d20: 5f74 6d70 203d 2027 5354 475f 544d 505f  _tmp = 'STG_TMP_
+00031d30: 2720 2b20 7361 745f 6e61 6d65 0d0a 2020  ' + sat_name..  
+00031d40: 2020 2020 2020 7361 745f 656e 7469 7479        sat_entity
+00031d50: 5f74 6d70 5f6c 6173 745f 6170 706c 6965  _tmp_last_applie
+00031d60: 645f 6461 7465 203d 2027 5354 475f 544d  d_date = 'STG_TM
+00031d70: 505f 4c41 5354 5f41 5050 4c49 4544 5f44  P_LAST_APPLIED_D
+00031d80: 4154 455f 2720 2b20 7361 745f 6e61 6d65  ATE_' + sat_name
+00031d90: 0d0a 2020 2020 2020 2020 7361 745f 656e  ..        sat_en
+00031da0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
+00031db0: 655f 3120 3d20 2753 5447 5f54 4d50 5f4c  e_1 = 'STG_TMP_L
+00031dc0: 4153 545f 494d 4147 455f 315f 2720 2b20  AST_IMAGE_1_' + 
+00031dd0: 7361 745f 6e61 6d65 0d0a 2020 2020 2020  sat_name..      
+00031de0: 2020 7361 745f 656e 7469 7479 5f61 6374    sat_entity_act
+00031df0: 7561 6c5f 696d 6167 655f 3220 3d20 2753  ual_image_2 = 'S
+00031e00: 5447 5f54 4d50 5f4c 4153 545f 494d 4147  TG_TMP_LAST_IMAG
+00031e10: 455f 325f 2720 2b20 7361 745f 6e61 6d65  E_2_' + sat_name
+00031e20: 0d0a 2020 2020 2020 2020 7361 745f 656e  ..        sat_en
+00031e30: 7469 7479 5f6a 6f69 6e20 3d20 2753 5447  tity_join = 'STG
+00031e40: 5f54 4d50 5f4a 4f49 4e5f 2720 2b20 7361  _TMP_JOIN_' + sa
+00031e50: 745f 6e61 6d65 0d0a 2020 2020 2020 2020  t_name..        
+00031e60: 7361 745f 656e 7469 7479 203d 2073 6174  sat_entity = sat
+00031e70: 5f6e 616d 650d 0a0d 0a20 2020 2020 2020  _name....       
+00031e80: 206e 6577 5f65 6e74 6974 795f 7361 745f   new_entity_sat_
+00031e90: 656e 7469 7479 5f74 6d70 203d 205b 7072  entity_tmp = [pr
+00031ea0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+00031eb0: 7469 7479 5f74 6d70 2c20 7361 745f 656e  tity_tmp, sat_en
+00031ec0: 7469 7479 5f74 6d70 2c20 454e 5449 5459  tity_tmp, ENTITY
+00031ed0: 5f57 4954 482c 2064 765f 656e 7469 7479  _WITH, dv_entity
+00031ee0: 2e63 6f64 5f70 6174 682c 2027 272c 2073  .cod_path, '', s
+00031ef0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00031f00: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00031f10: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00031f20: 7279 5f65 6e74 6974 7928 5b6e 6577 5f65  ry_entity([new_e
+00031f30: 6e74 6974 795f 7361 745f 656e 7469 7479  ntity_sat_entity
+00031f40: 5f74 6d70 5d29 0d0a 2020 2020 2020 2020  _tmp])..        
+00031f50: 6e65 775f 656e 7469 7479 5f73 6174 5f65  new_entity_sat_e
+00031f60: 6e74 6974 795f 746d 7020 3d20 5b70 7265  ntity_tmp = [pre
+00031f70: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+00031f80: 6974 795f 746d 705f 6c61 7374 5f61 7070  ity_tmp_last_app
+00031f90: 6c69 6564 5f64 6174 652c 2073 6174 5f65  lied_date, sat_e
+00031fa0: 6e74 6974 795f 746d 705f 6c61 7374 5f61  ntity_tmp_last_a
+00031fb0: 7070 6c69 6564 5f64 6174 652c 2045 4e54  pplied_date, ENT
+00031fc0: 4954 595f 5749 5448 2c20 6476 5f65 6e74  ITY_WITH, dv_ent
+00031fd0: 6974 792e 636f 645f 7061 7468 2c20 2727  ity.cod_path, ''
+00031fe0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00031ff0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00032000: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00032010: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
+00032020: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+00032030: 6974 795f 746d 705d 290d 0a20 2020 2020  ity_tmp])..     
+00032040: 2020 206e 6577 5f65 6e74 6974 795f 7361     new_entity_sa
+00032050: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
+00032060: 696d 6167 655f 3120 3d20 5b70 7265 6669  image_1 = [prefi
+00032070: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+00032080: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
+00032090: 2c20 7361 745f 656e 7469 7479 5f61 6374  , sat_entity_act
+000320a0: 7561 6c5f 696d 6167 655f 312c 2045 4e54  ual_image_1, ENT
+000320b0: 4954 595f 5749 5448 2c20 6476 5f65 6e74  ITY_WITH, dv_ent
+000320c0: 6974 792e 636f 645f 7061 7468 2c20 2727  ity.cod_path, ''
+000320d0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000320e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+000320f0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00032100: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
+00032110: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+00032120: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+00032130: 5f31 5d29 0d0a 2020 2020 2020 2020 6e65  _1])..        ne
+00032140: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+00032150: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+00032160: 5f32 203d 205b 7072 6566 6978 5f65 7420  _2 = [prefix_et 
+00032170: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
+00032180: 7561 6c5f 696d 6167 655f 322c 2073 6174  ual_image_2, sat
+00032190: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+000321a0: 6d61 6765 5f32 2c20 454e 5449 5459 5f57  mage_2, ENTITY_W
+000321b0: 4954 482c 2064 765f 656e 7469 7479 2e63  ITH, dv_entity.c
+000321c0: 6f64 5f70 6174 682c 2027 272c 2073 656c  od_path, '', sel
+000321d0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000321e0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+000321f0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00032200: 5f65 6e74 6974 7928 5b6e 6577 5f65 6e74  _entity([new_ent
+00032210: 6974 795f 7361 745f 656e 7469 7479 5f61  ity_sat_entity_a
+00032220: 6374 7561 6c5f 696d 6167 655f 325d 290d  ctual_image_2]).
+00032230: 0a20 2020 2020 2020 206e 6577 5f65 6e74  .        new_ent
+00032240: 6974 795f 7361 745f 656e 7469 7479 5f6a  ity_sat_entity_j
+00032250: 6f69 6e20 3d20 5b70 7265 6669 785f 6574  oin = [prefix_et
+00032260: 202b 2073 6174 5f65 6e74 6974 795f 6a6f   + sat_entity_jo
+00032270: 696e 2c20 7361 745f 656e 7469 7479 5f6a  in, sat_entity_j
+00032280: 6f69 6e2c 2045 4e54 4954 595f 5749 5448  oin, ENTITY_WITH
+00032290: 2c20 6476 5f65 6e74 6974 792e 636f 645f  , dv_entity.cod_
+000322a0: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
+000322b0: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
+000322c0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+000322d0: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
+000322e0: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
+000322f0: 5f73 6174 5f65 6e74 6974 795f 6a6f 696e  _sat_entity_join
+00032300: 5d29 0d0a 2020 2020 2020 2020 6e65 775f  ])..        new_
+00032310: 656e 7469 7479 5f73 6174 5f65 6e74 6974  entity_sat_entit
+00032320: 7920 3d20 5b70 7265 6669 785f 6574 202b  y = [prefix_et +
+00032330: 2073 6174 5f65 6e74 6974 792c 2073 6174   sat_entity, sat
+00032340: 5f65 6e74 6974 792c 2045 4e54 4954 595f  _entity, ENTITY_
+00032350: 5442 2c20 6476 5f65 6e74 6974 792e 636f  TB, dv_entity.co
+00032360: 645f 7061 7468 2c20 2749 4e53 4552 5427  d_path, 'INSERT'
+00032370: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00032380: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00032390: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+000323a0: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
+000323b0: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+000323c0: 6974 795d 290d 0a0d 0a20 2020 2020 2020  ity])....       
+000323d0: 2068 6173 5f72 7320 3d20 4661 6c73 650d   has_rs = False.
+000323e0: 0a20 2020 2020 2020 2068 6173 5f74 6e20  .        has_tn 
+000323f0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
+00032400: 2020 2023 2054 6573 7420 6966 2065 7869     # Test if exi
+00032410: 7374 7320 6d65 7461 6461 7461 2063 6f6c  sts metadata col
+00032420: 756d 6e73 206f 6e6c 7920 6f6e 2074 6865  umns only on the
+00032430: 2066 6972 7374 2062 7261 6e63 682e 2041   first branch. A
+00032440: 6c6c 2074 6865 2062 7261 6e63 6820 6e65  ll the branch ne
+00032450: 6564 2074 6f20 6861 7665 2073 616d 6520  ed to have same 
+00032460: 636f 6c75 6d6e 7321 0d0a 2020 2020 2020  columns!..      
+00032470: 2020 7465 6e61 6e74 5f73 6f75 7263 6520    tenant_source 
+00032480: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00032490: 6163 7475 616c 2e67 6574 5f74 656e 616e  actual.get_tenan
+000324a0: 745f 6f6e 5f64 765f 6672 6f6d 5f63 6f64  t_on_dv_from_cod
+000324b0: 5f65 6e74 6974 795f 7461 7267 6574 5f61  _entity_target_a
+000324c0: 6e64 5f6e 756d 5f62 7261 6e63 6828 7361  nd_num_branch(sa
+000324d0: 745f 636f 645f 656e 7469 7479 5f74 6172  t_cod_entity_tar
+000324e0: 6765 742c 2031 290d 0a20 2020 2020 2020  get, 1)..       
+000324f0: 2069 6620 6c65 6e28 7465 6e61 6e74 5f73   if len(tenant_s
+00032500: 6f75 7263 6529 2021 3d20 303a 2068 6173  ource) != 0: has
+00032510: 5f74 6e20 3d20 5472 7565 0d0a 2020 2020  _tn = True..    
+00032520: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+00032530: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+00032540: 615f 6163 7475 616c 2e67 6574 5f72 6563  a_actual.get_rec
+00032550: 6f72 645f 736f 7572 6365 5f6f 6e5f 6476  ord_source_on_dv
+00032560: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+00032570: 5f74 6172 6765 745f 616e 645f 6e75 6d5f  _target_and_num_
+00032580: 6272 616e 6368 2873 6174 5f63 6f64 5f65  branch(sat_cod_e
+00032590: 6e74 6974 795f 7461 7267 6574 2c20 3129  ntity_target, 1)
+000325a0: 0d0a 2020 2020 2020 2020 6966 2072 6563  ..        if rec
+000325b0: 6f72 645f 736f 7572 6365 2069 7320 6e6f  ord_source is no
+000325c0: 7420 4e6f 6e65 3a20 6861 735f 7273 203d  t None: has_rs =
+000325d0: 2054 7275 650d 0a20 2020 2020 2020 2061   True..        a
+000325e0: 7070 6c69 6564 5f64 6174 6520 3d20 7365  pplied_date = se
+000325f0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00032600: 616c 2e67 6574 5f61 7070 6c69 6564 5f64  al.get_applied_d
+00032610: 6174 655f 6f6e 5f64 765f 6672 6f6d 5f63  ate_on_dv_from_c
+00032620: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+00032630: 2864 765f 656e 7469 7479 2e63 6f64 5f65  (dv_entity.cod_e
+00032640: 6e74 6974 792c 2031 290d 0a20 2020 2020  ntity, 1)..     
+00032650: 2020 2069 6620 6170 706c 6965 645f 6461     if applied_da
+00032660: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a20  te is not None: 
+00032670: 6861 735f 6164 203d 2054 7275 650d 0a0d  has_ad = True...
+00032680: 0a20 2020 2020 2020 2068 6173 685f 666f  .        hash_fo
+00032690: 725f 6d65 7461 6461 7461 203d 2073 656c  r_metadata = sel
+000326a0: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
+000326b0: 5f68 6173 685f 666f 725f 6d65 7461 6461  _hash_for_metada
+000326c0: 7461 2829 0d0a 2020 2020 2020 2020 696e  ta()..        in
+000326d0: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
+000326e0: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
+000326f0: 7469 6f6e 2e67 6574 5f69 6e74 6567 6572  tion.get_integer
+00032700: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
+00032710: 0a0d 0a20 2020 2020 2020 2023 2323 2323  ...        #####
+00032720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00032730: 2323 2323 2323 2043 7265 6174 6520 456e  ###### Create En
+00032740: 7469 7479 2053 5447 2054 4d50 2023 2323  tity STG TMP ###
+00032750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00032760: 2323 2323 2323 2323 0d0a 0d0a 2020 2020  ########....    
+00032770: 2020 2020 6e75 6d5f 6272 616e 6368 6573      num_branches
+00032780: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+00032790: 5f61 6374 7561 6c2e 6765 745f 6e75 6d5f  _actual.get_num_
+000327a0: 6272 616e 6368 6573 5f6f 6e5f 656e 7472  branches_on_entr
+000327b0: 795f 6476 5f66 726f 6d5f 636f 645f 656e  y_dv_from_cod_en
+000327c0: 7469 7479 5f6e 616d 6528 6476 5f65 6e74  tity_name(dv_ent
+000327d0: 6974 792e 636f 645f 656e 7469 7479 290d  ity.cod_entity).
+000327e0: 0a0d 0a20 2020 2020 2020 2066 6f72 206e  ...        for n
+000327f0: 756d 5f62 7261 6e63 6820 696e 2072 616e  um_branch in ran
+00032800: 6765 2831 2c20 6e75 6d5f 6272 616e 6368  ge(1, num_branch
+00032810: 6573 202b 2031 293a 0d0a 0d0a 2020 2020  es + 1):....    
+00032820: 2020 2020 2020 2020 7465 6e61 6e74 5f73          tenant_s
+00032830: 6f75 7263 6520 3d20 7365 6c66 2e6d 6574  ource = self.met
+00032840: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+00032850: 5f74 656e 616e 745f 6f6e 5f64 765f 6672  _tenant_on_dv_fr
+00032860: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
+00032870: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
+00032880: 6e63 6828 6476 5f65 6e74 6974 792e 636f  nch(dv_entity.co
+00032890: 645f 656e 7469 7479 2c20 6e75 6d5f 6272  d_entity, num_br
+000328a0: 616e 6368 290d 0a20 2020 2020 2020 2020  anch)..         
+000328b0: 2020 2069 6620 6c65 6e28 7465 6e61 6e74     if len(tenant
+000328c0: 5f73 6f75 7263 6529 2021 3d20 303a 0d0a  _source) != 0:..
+000328d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000328e0: 6861 735f 746e 203d 2054 7275 650d 0a20  has_tn = True.. 
+000328f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00032900: 2047 6574 2064 6973 7469 6e63 7420 6672   Get distinct fr
+00032910: 6f6d 2054 454e 414e 5453 0d0a 2020 2020  om TENANTS..    
+00032920: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
+00032930: 6c5f 7465 6e61 6e74 5f6c 6973 7420 3d20  l_tenant_list = 
+00032940: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
+00032950: 2020 2020 666f 7220 746e 2069 6e20 7465      for tn in te
+00032960: 6e61 6e74 5f73 6f75 7263 653a 0d0a 2020  nant_source:..  
+00032970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032980: 2020 6966 2074 6e2e 636f 6c75 6d6e 5f6e    if tn.column_n
+00032990: 616d 655f 7461 7267 6574 206e 6f74 2069  ame_target not i
+000329a0: 6e20 5b78 2e63 6f6c 756d 6e5f 6e61 6d65  n [x.column_name
+000329b0: 5f74 6172 6765 7420 666f 7220 7820 696e  _target for x in
+000329c0: 2066 696e 616c 5f74 656e 616e 745f 6c69   final_tenant_li
+000329d0: 7374 5d3a 2066 696e 616c 5f74 656e 616e  st]: final_tenan
+000329e0: 745f 6c69 7374 2e61 7070 656e 6428 746e  t_list.append(tn
+000329f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00032a00: 2020 2074 656e 616e 745f 736f 7572 6365     tenant_source
+00032a10: 203d 2066 696e 616c 5f74 656e 616e 745f   = final_tenant_
+00032a20: 6c69 7374 0d0a 0d0a 2020 2020 2020 2020  list....        
+00032a30: 2020 2020 626b 5f65 6e74 7279 203d 2073      bk_entry = s
+00032a40: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00032a50: 7561 6c2e 6765 745f 6669 7273 745f 656e  ual.get_first_en
+00032a60: 7472 795f 6476 5f6d 6170 7069 6e67 735f  try_dv_mappings_
+00032a70: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+00032a80: 7461 7267 6574 5f61 6e64 5f6b 6579 5f74  target_and_key_t
+00032a90: 7970 655f 616e 645f 6e75 6d5f 6272 616e  ype_and_num_bran
+00032aa0: 6368 2873 6174 5f63 6f64 5f65 6e74 6974  ch(sat_cod_entit
+00032ab0: 795f 7461 7267 6574 2c20 4b45 595f 5459  y_target, KEY_TY
+00032ac0: 5045 5f42 5553 494e 4553 535f 4b45 592c  PE_BUSINESS_KEY,
+00032ad0: 206e 756d 5f62 7261 6e63 6829 0d0a 0d0a   num_branch)....
+00032ae0: 2020 2020 2020 2020 2020 2020 6d64 355f              md5_
+00032af0: 6675 6e63 7469 6f6e 203d 2073 656c 662e  function = self.
+00032b00: 6765 745f 6861 7368 5f6b 6579 5f66 726f  get_hash_key_fro
+00032b10: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
+00032b20: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
+00032b30: 6368 2873 6174 5f63 6f64 5f65 6e74 6974  ch(sat_cod_entit
+00032b40: 795f 7461 7267 6574 2c20 6e75 6d5f 6272  y_target, num_br
+00032b50: 616e 6368 290d 0a20 2020 2020 2020 2020  anch)..         
+00032b60: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00032b70: 6170 7069 6e67 203d 205b 626b 5f65 6e74  apping = [bk_ent
+00032b80: 7279 2e63 6f64 5f65 6e74 6974 795f 736f  ry.cod_entity_so
+00032b90: 7572 6365 2c20 6d64 355f 6675 6e63 7469  urce, md5_functi
+00032ba0: 6f6e 2c20 7072 6566 6978 5f65 7420 2b20  on, prefix_et + 
+00032bb0: 7361 745f 656e 7469 7479 5f74 6d70 2c0d  sat_entity_tmp,.
+00032bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032be0: 2020 2020 6861 7368 5f6e 616d 652c 0d0a      hash_name,..
+00032bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c10: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
+00032c20: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+00032c30: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
+00032c40: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+00032c50: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00032c60: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
 00032c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c90: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-00032ca0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-00032cb0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-00032cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032cd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00032ce0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00032cf0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-00032d00: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00032d10: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-00032d20: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-00032d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d50: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-00032d60: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-00032d70: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
-00032d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00032da0: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
-00032db0: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
-00032dc0: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
-00032dd0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00032de0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00032df0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00032e00: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00032e10: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00032e20: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00032e30: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-00032e40: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-00032e50: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00032e60: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
-00032e70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00032e80: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
-00032e90: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-00032ea0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00032eb0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00032ec0: 5b74 6e2e 636f 645f 656e 7469 7479 5f73  [tn.cod_entity_s
-00032ed0: 6f75 7263 652c 2074 6e2e 636f 6c75 6d6e  ource, tn.column
-00032ee0: 5f6e 616d 655f 736f 7572 6365 2c20 7072  _name_source, pr
-00032ef0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-00032f00: 7469 7479 5f74 6d70 2c0d 0a20 2020 2020  tity_tmp,..     
-00032f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032f30: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-00032f40: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00032f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032f70: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-00032f80: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-00032f90: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00032fa0: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
-00032fb0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-00032fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032fe0: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
-00032ff0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-00033000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033020: 206e 756d 5f62 7261 6e63 682c 204b 4559   num_branch, KEY
-00033030: 5f54 5950 455f 5445 4e41 4e54 2c20 312c  _TYPE_TENANT, 1,
-00033040: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00033050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033060: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00033070: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00033080: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00033090: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-000330a0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-000330b0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-000330c0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-000330d0: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
-000330e0: 2020 2023 2041 7472 6962 7574 6573 0d0a     # Atributes..
-000330f0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-00033100: 6965 645f 6461 7465 203d 2073 656c 662e  ied_date = self.
-00033110: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00033120: 6765 745f 6170 706c 6965 645f 6461 7465  get_applied_date
-00033130: 5f6f 6e5f 6476 5f66 726f 6d5f 636f 645f  _on_dv_from_cod_
-00033140: 656e 7469 7479 5f74 6172 6765 7428 6476  entity_target(dv
-00033150: 5f65 6e74 6974 792e 636f 645f 656e 7469  _entity.cod_enti
-00033160: 7479 2c20 6e75 6d5f 6272 616e 6368 290d  ty, num_branch).
-00033170: 0a0d 0a20 2020 2020 2020 2020 2020 206e  ...            n
-00033180: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00033190: 6e67 203d 205b 6170 706c 6965 645f 6461  ng = [applied_da
-000331a0: 7465 2e63 6f64 5f65 6e74 6974 795f 736f  te.cod_entity_so
-000331b0: 7572 6365 2c20 6170 706c 6965 645f 6461  urce, applied_da
-000331c0: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f73  te.column_name_s
-000331d0: 6f75 7263 652c 0d0a 2020 2020 2020 2020  ource,..        
-000331e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000331f0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00033200: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-00033210: 795f 746d 702c 0d0a 2020 2020 2020 2020  y_tmp,..        
-00033220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033230: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00033240: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-00033250: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00033260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033280: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00033290: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-000332a0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-000332b0: 6e2c 2061 7070 6c69 6564 5f64 6174 652e  n, applied_date.
-000332c0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-000332d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000332e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000332f0: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
-00033300: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
-00033310: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00033320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033330: 2020 2020 2020 6e75 6d5f 6272 616e 6368        num_branch
-00033340: 2c20 4b45 595f 5459 5045 5f41 5050 4c49  , KEY_TYPE_APPLI
-00033350: 4544 5f44 4154 452c 2031 2c20 7365 6c66  ED_DATE, 1, self
-00033360: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00033370: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00033380: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00033390: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000333a0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000333b0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-000333c0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-000333d0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-000333e0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000333f0: 4861 7368 6469 6666 2066 726f 6d20 6170  Hashdiff from ap
-00033400: 706c 6965 6420 4461 7465 0d0a 2020 2020  plied Date..    
-00033410: 2020 2020 2020 2020 6d64 355f 6675 6e63          md5_func
-00033420: 7469 6f6e 203d 2073 656c 662e 636f 6e6e  tion = self.conn
-00033430: 6563 7469 6f6e 2e67 6574 5f6d 6435 5f66  ection.get_md5_f
-00033440: 756e 6374 696f 6e28 290d 0a20 2020 2020  unction()..     
-00033450: 2020 2020 2020 2063 6173 745f 746f 5f73         cast_to_s
-00033460: 7472 696e 6720 3d20 7365 6c66 2e63 6f6e  tring = self.con
-00033470: 6e65 6374 696f 6e2e 6765 745f 6361 7374  nection.get_cast
-00033480: 5f73 7472 696e 675f 666f 725f 6d65 7461  _string_for_meta
-00033490: 6461 7461 2829 0d0a 0d0a 2020 2020 2020  data()....      
-000334a0: 2020 2020 2020 626b 5f66 696e 616c 203d        bk_final =
-000334b0: 2063 6173 745f 746f 5f73 7472 696e 672e   cast_to_string.
-000334c0: 7265 706c 6163 6528 275b 785d 272c 2061  replace('[x]', a
-000334d0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-000334e0: 6d6e 5f6e 616d 655f 736f 7572 6365 290d  mn_name_source).
-000334f0: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
-00033500: 6469 6666 203d 206d 6435 5f66 756e 6374  diff = md5_funct
-00033510: 696f 6e2e 7265 706c 6163 6528 275b 785d  ion.replace('[x]
-00033520: 272c 2062 6b5f 6669 6e61 6c29 0d0a 2020  ', bk_final)..  
-00033530: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-00033540: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00033550: 5b61 7070 6c69 6564 5f64 6174 652e 636f  [applied_date.co
-00033560: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
-00033570: 2068 6173 6469 6666 2c0d 0a20 2020 2020   hasdiff,..     
-00033580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033590: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000335a0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-000335b0: 7469 7479 5f74 6d70 2c20 2748 4153 4844  tity_tmp, 'HASHD
-000335c0: 4946 4627 2c0d 0a20 2020 2020 2020 2020  IFF',..         
-000335d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000335e0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-000335f0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-00033600: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00033610: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00033620: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-00033630: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-00033640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033660: 2020 6e75 6d5f 6272 616e 6368 2c20 4b45    num_branch, KE
-00033670: 595f 5459 5045 5f41 5454 5249 4255 5445  Y_TYPE_ATTRIBUTE
-00033680: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-00033690: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000336a0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-000336b0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-000336c0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-000336d0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-000336e0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-000336f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00033700: 2323 2323 2323 2323 2323 2320 4372 6561  ########### Crea
-00033710: 7465 2045 6e74 6974 7920 5354 4720 4c41  te Entity STG LA
-00033720: 5354 2049 4d41 4745 2031 2023 2323 2323  ST IMAGE 1 #####
-00033730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00033740: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00033750: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00033760: 203d 2031 0d0a 2020 2020 2020 2020 6e65   = 1..        ne
-00033770: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00033780: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-00033790: 2073 6174 5f65 6e74 6974 792c 2068 6173   sat_entity, has
-000337a0: 685f 6e61 6d65 2c20 7072 6566 6978 5f65  h_name, prefix_e
-000337b0: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
-000337c0: 6374 7561 6c5f 696d 6167 655f 312c 0d0a  ctual_image_1,..
-000337d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000337e0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000337f0: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
-00033800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033810: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00033820: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-00033830: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00033840: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00033850: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-00033860: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-00033870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033880: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00033890: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
-000338a0: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-000338b0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-000338c0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-000338d0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000338e0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000338f0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00033900: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00033910: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00033920: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00033930: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00033940: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00033950: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00033960: 5f65 6e74 6974 792c 2027 4841 5348 4449  _entity, 'HASHDI
-00033970: 4646 272c 0d0a 2020 2020 2020 2020 2020  FF',..          
-00033980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033990: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-000339a0: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
-000339b0: 616c 5f69 6d61 6765 5f31 2c20 2748 4153  al_image_1, 'HAS
-000339c0: 4844 4946 4627 2c0d 0a20 2020 2020 2020  HDIFF',..       
+00032c80: 2020 2020 2020 2020 2020 206e 756d 5f62             num_b
+00032c90: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
+00032ca0: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
+00032cb0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00032cc0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00032cd0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00032ce0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00032cf0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+00032d00: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00032d10: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00032d20: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+00032d30: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00032d40: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+00032d50: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+00032d60: 6374 696f 6e2e 6765 745f 7379 7364 6174  ction.get_sysdat
+00032d70: 655f 666f 725f 6d65 7461 6461 7461 2829  e_for_metadata()
+00032d80: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00032d90: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00032da0: 6720 3d20 5b27 272c 2073 656c 662e 636f  g = ['', self.co
+00032db0: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
+00032dc0: 6461 7465 5f76 616c 7565 2829 2c20 7072  date_value(), pr
+00032dd0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+00032de0: 7469 7479 5f74 6d70 2c0d 0a20 2020 2020  tity_tmp,..     
+00032df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032e00: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00032e10: 4154 455f 4352 4541 5445 4427 2c0d 0a20  ATE_CREATED',.. 
+00032e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032e40: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
+00032e50: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00032e60: 616c 5f70 6f73 6974 696f 6e2c 2073 7973  al_position, sys
+00032e70: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00032e80: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
+00032e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032ea0: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
+00032eb0: 655f 666f 725f 6d65 7461 6461 7461 5b32  e_for_metadata[2
+00032ec0: 5d2c 206e 756d 5f62 7261 6e63 682c 204e  ], num_branch, N
+00032ed0: 6f6e 652c 2031 2c20 7365 6c66 2e6f 776e  one, 1, self.own
+00032ee0: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00032ef0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00032f00: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00032f10: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00032f20: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+00032f30: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+00032f40: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+00032f50: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+00032f60: 2020 2020 2020 2020 2020 6966 2068 6173            if has
+00032f70: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
+00032f80: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+00032f90: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
+00032fa0: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
+00032fb0: 6563 6f72 645f 736f 7572 6365 5f6f 6e5f  ecord_source_on_
+00032fc0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
+00032fd0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
+00032fe0: 6d5f 6272 616e 6368 2873 6174 5f63 6f64  m_branch(sat_cod
+00032ff0: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
+00033000: 6e75 6d5f 6272 616e 6368 290d 0a20 2020  num_branch)..   
+00033010: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00033020: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00033030: 203d 205b 7265 636f 7264 5f73 6f75 7263   = [record_sourc
+00033040: 652e 636f 645f 656e 7469 7479 5f73 6f75  e.cod_entity_sou
+00033050: 7263 652c 2072 6563 6f72 645f 736f 7572  rce, record_sour
+00033060: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f73  ce.column_name_s
+00033070: 6f75 7263 652c 0d0a 2020 2020 2020 2020  ource,..        
+00033080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033090: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000330a0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+000330b0: 6e74 6974 795f 746d 702c 0d0a 2020 2020  ntity_tmp,..    
+000330c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000330d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000330e0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+000330f0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00033100: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+00033110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033120: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00033130: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+00033140: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+00033150: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00033160: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00033170: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00033180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000331a0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+000331b0: 7263 652e 636f 6c75 6d6e 5f70 7265 6369  rce.column_preci
+000331c0: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+000331d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000331e0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
+000331f0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
+00033200: 5045 5f52 4543 4f52 445f 534f 5552 4345  PE_RECORD_SOURCE
+00033210: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+00033220: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00033230: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00033240: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+00033250: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00033260: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+00033270: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00033280: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00033290: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+000332a0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+000332b0: 6620 6861 735f 746e 3a0d 0a20 2020 2020  f has_tn:..     
+000332c0: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+000332d0: 6e20 696e 2074 656e 616e 745f 736f 7572  n in tenant_sour
+000332e0: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+000332f0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+00033300: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00033310: 746e 2e63 6f64 5f65 6e74 6974 795f 736f  tn.cod_entity_so
+00033320: 7572 6365 2c20 746e 2e63 6f6c 756d 6e5f  urce, tn.column_
+00033330: 6e61 6d65 5f73 6f75 7263 652c 2070 7265  name_source, pre
+00033340: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+00033350: 6974 795f 746d 702c 0d0a 2020 2020 2020  ity_tmp,..      
+00033360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033380: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+00033390: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+000333a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000333b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000333c0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+000333d0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+000333e0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+000333f0: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
+00033400: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00033410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033420: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00033430: 6e2e 636f 6c75 6d6e 5f70 7265 6369 7369  n.column_precisi
+00033440: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00033450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033470: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+00033480: 5459 5045 5f54 454e 414e 542c 2031 2c20  TYPE_TENANT, 1, 
+00033490: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+000334a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000334b0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+000334c0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+000334d0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+000334e0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+000334f0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
+00033500: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+00033510: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+00033520: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
+00033530: 2020 2320 4174 7269 6275 7465 730d 0a20    # Atributes.. 
+00033540: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00033550: 6564 5f64 6174 6520 3d20 7365 6c66 2e6d  ed_date = self.m
+00033560: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+00033570: 6574 5f61 7070 6c69 6564 5f64 6174 655f  et_applied_date_
+00033580: 6f6e 5f64 765f 6672 6f6d 5f63 6f64 5f65  on_dv_from_cod_e
+00033590: 6e74 6974 795f 7461 7267 6574 2864 765f  ntity_target(dv_
+000335a0: 656e 7469 7479 2e63 6f64 5f65 6e74 6974  entity.cod_entit
+000335b0: 792c 206e 756d 5f62 7261 6e63 6829 0d0a  y, num_branch)..
+000335c0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+000335d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000335e0: 6720 3d20 5b61 7070 6c69 6564 5f64 6174  g = [applied_dat
+000335f0: 652e 636f 645f 656e 7469 7479 5f73 6f75  e.cod_entity_sou
+00033600: 7263 652c 2061 7070 6c69 6564 5f64 6174  rce, applied_dat
+00033610: 652e 636f 6c75 6d6e 5f6e 616d 655f 736f  e.column_name_so
+00033620: 7572 6365 2c0d 0a20 2020 2020 2020 2020  urce,..         
+00033630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033640: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00033650: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+00033660: 5f74 6d70 2c0d 0a20 2020 2020 2020 2020  _tmp,..         
+00033670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033680: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+00033690: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+000336a0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+000336b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000336c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000336d0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+000336e0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+000336f0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00033700: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
+00033710: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00033720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033740: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
+00033750: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
+00033760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00033770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033780: 2020 2020 206e 756d 5f62 7261 6e63 682c       num_branch,
+00033790: 204b 4559 5f54 5950 455f 4150 504c 4945   KEY_TYPE_APPLIE
+000337a0: 445f 4441 5445 2c20 312c 2073 656c 662e  D_DATE, 1, self.
+000337b0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+000337c0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+000337d0: 7469 6f6e 202b 3d20 310d 0a20 2020 2020  tion += 1..     
+000337e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+000337f0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00033800: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00033810: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00033820: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00033830: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
+00033840: 6173 6864 6966 6620 6672 6f6d 2061 7070  ashdiff from app
+00033850: 6c69 6564 2044 6174 650d 0a20 2020 2020  lied Date..     
+00033860: 2020 2020 2020 206d 6435 5f66 756e 6374         md5_funct
+00033870: 696f 6e20 3d20 7365 6c66 2e63 6f6e 6e65  ion = self.conne
+00033880: 6374 696f 6e2e 6765 745f 6d64 355f 6675  ction.get_md5_fu
+00033890: 6e63 7469 6f6e 2829 0d0a 2020 2020 2020  nction()..      
+000338a0: 2020 2020 2020 6361 7374 5f74 6f5f 7374        cast_to_st
+000338b0: 7269 6e67 203d 2073 656c 662e 636f 6e6e  ring = self.conn
+000338c0: 6563 7469 6f6e 2e67 6574 5f63 6173 745f  ection.get_cast_
+000338d0: 7374 7269 6e67 5f66 6f72 5f6d 6574 6164  string_for_metad
+000338e0: 6174 6128 290d 0a0d 0a20 2020 2020 2020  ata()....       
+000338f0: 2020 2020 2062 6b5f 6669 6e61 6c20 3d20       bk_final = 
+00033900: 6361 7374 5f74 6f5f 7374 7269 6e67 2e72  cast_to_string.r
+00033910: 6570 6c61 6365 2827 5b78 5d27 2c20 6170  eplace('[x]', ap
+00033920: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
+00033930: 6e5f 6e61 6d65 5f73 6f75 7263 6529 0d0a  n_name_source)..
+00033940: 2020 2020 2020 2020 2020 2020 6861 7364              hasd
+00033950: 6966 6620 3d20 6d64 355f 6675 6e63 7469  iff = md5_functi
+00033960: 6f6e 2e72 6570 6c61 6365 2827 5b78 5d27  on.replace('[x]'
+00033970: 2c20 626b 5f66 696e 616c 290d 0a20 2020  , bk_final)..   
+00033980: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+00033990: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+000339a0: 6170 706c 6965 645f 6461 7465 2e63 6f64  applied_date.cod
+000339b0: 5f65 6e74 6974 795f 736f 7572 6365 2c20  _entity_source, 
+000339c0: 6861 7364 6966 662c 0d0a 2020 2020 2020  hasdiff,..      
 000339d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000339e0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
-000339f0: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
-00033a00: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-00033a10: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-00033a20: 615b 315d 2c20 6861 7368 5f66 6f72 5f6d  a[1], hash_for_m
-00033a30: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
-00033a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033a50: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
-00033a60: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
-00033a70: 5459 5045 5f48 4153 4844 4946 462c 2031  TYPE_HASHDIFF, 1
-00033a80: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00033a90: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00033aa0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00033ab0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00033ac0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00033ad0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-00033ae0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-00033af0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
-00033b00: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00033b10: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00033b20: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00033b30: 5f65 6e74 6974 792c 2061 7070 6c69 6564  _entity, applied
-00033b40: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
-00033b50: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-00033b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033b70: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00033b80: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-00033b90: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
-00033ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00033bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033bc0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00033bd0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-00033be0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00033bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033c00: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-00033c10: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00033c20: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00033c30: 696f 6e2c 2061 7070 6c69 6564 5f64 6174  ion, applied_dat
-00033c40: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00033c50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00033c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033c70: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00033c80: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-00033c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033cb0: 312c 204b 4559 5f54 5950 455f 4445 5045  1, KEY_TYPE_DEPE
-00033cc0: 4e44 454e 545f 4348 494c 445f 4b45 592c  NDENT_CHILD_KEY,
-00033cd0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00033ce0: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-00033cf0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00033d00: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00033d10: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-00033d20: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00033d30: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-00033d40: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00033d50: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00033d60: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00033d70: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00033d80: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00033d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033da0: 2020 2020 2020 2020 2027 524f 575f 4e55           'ROW_NU
-00033db0: 4d42 4552 2829 206f 7665 7220 2870 6172  MBER() over (par
-00033dc0: 7469 7469 6f6e 2062 7920 2720 2b20 6861  tition by ' + ha
-00033dd0: 7368 5f6e 616d 6520 2b20 272c 2720 2b20  sh_name + ',' + 
-00033de0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00033df0: 756d 6e5f 6e61 6d65 5f74 6172 6765 7420  umn_name_target 
-00033e00: 2b20 2720 4f52 4445 5220 4259 2044 4154  + ' ORDER BY DAT
-00033e10: 455f 4352 4541 5445 4420 6465 7363 2927  E_CREATED desc)'
-00033e20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00033e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033e40: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-00033e50: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
-00033e60: 696d 6167 655f 312c 2027 524e 272c 0d0a  image_1, 'RN',..
-00033e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033e80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00033e90: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
-00033ea0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00033eb0: 706f 7369 7469 6f6e 2c20 696e 7465 6765  position, intege
-00033ec0: 725f 666f 725f 6d65 7461 6461 7461 5b31  r_for_metadata[1
-00033ed0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00033ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ef0: 2020 2069 6e74 6567 6572 5f66 6f72 5f6d     integer_for_m
-00033f00: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
-00033f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033f20: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
-00033f30: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
-00033f40: 5459 5045 5f4e 554c 4c2c 2031 2c20 7365  TYPE_NULL, 1, se
-00033f50: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00033f60: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00033f70: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00033f80: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00033f90: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00033fa0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00033fb0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00033fc0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00033fd0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-00033fe0: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
-00033ff0: 4372 6561 7465 2045 6e74 6974 7920 5354  Create Entity ST
-00034000: 4720 4c41 5354 2049 4d41 4745 2032 2023  G LAST IMAGE 2 #
-00034010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00034020: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
-00034030: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00034040: 7469 6f6e 203d 2031 0d0a 2020 2020 2020  tion = 1..      
-00034050: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00034060: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00034070: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00034080: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
-00034090: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
-000340a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000340b0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-000340c0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-000340d0: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
-000340e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000340f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034100: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
-00034110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034120: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00034130: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-00034140: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-00034150: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-00034160: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
-00034170: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-00034180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00034190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000341a0: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-000341b0: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
-000341c0: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
-000341d0: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
-000341e0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-000341f0: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-00034200: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00034210: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-00034220: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-00034230: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-00034240: 290d 0a0d 0a20 2020 2020 2020 206e 6577  )....        new
-00034250: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00034260: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00034270: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
-00034280: 6c5f 696d 6167 655f 312c 2027 4841 5348  l_image_1, 'HASH
-00034290: 4449 4646 272c 0d0a 2020 2020 2020 2020  DIFF',..        
-000342a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000342b0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-000342c0: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
-000342d0: 7475 616c 5f69 6d61 6765 5f32 2c20 2748  tual_image_2, 'H
-000342e0: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
-000342f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034300: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00034310: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-00034320: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00034330: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00034340: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-00034350: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+000339e0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+000339f0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+00033a00: 6974 795f 746d 702c 2027 4841 5348 4449  ity_tmp, 'HASHDI
+00033a10: 4646 272c 0d0a 2020 2020 2020 2020 2020  FF',..          
+00033a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033a30: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+00033a40: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+00033a50: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00033a60: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00033a70: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
+00033a80: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+00033a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ab0: 206e 756d 5f62 7261 6e63 682c 204b 4559   num_branch, KEY
+00033ac0: 5f54 5950 455f 4154 5452 4942 5554 452c  _TYPE_ATTRIBUTE,
+00033ad0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00033ae0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00033af0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00033b00: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00033b10: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00033b20: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00033b30: 675d 290d 0a0d 0a20 2020 2020 2020 2023  g])....        #
+00033b40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00033b50: 2323 2323 2323 2323 2323 2043 7265 6174  ########## Creat
+00033b60: 6520 456e 7469 7479 2053 5447 204c 4153  e Entity STG LAS
+00033b70: 5420 494d 4147 4520 3120 2323 2323 2323  T IMAGE 1 ######
+00033b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00033b90: 2323 2323 230d 0a20 2020 2020 2020 206f  #####..        o
+00033ba0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00033bb0: 3d20 310d 0a20 2020 2020 2020 206e 6577  = 1..        new
+00033bc0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00033bd0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+00033be0: 7361 745f 656e 7469 7479 2c20 6861 7368  sat_entity, hash
+00033bf0: 5f6e 616d 652c 2070 7265 6669 785f 6574  _name, prefix_et
+00033c00: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
+00033c10: 7475 616c 5f69 6d61 6765 5f31 2c0d 0a20  tual_image_1,.. 
+00033c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033c30: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00033c40: 7368 5f6e 616d 652c 0d0a 2020 2020 2020  sh_name,..      
+00033c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033c60: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+00033c70: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+00033c80: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00033c90: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00033ca0: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
+00033cb0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+00033cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033cd0: 2020 2020 2020 2020 2020 2020 2073 6174               sat
+00033ce0: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
+00033cf0: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+00033d00: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00033d10: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00033d20: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00033d30: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00033d40: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00033d50: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00033d60: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00033d70: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00033d80: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+00033d90: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00033da0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00033db0: 656e 7469 7479 2c20 2748 4153 4844 4946  entity, 'HASHDIF
+00033dc0: 4627 2c0d 0a20 2020 2020 2020 2020 2020  F',..           
+00033dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033de0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00033df0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+00033e00: 6c5f 696d 6167 655f 312c 2027 4841 5348  l_image_1, 'HASH
+00033e10: 4449 4646 272c 0d0a 2020 2020 2020 2020  DIFF',..        
+00033e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e30: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
+00033e40: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
+00033e50: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
+00033e60: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+00033e70: 5b31 5d2c 2068 6173 685f 666f 725f 6d65  [1], hash_for_me
+00033e80: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
+00033e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033ea0: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+00033eb0: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
+00033ec0: 5950 455f 4841 5348 4449 4646 2c20 312c  YPE_HASHDIFF, 1,
+00033ed0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+00033ee0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00033ef0: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+00033f00: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+00033f10: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+00033f20: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+00033f30: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+00033f40: 745f 6d61 7070 696e 675d 290d 0a0d 0a0d  t_mapping]).....
+00033f50: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+00033f60: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00033f70: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00033f80: 656e 7469 7479 2c20 6170 706c 6965 645f  entity, applied_
+00033f90: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
+00033fa0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+00033fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033fc0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00033fd0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+00033fe0: 6163 7475 616c 5f69 6d61 6765 5f31 2c0d  actual_image_1,.
+00033ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034010: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00034020: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+00034030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034050: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+00034060: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+00034070: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00034080: 6f6e 2c20 6170 706c 6965 645f 6461 7465  on, applied_date
+00034090: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+000340a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000340b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000340c0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+000340d0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+000340e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000340f0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
+00034100: 2c20 4b45 595f 5459 5045 5f44 4550 454e  , KEY_TYPE_DEPEN
+00034110: 4445 4e54 5f43 4849 4c44 5f4b 4559 2c20  DENT_CHILD_KEY, 
+00034120: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00034130: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00034140: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00034150: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00034160: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00034170: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00034180: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00034190: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+000341a0: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+000341b0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+000341c0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+000341d0: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+000341e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000341f0: 2020 2020 2020 2020 2752 4f57 5f4e 554d          'ROW_NUM
+00034200: 4245 5228 2920 6f76 6572 2028 7061 7274  BER() over (part
+00034210: 6974 696f 6e20 6279 2027 202b 2068 6173  ition by ' + has
+00034220: 685f 6e61 6d65 202b 2027 2c27 202b 2061  h_name + ',' + a
+00034230: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00034240: 6d6e 5f6e 616d 655f 7461 7267 6574 202b  mn_name_target +
+00034250: 2027 204f 5244 4552 2042 5920 4441 5445   ' ORDER BY DATE
+00034260: 5f43 5245 4154 4544 2064 6573 6329 272c  _CREATED desc)',
+00034270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034290: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+000342a0: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+000342b0: 6d61 6765 5f31 2c20 2752 4e27 2c0d 0a20  mage_1, 'RN',.. 
+000342c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000342d0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000342e0: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
+000342f0: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00034300: 6f73 6974 696f 6e2c 2069 6e74 6567 6572  osition, integer
+00034310: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+00034320: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00034330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034340: 2020 696e 7465 6765 725f 666f 725f 6d65    integer_for_me
+00034350: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
 00034360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034370: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00034380: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
-00034390: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-000343a0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-000343b0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-000343c0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-000343d0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000343e0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000343f0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00034400: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00034410: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00034420: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00034430: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00034440: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00034450: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-00034460: 6d61 6765 5f31 2c20 6170 706c 6965 645f  mage_1, applied_
-00034470: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-00034480: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-00034490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000344a0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-000344b0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-000344c0: 6163 7475 616c 5f69 6d61 6765 5f32 2c0d  actual_image_2,.
-000344d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000344e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000344f0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00034500: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-00034510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00034520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034530: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00034540: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-00034550: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00034560: 6f6e 2c20 6170 706c 6965 645f 6461 7465  on, applied_date
-00034570: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-00034580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000345a0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-000345b0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-000345c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000345d0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-000345e0: 2c20 4b45 595f 5459 5045 5f44 4550 454e  , KEY_TYPE_DEPEN
-000345f0: 4445 4e54 5f43 4849 4c44 5f4b 4559 2c20  DENT_CHILD_KEY, 
-00034600: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00034610: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00034620: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00034630: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00034640: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00034650: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00034660: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00034670: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00034680: 0a20 2020 2020 2020 206e 6577 5f66 696c  .        new_fil
-00034690: 7465 7220 3d20 5b70 7265 6669 785f 6574  ter = [prefix_et
-000346a0: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
-000346b0: 7475 616c 5f69 6d61 6765 5f32 2c20 2752  tual_image_2, 'R
-000346c0: 4e20 3d20 3127 2c20 7361 745f 6e75 6d5f  N = 1', sat_num_
-000346d0: 6272 616e 6368 2c20 7365 6c66 2e6f 776e  branch, self.own
-000346e0: 6572 5d0d 0a20 2020 2020 2020 2073 656c  er]..        sel
-000346f0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00034700: 6c2e 6164 645f 656e 7472 795f 6669 6c74  l.add_entry_filt
-00034710: 6572 7328 5b6e 6577 5f66 696c 7465 725d  ers([new_filter]
-00034720: 290d 0a0d 0a20 2020 2020 2020 2023 2323  )....        ###
-00034730: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00034740: 2323 2323 2323 2323 2043 7265 6174 6520  ######## Create 
-00034750: 456e 7469 7479 2053 5447 204a 4f49 4e20  Entity STG JOIN 
-00034760: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00034770: 2323 2323 2323 2323 2323 230d 0a20 2020  ###########..   
-00034780: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00034790: 6974 696f 6e20 3d20 310d 0a0d 0a20 2020  ition = 1....   
-000347a0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-000347b0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-000347c0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-000347d0: 7479 5f74 6d70 2c20 6861 7368 5f6e 616d  ty_tmp, hash_nam
-000347e0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-000347f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034800: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-00034810: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
-00034820: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
-00034830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034840: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00034850: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-00034860: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00034870: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-00034880: 6461 7461 5b31 5d2c 2068 6173 685f 666f  data[1], hash_fo
-00034890: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
-000348a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000348b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000348c0: 6174 5f6e 756d 5f62 7261 6e63 682c 204b  at_num_branch, K
-000348d0: 4559 5f54 5950 455f 4841 5348 5f4b 4559  EY_TYPE_HASH_KEY
-000348e0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-000348f0: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
-00034900: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00034910: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-00034920: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00034930: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00034940: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-00034950: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00034960: 0a0d 0a20 2020 2020 2020 206e 6577 5f64  ...        new_d
-00034970: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-00034980: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00034990: 745f 656e 7469 7479 5f74 6d70 2c20 2748  t_entity_tmp, 'H
-000349a0: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
-000349b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000349c0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-000349d0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-000349e0: 5f6a 6f69 6e2c 2027 4841 5348 4449 4646  _join, 'HASHDIFF
-000349f0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00034a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034a10: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-00034a20: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-00034a30: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
-00034a40: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-00034a50: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-00034a60: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
-00034a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034a80: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-00034a90: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-00034aa0: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
-00034ab0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00034ac0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-00034ad0: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-00034ae0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00034af0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00034b00: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-00034b10: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00034b20: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-00034b30: 2020 2069 6620 6861 735f 7273 3a0d 0a20     if has_rs:.. 
-00034b40: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
-00034b50: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
-00034b60: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00034b70: 745f 656e 7469 7479 5f74 6d70 2c20 7265  t_entity_tmp, re
-00034b80: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00034b90: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00034ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034bc0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-00034bd0: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
-00034be0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00034bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034c00: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-00034c10: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
-00034c20: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-00034c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034c40: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-00034c50: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00034c60: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-00034c70: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
-00034c80: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-00034c90: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-00034ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034cc0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00034cd0: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-00034ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034370: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
+00034380: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
+00034390: 5950 455f 4e55 4c4c 2c20 312c 2073 656c  YPE_NULL, 1, sel
+000343a0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000343b0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+000343c0: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+000343d0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+000343e0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+000343f0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00034400: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+00034410: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00034420: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00034430: 2323 2323 2323 2323 2323 2323 2323 2043  ############## C
+00034440: 7265 6174 6520 456e 7469 7479 2053 5447  reate Entity STG
+00034450: 204c 4153 5420 494d 4147 4520 3220 2323   LAST IMAGE 2 ##
+00034460: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00034470: 2323 2323 2323 2323 230d 0a20 2020 2020  #########..     
+00034480: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+00034490: 696f 6e20 3d20 310d 0a20 2020 2020 2020  ion = 1..       
+000344a0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+000344b0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+000344c0: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
+000344d0: 6374 7561 6c5f 696d 6167 655f 312c 2068  ctual_image_1, h
+000344e0: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
+000344f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034500: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00034510: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+00034520: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
+00034530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034550: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+00034560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034570: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00034580: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+00034590: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+000345a0: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
+000345b0: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
+000345c0: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
+000345d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000345e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000345f0: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
+00034600: 4b45 595f 5459 5045 5f48 4153 485f 4b45  KEY_TYPE_HASH_KE
+00034610: 592c 2031 2c20 7365 6c66 2e6f 776e 6572  Y, 1, self.owner
+00034620: 5d0d 0a20 2020 2020 2020 206f 7264 696e  ]..        ordin
+00034630: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00034640: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+00034650: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+00034660: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+00034670: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+00034680: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+00034690: 0d0a 0d0a 2020 2020 2020 2020 6e65 775f  ....        new_
+000346a0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+000346b0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+000346c0: 6174 5f65 6e74 6974 795f 6163 7475 616c  at_entity_actual
+000346d0: 5f69 6d61 6765 5f31 2c20 2748 4153 4844  _image_1, 'HASHD
+000346e0: 4946 4627 2c0d 0a20 2020 2020 2020 2020  IFF',..         
+000346f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034700: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+00034710: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
+00034720: 7561 6c5f 696d 6167 655f 322c 2027 4841  ual_image_2, 'HA
+00034730: 5348 4449 4646 272c 0d0a 2020 2020 2020  SHDIFF',..      
+00034740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034750: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+00034760: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+00034770: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00034780: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00034790: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
+000347a0: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+000347b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000347c0: 2020 2020 2020 2020 2020 2020 2073 6174               sat
+000347d0: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
+000347e0: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+000347f0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00034800: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00034810: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00034820: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00034830: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00034840: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00034850: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00034860: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00034870: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+00034880: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00034890: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+000348a0: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
+000348b0: 6167 655f 312c 2061 7070 6c69 6564 5f64  age_1, applied_d
+000348c0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+000348d0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+000348e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000348f0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00034900: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
+00034910: 6374 7561 6c5f 696d 6167 655f 322c 0d0a  ctual_image_2,..
+00034920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034930: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00034940: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00034950: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+00034960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034980: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00034990: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+000349a0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+000349b0: 6e2c 2061 7070 6c69 6564 5f64 6174 652e  n, applied_date.
+000349c0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+000349d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000349e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000349f0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00034a00: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+00034a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034a20: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00034a30: 204b 4559 5f54 5950 455f 4445 5045 4e44   KEY_TYPE_DEPEND
+00034a40: 454e 545f 4348 494c 445f 4b45 592c 2031  ENT_CHILD_KEY, 1
+00034a50: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00034a60: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00034a70: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00034a80: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00034a90: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00034aa0: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00034ab0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00034ac0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00034ad0: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
+00034ae0: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
+00034af0: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
+00034b00: 7561 6c5f 696d 6167 655f 322c 2027 524e  ual_image_2, 'RN
+00034b10: 203d 2031 272c 2073 6174 5f6e 756d 5f62   = 1', sat_num_b
+00034b20: 7261 6e63 682c 2073 656c 662e 6f77 6e65  ranch, self.owne
+00034b30: 725d 0d0a 2020 2020 2020 2020 7365 6c66  r]..        self
+00034b40: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00034b50: 2e61 6464 5f65 6e74 7279 5f66 696c 7465  .add_entry_filte
+00034b60: 7273 285b 6e65 775f 6669 6c74 6572 5d29  rs([new_filter])
+00034b70: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
+00034b80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00034b90: 2323 2323 2323 2320 4372 6561 7465 2045  ####### Create E
+00034ba0: 6e74 6974 7920 5354 4720 4a4f 494e 2023  ntity STG JOIN #
+00034bb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00034bc0: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
+00034bd0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00034be0: 7469 6f6e 203d 2031 0d0a 0d0a 2020 2020  tion = 1....    
+00034bf0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00034c00: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+00034c10: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+00034c20: 795f 746d 702c 2068 6173 685f 6e61 6d65  y_tmp, hash_name
+00034c30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00034c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034c50: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+00034c60: 745f 656e 7469 7479 5f6a 6f69 6e2c 2068  t_entity_join, h
+00034c70: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
+00034c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034c90: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+00034ca0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+00034cb0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00034cc0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+00034cd0: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
+00034ce0: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
 00034cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034d00: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
-00034d10: 6368 2c20 4b45 595f 5459 5045 5f52 4543  ch, KEY_TYPE_REC
-00034d20: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
-00034d30: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00034d40: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00034d50: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-00034d60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00034d70: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00034d80: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-00034d90: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-00034da0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-00034db0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-00034dc0: 6861 735f 746e 3a0d 0a20 2020 2020 2020  has_tn:..       
-00034dd0: 2020 2020 2066 6f72 2074 6e20 696e 2074       for tn in t
-00034de0: 656e 616e 745f 736f 7572 6365 3a0d 0a20  enant_source:.. 
-00034df0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00034e00: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00034e10: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00034e20: 2b20 7361 745f 656e 7469 7479 5f74 6d70  + sat_entity_tmp
-00034e30: 2c20 746e 2e63 6f6c 756d 6e5f 6e61 6d65  , tn.column_name
-00034e40: 5f74 6172 6765 742c 2070 7265 6669 785f  _target, prefix_
-00034e50: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00034e60: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
-00034e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034e80: 2020 2020 2020 2020 2020 2020 2020 746e                tn
-00034e90: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-00034ea0: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
-00034eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034ec0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
-00034ed0: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-00034ee0: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-00034ef0: 7469 6f6e 2c20 746e 2e63 6f6c 756d 6e5f  tion, tn.column_
-00034f00: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-00034f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034f30: 746e 2e63 6f6c 756d 6e5f 7072 6563 6973  tn.column_precis
-00034f40: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-00034f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034f60: 2020 2020 2020 2020 2020 2020 2031 2c20               1, 
-00034f70: 4b45 595f 5459 5045 5f54 454e 414e 542c  KEY_TYPE_TENANT,
-00034f80: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00034f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034fa0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00034fb0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00034fc0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-00034fd0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-00034fe0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
-00034ff0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-00035000: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00035010: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00035020: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00035030: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00035040: 5f65 6e74 6974 795f 746d 702c 2027 4441  _entity_tmp, 'DA
-00035050: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
-00035060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035070: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00035080: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-00035090: 6974 795f 6a6f 696e 2c20 2744 4154 455f  ity_join, 'DATE_
-000350a0: 4352 4541 5445 4427 2c0d 0a20 2020 2020  CREATED',..     
-000350b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000350c0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-000350d0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-000350e0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000350f0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00035100: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-00035110: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-00035120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035130: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00035140: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
-00035150: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-00035160: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00035170: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-00035180: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00035190: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000351a0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000351b0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-000351c0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-000351d0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-000351e0: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-000351f0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00035200: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00035210: 5f65 6e74 6974 795f 746d 702c 2061 7070  _entity_tmp, app
-00035220: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00035230: 5f6e 616d 655f 7461 7267 6574 2c20 7072  _name_target, pr
-00035240: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-00035250: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
-00035260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035270: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00035280: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-00035290: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-000352a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000352b0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-000352c0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-000352d0: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
-000352e0: 696e 616c 5f70 6f73 6974 696f 6e2c 2061  inal_position, a
-000352f0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-00035300: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-00035310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035320: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-00035330: 6564 5f64 6174 652e 636f 6c75 6d6e 5f70  ed_date.column_p
-00035340: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-00035350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035360: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
-00035370: 5f54 5950 455f 4445 5045 4e44 454e 545f  _TYPE_DEPENDENT_
-00035380: 4348 494c 445f 4b45 592c 2031 2c20 7365  CHILD_KEY, 1, se
-00035390: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-000353a0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-000353b0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-000353c0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-000353d0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-000353e0: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-000353f0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00035400: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-00035410: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00035420: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00035430: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-00035440: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
-00035450: 2c20 6861 7368 5f6e 616d 652c 0d0a 2020  , hash_name,..  
-00035460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035470: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00035480: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-00035490: 6974 795f 6a6f 696e 2c20 6861 7368 5f6e  ity_join, hash_n
-000354a0: 616d 6520 2b20 225f 4849 5354 222c 0d0a  ame + "_HIST",..
+00034d00: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00034d10: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+00034d20: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
+00034d30: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00034d40: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+00034d50: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00034d60: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00034d70: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00034d80: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00034d90: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00034da0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00034db0: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
+00034dc0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00034dd0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00034de0: 5f65 6e74 6974 795f 746d 702c 2027 4841  _entity_tmp, 'HA
+00034df0: 5348 4449 4646 272c 0d0a 2020 2020 2020  SHDIFF',..      
+00034e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034e10: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00034e20: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+00034e30: 6a6f 696e 2c20 2748 4153 4844 4946 4627  join, 'HASHDIFF'
+00034e40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00034e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034e60: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+00034e70: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+00034e80: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
+00034e90: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
+00034ea0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00034eb0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+00034ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034ed0: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+00034ee0: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
+00034ef0: 4153 485f 4b45 592c 2031 2c20 7365 6c66  ASH_KEY, 1, self
+00034f00: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00034f10: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00034f20: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+00034f30: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00034f40: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00034f50: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00034f60: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00034f70: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00034f80: 2020 6966 2068 6173 5f72 733a 0d0a 2020    if has_rs:..  
+00034f90: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00034fa0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00034fb0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00034fc0: 5f65 6e74 6974 795f 746d 702c 2072 6563  _entity_tmp, rec
+00034fd0: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+00034fe0: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+00034ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035010: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+00035020: 6174 5f65 6e74 6974 795f 6a6f 696e 2c0d  at_entity_join,.
+00035030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035050: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+00035060: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+00035070: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+00035080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035090: 2020 2020 2020 2020 2020 7265 636f 7264            record
+000350a0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
+000350b0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+000350c0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7265  nal_position, re
+000350d0: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+000350e0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+000350f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035100: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00035110: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00035120: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+00035130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035150: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
+00035160: 682c 204b 4559 5f54 5950 455f 5245 434f  h, KEY_TYPE_RECO
+00035170: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
+00035180: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00035190: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+000351a0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+000351b0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+000351c0: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+000351d0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+000351e0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+000351f0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+00035200: 0d0a 0d0a 2020 2020 2020 2020 6966 2068  ....        if h
+00035210: 6173 5f74 6e3a 0d0a 2020 2020 2020 2020  as_tn:..        
+00035220: 2020 2020 666f 7220 746e 2069 6e20 7465      for tn in te
+00035230: 6e61 6e74 5f73 6f75 7263 653a 0d0a 2020  nant_source:..  
+00035240: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00035250: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00035260: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+00035270: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
+00035280: 2074 6e2e 636f 6c75 6d6e 5f6e 616d 655f   tn.column_name_
+00035290: 7461 7267 6574 2c20 7072 6566 6978 5f65  target, prefix_e
+000352a0: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
+000352b0: 6f69 6e2c 0d0a 2020 2020 2020 2020 2020  oin,..          
+000352c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000352d0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
+000352e0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+000352f0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
+00035300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035310: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
+00035320: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+00035330: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+00035340: 696f 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c  ion, tn.column_l
+00035350: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+00035360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035370: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00035380: 6e2e 636f 6c75 6d6e 5f70 7265 6369 7369  n.column_precisi
+00035390: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+000353a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000353b0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+000353c0: 4559 5f54 5950 455f 5445 4e41 4e54 2c20  EY_TYPE_TENANT, 
+000353d0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+000353e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000353f0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00035400: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00035410: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00035420: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00035430: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+00035440: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00035450: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+00035460: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+00035470: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00035480: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00035490: 656e 7469 7479 5f74 6d70 2c20 2744 4154  entity_tmp, 'DAT
+000354a0: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
 000354b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000354c0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000354d0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-000354e0: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-000354f0: 6974 696f 6e2c 2068 6173 685f 666f 725f  ition, hash_for_
-00035500: 6d65 7461 6461 7461 5b31 5d2c 2068 6173  metadata[1], has
-00035510: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
-00035520: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00035530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035540: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
-00035550: 682c 204b 4559 5f54 5950 455f 4841 5348  h, KEY_TYPE_HASH
-00035560: 5f4b 4559 2c20 312c 2073 656c 662e 6f77  _KEY, 1, self.ow
-00035570: 6e65 725d 0d0a 2020 2020 2020 2020 6f72  ner]..        or
-00035580: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-00035590: 3d20 310d 0a20 2020 2020 2020 2073 656c  = 1..        sel
-000355a0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-000355b0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-000355c0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-000355d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-000355e0: 675d 290d 0a0d 0a20 2020 2020 2020 206e  g])....        n
-000355f0: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
-00035600: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00035610: 6174 5f65 6e74 6974 795f 746d 702c 2027  at_entity_tmp, '
-00035620: 4841 5348 4449 4646 272c 0d0a 2020 2020  HASHDIFF',..    
-00035630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035640: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-00035650: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
-00035660: 6374 7561 6c5f 696d 6167 655f 322c 0d0a  ctual_image_2,..
-00035670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035680: 2020 2020 2020 2020 2020 2020 2748 4153              'HAS
-00035690: 4844 4946 4627 2c20 224d 4153 5445 5220  HDIFF', "MASTER 
-000356a0: 4a4f 494e 222c 2073 656c 662e 6f77 6e65  JOIN", self.owne
-000356b0: 725d 0d0a 2020 2020 2020 2020 7365 6c66  r]..        self
-000356c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000356d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000356e0: 6574 5f72 656c 6174 696f 6e73 6869 7028  et_relationship(
-000356f0: 5b6e 6577 5f72 656c 6174 696f 6e73 6869  [new_relationshi
-00035700: 705d 290d 0a20 2020 2020 2020 206e 6577  p])..        new
-00035710: 5f72 656c 6174 696f 6e73 6869 7020 3d20  _relationship = 
-00035720: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00035730: 5f65 6e74 6974 795f 746d 702c 2068 6173  _entity_tmp, has
-00035740: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
-00035750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035760: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00035770: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
-00035780: 616c 5f69 6d61 6765 5f32 2c0d 0a20 2020  al_image_2,..   
-00035790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000357a0: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
-000357b0: 6d65 2c20 224d 4153 5445 5220 4a4f 494e  me, "MASTER JOIN
-000357c0: 222c 2073 656c 662e 6f77 6e65 725d 0d0a  ", self.owner]..
-000357d0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000357e0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000357f0: 5f65 6e74 7279 5f64 6174 6173 6574 5f72  _entry_dataset_r
-00035800: 656c 6174 696f 6e73 6869 7028 5b6e 6577  elationship([new
-00035810: 5f72 656c 6174 696f 6e73 6869 705d 290d  _relationship]).
-00035820: 0a0d 0a20 2020 2020 2020 206e 6577 5f72  ...        new_r
-00035830: 656c 6174 696f 6e73 6869 7020 3d20 5b70  elationship = [p
-00035840: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-00035850: 6e74 6974 795f 746d 702c 2061 7070 6c69  ntity_tmp, appli
-00035860: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-00035870: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00035880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035890: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-000358a0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-000358b0: 6163 7475 616c 5f69 6d61 6765 5f32 2c0d  actual_image_2,.
-000358c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000358d0: 2020 2020 2020 2020 2020 2020 2061 7070               app
-000358e0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-000358f0: 5f6e 616d 655f 7461 7267 6574 2c20 224d  _name_target, "M
-00035900: 4153 5445 5220 4a4f 494e 222c 2073 656c  ASTER JOIN", sel
-00035910: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00035920: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00035930: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00035940: 5f64 6174 6173 6574 5f72 656c 6174 696f  _dataset_relatio
-00035950: 6e73 6869 7028 5b6e 6577 5f72 656c 6174  nship([new_relat
-00035960: 696f 6e73 6869 705d 290d 0a0d 0a20 2020  ionship])....   
-00035970: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00035980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00035990: 2043 7265 6174 6520 456e 7469 7479 2053   Create Entity S
-000359a0: 4154 2023 2323 2323 2323 2323 2323 2323  AT #############
-000359b0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-000359c0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-000359d0: 706f 7369 7469 6f6e 203d 2031 0d0a 0d0a  position = 1....
-000359e0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-000359f0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00035a00: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-00035a10: 6e74 6974 795f 6a6f 696e 2c20 6861 7368  ntity_join, hash
-00035a20: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-00035a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035a40: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-00035a50: 202b 2073 6174 5f65 6e74 6974 792c 2068   + sat_entity, h
-00035a60: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
-00035a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035a80: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00035a90: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-00035aa0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00035ab0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00035ac0: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-00035ad0: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-00035ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035af0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00035b00: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
-00035b10: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-00035b20: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00035b30: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-00035b40: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00035b50: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00035b60: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00035b70: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00035b80: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00035b90: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00035ba0: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00035bb0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00035bc0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00035bd0: 5f65 6e74 6974 795f 6a6f 696e 2c20 2748  _entity_join, 'H
-00035be0: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
-00035bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035c00: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-00035c10: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-00035c20: 2c20 2748 4153 4844 4946 4627 2c0d 0a20  , 'HASHDIFF',.. 
-00035c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035c40: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00035c50: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00035c60: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-00035c70: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
-00035c80: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
-00035c90: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
-00035ca0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00035cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035cc0: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
-00035cd0: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
-00035ce0: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
-00035cf0: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
-00035d00: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00035d10: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
-00035d20: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00035d30: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00035d40: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00035d50: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00035d60: 5d29 0d0a 0d0a 2020 2020 2020 2020 6966  ])....        if
-00035d70: 2068 6173 5f72 733a 0d0a 2020 2020 2020   has_rs:..      
-00035d80: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00035d90: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-00035da0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-00035db0: 6974 795f 6a6f 696e 2c20 7265 636f 7264  ity_join, record
-00035dc0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
-00035dd0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00035de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e00: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-00035e10: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-00035e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e30: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00035e40: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-00035e50: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00035e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e80: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-00035e90: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-00035ea0: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-00035eb0: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
-00035ec0: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-00035ed0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00035ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035ef0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-00035f00: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-00035f10: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
-00035f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035f30: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
-00035f40: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
-00035f50: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
-00035f60: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
-00035f70: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
-00035f80: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-00035f90: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-00035fa0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00035fb0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00035fc0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00035fd0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00035fe0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00035ff0: 2020 2020 6966 2068 6173 5f74 6e3a 0d0a      if has_tn:..
-00036000: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00036010: 746e 2069 6e20 7465 6e61 6e74 5f73 6f75  tn in tenant_sou
-00036020: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-00036030: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00036040: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-00036050: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-00036060: 6974 795f 6a6f 696e 2c20 746e 2e63 6f6c  ity_join, tn.col
-00036070: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-00036080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000360a0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-000360b0: 6574 202b 2073 6174 5f65 6e74 6974 792c  et + sat_entity,
-000360c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000360d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000360e0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-000360f0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00036100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036120: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-00036130: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-00036140: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00036150: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
-00036160: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00036170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036180: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-00036190: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-000361a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000361b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000361c0: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-000361d0: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
-000361e0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-000361f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00036200: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00036210: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-00036220: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00036230: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00036240: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00036250: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00036260: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-00036270: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-00036280: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-00036290: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-000362a0: 7479 5f6a 6f69 6e2c 2027 4441 5445 5f43  ty_join, 'DATE_C
-000362b0: 5245 4154 4544 272c 0d0a 2020 2020 2020  REATED',..      
+000354c0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+000354d0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+000354e0: 7479 5f6a 6f69 6e2c 2027 4441 5445 5f43  ty_join, 'DATE_C
+000354f0: 5245 4154 4544 272c 0d0a 2020 2020 2020  REATED',..      
+00035500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035510: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+00035520: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+00035530: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00035540: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00035550: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
+00035560: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+00035570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035580: 2020 2020 2020 2020 2020 2020 2073 6174               sat
+00035590: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
+000355a0: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+000355b0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+000355c0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+000355d0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+000355e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+000355f0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00035600: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00035610: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00035620: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00035630: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+00035640: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00035650: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00035660: 656e 7469 7479 5f74 6d70 2c20 6170 706c  entity_tmp, appl
+00035670: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00035680: 6e61 6d65 5f74 6172 6765 742c 2070 7265  name_target, pre
+00035690: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+000356a0: 6974 795f 6a6f 696e 2c0d 0a20 2020 2020  ity_join,..     
+000356b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000356c0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+000356d0: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+000356e0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+000356f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035700: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00035710: 6564 5f64 6174 652e 636f 6c75 6d6e 5f74  ed_date.column_t
+00035720: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+00035730: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6170  nal_position, ap
+00035740: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
+00035750: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
+00035760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035770: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+00035780: 645f 6461 7465 2e63 6f6c 756d 6e5f 7072  d_date.column_pr
+00035790: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+000357a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000357b0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
+000357c0: 5459 5045 5f44 4550 454e 4445 4e54 5f43  TYPE_DEPENDENT_C
+000357d0: 4849 4c44 5f4b 4559 2c20 312c 2073 656c  HILD_KEY, 1, sel
+000357e0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000357f0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00035800: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00035810: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00035820: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00035830: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+00035840: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00035850: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+00035860: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00035870: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+00035880: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+00035890: 5f61 6374 7561 6c5f 696d 6167 655f 322c  _actual_image_2,
+000358a0: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+000358b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000358c0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+000358d0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+000358e0: 7479 5f6a 6f69 6e2c 2068 6173 685f 6e61  ty_join, hash_na
+000358f0: 6d65 202b 2022 5f48 4953 5422 2c0d 0a20  me + "_HIST",.. 
+00035900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035910: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00035920: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00035930: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+00035940: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
+00035950: 6574 6164 6174 615b 315d 2c20 6861 7368  etadata[1], hash
+00035960: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00035970: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00035980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035990: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
+000359a0: 2c20 4b45 595f 5459 5045 5f48 4153 485f  , KEY_TYPE_HASH_
+000359b0: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
+000359c0: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
+000359d0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+000359e0: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
+000359f0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00035a00: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00035a10: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+00035a20: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00035a30: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
+00035a40: 775f 7265 6c61 7469 6f6e 7368 6970 203d  w_relationship =
+00035a50: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00035a60: 745f 656e 7469 7479 5f74 6d70 2c20 2748  t_entity_tmp, 'H
+00035a70: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
+00035a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035a90: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00035aa0: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
+00035ab0: 7475 616c 5f69 6d61 6765 5f32 2c0d 0a20  tual_image_2,.. 
+00035ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035ad0: 2020 2020 2020 2020 2020 2027 4841 5348             'HASH
+00035ae0: 4449 4646 272c 2022 4d41 5354 4552 204a  DIFF', "MASTER J
+00035af0: 4f49 4e22 2c20 7365 6c66 2e6f 776e 6572  OIN", self.owner
+00035b00: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+00035b10: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00035b20: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00035b30: 745f 7265 6c61 7469 6f6e 7368 6970 285b  t_relationship([
+00035b40: 6e65 775f 7265 6c61 7469 6f6e 7368 6970  new_relationship
+00035b50: 5d29 0d0a 2020 2020 2020 2020 6e65 775f  ])..        new_
+00035b60: 7265 6c61 7469 6f6e 7368 6970 203d 205b  relationship = [
+00035b70: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00035b80: 656e 7469 7479 5f74 6d70 2c20 6861 7368  entity_tmp, hash
+00035b90: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
+00035ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035bb0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00035bc0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+00035bd0: 6c5f 696d 6167 655f 322c 0d0a 2020 2020  l_image_2,..    
+00035be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035bf0: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
+00035c00: 652c 2022 4d41 5354 4552 204a 4f49 4e22  e, "MASTER JOIN"
+00035c10: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00035c20: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00035c30: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00035c40: 656e 7472 795f 6461 7461 7365 745f 7265  entry_dataset_re
+00035c50: 6c61 7469 6f6e 7368 6970 285b 6e65 775f  lationship([new_
+00035c60: 7265 6c61 7469 6f6e 7368 6970 5d29 0d0a  relationship])..
+00035c70: 0d0a 2020 2020 2020 2020 6e65 775f 7265  ..        new_re
+00035c80: 6c61 7469 6f6e 7368 6970 203d 205b 7072  lationship = [pr
+00035c90: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+00035ca0: 7469 7479 5f74 6d70 2c20 6170 706c 6965  tity_tmp, applie
+00035cb0: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+00035cc0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00035cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035ce0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00035cf0: 7420 2b20 7361 745f 656e 7469 7479 5f61  t + sat_entity_a
+00035d00: 6374 7561 6c5f 696d 6167 655f 322c 0d0a  ctual_image_2,..
+00035d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035d20: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+00035d30: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00035d40: 6e61 6d65 5f74 6172 6765 742c 2022 4d41  name_target, "MA
+00035d50: 5354 4552 204a 4f49 4e22 2c20 7365 6c66  STER JOIN", self
+00035d60: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00035d70: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00035d80: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00035d90: 6461 7461 7365 745f 7265 6c61 7469 6f6e  dataset_relation
+00035da0: 7368 6970 285b 6e65 775f 7265 6c61 7469  ship([new_relati
+00035db0: 6f6e 7368 6970 5d29 0d0a 0d0a 2020 2020  onship])....    
+00035dc0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+00035dd0: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+00035de0: 4372 6561 7465 2045 6e74 6974 7920 5341  Create Entity SA
+00035df0: 5420 2323 2323 2323 2323 2323 2323 2323  T ##############
+00035e00: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
+00035e10: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00035e20: 6f73 6974 696f 6e20 3d20 310d 0a0d 0a20  osition = 1.... 
+00035e30: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+00035e40: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+00035e50: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
+00035e60: 7469 7479 5f6a 6f69 6e2c 2068 6173 685f  tity_join, hash_
+00035e70: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+00035e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035e90: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+00035ea0: 2b20 7361 745f 656e 7469 7479 2c20 6861  + sat_entity, ha
+00035eb0: 7368 5f6e 616d 652c 0d0a 2020 2020 2020  sh_name,..      
+00035ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035ed0: 2020 2020 2020 2020 2068 6173 685f 666f           hash_fo
+00035ee0: 725f 6d65 7461 6461 7461 5b30 5d2c 206f  r_metadata[0], o
+00035ef0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00035f00: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00035f10: 7461 5b31 5d2c 2068 6173 685f 666f 725f  ta[1], hash_for_
+00035f20: 6d65 7461 6461 7461 5b32 5d2c 0d0a 2020  metadata[2],..  
+00035f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035f40: 2020 2020 2020 2020 2020 2020 2073 6174               sat
+00035f50: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
+00035f60: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+00035f70: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00035f80: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00035f90: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00035fa0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00035fb0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00035fc0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00035fd0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00035fe0: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+00035ff0: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
+00036000: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
+00036010: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00036020: 656e 7469 7479 5f6a 6f69 6e2c 2027 4841  entity_join, 'HA
+00036030: 5348 4449 4646 272c 0d0a 2020 2020 2020  SHDIFF',..      
+00036040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036050: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00036060: 6574 202b 2073 6174 5f65 6e74 6974 792c  et + sat_entity,
+00036070: 2027 4841 5348 4449 4646 272c 0d0a 2020   'HASHDIFF',..  
+00036080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036090: 2020 2020 2020 2020 2020 2020 2068 6173               has
+000360a0: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+000360b0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+000360c0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+000360d0: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
+000360e0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+000360f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00036100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036110: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+00036120: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
+00036130: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
+00036140: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
+00036150: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00036160: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00036170: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00036180: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00036190: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+000361a0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+000361b0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+000361c0: 6861 735f 7273 3a0d 0a20 2020 2020 2020  has_rs:..       
+000361d0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+000361e0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+000361f0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+00036200: 7479 5f6a 6f69 6e2c 2072 6563 6f72 645f  ty_join, record_
+00036210: 736f 7572 6365 2e63 6f6c 756d 6e5f 6e61  source.column_na
+00036220: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+00036230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036240: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00036250: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+00036260: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
+00036270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036280: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00036290: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+000362a0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+000362b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000362c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000362d0: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-000362e0: 6574 202b 2073 6174 5f65 6e74 6974 792c  et + sat_entity,
-000362f0: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
-00036300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036320: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-00036330: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
-00036340: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
-00036350: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
-00036360: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-00036370: 5b32 5d2c 0d0a 2020 2020 2020 2020 2020  [2],..          
-00036380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036390: 2020 2020 2073 6174 5f6e 756d 5f62 7261       sat_num_bra
-000363a0: 6e63 682c 204b 4559 5f54 5950 455f 4841  nch, KEY_TYPE_HA
-000363b0: 5348 5f4b 4559 2c20 312c 2073 656c 662e  SH_KEY, 1, self.
-000363c0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-000363d0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000363e0: 202b 3d20 310d 0a20 2020 2020 2020 2073   += 1..        s
-000363f0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00036400: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-00036410: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00036420: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00036430: 696e 675d 290d 0a0d 0a0d 0a20 2020 2020  ing])......     
-00036440: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-00036450: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-00036460: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-00036470: 5f6a 6f69 6e2c 2061 7070 6c69 6564 5f64  _join, applied_d
-00036480: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-00036490: 7461 7267 6574 2c20 7072 6566 6978 5f65  target, prefix_e
-000364a0: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
-000364b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000364c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000364d0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-000364e0: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
-000364f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036510: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00036520: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-00036530: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00036540: 6f6e 2c20 6170 706c 6965 645f 6461 7465  on, applied_date
-00036550: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-00036560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036580: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00036590: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
-000365a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000365b0: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-000365c0: 2c20 4b45 595f 5459 5045 5f44 4550 454e  , KEY_TYPE_DEPEN
-000365d0: 4445 4e54 5f43 4849 4c44 5f4b 4559 2c20  DENT_CHILD_KEY, 
-000365e0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-000365f0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00036600: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00036610: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00036620: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00036630: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00036640: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00036650: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00036660: 0a20 2020 2020 2020 206e 6577 5f66 696c  .        new_fil
-00036670: 7465 7220 3d20 5b70 7265 6669 785f 6574  ter = [prefix_et
-00036680: 202b 2073 6174 5f65 6e74 6974 792c 2068   + sat_entity, h
-00036690: 6173 685f 6e61 6d65 202b 2022 5f48 4953  ash_name + "_HIS
-000366a0: 5420 6973 206e 756c 6c22 2c20 7361 745f  T is null", sat_
-000366b0: 6e75 6d5f 6272 616e 6368 2c20 7365 6c66  num_branch, self
-000366c0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-000366d0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-000366e0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-000366f0: 6669 6c74 6572 7328 5b6e 6577 5f66 696c  filters([new_fil
-00036700: 7465 725d 290d 0a0d 0a20 2020 2020 2020  ter])....       
-00036710: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
-00036720: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
-00036730: 2246 696e 6973 6865 6420 746f 2070 726f  "Finished to pro
-00036740: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
-00036750: 5265 636f 7264 2054 7261 636b 696e 6720  Record Tracking 
-00036760: 5361 7465 6c6c 6974 6520 5d20 696e 666f  Satellite ] info
-00036770: 726d 6174 696f 6e22 2c20 4c4f 475f 4c45  rmation", LOG_LE
-00036780: 5645 4c5f 4f4e 4c59 5f4c 4f47 290d 0a0d  VEL_ONLY_LOG)...
-00036790: 0a20 2020 2064 6566 2070 726f 6365 7373  .    def process
-000367a0: 5f64 765f 6c69 6e6b 5f63 7265 6174 696f  _dv_link_creatio
-000367b0: 6e5f 6c69 6e6b 2873 656c 662c 206c 696e  n_link(self, lin
-000367c0: 6b29 3a0d 0a20 2020 2020 2020 2073 656c  k):..        sel
-000367d0: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
-000367e0: 6e67 696e 655f 6e61 6d65 2c20 2253 7461  ngine_name, "Sta
-000367f0: 7274 696e 6720 746f 2070 726f 6365 7373  rting to process
-00036800: 204d 6574 6164 6174 6120 5b20 4c69 6e6b   Metadata [ Link
-00036810: 2064 6566 696e 6974 696f 6e20 5d20 696e   definition ] in
-00036820: 666f 726d 6174 696f 6e22 2c20 4c4f 475f  formation", LOG_
-00036830: 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47 290d  LEVEL_ONLY_LOG).
-00036840: 0a20 2020 2020 2020 2023 544f 444f 3a20  .        #TODO: 
-00036850: 6372 6561 6369 6f6e 2064 656c 206c 696e  creacion del lin
-00036860: 6b20 2d3e 2074 656e 6572 2065 6e20 6375  k -> tener en cu
-00036870: 656e 7461 2073 6920 6573 2043 4443 206f  enta si es CDC o
-00036880: 206e 6f0d 0a20 2020 2020 2020 2023 2323   no..        ###
-00036890: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000368a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000368b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000368c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000368d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000368e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000368f0: 2323 2323 2323 2323 230d 0a20 2020 2020  #########..     
-00036900: 2020 2070 7265 6669 785f 6574 203d 2027     prefix_et = '
-00036910: 4554 5f27 0d0a 2020 2020 2020 2020 6861  ET_'..        ha
-00036920: 735f 7273 203d 2046 616c 7365 0d0a 2020  s_rs = False..  
-00036930: 2020 2020 2020 6861 735f 746e 203d 2046        has_tn = F
-00036940: 616c 7365 0d0a 2020 2020 2020 2020 6861  alse..        ha
-00036950: 735f 6164 203d 2046 616c 7365 0d0a 2020  s_ad = False..  
-00036960: 2020 2020 2020 6861 735f 7365 7120 3d20        has_seq = 
-00036970: 4661 6c73 650d 0a20 2020 2020 2020 2072  False..        r
-00036980: 6563 6f72 645f 736f 7572 6365 203d 204e  ecord_source = N
-00036990: 6f6e 650d 0a20 2020 2020 2020 2074 656e  one..        ten
-000369a0: 616e 745f 736f 7572 6365 203d 204e 6f6e  ant_source = Non
-000369b0: 650d 0a20 2020 2020 2020 2073 6571 5f73  e..        seq_s
-000369c0: 6f75 7263 6520 3d20 4e6f 6e65 0d0a 2020  ource = None..  
-000369d0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-000369e0: 7465 203d 204e 6f6e 650d 0a0d 0a20 2020  te = None....   
-000369f0: 2020 2020 2068 6173 685f 6e61 6d65 203d       hash_name =
-00036a00: 2027 4841 5348 5f27 202b 206c 696e 6b2e   'HASH_' + link.
-00036a10: 656e 7469 7479 5f6e 616d 650d 0a20 2020  entity_name..   
-00036a20: 2020 2020 2064 765f 7072 6f70 6572 7479       dv_property
-00036a30: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00036a40: 5f61 6374 7561 6c2e 6765 745f 6476 5f70  _actual.get_dv_p
-00036a50: 726f 7065 7274 6965 735f 6672 6f6d 5f63  roperties_from_c
-00036a60: 6f64 5f65 6e74 6974 795f 616e 645f 6e75  od_entity_and_nu
-00036a70: 6d5f 636f 6e6e 6563 7469 6f6e 286c 696e  m_connection(lin
-00036a80: 6b2e 636f 645f 656e 7469 7479 2c20 3029  k.cod_entity, 0)
-00036a90: 0d0a 2020 2020 2020 2020 6966 2064 765f  ..        if dv_
-00036aa0: 7072 6f70 6572 7479 2069 7320 6e6f 7420  property is not 
-00036ab0: 4e6f 6e65 3a20 6861 7368 5f6e 616d 6520  None: hash_name 
-00036ac0: 3d20 6476 5f70 726f 7065 7274 792e 6861  = dv_property.ha
-00036ad0: 7368 5f6e 616d 650d 0a0d 0a20 2020 2020  sh_name....     
-00036ae0: 2020 2023 2043 7265 6174 696f 6e20 6f66     # Creation of
-00036af0: 204c 494e 4b20 454e 5449 5459 0d0a 2020   LINK ENTITY..  
-00036b00: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00036b10: 7369 7469 6f6e 203d 2031 0d0a 2020 2020  sition = 1..    
-00036b20: 2020 2020 6c69 6e6b 5f73 7467 5f74 6d70      link_stg_tmp
-00036b30: 5f6e 616d 6520 3d20 2753 5447 5f54 4d50  _name = 'STG_TMP
-00036b40: 5f27 202b 206c 696e 6b2e 656e 7469 7479  _' + link.entity
-00036b50: 5f6e 616d 650d 0a20 2020 2020 2020 206c  _name..        l
-00036b60: 696e 6b5f 7374 675f 6e61 6d65 203d 2027  ink_stg_name = '
-00036b70: 5354 475f 2720 2b20 6c69 6e6b 2e65 6e74  STG_' + link.ent
-00036b80: 6974 795f 6e61 6d65 0d0a 2020 2020 2020  ity_name..      
-00036b90: 2020 6c69 6e6b 5f73 7467 5f6c 6173 745f    link_stg_last_
-00036ba0: 696d 6167 655f 6e61 6d65 203d 2027 5354  image_name = 'ST
-00036bb0: 475f 2720 2b20 6c69 6e6b 2e65 6e74 6974  G_' + link.entit
-00036bc0: 795f 6e61 6d65 202b 2022 5f4c 4153 545f  y_name + "_LAST_
-00036bd0: 494d 4147 4522 0d0a 2020 2020 2020 2020  IMAGE"..        
-00036be0: 6c69 6e6b 5f6e 616d 6520 3d20 6c69 6e6b  link_name = link
-00036bf0: 2e65 6e74 6974 795f 6e61 6d65 0d0a 2020  .entity_name..  
-00036c00: 2020 2020 2020 6e65 775f 656e 7469 7479        new_entity
-00036c10: 5f73 7467 5f74 6d70 203d 205b 7072 6566  _stg_tmp = [pref
-00036c20: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
-00036c30: 5f74 6d70 5f6e 616d 652c 206c 696e 6b5f  _tmp_name, link_
-00036c40: 7374 675f 746d 705f 6e61 6d65 2c20 454e  stg_tmp_name, EN
-00036c50: 5449 5459 5f57 4954 482c 206c 696e 6b2e  TITY_WITH, link.
-00036c60: 636f 645f 7061 7468 2c20 2727 2c20 7365  cod_path, '', se
-00036c70: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00036c80: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00036c90: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00036ca0: 795f 656e 7469 7479 285b 6e65 775f 656e  y_entity([new_en
-00036cb0: 7469 7479 5f73 7467 5f74 6d70 5d29 0d0a  tity_stg_tmp])..
-00036cc0: 2020 2020 2020 2020 6e65 775f 656e 7469          new_enti
-00036cd0: 7479 5f73 7467 203d 205b 7072 6566 6978  ty_stg = [prefix
-00036ce0: 5f65 7420 2b20 6c69 6e6b 5f73 7467 5f6e  _et + link_stg_n
-00036cf0: 616d 652c 206c 696e 6b5f 7374 675f 6e61  ame, link_stg_na
-00036d00: 6d65 2c20 454e 5449 5459 5f57 4954 482c  me, ENTITY_WITH,
-00036d10: 206c 696e 6b2e 636f 645f 7061 7468 2c20   link.cod_path, 
-00036d20: 2727 2c20 7365 6c66 2e6f 776e 6572 5d0d  '', self.owner].
-00036d30: 0a20 2020 2020 2020 2073 656c 662e 6d65  .        self.me
-00036d40: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00036d50: 645f 656e 7472 795f 656e 7469 7479 285b  d_entry_entity([
-00036d60: 6e65 775f 656e 7469 7479 5f73 7467 5d29  new_entity_stg])
-00036d70: 0d0a 2020 2020 2020 2020 6e65 775f 656e  ..        new_en
-00036d80: 7469 7479 5f73 7467 203d 205b 7072 6566  tity_stg = [pref
-00036d90: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
-00036da0: 5f6c 6173 745f 696d 6167 655f 6e61 6d65  _last_image_name
-00036db0: 2c20 6c69 6e6b 5f73 7467 5f6c 6173 745f  , link_stg_last_
-00036dc0: 696d 6167 655f 6e61 6d65 2c20 454e 5449  image_name, ENTI
-00036dd0: 5459 5f57 4954 482c 206c 696e 6b2e 636f  TY_WITH, link.co
-00036de0: 645f 7061 7468 2c20 2727 2c20 7365 6c66  d_path, '', self
-00036df0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00036e00: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00036e10: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-00036e20: 656e 7469 7479 285b 6e65 775f 656e 7469  entity([new_enti
-00036e30: 7479 5f73 7467 5d29 0d0a 2020 2020 2020  ty_stg])..      
-00036e40: 2020 6e65 775f 656e 7469 7479 5f68 7562    new_entity_hub
-00036e50: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00036e60: 6c69 6e6b 5f6e 616d 652c 206c 696e 6b5f  link_name, link_
-00036e70: 6e61 6d65 2c20 454e 5449 5459 5f54 422c  name, ENTITY_TB,
-00036e80: 206c 696e 6b2e 636f 645f 7061 7468 2c20   link.cod_path, 
-00036e90: 2249 4e53 4552 5422 2c20 7365 6c66 2e6f  "INSERT", self.o
-00036ea0: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-00036eb0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00036ec0: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
-00036ed0: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
-00036ee0: 5f68 7562 5d29 0d0a 0d0a 2020 2020 2020  _hub])....      
-00036ef0: 2020 2320 496e 636c 7564 6520 454e 5452    # Include ENTR
-00036f00: 5920 6672 6f6d 2045 545f 5354 475f 544d  Y from ET_STG_TM
-00036f10: 505f 5b4c 696e 6b5d 0d0a 2020 2020 2020  P_[Link]..      
-00036f20: 2020 656e 7472 795f 6476 5f6d 6170 7069    entry_dv_mappi
-00036f30: 6e67 5f62 6b20 3d20 5b5d 0d0a 2020 2020  ng_bk = []..    
-00036f40: 2020 2020 6e75 6d5f 6272 616e 6368 6573      num_branches
-00036f50: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00036f60: 5f61 6374 7561 6c2e 6765 745f 6e75 6d5f  _actual.get_num_
-00036f70: 6272 616e 6368 6573 5f6f 6e5f 656e 7472  branches_on_entr
-00036f80: 795f 6476 5f66 726f 6d5f 636f 645f 656e  y_dv_from_cod_en
-00036f90: 7469 7479 5f6e 616d 6528 6c69 6e6b 2e63  tity_name(link.c
-00036fa0: 6f64 5f65 6e74 6974 7929 0d0a 2020 2020  od_entity)..    
-00036fb0: 2020 2020 6e75 6d5f 636f 6e6e 6563 7469      num_connecti
-00036fc0: 6f6e 7320 3d20 7365 6c66 2e6d 6574 6164  ons = self.metad
-00036fd0: 6174 615f 6163 7475 616c 2e67 6574 5f6e  ata_actual.get_n
-00036fe0: 756d 5f63 6f6e 6e65 6374 696f 6e73 5f6f  um_connections_o
-00036ff0: 6e5f 656e 7472 795f 6476 5f66 726f 6d5f  n_entry_dv_from_
-00037000: 636f 645f 656e 7469 7479 5f6e 616d 6528  cod_entity_name(
-00037010: 6c69 6e6b 2e63 6f64 5f65 6e74 6974 7929  link.cod_entity)
-00037020: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-00037030: 6e75 6d5f 6272 616e 6368 2069 6e20 7261  num_branch in ra
-00037040: 6e67 6528 312c 206e 756d 5f62 7261 6e63  nge(1, num_branc
-00037050: 6865 7320 2b20 3129 3a0d 0a20 2020 2020  hes + 1):..     
-00037060: 2020 2020 2020 2074 656e 616e 745f 736f         tenant_so
-00037070: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
-00037080: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
-00037090: 7465 6e61 6e74 5f6f 6e5f 6476 5f66 726f  tenant_on_dv_fro
-000370a0: 6d5f 636f 645f 656e 7469 7479 5f74 6172  m_cod_entity_tar
-000370b0: 6765 745f 616e 645f 6e75 6d5f 6272 616e  get_and_num_bran
-000370c0: 6368 286c 696e 6b2e 636f 645f 656e 7469  ch(link.cod_enti
-000370d0: 7479 2c20 6e75 6d5f 6272 616e 6368 290d  ty, num_branch).
-000370e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000370f0: 6c65 6e28 7465 6e61 6e74 5f73 6f75 7263  len(tenant_sourc
-00037100: 6529 2021 3d20 303a 0d0a 2020 2020 2020  e) != 0:..      
-00037110: 2020 2020 2020 2020 2020 6861 735f 746e            has_tn
-00037120: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00037130: 2020 2020 2020 2020 2023 2047 6574 2064           # Get d
-00037140: 6973 7469 6e63 7420 6672 6f6d 2054 454e  istinct from TEN
-00037150: 414e 5453 0d0a 2020 2020 2020 2020 2020  ANTS..          
-00037160: 2020 2020 2020 6669 6e61 6c5f 7465 6e61        final_tena
-00037170: 6e74 5f6c 6973 7420 3d20 5b5d 0d0a 2020  nt_list = []..  
-00037180: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00037190: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
-000371a0: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
-000371b0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-000371c0: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-000371d0: 7267 6574 206e 6f74 2069 6e20 5b78 2e63  rget not in [x.c
-000371e0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-000371f0: 7420 666f 7220 7820 696e 2066 696e 616c  t for x in final
-00037200: 5f74 656e 616e 745f 6c69 7374 5d3a 2066  _tenant_list]: f
-00037210: 696e 616c 5f74 656e 616e 745f 6c69 7374  inal_tenant_list
-00037220: 2e61 7070 656e 6428 746e 290d 0a20 2020  .append(tn)..   
-00037230: 2020 2020 2020 2020 2020 2020 2074 656e               ten
-00037240: 616e 745f 736f 7572 6365 203d 2066 696e  ant_source = fin
-00037250: 616c 5f74 656e 616e 745f 6c69 7374 0d0a  al_tenant_list..
-00037260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037270: 7465 6e61 6e74 5f73 6f75 7263 652e 736f  tenant_source.so
-00037280: 7274 286b 6579 3d6c 616d 6264 6120 783a  rt(key=lambda x:
-00037290: 2078 2e6f 7264 696e 616c 5f70 6f73 6974   x.ordinal_posit
-000372a0: 696f 6e29 0d0a 0d0a 2020 2020 2020 2020  ion)....        
-000372b0: 2020 2020 7365 715f 736f 7572 6365 203d      seq_source =
-000372c0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-000372d0: 6374 7561 6c2e 6765 745f 7365 715f 6f6e  ctual.get_seq_on
-000372e0: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
-000372f0: 6974 795f 7461 7267 6574 5f61 6e64 5f6e  ity_target_and_n
-00037300: 756d 5f62 7261 6e63 6828 6c69 6e6b 2e63  um_branch(link.c
-00037310: 6f64 5f65 6e74 6974 792c 206e 756d 5f62  od_entity, num_b
-00037320: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-00037330: 2020 2020 6966 206c 656e 2873 6571 5f73      if len(seq_s
-00037340: 6f75 7263 6529 2021 3d20 303a 0d0a 2020  ource) != 0:..  
-00037350: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00037360: 735f 7365 7120 3d20 5472 7565 0d0a 2020  s_seq = True..  
-00037370: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00037380: 715f 736f 7572 6365 2e73 6f72 7428 6b65  q_source.sort(ke
-00037390: 793d 6c61 6d62 6461 2078 3a20 782e 6f72  y=lambda x: x.or
-000373a0: 6469 6e61 6c5f 706f 7369 7469 6f6e 290d  dinal_position).
-000373b0: 0a0d 0a20 2020 2020 2020 2020 2020 2072  ...            r
-000373c0: 6563 6f72 645f 736f 7572 6365 203d 2073  ecord_source = s
-000373d0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-000373e0: 7561 6c2e 6765 745f 7265 636f 7264 5f73  ual.get_record_s
-000373f0: 6f75 7263 655f 6f6e 5f64 765f 6672 6f6d  ource_on_dv_from
-00037400: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
-00037410: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
-00037420: 6828 6c69 6e6b 2e63 6f64 5f65 6e74 6974  h(link.cod_entit
-00037430: 792c 206e 756d 5f62 7261 6e63 6829 0d0a  y, num_branch)..
-00037440: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00037450: 6563 6f72 645f 736f 7572 6365 2069 7320  ecord_source is 
-00037460: 6e6f 7420 4e6f 6e65 3a20 6861 735f 7273  not None: has_rs
-00037470: 203d 2054 7275 650d 0a0d 0a20 2020 2020   = True....     
-00037480: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-00037490: 6174 6520 3d20 7365 6c66 2e6d 6574 6164  ate = self.metad
-000374a0: 6174 615f 6163 7475 616c 2e67 6574 5f61  ata_actual.get_a
-000374b0: 7070 6c69 6564 5f64 6174 655f 6f6e 5f64  pplied_date_on_d
-000374c0: 765f 6672 6f6d 5f63 6f64 5f65 6e74 6974  v_from_cod_entit
-000374d0: 795f 7461 7267 6574 286c 696e 6b2e 636f  y_target(link.co
-000374e0: 645f 656e 7469 7479 2c20 6e75 6d5f 6272  d_entity, num_br
-000374f0: 616e 6368 290d 0a20 2020 2020 2020 2020  anch)..         
-00037500: 2020 2069 6620 6170 706c 6965 645f 6461     if applied_da
-00037510: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a20  te is not None: 
-00037520: 6861 735f 6164 203d 2054 7275 650d 0a0d  has_ad = True...
-00037530: 0a20 2020 2020 2020 2020 2020 2065 6e74  .            ent
-00037540: 7279 5f64 765f 6d61 7070 696e 675f 626b  ry_dv_mapping_bk
-00037550: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00037560: 5f61 6374 7561 6c2e 6765 745f 616c 6c5f  _actual.get_all_
-00037570: 626b 5f66 726f 6d5f 656e 7472 795f 6476  bk_from_entry_dv
-00037580: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
-00037590: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
-000375a0: 6828 6c69 6e6b 2e63 6f64 5f65 6e74 6974  h(link.cod_entit
-000375b0: 792c 206e 756d 5f62 7261 6e63 6829 0d0a  y, num_branch)..
-000375c0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
-000375d0: 795f 6476 5f6d 6170 7069 6e67 5f62 6b2e  y_dv_mapping_bk.
-000375e0: 736f 7274 286b 6579 3d6c 616d 6264 6120  sort(key=lambda 
-000375f0: 783a 2078 2e6f 7264 696e 616c 5f70 6f73  x: x.ordinal_pos
-00037600: 6974 696f 6e29 0d0a 2020 2020 2020 2020  ition)..        
-00037610: 2020 2020 636f 645f 656e 7469 7479 5f73      cod_entity_s
-00037620: 6f75 7263 6520 3d20 656e 7472 795f 6476  ource = entry_dv
-00037630: 5f6d 6170 7069 6e67 5f62 6b5b 305d 2e63  _mapping_bk[0].c
-00037640: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-00037650: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00037660: 6d64 355f 6675 6e63 7469 6f6e 203d 2073  md5_function = s
-00037670: 656c 662e 6765 745f 6861 7368 5f6b 6579  elf.get_hash_key
-00037680: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
-00037690: 5f74 6172 6765 745f 616e 645f 6e75 6d5f  _target_and_num_
-000376a0: 6272 616e 6368 286c 696e 6b2e 636f 645f  branch(link.cod_
-000376b0: 656e 7469 7479 2c20 6e75 6d5f 6272 616e  entity, num_bran
-000376c0: 6368 290d 0a0d 0a20 2020 2020 2020 2020  ch)....         
-000376d0: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-000376e0: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-000376f0: 6563 7469 6f6e 2e67 6574 5f68 6173 685f  ection.get_hash_
-00037700: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-00037710: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00037720: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00037730: 3d20 5b63 6f64 5f65 6e74 6974 795f 736f  = [cod_entity_so
-00037740: 7572 6365 2c20 6d64 355f 6675 6e63 7469  urce, md5_functi
-00037750: 6f6e 2c20 7072 6566 6978 5f65 7420 2b20  on, prefix_et + 
-00037760: 6c69 6e6b 5f73 7467 5f74 6d70 5f6e 616d  link_stg_tmp_nam
-00037770: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00037780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037790: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-000377a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000377b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000377c0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-000377d0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-000377e0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-000377f0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00037800: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-00037810: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-00037820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037830: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-00037840: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-00037850: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-00037860: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00037870: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-00037880: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00037890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000378a0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000378b0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000378c0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-000378d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000378e0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000378f0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-00037900: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-00037910: 6563 7469 6f6e 2e67 6574 5f73 7973 6461  ection.get_sysda
-00037920: 7465 5f66 6f72 5f6d 6574 6164 6174 6128  te_for_metadata(
-00037930: 290d 0a20 2020 2020 2020 2020 2020 206e  )..            n
-00037940: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00037950: 6e67 203d 205b 2727 2c20 7365 6c66 2e63  ng = ['', self.c
-00037960: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
-00037970: 7364 6174 655f 7661 6c75 6528 292c 2070  sdate_value(), p
-00037980: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-00037990: 7374 675f 746d 705f 6e61 6d65 2c20 2744  stg_tmp_name, 'D
-000379a0: 4154 455f 4352 4541 5445 4427 2c0d 0a20  ATE_CREATED',.. 
-000379b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000379c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000379d0: 2020 7379 7364 6174 655f 666f 725f 6d65    sysdate_for_me
-000379e0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
-000379f0: 616c 5f70 6f73 6974 696f 6e2c 2073 7973  al_position, sys
-00037a00: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-00037a10: 615b 315d 2c0d 0a20 2020 2020 2020 2020  a[1],..         
-00037a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037a30: 2020 2020 2020 2020 2020 7379 7364 6174            sysdat
-00037a40: 655f 666f 725f 6d65 7461 6461 7461 5b32  e_for_metadata[2
-00037a50: 5d2c 206e 756d 5f62 7261 6e63 682c 204b  ], num_branch, K
-00037a60: 4559 5f54 5950 455f 4e55 4c4c 2c20 312c  EY_TYPE_NULL, 1,
-00037a70: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00037a80: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00037a90: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00037aa0: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00037ab0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-00037ac0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-00037ad0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-00037ae0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-00037af0: 3d20 310d 0a0d 0a20 2020 2020 2020 2020  = 1....         
-00037b00: 2020 2069 6620 6861 735f 7273 3a0d 0a20     if has_rs:.. 
-00037b10: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00037b20: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00037b30: 6e67 203d 205b 7265 636f 7264 5f73 6f75  ng = [record_sou
-00037b40: 7263 652e 636f 645f 656e 7469 7479 5f73  rce.cod_entity_s
-00037b50: 6f75 7263 652c 2072 6563 6f72 645f 736f  ource, record_so
-00037b60: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
-00037b70: 5f73 6f75 7263 652c 0d0a 2020 2020 2020  _source,..      
-00037b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ba0: 2070 7265 6669 785f 6574 202b 206c 696e   prefix_et + lin
-00037bb0: 6b5f 7374 675f 746d 705f 6e61 6d65 2c0d  k_stg_tmp_name,.
-00037bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000362d0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+000362e0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+000362f0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+00036300: 696f 6e2c 2072 6563 6f72 645f 736f 7572  ion, record_sour
+00036310: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
+00036320: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00036330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036340: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+00036350: 7263 652e 636f 6c75 6d6e 5f70 7265 6369  rce.column_preci
+00036360: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+00036370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036380: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
+00036390: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
+000363a0: 5045 5f52 4543 4f52 445f 534f 5552 4345  PE_RECORD_SOURCE
+000363b0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+000363c0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+000363d0: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
+000363e0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+000363f0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00036400: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00036410: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00036420: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+00036430: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00036440: 2020 2069 6620 6861 735f 746e 3a0d 0a20     if has_tn:.. 
+00036450: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00036460: 6e20 696e 2074 656e 616e 745f 736f 7572  n in tenant_sour
+00036470: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+00036480: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+00036490: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+000364a0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+000364b0: 7479 5f6a 6f69 6e2c 2074 6e2e 636f 6c75  ty_join, tn.colu
+000364c0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+000364d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000364e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000364f0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00036500: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
+00036510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036530: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+00036540: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+00036550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036570: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+00036580: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+00036590: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+000365a0: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
+000365b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000365c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000365d0: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+000365e0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+000365f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036610: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+00036620: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
+00036630: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00036640: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00036650: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00036660: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00036670: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00036680: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00036690: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000366a0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+000366b0: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+000366c0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+000366d0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+000366e0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+000366f0: 795f 6a6f 696e 2c20 2744 4154 455f 4352  y_join, 'DATE_CR
+00036700: 4541 5445 4427 2c0d 0a20 2020 2020 2020  EATED',..       
+00036710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036720: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+00036730: 7420 2b20 7361 745f 656e 7469 7479 2c20  t + sat_entity, 
+00036740: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
+00036750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036770: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00036780: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+00036790: 7369 7469 6f6e 2c20 6861 7368 5f66 6f72  sition, hash_for
+000367a0: 5f6d 6574 6164 6174 615b 315d 2c20 6861  _metadata[1], ha
+000367b0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+000367c0: 325d 2c0d 0a20 2020 2020 2020 2020 2020  2],..           
+000367d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000367e0: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
+000367f0: 6368 2c20 4b45 595f 5459 5045 5f48 4153  ch, KEY_TYPE_HAS
+00036800: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
+00036810: 776e 6572 5d0d 0a20 2020 2020 2020 206f  wner]..        o
+00036820: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00036830: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
+00036840: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00036850: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00036860: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00036870: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00036880: 6e67 5d29 0d0a 0d0a 0d0a 2020 2020 2020  ng])......      
+00036890: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+000368a0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+000368b0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+000368c0: 6a6f 696e 2c20 6170 706c 6965 645f 6461  join, applied_da
+000368d0: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
+000368e0: 6172 6765 742c 2070 7265 6669 785f 6574  arget, prefix_et
+000368f0: 202b 2073 6174 5f65 6e74 6974 792c 0d0a   + sat_entity,..
+00036900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036910: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00036920: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00036930: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+00036940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036960: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00036970: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+00036980: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00036990: 6e2c 2061 7070 6c69 6564 5f64 6174 652e  n, applied_date.
+000369a0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+000369b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000369c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000369d0: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+000369e0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
+000369f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036a00: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00036a10: 204b 4559 5f54 5950 455f 4445 5045 4e44   KEY_TYPE_DEPEND
+00036a20: 454e 545f 4348 494c 445f 4b45 592c 2031  ENT_CHILD_KEY, 1
+00036a30: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00036a40: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00036a50: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00036a60: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00036a70: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00036a80: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00036a90: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00036aa0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00036ab0: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
+00036ac0: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
+00036ad0: 2b20 7361 745f 656e 7469 7479 2c20 6861  + sat_entity, ha
+00036ae0: 7368 5f6e 616d 6520 2b20 225f 4849 5354  sh_name + "_HIST
+00036af0: 2069 7320 6e75 6c6c 222c 2073 6174 5f6e   is null", sat_n
+00036b00: 756d 5f62 7261 6e63 682c 2073 656c 662e  um_branch, self.
+00036b10: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00036b20: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00036b30: 7475 616c 2e61 6464 5f65 6e74 7279 5f66  tual.add_entry_f
+00036b40: 696c 7465 7273 285b 6e65 775f 6669 6c74  ilters([new_filt
+00036b50: 6572 5d29 0d0a 0d0a 2020 2020 2020 2020  er])....        
+00036b60: 7365 6c66 2e6c 6f67 2e6c 6f67 2873 656c  self.log.log(sel
+00036b70: 662e 656e 6769 6e65 5f6e 616d 652c 2022  f.engine_name, "
+00036b80: 4669 6e69 7368 6564 2074 6f20 7072 6f63  Finished to proc
+00036b90: 6573 7320 4d65 7461 6461 7461 205b 2052  ess Metadata [ R
+00036ba0: 6563 6f72 6420 5472 6163 6b69 6e67 2053  ecord Tracking S
+00036bb0: 6174 656c 6c69 7465 205d 2069 6e66 6f72  atellite ] infor
+00036bc0: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
+00036bd0: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
+00036be0: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
+00036bf0: 6476 5f6c 696e 6b5f 6372 6561 7469 6f6e  dv_link_creation
+00036c00: 5f6c 696e 6b28 7365 6c66 2c20 6c69 6e6b  _link(self, link
+00036c10: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00036c20: 2e6c 6f67 2e6c 6f67 2873 656c 662e 656e  .log.log(self.en
+00036c30: 6769 6e65 5f6e 616d 652c 2022 5374 6172  gine_name, "Star
+00036c40: 7469 6e67 2074 6f20 7072 6f63 6573 7320  ting to process 
+00036c50: 4d65 7461 6461 7461 205b 204c 696e 6b20  Metadata [ Link 
+00036c60: 6465 6669 6e69 7469 6f6e 205d 2069 6e66  definition ] inf
+00036c70: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
+00036c80: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
+00036c90: 2020 2020 2020 2020 2354 4f44 4f3a 2063          #TODO: c
+00036ca0: 7265 6163 696f 6e20 6465 6c20 6c69 6e6b  reacion del link
+00036cb0: 202d 3e20 7465 6e65 7220 656e 2063 7565   -> tener en cue
+00036cc0: 6e74 6120 7369 2065 7320 4344 4320 6f20  nta si es CDC o 
+00036cd0: 6e6f 0d0a 2020 2020 2020 2020 2323 2323  no..        ####
+00036ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00036cf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00036d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00036d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00036d20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00036d30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00036d40: 2323 2323 2323 2323 0d0a 2020 2020 2020  ########..      
+00036d50: 2020 7072 6566 6978 5f65 7420 3d20 2745    prefix_et = 'E
+00036d60: 545f 270d 0a20 2020 2020 2020 2068 6173  T_'..        has
+00036d70: 5f72 7320 3d20 4661 6c73 650d 0a20 2020  _rs = False..   
+00036d80: 2020 2020 2068 6173 5f74 6e20 3d20 4661       has_tn = Fa
+00036d90: 6c73 650d 0a20 2020 2020 2020 2068 6173  lse..        has
+00036da0: 5f61 6420 3d20 4661 6c73 650d 0a20 2020  _ad = False..   
+00036db0: 2020 2020 2068 6173 5f73 6571 203d 2046       has_seq = F
+00036dc0: 616c 7365 0d0a 2020 2020 2020 2020 7265  alse..        re
+00036dd0: 636f 7264 5f73 6f75 7263 6520 3d20 4e6f  cord_source = No
+00036de0: 6e65 0d0a 2020 2020 2020 2020 7465 6e61  ne..        tena
+00036df0: 6e74 5f73 6f75 7263 6520 3d20 4e6f 6e65  nt_source = None
+00036e00: 0d0a 2020 2020 2020 2020 7365 715f 736f  ..        seq_so
+00036e10: 7572 6365 203d 204e 6f6e 650d 0a20 2020  urce = None..   
+00036e20: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00036e30: 6520 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  e = None....    
+00036e40: 2020 2020 6861 7368 5f6e 616d 6520 3d20      hash_name = 
+00036e50: 2748 4153 485f 2720 2b20 6c69 6e6b 2e65  'HASH_' + link.e
+00036e60: 6e74 6974 795f 6e61 6d65 0d0a 2020 2020  ntity_name..    
+00036e70: 2020 2020 6476 5f70 726f 7065 7274 7920      dv_property 
+00036e80: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00036e90: 6163 7475 616c 2e67 6574 5f64 765f 7072  actual.get_dv_pr
+00036ea0: 6f70 6572 7469 6573 5f66 726f 6d5f 636f  operties_from_co
+00036eb0: 645f 656e 7469 7479 5f61 6e64 5f6e 756d  d_entity_and_num
+00036ec0: 5f63 6f6e 6e65 6374 696f 6e28 6c69 6e6b  _connection(link
+00036ed0: 2e63 6f64 5f65 6e74 6974 792c 2030 290d  .cod_entity, 0).
+00036ee0: 0a20 2020 2020 2020 2069 6620 6476 5f70  .        if dv_p
+00036ef0: 726f 7065 7274 7920 6973 206e 6f74 204e  roperty is not N
+00036f00: 6f6e 653a 2068 6173 685f 6e61 6d65 203d  one: hash_name =
+00036f10: 2064 765f 7072 6f70 6572 7479 2e68 6173   dv_property.has
+00036f20: 685f 6e61 6d65 0d0a 0d0a 2020 2020 2020  h_name....      
+00036f30: 2020 2320 4372 6561 7469 6f6e 206f 6620    # Creation of 
+00036f40: 4c49 4e4b 2045 4e54 4954 590d 0a20 2020  LINK ENTITY..   
+00036f50: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+00036f60: 6974 696f 6e20 3d20 310d 0a20 2020 2020  ition = 1..     
+00036f70: 2020 206c 696e 6b5f 7374 675f 746d 705f     link_stg_tmp_
+00036f80: 6e61 6d65 203d 2027 5354 475f 544d 505f  name = 'STG_TMP_
+00036f90: 2720 2b20 6c69 6e6b 2e65 6e74 6974 795f  ' + link.entity_
+00036fa0: 6e61 6d65 0d0a 2020 2020 2020 2020 6c69  name..        li
+00036fb0: 6e6b 5f73 7467 5f6e 616d 6520 3d20 2753  nk_stg_name = 'S
+00036fc0: 5447 5f27 202b 206c 696e 6b2e 656e 7469  TG_' + link.enti
+00036fd0: 7479 5f6e 616d 650d 0a20 2020 2020 2020  ty_name..       
+00036fe0: 206c 696e 6b5f 7374 675f 6c61 7374 5f69   link_stg_last_i
+00036ff0: 6d61 6765 5f6e 616d 6520 3d20 2753 5447  mage_name = 'STG
+00037000: 5f27 202b 206c 696e 6b2e 656e 7469 7479  _' + link.entity
+00037010: 5f6e 616d 6520 2b20 225f 4c41 5354 5f49  _name + "_LAST_I
+00037020: 4d41 4745 220d 0a20 2020 2020 2020 206c  MAGE"..        l
+00037030: 696e 6b5f 6e61 6d65 203d 206c 696e 6b2e  ink_name = link.
+00037040: 656e 7469 7479 5f6e 616d 650d 0a20 2020  entity_name..   
+00037050: 2020 2020 206e 6577 5f65 6e74 6974 795f       new_entity_
+00037060: 7374 675f 746d 7020 3d20 5b70 7265 6669  stg_tmp = [prefi
+00037070: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
+00037080: 746d 705f 6e61 6d65 2c20 6c69 6e6b 5f73  tmp_name, link_s
+00037090: 7467 5f74 6d70 5f6e 616d 652c 2045 4e54  tg_tmp_name, ENT
+000370a0: 4954 595f 5749 5448 2c20 6c69 6e6b 2e63  ITY_WITH, link.c
+000370b0: 6f64 5f70 6174 682c 2027 272c 2073 656c  od_path, '', sel
+000370c0: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+000370d0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+000370e0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+000370f0: 5f65 6e74 6974 7928 5b6e 6577 5f65 6e74  _entity([new_ent
+00037100: 6974 795f 7374 675f 746d 705d 290d 0a20  ity_stg_tmp]).. 
+00037110: 2020 2020 2020 206e 6577 5f65 6e74 6974         new_entit
+00037120: 795f 7374 6720 3d20 5b70 7265 6669 785f  y_stg = [prefix_
+00037130: 6574 202b 206c 696e 6b5f 7374 675f 6e61  et + link_stg_na
+00037140: 6d65 2c20 6c69 6e6b 5f73 7467 5f6e 616d  me, link_stg_nam
+00037150: 652c 2045 4e54 4954 595f 5749 5448 2c20  e, ENTITY_WITH, 
+00037160: 6c69 6e6b 2e63 6f64 5f70 6174 682c 2027  link.cod_path, '
+00037170: 272c 2073 656c 662e 6f77 6e65 725d 0d0a  ', self.owner]..
+00037180: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00037190: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+000371a0: 5f65 6e74 7279 5f65 6e74 6974 7928 5b6e  _entry_entity([n
+000371b0: 6577 5f65 6e74 6974 795f 7374 675d 290d  ew_entity_stg]).
+000371c0: 0a20 2020 2020 2020 206e 6577 5f65 6e74  .        new_ent
+000371d0: 6974 795f 7374 6720 3d20 5b70 7265 6669  ity_stg = [prefi
+000371e0: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
+000371f0: 6c61 7374 5f69 6d61 6765 5f6e 616d 652c  last_image_name,
+00037200: 206c 696e 6b5f 7374 675f 6c61 7374 5f69   link_stg_last_i
+00037210: 6d61 6765 5f6e 616d 652c 2045 4e54 4954  mage_name, ENTIT
+00037220: 595f 5749 5448 2c20 6c69 6e6b 2e63 6f64  Y_WITH, link.cod
+00037230: 5f70 6174 682c 2027 272c 2073 656c 662e  _path, '', self.
+00037240: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00037250: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00037260: 7475 616c 2e61 6464 5f65 6e74 7279 5f65  tual.add_entry_e
+00037270: 6e74 6974 7928 5b6e 6577 5f65 6e74 6974  ntity([new_entit
+00037280: 795f 7374 675d 290d 0a20 2020 2020 2020  y_stg])..       
+00037290: 206e 6577 5f65 6e74 6974 795f 6875 6220   new_entity_hub 
+000372a0: 3d20 5b70 7265 6669 785f 6574 202b 206c  = [prefix_et + l
+000372b0: 696e 6b5f 6e61 6d65 2c20 6c69 6e6b 5f6e  ink_name, link_n
+000372c0: 616d 652c 2045 4e54 4954 595f 5442 2c20  ame, ENTITY_TB, 
+000372d0: 6c69 6e6b 2e63 6f64 5f70 6174 682c 2022  link.cod_path, "
+000372e0: 494e 5345 5254 222c 2073 656c 662e 6f77  INSERT", self.ow
+000372f0: 6e65 725d 0d0a 2020 2020 2020 2020 7365  ner]..        se
+00037300: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00037310: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
+00037320: 6974 7928 5b6e 6577 5f65 6e74 6974 795f  ity([new_entity_
+00037330: 6875 625d 290d 0a0d 0a20 2020 2020 2020  hub])....       
+00037340: 2023 2049 6e63 6c75 6465 2045 4e54 5259   # Include ENTRY
+00037350: 2066 726f 6d20 4554 5f53 5447 5f54 4d50   from ET_STG_TMP
+00037360: 5f5b 4c69 6e6b 5d0d 0a20 2020 2020 2020  _[Link]..       
+00037370: 2065 6e74 7279 5f64 765f 6d61 7070 696e   entry_dv_mappin
+00037380: 675f 626b 203d 205b 5d0d 0a20 2020 2020  g_bk = []..     
+00037390: 2020 206e 756d 5f62 7261 6e63 6865 7320     num_branches 
+000373a0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+000373b0: 6163 7475 616c 2e67 6574 5f6e 756d 5f62  actual.get_num_b
+000373c0: 7261 6e63 6865 735f 6f6e 5f65 6e74 7279  ranches_on_entry
+000373d0: 5f64 765f 6672 6f6d 5f63 6f64 5f65 6e74  _dv_from_cod_ent
+000373e0: 6974 795f 6e61 6d65 286c 696e 6b2e 636f  ity_name(link.co
+000373f0: 645f 656e 7469 7479 290d 0a20 2020 2020  d_entity)..     
+00037400: 2020 206e 756d 5f63 6f6e 6e65 6374 696f     num_connectio
+00037410: 6e73 203d 2073 656c 662e 6d65 7461 6461  ns = self.metada
+00037420: 7461 5f61 6374 7561 6c2e 6765 745f 6e75  ta_actual.get_nu
+00037430: 6d5f 636f 6e6e 6563 7469 6f6e 735f 6f6e  m_connections_on
+00037440: 5f65 6e74 7279 5f64 765f 6672 6f6d 5f63  _entry_dv_from_c
+00037450: 6f64 5f65 6e74 6974 795f 6e61 6d65 286c  od_entity_name(l
+00037460: 696e 6b2e 636f 645f 656e 7469 7479 290d  ink.cod_entity).
+00037470: 0a0d 0a20 2020 2020 2020 2066 6f72 206e  ...        for n
+00037480: 756d 5f62 7261 6e63 6820 696e 2072 616e  um_branch in ran
+00037490: 6765 2831 2c20 6e75 6d5f 6272 616e 6368  ge(1, num_branch
+000374a0: 6573 202b 2031 293a 0d0a 2020 2020 2020  es + 1):..      
+000374b0: 2020 2020 2020 7465 6e61 6e74 5f73 6f75        tenant_sou
+000374c0: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
+000374d0: 6174 615f 6163 7475 616c 2e67 6574 5f74  ata_actual.get_t
+000374e0: 656e 616e 745f 6f6e 5f64 765f 6672 6f6d  enant_on_dv_from
+000374f0: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
+00037500: 6574 5f61 6e64 5f6e 756d 5f62 7261 6e63  et_and_num_branc
+00037510: 6828 6c69 6e6b 2e63 6f64 5f65 6e74 6974  h(link.cod_entit
+00037520: 792c 206e 756d 5f62 7261 6e63 6829 0d0a  y, num_branch)..
+00037530: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00037540: 656e 2874 656e 616e 745f 736f 7572 6365  en(tenant_source
+00037550: 2920 213d 2030 3a0d 0a20 2020 2020 2020  ) != 0:..       
+00037560: 2020 2020 2020 2020 2068 6173 5f74 6e20           has_tn 
+00037570: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00037580: 2020 2020 2020 2020 2320 4765 7420 6469          # Get di
+00037590: 7374 696e 6374 2066 726f 6d20 5445 4e41  stinct from TENA
+000375a0: 4e54 530d 0a20 2020 2020 2020 2020 2020  NTS..           
+000375b0: 2020 2020 2066 696e 616c 5f74 656e 616e       final_tenan
+000375c0: 745f 6c69 7374 203d 205b 5d0d 0a20 2020  t_list = []..   
+000375d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000375e0: 2074 6e20 696e 2074 656e 616e 745f 736f   tn in tenant_so
+000375f0: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
+00037600: 2020 2020 2020 2020 2020 2069 6620 746e             if tn
+00037610: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00037620: 6765 7420 6e6f 7420 696e 205b 782e 636f  get not in [x.co
+00037630: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+00037640: 2066 6f72 2078 2069 6e20 6669 6e61 6c5f   for x in final_
+00037650: 7465 6e61 6e74 5f6c 6973 745d 3a20 6669  tenant_list]: fi
+00037660: 6e61 6c5f 7465 6e61 6e74 5f6c 6973 742e  nal_tenant_list.
+00037670: 6170 7065 6e64 2874 6e29 0d0a 2020 2020  append(tn)..    
+00037680: 2020 2020 2020 2020 2020 2020 7465 6e61              tena
+00037690: 6e74 5f73 6f75 7263 6520 3d20 6669 6e61  nt_source = fina
+000376a0: 6c5f 7465 6e61 6e74 5f6c 6973 740d 0a20  l_tenant_list.. 
+000376b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000376c0: 656e 616e 745f 736f 7572 6365 2e73 6f72  enant_source.sor
+000376d0: 7428 6b65 793d 6c61 6d62 6461 2078 3a20  t(key=lambda x: 
+000376e0: 782e 6f72 6469 6e61 6c5f 706f 7369 7469  x.ordinal_positi
+000376f0: 6f6e 290d 0a0d 0a20 2020 2020 2020 2020  on)....         
+00037700: 2020 2073 6571 5f73 6f75 7263 6520 3d20     seq_source = 
+00037710: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00037720: 7475 616c 2e67 6574 5f73 6571 5f6f 6e5f  tual.get_seq_on_
+00037730: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
+00037740: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
+00037750: 6d5f 6272 616e 6368 286c 696e 6b2e 636f  m_branch(link.co
+00037760: 645f 656e 7469 7479 2c20 6e75 6d5f 6272  d_entity, num_br
+00037770: 616e 6368 290d 0a20 2020 2020 2020 2020  anch)..         
+00037780: 2020 2069 6620 6c65 6e28 7365 715f 736f     if len(seq_so
+00037790: 7572 6365 2920 213d 2030 3a0d 0a20 2020  urce) != 0:..   
+000377a0: 2020 2020 2020 2020 2020 2020 2068 6173               has
+000377b0: 5f73 6571 203d 2054 7275 650d 0a20 2020  _seq = True..   
+000377c0: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+000377d0: 5f73 6f75 7263 652e 736f 7274 286b 6579  _source.sort(key
+000377e0: 3d6c 616d 6264 6120 783a 2078 2e6f 7264  =lambda x: x.ord
+000377f0: 696e 616c 5f70 6f73 6974 696f 6e29 0d0a  inal_position)..
+00037800: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00037810: 636f 7264 5f73 6f75 7263 6520 3d20 7365  cord_source = se
+00037820: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00037830: 616c 2e67 6574 5f72 6563 6f72 645f 736f  al.get_record_so
+00037840: 7572 6365 5f6f 6e5f 6476 5f66 726f 6d5f  urce_on_dv_from_
+00037850: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+00037860: 745f 616e 645f 6e75 6d5f 6272 616e 6368  t_and_num_branch
+00037870: 286c 696e 6b2e 636f 645f 656e 7469 7479  (link.cod_entity
+00037880: 2c20 6e75 6d5f 6272 616e 6368 290d 0a20  , num_branch).. 
+00037890: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+000378a0: 636f 7264 5f73 6f75 7263 6520 6973 206e  cord_source is n
+000378b0: 6f74 204e 6f6e 653a 2068 6173 5f72 7320  ot None: has_rs 
+000378c0: 3d20 5472 7565 0d0a 0d0a 2020 2020 2020  = True....      
+000378d0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+000378e0: 7465 203d 2073 656c 662e 6d65 7461 6461  te = self.metada
+000378f0: 7461 5f61 6374 7561 6c2e 6765 745f 6170  ta_actual.get_ap
+00037900: 706c 6965 645f 6461 7465 5f6f 6e5f 6476  plied_date_on_dv
+00037910: 5f66 726f 6d5f 636f 645f 656e 7469 7479  _from_cod_entity
+00037920: 5f74 6172 6765 7428 6c69 6e6b 2e63 6f64  _target(link.cod
+00037930: 5f65 6e74 6974 792c 206e 756d 5f62 7261  _entity, num_bra
+00037940: 6e63 6829 0d0a 2020 2020 2020 2020 2020  nch)..          
+00037950: 2020 6966 2061 7070 6c69 6564 5f64 6174    if applied_dat
+00037960: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
+00037970: 6173 5f61 6420 3d20 5472 7565 0d0a 0d0a  as_ad = True....
+00037980: 2020 2020 2020 2020 2020 2020 656e 7472              entr
+00037990: 795f 6476 5f6d 6170 7069 6e67 5f62 6b20  y_dv_mapping_bk 
+000379a0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+000379b0: 6163 7475 616c 2e67 6574 5f61 6c6c 5f62  actual.get_all_b
+000379c0: 6b5f 6672 6f6d 5f65 6e74 7279 5f64 765f  k_from_entry_dv_
+000379d0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+000379e0: 745f 616e 645f 6e75 6d5f 6272 616e 6368  t_and_num_branch
+000379f0: 286c 696e 6b2e 636f 645f 656e 7469 7479  (link.cod_entity
+00037a00: 2c20 6e75 6d5f 6272 616e 6368 290d 0a20  , num_branch).. 
+00037a10: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+00037a20: 5f64 765f 6d61 7070 696e 675f 626b 2e73  _dv_mapping_bk.s
+00037a30: 6f72 7428 6b65 793d 6c61 6d62 6461 2078  ort(key=lambda x
+00037a40: 3a20 782e 6f72 6469 6e61 6c5f 706f 7369  : x.ordinal_posi
+00037a50: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
+00037a60: 2020 2063 6f64 5f65 6e74 6974 795f 736f     cod_entity_so
+00037a70: 7572 6365 203d 2065 6e74 7279 5f64 765f  urce = entry_dv_
+00037a80: 6d61 7070 696e 675f 626b 5b30 5d2e 636f  mapping_bk[0].co
+00037a90: 645f 656e 7469 7479 5f73 6f75 7263 650d  d_entity_source.
+00037aa0: 0a0d 0a20 2020 2020 2020 2020 2020 206d  ...            m
+00037ab0: 6435 5f66 756e 6374 696f 6e20 3d20 7365  d5_function = se
+00037ac0: 6c66 2e67 6574 5f68 6173 685f 6b65 795f  lf.get_hash_key_
+00037ad0: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+00037ae0: 7461 7267 6574 5f61 6e64 5f6e 756d 5f62  target_and_num_b
+00037af0: 7261 6e63 6828 6c69 6e6b 2e63 6f64 5f65  ranch(link.cod_e
+00037b00: 6e74 6974 792c 206e 756d 5f62 7261 6e63  ntity, num_branc
+00037b10: 6829 0d0a 0d0a 2020 2020 2020 2020 2020  h)....          
+00037b20: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+00037b30: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+00037b40: 6374 696f 6e2e 6765 745f 6861 7368 5f66  ction.get_hash_f
+00037b50: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
+00037b60: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+00037b70: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+00037b80: 205b 636f 645f 656e 7469 7479 5f73 6f75   [cod_entity_sou
+00037b90: 7263 652c 206d 6435 5f66 756e 6374 696f  rce, md5_functio
+00037ba0: 6e2c 2070 7265 6669 785f 6574 202b 206c  n, prefix_et + l
+00037bb0: 696e 6b5f 7374 675f 746d 705f 6e61 6d65  ink_stg_tmp_name
+00037bc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00037bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037be0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00037bf0: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-00037c00: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-00037c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037c30: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-00037c40: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-00037c50: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-00037c60: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
-00037c70: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-00037c80: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-00037c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ca0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-00037cb0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00037cc0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-00037cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037cf0: 2020 206e 756d 5f62 7261 6e63 682c 204b     num_branch, K
-00037d00: 4559 5f54 5950 455f 5245 434f 5244 5f53  EY_TYPE_RECORD_S
-00037d10: 4f55 5243 452c 2031 2c20 7365 6c66 2e6f  OURCE, 1, self.o
-00037d20: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00037d30: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00037d40: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00037d50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00037d60: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00037d70: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00037d80: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00037d90: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00037da0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00037db0: 2020 2020 6966 2068 6173 5f61 643a 0d0a      if has_ad:..
-00037dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037dd0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00037de0: 696e 6720 3d20 5b61 7070 6c69 6564 5f64  ing = [applied_d
-00037df0: 6174 652e 636f 645f 656e 7469 7479 5f73  ate.cod_entity_s
-00037e00: 6f75 7263 652c 2061 7070 6c69 6564 5f64  ource, applied_d
-00037e10: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-00037e20: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
-00037e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e50: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-00037e60: 5f73 7467 5f74 6d70 5f6e 616d 652c 0d0a  _stg_tmp_name,..
+00037be0: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+00037bf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00037c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037c10: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00037c20: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00037c30: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+00037c40: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+00037c50: 5d2c 2068 6173 685f 666f 725f 6d65 7461  ], hash_for_meta
+00037c60: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
+00037c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037c80: 2020 2020 2020 2020 2020 2020 206e 756d               num
+00037c90: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+00037ca0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+00037cb0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00037cc0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+00037cd0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+00037ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00037cf0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00037d00: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00037d10: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00037d20: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00037d30: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00037d40: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+00037d50: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+00037d60: 6374 696f 6e2e 6765 745f 7379 7364 6174  ction.get_sysdat
+00037d70: 655f 666f 725f 6d65 7461 6461 7461 2829  e_for_metadata()
+00037d80: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+00037d90: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00037da0: 6720 3d20 5b27 272c 2073 656c 662e 636f  g = ['', self.co
+00037db0: 6e6e 6563 7469 6f6e 2e67 6574 5f73 7973  nnection.get_sys
+00037dc0: 6461 7465 5f76 616c 7565 2829 2c20 7072  date_value(), pr
+00037dd0: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f73  efix_et + link_s
+00037de0: 7467 5f74 6d70 5f6e 616d 652c 2027 4441  tg_tmp_name, 'DA
+00037df0: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
+00037e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037e20: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00037e30: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
+00037e40: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
+00037e50: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
+00037e60: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
 00037e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e90: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-00037ea0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-00037eb0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00037ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ee0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
-00037ef0: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-00037f00: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00037f10: 6e2c 2061 7070 6c69 6564 5f64 6174 652e  n, applied_date.
-00037f20: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-00037f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037f50: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-00037f60: 6174 652e 636f 6c75 6d6e 5f70 7265 6369  ate.column_preci
-00037f70: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-00037f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037f90: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-00037fa0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-00037fb0: 5045 5f41 5050 4c49 4544 5f44 4154 452c  PE_APPLIED_DATE,
-00037fc0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00037fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037fe0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00037ff0: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-00038000: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00038010: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00038020: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00038030: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00038040: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00038050: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00038060: 2068 6173 5f74 6e3a 0d0a 2020 2020 2020   has_tn:..      
-00038070: 2020 2020 2020 2020 2020 666f 7220 746e            for tn
-00038080: 2069 6e20 7465 6e61 6e74 5f73 6f75 7263   in tenant_sourc
-00038090: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000380a0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-000380b0: 7365 745f 6d61 7070 696e 6720 3d20 5b74  set_mapping = [t
-000380c0: 6e2e 636f 645f 656e 7469 7479 5f73 6f75  n.cod_entity_sou
-000380d0: 7263 652c 2074 6e2e 636f 6c75 6d6e 5f6e  rce, tn.column_n
-000380e0: 616d 655f 736f 7572 6365 2c20 7072 6566  ame_source, pref
-000380f0: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
-00038100: 5f74 6d70 5f6e 616d 652c 0d0a 2020 2020  _tmp_name,..    
-00038110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037e80: 2020 2020 2020 2020 2073 7973 6461 7465           sysdate
+00037e90: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00037ea0: 2c20 6e75 6d5f 6272 616e 6368 2c20 4b45  , num_branch, KE
+00037eb0: 595f 5459 5045 5f4e 554c 4c2c 2031 2c20  Y_TYPE_NULL, 1, 
+00037ec0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+00037ed0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00037ee0: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+00037ef0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00037f00: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00037f10: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+00037f20: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+00037f30: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+00037f40: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
+00037f50: 2020 6966 2068 6173 5f72 733a 0d0a 2020    if has_rs:..  
+00037f60: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00037f70: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00037f80: 6720 3d20 5b72 6563 6f72 645f 736f 7572  g = [record_sour
+00037f90: 6365 2e63 6f64 5f65 6e74 6974 795f 736f  ce.cod_entity_so
+00037fa0: 7572 6365 2c20 7265 636f 7264 5f73 6f75  urce, record_sou
+00037fb0: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00037fc0: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
+00037fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037ff0: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
+00038000: 5f73 7467 5f74 6d70 5f6e 616d 652c 0d0a  _stg_tmp_name,..
+00038010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038030: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+00038040: 7572 6365 2e63 6f6c 756d 6e5f 6e61 6d65  urce.column_name
+00038050: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+00038060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038080: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+00038090: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+000380a0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+000380b0: 696f 6e2c 2072 6563 6f72 645f 736f 7572  ion, record_sour
+000380c0: 6365 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ce.column_length
+000380d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000380e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000380f0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00038100: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f70  _source.column_p
+00038110: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
 00038120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038130: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-00038140: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00038150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038170: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
-00038180: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-00038190: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-000381a0: 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c 656e  n, tn.column_len
-000381b0: 6774 682c 2074 6e2e 636f 6c75 6d6e 5f70  gth, tn.column_p
-000381c0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-000381d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000381e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000381f0: 2020 2020 2020 6e75 6d5f 6272 616e 6368        num_branch
-00038200: 2c20 4b45 595f 5459 5045 5f54 454e 414e  , KEY_TYPE_TENAN
-00038210: 542c 2031 2c20 7365 6c66 2e6f 776e 6572  T, 1, self.owner
-00038220: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00038230: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00038240: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-00038250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038260: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00038270: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00038280: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00038290: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-000382a0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-000382b0: 2020 2020 2020 2020 6966 2068 6173 5f73          if has_s
-000382c0: 6571 3a0d 0a20 2020 2020 2020 2020 2020  eq:..           
-000382d0: 2020 2020 2066 6f72 2073 6571 2069 6e20       for seq in 
-000382e0: 7365 715f 736f 7572 6365 3a0d 0a20 2020  seq_source:..   
-000382f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038300: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00038310: 7069 6e67 203d 205b 7365 712e 636f 645f  ping = [seq.cod_
-00038320: 656e 7469 7479 5f73 6f75 7263 652c 2073  entity_source, s
-00038330: 6571 2e63 6f6c 756d 6e5f 6e61 6d65 5f73  eq.column_name_s
-00038340: 6f75 7263 652c 2070 7265 6669 785f 6574  ource, prefix_et
-00038350: 202b 206c 696e 6b5f 7374 675f 746d 705f   + link_stg_tmp_
-00038360: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00038370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038140: 2020 6e75 6d5f 6272 616e 6368 2c20 4b45    num_branch, KE
+00038150: 595f 5459 5045 5f52 4543 4f52 445f 534f  Y_TYPE_RECORD_SO
+00038160: 5552 4345 2c20 312c 2073 656c 662e 6f77  URCE, 1, self.ow
+00038170: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+00038180: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00038190: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+000381a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000381b0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+000381c0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+000381d0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+000381e0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+000381f0: 675d 290d 0a0d 0a20 2020 2020 2020 2020  g])....         
+00038200: 2020 2069 6620 6861 735f 6164 3a0d 0a20     if has_ad:.. 
+00038210: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00038220: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00038230: 6e67 203d 205b 6170 706c 6965 645f 6461  ng = [applied_da
+00038240: 7465 2e63 6f64 5f65 6e74 6974 795f 736f  te.cod_entity_so
+00038250: 7572 6365 2c20 6170 706c 6965 645f 6461  urce, applied_da
+00038260: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f73  te.column_name_s
+00038270: 6f75 7263 652c 0d0a 2020 2020 2020 2020  ource,..        
+00038280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038290: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000382a0: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+000382b0: 7374 675f 746d 705f 6e61 6d65 2c0d 0a20  stg_tmp_name,.. 
+000382c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000382d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000382e0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+000382f0: 7465 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  te.column_name_t
+00038300: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00038310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038320: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00038330: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
+00038340: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+00038350: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00038360: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
+00038370: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
 00038380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038390: 2020 7365 712e 636f 6c75 6d6e 5f6e 616d    seq.column_nam
-000383a0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-000383b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000383c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000383d0: 2020 2020 2020 7365 712e 636f 6c75 6d6e        seq.column
-000383e0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-000383f0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-00038400: 7365 712e 636f 6c75 6d6e 5f6c 656e 6774  seq.column_lengt
-00038410: 682c 2073 6571 2e63 6f6c 756d 6e5f 7072  h, seq.column_pr
-00038420: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-00038430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038450: 2020 2020 206e 756d 5f62 7261 6e63 682c       num_branch,
-00038460: 204b 4559 5f54 5950 455f 5345 5155 454e   KEY_TYPE_SEQUEN
-00038470: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
-00038480: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-00038490: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-000384a0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-000384b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000384c0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-000384d0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-000384e0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-000384f0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00038500: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00038510: 2020 2020 2020 2020 2066 6f72 206e 756d           for num
-00038520: 5f63 6f6e 2069 6e20 7261 6e67 6528 312c  _con in range(1,
-00038530: 206e 756d 5f63 6f6e 6e65 6374 696f 6e73   num_connections
-00038540: 2b31 293a 0d0a 2020 2020 2020 2020 2020  +1):..          
-00038550: 2020 2020 2020 6861 7368 5f6e 616d 655f        hash_name_
-00038560: 6875 6220 3d20 2748 4153 485f 2720 2b20  hub = 'HASH_' + 
-00038570: 7374 7228 6e75 6d5f 636f 6e29 0d0a 2020  str(num_con)..  
-00038580: 2020 2020 2020 2020 2020 2020 2020 6476                dv
-00038590: 5f70 726f 7065 7274 7920 3d20 7365 6c66  _property = self
-000385a0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000385b0: 2e67 6574 5f64 765f 7072 6f70 6572 7469  .get_dv_properti
-000385c0: 6573 5f66 726f 6d5f 636f 645f 656e 7469  es_from_cod_enti
-000385d0: 7479 5f61 6e64 5f6e 756d 5f63 6f6e 6e65  ty_and_num_conne
-000385e0: 6374 696f 6e28 6c69 6e6b 2e63 6f64 5f65  ction(link.cod_e
-000385f0: 6e74 6974 792c 206e 756d 5f63 6f6e 290d  ntity, num_con).
-00038600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038610: 2069 6620 6476 5f70 726f 7065 7274 7920   if dv_property 
-00038620: 6973 206e 6f74 204e 6f6e 653a 2068 6173  is not None: has
-00038630: 685f 6e61 6d65 5f68 7562 203d 2064 765f  h_name_hub = dv_
-00038640: 7072 6f70 6572 7479 2e68 6173 685f 6e61  property.hash_na
-00038650: 6d65 0d0a 0d0a 2020 2020 2020 2020 2020  me....          
-00038660: 2020 2020 2020 6d64 355f 6675 6e63 7469        md5_functi
-00038670: 6f6e 5f66 6f72 5f63 6f6e 203d 2073 656c  on_for_con = sel
-00038680: 662e 6765 745f 6861 7368 5f6b 6579 5f66  f.get_hash_key_f
-00038690: 726f 6d5f 636f 645f 656e 7469 7479 5f74  rom_cod_entity_t
-000386a0: 6172 6765 745f 616e 645f 6e75 6d5f 6272  arget_and_num_br
-000386b0: 616e 6368 5f61 6e64 5f6e 756d 5f63 6f6e  anch_and_num_con
-000386c0: 6e65 6374 696f 6e28 6c69 6e6b 2e63 6f64  nection(link.cod
-000386d0: 5f65 6e74 6974 792c 206e 756d 5f62 7261  _entity, num_bra
-000386e0: 6e63 682c 206e 756d 5f63 6f6e 290d 0a20  nch, num_con).. 
-000386f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00038700: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00038710: 6e67 203d 205b 636f 645f 656e 7469 7479  ng = [cod_entity
-00038720: 5f73 6f75 7263 652c 206d 6435 5f66 756e  _source, md5_fun
-00038730: 6374 696f 6e5f 666f 725f 636f 6e2c 2070  ction_for_con, p
-00038740: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-00038750: 7374 675f 746d 705f 6e61 6d65 2c0d 0a20  stg_tmp_name,.. 
-00038760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038780: 2020 2020 2020 6861 7368 5f6e 616d 655f        hash_name_
-00038790: 6875 622c 0d0a 2020 2020 2020 2020 2020  hub,..          
-000387a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000387b0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-000387c0: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-000387d0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-000387e0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-000387f0: 7461 6461 7461 5b31 5d2c 0d0a 2020 2020  tadata[1],..    
+00038390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000383a0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
+000383b0: 7465 2e63 6f6c 756d 6e5f 7072 6563 6973  te.column_precis
+000383c0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+000383d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000383e0: 2020 2020 2020 2020 2020 2020 206e 756d               num
+000383f0: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+00038400: 455f 4150 504c 4945 445f 4441 5445 2c20  E_APPLIED_DATE, 
+00038410: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00038420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038430: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00038440: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+00038450: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00038460: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00038470: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00038480: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00038490: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
+000384a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000384b0: 6861 735f 746e 3a0d 0a20 2020 2020 2020  has_tn:..       
+000384c0: 2020 2020 2020 2020 2066 6f72 2074 6e20           for tn 
+000384d0: 696e 2074 656e 616e 745f 736f 7572 6365  in tenant_source
+000384e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000384f0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+00038500: 6574 5f6d 6170 7069 6e67 203d 205b 746e  et_mapping = [tn
+00038510: 2e63 6f64 5f65 6e74 6974 795f 736f 7572  .cod_entity_sour
+00038520: 6365 2c20 746e 2e63 6f6c 756d 6e5f 6e61  ce, tn.column_na
+00038530: 6d65 5f73 6f75 7263 652c 2070 7265 6669  me_source, prefi
+00038540: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
+00038550: 746d 705f 6e61 6d65 2c0d 0a20 2020 2020  tmp_name,..     
+00038560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038580: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+00038590: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+000385a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000385b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000385c0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+000385d0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+000385e0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+000385f0: 2c20 746e 2e63 6f6c 756d 6e5f 6c65 6e67  , tn.column_leng
+00038600: 7468 2c20 746e 2e63 6f6c 756d 6e5f 7072  th, tn.column_pr
+00038610: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+00038620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038640: 2020 2020 206e 756d 5f62 7261 6e63 682c       num_branch,
+00038650: 204b 4559 5f54 5950 455f 5445 4e41 4e54   KEY_TYPE_TENANT
+00038660: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+00038670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00038680: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00038690: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+000386a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000386b0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+000386c0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+000386d0: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+000386e0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+000386f0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00038700: 2020 2020 2020 2069 6620 6861 735f 7365         if has_se
+00038710: 713a 0d0a 2020 2020 2020 2020 2020 2020  q:..            
+00038720: 2020 2020 666f 7220 7365 7120 696e 2073      for seq in s
+00038730: 6571 5f73 6f75 7263 653a 0d0a 2020 2020  eq_source:..    
+00038740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038750: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00038760: 696e 6720 3d20 5b73 6571 2e63 6f64 5f65  ing = [seq.cod_e
+00038770: 6e74 6974 795f 736f 7572 6365 2c20 7365  ntity_source, se
+00038780: 712e 636f 6c75 6d6e 5f6e 616d 655f 736f  q.column_name_so
+00038790: 7572 6365 2c20 7072 6566 6978 5f65 7420  urce, prefix_et 
+000387a0: 2b20 6c69 6e6b 5f73 7467 5f74 6d70 5f6e  + link_stg_tmp_n
+000387b0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+000387c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000387d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000387e0: 2073 6571 2e63 6f6c 756d 6e5f 6e61 6d65   seq.column_name
+000387f0: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
 00038800: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00038810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038820: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-00038830: 6461 7461 5b32 5d2c 0d0a 2020 2020 2020  data[2],..      
-00038840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038860: 206e 756d 5f62 7261 6e63 682c 204b 4559   num_branch, KEY
-00038870: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00038880: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+00038820: 2020 2020 2073 6571 2e63 6f6c 756d 6e5f       seq.column_
+00038830: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+00038840: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
+00038850: 6571 2e63 6f6c 756d 6e5f 6c65 6e67 7468  eq.column_length
+00038860: 2c20 7365 712e 636f 6c75 6d6e 5f70 7265  , seq.column_pre
+00038870: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00038880: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00038890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000388b0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000388c0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000388d0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000388e0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000388f0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00038900: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00038910: 0a0d 0a20 2020 2020 2020 2023 2052 656c  ...        # Rel
-00038920: 6174 696f 6e73 6869 7020 6f6e 2053 5447  ationship on STG
-00038930: 5f54 4d50 2061 6e64 204c 494e 4b0d 0a20  _TMP and LINK.. 
-00038940: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00038950: 6f73 6974 696f 6e20 3d20 310d 0a20 2020  osition = 1..   
-00038960: 2020 2020 206e 6577 5f72 656c 6174 696f       new_relatio
-00038970: 6e73 6869 7020 3d20 5b70 7265 6669 785f  nship = [prefix_
-00038980: 6574 202b 206c 696e 6b5f 7374 675f 746d  et + link_stg_tm
-00038990: 705f 6e61 6d65 2c20 6861 7368 5f6e 616d  p_name, hash_nam
-000389a0: 652c 2070 7265 6669 785f 6574 202b 206c  e, prefix_et + l
-000389b0: 696e 6b5f 6e61 6d65 2c0d 0a20 2020 2020  ink_name,..     
-000389c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000389d0: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-000389e0: 2c20 274d 4153 5445 5220 4a4f 494e 272c  , 'MASTER JOIN',
-000389f0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00038a00: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00038a10: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-00038a20: 6e74 7279 5f64 6174 6173 6574 5f72 656c  ntry_dataset_rel
-00038a30: 6174 696f 6e73 6869 7028 5b6e 6577 5f72  ationship([new_r
-00038a40: 656c 6174 696f 6e73 6869 705d 290d 0a0d  elationship])...
-00038a50: 0a0d 0a20 2020 2020 2020 2023 2053 5447  ...        # STG
-00038a60: 0d0a 2020 2020 2020 2020 6861 7368 5f66  ..        hash_f
-00038a70: 6f72 5f6d 6574 6164 6174 6120 3d20 7365  or_metadata = se
-00038a80: 6c66 2e63 6f6e 6e65 6374 696f 6e2e 6765  lf.connection.ge
-00038a90: 745f 6861 7368 5f66 6f72 5f6d 6574 6164  t_hash_for_metad
-00038aa0: 6174 6128 290d 0a20 2020 2020 2020 206e  ata()..        n
-00038ab0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00038ac0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00038ad0: 2b20 6c69 6e6b 5f73 7467 5f74 6d70 5f6e  + link_stg_tmp_n
-00038ae0: 616d 652c 2068 6173 685f 6e61 6d65 2c20  ame, hash_name, 
-00038af0: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-00038b00: 5f73 7467 5f6e 616d 652c 0d0a 2020 2020  _stg_name,..    
-00038b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038b20: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00038b30: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00038b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038b50: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-00038b60: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00038b70: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-00038b80: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00038b90: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-00038ba0: 6164 6174 615b 325d 2c20 312c 0d0a 2020  adata[2], 1,..  
+000388a0: 2020 2020 6e75 6d5f 6272 616e 6368 2c20      num_branch, 
+000388b0: 4b45 595f 5459 5045 5f53 4551 5545 4e43  KEY_TYPE_SEQUENC
+000388c0: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
+000388d0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000388e0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+000388f0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+00038900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038910: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00038920: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00038930: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00038940: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00038950: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00038960: 2020 2020 2020 2020 666f 7220 6e75 6d5f          for num_
+00038970: 636f 6e20 696e 2072 616e 6765 2831 2c20  con in range(1, 
+00038980: 6e75 6d5f 636f 6e6e 6563 7469 6f6e 732b  num_connections+
+00038990: 3129 3a0d 0a20 2020 2020 2020 2020 2020  1):..           
+000389a0: 2020 2020 2068 6173 685f 6e61 6d65 5f68       hash_name_h
+000389b0: 7562 203d 2027 4841 5348 5f27 202b 2073  ub = 'HASH_' + s
+000389c0: 7472 286e 756d 5f63 6f6e 290d 0a20 2020  tr(num_con)..   
+000389d0: 2020 2020 2020 2020 2020 2020 2064 765f               dv_
+000389e0: 7072 6f70 6572 7479 203d 2073 656c 662e  property = self.
+000389f0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00038a00: 6765 745f 6476 5f70 726f 7065 7274 6965  get_dv_propertie
+00038a10: 735f 6672 6f6d 5f63 6f64 5f65 6e74 6974  s_from_cod_entit
+00038a20: 795f 616e 645f 6e75 6d5f 636f 6e6e 6563  y_and_num_connec
+00038a30: 7469 6f6e 286c 696e 6b2e 636f 645f 656e  tion(link.cod_en
+00038a40: 7469 7479 2c20 6e75 6d5f 636f 6e29 0d0a  tity, num_con)..
+00038a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038a60: 6966 2064 765f 7072 6f70 6572 7479 2069  if dv_property i
+00038a70: 7320 6e6f 7420 4e6f 6e65 3a20 6861 7368  s not None: hash
+00038a80: 5f6e 616d 655f 6875 6220 3d20 6476 5f70  _name_hub = dv_p
+00038a90: 726f 7065 7274 792e 6861 7368 5f6e 616d  roperty.hash_nam
+00038aa0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00038ab0: 2020 2020 206d 6435 5f66 756e 6374 696f       md5_functio
+00038ac0: 6e5f 666f 725f 636f 6e20 3d20 7365 6c66  n_for_con = self
+00038ad0: 2e67 6574 5f68 6173 685f 6b65 795f 6672  .get_hash_key_fr
+00038ae0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
+00038af0: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
+00038b00: 6e63 685f 616e 645f 6e75 6d5f 636f 6e6e  nch_and_num_conn
+00038b10: 6563 7469 6f6e 286c 696e 6b2e 636f 645f  ection(link.cod_
+00038b20: 656e 7469 7479 2c20 6e75 6d5f 6272 616e  entity, num_bran
+00038b30: 6368 2c20 6e75 6d5f 636f 6e29 0d0a 2020  ch, num_con)..  
+00038b40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00038b50: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00038b60: 6720 3d20 5b63 6f64 5f65 6e74 6974 795f  g = [cod_entity_
+00038b70: 736f 7572 6365 2c20 6d64 355f 6675 6e63  source, md5_func
+00038b80: 7469 6f6e 5f66 6f72 5f63 6f6e 2c20 7072  tion_for_con, pr
+00038b90: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f73  efix_et + link_s
+00038ba0: 7467 5f74 6d70 5f6e 616d 652c 0d0a 2020  tg_tmp_name,..  
 00038bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038bc0: 2020 2020 2020 2020 2020 2020 204b 4559               KEY
-00038bd0: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-00038be0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00038bf0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00038c00: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00038c10: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00038c20: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00038c30: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00038c40: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00038c50: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00038c60: 0a20 2020 2020 2020 206e 6577 5f64 6174  .        new_dat
-00038c70: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-00038c80: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-00038c90: 5f6e 616d 652c 2068 6173 685f 6e61 6d65  _name, hash_name
-00038ca0: 2c20 7072 6566 6978 5f65 7420 2b20 6c69  , prefix_et + li
-00038cb0: 6e6b 5f73 7467 5f6e 616d 652c 0d0a 2020  nk_stg_name,..  
-00038cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038cd0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00038ce0: 685f 6e61 6d65 202b 2022 5f4c 494e 4b22  h_name + "_LINK"
-00038cf0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00038d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038d10: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-00038d20: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00038d30: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-00038d40: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-00038d50: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-00038d60: 615b 325d 2c20 312c 0d0a 2020 2020 2020  a[2], 1,..      
-00038d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038d80: 2020 2020 2020 2020 204b 4559 5f54 5950           KEY_TYP
-00038d90: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-00038da0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00038db0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00038dc0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00038dd0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00038de0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00038df0: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-00038e00: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00038e10: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-00038e20: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-00038e30: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
-00038e40: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-00038e50: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-00038e60: 6461 7461 2829 0d0a 2020 2020 2020 2020  data()..        
-00038e70: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00038e80: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-00038e90: 202b 206c 696e 6b5f 7374 675f 746d 705f   + link_stg_tmp_
-00038ea0: 6e61 6d65 2c20 2744 4154 455f 4352 4541  name, 'DATE_CREA
-00038eb0: 5445 4427 2c20 7072 6566 6978 5f65 7420  TED', prefix_et 
-00038ec0: 2b20 6c69 6e6b 5f73 7467 5f6e 616d 652c  + link_stg_name,
-00038ed0: 2027 4441 5445 5f43 5245 4154 4544 272c   'DATE_CREATED',
-00038ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00038ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038f00: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00038f10: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-00038f20: 6c5f 706f 7369 7469 6f6e 2c20 7379 7364  l_position, sysd
-00038f30: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-00038f40: 5b31 5d2c 0d0a 2020 2020 2020 2020 2020  [1],..          
-00038f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038f60: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-00038f70: 5f6d 6574 6164 6174 615b 325d 2c20 312c  _metadata[2], 1,
-00038f80: 204b 4559 5f54 5950 455f 4e55 4c4c 2c20   KEY_TYPE_NULL, 
-00038f90: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00038fa0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00038fb0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00038fc0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00038fd0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00038fe0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00038ff0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-00039000: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-00039010: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
-00039020: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
-00039030: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00039040: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00039050: 7420 2b20 6c69 6e6b 5f73 7467 5f74 6d70  t + link_stg_tmp
-00039060: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-00039070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039080: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-00039090: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-000390a0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-000390b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000390c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000390d0: 2070 7265 6669 785f 6574 202b 206c 696e   prefix_et + lin
-000390e0: 6b5f 7374 675f 6e61 6d65 2c0d 0a20 2020  k_stg_name,..   
-000390f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039110: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-00039120: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-00039130: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00039140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039150: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00039160: 7263 652e 636f 6c75 6d6e 5f74 7970 655f  rce.column_type_
-00039170: 7461 7267 6574 2c20 6f72 6469 6e61 6c5f  target, ordinal_
-00039180: 706f 7369 7469 6f6e 2c20 7265 636f 7264  position, record
-00039190: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6c  _source.column_l
-000391a0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-000391b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000391c0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-000391d0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-000391e0: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
-000391f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039200: 2020 2020 2020 2020 2020 2020 2020 2031                 1
-00039210: 2c20 4b45 595f 5459 5045 5f52 4543 4f52  , KEY_TYPE_RECOR
-00039220: 445f 534f 5552 4345 2c20 312c 2073 656c  D_SOURCE, 1, sel
-00039230: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
-00039240: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00039250: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-00039260: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00039270: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00039280: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00039290: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-000392a0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-000392b0: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
-000392c0: 735f 6164 3a0d 0a20 2020 2020 2020 2020  s_ad:..         
-000392d0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-000392e0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
-000392f0: 5f65 7420 2b20 6c69 6e6b 5f73 7467 5f74  _et + link_stg_t
-00039300: 6d70 5f6e 616d 652c 0d0a 2020 2020 2020  mp_name,..      
-00039310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039320: 2020 2020 2020 2020 2020 2020 2061 7070               app
-00039330: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00039340: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00039350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039370: 2020 7072 6566 6978 5f65 7420 2b20 6c69    prefix_et + li
-00039380: 6e6b 5f73 7467 5f6e 616d 652c 0d0a 2020  nk_stg_name,..  
-00039390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038bd0: 2020 2020 2068 6173 685f 6e61 6d65 5f68       hash_name_h
+00038be0: 7562 2c0d 0a20 2020 2020 2020 2020 2020  ub,..           
+00038bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c00: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00038c10: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+00038c20: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00038c30: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
+00038c40: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
+00038c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c70: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+00038c80: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
+00038c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038cb0: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+00038cc0: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+00038cd0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00038ce0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00038cf0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00038d00: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00038d10: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00038d20: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00038d30: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00038d40: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00038d50: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00038d60: 0d0a 2020 2020 2020 2020 2320 5265 6c61  ..        # Rela
+00038d70: 7469 6f6e 7368 6970 206f 6e20 5354 475f  tionship on STG_
+00038d80: 544d 5020 616e 6420 4c49 4e4b 0d0a 2020  TMP and LINK..  
+00038d90: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00038da0: 7369 7469 6f6e 203d 2031 0d0a 2020 2020  sition = 1..    
+00038db0: 2020 2020 6e65 775f 7265 6c61 7469 6f6e      new_relation
+00038dc0: 7368 6970 203d 205b 7072 6566 6978 5f65  ship = [prefix_e
+00038dd0: 7420 2b20 6c69 6e6b 5f73 7467 5f74 6d70  t + link_stg_tmp
+00038de0: 5f6e 616d 652c 2068 6173 685f 6e61 6d65  _name, hash_name
+00038df0: 2c20 7072 6566 6978 5f65 7420 2b20 6c69  , prefix_et + li
+00038e00: 6e6b 5f6e 616d 652c 0d0a 2020 2020 2020  nk_name,..      
+00038e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038e20: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+00038e30: 2027 4d41 5354 4552 204a 4f49 4e27 2c20   'MASTER JOIN', 
+00038e40: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+00038e50: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+00038e60: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+00038e70: 7472 795f 6461 7461 7365 745f 7265 6c61  try_dataset_rela
+00038e80: 7469 6f6e 7368 6970 285b 6e65 775f 7265  tionship([new_re
+00038e90: 6c61 7469 6f6e 7368 6970 5d29 0d0a 0d0a  lationship])....
+00038ea0: 0d0a 2020 2020 2020 2020 2320 5354 470d  ..        # STG.
+00038eb0: 0a20 2020 2020 2020 2068 6173 685f 666f  .        hash_fo
+00038ec0: 725f 6d65 7461 6461 7461 203d 2073 656c  r_metadata = sel
+00038ed0: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
+00038ee0: 5f68 6173 685f 666f 725f 6d65 7461 6461  _hash_for_metada
+00038ef0: 7461 2829 0d0a 2020 2020 2020 2020 6e65  ta()..        ne
+00038f00: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00038f10: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
+00038f20: 206c 696e 6b5f 7374 675f 746d 705f 6e61   link_stg_tmp_na
+00038f30: 6d65 2c20 6861 7368 5f6e 616d 652c 2070  me, hash_name, p
+00038f40: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+00038f50: 7374 675f 6e61 6d65 2c0d 0a20 2020 2020  stg_name,..     
+00038f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038f70: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+00038f80: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+00038f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038fa0: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+00038fb0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+00038fc0: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+00038fd0: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+00038fe0: 5d2c 2068 6173 685f 666f 725f 6d65 7461  ], hash_for_meta
+00038ff0: 6461 7461 5b32 5d2c 2031 2c0d 0a20 2020  data[2], 1,..   
+00039000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039010: 2020 2020 2020 2020 2020 2020 4b45 595f              KEY_
+00039020: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+00039030: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00039040: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00039050: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00039060: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00039070: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00039080: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00039090: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+000390a0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+000390b0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+000390c0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+000390d0: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+000390e0: 6e61 6d65 2c20 6861 7368 5f6e 616d 652c  name, hash_name,
+000390f0: 2070 7265 6669 785f 6574 202b 206c 696e   prefix_et + lin
+00039100: 6b5f 7374 675f 6e61 6d65 2c0d 0a20 2020  k_stg_name,..   
+00039110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039120: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+00039130: 5f6e 616d 6520 2b20 225f 4c49 4e4b 222c  _name + "_LINK",
+00039140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039160: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+00039170: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+00039180: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+00039190: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+000391a0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+000391b0: 5b32 5d2c 2031 2c0d 0a20 2020 2020 2020  [2], 1,..       
+000391c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000391d0: 2020 2020 2020 2020 4b45 595f 5459 5045          KEY_TYPE
+000391e0: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+000391f0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00039200: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00039210: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00039220: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00039230: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00039240: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+00039250: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+00039260: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+00039270: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+00039280: 6d65 7461 6461 7461 203d 2073 656c 662e  metadata = self.
+00039290: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+000392a0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+000392b0: 6174 6128 290d 0a20 2020 2020 2020 206e  ata()..        n
+000392c0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+000392d0: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+000392e0: 2b20 6c69 6e6b 5f73 7467 5f74 6d70 5f6e  + link_stg_tmp_n
+000392f0: 616d 652c 2027 4441 5445 5f43 5245 4154  ame, 'DATE_CREAT
+00039300: 4544 272c 2070 7265 6669 785f 6574 202b  ED', prefix_et +
+00039310: 206c 696e 6b5f 7374 675f 6e61 6d65 2c20   link_stg_name, 
+00039320: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
+00039330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039350: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00039360: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+00039370: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
+00039380: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+00039390: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
 000393a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000393b0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-000393c0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-000393d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000393e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000393f0: 2020 2020 2020 6170 706c 6965 645f 6461        applied_da
-00039400: 7465 2e63 6f6c 756d 6e5f 7479 7065 5f74  te.column_type_t
-00039410: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
-00039420: 6f73 6974 696f 6e2c 2061 7070 6c69 6564  osition, applied
-00039430: 5f64 6174 652e 636f 6c75 6d6e 5f6c 656e  _date.column_len
-00039440: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00039450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039460: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
-00039470: 5f64 6174 652e 636f 6c75 6d6e 5f70 7265  _date.column_pre
-00039480: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00039490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000394a0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-000394b0: 4559 5f54 5950 455f 4150 504c 4945 445f  EY_TYPE_APPLIED_
-000394c0: 4441 5445 2c20 312c 2073 656c 662e 6f77  DATE, 1, self.ow
-000394d0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-000394e0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
-000394f0: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
-00039500: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00039510: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-00039520: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-00039530: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-00039540: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-00039550: 2020 2020 2020 2069 6620 6861 735f 746e         if has_tn
-00039560: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00039570: 6f72 2074 6e20 696e 2074 656e 616e 745f  or tn in tenant_
-00039580: 736f 7572 6365 3a0d 0a20 2020 2020 2020  source:..       
-00039590: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-000395a0: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-000395b0: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-000395c0: 5f73 7467 5f74 6d70 5f6e 616d 652c 2074  _stg_tmp_name, t
-000395d0: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-000395e0: 7267 6574 2c20 7072 6566 6978 5f65 7420  rget, prefix_et 
-000395f0: 2b20 6c69 6e6b 5f73 7467 5f6e 616d 652c  + link_stg_name,
-00039600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00039610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039620: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-00039630: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-00039640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039660: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-00039670: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-00039680: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-00039690: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
-000396a0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-000396b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000396c0: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-000396d0: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-000396e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000396f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039700: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-00039710: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
-00039720: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00039730: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-00039740: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00039750: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00039760: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00039770: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00039780: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00039790: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-000397a0: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-000397b0: 2020 2020 2069 6620 6861 735f 7365 713a       if has_seq:
-000397c0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-000397d0: 7220 7365 7120 696e 2073 6571 5f73 6f75  r seq in seq_sou
-000397e0: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-000397f0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00039800: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-00039810: 6669 785f 6574 202b 206c 696e 6b5f 7374  fix_et + link_st
-00039820: 675f 746d 705f 6e61 6d65 2c20 7365 712e  g_tmp_name, seq.
-00039830: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-00039840: 6574 2c20 7072 6566 6978 5f65 7420 2b20  et, prefix_et + 
-00039850: 6c69 6e6b 5f73 7467 5f6e 616d 652c 0d0a  link_stg_name,..
-00039860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039880: 2020 2020 2020 2073 6571 2e63 6f6c 756d         seq.colum
-00039890: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+000393b0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+000393c0: 6d65 7461 6461 7461 5b32 5d2c 2031 2c20  metadata[2], 1, 
+000393d0: 4b45 595f 5459 5045 5f4e 554c 4c2c 2031  KEY_TYPE_NULL, 1
+000393e0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000393f0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00039400: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+00039410: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+00039420: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+00039430: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+00039440: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00039450: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00039460: 2020 2020 2020 2020 6966 2068 6173 5f72          if has_r
+00039470: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00039480: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00039490: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+000394a0: 202b 206c 696e 6b5f 7374 675f 746d 705f   + link_stg_tmp_
+000394b0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+000394c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000394d0: 2020 2020 2020 2020 2020 7265 636f 7264            record
+000394e0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
+000394f0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00039500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039520: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
+00039530: 5f73 7467 5f6e 616d 652c 0d0a 2020 2020  _stg_name,..    
+00039540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039550: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00039560: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+00039570: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+00039580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000395a0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+000395b0: 6365 2e63 6f6c 756d 6e5f 7479 7065 5f74  ce.column_type_t
+000395c0: 6172 6765 742c 206f 7264 696e 616c 5f70  arget, ordinal_p
+000395d0: 6f73 6974 696f 6e2c 2072 6563 6f72 645f  osition, record_
+000395e0: 736f 7572 6365 2e63 6f6c 756d 6e5f 6c65  source.column_le
+000395f0: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
+00039600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039610: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00039620: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f70  _source.column_p
+00039630: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
+00039640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039650: 2020 2020 2020 2020 2020 2020 2020 312c                1,
+00039660: 204b 4559 5f54 5950 455f 5245 434f 5244   KEY_TYPE_RECORD
+00039670: 5f53 4f55 5243 452c 2031 2c20 7365 6c66  _SOURCE, 1, self
+00039680: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00039690: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+000396a0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+000396b0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+000396c0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+000396d0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+000396e0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+000396f0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00039700: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00039710: 5f61 643a 0d0a 2020 2020 2020 2020 2020  _ad:..          
+00039720: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00039730: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+00039740: 6574 202b 206c 696e 6b5f 7374 675f 746d  et + link_stg_tm
+00039750: 705f 6e61 6d65 2c0d 0a20 2020 2020 2020  p_name,..       
+00039760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039770: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+00039780: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00039790: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+000397a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000397b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000397c0: 2070 7265 6669 785f 6574 202b 206c 696e   prefix_et + lin
+000397d0: 6b5f 7374 675f 6e61 6d65 2c0d 0a20 2020  k_stg_name,..   
+000397e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000397f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039800: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+00039810: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+00039820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039840: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00039850: 652e 636f 6c75 6d6e 5f74 7970 655f 7461  e.column_type_ta
+00039860: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+00039870: 7369 7469 6f6e 2c20 6170 706c 6965 645f  sition, applied_
+00039880: 6461 7465 2e63 6f6c 756d 6e5f 6c65 6e67  date.column_leng
+00039890: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
 000398a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000398b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000398c0: 2020 2020 2020 2073 6571 2e63 6f6c 756d         seq.colum
-000398d0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-000398e0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-000398f0: 2073 6571 2e63 6f6c 756d 6e5f 6c65 6e67   seq.column_leng
-00039900: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-00039910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039920: 2020 2020 2020 2020 2020 2020 7365 712e              seq.
-00039930: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
-00039940: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00039950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039960: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
-00039970: 5f54 5950 455f 5345 5155 454e 4345 2c20  _TYPE_SEQUENCE, 
-00039980: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-00039990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000399a0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000399b0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000399c0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-000399d0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-000399e0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-000399f0: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-00039a00: 7365 745f 6d61 7070 696e 675d 290d 0a0d  set_mapping])...
-00039a10: 0a20 2020 2020 2020 2066 6f72 206e 756d  .        for num
-00039a20: 5f63 6f6e 2069 6e20 7261 6e67 6528 312c  _con in range(1,
-00039a30: 206e 756d 5f63 6f6e 6e65 6374 696f 6e73   num_connections
-00039a40: 202b 2031 293a 0d0a 2020 2020 2020 2020   + 1):..        
-00039a50: 2020 2020 6861 7368 5f6e 616d 655f 6875      hash_name_hu
-00039a60: 6220 3d20 2748 4153 485f 2720 2b20 7374  b = 'HASH_' + st
-00039a70: 7228 6e75 6d5f 636f 6e29 0d0a 2020 2020  r(num_con)..    
-00039a80: 2020 2020 2020 2020 6476 5f70 726f 7065          dv_prope
-00039a90: 7274 7920 3d20 7365 6c66 2e6d 6574 6164  rty = self.metad
-00039aa0: 6174 615f 6163 7475 616c 2e67 6574 5f64  ata_actual.get_d
-00039ab0: 765f 7072 6f70 6572 7469 6573 5f66 726f  v_properties_fro
-00039ac0: 6d5f 636f 645f 656e 7469 7479 5f61 6e64  m_cod_entity_and
-00039ad0: 5f6e 756d 5f63 6f6e 6e65 6374 696f 6e28  _num_connection(
-00039ae0: 6c69 6e6b 2e63 6f64 5f65 6e74 6974 792c  link.cod_entity,
-00039af0: 206e 756d 5f63 6f6e 290d 0a20 2020 2020   num_con)..     
-00039b00: 2020 2020 2020 2069 6620 6476 5f70 726f         if dv_pro
-00039b10: 7065 7274 7920 6973 206e 6f74 204e 6f6e  perty is not Non
-00039b20: 653a 2068 6173 685f 6e61 6d65 5f68 7562  e: hash_name_hub
-00039b30: 203d 2064 765f 7072 6f70 6572 7479 2e68   = dv_property.h
-00039b40: 6173 685f 6e61 6d65 0d0a 0d0a 2020 2020  ash_name....    
-00039b50: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00039b60: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00039b70: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-00039b80: 7374 675f 746d 705f 6e61 6d65 2c20 6861  stg_tmp_name, ha
-00039b90: 7368 5f6e 616d 655f 6875 622c 2070 7265  sh_name_hub, pre
-00039ba0: 6669 785f 6574 202b 206c 696e 6b5f 7374  fix_et + link_st
-00039bb0: 675f 6e61 6d65 2c0d 0a20 2020 2020 2020  g_name,..       
-00039bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039bd0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00039be0: 5f6e 616d 655f 6875 622c 0d0a 2020 2020  _name_hub,..    
-00039bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c00: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00039c10: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-00039c20: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-00039c30: 6974 696f 6e2c 2068 6173 685f 666f 725f  ition, hash_for_
-00039c40: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
-00039c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c70: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
-00039c80: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
-00039c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039ca0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-00039cb0: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-00039cc0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00039cd0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-00039ce0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-00039cf0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-00039d00: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00039d10: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-00039d20: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-00039d30: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-00039d40: 7069 6e67 5d29 0d0a 0d0a 0d0a 2020 2020  ping])......    
-00039d50: 2020 2020 2320 4669 6c74 6572 0d0a 2020      # Filter..  
-00039d60: 2020 2020 2020 6e65 775f 6669 6c74 6572        new_filter
-00039d70: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-00039d80: 6c69 6e6b 5f73 7467 5f6c 6173 745f 696d  link_stg_last_im
-00039d90: 6167 655f 6e61 6d65 2c20 6861 7368 5f6e  age_name, hash_n
-00039da0: 616d 6520 2b20 225f 4c49 4e4b 2069 7320  ame + "_LINK is 
-00039db0: 6e75 6c6c 222c 2031 2c20 7365 6c66 2e6f  null", 1, self.o
-00039dc0: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-00039dd0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00039de0: 7561 6c2e 6164 645f 656e 7472 795f 6669  ual.add_entry_fi
-00039df0: 6c74 6572 7328 5b6e 6577 5f66 696c 7465  lters([new_filte
-00039e00: 725d 290d 0a0d 0a0d 0a0d 0a0d 0a20 2020  r])..........   
-00039e10: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00039e20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00039e30: 2323 204c 6173 7420 696d 6167 6520 2323  ## Last image ##
-00039e40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00039e50: 2323 2323 2323 2323 2323 230d 0a20 2020  ###########..   
-00039e60: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00039e70: 6974 696f 6e20 3d20 310d 0a20 2020 2020  ition = 1..     
-00039e80: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-00039e90: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-00039ea0: 6563 7469 6f6e 2e67 6574 5f68 6173 685f  ection.get_hash_
-00039eb0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-00039ec0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00039ed0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00039ee0: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-00039ef0: 7374 675f 6e61 6d65 2c20 6861 7368 5f6e  stg_name, hash_n
-00039f00: 616d 652c 2070 7265 6669 785f 6574 202b  ame, prefix_et +
-00039f10: 206c 696e 6b5f 7374 675f 6c61 7374 5f69   link_stg_last_i
-00039f20: 6d61 6765 5f6e 616d 652c 0d0a 2020 2020  mage_name,..    
-00039f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039f40: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-00039f50: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00039f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039f70: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-00039f80: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-00039f90: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-00039fa0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-00039fb0: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-00039fc0: 6164 6174 615b 325d 2c20 312c 0d0a 2020  adata[2], 1,..  
-00039fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039fe0: 2020 2020 2020 2020 2020 2020 204b 4559               KEY
-00039ff0: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
-0003a000: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0003a010: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0003a020: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0003a030: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0003a040: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0003a050: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0003a060: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0003a070: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-0003a080: 0a20 2020 2020 2020 2073 7973 6461 7465  .        sysdate
-0003a090: 5f66 6f72 5f6d 6574 6164 6174 6120 3d20  _for_metadata = 
-0003a0a0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
-0003a0b0: 6765 745f 7379 7364 6174 655f 666f 725f  get_sysdate_for_
-0003a0c0: 6d65 7461 6461 7461 2829 0d0a 2020 2020  metadata()..    
-0003a0d0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0003a0e0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-0003a0f0: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
-0003a100: 6e61 6d65 2c20 2744 4154 455f 4352 4541  name, 'DATE_CREA
-0003a110: 5445 4427 2c20 7072 6566 6978 5f65 7420  TED', prefix_et 
-0003a120: 2b20 6c69 6e6b 5f73 7467 5f6c 6173 745f  + link_stg_last_
-0003a130: 696d 6167 655f 6e61 6d65 2c20 2744 4154  image_name, 'DAT
-0003a140: 455f 4352 4541 5445 4427 2c0d 0a20 2020  E_CREATED',..   
-0003a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a160: 2020 2020 2020 2020 2020 2020 7379 7364              sysd
-0003a170: 6174 655f 666f 725f 6d65 7461 6461 7461  ate_for_metadata
-0003a180: 5b30 5d2c 206f 7264 696e 616c 5f70 6f73  [0], ordinal_pos
-0003a190: 6974 696f 6e2c 2073 7973 6461 7465 5f66  ition, sysdate_f
-0003a1a0: 6f72 5f6d 6574 6164 6174 615b 315d 2c0d  or_metadata[1],.
-0003a1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a1d0: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-0003a1e0: 6461 7461 5b32 5d2c 2031 2c20 4b45 595f  data[2], 1, KEY_
-0003a1f0: 5459 5045 5f4e 554c 4c2c 2031 2c20 7365  TYPE_NULL, 1, se
-0003a200: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0003a210: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0003a220: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-0003a230: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-0003a240: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-0003a250: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-0003a260: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0003a270: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-0003a280: 2020 2020 6966 2068 6173 5f72 733a 0d0a      if has_rs:..
-0003a290: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0003a2a0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0003a2b0: 3d20 5b70 7265 6669 785f 6574 202b 206c  = [prefix_et + l
-0003a2c0: 696e 6b5f 7374 675f 6e61 6d65 2c0d 0a20  ink_stg_name,.. 
-0003a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a2f0: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-0003a300: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-0003a310: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-0003a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a330: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-0003a340: 7420 2b20 6c69 6e6b 5f73 7467 5f6c 6173  t + link_stg_las
-0003a350: 745f 696d 6167 655f 6e61 6d65 2c0d 0a20  t_image_name,.. 
-0003a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a380: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-0003a390: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-0003a3a0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
+000398b0: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+000398c0: 6461 7465 2e63 6f6c 756d 6e5f 7072 6563  date.column_prec
+000398d0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
+000398e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000398f0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+00039900: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
+00039910: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
+00039920: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00039930: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00039940: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+00039950: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00039960: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00039970: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00039980: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00039990: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+000399a0: 2020 2020 2020 6966 2068 6173 5f74 6e3a        if has_tn:
+000399b0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+000399c0: 7220 746e 2069 6e20 7465 6e61 6e74 5f73  r tn in tenant_s
+000399d0: 6f75 7263 653a 0d0a 2020 2020 2020 2020  ource:..        
+000399e0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+000399f0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+00039a00: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+00039a10: 7374 675f 746d 705f 6e61 6d65 2c20 746e  stg_tmp_name, tn
+00039a20: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00039a30: 6765 742c 2070 7265 6669 785f 6574 202b  get, prefix_et +
+00039a40: 206c 696e 6b5f 7374 675f 6e61 6d65 2c0d   link_stg_name,.
+00039a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039a70: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+00039a80: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+00039a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039ab0: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+00039ac0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+00039ad0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00039ae0: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
+00039af0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00039b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039b10: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+00039b20: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+00039b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039b50: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+00039b60: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
+00039b70: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+00039b80: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00039b90: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00039ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039bb0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00039bc0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+00039bd0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00039be0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+00039bf0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+00039c00: 2020 2020 6966 2068 6173 5f73 6571 3a0d      if has_seq:.
+00039c10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00039c20: 2073 6571 2069 6e20 7365 715f 736f 7572   seq in seq_sour
+00039c30: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+00039c40: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+00039c50: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+00039c60: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
+00039c70: 5f74 6d70 5f6e 616d 652c 2073 6571 2e63  _tmp_name, seq.c
+00039c80: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+00039c90: 742c 2070 7265 6669 785f 6574 202b 206c  t, prefix_et + l
+00039ca0: 696e 6b5f 7374 675f 6e61 6d65 2c0d 0a20  ink_stg_name,.. 
+00039cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039cd0: 2020 2020 2020 7365 712e 636f 6c75 6d6e        seq.column
+00039ce0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+00039cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039d10: 2020 2020 2020 7365 712e 636f 6c75 6d6e        seq.column
+00039d20: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+00039d30: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00039d40: 7365 712e 636f 6c75 6d6e 5f6c 656e 6774  seq.column_lengt
+00039d50: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00039d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039d70: 2020 2020 2020 2020 2020 2073 6571 2e63             seq.c
+00039d80: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
+00039d90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039db0: 2020 2020 2020 2020 2031 2c20 4b45 595f           1, KEY_
+00039dc0: 5459 5045 5f53 4551 5545 4e43 452c 2031  TYPE_SEQUENCE, 1
+00039dd0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00039de0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00039df0: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+00039e00: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00039e10: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00039e20: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00039e30: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+00039e40: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+00039e50: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+00039e60: 2020 2020 2020 2020 666f 7220 6e75 6d5f          for num_
+00039e70: 636f 6e20 696e 2072 616e 6765 2831 2c20  con in range(1, 
+00039e80: 6e75 6d5f 636f 6e6e 6563 7469 6f6e 7320  num_connections 
+00039e90: 2b20 3129 3a0d 0a20 2020 2020 2020 2020  + 1):..         
+00039ea0: 2020 2068 6173 685f 6e61 6d65 5f68 7562     hash_name_hub
+00039eb0: 203d 2027 4841 5348 5f27 202b 2073 7472   = 'HASH_' + str
+00039ec0: 286e 756d 5f63 6f6e 290d 0a20 2020 2020  (num_con)..     
+00039ed0: 2020 2020 2020 2064 765f 7072 6f70 6572         dv_proper
+00039ee0: 7479 203d 2073 656c 662e 6d65 7461 6461  ty = self.metada
+00039ef0: 7461 5f61 6374 7561 6c2e 6765 745f 6476  ta_actual.get_dv
+00039f00: 5f70 726f 7065 7274 6965 735f 6672 6f6d  _properties_from
+00039f10: 5f63 6f64 5f65 6e74 6974 795f 616e 645f  _cod_entity_and_
+00039f20: 6e75 6d5f 636f 6e6e 6563 7469 6f6e 286c  num_connection(l
+00039f30: 696e 6b2e 636f 645f 656e 7469 7479 2c20  ink.cod_entity, 
+00039f40: 6e75 6d5f 636f 6e29 0d0a 2020 2020 2020  num_con)..      
+00039f50: 2020 2020 2020 6966 2064 765f 7072 6f70        if dv_prop
+00039f60: 6572 7479 2069 7320 6e6f 7420 4e6f 6e65  erty is not None
+00039f70: 3a20 6861 7368 5f6e 616d 655f 6875 6220  : hash_name_hub 
+00039f80: 3d20 6476 5f70 726f 7065 7274 792e 6861  = dv_property.ha
+00039f90: 7368 5f6e 616d 650d 0a0d 0a20 2020 2020  sh_name....     
+00039fa0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+00039fb0: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+00039fc0: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f73  efix_et + link_s
+00039fd0: 7467 5f74 6d70 5f6e 616d 652c 2068 6173  tg_tmp_name, has
+00039fe0: 685f 6e61 6d65 5f68 7562 2c20 7072 6566  h_name_hub, pref
+00039ff0: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
+0003a000: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
+0003a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a020: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+0003a030: 6e61 6d65 5f68 7562 2c0d 0a20 2020 2020  name_hub,..     
+0003a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a050: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0003a060: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+0003a070: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+0003a080: 7469 6f6e 2c20 6861 7368 5f66 6f72 5f6d  tion, hash_for_m
+0003a090: 6574 6164 6174 615b 315d 2c0d 0a20 2020  etadata[1],..   
+0003a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a0c0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0003a0d0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
+0003a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a0f0: 2020 2020 2020 2020 2020 312c 204b 4559            1, KEY
+0003a100: 5f54 5950 455f 4841 5348 5f4b 4559 2c20  _TYPE_HASH_KEY, 
+0003a110: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0003a120: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
+0003a130: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+0003a140: 310d 0a20 2020 2020 2020 2020 2020 2073  1..            s
+0003a150: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0003a160: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+0003a170: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+0003a180: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0003a190: 696e 675d 290d 0a0d 0a0d 0a20 2020 2020  ing])......     
+0003a1a0: 2020 2023 2046 696c 7465 720d 0a20 2020     # Filter..   
+0003a1b0: 2020 2020 206e 6577 5f66 696c 7465 7220       new_filter 
+0003a1c0: 3d20 5b70 7265 6669 785f 6574 202b 206c  = [prefix_et + l
+0003a1d0: 696e 6b5f 7374 675f 6c61 7374 5f69 6d61  ink_stg_last_ima
+0003a1e0: 6765 5f6e 616d 652c 2068 6173 685f 6e61  ge_name, hash_na
+0003a1f0: 6d65 202b 2022 5f4c 494e 4b20 6973 206e  me + "_LINK is n
+0003a200: 756c 6c22 2c20 312c 2073 656c 662e 6f77  ull", 1, self.ow
+0003a210: 6e65 725d 0d0a 2020 2020 2020 2020 7365  ner]..        se
+0003a220: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0003a230: 616c 2e61 6464 5f65 6e74 7279 5f66 696c  al.add_entry_fil
+0003a240: 7465 7273 285b 6e65 775f 6669 6c74 6572  ters([new_filter
+0003a250: 5d29 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020  ])..........    
+0003a260: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+0003a270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003a280: 2320 4c61 7374 2069 6d61 6765 2023 2323  # Last image ###
+0003a290: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003a2a0: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
+0003a2b0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0003a2c0: 7469 6f6e 203d 2031 0d0a 2020 2020 2020  tion = 1..      
+0003a2d0: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+0003a2e0: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+0003a2f0: 6374 696f 6e2e 6765 745f 6861 7368 5f66  ction.get_hash_f
+0003a300: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
+0003a310: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0003a320: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0003a330: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f73  efix_et + link_s
+0003a340: 7467 5f6e 616d 652c 2068 6173 685f 6e61  tg_name, hash_na
+0003a350: 6d65 2c20 7072 6566 6978 5f65 7420 2b20  me, prefix_et + 
+0003a360: 6c69 6e6b 5f73 7467 5f6c 6173 745f 696d  link_stg_last_im
+0003a370: 6167 655f 6e61 6d65 2c0d 0a20 2020 2020  age_name,..     
+0003a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a390: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+0003a3a0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
 0003a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a3c0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-0003a3d0: 6f75 7263 652e 636f 6c75 6d6e 5f74 7970  ource.column_typ
-0003a3e0: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
-0003a3f0: 6c5f 706f 7369 7469 6f6e 2c20 7265 636f  l_position, reco
-0003a400: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-0003a410: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+0003a3c0: 2020 2020 2068 6173 685f 666f 725f 6d65       hash_for_me
+0003a3d0: 7461 6461 7461 5b30 5d2c 206f 7264 696e  tadata[0], ordin
+0003a3e0: 616c 5f70 6f73 6974 696f 6e2c 2068 6173  al_position, has
+0003a3f0: 685f 666f 725f 6d65 7461 6461 7461 5b31  h_for_metadata[1
+0003a400: 5d2c 2068 6173 685f 666f 725f 6d65 7461  ], hash_for_meta
+0003a410: 6461 7461 5b32 5d2c 2031 2c0d 0a20 2020  data[2], 1,..   
 0003a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a430: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-0003a440: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-0003a450: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-0003a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a480: 2031 2c20 4b45 595f 5459 5045 5f52 4543   1, KEY_TYPE_REC
-0003a490: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
-0003a4a0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0003a4b0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0003a4c0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
-0003a4d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003a4e0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0003a4f0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0003a500: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0003a510: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0003a520: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0003a530: 6861 735f 6164 3a0d 0a20 2020 2020 2020  has_ad:..       
-0003a540: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0003a550: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-0003a560: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
-0003a570: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-0003a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a590: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
-0003a5a0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-0003a5b0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-0003a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a5e0: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-0003a5f0: 5f73 7467 5f6c 6173 745f 696d 6167 655f  _stg_last_image_
-0003a600: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-0003a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a620: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-0003a630: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
-0003a640: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-0003a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a660: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0003a670: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-0003a680: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0003a690: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0003a6a0: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
-0003a6b0: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-0003a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a6e0: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-0003a6f0: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-0003a700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a720: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-0003a730: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
-0003a740: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0003a750: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-0003a760: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0003a770: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0003a780: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0003a790: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0003a7a0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0003a7b0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0003a7c0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0003a7d0: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
-0003a7e0: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
-0003a7f0: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
-0003a800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003a810: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0003a820: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0003a830: 6574 202b 206c 696e 6b5f 7374 675f 6e61  et + link_stg_na
-0003a840: 6d65 2c20 746e 2e63 6f6c 756d 6e5f 6e61  me, tn.column_na
-0003a850: 6d65 5f74 6172 6765 742c 2070 7265 6669  me_target, prefi
-0003a860: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
-0003a870: 6c61 7374 5f69 6d61 6765 5f6e 616d 652c  last_image_name,
-0003a880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a8a0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
-0003a8b0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-0003a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a8e0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-0003a8f0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
-0003a900: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
-0003a910: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
-0003a920: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-0003a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a940: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
-0003a950: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-0003a960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a980: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-0003a990: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
-0003a9a0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0003a9b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003a9c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003a9d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0003a9e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0003a9f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003aa00: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0003aa10: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0003aa20: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-0003aa30: 2020 2020 2069 6620 6861 735f 7365 713a       if has_seq:
-0003aa40: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0003aa50: 7220 7365 7120 696e 2073 6571 5f73 6f75  r seq in seq_sou
-0003aa60: 7263 653a 0d0a 2020 2020 2020 2020 2020  rce:..          
-0003aa70: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-0003aa80: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-0003aa90: 6669 785f 6574 202b 206c 696e 6b5f 7374  fix_et + link_st
-0003aaa0: 675f 6e61 6d65 2c20 7365 712e 636f 6c75  g_name, seq.colu
-0003aab0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c20  mn_name_target, 
-0003aac0: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-0003aad0: 5f73 7467 5f6c 6173 745f 696d 6167 655f  _stg_last_image_
-0003aae0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-0003aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003ab10: 712e 636f 6c75 6d6e 5f6e 616d 655f 7461  q.column_name_ta
-0003ab20: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-0003ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003ab50: 712e 636f 6c75 6d6e 5f74 7970 655f 7461  q.column_type_ta
-0003ab60: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-0003ab70: 7369 7469 6f6e 2c20 7365 712e 636f 6c75  sition, seq.colu
-0003ab80: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-0003ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abb0: 2020 2073 6571 2e63 6f6c 756d 6e5f 7072     seq.column_pr
-0003abc0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-0003abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abf0: 2031 2c20 4b45 595f 5459 5045 5f53 4551   1, KEY_TYPE_SEQ
-0003ac00: 5545 4e43 452c 2031 2c20 7365 6c66 2e6f  UENCE, 1, self.o
-0003ac10: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0003ac20: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0003ac30: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-0003ac40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003ac50: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0003ac60: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0003ac70: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0003ac80: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0003ac90: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0003aca0: 666f 7220 6e75 6d5f 636f 6e20 696e 2072  for num_con in r
-0003acb0: 616e 6765 2831 2c20 6e75 6d5f 636f 6e6e  ange(1, num_conn
-0003acc0: 6563 7469 6f6e 7320 2b20 3129 3a0d 0a20  ections + 1):.. 
-0003acd0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0003ace0: 6e61 6d65 5f68 7562 203d 2027 4841 5348  name_hub = 'HASH
-0003acf0: 5f27 202b 2073 7472 286e 756d 5f63 6f6e  _' + str(num_con
-0003ad00: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-0003ad10: 765f 7072 6f70 6572 7479 203d 2073 656c  v_property = sel
-0003ad20: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0003ad30: 6c2e 6765 745f 6476 5f70 726f 7065 7274  l.get_dv_propert
-0003ad40: 6965 735f 6672 6f6d 5f63 6f64 5f65 6e74  ies_from_cod_ent
-0003ad50: 6974 795f 616e 645f 6e75 6d5f 636f 6e6e  ity_and_num_conn
-0003ad60: 6563 7469 6f6e 286c 696e 6b2e 636f 645f  ection(link.cod_
-0003ad70: 656e 7469 7479 2c20 6e75 6d5f 636f 6e29  entity, num_con)
-0003ad80: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0003ad90: 2064 765f 7072 6f70 6572 7479 2069 7320   dv_property is 
-0003ada0: 6e6f 7420 4e6f 6e65 3a20 6861 7368 5f6e  not None: hash_n
-0003adb0: 616d 655f 6875 6220 3d20 6476 5f70 726f  ame_hub = dv_pro
-0003adc0: 7065 7274 792e 6861 7368 5f6e 616d 650d  perty.hash_name.
-0003add0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-0003ade0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003adf0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0003ae00: 6c69 6e6b 5f73 7467 5f6e 616d 652c 2068  link_stg_name, h
-0003ae10: 6173 685f 6e61 6d65 5f68 7562 2c20 7072  ash_name_hub, pr
-0003ae20: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f73  efix_et + link_s
-0003ae30: 7467 5f6c 6173 745f 696d 6167 655f 6e61  tg_last_image_na
-0003ae40: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
-0003ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ae60: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
-0003ae70: 655f 6875 622c 0d0a 2020 2020 2020 2020  e_hub,..        
-0003ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ae90: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0003aea0: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-0003aeb0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0003aec0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-0003aed0: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
-0003aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aef0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-0003af00: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
-0003af10: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0003af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003af30: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
-0003af40: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-0003af50: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0003af60: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-0003af70: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0003af80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003af90: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003afa0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0003afb0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0003afc0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003afd0: 5d29 0d0a 0d0a 2020 2020 2020 2020 696e  ])....        in
-0003afe0: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
-0003aff0: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-0003b000: 7469 6f6e 2e67 6574 5f69 6e74 6567 6572  tion.get_integer
-0003b010: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
-0003b020: 0a20 2020 2020 2020 2064 6174 655f 666f  .        date_fo
-0003b030: 725f 6c61 7374 5f69 6d61 6765 203d 2027  r_last_image = '
-0003b040: 4441 5445 5f43 5245 4154 4544 270d 0a20  DATE_CREATED'.. 
-0003b050: 2020 2020 2020 2069 6620 6861 735f 6164         if has_ad
-0003b060: 3a20 6461 7465 5f66 6f72 5f6c 6173 745f  : date_for_last_
-0003b070: 696d 6167 6520 3d20 6170 706c 6965 645f  image = applied_
-0003b080: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
-0003b090: 5f74 6172 6765 740d 0a20 2020 2020 2020  _target..       
-0003b0a0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0003b0b0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-0003b0c0: 7420 2b20 6c69 6e6b 5f73 7467 5f6e 616d  t + link_stg_nam
-0003b0d0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0003b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b0f0: 2020 2027 524f 575f 4e55 4d42 4552 2829     'ROW_NUMBER()
-0003b100: 206f 7665 7220 2870 6172 7469 7469 6f6e   over (partition
-0003b110: 2062 7920 2720 2b20 6861 7368 5f6e 616d   by ' + hash_nam
-0003b120: 6520 2b20 2720 4f52 4445 5220 4259 2027  e + ' ORDER BY '
-0003b130: 202b 2064 6174 655f 666f 725f 6c61 7374   + date_for_last
-0003b140: 5f69 6d61 6765 202b 2027 2064 6573 6329  _image + ' desc)
-0003b150: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0003b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b170: 2020 2070 7265 6669 785f 6574 202b 206c     prefix_et + l
-0003b180: 696e 6b5f 7374 675f 6c61 7374 5f69 6d61  ink_stg_last_ima
-0003b190: 6765 5f6e 616d 652c 2027 524e 272c 0d0a  ge_name, 'RN',..
-0003b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b1b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003b1c0: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
-0003b1d0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0003b1e0: 706f 7369 7469 6f6e 2c20 696e 7465 6765  position, intege
-0003b1f0: 725f 666f 725f 6d65 7461 6461 7461 5b31  r_for_metadata[1
-0003b200: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0003b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b220: 2020 2069 6e74 6567 6572 5f66 6f72 5f6d     integer_for_m
-0003b230: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
-0003b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b250: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-0003b260: 4559 5f54 5950 455f 4e55 4c4c 2c20 312c  EY_TYPE_NULL, 1,
-0003b270: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0003b280: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-0003b290: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-0003b2a0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-0003b2b0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-0003b2c0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
-0003b2d0: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0003b2e0: 7369 7469 6f6e 202b 3d20 310d 0a0d 0a20  sition += 1.... 
-0003b2f0: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-0003b300: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003b310: 2323 2320 4669 6e61 6c20 4c49 4e4b 2023  ### Final LINK #
-0003b320: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003b330: 2323 2323 2323 2323 230d 0a0d 0a20 2020  #########....   
-0003b340: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0003b350: 6974 696f 6e20 3d20 310d 0a20 2020 2020  ition = 1..     
-0003b360: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
-0003b370: 6461 7461 203d 2073 656c 662e 636f 6e6e  data = self.conn
-0003b380: 6563 7469 6f6e 2e67 6574 5f68 6173 685f  ection.get_hash_
-0003b390: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-0003b3a0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0003b3b0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-0003b3c0: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-0003b3d0: 7374 675f 6c61 7374 5f69 6d61 6765 5f6e  stg_last_image_n
-0003b3e0: 616d 652c 2068 6173 685f 6e61 6d65 2c20  ame, hash_name, 
-0003b3f0: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-0003b400: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-0003b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b420: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-0003b430: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0003b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b450: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-0003b460: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-0003b470: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-0003b480: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-0003b490: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-0003b4a0: 615b 325d 2c20 312c 0d0a 2020 2020 2020  a[2], 1,..      
-0003b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b4c0: 2020 2020 2020 2020 204b 4559 5f54 5950           KEY_TYP
-0003b4d0: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
-0003b4e0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-0003b4f0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0003b500: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0003b510: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0003b520: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0003b530: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-0003b540: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0003b550: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-0003b560: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
-0003b570: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
-0003b580: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-0003b590: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-0003b5a0: 6461 7461 2829 0d0a 2020 2020 2020 2020  data()..        
-0003b5b0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0003b5c0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0003b5d0: 202b 206c 696e 6b5f 7374 675f 6c61 7374   + link_stg_last
-0003b5e0: 5f69 6d61 6765 5f6e 616d 652c 2027 4441  _image_name, 'DA
-0003b5f0: 5445 5f43 5245 4154 4544 272c 2070 7265  TE_CREATED', pre
-0003b600: 6669 785f 6574 202b 206c 696e 6b5f 6e61  fix_et + link_na
-0003b610: 6d65 2c20 2744 4154 455f 4352 4541 5445  me, 'DATE_CREATE
-0003b620: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
-0003b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b640: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0003b650: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-0003b660: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
-0003b670: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0003b680: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+0003a430: 2020 2020 2020 2020 2020 2020 4b45 595f              KEY_
+0003a440: 5459 5045 5f48 4153 485f 4b45 592c 2031  TYPE_HASH_KEY, 1
+0003a450: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0003a460: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0003a470: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0003a480: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0003a490: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0003a4a0: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+0003a4b0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0003a4c0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+0003a4d0: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+0003a4e0: 666f 725f 6d65 7461 6461 7461 203d 2073  for_metadata = s
+0003a4f0: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
+0003a500: 6574 5f73 7973 6461 7465 5f66 6f72 5f6d  et_sysdate_for_m
+0003a510: 6574 6164 6174 6128 290d 0a20 2020 2020  etadata()..     
+0003a520: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0003a530: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+0003a540: 5f65 7420 2b20 6c69 6e6b 5f73 7467 5f6e  _et + link_stg_n
+0003a550: 616d 652c 2027 4441 5445 5f43 5245 4154  ame, 'DATE_CREAT
+0003a560: 4544 272c 2070 7265 6669 785f 6574 202b  ED', prefix_et +
+0003a570: 206c 696e 6b5f 7374 675f 6c61 7374 5f69   link_stg_last_i
+0003a580: 6d61 6765 5f6e 616d 652c 2027 4441 5445  mage_name, 'DATE
+0003a590: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
+0003a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a5b0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
+0003a5c0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+0003a5d0: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
+0003a5e0: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
+0003a5f0: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
+0003a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003a620: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+0003a630: 6174 615b 325d 2c20 312c 204b 4559 5f54  ata[2], 1, KEY_T
+0003a640: 5950 455f 4e55 4c4c 2c20 312c 2073 656c  YPE_NULL, 1, sel
+0003a650: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0003a660: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0003a670: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0003a680: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0003a690: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0003a6a0: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0003a6b0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0003a6c0: 6f6e 202b 3d20 310d 0a0d 0a20 2020 2020  on += 1....     
+0003a6d0: 2020 2069 6620 6861 735f 7273 3a0d 0a20     if has_rs:.. 
+0003a6e0: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0003a6f0: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0003a700: 205b 7072 6566 6978 5f65 7420 2b20 6c69   [prefix_et + li
+0003a710: 6e6b 5f73 7467 5f6e 616d 652c 0d0a 2020  nk_stg_name,..  
+0003a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a740: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+0003a750: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+0003a760: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0003a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a780: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+0003a790: 202b 206c 696e 6b5f 7374 675f 6c61 7374   + link_stg_last
+0003a7a0: 5f69 6d61 6765 5f6e 616d 652c 0d0a 2020  _image_name,..  
+0003a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a7d0: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
+0003a7e0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+0003a7f0: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0003a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a810: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
+0003a820: 7572 6365 2e63 6f6c 756d 6e5f 7479 7065  urce.column_type
+0003a830: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+0003a840: 5f70 6f73 6974 696f 6e2c 2072 6563 6f72  _position, recor
+0003a850: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+0003a860: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+0003a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a880: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+0003a890: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
+0003a8a0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+0003a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a8d0: 312c 204b 4559 5f54 5950 455f 5245 434f  1, KEY_TYPE_RECO
+0003a8e0: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
+0003a8f0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0003a900: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+0003a910: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+0003a920: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0003a930: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0003a940: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0003a950: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0003a960: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0003a970: 0d0a 0d0a 2020 2020 2020 2020 6966 2068  ....        if h
+0003a980: 6173 5f61 643a 0d0a 2020 2020 2020 2020  as_ad:..        
+0003a990: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+0003a9a0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+0003a9b0: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
+0003a9c0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+0003a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a9e0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
+0003a9f0: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
+0003aa00: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+0003aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0003aa30: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+0003aa40: 7374 675f 6c61 7374 5f69 6d61 6765 5f6e  stg_last_image_n
+0003aa50: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0003aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa70: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+0003aa80: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
+0003aa90: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+0003aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aab0: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+0003aac0: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
+0003aad0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+0003aae0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0003aaf0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+0003ab00: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+0003ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab30: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+0003ab40: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+0003ab50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab70: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+0003ab80: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
+0003ab90: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0003aba0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+0003abb0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+0003abc0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003abd0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003abe0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0003abf0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0003ac00: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0003ac10: 675d 290d 0a0d 0a20 2020 2020 2020 2069  g])....        i
+0003ac20: 6620 6861 735f 746e 3a0d 0a20 2020 2020  f has_tn:..     
+0003ac30: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
+0003ac40: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
+0003ac50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ac60: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0003ac70: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0003ac80: 7420 2b20 6c69 6e6b 5f73 7467 5f6e 616d  t + link_stg_nam
+0003ac90: 652c 2074 6e2e 636f 6c75 6d6e 5f6e 616d  e, tn.column_nam
+0003aca0: 655f 7461 7267 6574 2c20 7072 6566 6978  e_target, prefix
+0003acb0: 5f65 7420 2b20 6c69 6e6b 5f73 7467 5f6c  _et + link_stg_l
+0003acc0: 6173 745f 696d 6167 655f 6e61 6d65 2c0d  ast_image_name,.
+0003acd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003acf0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+0003ad00: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+0003ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad30: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+0003ad40: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+0003ad50: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0003ad60: 746e 2e63 6f6c 756d 6e5f 6c65 6e67 7468  tn.column_length
+0003ad70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0003ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ad90: 2020 2020 2020 2020 2020 746e 2e63 6f6c            tn.col
+0003ada0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+0003adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003add0: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+0003ade0: 5045 5f54 454e 414e 542c 2031 2c20 7365  PE_TENANT, 1, se
+0003adf0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0003ae00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003ae10: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003ae20: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0003ae30: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0003ae40: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0003ae50: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0003ae60: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0003ae70: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+0003ae80: 2020 2020 6966 2068 6173 5f73 6571 3a0d      if has_seq:.
+0003ae90: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003aea0: 2073 6571 2069 6e20 7365 715f 736f 7572   seq in seq_sour
+0003aeb0: 6365 3a0d 0a20 2020 2020 2020 2020 2020  ce:..           
+0003aec0: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0003aed0: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+0003aee0: 6978 5f65 7420 2b20 6c69 6e6b 5f73 7467  ix_et + link_stg
+0003aef0: 5f6e 616d 652c 2073 6571 2e63 6f6c 756d  _name, seq.colum
+0003af00: 6e5f 6e61 6d65 5f74 6172 6765 742c 2070  n_name_target, p
+0003af10: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+0003af20: 7374 675f 6c61 7374 5f69 6d61 6765 5f6e  stg_last_image_n
+0003af30: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0003af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003af50: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0003af60: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0003af70: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
+0003af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003af90: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0003afa0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0003afb0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0003afc0: 6974 696f 6e2c 2073 6571 2e63 6f6c 756d  ition, seq.colum
+0003afd0: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
+0003afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b000: 2020 7365 712e 636f 6c75 6d6e 5f70 7265    seq.column_pre
+0003b010: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0003b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b040: 312c 204b 4559 5f54 5950 455f 5345 5155  1, KEY_TYPE_SEQU
+0003b050: 454e 4345 2c20 312c 2073 656c 662e 6f77  ENCE, 1, self.ow
+0003b060: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0003b070: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0003b080: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0003b090: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003b0a0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003b0b0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0003b0c0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0003b0d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0003b0e0: 675d 290d 0a0d 0a20 2020 2020 2020 2066  g])....        f
+0003b0f0: 6f72 206e 756d 5f63 6f6e 2069 6e20 7261  or num_con in ra
+0003b100: 6e67 6528 312c 206e 756d 5f63 6f6e 6e65  nge(1, num_conne
+0003b110: 6374 696f 6e73 202b 2031 293a 0d0a 2020  ctions + 1):..  
+0003b120: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+0003b130: 616d 655f 6875 6220 3d20 2748 4153 485f  ame_hub = 'HASH_
+0003b140: 2720 2b20 7374 7228 6e75 6d5f 636f 6e29  ' + str(num_con)
+0003b150: 0d0a 2020 2020 2020 2020 2020 2020 6476  ..            dv
+0003b160: 5f70 726f 7065 7274 7920 3d20 7365 6c66  _property = self
+0003b170: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0003b180: 2e67 6574 5f64 765f 7072 6f70 6572 7469  .get_dv_properti
+0003b190: 6573 5f66 726f 6d5f 636f 645f 656e 7469  es_from_cod_enti
+0003b1a0: 7479 5f61 6e64 5f6e 756d 5f63 6f6e 6e65  ty_and_num_conne
+0003b1b0: 6374 696f 6e28 6c69 6e6b 2e63 6f64 5f65  ction(link.cod_e
+0003b1c0: 6e74 6974 792c 206e 756d 5f63 6f6e 290d  ntity, num_con).
+0003b1d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003b1e0: 6476 5f70 726f 7065 7274 7920 6973 206e  dv_property is n
+0003b1f0: 6f74 204e 6f6e 653a 2068 6173 685f 6e61  ot None: hash_na
+0003b200: 6d65 5f68 7562 203d 2064 765f 7072 6f70  me_hub = dv_prop
+0003b210: 6572 7479 2e68 6173 685f 6e61 6d65 0d0a  erty.hash_name..
+0003b220: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0003b230: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0003b240: 3d20 5b70 7265 6669 785f 6574 202b 206c  = [prefix_et + l
+0003b250: 696e 6b5f 7374 675f 6e61 6d65 2c20 6861  ink_stg_name, ha
+0003b260: 7368 5f6e 616d 655f 6875 622c 2070 7265  sh_name_hub, pre
+0003b270: 6669 785f 6574 202b 206c 696e 6b5f 7374  fix_et + link_st
+0003b280: 675f 6c61 7374 5f69 6d61 6765 5f6e 616d  g_last_image_nam
+0003b290: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0003b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b2b0: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
+0003b2c0: 5f68 7562 2c0d 0a20 2020 2020 2020 2020  _hub,..         
+0003b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b2e0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+0003b2f0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0003b300: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0003b310: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0003b320: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+0003b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b340: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0003b350: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+0003b360: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0003b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b380: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
+0003b390: 455f 4841 5348 5f4b 4559 2c20 312c 2073  E_HASH_KEY, 1, s
+0003b3a0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0003b3b0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0003b3c0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+0003b3d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003b3e0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003b3f0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0003b400: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0003b410: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0003b420: 290d 0a0d 0a20 2020 2020 2020 2069 6e74  )....        int
+0003b430: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
+0003b440: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+0003b450: 696f 6e2e 6765 745f 696e 7465 6765 725f  ion.get_integer_
+0003b460: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+0003b470: 2020 2020 2020 2020 6461 7465 5f66 6f72          date_for
+0003b480: 5f6c 6173 745f 696d 6167 6520 3d20 2744  _last_image = 'D
+0003b490: 4154 455f 4352 4541 5445 4427 0d0a 2020  ATE_CREATED'..  
+0003b4a0: 2020 2020 2020 6966 2068 6173 5f61 643a        if has_ad:
+0003b4b0: 2064 6174 655f 666f 725f 6c61 7374 5f69   date_for_last_i
+0003b4c0: 6d61 6765 203d 2061 7070 6c69 6564 5f64  mage = applied_d
+0003b4d0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
+0003b4e0: 7461 7267 6574 0d0a 2020 2020 2020 2020  target..        
+0003b4f0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0003b500: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0003b510: 202b 206c 696e 6b5f 7374 675f 6e61 6d65   + link_stg_name
+0003b520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0003b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b540: 2020 2752 4f57 5f4e 554d 4245 5228 2920    'ROW_NUMBER() 
+0003b550: 6f76 6572 2028 7061 7274 6974 696f 6e20  over (partition 
+0003b560: 6279 2027 202b 2068 6173 685f 6e61 6d65  by ' + hash_name
+0003b570: 202b 2027 204f 5244 4552 2042 5920 2720   + ' ORDER BY ' 
+0003b580: 2b20 6461 7465 5f66 6f72 5f6c 6173 745f  + date_for_last_
+0003b590: 696d 6167 6520 2b20 2720 6465 7363 2927  image + ' desc)'
+0003b5a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0003b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b5c0: 2020 7072 6566 6978 5f65 7420 2b20 6c69    prefix_et + li
+0003b5d0: 6e6b 5f73 7467 5f6c 6173 745f 696d 6167  nk_stg_last_imag
+0003b5e0: 655f 6e61 6d65 2c20 2752 4e27 2c0d 0a20  e_name, 'RN',.. 
+0003b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b600: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0003b610: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
+0003b620: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0003b630: 6f73 6974 696f 6e2c 2069 6e74 6567 6572  osition, integer
+0003b640: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
+0003b650: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0003b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b670: 2020 696e 7465 6765 725f 666f 725f 6d65    integer_for_me
+0003b680: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
 0003b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b6a0: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
-0003b6b0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-0003b6c0: 2031 2c20 4b45 595f 5459 5045 5f4e 554c   1, KEY_TYPE_NUL
-0003b6d0: 4c2c 2031 2c20 7365 6c66 2e6f 776e 6572  L, 1, self.owner
-0003b6e0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-0003b6f0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0003b700: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0003b710: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0003b720: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0003b730: 290d 0a20 2020 2020 2020 206f 7264 696e  )..        ordin
-0003b740: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0003b750: 0d0a 0d0a 2020 2020 2020 2020 6966 2068  ....        if h
-0003b760: 6173 5f72 733a 0d0a 2020 2020 2020 2020  as_rs:..        
-0003b770: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0003b780: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-0003b790: 785f 6574 202b 206c 696e 6b5f 7374 675f  x_et + link_stg_
-0003b7a0: 6c61 7374 5f69 6d61 6765 5f6e 616d 652c  last_image_name,
-0003b7b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b7d0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
-0003b7e0: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
-0003b7f0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0003b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b810: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0003b820: 785f 6574 202b 206c 696e 6b5f 6e61 6d65  x_et + link_name
-0003b830: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0003b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b850: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-0003b860: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-0003b870: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-0003b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b890: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-0003b8a0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-0003b8b0: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
-0003b8c0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
-0003b8d0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
-0003b8e0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-0003b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b6a0: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+0003b6b0: 595f 5459 5045 5f4e 554c 4c2c 2031 2c20  Y_TYPE_NULL, 1, 
+0003b6c0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0003b6d0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0003b6e0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+0003b6f0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+0003b700: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+0003b710: 745f 6d61 7070 696e 675d 290d 0a20 2020  t_mapping])..   
+0003b720: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0003b730: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0003b740: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+0003b750: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003b760: 2323 2046 696e 616c 204c 494e 4b20 2323  ## Final LINK ##
+0003b770: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003b780: 2323 2323 2323 2323 0d0a 0d0a 2020 2020  ########....    
+0003b790: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0003b7a0: 7469 6f6e 203d 2031 0d0a 2020 2020 2020  tion = 1..      
+0003b7b0: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
+0003b7c0: 6174 6120 3d20 7365 6c66 2e63 6f6e 6e65  ata = self.conne
+0003b7d0: 6374 696f 6e2e 6765 745f 6861 7368 5f66  ction.get_hash_f
+0003b7e0: 6f72 5f6d 6574 6164 6174 6128 290d 0a20  or_metadata().. 
+0003b7f0: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
+0003b800: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
+0003b810: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f73  efix_et + link_s
+0003b820: 7467 5f6c 6173 745f 696d 6167 655f 6e61  tg_last_image_na
+0003b830: 6d65 2c20 6861 7368 5f6e 616d 652c 2070  me, hash_name, p
+0003b840: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+0003b850: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+0003b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b870: 2020 2020 2020 6861 7368 5f6e 616d 652c        hash_name,
+0003b880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b8a0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+0003b8b0: 7461 5b30 5d2c 206f 7264 696e 616c 5f70  ta[0], ordinal_p
+0003b8c0: 6f73 6974 696f 6e2c 2068 6173 685f 666f  osition, hash_fo
+0003b8d0: 725f 6d65 7461 6461 7461 5b31 5d2c 2068  r_metadata[1], h
+0003b8e0: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
+0003b8f0: 5b32 5d2c 2031 2c0d 0a20 2020 2020 2020  [2], 1,..       
 0003b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b910: 2072 6563 6f72 645f 736f 7572 6365 2e63   record_source.c
-0003b920: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-0003b930: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b950: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-0003b960: 5f52 4543 4f52 445f 534f 5552 4345 2c20  _RECORD_SOURCE, 
-0003b970: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0003b980: 2020 2020 2020 2020 2020 2020 6f72 6469              ordi
-0003b990: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-0003b9a0: 310d 0a20 2020 2020 2020 2020 2020 2073  1..            s
-0003b9b0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0003b9c0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0003b9d0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0003b9e0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0003b9f0: 696e 675d 290d 0a0d 0a20 2020 2020 2020  ing])....       
-0003ba00: 2069 6620 6861 735f 6164 3a0d 0a20 2020   if has_ad:..   
-0003ba10: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-0003ba20: 6173 6574 5f6d 6170 7069 6e67 203d 205b  aset_mapping = [
-0003ba30: 7072 6566 6978 5f65 7420 2b20 6c69 6e6b  prefix_et + link
-0003ba40: 5f73 7467 5f6c 6173 745f 696d 6167 655f  _stg_last_image_
-0003ba50: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-0003ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ba70: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-0003ba80: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
-0003ba90: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-0003baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bab0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0003bac0: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-0003bad0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+0003b910: 2020 2020 2020 2020 4b45 595f 5459 5045          KEY_TYPE
+0003b920: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
+0003b930: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0003b940: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0003b950: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+0003b960: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+0003b970: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+0003b980: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+0003b990: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0003b9a0: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+0003b9b0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+0003b9c0: 6d65 7461 6461 7461 203d 2073 656c 662e  metadata = self.
+0003b9d0: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
+0003b9e0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+0003b9f0: 6174 6128 290d 0a20 2020 2020 2020 206e  ata()..        n
+0003ba00: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0003ba10: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
+0003ba20: 2b20 6c69 6e6b 5f73 7467 5f6c 6173 745f  + link_stg_last_
+0003ba30: 696d 6167 655f 6e61 6d65 2c20 2744 4154  image_name, 'DAT
+0003ba40: 455f 4352 4541 5445 4427 2c20 7072 6566  E_CREATED', pref
+0003ba50: 6978 5f65 7420 2b20 6c69 6e6b 5f6e 616d  ix_et + link_nam
+0003ba60: 652c 2027 4441 5445 5f43 5245 4154 4544  e, 'DATE_CREATED
+0003ba70: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+0003ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ba90: 2020 2073 7973 6461 7465 5f66 6f72 5f6d     sysdate_for_m
+0003baa0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+0003bab0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7379  nal_position, sy
+0003bac0: 7364 6174 655f 666f 725f 6d65 7461 6461  sdate_for_metada
+0003bad0: 7461 5b31 5d2c 0d0a 2020 2020 2020 2020  ta[1],..        
 0003bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003baf0: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-0003bb00: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
-0003bb10: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-0003bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bb30: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0003bb40: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-0003bb50: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-0003bb60: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0003bb70: 2c20 6170 706c 6965 645f 6461 7465 2e63  , applied_date.c
-0003bb80: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
-0003bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bbb0: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-0003bbc0: 6f6c 756d 6e5f 7072 6563 6973 696f 6e2c  olumn_precision,
-0003bbd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bbf0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-0003bc00: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
-0003bc10: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0003bc20: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-0003bc30: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-0003bc40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0003bc50: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0003bc60: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0003bc70: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0003bc80: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0003bc90: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0003bca0: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
-0003bcb0: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
-0003bcc0: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
-0003bcd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003bce0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0003bcf0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0003bd00: 6574 202b 206c 696e 6b5f 7374 675f 6c61  et + link_stg_la
-0003bd10: 7374 5f69 6d61 6765 5f6e 616d 652c 2074  st_image_name, t
-0003bd20: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-0003bd30: 7267 6574 2c20 7072 6566 6978 5f65 7420  rget, prefix_et 
-0003bd40: 2b20 6c69 6e6b 5f6e 616d 652c 0d0a 2020  + link_name,..  
+0003baf0: 2020 2020 2020 2073 7973 6461 7465 5f66         sysdate_f
+0003bb00: 6f72 5f6d 6574 6164 6174 615b 325d 2c20  or_metadata[2], 
+0003bb10: 312c 204b 4559 5f54 5950 455f 4e55 4c4c  1, KEY_TYPE_NULL
+0003bb20: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+0003bb30: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+0003bb40: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0003bb50: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0003bb60: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0003bb70: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0003bb80: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
+0003bb90: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+0003bba0: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
+0003bbb0: 735f 7273 3a0d 0a20 2020 2020 2020 2020  s_rs:..         
+0003bbc0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0003bbd0: 6170 7069 6e67 203d 205b 7072 6566 6978  apping = [prefix
+0003bbe0: 5f65 7420 2b20 6c69 6e6b 5f73 7467 5f6c  _et + link_stg_l
+0003bbf0: 6173 745f 696d 6167 655f 6e61 6d65 2c0d  ast_image_name,.
+0003bc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc20: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
+0003bc30: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
+0003bc40: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0003bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bc60: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0003bc70: 5f65 7420 2b20 6c69 6e6b 5f6e 616d 652c  _et + link_name,
+0003bc80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bca0: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+0003bcb0: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
+0003bcc0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0003bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bce0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+0003bcf0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+0003bd00: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+0003bd10: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
+0003bd20: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+0003bd30: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+0003bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bd70: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
-0003bd80: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+0003bd60: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+0003bd70: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+0003bd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0003bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bdb0: 2020 2020 746e 2e63 6f6c 756d 6e5f 7479      tn.column_ty
-0003bdc0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-0003bdd0: 616c 5f70 6f73 6974 696f 6e2c 2074 6e2e  al_position, tn.
-0003bde0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-0003bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003be10: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-0003be20: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-0003be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003be50: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-0003be60: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
-0003be70: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-0003be80: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0003be90: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0003bea0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0003beb0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0003bec0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0003bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bee0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0003bef0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-0003bf00: 2069 6620 6861 735f 7365 713a 0d0a 2020   if has_seq:..  
-0003bf10: 2020 2020 2020 2020 2020 666f 7220 7365            for se
-0003bf20: 7120 696e 2073 6571 5f73 6f75 7263 653a  q in seq_source:
-0003bf30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003bf40: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0003bf50: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0003bf60: 6574 202b 206c 696e 6b5f 7374 675f 6c61  et + link_stg_la
-0003bf70: 7374 5f69 6d61 6765 5f6e 616d 652c 2073  st_image_name, s
-0003bf80: 6571 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  eq.column_name_t
-0003bf90: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-0003bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bfb0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0003bfc0: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
-0003bfd0: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+0003bda0: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+0003bdb0: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
+0003bdc0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0003bdd0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+0003bde0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+0003bdf0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0003be00: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0003be10: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+0003be20: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+0003be30: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0003be40: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+0003be50: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
+0003be60: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0003be70: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+0003be80: 7265 6669 785f 6574 202b 206c 696e 6b5f  refix_et + link_
+0003be90: 7374 675f 6c61 7374 5f69 6d61 6765 5f6e  stg_last_image_n
+0003bea0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0003beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bec0: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+0003bed0: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
+0003bee0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+0003bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf00: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003bf10: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f6e  efix_et + link_n
+0003bf20: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0003bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf40: 2020 2020 2020 2020 2061 7070 6c69 6564           applied
+0003bf50: 5f64 6174 652e 636f 6c75 6d6e 5f6e 616d  _date.column_nam
+0003bf60: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+0003bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf80: 2020 2020 2020 2020 2020 2020 2020 6170                ap
+0003bf90: 706c 6965 645f 6461 7465 2e63 6f6c 756d  plied_date.colum
+0003bfa0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+0003bfb0: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+0003bfc0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+0003bfd0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
 0003bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bff0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003c000: 712e 636f 6c75 6d6e 5f6e 616d 655f 7461  q.column_name_ta
-0003c010: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-0003c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c030: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003c040: 712e 636f 6c75 6d6e 5f74 7970 655f 7461  q.column_type_ta
-0003c050: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-0003c060: 7369 7469 6f6e 2c20 7365 712e 636f 6c75  sition, seq.colu
-0003c070: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-0003c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c0a0: 2020 2073 6571 2e63 6f6c 756d 6e5f 7072     seq.column_pr
-0003c0b0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-0003c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c0e0: 2031 2c20 4b45 595f 5459 5045 5f53 4551   1, KEY_TYPE_SEQ
-0003c0f0: 5545 4e43 452c 2031 2c20 7365 6c66 2e6f  UENCE, 1, self.o
-0003c100: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0003c110: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0003c120: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-0003c130: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0003c140: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0003c150: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-0003c160: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-0003c170: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0003c180: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-0003c190: 666f 7220 6e75 6d5f 636f 6e20 696e 2072  for num_con in r
-0003c1a0: 616e 6765 2831 2c20 6e75 6d5f 636f 6e6e  ange(1, num_conn
-0003c1b0: 6563 7469 6f6e 7320 2b20 3129 3a0d 0a20  ections + 1):.. 
-0003c1c0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0003c1d0: 6e61 6d65 5f68 7562 203d 2027 4841 5348  name_hub = 'HASH
-0003c1e0: 5f27 202b 2073 7472 286e 756d 5f63 6f6e  _' + str(num_con
-0003c1f0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-0003c200: 765f 7072 6f70 6572 7479 203d 2073 656c  v_property = sel
-0003c210: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0003c220: 6c2e 6765 745f 6476 5f70 726f 7065 7274  l.get_dv_propert
-0003c230: 6965 735f 6672 6f6d 5f63 6f64 5f65 6e74  ies_from_cod_ent
-0003c240: 6974 795f 616e 645f 6e75 6d5f 636f 6e6e  ity_and_num_conn
-0003c250: 6563 7469 6f6e 286c 696e 6b2e 636f 645f  ection(link.cod_
-0003c260: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-0003c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c000: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+0003c010: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+0003c020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c040: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+0003c050: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
+0003c060: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+0003c070: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+0003c080: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+0003c090: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003c0a0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003c0b0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0003c0c0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0003c0d0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0003c0e0: 675d 290d 0a0d 0a20 2020 2020 2020 2069  g])....        i
+0003c0f0: 6620 6861 735f 746e 3a0d 0a20 2020 2020  f has_tn:..     
+0003c100: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
+0003c110: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
+0003c120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c130: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0003c140: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0003c150: 7420 2b20 6c69 6e6b 5f73 7467 5f6c 6173  t + link_stg_las
+0003c160: 745f 696d 6167 655f 6e61 6d65 2c20 746e  t_image_name, tn
+0003c170: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0003c180: 6765 742c 2070 7265 6669 785f 6574 202b  get, prefix_et +
+0003c190: 206c 696e 6b5f 6e61 6d65 2c0d 0a20 2020   link_name,..   
+0003c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c1c0: 2020 2020 746e 2e63 6f6c 756d 6e5f 6e61      tn.column_na
+0003c1d0: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
+0003c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c200: 2020 2074 6e2e 636f 6c75 6d6e 5f74 7970     tn.column_typ
+0003c210: 655f 7461 7267 6574 2c20 6f72 6469 6e61  e_target, ordina
+0003c220: 6c5f 706f 7369 7469 6f6e 2c20 746e 2e63  l_position, tn.c
+0003c230: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+0003c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c260: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+0003c270: 7072 6563 6973 696f 6e2c 0d0a 2020 2020  precision,..    
 0003c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c2c0: 2020 2020 2020 2020 2020 2020 206e 756d               num
-0003c2d0: 5f63 6f6e 290d 0a20 2020 2020 2020 2020  _con)..         
-0003c2e0: 2020 2069 6620 6476 5f70 726f 7065 7274     if dv_propert
-0003c2f0: 7920 6973 206e 6f74 204e 6f6e 653a 2068  y is not None: h
-0003c300: 6173 685f 6e61 6d65 5f68 7562 203d 2064  ash_name_hub = d
-0003c310: 765f 7072 6f70 6572 7479 2e68 6173 685f  v_property.hash_
-0003c320: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-0003c330: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-0003c340: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-0003c350: 6574 202b 206c 696e 6b5f 7374 675f 6c61  et + link_stg_la
-0003c360: 7374 5f69 6d61 6765 5f6e 616d 652c 2068  st_image_name, h
-0003c370: 6173 685f 6e61 6d65 5f68 7562 2c20 7072  ash_name_hub, pr
-0003c380: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f6e  efix_et + link_n
-0003c390: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-0003c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c3b0: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
-0003c3c0: 6d65 5f68 7562 2c0d 0a20 2020 2020 2020  me_hub,..       
-0003c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c3e0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-0003c3f0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-0003c400: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0003c410: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
-0003c420: 6164 6174 615b 315d 2c0d 0a20 2020 2020  adata[1],..     
+0003c2a0: 2020 2031 2c20 4b45 595f 5459 5045 5f54     1, KEY_TYPE_T
+0003c2b0: 454e 414e 542c 2031 2c20 7365 6c66 2e6f  ENANT, 1, self.o
+0003c2c0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+0003c2d0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0003c2e0: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0003c2f0: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
+0003c300: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
+0003c310: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
+0003c320: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0003c330: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+0003c340: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
+0003c350: 6966 2068 6173 5f73 6571 3a0d 0a20 2020  if has_seq:..   
+0003c360: 2020 2020 2020 2020 2066 6f72 2073 6571           for seq
+0003c370: 2069 6e20 7365 715f 736f 7572 6365 3a0d   in seq_source:.
+0003c380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c390: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0003c3a0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0003c3b0: 7420 2b20 6c69 6e6b 5f73 7467 5f6c 6173  t + link_stg_las
+0003c3c0: 745f 696d 6167 655f 6e61 6d65 2c20 7365  t_image_name, se
+0003c3d0: 712e 636f 6c75 6d6e 5f6e 616d 655f 7461  q.column_name_ta
+0003c3e0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0003c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c400: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003c410: 6566 6978 5f65 7420 2b20 6c69 6e6b 5f6e  efix_et + link_n
+0003c420: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
 0003c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c440: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-0003c450: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0003c460: 325d 2c0d 0a20 2020 2020 2020 2020 2020  2],..           
+0003c440: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0003c450: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+0003c460: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
 0003c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c480: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
-0003c490: 5950 455f 4841 5348 5f4b 4559 2c20 312c  YPE_HASH_KEY, 1,
-0003c4a0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0003c4b0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-0003c4c0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-0003c4d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003c4e0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0003c4f0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-0003c500: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-0003c510: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0003c520: 675d 290d 0a0d 0a20 2020 2020 2020 206e  g])....        n
-0003c530: 6577 5f66 696c 7465 7220 3d20 5b70 7265  ew_filter = [pre
-0003c540: 6669 785f 6574 202b 206c 696e 6b5f 6e61  fix_et + link_na
-0003c550: 6d65 2c20 2252 4e20 3d20 3122 2c20 312c  me, "RN = 1", 1,
-0003c560: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0003c570: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-0003c580: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-0003c590: 6e74 7279 5f66 696c 7465 7273 285b 6e65  ntry_filters([ne
-0003c5a0: 775f 6669 6c74 6572 5d29 0d0a 0d0a 2020  w_filter])....  
-0003c5b0: 2020 2020 2020 7365 6c66 2e6c 6f67 2e6c        self.log.l
-0003c5c0: 6f67 2873 656c 662e 656e 6769 6e65 5f6e  og(self.engine_n
-0003c5d0: 616d 652c 2022 4669 6e69 7368 6564 2074  ame, "Finished t
-0003c5e0: 6f20 7072 6f63 6573 7320 4d65 7461 6461  o process Metada
-0003c5f0: 7461 205b 204c 696e 6b20 6465 6669 6e69  ta [ Link defini
-0003c600: 7469 6f6e 205d 2069 6e66 6f72 6d61 7469  tion ] informati
-0003c610: 6f6e 222c 204c 4f47 5f4c 4556 454c 5f4f  on", LOG_LEVEL_O
-0003c620: 4e4c 595f 4c4f 4729 0d0a 0d0a 2020 2020  NLY_LOG)....    
-0003c630: 6465 6620 7072 6f63 6573 735f 6476 5f6c  def process_dv_l
-0003c640: 696e 6b5f 6372 6561 7469 6f6e 5f73 6174  ink_creation_sat
-0003c650: 2873 656c 662c 206c 696e 6b29 3a0d 0a20  (self, link):.. 
-0003c660: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
-0003c670: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
-0003c680: 6e61 6d65 2c20 2253 7461 7274 696e 6720  name, "Starting 
-0003c690: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
-0003c6a0: 6174 6120 5b20 4c69 6e6b 2073 6174 656c  ata [ Link satel
-0003c6b0: 6c69 7465 7320 5d20 696e 666f 726d 6174  lites ] informat
-0003c6c0: 696f 6e22 2c20 4c4f 475f 4c45 5645 4c5f  ion", LOG_LEVEL_
-0003c6d0: 4f4e 4c59 5f4c 4f47 290d 0a20 2020 2020  ONLY_LOG)..     
-0003c6e0: 2020 2061 6c6c 5f73 6174 656c 6c69 7465     all_satellite
-0003c6f0: 7320 3d20 7365 6c66 2e6d 6574 6164 6174  s = self.metadat
-0003c700: 615f 6163 7475 616c 2e67 6574 5f61 6c6c  a_actual.get_all
-0003c710: 5f73 6174 656c 6c69 7465 735f 696e 666f  _satellites_info
-0003c720: 5f66 726f 6d5f 6875 6228 6c69 6e6b 2e63  _from_hub(link.c
-0003c730: 6f64 5f65 6e74 6974 7929 0d0a 2020 2020  od_entity)..    
-0003c740: 2020 2020 2320 5341 543a 2063 6f64 5f65      # SAT: cod_e
-0003c750: 6e74 6974 795f 736f 7572 6365 207c 2063  ntity_source | c
-0003c760: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-0003c770: 207c 2073 6174 656c 6c69 7465 5f6e 616d   | satellite_nam
-0003c780: 6520 7c20 6e75 6d5f 6272 616e 6368 207c  e | num_branch |
-0003c790: 206f 7269 6769 6e5f 6973 5f69 6e63 7265   origin_is_incre
-0003c7a0: 6d65 6e74 616c 207c 206f 7269 6769 6e5f  mental | origin_
-0003c7b0: 6973 5f74 6f74 616c 207c 206f 7269 6769  is_total | origi
-0003c7c0: 6e5f 6973 5f63 6463 0d0a 2020 2020 2020  n_is_cdc..      
-0003c7d0: 2020 666f 7220 7361 7420 696e 2061 6c6c    for sat in all
-0003c7e0: 5f73 6174 656c 6c69 7465 733a 0d0a 2020  _satellites:..  
-0003c7f0: 2020 2020 2020 2020 2020 6966 2069 6e74            if int
-0003c800: 2873 6174 5b36 5d29 203d 3d20 303a 0d0a  (sat[6]) == 0:..
-0003c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c820: 7365 6c66 2e70 726f 6365 7373 5f64 765f  self.process_dv_
-0003c830: 6c69 6e6b 5f63 7265 6174 696f 6e5f 7361  link_creation_sa
-0003c840: 745f 6e6f 6e5f 6364 6328 6c69 6e6b 2c20  t_non_cdc(link, 
-0003c850: 7361 7429 0d0a 2020 2020 2020 2020 2020  sat)..          
-0003c860: 2020 656c 6966 2069 6e74 2873 6174 5b36    elif int(sat[6
-0003c870: 5d29 203d 3d20 313a 0d0a 2020 2020 2020  ]) == 1:..      
-0003c880: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0003c890: 726f 6365 7373 5f64 765f 6c69 6e6b 5f63  rocess_dv_link_c
-0003c8a0: 7265 6174 696f 6e5f 7361 745f 6364 6328  reation_sat_cdc(
-0003c8b0: 6c69 6e6b 2c20 7361 7429 0d0a 0d0a 2020  link, sat)....  
-0003c8c0: 2020 2020 2020 7365 6c66 2e6c 6f67 2e6c        self.log.l
-0003c8d0: 6f67 2873 656c 662e 656e 6769 6e65 5f6e  og(self.engine_n
-0003c8e0: 616d 652c 2022 4669 6e69 7368 6564 2074  ame, "Finished t
-0003c8f0: 6f20 7072 6f63 6573 7320 4d65 7461 6461  o process Metada
-0003c900: 7461 205b 204c 696e 6b20 7361 7465 6c6c  ta [ Link satell
-0003c910: 6974 6573 205d 2069 6e66 6f72 6d61 7469  ites ] informati
-0003c920: 6f6e 222c 204c 4f47 5f4c 4556 454c 5f4f  on", LOG_LEVEL_O
-0003c930: 4e4c 595f 4c4f 4729 0d0a 0d0a 2020 2020  NLY_LOG)....    
-0003c940: 6465 6620 7072 6f63 6573 735f 6476 5f6c  def process_dv_l
-0003c950: 696e 6b5f 6372 6561 7469 6f6e 5f73 6174  ink_creation_sat
-0003c960: 5f6e 6f6e 5f63 6463 2873 656c 662c 206c  _non_cdc(self, l
-0003c970: 696e 6b2c 2073 6174 293a 0d0a 2020 2020  ink, sat):..    
-0003c980: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
-0003c990: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
-0003c9a0: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
-0003c9b0: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
-0003c9c0: 205b 204c 696e 6b20 7361 7465 6c6c 6974   [ Link satellit
-0003c9d0: 6573 202d 206e 6f6e 2063 6463 205d 2069  es - non cdc ] i
-0003c9e0: 6e66 6f72 6d61 7469 6f6e 222c 204c 4f47  nformation", LOG
-0003c9f0: 5f4c 4556 454c 5f4f 4e4c 595f 4c4f 4729  _LEVEL_ONLY_LOG)
-0003ca00: 0d0a 0d0a 2020 2020 2020 2020 6f72 6469  ....        ordi
-0003ca10: 6e61 6c5f 706f 7369 7469 6f6e 203d 2031  nal_position = 1
-0003ca20: 0d0a 2020 2020 2020 2020 7072 6566 6978  ..        prefix
-0003ca30: 5f65 7420 3d20 2745 545f 270d 0a20 2020  _et = 'ET_'..   
-0003ca40: 2020 2020 2073 6174 5f63 6f64 5f65 6e74       sat_cod_ent
-0003ca50: 6974 795f 736f 7572 6365 203d 2073 6174  ity_source = sat
-0003ca60: 5b30 5d0d 0a20 2020 2020 2020 2073 6174  [0]..        sat
-0003ca70: 5f63 6f64 5f65 6e74 6974 795f 7461 7267  _cod_entity_targ
-0003ca80: 6574 203d 2073 6174 5b31 5d0d 0a20 2020  et = sat[1]..   
-0003ca90: 2020 2020 2073 6174 5f6e 616d 6520 3d20       sat_name = 
-0003caa0: 7361 745b 325d 0d0a 2020 2020 2020 2020  sat[2]..        
-0003cab0: 7361 745f 6e75 6d5f 6272 616e 6368 203d  sat_num_branch =
-0003cac0: 2031 2023 2053 6174 2063 616e 2774 2068   1 # Sat can't h
-0003cad0: 6176 6520 6d6f 7265 2074 6861 6e20 6f6e  ave more than on
-0003cae0: 6520 6272 616e 6368 202d 3e20 7361 745b  e branch -> sat[
-0003caf0: 335d 0d0a 0d0a 2020 2020 2020 2020 6861  3]....        ha
-0003cb00: 7368 5f6e 616d 6520 3d20 2748 4153 485f  sh_name = 'HASH_
-0003cb10: 2720 2b20 6c69 6e6b 2e65 6e74 6974 795f  ' + link.entity_
-0003cb20: 6e61 6d65 0d0a 2020 2020 2020 2020 6476  name..        dv
-0003cb30: 5f70 726f 7065 7274 7920 3d20 7365 6c66  _property = self
-0003cb40: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003cb50: 2e67 6574 5f64 765f 7072 6f70 6572 7469  .get_dv_properti
-0003cb60: 6573 5f66 726f 6d5f 636f 645f 656e 7469  es_from_cod_enti
-0003cb70: 7479 5f61 6e64 5f6e 756d 5f63 6f6e 6e65  ty_and_num_conne
-0003cb80: 6374 696f 6e28 6c69 6e6b 2e63 6f64 5f65  ction(link.cod_e
-0003cb90: 6e74 6974 792c 2030 290d 0a20 2020 2020  ntity, 0)..     
-0003cba0: 2020 2069 6620 6476 5f70 726f 7065 7274     if dv_propert
-0003cbb0: 7920 6973 206e 6f74 204e 6f6e 653a 2068  y is not None: h
-0003cbc0: 6173 685f 6e61 6d65 203d 2064 765f 7072  ash_name = dv_pr
-0003cbd0: 6f70 6572 7479 2e68 6173 685f 6e61 6d65  operty.hash_name
-0003cbe0: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
-0003cbf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003cc00: 2323 2323 2323 2320 4372 6561 7465 2061  ####### Create a
-0003cc10: 6c6c 2065 6e74 6974 6965 7320 2323 2323  ll entities ####
-0003cc20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003cc30: 2323 2323 2323 230d 0a20 2020 2020 2020  #######..       
-0003cc40: 2073 6174 5f65 6e74 6974 795f 746d 7020   sat_entity_tmp 
-0003cc50: 3d20 2753 5447 5f54 4d50 5f27 202b 2073  = 'STG_TMP_' + s
-0003cc60: 6174 5f6e 616d 650d 0a20 2020 2020 2020  at_name..       
-0003cc70: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
-0003cc80: 616c 5f69 6d61 6765 5f31 203d 2027 5354  al_image_1 = 'ST
-0003cc90: 475f 544d 505f 4c41 5354 5f49 4d41 4745  G_TMP_LAST_IMAGE
-0003cca0: 5f31 5f27 202b 2073 6174 5f6e 616d 650d  _1_' + sat_name.
-0003ccb0: 0a20 2020 2020 2020 2073 6174 5f65 6e74  .        sat_ent
-0003ccc0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
-0003ccd0: 5f32 203d 2027 5354 475f 544d 505f 4c41  _2 = 'STG_TMP_LA
-0003cce0: 5354 5f49 4d41 4745 5f32 5f27 202b 2073  ST_IMAGE_2_' + s
-0003ccf0: 6174 5f6e 616d 650d 0a20 2020 2020 2020  at_name..       
-0003cd00: 2073 6174 5f65 6e74 6974 795f 6a6f 696e   sat_entity_join
-0003cd10: 203d 2027 5354 475f 544d 505f 4a4f 494e   = 'STG_TMP_JOIN
-0003cd20: 5f27 202b 2073 6174 5f6e 616d 650d 0a20  _' + sat_name.. 
-0003cd30: 2020 2020 2020 2073 6174 5f65 6e74 6974         sat_entit
-0003cd40: 7920 3d20 7361 745f 6e61 6d65 0d0a 0d0a  y = sat_name....
-0003cd50: 2020 2020 2020 2020 6e65 775f 656e 7469          new_enti
-0003cd60: 7479 5f73 6174 5f65 6e74 6974 795f 746d  ty_sat_entity_tm
-0003cd70: 7020 3d20 5b70 7265 6669 785f 6574 202b  p = [prefix_et +
-0003cd80: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-0003cd90: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-0003cda0: 2045 4e54 4954 595f 5749 5448 2c20 6c69   ENTITY_WITH, li
-0003cdb0: 6e6b 2e63 6f64 5f70 6174 682c 2027 272c  nk.cod_path, '',
-0003cdc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cde0: 2020 2020 2020 2073 656c 662e 6f77 6e65         self.owne
-0003cdf0: 725d 0d0a 2020 2020 2020 2020 7365 6c66  r]..        self
-0003ce00: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003ce10: 2e61 6464 5f65 6e74 7279 5f65 6e74 6974  .add_entry_entit
-0003ce20: 7928 5b6e 6577 5f65 6e74 6974 795f 7361  y([new_entity_sa
-0003ce30: 745f 656e 7469 7479 5f74 6d70 5d29 0d0a  t_entity_tmp])..
-0003ce40: 2020 2020 2020 2020 6e65 775f 656e 7469          new_enti
-0003ce50: 7479 5f73 6174 5f65 6e74 6974 795f 6163  ty_sat_entity_ac
-0003ce60: 7475 616c 5f69 6d61 6765 5f31 203d 205b  tual_image_1 = [
-0003ce70: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-0003ce80: 656e 7469 7479 5f61 6374 7561 6c5f 696d  entity_actual_im
-0003ce90: 6167 655f 312c 2073 6174 5f65 6e74 6974  age_1, sat_entit
-0003cea0: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
-0003ceb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0003cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cee0: 2020 2045 4e54 4954 595f 5749 5448 2c20     ENTITY_WITH, 
-0003cef0: 6c69 6e6b 2e63 6f64 5f70 6174 682c 2027  link.cod_path, '
-0003cf00: 272c 2073 656c 662e 6f77 6e65 725d 0d0a  ', self.owner]..
-0003cf10: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0003cf20: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0003cf30: 5f65 6e74 7279 5f65 6e74 6974 7928 5b6e  _entry_entity([n
-0003cf40: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-0003cf50: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0003cf60: 655f 315d 290d 0a20 2020 2020 2020 206e  e_1])..        n
-0003cf70: 6577 5f65 6e74 6974 795f 7361 745f 656e  ew_entity_sat_en
-0003cf80: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0003cf90: 655f 3220 3d20 5b70 7265 6669 785f 6574  e_2 = [prefix_et
-0003cfa0: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
-0003cfb0: 7475 616c 5f69 6d61 6765 5f32 2c20 7361  tual_image_2, sa
-0003cfc0: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
-0003cfd0: 696d 6167 655f 322c 0d0a 2020 2020 2020  image_2,..      
-0003cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d000: 2020 2020 2020 2020 2020 454e 5449 5459            ENTITY
-0003d010: 5f57 4954 482c 206c 696e 6b2e 636f 645f  _WITH, link.cod_
-0003d020: 7061 7468 2c20 2727 2c20 7365 6c66 2e6f  path, '', self.o
-0003d030: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-0003d040: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0003d050: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
-0003d060: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
-0003d070: 5f73 6174 5f65 6e74 6974 795f 6163 7475  _sat_entity_actu
-0003d080: 616c 5f69 6d61 6765 5f32 5d29 0d0a 2020  al_image_2])..  
-0003d090: 2020 2020 2020 6e65 775f 656e 7469 7479        new_entity
-0003d0a0: 5f73 6174 5f65 6e74 6974 795f 6a6f 696e  _sat_entity_join
-0003d0b0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0003d0c0: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
-0003d0d0: 2073 6174 5f65 6e74 6974 795f 6a6f 696e   sat_entity_join
-0003d0e0: 2c20 454e 5449 5459 5f57 4954 482c 206c  , ENTITY_WITH, l
-0003d0f0: 696e 6b2e 636f 645f 7061 7468 2c20 2727  ink.cod_path, ''
-0003d100: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0003d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d120: 2020 2020 2020 2020 2073 656c 662e 6f77           self.ow
-0003d130: 6e65 725d 0d0a 2020 2020 2020 2020 7365  ner]..        se
-0003d140: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0003d150: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
-0003d160: 6974 7928 5b6e 6577 5f65 6e74 6974 795f  ity([new_entity_
-0003d170: 7361 745f 656e 7469 7479 5f6a 6f69 6e5d  sat_entity_join]
-0003d180: 290d 0a20 2020 2020 2020 206e 6577 5f65  )..        new_e
-0003d190: 6e74 6974 795f 7361 745f 656e 7469 7479  ntity_sat_entity
-0003d1a0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
-0003d1b0: 7361 745f 656e 7469 7479 2c20 7361 745f  sat_entity, sat_
-0003d1c0: 656e 7469 7479 2c20 454e 5449 5459 5f54  entity, ENTITY_T
-0003d1d0: 422c 206c 696e 6b2e 636f 645f 7061 7468  B, link.cod_path
-0003d1e0: 2c20 2749 4e53 4552 5427 2c20 7365 6c66  , 'INSERT', self
-0003d1f0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-0003d200: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0003d210: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0003d220: 656e 7469 7479 285b 6e65 775f 656e 7469  entity([new_enti
-0003d230: 7479 5f73 6174 5f65 6e74 6974 795d 290d  ty_sat_entity]).
-0003d240: 0a0d 0a20 2020 2020 2020 2068 6173 5f72  ...        has_r
-0003d250: 7320 3d20 4661 6c73 650d 0a20 2020 2020  s = False..     
-0003d260: 2020 2068 6173 5f74 6e20 3d20 4661 6c73     has_tn = Fals
-0003d270: 650d 0a20 2020 2020 2020 2068 6173 5f61  e..        has_a
-0003d280: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
-0003d290: 2020 2068 6173 5f64 636b 203d 2046 616c     has_dck = Fal
-0003d2a0: 7365 0d0a 2020 2020 2020 2020 7265 636f  se..        reco
-0003d2b0: 7264 5f73 6f75 7263 6520 3d20 7365 6c66  rd_source = self
-0003d2c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003d2d0: 2e67 6574 5f72 6563 6f72 645f 736f 7572  .get_record_sour
-0003d2e0: 6365 5f6f 6e5f 6476 5f66 726f 6d5f 636f  ce_on_dv_from_co
-0003d2f0: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
-0003d300: 616e 645f 6e75 6d5f 6272 616e 6368 2873  and_num_branch(s
-0003d310: 6174 5f63 6f64 5f65 6e74 6974 795f 7461  at_cod_entity_ta
-0003d320: 7267 6574 2c20 7361 745f 6e75 6d5f 6272  rget, sat_num_br
-0003d330: 616e 6368 290d 0a20 2020 2020 2020 2069  anch)..        i
-0003d340: 6620 7265 636f 7264 5f73 6f75 7263 6520  f record_source 
-0003d350: 6973 206e 6f74 204e 6f6e 653a 2068 6173  is not None: has
-0003d360: 5f72 7320 3d20 5472 7565 0d0a 2020 2020  _rs = True..    
-0003d370: 2020 2020 7465 6e61 6e74 5f73 6f75 7263      tenant_sourc
-0003d380: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-0003d390: 615f 6163 7475 616c 2e67 6574 5f74 656e  a_actual.get_ten
-0003d3a0: 616e 745f 6f6e 5f64 765f 6672 6f6d 5f63  ant_on_dv_from_c
-0003d3b0: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-0003d3c0: 5f61 6e64 5f6e 756d 5f62 7261 6e63 6828  _and_num_branch(
-0003d3d0: 7361 745f 636f 645f 656e 7469 7479 5f74  sat_cod_entity_t
-0003d3e0: 6172 6765 742c 2073 6174 5f6e 756d 5f62  arget, sat_num_b
-0003d3f0: 7261 6e63 6829 0d0a 2020 2020 2020 2020  ranch)..        
-0003d400: 6966 206c 656e 2874 656e 616e 745f 736f  if len(tenant_so
-0003d410: 7572 6365 2920 213d 2030 3a0d 0a20 2020  urce) != 0:..   
-0003d420: 2020 2020 2020 2020 2068 6173 5f74 6e20           has_tn 
-0003d430: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0003d440: 2020 2020 2320 4765 7420 6469 7374 696e      # Get distin
-0003d450: 6374 2066 726f 6d20 5445 4e41 4e54 530d  ct from TENANTS.
-0003d460: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
-0003d470: 616c 5f74 656e 616e 745f 6c69 7374 203d  al_tenant_list =
-0003d480: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
-0003d490: 2066 6f72 2074 6e20 696e 2074 656e 616e   for tn in tenan
-0003d4a0: 745f 736f 7572 6365 3a0d 0a20 2020 2020  t_source:..     
-0003d4b0: 2020 2020 2020 2020 2020 2069 6620 746e             if tn
-0003d4c0: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0003d4d0: 6765 7420 6e6f 7420 696e 205b 782e 636f  get not in [x.co
-0003d4e0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-0003d4f0: 2066 6f72 2078 2069 6e0d 0a20 2020 2020   for x in..     
-0003d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d520: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
-0003d530: 6c5f 7465 6e61 6e74 5f6c 6973 745d 3a20  l_tenant_list]: 
-0003d540: 6669 6e61 6c5f 7465 6e61 6e74 5f6c 6973  final_tenant_lis
-0003d550: 742e 6170 7065 6e64 2874 6e29 0d0a 2020  t.append(tn)..  
-0003d560: 2020 2020 2020 2020 2020 7465 6e61 6e74            tenant
-0003d570: 5f73 6f75 7263 6520 3d20 6669 6e61 6c5f  _source = final_
-0003d580: 7465 6e61 6e74 5f6c 6973 740d 0a20 2020  tenant_list..   
-0003d590: 2020 2020 2064 6570 656e 6465 6e74 5f63       dependent_c
-0003d5a0: 6869 6c64 5f6b 6579 203d 2073 656c 662e  hild_key = self.
-0003d5b0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0003d5c0: 6765 745f 6465 7065 6e64 656e 745f 6368  get_dependent_ch
-0003d5d0: 696c 645f 6b65 795f 6f6e 5f64 765f 6672  ild_key_on_dv_fr
-0003d5e0: 6f6d 5f73 6174 656c 6c69 7465 5f6e 616d  om_satellite_nam
-0003d5f0: 6528 7361 745f 6e61 6d65 290d 0a20 2020  e(sat_name)..   
-0003d600: 2020 2020 2069 6620 6c65 6e28 6465 7065       if len(depe
-0003d610: 6e64 656e 745f 6368 696c 645f 6b65 7929  ndent_child_key)
-0003d620: 2021 3d20 303a 2068 6173 5f64 636b 203d   != 0: has_dck =
-0003d630: 2054 7275 650d 0a20 2020 2020 2020 2061   True..        a
-0003d640: 7070 6c69 6564 5f64 6174 6520 3d20 7365  pplied_date = se
-0003d650: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0003d660: 616c 2e67 6574 5f61 7070 6c69 6564 5f64  al.get_applied_d
-0003d670: 6174 655f 6f6e 5f64 765f 6672 6f6d 5f63  ate_on_dv_from_c
-0003d680: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-0003d690: 286c 696e 6b2e 636f 645f 656e 7469 7479  (link.cod_entity
-0003d6a0: 2c20 7361 745b 335d 290d 0a20 2020 2020  , sat[3])..     
-0003d6b0: 2020 2069 6620 6170 706c 6965 645f 6461     if applied_da
-0003d6c0: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a20  te is not None: 
-0003d6d0: 6861 735f 6164 203d 2054 7275 650d 0a0d  has_ad = True...
-0003d6e0: 0a20 2020 2020 2020 2068 6173 685f 666f  .        hash_fo
-0003d6f0: 725f 6d65 7461 6461 7461 203d 2073 656c  r_metadata = sel
-0003d700: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
-0003d710: 5f68 6173 685f 666f 725f 6d65 7461 6461  _hash_for_metada
-0003d720: 7461 2829 0d0a 2020 2020 2020 2020 696e  ta()..        in
-0003d730: 7465 6765 725f 666f 725f 6d65 7461 6461  teger_for_metada
-0003d740: 7461 203d 2073 656c 662e 636f 6e6e 6563  ta = self.connec
-0003d750: 7469 6f6e 2e67 6574 5f69 6e74 6567 6572  tion.get_integer
-0003d760: 5f66 6f72 5f6d 6574 6164 6174 6128 290d  _for_metadata().
-0003d770: 0a0d 0a20 2020 2020 2020 2023 2323 2323  ...        #####
-0003d780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003d790: 2323 2323 2323 2043 7265 6174 6520 456e  ###### Create En
-0003d7a0: 7469 7479 2053 5447 2054 4d50 2023 2323  tity STG TMP ###
-0003d7b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003d7c0: 2323 2323 2323 2323 0d0a 2020 2020 2020  ########..      
-0003d7d0: 2020 6d64 355f 6675 6e63 7469 6f6e 203d    md5_function =
-0003d7e0: 2073 656c 662e 6765 745f 6861 7368 5f6b   self.get_hash_k
-0003d7f0: 6579 5f66 726f 6d5f 636f 645f 656e 7469  ey_from_cod_enti
-0003d800: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
-0003d810: 6d5f 6272 616e 6368 2873 6174 5f63 6f64  m_branch(sat_cod
-0003d820: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
-0003d830: 7361 745b 335d 290d 0a20 2020 2020 2020  sat[3])..       
-0003d840: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-0003d850: 7069 6e67 203d 205b 7361 745f 636f 645f  ping = [sat_cod_
-0003d860: 656e 7469 7479 5f73 6f75 7263 652c 206d  entity_source, m
-0003d870: 6435 5f66 756e 6374 696f 6e2c 2070 7265  d5_function, pre
-0003d880: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-0003d890: 6974 795f 746d 702c 0d0a 2020 2020 2020  ity_tmp,..      
-0003d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d8b0: 2020 2020 2020 2020 2068 6173 685f 6e61           hash_na
-0003d8c0: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
-0003d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d8e0: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-0003d8f0: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-0003d900: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
-0003d910: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-0003d920: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0003d930: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
-0003d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d950: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
-0003d960: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-0003d970: 5f48 4153 485f 4b45 592c 2031 2c20 7365  _HASH_KEY, 1, se
-0003d980: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0003d990: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0003d9a0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-0003d9b0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0003d9c0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0003d9d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003d9e0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0003d9f0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0003da00: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-0003da10: 6d65 7461 6461 7461 203d 2073 656c 662e  metadata = self.
-0003da20: 636f 6e6e 6563 7469 6f6e 2e67 6574 5f73  connection.get_s
-0003da30: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0003da40: 6174 6128 290d 0a20 2020 2020 2020 206e  ata()..        n
-0003da50: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-0003da60: 6e67 203d 205b 2727 2c20 7365 6c66 2e63  ng = ['', self.c
-0003da70: 6f6e 6e65 6374 696f 6e2e 6765 745f 7379  onnection.get_sy
-0003da80: 7364 6174 655f 7661 6c75 6528 292c 2070  sdate_value(), p
-0003da90: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0003daa0: 6e74 6974 795f 746d 702c 0d0a 2020 2020  ntity_tmp,..    
-0003dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dac0: 2020 2020 2020 2020 2020 2027 4441 5445             'DATE
-0003dad0: 5f43 5245 4154 4544 272c 0d0a 2020 2020  _CREATED',..    
-0003dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003daf0: 2020 2020 2020 2020 2020 2073 7973 6461             sysda
-0003db00: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
-0003db10: 305d 2c20 6f72 6469 6e61 6c5f 706f 7369  0], ordinal_posi
-0003db20: 7469 6f6e 2c20 7379 7364 6174 655f 666f  tion, sysdate_fo
-0003db30: 725f 6d65 7461 6461 7461 5b31 5d2c 0d0a  r_metadata[1],..
-0003db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003db50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003db60: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-0003db70: 6174 615b 325d 2c20 7361 745f 6e75 6d5f  ata[2], sat_num_
-0003db80: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-0003db90: 5f4e 554c 4c2c 2031 2c20 7365 6c66 2e6f  _NULL, 1, self.o
-0003dba0: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-0003dbb0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0003dbc0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0003dbd0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0003dbe0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0003dbf0: 696e 675d 290d 0a20 2020 2020 2020 206f  ing])..        o
-0003dc00: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0003dc10: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-0003dc20: 6966 2068 6173 5f72 733a 0d0a 2020 2020  if has_rs:..    
-0003dc30: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-0003dc40: 7365 745f 6d61 7070 696e 6720 3d20 5b73  set_mapping = [s
-0003dc50: 6174 5f63 6f64 5f65 6e74 6974 795f 736f  at_cod_entity_so
-0003dc60: 7572 6365 2c20 7265 636f 7264 5f73 6f75  urce, record_sou
-0003dc70: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-0003dc80: 736f 7572 6365 2c0d 0a20 2020 2020 2020  source,..       
-0003dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dca0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0003dcb0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0003dcc0: 7479 5f74 6d70 2c0d 0a20 2020 2020 2020  ty_tmp,..       
-0003dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dce0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-0003dcf0: 7264 5f73 6f75 7263 652e 636f 6c75 6d6e  rd_source.column
-0003dd00: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-0003dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c480: 2020 2020 2020 2020 2020 2020 2073 6571               seq
+0003c490: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+0003c4a0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+0003c4b0: 6974 696f 6e2c 2073 6571 2e63 6f6c 756d  ition, seq.colum
+0003c4c0: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
+0003c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c4f0: 2020 7365 712e 636f 6c75 6d6e 5f70 7265    seq.column_pre
+0003c500: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0003c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c530: 312c 204b 4559 5f54 5950 455f 5345 5155  1, KEY_TYPE_SEQU
+0003c540: 454e 4345 2c20 312c 2073 656c 662e 6f77  ENCE, 1, self.ow
+0003c550: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
+0003c560: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0003c570: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0003c580: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003c590: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003c5a0: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0003c5b0: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0003c5c0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0003c5d0: 675d 290d 0a0d 0a20 2020 2020 2020 2066  g])....        f
+0003c5e0: 6f72 206e 756d 5f63 6f6e 2069 6e20 7261  or num_con in ra
+0003c5f0: 6e67 6528 312c 206e 756d 5f63 6f6e 6e65  nge(1, num_conne
+0003c600: 6374 696f 6e73 202b 2031 293a 0d0a 2020  ctions + 1):..  
+0003c610: 2020 2020 2020 2020 2020 6861 7368 5f6e            hash_n
+0003c620: 616d 655f 6875 6220 3d20 2748 4153 485f  ame_hub = 'HASH_
+0003c630: 2720 2b20 7374 7228 6e75 6d5f 636f 6e29  ' + str(num_con)
+0003c640: 0d0a 2020 2020 2020 2020 2020 2020 6476  ..            dv
+0003c650: 5f70 726f 7065 7274 7920 3d20 7365 6c66  _property = self
+0003c660: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0003c670: 2e67 6574 5f64 765f 7072 6f70 6572 7469  .get_dv_properti
+0003c680: 6573 5f66 726f 6d5f 636f 645f 656e 7469  es_from_cod_enti
+0003c690: 7479 5f61 6e64 5f6e 756d 5f63 6f6e 6e65  ty_and_num_conne
+0003c6a0: 6374 696f 6e28 6c69 6e6b 2e63 6f64 5f65  ction(link.cod_e
+0003c6b0: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
+0003c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c710: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+0003c720: 636f 6e29 0d0a 2020 2020 2020 2020 2020  con)..          
+0003c730: 2020 6966 2064 765f 7072 6f70 6572 7479    if dv_property
+0003c740: 2069 7320 6e6f 7420 4e6f 6e65 3a20 6861   is not None: ha
+0003c750: 7368 5f6e 616d 655f 6875 6220 3d20 6476  sh_name_hub = dv
+0003c760: 5f70 726f 7065 7274 792e 6861 7368 5f6e  _property.hash_n
+0003c770: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
+0003c780: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0003c790: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+0003c7a0: 7420 2b20 6c69 6e6b 5f73 7467 5f6c 6173  t + link_stg_las
+0003c7b0: 745f 696d 6167 655f 6e61 6d65 2c20 6861  t_image_name, ha
+0003c7c0: 7368 5f6e 616d 655f 6875 622c 2070 7265  sh_name_hub, pre
+0003c7d0: 6669 785f 6574 202b 206c 696e 6b5f 6e61  fix_et + link_na
+0003c7e0: 6d65 2c0d 0a20 2020 2020 2020 2020 2020  me,..           
+0003c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c800: 2020 2020 2020 2020 6861 7368 5f6e 616d          hash_nam
+0003c810: 655f 6875 622c 0d0a 2020 2020 2020 2020  e_hub,..        
+0003c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c830: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+0003c840: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
+0003c850: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0003c860: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
+0003c870: 6461 7461 5b31 5d2c 0d0a 2020 2020 2020  data[1],..      
+0003c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c890: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0003c8a0: 685f 666f 725f 6d65 7461 6461 7461 5b32  h_for_metadata[2
+0003c8b0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0003c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c8d0: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+0003c8e0: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
+0003c8f0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0003c900: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
+0003c910: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0003c920: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003c930: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0003c940: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0003c950: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0003c960: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0003c970: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
+0003c980: 775f 6669 6c74 6572 203d 205b 7072 6566  w_filter = [pref
+0003c990: 6978 5f65 7420 2b20 6c69 6e6b 5f6e 616d  ix_et + link_nam
+0003c9a0: 652c 2022 524e 203d 2031 222c 2031 2c20  e, "RN = 1", 1, 
+0003c9b0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0003c9c0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0003c9d0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+0003c9e0: 7472 795f 6669 6c74 6572 7328 5b6e 6577  try_filters([new
+0003c9f0: 5f66 696c 7465 725d 290d 0a0d 0a20 2020  _filter])....   
+0003ca00: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
+0003ca10: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
+0003ca20: 6d65 2c20 2246 696e 6973 6865 6420 746f  me, "Finished to
+0003ca30: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
+0003ca40: 6120 5b20 4c69 6e6b 2064 6566 696e 6974  a [ Link definit
+0003ca50: 696f 6e20 5d20 696e 666f 726d 6174 696f  ion ] informatio
+0003ca60: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
+0003ca70: 4c59 5f4c 4f47 290d 0a0d 0a20 2020 2064  LY_LOG)....    d
+0003ca80: 6566 2070 726f 6365 7373 5f64 765f 6c69  ef process_dv_li
+0003ca90: 6e6b 5f63 7265 6174 696f 6e5f 7361 7428  nk_creation_sat(
+0003caa0: 7365 6c66 2c20 6c69 6e6b 293a 0d0a 2020  self, link):..  
+0003cab0: 2020 2020 2020 7365 6c66 2e6c 6f67 2e6c        self.log.l
+0003cac0: 6f67 2873 656c 662e 656e 6769 6e65 5f6e  og(self.engine_n
+0003cad0: 616d 652c 2022 5374 6172 7469 6e67 2074  ame, "Starting t
+0003cae0: 6f20 7072 6f63 6573 7320 4d65 7461 6461  o process Metada
+0003caf0: 7461 205b 204c 696e 6b20 7361 7465 6c6c  ta [ Link satell
+0003cb00: 6974 6573 205d 2069 6e66 6f72 6d61 7469  ites ] informati
+0003cb10: 6f6e 222c 204c 4f47 5f4c 4556 454c 5f4f  on", LOG_LEVEL_O
+0003cb20: 4e4c 595f 4c4f 4729 0d0a 2020 2020 2020  NLY_LOG)..      
+0003cb30: 2020 616c 6c5f 7361 7465 6c6c 6974 6573    all_satellites
+0003cb40: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+0003cb50: 5f61 6374 7561 6c2e 6765 745f 616c 6c5f  _actual.get_all_
+0003cb60: 7361 7465 6c6c 6974 6573 5f69 6e66 6f5f  satellites_info_
+0003cb70: 6672 6f6d 5f68 7562 286c 696e 6b2e 636f  from_hub(link.co
+0003cb80: 645f 656e 7469 7479 290d 0a20 2020 2020  d_entity)..     
+0003cb90: 2020 2023 2053 4154 3a20 636f 645f 656e     # SAT: cod_en
+0003cba0: 7469 7479 5f73 6f75 7263 6520 7c20 636f  tity_source | co
+0003cbb0: 645f 656e 7469 7479 5f74 6172 6765 7420  d_entity_target 
+0003cbc0: 7c20 7361 7465 6c6c 6974 655f 6e61 6d65  | satellite_name
+0003cbd0: 207c 206e 756d 5f62 7261 6e63 6820 7c20   | num_branch | 
+0003cbe0: 6f72 6967 696e 5f69 735f 696e 6372 656d  origin_is_increm
+0003cbf0: 656e 7461 6c20 7c20 6f72 6967 696e 5f69  ental | origin_i
+0003cc00: 735f 746f 7461 6c20 7c20 6f72 6967 696e  s_total | origin
+0003cc10: 5f69 735f 6364 630d 0a20 2020 2020 2020  _is_cdc..       
+0003cc20: 2066 6f72 2073 6174 2069 6e20 616c 6c5f   for sat in all_
+0003cc30: 7361 7465 6c6c 6974 6573 3a0d 0a20 2020  satellites:..   
+0003cc40: 2020 2020 2020 2020 2069 6620 696e 7428           if int(
+0003cc50: 7361 745b 365d 2920 3d3d 2030 3a0d 0a20  sat[6]) == 0:.. 
+0003cc60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003cc70: 656c 662e 7072 6f63 6573 735f 6476 5f6c  elf.process_dv_l
+0003cc80: 696e 6b5f 6372 6561 7469 6f6e 5f73 6174  ink_creation_sat
+0003cc90: 5f6e 6f6e 5f63 6463 286c 696e 6b2c 2073  _non_cdc(link, s
+0003cca0: 6174 290d 0a20 2020 2020 2020 2020 2020  at)..           
+0003ccb0: 2065 6c69 6620 696e 7428 7361 745b 365d   elif int(sat[6]
+0003ccc0: 2920 3d3d 2031 3a0d 0a20 2020 2020 2020  ) == 1:..       
+0003ccd0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0003cce0: 6f63 6573 735f 6476 5f6c 696e 6b5f 6372  ocess_dv_link_cr
+0003ccf0: 6561 7469 6f6e 5f73 6174 5f63 6463 286c  eation_sat_cdc(l
+0003cd00: 696e 6b2c 2073 6174 290d 0a0d 0a20 2020  ink, sat)....   
+0003cd10: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
+0003cd20: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
+0003cd30: 6d65 2c20 2246 696e 6973 6865 6420 746f  me, "Finished to
+0003cd40: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
+0003cd50: 6120 5b20 4c69 6e6b 2073 6174 656c 6c69  a [ Link satelli
+0003cd60: 7465 7320 5d20 696e 666f 726d 6174 696f  tes ] informatio
+0003cd70: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
+0003cd80: 4c59 5f4c 4f47 290d 0a0d 0a20 2020 2064  LY_LOG)....    d
+0003cd90: 6566 2070 726f 6365 7373 5f64 765f 6c69  ef process_dv_li
+0003cda0: 6e6b 5f63 7265 6174 696f 6e5f 7361 745f  nk_creation_sat_
+0003cdb0: 6e6f 6e5f 6364 6328 7365 6c66 2c20 6c69  non_cdc(self, li
+0003cdc0: 6e6b 2c20 7361 7429 3a0d 0a20 2020 2020  nk, sat):..     
+0003cdd0: 2020 2073 656c 662e 6c6f 672e 6c6f 6728     self.log.log(
+0003cde0: 7365 6c66 2e65 6e67 696e 655f 6e61 6d65  self.engine_name
+0003cdf0: 2c20 2253 7461 7274 696e 6720 746f 2070  , "Starting to p
+0003ce00: 726f 6365 7373 204d 6574 6164 6174 6120  rocess Metadata 
+0003ce10: 5b20 4c69 6e6b 2073 6174 656c 6c69 7465  [ Link satellite
+0003ce20: 7320 2d20 6e6f 6e20 6364 6320 5d20 696e  s - non cdc ] in
+0003ce30: 666f 726d 6174 696f 6e22 2c20 4c4f 475f  formation", LOG_
+0003ce40: 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47 290d  LEVEL_ONLY_LOG).
+0003ce50: 0a0d 0a20 2020 2020 2020 206f 7264 696e  ...        ordin
+0003ce60: 616c 5f70 6f73 6974 696f 6e20 3d20 310d  al_position = 1.
+0003ce70: 0a20 2020 2020 2020 2070 7265 6669 785f  .        prefix_
+0003ce80: 6574 203d 2027 4554 5f27 0d0a 2020 2020  et = 'ET_'..    
+0003ce90: 2020 2020 7361 745f 636f 645f 656e 7469      sat_cod_enti
+0003cea0: 7479 5f73 6f75 7263 6520 3d20 7361 745b  ty_source = sat[
+0003ceb0: 305d 0d0a 2020 2020 2020 2020 7361 745f  0]..        sat_
+0003cec0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+0003ced0: 7420 3d20 7361 745b 315d 0d0a 2020 2020  t = sat[1]..    
+0003cee0: 2020 2020 7361 745f 6e61 6d65 203d 2073      sat_name = s
+0003cef0: 6174 5b32 5d0d 0a20 2020 2020 2020 2073  at[2]..        s
+0003cf00: 6174 5f6e 756d 5f62 7261 6e63 6820 3d20  at_num_branch = 
+0003cf10: 3120 2320 5361 7420 6361 6e27 7420 6861  1 # Sat can't ha
+0003cf20: 7665 206d 6f72 6520 7468 616e 206f 6e65  ve more than one
+0003cf30: 2062 7261 6e63 6820 2d3e 2073 6174 5b33   branch -> sat[3
+0003cf40: 5d0d 0a0d 0a20 2020 2020 2020 2068 6173  ]....        has
+0003cf50: 685f 6e61 6d65 203d 2027 4841 5348 5f27  h_name = 'HASH_'
+0003cf60: 202b 206c 696e 6b2e 656e 7469 7479 5f6e   + link.entity_n
+0003cf70: 616d 650d 0a20 2020 2020 2020 2064 765f  ame..        dv_
+0003cf80: 7072 6f70 6572 7479 203d 2073 656c 662e  property = self.
+0003cf90: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003cfa0: 6765 745f 6476 5f70 726f 7065 7274 6965  get_dv_propertie
+0003cfb0: 735f 6672 6f6d 5f63 6f64 5f65 6e74 6974  s_from_cod_entit
+0003cfc0: 795f 616e 645f 6e75 6d5f 636f 6e6e 6563  y_and_num_connec
+0003cfd0: 7469 6f6e 286c 696e 6b2e 636f 645f 656e  tion(link.cod_en
+0003cfe0: 7469 7479 2c20 3029 0d0a 2020 2020 2020  tity, 0)..      
+0003cff0: 2020 6966 2064 765f 7072 6f70 6572 7479    if dv_property
+0003d000: 2069 7320 6e6f 7420 4e6f 6e65 3a20 6861   is not None: ha
+0003d010: 7368 5f6e 616d 6520 3d20 6476 5f70 726f  sh_name = dv_pro
+0003d020: 7065 7274 792e 6861 7368 5f6e 616d 650d  perty.hash_name.
+0003d030: 0a0d 0a20 2020 2020 2020 2023 2323 2323  ...        #####
+0003d040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003d050: 2323 2323 2323 2043 7265 6174 6520 616c  ###### Create al
+0003d060: 6c20 656e 7469 7469 6573 2023 2323 2323  l entities #####
+0003d070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003d080: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
+0003d090: 7361 745f 656e 7469 7479 5f74 6d70 203d  sat_entity_tmp =
+0003d0a0: 2027 5354 475f 544d 505f 2720 2b20 7361   'STG_TMP_' + sa
+0003d0b0: 745f 6e61 6d65 0d0a 2020 2020 2020 2020  t_name..        
+0003d0c0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+0003d0d0: 6c5f 696d 6167 655f 3120 3d20 2753 5447  l_image_1 = 'STG
+0003d0e0: 5f54 4d50 5f4c 4153 545f 494d 4147 455f  _TMP_LAST_IMAGE_
+0003d0f0: 315f 2720 2b20 7361 745f 6e61 6d65 0d0a  1_' + sat_name..
+0003d100: 2020 2020 2020 2020 7361 745f 656e 7469          sat_enti
+0003d110: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+0003d120: 3220 3d20 2753 5447 5f54 4d50 5f4c 4153  2 = 'STG_TMP_LAS
+0003d130: 545f 494d 4147 455f 325f 2720 2b20 7361  T_IMAGE_2_' + sa
+0003d140: 745f 6e61 6d65 0d0a 2020 2020 2020 2020  t_name..        
+0003d150: 7361 745f 656e 7469 7479 5f6a 6f69 6e20  sat_entity_join 
+0003d160: 3d20 2753 5447 5f54 4d50 5f4a 4f49 4e5f  = 'STG_TMP_JOIN_
+0003d170: 2720 2b20 7361 745f 6e61 6d65 0d0a 2020  ' + sat_name..  
+0003d180: 2020 2020 2020 7361 745f 656e 7469 7479        sat_entity
+0003d190: 203d 2073 6174 5f6e 616d 650d 0a0d 0a20   = sat_name.... 
+0003d1a0: 2020 2020 2020 206e 6577 5f65 6e74 6974         new_entit
+0003d1b0: 795f 7361 745f 656e 7469 7479 5f74 6d70  y_sat_entity_tmp
+0003d1c0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+0003d1d0: 7361 745f 656e 7469 7479 5f74 6d70 2c20  sat_entity_tmp, 
+0003d1e0: 7361 745f 656e 7469 7479 5f74 6d70 2c20  sat_entity_tmp, 
+0003d1f0: 454e 5449 5459 5f57 4954 482c 206c 696e  ENTITY_WITH, lin
+0003d200: 6b2e 636f 645f 7061 7468 2c20 2727 2c0d  k.cod_path, '',.
+0003d210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d230: 2020 2020 2020 7365 6c66 2e6f 776e 6572        self.owner
+0003d240: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+0003d250: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003d260: 6164 645f 656e 7472 795f 656e 7469 7479  add_entry_entity
+0003d270: 285b 6e65 775f 656e 7469 7479 5f73 6174  ([new_entity_sat
+0003d280: 5f65 6e74 6974 795f 746d 705d 290d 0a20  _entity_tmp]).. 
+0003d290: 2020 2020 2020 206e 6577 5f65 6e74 6974         new_entit
+0003d2a0: 795f 7361 745f 656e 7469 7479 5f61 6374  y_sat_entity_act
+0003d2b0: 7561 6c5f 696d 6167 655f 3120 3d20 5b70  ual_image_1 = [p
+0003d2c0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+0003d2d0: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
+0003d2e0: 6765 5f31 2c20 7361 745f 656e 7469 7479  ge_1, sat_entity
+0003d2f0: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
+0003d300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d330: 2020 454e 5449 5459 5f57 4954 482c 206c    ENTITY_WITH, l
+0003d340: 696e 6b2e 636f 645f 7061 7468 2c20 2727  ink.cod_path, ''
+0003d350: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+0003d360: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0003d370: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
+0003d380: 656e 7472 795f 656e 7469 7479 285b 6e65  entry_entity([ne
+0003d390: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+0003d3a0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+0003d3b0: 5f31 5d29 0d0a 2020 2020 2020 2020 6e65  _1])..        ne
+0003d3c0: 775f 656e 7469 7479 5f73 6174 5f65 6e74  w_entity_sat_ent
+0003d3d0: 6974 795f 6163 7475 616c 5f69 6d61 6765  ity_actual_image
+0003d3e0: 5f32 203d 205b 7072 6566 6978 5f65 7420  _2 = [prefix_et 
+0003d3f0: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
+0003d400: 7561 6c5f 696d 6167 655f 322c 2073 6174  ual_image_2, sat
+0003d410: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
+0003d420: 6d61 6765 5f32 2c0d 0a20 2020 2020 2020  mage_2,..       
+0003d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d450: 2020 2020 2020 2020 2045 4e54 4954 595f           ENTITY_
+0003d460: 5749 5448 2c20 6c69 6e6b 2e63 6f64 5f70  WITH, link.cod_p
+0003d470: 6174 682c 2027 272c 2073 656c 662e 6f77  ath, '', self.ow
+0003d480: 6e65 725d 0d0a 2020 2020 2020 2020 7365  ner]..        se
+0003d490: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0003d4a0: 616c 2e61 6464 5f65 6e74 7279 5f65 6e74  al.add_entry_ent
+0003d4b0: 6974 7928 5b6e 6577 5f65 6e74 6974 795f  ity([new_entity_
+0003d4c0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+0003d4d0: 6c5f 696d 6167 655f 325d 290d 0a20 2020  l_image_2])..   
+0003d4e0: 2020 2020 206e 6577 5f65 6e74 6974 795f       new_entity_
+0003d4f0: 7361 745f 656e 7469 7479 5f6a 6f69 6e20  sat_entity_join 
+0003d500: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0003d510: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
+0003d520: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
+0003d530: 2045 4e54 4954 595f 5749 5448 2c20 6c69   ENTITY_WITH, li
+0003d540: 6e6b 2e63 6f64 5f70 6174 682c 2027 272c  nk.cod_path, '',
+0003d550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d570: 2020 2020 2020 2020 7365 6c66 2e6f 776e          self.own
+0003d580: 6572 5d0d 0a20 2020 2020 2020 2073 656c  er]..        sel
+0003d590: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003d5a0: 6c2e 6164 645f 656e 7472 795f 656e 7469  l.add_entry_enti
+0003d5b0: 7479 285b 6e65 775f 656e 7469 7479 5f73  ty([new_entity_s
+0003d5c0: 6174 5f65 6e74 6974 795f 6a6f 696e 5d29  at_entity_join])
+0003d5d0: 0d0a 2020 2020 2020 2020 6e65 775f 656e  ..        new_en
+0003d5e0: 7469 7479 5f73 6174 5f65 6e74 6974 7920  tity_sat_entity 
+0003d5f0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0003d600: 6174 5f65 6e74 6974 792c 2073 6174 5f65  at_entity, sat_e
+0003d610: 6e74 6974 792c 2045 4e54 4954 595f 5442  ntity, ENTITY_TB
+0003d620: 2c20 6c69 6e6b 2e63 6f64 5f70 6174 682c  , link.cod_path,
+0003d630: 2027 494e 5345 5254 272c 2073 656c 662e   'INSERT', self.
+0003d640: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+0003d650: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0003d660: 7475 616c 2e61 6464 5f65 6e74 7279 5f65  tual.add_entry_e
+0003d670: 6e74 6974 7928 5b6e 6577 5f65 6e74 6974  ntity([new_entit
+0003d680: 795f 7361 745f 656e 7469 7479 5d29 0d0a  y_sat_entity])..
+0003d690: 0d0a 2020 2020 2020 2020 6861 735f 7273  ..        has_rs
+0003d6a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0003d6b0: 2020 6861 735f 746e 203d 2046 616c 7365    has_tn = False
+0003d6c0: 0d0a 2020 2020 2020 2020 6861 735f 6164  ..        has_ad
+0003d6d0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0003d6e0: 2020 6861 735f 6463 6b20 3d20 4661 6c73    has_dck = Fals
+0003d6f0: 650d 0a20 2020 2020 2020 2072 6563 6f72  e..        recor
+0003d700: 645f 736f 7572 6365 203d 2073 656c 662e  d_source = self.
+0003d710: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003d720: 6765 745f 7265 636f 7264 5f73 6f75 7263  get_record_sourc
+0003d730: 655f 6f6e 5f64 765f 6672 6f6d 5f63 6f64  e_on_dv_from_cod
+0003d740: 5f65 6e74 6974 795f 7461 7267 6574 5f61  _entity_target_a
+0003d750: 6e64 5f6e 756d 5f62 7261 6e63 6828 7361  nd_num_branch(sa
+0003d760: 745f 636f 645f 656e 7469 7479 5f74 6172  t_cod_entity_tar
+0003d770: 6765 742c 2073 6174 5f6e 756d 5f62 7261  get, sat_num_bra
+0003d780: 6e63 6829 0d0a 2020 2020 2020 2020 6966  nch)..        if
+0003d790: 2072 6563 6f72 645f 736f 7572 6365 2069   record_source i
+0003d7a0: 7320 6e6f 7420 4e6f 6e65 3a20 6861 735f  s not None: has_
+0003d7b0: 7273 203d 2054 7275 650d 0a20 2020 2020  rs = True..     
+0003d7c0: 2020 2074 656e 616e 745f 736f 7572 6365     tenant_source
+0003d7d0: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+0003d7e0: 5f61 6374 7561 6c2e 6765 745f 7465 6e61  _actual.get_tena
+0003d7f0: 6e74 5f6f 6e5f 6476 5f66 726f 6d5f 636f  nt_on_dv_from_co
+0003d800: 645f 656e 7469 7479 5f74 6172 6765 745f  d_entity_target_
+0003d810: 616e 645f 6e75 6d5f 6272 616e 6368 2873  and_num_branch(s
+0003d820: 6174 5f63 6f64 5f65 6e74 6974 795f 7461  at_cod_entity_ta
+0003d830: 7267 6574 2c20 7361 745f 6e75 6d5f 6272  rget, sat_num_br
+0003d840: 616e 6368 290d 0a20 2020 2020 2020 2069  anch)..        i
+0003d850: 6620 6c65 6e28 7465 6e61 6e74 5f73 6f75  f len(tenant_sou
+0003d860: 7263 6529 2021 3d20 303a 0d0a 2020 2020  rce) != 0:..    
+0003d870: 2020 2020 2020 2020 6861 735f 746e 203d          has_tn =
+0003d880: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+0003d890: 2020 2023 2047 6574 2064 6973 7469 6e63     # Get distinc
+0003d8a0: 7420 6672 6f6d 2054 454e 414e 5453 0d0a  t from TENANTS..
+0003d8b0: 2020 2020 2020 2020 2020 2020 6669 6e61              fina
+0003d8c0: 6c5f 7465 6e61 6e74 5f6c 6973 7420 3d20  l_tenant_list = 
+0003d8d0: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
+0003d8e0: 666f 7220 746e 2069 6e20 7465 6e61 6e74  for tn in tenant
+0003d8f0: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
+0003d900: 2020 2020 2020 2020 2020 6966 2074 6e2e            if tn.
+0003d910: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+0003d920: 6574 206e 6f74 2069 6e20 5b78 2e63 6f6c  et not in [x.col
+0003d930: 756d 6e5f 6e61 6d65 5f74 6172 6765 7420  umn_name_target 
+0003d940: 666f 7220 7820 696e 0d0a 2020 2020 2020  for x in..      
+0003d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d970: 2020 2020 2020 2020 2020 2066 696e 616c             final
+0003d980: 5f74 656e 616e 745f 6c69 7374 5d3a 2066  _tenant_list]: f
+0003d990: 696e 616c 5f74 656e 616e 745f 6c69 7374  inal_tenant_list
+0003d9a0: 2e61 7070 656e 6428 746e 290d 0a20 2020  .append(tn)..   
+0003d9b0: 2020 2020 2020 2020 2074 656e 616e 745f           tenant_
+0003d9c0: 736f 7572 6365 203d 2066 696e 616c 5f74  source = final_t
+0003d9d0: 656e 616e 745f 6c69 7374 0d0a 2020 2020  enant_list..    
+0003d9e0: 2020 2020 6465 7065 6e64 656e 745f 6368      dependent_ch
+0003d9f0: 696c 645f 6b65 7920 3d20 7365 6c66 2e6d  ild_key = self.m
+0003da00: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0003da10: 6574 5f64 6570 656e 6465 6e74 5f63 6869  et_dependent_chi
+0003da20: 6c64 5f6b 6579 5f6f 6e5f 6476 5f66 726f  ld_key_on_dv_fro
+0003da30: 6d5f 7361 7465 6c6c 6974 655f 6e61 6d65  m_satellite_name
+0003da40: 2873 6174 5f6e 616d 6529 0d0a 2020 2020  (sat_name)..    
+0003da50: 2020 2020 6966 206c 656e 2864 6570 656e      if len(depen
+0003da60: 6465 6e74 5f63 6869 6c64 5f6b 6579 2920  dent_child_key) 
+0003da70: 213d 2030 3a20 6861 735f 6463 6b20 3d20  != 0: has_dck = 
+0003da80: 5472 7565 0d0a 2020 2020 2020 2020 6170  True..        ap
+0003da90: 706c 6965 645f 6461 7465 203d 2073 656c  plied_date = sel
+0003daa0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003dab0: 6c2e 6765 745f 6170 706c 6965 645f 6461  l.get_applied_da
+0003dac0: 7465 5f6f 6e5f 6476 5f66 726f 6d5f 636f  te_on_dv_from_co
+0003dad0: 645f 656e 7469 7479 5f74 6172 6765 7428  d_entity_target(
+0003dae0: 6c69 6e6b 2e63 6f64 5f65 6e74 6974 792c  link.cod_entity,
+0003daf0: 2073 6174 5b33 5d29 0d0a 2020 2020 2020   sat[3])..      
+0003db00: 2020 6966 2061 7070 6c69 6564 5f64 6174    if applied_dat
+0003db10: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
+0003db20: 6173 5f61 6420 3d20 5472 7565 0d0a 0d0a  as_ad = True....
+0003db30: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+0003db40: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
+0003db50: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
+0003db60: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+0003db70: 6128 290d 0a20 2020 2020 2020 2069 6e74  a()..        int
+0003db80: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
+0003db90: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+0003dba0: 696f 6e2e 6765 745f 696e 7465 6765 725f  ion.get_integer_
+0003dbb0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+0003dbc0: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
+0003dbd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003dbe0: 2323 2323 2320 4372 6561 7465 2045 6e74  ##### Create Ent
+0003dbf0: 6974 7920 5354 4720 544d 5020 2323 2323  ity STG TMP ####
+0003dc00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003dc10: 2323 2323 2323 230d 0a20 2020 2020 2020  #######..       
+0003dc20: 206d 6435 5f66 756e 6374 696f 6e20 3d20   md5_function = 
+0003dc30: 7365 6c66 2e67 6574 5f68 6173 685f 6b65  self.get_hash_ke
+0003dc40: 795f 6672 6f6d 5f63 6f64 5f65 6e74 6974  y_from_cod_entit
+0003dc50: 795f 7461 7267 6574 5f61 6e64 5f6e 756d  y_target_and_num
+0003dc60: 5f62 7261 6e63 6828 7361 745f 636f 645f  _branch(sat_cod_
+0003dc70: 656e 7469 7479 5f74 6172 6765 742c 2073  entity_target, s
+0003dc80: 6174 5b33 5d29 0d0a 2020 2020 2020 2020  at[3])..        
+0003dc90: 6861 7368 5f6d 6435 5f66 756e 6374 696f  hash_md5_functio
+0003dca0: 6e20 3d20 6d64 355f 6675 6e63 7469 6f6e  n = md5_function
+0003dcb0: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
+0003dcc0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+0003dcd0: 5b73 6174 5f63 6f64 5f65 6e74 6974 795f  [sat_cod_entity_
+0003dce0: 736f 7572 6365 2c20 6d64 355f 6675 6e63  source, md5_func
+0003dcf0: 7469 6f6e 2c20 7072 6566 6978 5f65 7420  tion, prefix_et 
+0003dd00: 2b20 7361 745f 656e 7469 7479 5f74 6d70  + sat_entity_tmp
+0003dd10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0003dd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dd30: 2020 7265 636f 7264 5f73 6f75 7263 652e    record_source.
-0003dd40: 636f 6c75 6d6e 5f74 7970 655f 7461 7267  column_type_targ
-0003dd50: 6574 2c20 6f72 6469 6e61 6c5f 706f 7369  et, ordinal_posi
-0003dd60: 7469 6f6e 2c20 7265 636f 7264 5f73 6f75  tion, record_sou
-0003dd70: 7263 652e 636f 6c75 6d6e 5f6c 656e 6774  rce.column_lengt
-0003dd80: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-0003dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dda0: 2020 2020 2020 2072 6563 6f72 645f 736f         record_so
-0003ddb0: 7572 6365 2e63 6f6c 756d 6e5f 7072 6563  urce.column_prec
-0003ddc0: 6973 696f 6e2c 0d0a 2020 2020 2020 2020  ision,..        
-0003ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dde0: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
-0003ddf0: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
-0003de00: 5950 455f 5245 434f 5244 5f53 4f55 5243  YPE_RECORD_SOURC
-0003de10: 452c 2031 2c20 7365 6c66 2e6f 776e 6572  E, 1, self.owner
-0003de20: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
-0003de30: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0003de40: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
-0003de50: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0003de60: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0003de70: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003de80: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0003de90: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0003dea0: 2020 2020 6966 2068 6173 5f61 643a 0d0a      if has_ad:..
-0003deb0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0003dec0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0003ded0: 3d20 5b73 6174 5f63 6f64 5f65 6e74 6974  = [sat_cod_entit
-0003dee0: 795f 736f 7572 6365 2c20 6170 706c 6965  y_source, applie
-0003def0: 645f 6461 7465 2e63 6f6c 756d 6e5f 6e61  d_date.column_na
-0003df00: 6d65 5f73 6f75 7263 652c 0d0a 2020 2020  me_source,..    
-0003df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003df20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0003df30: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0003df40: 6e74 6974 795f 746d 702c 0d0a 2020 2020  ntity_tmp,..    
-0003df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003df60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0003df70: 7070 6c69 6564 5f64 6174 652e 636f 6c75  pplied_date.colu
-0003df80: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-0003df90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dfb0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-0003dfc0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-0003dfd0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-0003dfe0: 6974 696f 6e2c 2061 7070 6c69 6564 5f64  ition, applied_d
-0003dff0: 6174 652e 636f 6c75 6d6e 5f6c 656e 6774  ate.column_lengt
-0003e000: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-0003e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e020: 2020 2020 2020 2061 7070 6c69 6564 5f64         applied_d
-0003e030: 6174 652e 636f 6c75 6d6e 5f70 7265 6369  ate.column_preci
-0003e040: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-0003e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e060: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-0003e070: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-0003e080: 5045 5f41 5050 4c49 4544 5f44 4154 452c  PE_APPLIED_DATE,
-0003e090: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0003e0a0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-0003e0b0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-0003e0c0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-0003e0d0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0003e0e0: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-0003e0f0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-0003e100: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-0003e110: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
-0003e120: 2020 6966 2068 6173 5f74 6e3a 0d0a 2020    if has_tn:..  
-0003e130: 2020 2020 2020 2020 2020 666f 7220 746e            for tn
-0003e140: 2069 6e20 7465 6e61 6e74 5f73 6f75 7263   in tenant_sourc
-0003e150: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0003e160: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0003e170: 6d61 7070 696e 6720 3d20 5b73 6174 5f63  mapping = [sat_c
-0003e180: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
-0003e190: 2c20 746e 2e63 6f6c 756d 6e5f 6e61 6d65  , tn.column_name
-0003e1a0: 5f73 6f75 7263 652c 2070 7265 6669 785f  _source, prefix_
-0003e1b0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-0003e1c0: 746d 702c 0d0a 2020 2020 2020 2020 2020  tmp,..          
-0003e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e1e0: 2020 2020 2020 2020 2020 2020 2074 6e2e               tn.
-0003e1f0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-0003e200: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
+0003dd30: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
+0003dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dd50: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0003dd60: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+0003dd70: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+0003dd80: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+0003dd90: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
+0003dda0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0003ddb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ddd0: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+0003dde0: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
+0003ddf0: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
+0003de00: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
+0003de10: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+0003de20: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+0003de30: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003de40: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0003de50: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0003de60: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0003de70: 290d 0a0d 0a20 2020 2020 2020 2073 7973  )....        sys
+0003de80: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+0003de90: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+0003dea0: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
+0003deb0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+0003dec0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0003ded0: 7365 745f 6d61 7070 696e 6720 3d20 5b27  set_mapping = ['
+0003dee0: 272c 2073 656c 662e 636f 6e6e 6563 7469  ', self.connecti
+0003def0: 6f6e 2e67 6574 5f73 7973 6461 7465 5f76  on.get_sysdate_v
+0003df00: 616c 7565 2829 2c20 7072 6566 6978 5f65  alue(), prefix_e
+0003df10: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
+0003df20: 6d70 2c0d 0a20 2020 2020 2020 2020 2020  mp,..           
+0003df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003df40: 2020 2020 2744 4154 455f 4352 4541 5445      'DATE_CREATE
+0003df50: 4427 2c0d 0a20 2020 2020 2020 2020 2020  D',..           
+0003df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003df70: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+0003df80: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
+0003df90: 696e 616c 5f70 6f73 6974 696f 6e2c 2073  inal_position, s
+0003dfa0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
+0003dfb0: 6174 615b 315d 2c0d 0a20 2020 2020 2020  ata[1],..       
+0003dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dfd0: 2020 2020 2020 2020 7379 7364 6174 655f          sysdate_
+0003dfe0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0003dff0: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+0003e000: 204b 4559 5f54 5950 455f 4e55 4c4c 2c20   KEY_TYPE_NULL, 
+0003e010: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0003e020: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0003e030: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0003e040: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0003e050: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0003e060: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0003e070: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0003e080: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
+0003e090: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
+0003e0a0: 7273 3a0d 0a20 2020 2020 2020 2020 2020  rs:..           
+0003e0b0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+0003e0c0: 7069 6e67 203d 205b 7361 745f 636f 645f  ping = [sat_cod_
+0003e0d0: 656e 7469 7479 5f73 6f75 7263 652c 2072  entity_source, r
+0003e0e0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+0003e0f0: 756d 6e5f 6e61 6d65 5f73 6f75 7263 652c  umn_name_source,
+0003e100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e120: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+0003e130: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
+0003e140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e160: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+0003e170: 6365 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  ce.column_name_t
+0003e180: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0003e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e1a0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+0003e1b0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+0003e1c0: 7479 7065 5f74 6172 6765 742c 206f 7264  type_target, ord
+0003e1d0: 696e 616c 5f70 6f73 6974 696f 6e2c 2072  inal_position, r
+0003e1e0: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
+0003e1f0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+0003e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e220: 2020 2020 2020 2020 2020 2020 746e 2e63              tn.c
-0003e230: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-0003e240: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-0003e250: 696f 6e2c 2074 6e2e 636f 6c75 6d6e 5f6c  ion, tn.column_l
-0003e260: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-0003e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e280: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0003e290: 6e2e 636f 6c75 6d6e 5f70 7265 6369 7369  n.column_precisi
-0003e2a0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-0003e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e2c0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
-0003e2d0: 4559 5f54 5950 455f 5445 4e41 4e54 2c20  EY_TYPE_TENANT, 
-0003e2e0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
-0003e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e300: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0003e310: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-0003e320: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-0003e330: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-0003e340: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
-0003e350: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
-0003e360: 706f 7369 7469 6f6e 202b 3d20 310d 0a0d  position += 1...
-0003e370: 0a20 2020 2020 2020 2069 6620 6861 735f  .        if has_
-0003e380: 6463 6b3a 0d0a 2020 2020 2020 2020 2020  dck:..          
-0003e390: 2020 666f 7220 6463 6b20 696e 2064 6570    for dck in dep
-0003e3a0: 656e 6465 6e74 5f63 6869 6c64 5f6b 6579  endent_child_key
-0003e3b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0003e3c0: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-0003e3d0: 6170 7069 6e67 203d 205b 7361 745f 636f  apping = [sat_co
-0003e3e0: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
-0003e3f0: 2064 636b 2e63 6f6c 756d 6e5f 6e61 6d65   dck.column_name
-0003e400: 5f73 6f75 7263 652c 2070 7265 6669 785f  _source, prefix_
-0003e410: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-0003e420: 746d 702c 0d0a 2020 2020 2020 2020 2020  tmp,..          
-0003e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e440: 2020 2020 2020 2020 2020 2020 2064 636b               dck
-0003e450: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0003e460: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
-0003e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e480: 2020 2020 2020 2020 2020 2020 2064 636b               dck
-0003e490: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-0003e4a0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-0003e4b0: 6974 696f 6e2c 2064 636b 2e63 6f6c 756d  ition, dck.colum
-0003e4c0: 6e5f 6c65 6e67 7468 2c0d 0a20 2020 2020  n_length,..     
+0003e220: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+0003e230: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+0003e240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e260: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
+0003e270: 6368 2c20 4b45 595f 5459 5045 5f52 4543  ch, KEY_TYPE_REC
+0003e280: 4f52 445f 534f 5552 4345 2c20 312c 2073  ORD_SOURCE, 1, s
+0003e290: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+0003e2a0: 2020 2020 2020 2020 6f72 6469 6e61 6c5f          ordinal_
+0003e2b0: 706f 7369 7469 6f6e 202b 3d20 310d 0a20  position += 1.. 
+0003e2c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003e2d0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003e2e0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0003e2f0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0003e300: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0003e310: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+0003e320: 6861 735f 6164 3a0d 0a20 2020 2020 2020  has_ad:..       
+0003e330: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+0003e340: 5f6d 6170 7069 6e67 203d 205b 7361 745f  _mapping = [sat_
+0003e350: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
+0003e360: 652c 2061 7070 6c69 6564 5f64 6174 652e  e, applied_date.
+0003e370: 636f 6c75 6d6e 5f6e 616d 655f 736f 7572  column_name_sour
+0003e380: 6365 2c0d 0a20 2020 2020 2020 2020 2020  ce,..           
+0003e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e3a0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+0003e3b0: 7420 2b20 7361 745f 656e 7469 7479 5f74  t + sat_entity_t
+0003e3c0: 6d70 2c0d 0a20 2020 2020 2020 2020 2020  mp,..           
+0003e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e3e0: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+0003e3f0: 6461 7465 2e63 6f6c 756d 6e5f 6e61 6d65  date.column_name
+0003e400: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+0003e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e420: 2020 2020 2020 2020 2020 2020 2061 7070               app
+0003e430: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+0003e440: 5f74 7970 655f 7461 7267 6574 2c20 6f72  _type_target, or
+0003e450: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+0003e460: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+0003e470: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+0003e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e4a0: 6170 706c 6965 645f 6461 7465 2e63 6f6c  applied_date.col
+0003e4b0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+0003e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e4f0: 2020 6463 6b2e 636f 6c75 6d6e 5f70 7265    dck.column_pre
-0003e500: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-0003e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e530: 312c 204b 4559 5f54 5950 455f 4445 5045  1, KEY_TYPE_DEPE
-0003e540: 4e44 454e 545f 4348 494c 445f 4b45 592c  NDENT_CHILD_KEY,
-0003e550: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0003e560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003e570: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0003e580: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
-0003e590: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
-0003e5a0: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
-0003e5b0: 7070 696e 675d 290d 0a20 2020 2020 2020  pping])..       
-0003e5c0: 2020 2020 2020 2020 206f 7264 696e 616c           ordinal
-0003e5d0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0003e5e0: 0d0a 2020 2020 2020 2020 616c 6c5f 6174  ..        all_at
-0003e5f0: 7472 6962 7574 6573 203d 2073 656c 662e  tributes = self.
-0003e600: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0003e610: 6765 745f 6174 7472 6962 7574 6573 5f6f  get_attributes_o
-0003e620: 6e5f 6476 5f66 726f 6d5f 7361 7465 6c6c  n_dv_from_satell
-0003e630: 6974 655f 6e61 6d65 2873 6174 5f65 6e74  ite_name(sat_ent
-0003e640: 6974 7929 0d0a 0d0a 2020 2020 2020 2020  ity)....        
-0003e650: 666f 7220 6174 2069 6e20 616c 6c5f 6174  for at in all_at
-0003e660: 7472 6962 7574 6573 3a0d 0a20 2020 2020  tributes:..     
-0003e670: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0003e680: 6574 5f6d 6170 7069 6e67 203d 205b 6174  et_mapping = [at
-0003e690: 2e63 6f64 5f65 6e74 6974 795f 736f 7572  .cod_entity_sour
-0003e6a0: 6365 2c20 6174 2e63 6f6c 756d 6e5f 6e61  ce, at.column_na
-0003e6b0: 6d65 5f73 6f75 7263 652c 0d0a 2020 2020  me_source,..    
-0003e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e6d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0003e6e0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-0003e6f0: 6e74 6974 795f 746d 702c 0d0a 2020 2020  ntity_tmp,..    
-0003e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e710: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0003e720: 742e 636f 6c75 6d6e 5f6e 616d 655f 7461  t.column_name_ta
-0003e730: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-0003e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e750: 2020 2020 2020 2020 2020 6174 2e63 6f6c            at.col
-0003e760: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
-0003e770: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0003e780: 6e2c 2061 742e 636f 6c75 6d6e 5f6c 656e  n, at.column_len
-0003e790: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0003e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e7b0: 2020 2020 2020 2020 2061 742e 636f 6c75           at.colu
-0003e7c0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
-0003e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e7f0: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
-0003e800: 2c20 6174 2e6b 6579 5f74 7970 652c 2031  , at.key_type, 1
-0003e810: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0003e820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003e830: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-0003e840: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-0003e850: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-0003e860: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-0003e870: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
-0003e880: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0003e890: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-0003e8a0: 6d64 355f 6675 6e63 7469 6f6e 203d 2073  md5_function = s
-0003e8b0: 656c 662e 636f 6e6e 6563 7469 6f6e 2e67  elf.connection.g
-0003e8c0: 6574 5f6d 6435 5f66 756e 6374 696f 6e28  et_md5_function(
-0003e8d0: 290d 0a20 2020 2020 2020 2063 6173 745f  )..        cast_
-0003e8e0: 746f 5f73 7472 696e 6720 3d20 7365 6c66  to_string = self
-0003e8f0: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-0003e900: 6361 7374 5f73 7472 696e 675f 666f 725f  cast_string_for_
-0003e910: 6d65 7461 6461 7461 2829 0d0a 0d0a 2020  metadata()....  
-0003e920: 2020 2020 2020 626b 5f63 6f6e 6361 7465        bk_concate
-0003e930: 6e61 7465 203d 2027 270d 0a20 2020 2020  nate = ''..     
-0003e940: 2020 2061 745f 636f 645f 656e 7469 7479     at_cod_entity
-0003e950: 5f73 6f75 7263 6520 3d20 2727 0d0a 2020  _source = ''..  
-0003e960: 2020 2020 2020 666f 7220 6174 2069 6e20        for at in 
-0003e970: 616c 6c5f 6174 7472 6962 7574 6573 3a0d  all_attributes:.
-0003e980: 0a20 2020 2020 2020 2020 2020 2062 6b5f  .            bk_
-0003e990: 6669 6e61 6c20 3d20 6361 7374 5f74 6f5f  final = cast_to_
-0003e9a0: 7374 7269 6e67 2e72 6570 6c61 6365 2827  string.replace('
-0003e9b0: 5b78 5d27 2c20 6174 2e63 6f6c 756d 6e5f  [x]', at.column_
-0003e9c0: 6e61 6d65 5f73 6f75 7263 6529 0d0a 2020  name_source)..  
-0003e9d0: 2020 2020 2020 2020 2020 626b 5f63 6f6e            bk_con
-0003e9e0: 6361 7465 6e61 7465 202b 3d20 626b 5f66  catenate += bk_f
-0003e9f0: 696e 616c 202b 2022 7c7c 2722 202b 2073  inal + "||'" + s
-0003ea00: 656c 662e 6d6f 6475 6c65 5f64 765f 6368  elf.module_dv_ch
-0003ea10: 6172 5f73 6570 6172 6174 6f72 5f6e 616d  ar_separator_nam
-0003ea20: 696e 6720 2b20 2227 7c7c 220d 0a20 2020  ing + "'||"..   
-0003ea30: 2020 2020 2062 6b5f 636f 6e63 6174 656e       bk_concaten
-0003ea40: 6174 6520 3d20 626b 5f63 6f6e 6361 7465  ate = bk_concate
-0003ea50: 6e61 7465 5b3a 2d36 202d 206c 656e 2873  nate[:-6 - len(s
-0003ea60: 656c 662e 6d6f 6475 6c65 5f64 765f 6368  elf.module_dv_ch
-0003ea70: 6172 5f73 6570 6172 6174 6f72 5f6e 616d  ar_separator_nam
-0003ea80: 696e 6729 5d0d 0a20 2020 2020 2020 2068  ing)]..        h
-0003ea90: 6173 6469 6666 203d 206d 6435 5f66 756e  asdiff = md5_fun
-0003eaa0: 6374 696f 6e2e 7265 706c 6163 6528 275b  ction.replace('[
-0003eab0: 785d 272c 2062 6b5f 636f 6e63 6174 656e  x]', bk_concaten
-0003eac0: 6174 6529 0d0a 2020 2020 2020 2020 6e65  ate)..        ne
-0003ead0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0003eae0: 6720 3d20 5b61 6c6c 5f61 7474 7269 6275  g = [all_attribu
-0003eaf0: 7465 735b 305d 2e63 6f64 5f65 6e74 6974  tes[0].cod_entit
-0003eb00: 795f 736f 7572 6365 2c20 6861 7364 6966  y_source, hasdif
-0003eb10: 662c 0d0a 2020 2020 2020 2020 2020 2020  f,..            
-0003eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003eb30: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-0003eb40: 6174 5f65 6e74 6974 795f 746d 702c 2027  at_entity_tmp, '
-0003eb50: 4841 5348 4449 4646 272c 0d0a 2020 2020  HASHDIFF',..    
-0003eb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003eb70: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0003eb80: 666f 725f 6d65 7461 6461 7461 5b30 5d2c  for_metadata[0],
-0003eb90: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-0003eba0: 6e2c 2068 6173 685f 666f 725f 6d65 7461  n, hash_for_meta
-0003ebb0: 6461 7461 5b31 5d2c 2068 6173 685f 666f  data[1], hash_fo
-0003ebc0: 725f 6d65 7461 6461 7461 5b32 5d2c 0d0a  r_metadata[2],..
-0003ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ebe0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003ebf0: 6174 5f6e 756d 5f62 7261 6e63 682c 204b  at_num_branch, K
-0003ec00: 4559 5f54 5950 455f 4841 5348 4449 4646  EY_TYPE_HASHDIFF
-0003ec10: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-0003ec20: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-0003ec30: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-0003ec40: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-0003ec50: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-0003ec60: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-0003ec70: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
-0003ec80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003ec90: 2323 2323 2323 2320 4372 6561 7465 2045  ####### Create E
-0003eca0: 6e74 6974 7920 5354 4720 4c41 5354 2049  ntity STG LAST I
-0003ecb0: 4d41 4745 2031 2023 2323 2323 2323 2323  MAGE 1 #########
-0003ecc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003ecd0: 2323 0d0a 2020 2020 2020 2020 6f72 6469  ##..        ordi
-0003ece0: 6e61 6c5f 706f 7369 7469 6f6e 203d 2031  nal_position = 1
-0003ecf0: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-0003ed00: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-0003ed10: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-0003ed20: 5f65 6e74 6974 792c 2068 6173 685f 6e61  _entity, hash_na
-0003ed30: 6d65 2c20 7072 6566 6978 5f65 7420 2b20  me, prefix_et + 
-0003ed40: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
-0003ed50: 6c5f 696d 6167 655f 312c 0d0a 2020 2020  l_image_1,..    
-0003ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ed70: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
-0003ed80: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-0003ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003eda0: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-0003edb0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-0003edc0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-0003edd0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-0003ede0: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-0003edf0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-0003ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ee10: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-0003ee20: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-0003ee30: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-0003ee40: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-0003ee50: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-0003ee60: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-0003ee70: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0003ee80: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-0003ee90: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-0003eea0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-0003eeb0: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-0003eec0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-0003eed0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-0003eee0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-0003eef0: 6974 792c 2027 4841 5348 4449 4646 272c  ity, 'HASHDIFF',
-0003ef00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef20: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0003ef30: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0003ef40: 6d61 6765 5f31 2c20 2748 4153 4844 4946  mage_1, 'HASHDIF
-0003ef50: 4627 2c0d 0a20 2020 2020 2020 2020 2020  F',..           
-0003ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ef70: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-0003ef80: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-0003ef90: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
-0003efa0: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-0003efb0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0003efc0: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
-0003efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003efe0: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
-0003eff0: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-0003f000: 5f48 4153 4844 4946 462c 2031 2c20 7365  _HASHDIFF, 1, se
-0003f010: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0003f020: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0003f030: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-0003f040: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0003f050: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0003f060: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003f070: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0003f080: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0003f090: 2020 2020 616c 6c5f 6463 6b5f 636f 6e63      all_dck_conc
-0003f0a0: 6174 656e 6174 6520 3d20 2727 0d0a 2020  atenate = ''..  
-0003f0b0: 2020 2020 2020 6966 2068 6173 5f64 636b        if has_dck
-0003f0c0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-0003f0d0: 6f72 2064 636b 2069 6e20 6465 7065 6e64  or dck in depend
-0003f0e0: 656e 745f 6368 696c 645f 6b65 793a 0d0a  ent_child_key:..
-0003f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f100: 616c 6c5f 6463 6b5f 636f 6e63 6174 656e  all_dck_concaten
-0003f110: 6174 6520 2b3d 2022 2c22 202b 2064 636b  ate += "," + dck
-0003f120: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
-0003f130: 6765 740d 0a20 2020 2020 2020 2020 2020  get..           
-0003f140: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
-0003f150: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
-0003f160: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0003f170: 7479 2c20 6463 6b2e 636f 6c75 6d6e 5f6e  ty, dck.column_n
-0003f180: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-0003f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f1b0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
-0003f1c0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
-0003f1d0: 6c5f 696d 6167 655f 312c 0d0a 2020 2020  l_image_1,..    
-0003f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f200: 2020 2064 636b 2e63 6f6c 756d 6e5f 6e61     dck.column_na
-0003f210: 6d65 5f74 6172 6765 742c 0d0a 2020 2020  me_target,..    
-0003f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f240: 2020 2064 636b 2e63 6f6c 756d 6e5f 7479     dck.column_ty
-0003f250: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-0003f260: 616c 5f70 6f73 6974 696f 6e2c 2064 636b  al_position, dck
-0003f270: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0003f280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2a0: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
-0003f2b0: 6d6e 5f70 7265 6369 7369 6f6e 2c0d 0a20  mn_precision,.. 
-0003f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2e0: 2020 2020 2020 312c 204b 4559 5f54 5950        1, KEY_TYP
-0003f2f0: 455f 4445 5045 4e44 454e 545f 4348 494c  E_DEPENDENT_CHIL
-0003f300: 445f 4b45 592c 2031 2c20 7365 6c66 2e6f  D_KEY, 1, self.o
-0003f310: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-0003f320: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0003f330: 6461 7461 5f61 6374 7561 6c2e 6164 645f  data_actual.add_
-0003f340: 656e 7472 795f 6461 7461 7365 745f 6d61  entry_dataset_ma
-0003f350: 7070 696e 6773 285b 6e65 775f 6461 7461  ppings([new_data
-0003f360: 7365 745f 6d61 7070 696e 675d 290d 0a20  set_mapping]).. 
-0003f370: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0003f380: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
-0003f390: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-0003f3a0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0003f3b0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
-0003f3c0: 202b 2073 6174 5f65 6e74 6974 792c 0d0a   + sat_entity,..
-0003f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f3e0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0003f3f0: 524f 575f 4e55 4d42 4552 2829 206f 7665  ROW_NUMBER() ove
-0003f400: 7220 2870 6172 7469 7469 6f6e 2062 7920  r (partition by 
-0003f410: 2720 2b20 6861 7368 5f6e 616d 6520 2b20  ' + hash_name + 
-0003f420: 2720 2720 2b20 616c 6c5f 6463 6b5f 636f  ' ' + all_dck_co
-0003f430: 6e63 6174 656e 6174 6520 2b20 2720 4f52  ncatenate + ' OR
-0003f440: 4445 5220 4259 2044 4154 455f 4352 4541  DER BY DATE_CREA
-0003f450: 5445 4420 6465 7363 2927 2c0d 0a20 2020  TED desc)',..   
-0003f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f470: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0003f480: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0003f490: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-0003f4a0: 312c 2027 524e 272c 0d0a 2020 2020 2020  1, 'RN',..      
-0003f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f4c0: 2020 2020 2020 2020 2069 6e74 6567 6572           integer
-0003f4d0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-0003f4e0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-0003f4f0: 6f6e 2c20 696e 7465 6765 725f 666f 725f  on, integer_for_
-0003f500: 6d65 7461 6461 7461 5b31 5d2c 0d0a 2020  metadata[1],..  
-0003f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f520: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-0003f530: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
-0003f540: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-0003f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f560: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
-0003f570: 616e 6368 2c20 4b45 595f 5459 5045 5f4e  anch, KEY_TYPE_N
-0003f580: 554c 4c2c 2031 2c20 7365 6c66 2e6f 776e  ULL, 1, self.own
-0003f590: 6572 5d0d 0a20 2020 2020 2020 206f 7264  er]..        ord
-0003f5a0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
-0003f5b0: 2031 0d0a 2020 2020 2020 2020 7365 6c66   1..        self
-0003f5c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003f5d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-0003f5e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-0003f5f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003f600: 5d29 0d0a 0d0a 2020 2020 2020 2020 2323  ])....        ##
-0003f610: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003f620: 2323 2323 2323 2323 2320 4372 6561 7465  ######### Create
-0003f630: 2045 6e74 6974 7920 5354 4720 4c41 5354   Entity STG LAST
-0003f640: 2049 4d41 4745 2032 2023 2323 2323 2323   IMAGE 2 #######
-0003f650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003f660: 2323 2323 0d0a 2020 2020 2020 2020 6f72  ####..        or
-0003f670: 6469 6e61 6c5f 706f 7369 7469 6f6e 203d  dinal_position =
-0003f680: 2031 0d0a 2020 2020 2020 2020 6e65 775f   1..        new_
-0003f690: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-0003f6a0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-0003f6b0: 6174 5f65 6e74 6974 795f 6163 7475 616c  at_entity_actual
-0003f6c0: 5f69 6d61 6765 5f31 2c20 6861 7368 5f6e  _image_1, hash_n
-0003f6d0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-0003f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f6f0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-0003f700: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
-0003f710: 616c 5f69 6d61 6765 5f32 2c0d 0a20 2020  al_image_2,..   
-0003f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f730: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-0003f740: 5f6e 616d 652c 0d0a 2020 2020 2020 2020  _name,..        
-0003f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f760: 2020 2020 2020 2068 6173 685f 666f 725f         hash_for_
-0003f770: 6d65 7461 6461 7461 5b30 5d2c 206f 7264  metadata[0], ord
-0003f780: 696e 616c 5f70 6f73 6974 696f 6e2c 2068  inal_position, h
-0003f790: 6173 685f 666f 725f 6d65 7461 6461 7461  ash_for_metadata
-0003f7a0: 5b31 5d2c 2068 6173 685f 666f 725f 6d65  [1], hash_for_me
-0003f7b0: 7461 6461 7461 5b32 5d2c 0d0a 2020 2020  tadata[2],..    
-0003f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f7d0: 2020 2020 2020 2020 2020 2073 6174 5f6e             sat_n
-0003f7e0: 756d 5f62 7261 6e63 682c 204b 4559 5f54  um_branch, KEY_T
-0003f7f0: 5950 455f 4841 5348 5f4b 4559 2c20 312c  YPE_HASH_KEY, 1,
-0003f800: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-0003f810: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-0003f820: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
-0003f830: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0003f840: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
-0003f850: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
-0003f860: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
-0003f870: 745f 6d61 7070 696e 675d 290d 0a0d 0a20  t_mapping]).... 
-0003f880: 2020 2020 2020 206e 6577 5f64 6174 6173         new_datas
-0003f890: 6574 5f6d 6170 7069 6e67 203d 205b 7072  et_mapping = [pr
-0003f8a0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-0003f8b0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-0003f8c0: 655f 312c 2027 4841 5348 4449 4646 272c  e_1, 'HASHDIFF',
-0003f8d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f8f0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-0003f900: 5f65 6e74 6974 795f 6163 7475 616c 5f69  _entity_actual_i
-0003f910: 6d61 6765 5f32 2c20 2748 4153 4844 4946  mage_2, 'HASHDIF
-0003f920: 4627 2c0d 0a20 2020 2020 2020 2020 2020  F',..           
-0003f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f940: 2020 2020 6861 7368 5f66 6f72 5f6d 6574      hash_for_met
-0003f950: 6164 6174 615b 305d 2c20 6f72 6469 6e61  adata[0], ordina
-0003f960: 6c5f 706f 7369 7469 6f6e 2c20 6861 7368  l_position, hash
-0003f970: 5f66 6f72 5f6d 6574 6164 6174 615b 315d  _for_metadata[1]
-0003f980: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0003f990: 6174 615b 325d 2c0d 0a20 2020 2020 2020  ata[2],..       
+0003e4e0: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
+0003e4f0: 682c 204b 4559 5f54 5950 455f 4150 504c  h, KEY_TYPE_APPL
+0003e500: 4945 445f 4441 5445 2c20 312c 2073 656c  IED_DATE, 1, sel
+0003e510: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+0003e520: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+0003e530: 7369 7469 6f6e 202b 3d20 310d 0a20 2020  sition += 1..   
+0003e540: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0003e550: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0003e560: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+0003e570: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+0003e580: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+0003e590: 0a0d 0a20 2020 2020 2020 2069 6620 6861  ...        if ha
+0003e5a0: 735f 746e 3a0d 0a20 2020 2020 2020 2020  s_tn:..         
+0003e5b0: 2020 2066 6f72 2074 6e20 696e 2074 656e     for tn in ten
+0003e5c0: 616e 745f 736f 7572 6365 3a0d 0a20 2020  ant_source:..   
+0003e5d0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0003e5e0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0003e5f0: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
+0003e600: 7479 5f73 6f75 7263 652c 2074 6e2e 636f  ty_source, tn.co
+0003e610: 6c75 6d6e 5f6e 616d 655f 736f 7572 6365  lumn_name_source
+0003e620: 2c20 7072 6566 6978 5f65 7420 2b20 7361  , prefix_et + sa
+0003e630: 745f 656e 7469 7479 5f74 6d70 2c0d 0a20  t_entity_tmp,.. 
+0003e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e660: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+0003e670: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+0003e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e6a0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f74       tn.column_t
+0003e6b0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+0003e6c0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 746e  nal_position, tn
+0003e6d0: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+0003e6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e700: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+0003e710: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+0003e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e740: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+0003e750: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
+0003e760: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0003e770: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0003e780: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+0003e790: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+0003e7a0: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+0003e7b0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+0003e7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e7d0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0003e7e0: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+0003e7f0: 2020 616c 6c5f 6463 6b5f 636f 6e63 6174    all_dck_concat
+0003e800: 656e 6174 6520 3d20 2727 0d0a 2020 2020  enate = ''..    
+0003e810: 2020 2020 6966 2068 6173 5f64 636b 3a0d      if has_dck:.
+0003e820: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003e830: 2064 636b 2069 6e20 6465 7065 6e64 656e   dck in dependen
+0003e840: 745f 6368 696c 645f 6b65 793a 0d0a 2020  t_child_key:..  
+0003e850: 2020 2020 2020 2020 2020 2020 2020 616c                al
+0003e860: 6c5f 6463 6b5f 636f 6e63 6174 656e 6174  l_dck_concatenat
+0003e870: 6520 2b3d 2022 2c20 2220 2b20 6463 6b2e  e += ", " + dck.
+0003e880: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+0003e890: 6574 0d0a 2020 2020 2020 2020 2020 2020  et..            
+0003e8a0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+0003e8b0: 6d61 7070 696e 6720 3d20 5b73 6174 5f63  mapping = [sat_c
+0003e8c0: 6f64 5f65 6e74 6974 795f 736f 7572 6365  od_entity_source
+0003e8d0: 2c20 6463 6b2e 636f 6c75 6d6e 5f6e 616d  , dck.column_nam
+0003e8e0: 655f 736f 7572 6365 2c20 7072 6566 6978  e_source, prefix
+0003e8f0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0003e900: 5f74 6d70 2c0d 0a20 2020 2020 2020 2020  _tmp,..         
+0003e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e920: 2020 2020 2020 2020 2020 2020 2020 6463                dc
+0003e930: 6b2e 636f 6c75 6d6e 5f6e 616d 655f 7461  k.column_name_ta
+0003e940: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
+0003e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e960: 2020 2020 2020 2020 2020 2020 2020 6463                dc
+0003e970: 6b2e 636f 6c75 6d6e 5f74 7970 655f 7461  k.column_type_ta
+0003e980: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
+0003e990: 7369 7469 6f6e 2c20 6463 6b2e 636f 6c75  sition, dck.colu
+0003e9a0: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
+0003e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e9d0: 2020 2064 636b 2e63 6f6c 756d 6e5f 7072     dck.column_pr
+0003e9e0: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
+0003e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ea10: 2031 2c20 4b45 595f 5459 5045 5f44 4550   1, KEY_TYPE_DEP
+0003ea20: 454e 4445 4e54 5f43 4849 4c44 5f4b 4559  ENDENT_CHILD_KEY
+0003ea30: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
+0003ea40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003ea50: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0003ea60: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0003ea70: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0003ea80: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0003ea90: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
+0003eaa0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+0003eab0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+0003eac0: 0a0d 0a20 2020 2020 2020 2061 6c6c 5f61  ...        all_a
+0003ead0: 7474 7269 6275 7465 7320 3d20 7365 6c66  ttributes = self
+0003eae0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0003eaf0: 2e67 6574 5f61 7474 7269 6275 7465 735f  .get_attributes_
+0003eb00: 6f6e 5f64 765f 6672 6f6d 5f73 6174 656c  on_dv_from_satel
+0003eb10: 6c69 7465 5f6e 616d 6528 7361 745f 656e  lite_name(sat_en
+0003eb20: 7469 7479 290d 0a0d 0a20 2020 2020 2020  tity)....       
+0003eb30: 2066 6f72 2061 7420 696e 2061 6c6c 5f61   for at in all_a
+0003eb40: 7474 7269 6275 7465 733a 0d0a 2020 2020  ttributes:..    
+0003eb50: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+0003eb60: 7365 745f 6d61 7070 696e 6720 3d20 5b61  set_mapping = [a
+0003eb70: 742e 636f 645f 656e 7469 7479 5f73 6f75  t.cod_entity_sou
+0003eb80: 7263 652c 2061 742e 636f 6c75 6d6e 5f6e  rce, at.column_n
+0003eb90: 616d 655f 736f 7572 6365 2c0d 0a20 2020  ame_source,..   
+0003eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ebc0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+0003ebd0: 656e 7469 7479 5f74 6d70 2c0d 0a20 2020  entity_tmp,..   
+0003ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ec00: 6174 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  at.column_name_t
+0003ec10: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+0003ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ec30: 2020 2020 2020 2020 2020 2061 742e 636f             at.co
+0003ec40: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+0003ec50: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+0003ec60: 6f6e 2c20 6174 2e63 6f6c 756d 6e5f 6c65  on, at.column_le
+0003ec70: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
+0003ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ec90: 2020 2020 2020 2020 2020 6174 2e63 6f6c            at.col
+0003eca0: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+0003ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ecd0: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
+0003ece0: 682c 2061 742e 6b65 795f 7479 7065 2c20  h, at.key_type, 
+0003ecf0: 312c 2073 656c 662e 6f77 6e65 725d 0d0a  1, self.owner]..
+0003ed00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003ed10: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0003ed20: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+0003ed30: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+0003ed40: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0003ed50: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0003ed60: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0003ed70: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+0003ed80: 206d 6435 5f66 756e 6374 696f 6e20 3d20   md5_function = 
+0003ed90: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+0003eda0: 6765 745f 6d64 355f 6675 6e63 7469 6f6e  get_md5_function
+0003edb0: 2829 0d0a 2020 2020 2020 2020 6361 7374  ()..        cast
+0003edc0: 5f74 6f5f 7374 7269 6e67 203d 2073 656c  _to_string = sel
+0003edd0: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
+0003ede0: 5f63 6173 745f 7374 7269 6e67 5f66 6f72  _cast_string_for
+0003edf0: 5f6d 6574 6164 6174 6128 290d 0a0d 0a20  _metadata().... 
+0003ee00: 2020 2020 2020 2062 6b5f 636f 6e63 6174         bk_concat
+0003ee10: 656e 6174 6520 3d20 2727 0d0a 2020 2020  enate = ''..    
+0003ee20: 2020 2020 6174 5f63 6f64 5f65 6e74 6974      at_cod_entit
+0003ee30: 795f 736f 7572 6365 203d 2027 270d 0a20  y_source = ''.. 
+0003ee40: 2020 2020 2020 2066 6f72 2061 7420 696e         for at in
+0003ee50: 2061 6c6c 5f61 7474 7269 6275 7465 733a   all_attributes:
+0003ee60: 0d0a 2020 2020 2020 2020 2020 2020 626b  ..            bk
+0003ee70: 5f66 696e 616c 203d 2063 6173 745f 746f  _final = cast_to
+0003ee80: 5f73 7472 696e 672e 7265 706c 6163 6528  _string.replace(
+0003ee90: 275b 785d 272c 2061 742e 636f 6c75 6d6e  '[x]', at.column
+0003eea0: 5f6e 616d 655f 736f 7572 6365 290d 0a20  _name_source).. 
+0003eeb0: 2020 2020 2020 2020 2020 2062 6b5f 636f             bk_co
+0003eec0: 6e63 6174 656e 6174 6520 2b3d 2062 6b5f  ncatenate += bk_
+0003eed0: 6669 6e61 6c20 2b20 227c 7c27 2220 2b20  final + "||'" + 
+0003eee0: 7365 6c66 2e6d 6f64 756c 655f 6476 5f63  self.module_dv_c
+0003eef0: 6861 725f 7365 7061 7261 746f 725f 6e61  har_separator_na
+0003ef00: 6d69 6e67 202b 2022 277c 7c22 0d0a 2020  ming + "'||"..  
+0003ef10: 2020 2020 2020 626b 5f63 6f6e 6361 7465        bk_concate
+0003ef20: 6e61 7465 203d 2062 6b5f 636f 6e63 6174  nate = bk_concat
+0003ef30: 656e 6174 655b 3a2d 3620 2d20 6c65 6e28  enate[:-6 - len(
+0003ef40: 7365 6c66 2e6d 6f64 756c 655f 6476 5f63  self.module_dv_c
+0003ef50: 6861 725f 7365 7061 7261 746f 725f 6e61  har_separator_na
+0003ef60: 6d69 6e67 295d 0d0a 2020 2020 2020 2020  ming)]..        
+0003ef70: 6861 7364 6966 6620 3d20 6d64 355f 6675  hasdiff = md5_fu
+0003ef80: 6e63 7469 6f6e 2e72 6570 6c61 6365 2827  nction.replace('
+0003ef90: 5b78 5d27 2c20 626b 5f63 6f6e 6361 7465  [x]', bk_concate
+0003efa0: 6e61 7465 290d 0a20 2020 2020 2020 206e  nate)..        n
+0003efb0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+0003efc0: 6e67 203d 205b 616c 6c5f 6174 7472 6962  ng = [all_attrib
+0003efd0: 7574 6573 5b30 5d2e 636f 645f 656e 7469  utes[0].cod_enti
+0003efe0: 7479 5f73 6f75 7263 652c 2068 6173 6469  ty_source, hasdi
+0003eff0: 6666 2c0d 0a20 2020 2020 2020 2020 2020  ff,..           
+0003f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f010: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+0003f020: 7361 745f 656e 7469 7479 5f74 6d70 2c20  sat_entity_tmp, 
+0003f030: 2748 4153 4844 4946 4627 2c0d 0a20 2020  'HASHDIFF',..   
+0003f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f050: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0003f060: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+0003f070: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+0003f080: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
+0003f090: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
+0003f0a0: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
+0003f0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f0d0: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
+0003f0e0: 4b45 595f 5459 5045 5f48 4153 4844 4946  KEY_TYPE_HASHDIF
+0003f0f0: 462c 2031 2c20 7365 6c66 2e6f 776e 6572  F, 1, self.owner
+0003f100: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+0003f110: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+0003f120: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+0003f130: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+0003f140: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+0003f150: 290d 0a20 2020 2020 2020 206f 7264 696e  )..        ordin
+0003f160: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+0003f170: 0d0a 0d0a 2020 2020 2020 2020 6f72 6465  ....        orde
+0003f180: 725f 6279 203d 2027 270d 0a20 2020 2020  r_by = ''..     
+0003f190: 2020 2069 6620 6861 735f 6164 3a0d 0a20     if has_ad:.. 
+0003f1a0: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0003f1b0: 5f62 7920 3d20 2720 6f72 6465 7220 6279  _by = ' order by
+0003f1c0: 2027 202b 2061 7070 6c69 6564 5f64 6174   ' + applied_dat
+0003f1d0: 652e 636f 6c75 6d6e 5f6e 616d 655f 736f  e.column_name_so
+0003f1e0: 7572 6365 202b 2027 2064 6573 6327 0d0a  urce + ' desc'..
+0003f1f0: 2020 2020 2020 2020 6966 2068 6173 5f64          if has_d
+0003f200: 636b 3a0d 0a20 2020 2020 2020 2020 2020  ck:..           
+0003f210: 2068 6173 685f 6d64 355f 6675 6e63 7469   hash_md5_functi
+0003f220: 6f6e 202b 3d20 616c 6c5f 6463 6b5f 636f  on += all_dck_co
+0003f230: 6e63 6174 656e 6174 650d 0a20 2020 2020  ncatenate..     
+0003f240: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+0003f250: 6170 7069 6e67 203d 205b 7361 745f 636f  apping = [sat_co
+0003f260: 645f 656e 7469 7479 5f73 6f75 7263 652c  d_entity_source,
+0003f270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f290: 2027 524f 575f 4e55 4d42 4552 2829 206f   'ROW_NUMBER() o
+0003f2a0: 7665 7220 2870 6172 7469 7469 6f6e 2062  ver (partition b
+0003f2b0: 7920 2720 2b20 6861 7368 5f6d 6435 5f66  y ' + hash_md5_f
+0003f2c0: 756e 6374 696f 6e20 2b20 6f72 6465 725f  unction + order_
+0003f2d0: 6279 202b 2027 2029 272c 0d0a 2020 2020  by + ' )',..    
+0003f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f2f0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0003f300: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0003f310: 795f 746d 702c 2027 524e 272c 0d0a 2020  y_tmp, 'RN',..  
+0003f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f330: 2020 2020 2020 2020 2020 2020 2069 6e74               int
+0003f340: 6567 6572 5f66 6f72 5f6d 6574 6164 6174  eger_for_metadat
+0003f350: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+0003f360: 7369 7469 6f6e 2c20 696e 7465 6765 725f  sition, integer_
+0003f370: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+0003f380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f3a0: 2069 6e74 6567 6572 5f66 6f72 5f6d 6574   integer_for_met
+0003f3b0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
+0003f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f3d0: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
+0003f3e0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
+0003f3f0: 5045 5f4e 554c 4c2c 2031 2c20 7365 6c66  PE_NULL, 1, self
+0003f400: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+0003f410: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0003f420: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+0003f430: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0003f440: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+0003f450: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+0003f460: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+0003f470: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+0003f480: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+0003f490: 2323 2323 2323 2323 2323 2323 2320 4372  ############# Cr
+0003f4a0: 6561 7465 2045 6e74 6974 7920 5354 4720  eate Entity STG 
+0003f4b0: 4c41 5354 2049 4d41 4745 2031 2023 2323  LAST IMAGE 1 ###
+0003f4c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003f4d0: 2323 2323 2323 2323 0d0a 2020 2020 2020  ########..      
+0003f4e0: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+0003f4f0: 6f6e 203d 2031 0d0a 2020 2020 2020 2020  on = 1..        
+0003f500: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+0003f510: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+0003f520: 202b 2073 6174 5f65 6e74 6974 792c 2068   + sat_entity, h
+0003f530: 6173 685f 6e61 6d65 2c20 7072 6566 6978  ash_name, prefix
+0003f540: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0003f550: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
+0003f560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f580: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+0003f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f5a0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0003f5b0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+0003f5c0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+0003f5d0: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
+0003f5e0: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
+0003f5f0: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
+0003f600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f620: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
+0003f630: 4b45 595f 5459 5045 5f48 4153 485f 4b45  KEY_TYPE_HASH_KE
+0003f640: 592c 2031 2c20 7365 6c66 2e6f 776e 6572  Y, 1, self.owner
+0003f650: 5d0d 0a20 2020 2020 2020 206f 7264 696e  ]..        ordin
+0003f660: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+0003f670: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+0003f680: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
+0003f690: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
+0003f6a0: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
+0003f6b0: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
+0003f6c0: 0d0a 0d0a 2020 2020 2020 2020 6e65 775f  ....        new_
+0003f6d0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+0003f6e0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+0003f6f0: 6174 5f65 6e74 6974 792c 2027 4841 5348  at_entity, 'HASH
+0003f700: 4449 4646 272c 0d0a 2020 2020 2020 2020  DIFF',..        
+0003f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f720: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+0003f730: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
+0003f740: 7475 616c 5f69 6d61 6765 5f31 2c20 2748  tual_image_1, 'H
+0003f750: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
+0003f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f770: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+0003f780: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+0003f790: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0003f7a0: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+0003f7b0: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
+0003f7c0: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+0003f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f7e0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+0003f7f0: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+0003f800: 595f 5459 5045 5f48 4153 4844 4946 462c  Y_TYPE_HASHDIFF,
+0003f810: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+0003f820: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+0003f830: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+0003f840: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0003f850: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+0003f860: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+0003f870: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+0003f880: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+0003f890: 0d0a 2020 2020 2020 2020 616c 6c5f 6463  ..        all_dc
+0003f8a0: 6b5f 636f 6e63 6174 656e 6174 6520 3d20  k_concatenate = 
+0003f8b0: 2727 0d0a 2020 2020 2020 2020 6966 2068  ''..        if h
+0003f8c0: 6173 5f64 636b 3a0d 0a20 2020 2020 2020  as_dck:..       
+0003f8d0: 2020 2020 2066 6f72 2064 636b 2069 6e20       for dck in 
+0003f8e0: 6465 7065 6e64 656e 745f 6368 696c 645f  dependent_child_
+0003f8f0: 6b65 793a 0d0a 2020 2020 2020 2020 2020  key:..          
+0003f900: 2020 2020 2020 616c 6c5f 6463 6b5f 636f        all_dck_co
+0003f910: 6e63 6174 656e 6174 6520 2b3d 2022 2c22  ncatenate += ","
+0003f920: 202b 2064 636b 2e63 6f6c 756d 6e5f 6e61   + dck.column_na
+0003f930: 6d65 5f74 6172 6765 740d 0a20 2020 2020  me_target..     
+0003f940: 2020 2020 2020 2020 2020 206e 6577 5f64             new_d
+0003f950: 6174 6173 6574 5f6d 6170 7069 6e67 203d  ataset_mapping =
+0003f960: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+0003f970: 745f 656e 7469 7479 2c20 6463 6b2e 636f  t_entity, dck.co
+0003f980: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+0003f990: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0003f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f9b0: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
-0003f9c0: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-0003f9d0: 5f48 4153 4844 4946 462c 2031 2c20 7365  _HASHDIFF, 1, se
-0003f9e0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-0003f9f0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-0003fa00: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-0003fa10: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0003fa20: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-0003fa30: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-0003fa40: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-0003fa50: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-0003fa60: 2020 2020 6966 2068 6173 5f64 636b 3a0d      if has_dck:.
-0003fa70: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0003fa80: 2064 636b 2069 6e20 6465 7065 6e64 656e   dck in dependen
-0003fa90: 745f 6368 696c 645f 6b65 793a 0d0a 2020  t_child_key:..  
-0003faa0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0003fab0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-0003fac0: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-0003fad0: 2073 6174 5f65 6e74 6974 795f 6163 7475   sat_entity_actu
-0003fae0: 616c 5f69 6d61 6765 5f31 2c20 6463 6b2e  al_image_1, dck.
-0003faf0: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
-0003fb00: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-0003fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb20: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0003fb30: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-0003fb40: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
-0003fb50: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
-0003fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fb70: 2020 2020 2020 2020 2020 2064 636b 2e63             dck.c
-0003fb80: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-0003fb90: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-0003fba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fbb0: 2020 2020 2020 2020 2020 2064 636b 2e63             dck.c
-0003fbc0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-0003fbd0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-0003fbe0: 696f 6e2c 2064 636b 2e63 6f6c 756d 6e5f  ion, dck.column_
-0003fbf0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0003fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fc20: 6463 6b2e 636f 6c75 6d6e 5f70 7265 6369  dck.column_preci
-0003fc30: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-0003fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fc50: 2020 2020 2020 2020 2020 2020 2020 312c                1,
-0003fc60: 204b 4559 5f54 5950 455f 4445 5045 4e44   KEY_TYPE_DEPEND
-0003fc70: 454e 545f 4348 494c 445f 4b45 592c 2031  ENT_CHILD_KEY, 1
-0003fc80: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-0003fc90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003fca0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0003fcb0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-0003fcc0: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-0003fcd0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-0003fce0: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-0003fcf0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-0003fd00: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-0003fd10: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
-0003fd20: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
-0003fd30: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
-0003fd40: 7561 6c5f 696d 6167 655f 322c 2027 524e  ual_image_2, 'RN
-0003fd50: 203d 2031 272c 2073 6174 5f6e 756d 5f62   = 1', sat_num_b
-0003fd60: 7261 6e63 682c 2073 656c 662e 6f77 6e65  ranch, self.owne
-0003fd70: 725d 0d0a 2020 2020 2020 2020 7365 6c66  r]..        self
-0003fd80: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0003fd90: 2e61 6464 5f65 6e74 7279 5f66 696c 7465  .add_entry_filte
-0003fda0: 7273 285b 6e65 775f 6669 6c74 6572 5d29  rs([new_filter])
-0003fdb0: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
-0003fdc0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003fdd0: 2323 2323 2323 2320 4372 6561 7465 2045  ####### Create E
-0003fde0: 6e74 6974 7920 5354 4720 4a4f 494e 2023  ntity STG JOIN #
-0003fdf0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0003fe00: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
-0003fe10: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-0003fe20: 7469 6f6e 203d 2031 0d0a 0d0a 2020 2020  tion = 1....    
-0003fe30: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-0003fe40: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-0003fe50: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-0003fe60: 795f 746d 702c 2068 6173 685f 6e61 6d65  y_tmp, hash_name
-0003fe70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0003fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fe90: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-0003fea0: 745f 656e 7469 7479 5f6a 6f69 6e2c 2068  t_entity_join, h
-0003feb0: 6173 685f 6e61 6d65 2c0d 0a20 2020 2020  ash_name,..     
-0003fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fed0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-0003fee0: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-0003fef0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0003ff00: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-0003ff10: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-0003ff20: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+0003f9b0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+0003f9c0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+0003f9d0: 5f61 6374 7561 6c5f 696d 6167 655f 312c  _actual_image_1,
+0003f9e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fa00: 2020 2020 2020 2020 2064 636b 2e63 6f6c           dck.col
+0003fa10: 756d 6e5f 6e61 6d65 5f74 6172 6765 742c  umn_name_target,
+0003fa20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003fa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fa40: 2020 2020 2020 2020 2064 636b 2e63 6f6c           dck.col
+0003fa50: 756d 6e5f 7479 7065 5f74 6172 6765 742c  umn_type_target,
+0003fa60: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+0003fa70: 6e2c 2064 636b 2e63 6f6c 756d 6e5f 6c65  n, dck.column_le
+0003fa80: 6e67 7468 2c0d 0a20 2020 2020 2020 2020  ngth,..         
+0003fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003faa0: 2020 2020 2020 2020 2020 2020 2020 6463                dc
+0003fab0: 6b2e 636f 6c75 6d6e 5f70 7265 6369 7369  k.column_precisi
+0003fac0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0003fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fae0: 2020 2020 2020 2020 2020 2020 312c 204b              1, K
+0003faf0: 4559 5f54 5950 455f 4445 5045 4e44 454e  EY_TYPE_DEPENDEN
+0003fb00: 545f 4348 494c 445f 4b45 592c 2031 2c20  T_CHILD_KEY, 1, 
+0003fb10: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+0003fb20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003fb30: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0003fb40: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+0003fb50: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+0003fb60: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+0003fb70: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+0003fb80: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+0003fb90: 6974 696f 6e20 2b3d 2031 0d0a 0d0a 2020  ition += 1....  
+0003fba0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+0003fbb0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+0003fbc0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+0003fbd0: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
+0003fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fbf0: 2020 2020 2027 524f 575f 4e55 4d42 4552       'ROW_NUMBER
+0003fc00: 2829 206f 7665 7220 2870 6172 7469 7469  () over (partiti
+0003fc10: 6f6e 2062 7920 2720 2b20 6861 7368 5f6e  on by ' + hash_n
+0003fc20: 616d 6520 2b20 2720 2720 2b20 616c 6c5f  ame + ' ' + all_
+0003fc30: 6463 6b5f 636f 6e63 6174 656e 6174 6520  dck_concatenate 
+0003fc40: 2b20 2720 4f52 4445 5220 4259 2044 4154  + ' ORDER BY DAT
+0003fc50: 455f 4352 4541 5445 4420 6465 7363 2927  E_CREATED desc)'
+0003fc60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0003fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fc80: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+0003fc90: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
+0003fca0: 696d 6167 655f 312c 2027 524e 272c 0d0a  image_1, 'RN',..
+0003fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fcc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003fcd0: 6e74 6567 6572 5f66 6f72 5f6d 6574 6164  nteger_for_metad
+0003fce0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
+0003fcf0: 706f 7369 7469 6f6e 2c20 696e 7465 6765  position, intege
+0003fd00: 725f 666f 725f 6d65 7461 6461 7461 5b31  r_for_metadata[1
+0003fd10: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0003fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fd30: 2020 2069 6e74 6567 6572 5f66 6f72 5f6d     integer_for_m
+0003fd40: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+0003fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fd60: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
+0003fd70: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+0003fd80: 5459 5045 5f4e 554c 4c2c 2031 2c20 7365  TYPE_NULL, 1, se
+0003fd90: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
+0003fda0: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+0003fdb0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
+0003fdc0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0003fdd0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+0003fde0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+0003fdf0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
+0003fe00: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+0003fe10: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+0003fe20: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+0003fe30: 4372 6561 7465 2045 6e74 6974 7920 5354  Create Entity ST
+0003fe40: 4720 4c41 5354 2049 4d41 4745 2032 2023  G LAST IMAGE 2 #
+0003fe50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0003fe60: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
+0003fe70: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+0003fe80: 7469 6f6e 203d 2031 0d0a 2020 2020 2020  tion = 1..      
+0003fe90: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+0003fea0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+0003feb0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+0003fec0: 6163 7475 616c 5f69 6d61 6765 5f31 2c20  actual_image_1, 
+0003fed0: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
+0003fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fef0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0003ff00: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+0003ff10: 795f 6163 7475 616c 5f69 6d61 6765 5f32  y_actual_image_2
+0003ff20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0003ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ff40: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-0003ff50: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
-0003ff60: 595f 5459 5045 5f48 4153 485f 4b45 592c  Y_TYPE_HASH_KEY,
-0003ff70: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-0003ff80: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-0003ff90: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-0003ffa0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0003ffb0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-0003ffc0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-0003ffd0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-0003ffe0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-0003fff0: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
-00040000: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-00040010: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00040020: 5f65 6e74 6974 795f 746d 702c 2027 4841  _entity_tmp, 'HA
-00040030: 5348 4449 4646 272c 0d0a 2020 2020 2020  SHDIFF',..      
-00040040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040050: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
-00040060: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00040070: 6a6f 696e 2c20 2748 4153 4844 4946 4627  join, 'HASHDIFF'
-00040080: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00040090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000400a0: 2020 6861 7368 5f66 6f72 5f6d 6574 6164    hash_for_metad
-000400b0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-000400c0: 706f 7369 7469 6f6e 2c20 6861 7368 5f66  position, hash_f
-000400d0: 6f72 5f6d 6574 6164 6174 615b 315d 2c20  or_metadata[1], 
-000400e0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-000400f0: 615b 325d 2c0d 0a20 2020 2020 2020 2020  a[2],..         
-00040100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040110: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
-00040120: 616e 6368 2c20 4b45 595f 5459 5045 5f48  anch, KEY_TYPE_H
-00040130: 4153 4844 4946 462c 2031 2c20 7365 6c66  ASHDIFF, 1, self
-00040140: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00040150: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00040160: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-00040170: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00040180: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-00040190: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-000401a0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-000401b0: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
-000401c0: 2020 6966 2068 6173 5f72 733a 0d0a 2020    if has_rs:..  
-000401d0: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
-000401e0: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
-000401f0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-00040200: 5f65 6e74 6974 795f 746d 702c 2072 6563  _entity_tmp, rec
-00040210: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-00040220: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-00040230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040250: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-00040260: 6174 5f65 6e74 6974 795f 6a6f 696e 2c0d  at_entity_join,.
-00040270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040290: 2020 2020 7265 636f 7264 5f73 6f75 7263      record_sourc
-000402a0: 652e 636f 6c75 6d6e 5f6e 616d 655f 7461  e.column_name_ta
-000402b0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-000402c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000402d0: 2020 2020 2020 2020 2020 7265 636f 7264            record
-000402e0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f74  _source.column_t
-000402f0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-00040300: 6e61 6c5f 706f 7369 7469 6f6e 2c20 7265  nal_position, re
-00040310: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00040320: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-00040330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040340: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00040350: 6563 6f72 645f 736f 7572 6365 2e63 6f6c  ecord_source.col
-00040360: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+0003ff40: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
+0003ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ff60: 2020 2020 2020 2020 2020 2020 2068 6173               has
+0003ff70: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+0003ff80: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+0003ff90: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+0003ffa0: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
+0003ffb0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+0003ffc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ffe0: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+0003fff0: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
+00040000: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
+00040010: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
+00040020: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00040030: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00040040: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00040050: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00040060: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00040070: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00040080: 290d 0a0d 0a20 2020 2020 2020 206e 6577  )....        new
+00040090: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+000400a0: 203d 205b 7072 6566 6978 5f65 7420 2b20   = [prefix_et + 
+000400b0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+000400c0: 6c5f 696d 6167 655f 312c 2027 4841 5348  l_image_1, 'HASH
+000400d0: 4449 4646 272c 0d0a 2020 2020 2020 2020  DIFF',..        
+000400e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000400f0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+00040100: 202b 2073 6174 5f65 6e74 6974 795f 6163   + sat_entity_ac
+00040110: 7475 616c 5f69 6d61 6765 5f32 2c20 2748  tual_image_2, 'H
+00040120: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
+00040130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040140: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+00040150: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+00040160: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00040170: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+00040180: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
+00040190: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
+000401a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000401b0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+000401c0: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+000401d0: 595f 5459 5045 5f48 4153 4844 4946 462c  Y_TYPE_HASHDIFF,
+000401e0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+000401f0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+00040200: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+00040210: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00040220: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00040230: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00040240: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00040250: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00040260: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00040270: 5f64 636b 3a0d 0a20 2020 2020 2020 2020  _dck:..         
+00040280: 2020 2066 6f72 2064 636b 2069 6e20 6465     for dck in de
+00040290: 7065 6e64 656e 745f 6368 696c 645f 6b65  pendent_child_ke
+000402a0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000402b0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+000402c0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+000402d0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+000402e0: 795f 6163 7475 616c 5f69 6d61 6765 5f31  y_actual_image_1
+000402f0: 2c20 6463 6b2e 636f 6c75 6d6e 5f6e 616d  , dck.column_nam
+00040300: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+00040310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040330: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+00040340: 745f 656e 7469 7479 5f61 6374 7561 6c5f  t_entity_actual_
+00040350: 696d 6167 655f 322c 0d0a 2020 2020 2020  image_2,..      
+00040360: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00040370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040390: 2020 2073 6174 5f6e 756d 5f62 7261 6e63     sat_num_branc
-000403a0: 682c 204b 4559 5f54 5950 455f 5245 434f  h, KEY_TYPE_RECO
-000403b0: 5244 5f53 4f55 5243 452c 2031 2c20 7365  RD_SOURCE, 1, se
-000403c0: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-000403d0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-000403e0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
-000403f0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00040400: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00040410: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-00040420: 5f6d 6170 7069 6e67 7328 5b6e 6577 5f64  _mappings([new_d
-00040430: 6174 6173 6574 5f6d 6170 7069 6e67 5d29  ataset_mapping])
-00040440: 0d0a 0d0a 2020 2020 2020 2020 6966 2068  ....        if h
-00040450: 6173 5f61 643a 0d0a 2020 2020 2020 2020  as_ad:..        
-00040460: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00040470: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00040480: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-00040490: 795f 746d 702c 2061 7070 6c69 6564 5f64  y_tmp, applied_d
-000404a0: 6174 652e 636f 6c75 6d6e 5f6e 616d 655f  ate.column_name_
-000404b0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-000404c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000404d0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-000404e0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-000404f0: 7479 5f6a 6f69 6e2c 0d0a 2020 2020 2020  ty_join,..      
-00040500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040510: 2020 2020 2020 2020 2020 2020 2061 7070               app
-00040520: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00040530: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00040540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040560: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-00040570: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00040580: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00040590: 696f 6e2c 2061 7070 6c69 6564 5f64 6174  ion, applied_dat
-000405a0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-000405b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000405c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000405d0: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-000405e0: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-000405f0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-00040600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040610: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
-00040620: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-00040630: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
-00040640: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00040650: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00040660: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00040670: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00040680: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00040690: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-000406a0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-000406b0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-000406c0: 6e67 5d29 0d0a 0d0a 0d0a 2020 2020 2020  ng])......      
-000406d0: 2020 6966 2068 6173 5f74 6e3a 0d0a 2020    if has_tn:..  
-000406e0: 2020 2020 2020 2020 2020 666f 7220 746e            for tn
-000406f0: 2069 6e20 7465 6e61 6e74 5f73 6f75 7263   in tenant_sourc
-00040700: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00040710: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00040720: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00040730: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-00040740: 795f 746d 702c 2074 6e2e 636f 6c75 6d6e  y_tmp, tn.column
-00040750: 5f6e 616d 655f 7461 7267 6574 2c20 7072  _name_target, pr
-00040760: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-00040770: 7469 7479 5f6a 6f69 6e2c 0d0a 2020 2020  tity_join,..    
-00040780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000407a0: 2020 2074 6e2e 636f 6c75 6d6e 5f6e 616d     tn.column_nam
-000407b0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-000407c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000407d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000407e0: 2020 746e 2e63 6f6c 756d 6e5f 7479 7065    tn.column_type
-000407f0: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
-00040800: 5f70 6f73 6974 696f 6e2c 2074 6e2e 636f  _position, tn.co
-00040810: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-00040820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040840: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f70       tn.column_p
-00040850: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
-00040860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040880: 2020 312c 204b 4559 5f54 5950 455f 5445    1, KEY_TYPE_TE
-00040890: 4e41 4e54 2c20 312c 2073 656c 662e 6f77  NANT, 1, self.ow
-000408a0: 6e65 725d 0d0a 2020 2020 2020 2020 2020  ner]..          
-000408b0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-000408c0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-000408d0: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
-000408e0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
-000408f0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 2020  et_mapping])..  
-00040900: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00040910: 6469 6e61 6c5f 706f 7369 7469 6f6e 202b  dinal_position +
-00040920: 3d20 310d 0a0d 0a20 2020 2020 2020 206e  = 1....        n
-00040930: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00040940: 6e67 203d 205b 7072 6566 6978 5f65 7420  ng = [prefix_et 
-00040950: 2b20 7361 745f 656e 7469 7479 5f74 6d70  + sat_entity_tmp
-00040960: 2c20 2744 4154 455f 4352 4541 5445 4427  , 'DATE_CREATED'
-00040970: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00040980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040990: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
-000409a0: 745f 656e 7469 7479 5f6a 6f69 6e2c 2027  t_entity_join, '
-000409b0: 4441 5445 5f43 5245 4154 4544 272c 0d0a  DATE_CREATED',..
-000409c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000409d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000409e0: 7973 6461 7465 5f66 6f72 5f6d 6574 6164  ysdate_for_metad
-000409f0: 6174 615b 305d 2c20 6f72 6469 6e61 6c5f  ata[0], ordinal_
-00040a00: 706f 7369 7469 6f6e 2c20 7379 7364 6174  position, sysdat
-00040a10: 655f 666f 725f 6d65 7461 6461 7461 5b31  e_for_metadata[1
-00040a20: 5d2c 2073 7973 6461 7465 5f66 6f72 5f6d  ], sysdate_for_m
-00040a30: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+00040380: 2064 636b 2e63 6f6c 756d 6e5f 6e61 6d65   dck.column_name
+00040390: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
+000403a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000403b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000403c0: 2064 636b 2e63 6f6c 756d 6e5f 7479 7065   dck.column_type
+000403d0: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+000403e0: 5f70 6f73 6974 696f 6e2c 2064 636b 2e63  _position, dck.c
+000403f0: 6f6c 756d 6e5f 6c65 6e67 7468 2c0d 0a20  olumn_length,.. 
+00040400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040420: 2020 2020 2020 6463 6b2e 636f 6c75 6d6e        dck.column
+00040430: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+00040440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040460: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+00040470: 4445 5045 4e44 454e 545f 4348 494c 445f  DEPENDENT_CHILD_
+00040480: 4b45 592c 2031 2c20 7365 6c66 2e6f 776e  KEY, 1, self.own
+00040490: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+000404a0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000404b0: 7461 5f61 6374 7561 6c2e 6164 645f 656e  ta_actual.add_en
+000404c0: 7472 795f 6461 7461 7365 745f 6d61 7070  try_dataset_mapp
+000404d0: 696e 6773 285b 6e65 775f 6461 7461 7365  ings([new_datase
+000404e0: 745f 6d61 7070 696e 675d 290d 0a20 2020  t_mapping])..   
+000404f0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+00040500: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+00040510: 2031 0d0a 0d0a 2020 2020 2020 2020 6e65   1....        ne
+00040520: 775f 6669 6c74 6572 203d 205b 7072 6566  w_filter = [pref
+00040530: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+00040540: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00040550: 322c 2027 524e 203d 2031 272c 2073 6174  2, 'RN = 1', sat
+00040560: 5f6e 756d 5f62 7261 6e63 682c 2073 656c  _num_branch, sel
+00040570: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00040580: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00040590: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
+000405a0: 5f66 696c 7465 7273 285b 6e65 775f 6669  _filters([new_fi
+000405b0: 6c74 6572 5d29 0d0a 0d0a 2020 2020 2020  lter])....      
+000405c0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+000405d0: 2323 2323 2323 2323 2323 2323 2320 4372  ############# Cr
+000405e0: 6561 7465 2045 6e74 6974 7920 5354 4720  eate Entity STG 
+000405f0: 4a4f 494e 2023 2323 2323 2323 2323 2323  JOIN ###########
+00040600: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00040610: 0d0a 2020 2020 2020 2020 6f72 6469 6e61  ..        ordina
+00040620: 6c5f 706f 7369 7469 6f6e 203d 2031 0d0a  l_position = 1..
+00040630: 0d0a 2020 2020 2020 2020 6e65 775f 6461  ..        new_da
+00040640: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00040650: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00040660: 5f65 6e74 6974 795f 746d 702c 2068 6173  _entity_tmp, has
+00040670: 685f 6e61 6d65 2c0d 0a20 2020 2020 2020  h_name,..       
+00040680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040690: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+000406a0: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
+000406b0: 6f69 6e2c 2068 6173 685f 6e61 6d65 2c0d  oin, hash_name,.
+000406c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000406d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000406e0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+000406f0: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+00040700: 7369 7469 6f6e 2c20 6861 7368 5f66 6f72  sition, hash_for
+00040710: 5f6d 6574 6164 6174 615b 315d 2c20 6861  _metadata[1], ha
+00040720: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00040730: 325d 2c0d 0a20 2020 2020 2020 2020 2020  2],..           
+00040740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040750: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
+00040760: 6368 2c20 4b45 595f 5459 5045 5f48 4153  ch, KEY_TYPE_HAS
+00040770: 485f 4b45 592c 2031 2c20 7365 6c66 2e6f  H_KEY, 1, self.o
+00040780: 776e 6572 5d0d 0a20 2020 2020 2020 206f  wner]..        o
+00040790: 7264 696e 616c 5f70 6f73 6974 696f 6e20  rdinal_position 
+000407a0: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
+000407b0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000407c0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+000407d0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+000407e0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+000407f0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+00040800: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00040810: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00040820: 202b 2073 6174 5f65 6e74 6974 795f 746d   + sat_entity_tm
+00040830: 702c 2027 4841 5348 4449 4646 272c 0d0a  p, 'HASHDIFF',..
+00040840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040850: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00040860: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+00040870: 6e74 6974 795f 6a6f 696e 2c20 2748 4153  ntity_join, 'HAS
+00040880: 4844 4946 4627 2c0d 0a20 2020 2020 2020  HDIFF',..       
+00040890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000408a0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+000408b0: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+000408c0: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+000408d0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+000408e0: 615b 315d 2c20 6861 7368 5f66 6f72 5f6d  a[1], hash_for_m
+000408f0: 6574 6164 6174 615b 325d 2c0d 0a20 2020  etadata[2],..   
+00040900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040910: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
+00040920: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+00040930: 5459 5045 5f48 4153 4844 4946 462c 2031  TYPE_HASHDIFF, 1
+00040940: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00040950: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00040960: 6f73 6974 696f 6e20 2b3d 2031 0d0a 2020  osition += 1..  
+00040970: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00040980: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
+00040990: 6e74 7279 5f64 6174 6173 6574 5f6d 6170  ntry_dataset_map
+000409a0: 7069 6e67 7328 5b6e 6577 5f64 6174 6173  pings([new_datas
+000409b0: 6574 5f6d 6170 7069 6e67 5d29 0d0a 0d0a  et_mapping])....
+000409c0: 2020 2020 2020 2020 6966 2068 6173 5f72          if has_r
+000409d0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000409e0: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+000409f0: 696e 6720 3d20 5b70 7265 6669 785f 6574  ing = [prefix_et
+00040a00: 202b 2073 6174 5f65 6e74 6974 795f 746d   + sat_entity_tm
+00040a10: 702c 2072 6563 6f72 645f 736f 7572 6365  p, record_source
+00040a20: 2e63 6f6c 756d 6e5f 6e61 6d65 5f74 6172  .column_name_tar
+00040a30: 6765 742c 0d0a 2020 2020 2020 2020 2020  get,..          
 00040a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040a50: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
-00040a60: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
-00040a70: 5459 5045 5f4e 554c 4c2c 2031 2c20 7365  TYPE_NULL, 1, se
-00040a80: 6c66 2e6f 776e 6572 5d0d 0a20 2020 2020  lf.owner]..     
-00040a90: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00040aa0: 696f 6e20 2b3d 2031 0d0a 2020 2020 2020  ion += 1..      
-00040ab0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00040ac0: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00040ad0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00040ae0: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00040af0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00040b00: 2020 2020 6966 2068 6173 5f64 636b 3a0d      if has_dck:.
-00040b10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00040b20: 2064 636b 2069 6e20 6465 7065 6e64 656e   dck in dependen
-00040b30: 745f 6368 696c 645f 6b65 793a 0d0a 2020  t_child_key:..  
-00040b40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00040b50: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00040b60: 6720 3d20 5b70 7265 6669 785f 6574 202b  g = [prefix_et +
-00040b70: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-00040b80: 2064 636b 2e63 6f6c 756d 6e5f 6e61 6d65   dck.column_name
-00040b90: 5f74 6172 6765 742c 2070 7265 6669 785f  _target, prefix_
-00040ba0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00040bb0: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
-00040bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040bd0: 2020 2020 2020 2020 2020 2020 2020 6463                dc
-00040be0: 6b2e 636f 6c75 6d6e 5f6e 616d 655f 7461  k.column_name_ta
-00040bf0: 7267 6574 2c0d 0a20 2020 2020 2020 2020  rget,..         
-00040c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040c10: 2020 2020 2020 2020 2020 2020 2020 6463                dc
-00040c20: 6b2e 636f 6c75 6d6e 5f74 7970 655f 7461  k.column_type_ta
-00040c30: 7267 6574 2c20 6f72 6469 6e61 6c5f 706f  rget, ordinal_po
-00040c40: 7369 7469 6f6e 2c20 6463 6b2e 636f 6c75  sition, dck.colu
-00040c50: 6d6e 5f6c 656e 6774 682c 0d0a 2020 2020  mn_length,..    
-00040c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040c80: 2020 2064 636b 2e63 6f6c 756d 6e5f 7072     dck.column_pr
-00040c90: 6563 6973 696f 6e2c 0d0a 2020 2020 2020  ecision,..      
-00040ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040cc0: 2031 2c20 4b45 595f 5459 5045 5f44 4550   1, KEY_TYPE_DEP
-00040cd0: 454e 4445 4e54 5f43 4849 4c44 5f4b 4559  ENDENT_CHILD_KEY
-00040ce0: 2c20 312c 2073 656c 662e 6f77 6e65 725d  , 1, self.owner]
-00040cf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040d00: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00040d10: 6163 7475 616c 2e61 6464 5f65 6e74 7279  actual.add_entry
-00040d20: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00040d30: 7328 5b6e 6577 5f64 6174 6173 6574 5f6d  s([new_dataset_m
-00040d40: 6170 7069 6e67 5d29 0d0a 2020 2020 2020  apping])..      
-00040d50: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00040d60: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00040d70: 0a0d 0a20 2020 2020 2020 2066 6f72 2061  ...        for a
-00040d80: 7420 696e 2061 6c6c 5f61 7474 7269 6275  t in all_attribu
-00040d90: 7465 733a 0d0a 2020 2020 2020 2020 2020  tes:..          
-00040da0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00040db0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00040dc0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00040dd0: 746d 702c 2061 742e 636f 6c75 6d6e 5f6e  tmp, at.column_n
-00040de0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
-00040df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040a50: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00040a60: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+00040a70: 6a6f 696e 2c0d 0a20 2020 2020 2020 2020  join,..         
+00040a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040a90: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00040aa0: 5f73 6f75 7263 652e 636f 6c75 6d6e 5f6e  _source.column_n
+00040ab0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00040ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ae0: 7265 636f 7264 5f73 6f75 7263 652e 636f  record_source.co
+00040af0: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+00040b00: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00040b10: 6f6e 2c20 7265 636f 7264 5f73 6f75 7263  on, record_sourc
+00040b20: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
+00040b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00040b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040b50: 2020 2020 2072 6563 6f72 645f 736f 7572       record_sour
+00040b60: 6365 2e63 6f6c 756d 6e5f 7072 6563 6973  ce.column_precis
+00040b70: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+00040b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040b90: 2020 2020 2020 2020 2073 6174 5f6e 756d           sat_num
+00040ba0: 5f62 7261 6e63 682c 204b 4559 5f54 5950  _branch, KEY_TYP
+00040bb0: 455f 5245 434f 5244 5f53 4f55 5243 452c  E_RECORD_SOURCE,
+00040bc0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00040bd0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+00040be0: 696e 616c 5f70 6f73 6974 696f 6e20 2b3d  inal_position +=
+00040bf0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00040c00: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00040c10: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00040c20: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00040c30: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00040c40: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00040c50: 2020 6966 2068 6173 5f61 643a 0d0a 2020    if has_ad:..  
+00040c60: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00040c70: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00040c80: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00040c90: 5f65 6e74 6974 795f 746d 702c 2061 7070  _entity_tmp, app
+00040ca0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+00040cb0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+00040cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ce0: 2020 7072 6566 6978 5f65 7420 2b20 7361    prefix_et + sa
+00040cf0: 745f 656e 7469 7479 5f6a 6f69 6e2c 0d0a  t_entity_join,..
+00040d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040d20: 2020 2061 7070 6c69 6564 5f64 6174 652e     applied_date.
+00040d30: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+00040d40: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
+00040d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040d60: 2020 2020 2020 2020 6170 706c 6965 645f          applied_
+00040d70: 6461 7465 2e63 6f6c 756d 6e5f 7479 7065  date.column_type
+00040d80: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+00040d90: 5f70 6f73 6974 696f 6e2c 2061 7070 6c69  _position, appli
+00040da0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6c  ed_date.column_l
+00040db0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+00040dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040dd0: 2020 2020 2020 2020 2020 2061 7070 6c69             appli
+00040de0: 6564 5f64 6174 652e 636f 6c75 6d6e 5f70  ed_date.column_p
+00040df0: 7265 6369 7369 6f6e 2c0d 0a20 2020 2020  recision,..     
 00040e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040e10: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-00040e20: 656e 7469 7479 5f6a 6f69 6e2c 0d0a 2020  entity_join,..  
-00040e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040e50: 2061 742e 636f 6c75 6d6e 5f6e 616d 655f   at.column_name_
-00040e60: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
-00040e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040e80: 2020 2020 2020 2020 2020 2020 6174 2e63              at.c
-00040e90: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00040ea0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00040eb0: 696f 6e2c 2061 742e 636f 6c75 6d6e 5f6c  ion, at.column_l
-00040ec0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-00040ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ee0: 2020 2020 2020 2020 2020 2061 742e 636f             at.co
-00040ef0: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
-00040f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040f20: 2020 2020 7361 745f 6e75 6d5f 6272 616e      sat_num_bran
-00040f30: 6368 2c20 6174 2e6b 6579 5f74 7970 652c  ch, at.key_type,
-00040f40: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00040f50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00040f60: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00040f70: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00040f80: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-00040f90: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-00040fa0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
-00040fb0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00040fc0: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
-00040fd0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00040fe0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00040ff0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00041000: 6163 7475 616c 5f69 6d61 6765 5f32 2c20  actual_image_2, 
-00041010: 6861 7368 5f6e 616d 652c 0d0a 2020 2020  hash_name,..    
-00041020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041030: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00041040: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-00041050: 795f 6a6f 696e 2c20 6861 7368 5f6e 616d  y_join, hash_nam
-00041060: 6520 2b20 225f 4849 5354 222c 0d0a 2020  e + "_HIST",..  
+00040e10: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00040e20: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+00040e30: 595f 5459 5045 5f41 5050 4c49 4544 5f44  Y_TYPE_APPLIED_D
+00040e40: 4154 452c 2031 2c20 7365 6c66 2e6f 776e  ATE, 1, self.own
+00040e50: 6572 5d0d 0a20 2020 2020 2020 2020 2020  er]..           
+00040e60: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00040e70: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+00040e80: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00040e90: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00040ea0: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00040eb0: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00040ec0: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 0d0a  _mapping])......
+00040ed0: 2020 2020 2020 2020 6966 2068 6173 5f74          if has_t
+00040ee0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00040ef0: 666f 7220 746e 2069 6e20 7465 6e61 6e74  for tn in tenant
+00040f00: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
+00040f10: 2020 2020 2020 2020 2020 6e65 775f 6461            new_da
+00040f20: 7461 7365 745f 6d61 7070 696e 6720 3d20  taset_mapping = 
+00040f30: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
+00040f40: 5f65 6e74 6974 795f 746d 702c 2074 6e2e  _entity_tmp, tn.
+00040f50: 636f 6c75 6d6e 5f6e 616d 655f 7461 7267  column_name_targ
+00040f60: 6574 2c20 7072 6566 6978 5f65 7420 2b20  et, prefix_et + 
+00040f70: 7361 745f 656e 7469 7479 5f6a 6f69 6e2c  sat_entity_join,
+00040f80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00040f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040fa0: 2020 2020 2020 2020 2074 6e2e 636f 6c75           tn.colu
+00040fb0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+00040fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040fe0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+00040ff0: 6e5f 7479 7065 5f74 6172 6765 742c 206f  n_type_target, o
+00041000: 7264 696e 616c 5f70 6f73 6974 696f 6e2c  rdinal_position,
+00041010: 2074 6e2e 636f 6c75 6d6e 5f6c 656e 6774   tn.column_lengt
+00041020: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+00041030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041040: 2020 2020 2020 2020 2020 2074 6e2e 636f             tn.co
+00041050: 6c75 6d6e 5f70 7265 6369 7369 6f6e 2c0d  lumn_precision,.
+00041060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00041070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041080: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00041090: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-000410a0: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-000410b0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-000410c0: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
-000410d0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-000410e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000410f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041100: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-00041110: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
-00041120: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
-00041130: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
-00041140: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00041150: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-00041160: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00041170: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-00041180: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-00041190: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-000411a0: 290d 0a0d 0a20 2020 2020 2020 206e 6577  )....        new
-000411b0: 5f72 656c 6174 696f 6e73 6869 7020 3d20  _relationship = 
-000411c0: 5b70 7265 6669 785f 6574 202b 2073 6174  [prefix_et + sat
-000411d0: 5f65 6e74 6974 795f 746d 702c 2027 4841  _entity_tmp, 'HA
-000411e0: 5348 4449 4646 272c 0d0a 2020 2020 2020  SHDIFF',..      
-000411f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041200: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-00041210: 2b20 7361 745f 656e 7469 7479 5f61 6374  + sat_entity_act
-00041220: 7561 6c5f 696d 6167 655f 322c 0d0a 2020  ual_image_2,..  
-00041230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041240: 2020 2020 2020 2020 2020 2748 4153 4844            'HASHD
-00041250: 4946 4627 2c20 224d 4153 5445 5220 4a4f  IFF', "MASTER JO
-00041260: 494e 222c 2073 656c 662e 6f77 6e65 725d  IN", self.owner]
-00041270: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-00041280: 6574 6164 6174 615f 6163 7475 616c 2e61  etadata_actual.a
-00041290: 6464 5f65 6e74 7279 5f64 6174 6173 6574  dd_entry_dataset
-000412a0: 5f72 656c 6174 696f 6e73 6869 7028 5b6e  _relationship([n
-000412b0: 6577 5f72 656c 6174 696f 6e73 6869 705d  ew_relationship]
-000412c0: 290d 0a20 2020 2020 2020 206e 6577 5f72  )..        new_r
-000412d0: 656c 6174 696f 6e73 6869 7020 3d20 5b70  elationship = [p
-000412e0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-000412f0: 6e74 6974 795f 746d 702c 2068 6173 685f  ntity_tmp, hash_
-00041300: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00041310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041320: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-00041330: 6174 5f65 6e74 6974 795f 6163 7475 616c  at_entity_actual
-00041340: 5f69 6d61 6765 5f32 2c0d 0a20 2020 2020  _image_2,..     
-00041350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041360: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-00041370: 2c20 224d 4153 5445 5220 4a4f 494e 222c  , "MASTER JOIN",
-00041380: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00041390: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-000413a0: 6174 615f 6163 7475 616c 2e61 6464 5f65  ata_actual.add_e
-000413b0: 6e74 7279 5f64 6174 6173 6574 5f72 656c  ntry_dataset_rel
-000413c0: 6174 696f 6e73 6869 7028 5b6e 6577 5f72  ationship([new_r
-000413d0: 656c 6174 696f 6e73 6869 705d 290d 0a20  elationship]).. 
-000413e0: 2020 2020 2020 2069 6620 6861 735f 6463         if has_dc
-000413f0: 6b3a 0d0a 2020 2020 2020 2020 2020 2020  k:..            
-00041400: 666f 7220 6463 6b20 696e 2064 6570 656e  for dck in depen
-00041410: 6465 6e74 5f63 6869 6c64 5f6b 6579 3a0d  dent_child_key:.
-00041420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041430: 206e 6577 5f72 656c 6174 696f 6e73 6869   new_relationshi
-00041440: 7020 3d20 5b70 7265 6669 785f 6574 202b  p = [prefix_et +
-00041450: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
-00041460: 2064 636b 2e63 6f6c 756d 6e5f 6e61 6d65   dck.column_name
-00041470: 5f74 6172 6765 742c 0d0a 2020 2020 2020  _target,..      
-00041480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041490: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000414a0: 6566 6978 5f65 7420 2b20 7361 745f 656e  efix_et + sat_en
-000414b0: 7469 7479 5f61 6374 7561 6c5f 696d 6167  tity_actual_imag
-000414c0: 655f 322c 0d0a 2020 2020 2020 2020 2020  e_2,..          
-000414d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000414e0: 2020 2020 2020 2020 2020 6463 6b2e 636f            dck.co
-000414f0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
-00041500: 2c20 224d 4153 5445 5220 4a4f 494e 222c  , "MASTER JOIN",
-00041510: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00041520: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00041530: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00041540: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00041550: 6173 6574 5f72 656c 6174 696f 6e73 6869  aset_relationshi
-00041560: 7028 5b6e 6577 5f72 656c 6174 696f 6e73  p([new_relations
-00041570: 6869 705d 290d 0a0d 0a20 2020 2020 2020  hip])....       
-00041580: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-00041590: 2323 2323 2323 2323 2323 2323 2043 7265  ############ Cre
-000415a0: 6174 6520 456e 7469 7479 2053 4154 2023  ate Entity SAT #
-000415b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000415c0: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
-000415d0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-000415e0: 7469 6f6e 203d 2031 0d0a 0d0a 2020 2020  tion = 1....    
-000415f0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00041600: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
-00041610: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-00041620: 795f 6a6f 696e 2c20 6861 7368 5f6e 616d  y_join, hash_nam
-00041630: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00041080: 2020 2020 2020 2020 312c 204b 4559 5f54          1, KEY_T
+00041090: 5950 455f 5445 4e41 4e54 2c20 312c 2073  YPE_TENANT, 1, s
+000410a0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+000410b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000410c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+000410d0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+000410e0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+000410f0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00041100: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00041110: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00041120: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+00041130: 2020 2020 206e 6577 5f64 6174 6173 6574       new_dataset
+00041140: 5f6d 6170 7069 6e67 203d 205b 7072 6566  _mapping = [pref
+00041150: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+00041160: 7479 5f74 6d70 2c20 2744 4154 455f 4352  ty_tmp, 'DATE_CR
+00041170: 4541 5445 4427 2c0d 0a20 2020 2020 2020  EATED',..       
+00041180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041190: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+000411a0: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
+000411b0: 6f69 6e2c 2027 4441 5445 5f43 5245 4154  oin, 'DATE_CREAT
+000411c0: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
+000411d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000411e0: 2020 2020 2073 7973 6461 7465 5f66 6f72       sysdate_for
+000411f0: 5f6d 6574 6164 6174 615b 305d 2c20 6f72  _metadata[0], or
+00041200: 6469 6e61 6c5f 706f 7369 7469 6f6e 2c20  dinal_position, 
+00041210: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00041220: 6461 7461 5b31 5d2c 2073 7973 6461 7465  data[1], sysdate
+00041230: 5f66 6f72 5f6d 6574 6164 6174 615b 325d  _for_metadata[2]
+00041240: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00041250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041260: 2020 7361 745f 6e75 6d5f 6272 616e 6368    sat_num_branch
+00041270: 2c20 4b45 595f 5459 5045 5f4e 554c 4c2c  , KEY_TYPE_NULL,
+00041280: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+00041290: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+000412a0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+000412b0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+000412c0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+000412d0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+000412e0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+000412f0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00041300: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00041310: 5f64 636b 3a0d 0a20 2020 2020 2020 2020  _dck:..         
+00041320: 2020 2066 6f72 2064 636b 2069 6e20 6465     for dck in de
+00041330: 7065 6e64 656e 745f 6368 696c 645f 6b65  pendent_child_ke
+00041340: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00041350: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00041360: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+00041370: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+00041380: 795f 746d 702c 2064 636b 2e63 6f6c 756d  y_tmp, dck.colum
+00041390: 6e5f 6e61 6d65 5f74 6172 6765 742c 2070  n_name_target, p
+000413a0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+000413b0: 6e74 6974 795f 6a6f 696e 2c0d 0a20 2020  ntity_join,..   
+000413c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000413d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000413e0: 2020 2020 6463 6b2e 636f 6c75 6d6e 5f6e      dck.column_n
+000413f0: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00041400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041420: 2020 2020 6463 6b2e 636f 6c75 6d6e 5f74      dck.column_t
+00041430: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+00041440: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6463  nal_position, dc
+00041450: 6b2e 636f 6c75 6d6e 5f6c 656e 6774 682c  k.column_length,
+00041460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00041470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041480: 2020 2020 2020 2020 2064 636b 2e63 6f6c           dck.col
+00041490: 756d 6e5f 7072 6563 6973 696f 6e2c 0d0a  umn_precision,..
+000414a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000414b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000414c0: 2020 2020 2020 2031 2c20 4b45 595f 5459         1, KEY_TY
+000414d0: 5045 5f44 4550 454e 4445 4e54 5f43 4849  PE_DEPENDENT_CHI
+000414e0: 4c44 5f4b 4559 2c20 312c 2073 656c 662e  LD_KEY, 1, self.
+000414f0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00041500: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00041510: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00041520: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00041530: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00041540: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00041550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041560: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00041570: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+00041580: 2066 6f72 2061 7420 696e 2061 6c6c 5f61   for at in all_a
+00041590: 7474 7269 6275 7465 733a 0d0a 2020 2020  ttributes:..    
+000415a0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+000415b0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+000415c0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+000415d0: 6e74 6974 795f 746d 702c 2061 742e 636f  ntity_tmp, at.co
+000415e0: 6c75 6d6e 5f6e 616d 655f 7461 7267 6574  lumn_name_target
+000415f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00041600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041610: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+00041620: 2b20 7361 745f 656e 7469 7479 5f6a 6f69  + sat_entity_joi
+00041630: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
 00041640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041650: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
-00041660: 6174 5f65 6e74 6974 792c 2068 6173 685f  at_entity, hash_
-00041670: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+00041650: 2020 2020 2020 2061 742e 636f 6c75 6d6e         at.column
+00041660: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+00041670: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00041680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041690: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
-000416a0: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
-000416b0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
-000416c0: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
-000416d0: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
-000416e0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-000416f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041700: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-00041710: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-00041720: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
-00041730: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
-00041740: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
-00041750: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
-00041760: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00041770: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00041780: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00041790: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-000417a0: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
-000417b0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-000417c0: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
-000417d0: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
-000417e0: 6974 795f 6a6f 696e 2c20 2748 4153 4844  ity_join, 'HASHD
-000417f0: 4946 4627 2c0d 0a20 2020 2020 2020 2020  IFF',..         
-00041800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041810: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
-00041820: 2b20 7361 745f 656e 7469 7479 2c20 2748  + sat_entity, 'H
-00041830: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
-00041840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041850: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-00041860: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
-00041870: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00041880: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
-00041890: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
-000418a0: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
-000418b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000418c0: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-000418d0: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
-000418e0: 595f 5459 5045 5f48 4153 4844 4946 462c  Y_TYPE_HASHDIFF,
-000418f0: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
-00041900: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
-00041910: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
-00041920: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00041930: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-00041940: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-00041950: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-00041960: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-00041970: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
-00041980: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
-00041990: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-000419a0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-000419b0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-000419c0: 6a6f 696e 2c20 7265 636f 7264 5f73 6f75  join, record_sou
-000419d0: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
-000419e0: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00041690: 2020 6174 2e63 6f6c 756d 6e5f 7479 7065    at.column_type
+000416a0: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+000416b0: 5f70 6f73 6974 696f 6e2c 2061 742e 636f  _position, at.co
+000416c0: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+000416d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000416e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000416f0: 2061 742e 636f 6c75 6d6e 5f70 7265 6369   at.column_preci
+00041700: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+00041710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041720: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
+00041730: 6d5f 6272 616e 6368 2c20 6174 2e6b 6579  m_branch, at.key
+00041740: 5f74 7970 652c 2031 2c20 7365 6c66 2e6f  _type, 1, self.o
+00041750: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00041760: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00041770: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00041780: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00041790: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+000417a0: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+000417b0: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+000417c0: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+000417d0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+000417e0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+000417f0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+00041800: 6e74 6974 795f 6163 7475 616c 5f69 6d61  ntity_actual_ima
+00041810: 6765 5f32 2c20 6861 7368 5f6e 616d 652c  ge_2, hash_name,
+00041820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00041830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041840: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00041850: 5f65 6e74 6974 795f 6a6f 696e 2c20 6861  _entity_join, ha
+00041860: 7368 5f6e 616d 6520 2b20 225f 4849 5354  sh_name + "_HIST
+00041870: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00041880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041890: 2020 2068 6173 685f 666f 725f 6d65 7461     hash_for_meta
+000418a0: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+000418b0: 5f70 6f73 6974 696f 6e2c 2068 6173 685f  _position, hash_
+000418c0: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+000418d0: 2068 6173 685f 666f 725f 6d65 7461 6461   hash_for_metada
+000418e0: 7461 5b32 5d2c 0d0a 2020 2020 2020 2020  ta[2],..        
+000418f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041900: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
+00041910: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
+00041920: 4841 5348 5f4b 4559 2c20 312c 2073 656c  HASH_KEY, 1, sel
+00041930: 662e 6f77 6e65 725d 0d0a 2020 2020 2020  f.owner]..      
+00041940: 2020 6f72 6469 6e61 6c5f 706f 7369 7469    ordinal_positi
+00041950: 6f6e 202b 3d20 310d 0a20 2020 2020 2020  on += 1..       
+00041960: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00041970: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00041980: 6461 7461 7365 745f 6d61 7070 696e 6773  dataset_mappings
+00041990: 285b 6e65 775f 6461 7461 7365 745f 6d61  ([new_dataset_ma
+000419a0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+000419b0: 2020 206e 6577 5f72 656c 6174 696f 6e73     new_relations
+000419c0: 6869 7020 3d20 5b70 7265 6669 785f 6574  hip = [prefix_et
+000419d0: 202b 2073 6174 5f65 6e74 6974 795f 746d   + sat_entity_tm
+000419e0: 702c 2027 4841 5348 4449 4646 272c 0d0a  p, 'HASHDIFF',..
 000419f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00041a00: 2020 2020 2020 2020 2020 2020 7072 6566              pref
 00041a10: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
-00041a20: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-00041a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041a40: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00041a50: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
-00041a60: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-00041a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041a80: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00041a90: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
-00041aa0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-00041ab0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00041ac0: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
-00041ad0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-00041ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041b00: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-00041b10: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-00041b20: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00041b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041b40: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-00041b50: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-00041b60: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
-00041b70: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00041b80: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00041b90: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00041ba0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00041bb0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00041bc0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00041bd0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00041be0: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00041bf0: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00041c00: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
-00041c10: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00041c20: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
-00041c30: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
-00041c40: 6e74 6974 795f 6a6f 696e 2c20 6170 706c  ntity_join, appl
-00041c50: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-00041c60: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00041c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041a20: 7479 5f61 6374 7561 6c5f 696d 6167 655f  ty_actual_image_
+00041a30: 322c 0d0a 2020 2020 2020 2020 2020 2020  2,..            
+00041a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041a50: 2748 4153 4844 4946 4627 2c20 224d 4153  'HASHDIFF', "MAS
+00041a60: 5445 5220 4a4f 494e 222c 2073 656c 662e  TER JOIN", self.
+00041a70: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00041a80: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00041a90: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00041aa0: 6174 6173 6574 5f72 656c 6174 696f 6e73  ataset_relations
+00041ab0: 6869 7028 5b6e 6577 5f72 656c 6174 696f  hip([new_relatio
+00041ac0: 6e73 6869 705d 290d 0a20 2020 2020 2020  nship])..       
+00041ad0: 206e 6577 5f72 656c 6174 696f 6e73 6869   new_relationshi
+00041ae0: 7020 3d20 5b70 7265 6669 785f 6574 202b  p = [prefix_et +
+00041af0: 2073 6174 5f65 6e74 6974 795f 746d 702c   sat_entity_tmp,
+00041b00: 2068 6173 685f 6e61 6d65 2c0d 0a20 2020   hash_name,..   
+00041b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041b20: 2020 2020 2020 2020 2070 7265 6669 785f           prefix_
+00041b30: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+00041b40: 6163 7475 616c 5f69 6d61 6765 5f32 2c0d  actual_image_2,.
+00041b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041b60: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00041b70: 685f 6e61 6d65 2c20 224d 4153 5445 5220  h_name, "MASTER 
+00041b80: 4a4f 494e 222c 2073 656c 662e 6f77 6e65  JOIN", self.owne
+00041b90: 725d 0d0a 2020 2020 2020 2020 7365 6c66  r]..        self
+00041ba0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00041bb0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00041bc0: 6574 5f72 656c 6174 696f 6e73 6869 7028  et_relationship(
+00041bd0: 5b6e 6577 5f72 656c 6174 696f 6e73 6869  [new_relationshi
+00041be0: 705d 290d 0a20 2020 2020 2020 2069 6620  p])..        if 
+00041bf0: 6861 735f 6463 6b3a 0d0a 2020 2020 2020  has_dck:..      
+00041c00: 2020 2020 2020 666f 7220 6463 6b20 696e        for dck in
+00041c10: 2064 6570 656e 6465 6e74 5f63 6869 6c64   dependent_child
+00041c20: 5f6b 6579 3a0d 0a20 2020 2020 2020 2020  _key:..         
+00041c30: 2020 2020 2020 206e 6577 5f72 656c 6174         new_relat
+00041c40: 696f 6e73 6869 7020 3d20 5b70 7265 6669  ionship = [prefi
+00041c50: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+00041c60: 795f 746d 702c 2064 636b 2e63 6f6c 756d  y_tmp, dck.colum
+00041c70: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
 00041c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041c90: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-00041ca0: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00041cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041cc0: 2020 2020 2020 2020 2020 2020 2061 7070               app
-00041cd0: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
-00041ce0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00041cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041d10: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
-00041d20: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
-00041d30: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
-00041d40: 696f 6e2c 2061 7070 6c69 6564 5f64 6174  ion, applied_dat
-00041d50: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
-00041d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00041d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041d80: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
-00041d90: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
-00041da0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
-00041db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041dc0: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
-00041dd0: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
-00041de0: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
-00041df0: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
-00041e00: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
-00041e10: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
-00041e20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00041e30: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00041e40: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
-00041e50: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
-00041e60: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00041e70: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
-00041e80: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
-00041e90: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
-00041ea0: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
-00041eb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00041ec0: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
-00041ed0: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
-00041ee0: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
-00041ef0: 6a6f 696e 2c20 746e 2e63 6f6c 756d 6e5f  join, tn.column_
-00041f00: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00041f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041ca0: 2020 2020 7072 6566 6978 5f65 7420 2b20      prefix_et + 
+00041cb0: 7361 745f 656e 7469 7479 5f61 6374 7561  sat_entity_actua
+00041cc0: 6c5f 696d 6167 655f 322c 0d0a 2020 2020  l_image_2,..    
+00041cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041cf0: 6463 6b2e 636f 6c75 6d6e 5f6e 616d 655f  dck.column_name_
+00041d00: 7461 7267 6574 2c20 224d 4153 5445 5220  target, "MASTER 
+00041d10: 4a4f 494e 222c 2073 656c 662e 6f77 6e65  JOIN", self.owne
+00041d20: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00041d30: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00041d40: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00041d50: 7279 5f64 6174 6173 6574 5f72 656c 6174  ry_dataset_relat
+00041d60: 696f 6e73 6869 7028 5b6e 6577 5f72 656c  ionship([new_rel
+00041d70: 6174 696f 6e73 6869 705d 290d 0a0d 0a20  ationship]).... 
+00041d80: 2020 2020 2020 206e 6577 5f66 696c 7465         new_filte
+00041d90: 7220 3d20 5b70 7265 6669 785f 6574 202b  r = [prefix_et +
+00041da0: 2073 6174 5f65 6e74 6974 795f 6a6f 696e   sat_entity_join
+00041db0: 2c20 2752 4e20 3d20 3127 2c20 7361 745f  , 'RN = 1', sat_
+00041dc0: 6e75 6d5f 6272 616e 6368 2c20 7365 6c66  num_branch, self
+00041dd0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00041de0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00041df0: 6374 7561 6c2e 6164 645f 656e 7472 795f  ctual.add_entry_
+00041e00: 6669 6c74 6572 7328 5b6e 6577 5f66 696c  filters([new_fil
+00041e10: 7465 725d 290d 0a0d 0a20 2020 2020 2020  ter])....       
+00041e20: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+00041e30: 2323 2323 2323 2323 2323 2323 2043 7265  ############ Cre
+00041e40: 6174 6520 456e 7469 7479 2053 4154 2023  ate Entity SAT #
+00041e50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00041e60: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
+00041e70: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00041e80: 7469 6f6e 203d 2031 0d0a 0d0a 2020 2020  tion = 1....    
+00041e90: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00041ea0: 6d61 7070 696e 6720 3d20 5b70 7265 6669  mapping = [prefi
+00041eb0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+00041ec0: 795f 6a6f 696e 2c20 6861 7368 5f6e 616d  y_join, hash_nam
+00041ed0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00041ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041ef0: 2020 2070 7265 6669 785f 6574 202b 2073     prefix_et + s
+00041f00: 6174 5f65 6e74 6974 792c 2068 6173 685f  at_entity, hash_
+00041f10: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
 00041f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041f30: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00041f40: 2073 6174 5f65 6e74 6974 792c 0d0a 2020   sat_entity,..  
-00041f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041f70: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
-00041f80: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00041f30: 2020 2020 2020 6861 7368 5f66 6f72 5f6d        hash_for_m
+00041f40: 6574 6164 6174 615b 305d 2c20 6f72 6469  etadata[0], ordi
+00041f50: 6e61 6c5f 706f 7369 7469 6f6e 2c20 6861  nal_position, ha
+00041f60: 7368 5f66 6f72 5f6d 6574 6164 6174 615b  sh_for_metadata[
+00041f70: 315d 2c20 6861 7368 5f66 6f72 5f6d 6574  1], hash_for_met
+00041f80: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
 00041f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041fb0: 2020 2020 746e 2e63 6f6c 756d 6e5f 7479      tn.column_ty
-00041fc0: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
-00041fd0: 616c 5f70 6f73 6974 696f 6e2c 2074 6e2e  al_position, tn.
-00041fe0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-00041ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042010: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
-00042020: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
-00042030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042050: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
-00042060: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
-00042070: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00042080: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00042090: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
-000420a0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
-000420b0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
-000420c0: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
-000420d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000420e0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000420f0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
-00042100: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00042110: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
-00042120: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
-00042130: 6f69 6e2c 2027 4441 5445 5f43 5245 4154  oin, 'DATE_CREAT
-00042140: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
+00041fa0: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
+00041fb0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
+00041fc0: 5045 5f48 4153 485f 4b45 592c 2031 2c20  PE_HASH_KEY, 1, 
+00041fd0: 7365 6c66 2e6f 776e 6572 5d0d 0a20 2020  self.owner]..   
+00041fe0: 2020 2020 206f 7264 696e 616c 5f70 6f73       ordinal_pos
+00041ff0: 6974 696f 6e20 2b3d 2031 0d0a 2020 2020  ition += 1..    
+00042000: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00042010: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00042020: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00042030: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00042040: 5f6d 6170 7069 6e67 5d29 0d0a 0d0a 2020  _mapping])....  
+00042050: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+00042060: 745f 6d61 7070 696e 6720 3d20 5b70 7265  t_mapping = [pre
+00042070: 6669 785f 6574 202b 2073 6174 5f65 6e74  fix_et + sat_ent
+00042080: 6974 795f 6a6f 696e 2c20 2748 4153 4844  ity_join, 'HASHD
+00042090: 4946 4627 2c0d 0a20 2020 2020 2020 2020  IFF',..         
+000420a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000420b0: 2020 2020 2020 7072 6566 6978 5f65 7420        prefix_et 
+000420c0: 2b20 7361 745f 656e 7469 7479 2c20 2748  + sat_entity, 'H
+000420d0: 4153 4844 4946 4627 2c0d 0a20 2020 2020  ASHDIFF',..     
+000420e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000420f0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
+00042100: 6f72 5f6d 6574 6164 6174 615b 305d 2c20  or_metadata[0], 
+00042110: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00042120: 2c20 6861 7368 5f66 6f72 5f6d 6574 6164  , hash_for_metad
+00042130: 6174 615b 315d 2c20 6861 7368 5f66 6f72  ata[1], hash_for
+00042140: 5f6d 6574 6164 6174 615b 325d 2c0d 0a20  _metadata[2],.. 
 00042150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042160: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
-00042170: 2073 6174 5f65 6e74 6974 792c 2027 4441   sat_entity, 'DA
-00042180: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
-00042190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000421a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-000421b0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-000421c0: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
-000421d0: 7369 7469 6f6e 2c20 7379 7364 6174 655f  sition, sysdate_
-000421e0: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
-000421f0: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
-00042200: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
-00042210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042220: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-00042230: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
-00042240: 5045 5f4e 554c 4c2c 2031 2c20 7365 6c66  PE_NULL, 1, self
-00042250: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00042260: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00042270: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
-00042280: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00042290: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
-000422a0: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
-000422b0: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
-000422c0: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
-000422d0: 2020 6966 2068 6173 5f64 636b 3a0d 0a20    if has_dck:.. 
-000422e0: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-000422f0: 636b 2069 6e20 6465 7065 6e64 656e 745f  ck in dependent_
-00042300: 6368 696c 645f 6b65 793a 0d0a 2020 2020  child_key:..    
-00042310: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00042320: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00042330: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00042340: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
-00042350: 6463 6b2e 636f 6c75 6d6e 5f6e 616d 655f  dck.column_name_
-00042360: 7461 7267 6574 2c20 7072 6566 6978 5f65  target, prefix_e
-00042370: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
-00042380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042160: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00042170: 745f 6e75 6d5f 6272 616e 6368 2c20 4b45  t_num_branch, KE
+00042180: 595f 5459 5045 5f48 4153 4844 4946 462c  Y_TYPE_HASHDIFF,
+00042190: 2031 2c20 7365 6c66 2e6f 776e 6572 5d0d   1, self.owner].
+000421a0: 0a20 2020 2020 2020 206f 7264 696e 616c  .        ordinal
+000421b0: 5f70 6f73 6974 696f 6e20 2b3d 2031 0d0a  _position += 1..
+000421c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+000421d0: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+000421e0: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+000421f0: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00042200: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00042210: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+00042220: 5f72 733a 0d0a 2020 2020 2020 2020 2020  _rs:..          
+00042230: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00042240: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+00042250: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+00042260: 6a6f 696e 2c20 7265 636f 7264 5f73 6f75  join, record_sou
+00042270: 7263 652e 636f 6c75 6d6e 5f6e 616d 655f  rce.column_name_
+00042280: 7461 7267 6574 2c0d 0a20 2020 2020 2020  target,..       
+00042290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000422a0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+000422b0: 6978 5f65 7420 2b20 7361 745f 656e 7469  ix_et + sat_enti
+000422c0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
+000422d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000422e0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+000422f0: 6f75 7263 652e 636f 6c75 6d6e 5f6e 616d  ource.column_nam
+00042300: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+00042310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042320: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00042330: 636f 7264 5f73 6f75 7263 652e 636f 6c75  cord_source.colu
+00042340: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+00042350: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00042360: 2c20 7265 636f 7264 5f73 6f75 7263 652e  , record_source.
+00042370: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+00042380: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00042390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000423a0: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
-000423b0: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
-000423c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000423a0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+000423b0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+000423c0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
 000423d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000423e0: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
-000423f0: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
-00042400: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-00042410: 2c20 6463 6b2e 636f 6c75 6d6e 5f6c 656e  , dck.column_len
-00042420: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-00042430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042440: 2020 2020 2020 2020 2020 2020 2064 636b               dck
-00042450: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-00042460: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00042470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042480: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
-00042490: 595f 5459 5045 5f44 4550 454e 4445 4e54  Y_TYPE_DEPENDENT
-000424a0: 5f43 4849 4c44 5f4b 4559 2c20 312c 2073  _CHILD_KEY, 1, s
-000424b0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-000424c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000424d0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000424e0: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
-000424f0: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
-00042500: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00042510: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00042520: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-00042530: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-00042540: 2020 2020 2066 6f72 2061 7420 696e 2061       for at in a
-00042550: 6c6c 5f61 7474 7269 6275 7465 733a 0d0a  ll_attributes:..
-00042560: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00042570: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
-00042580: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
-00042590: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
-000425a0: 6174 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  at.column_name_t
-000425b0: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
-000425c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000425d0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-000425e0: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
-000425f0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-00042600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042610: 2020 2020 2020 2061 742e 636f 6c75 6d6e         at.column
-00042620: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
-00042630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042650: 2020 6174 2e63 6f6c 756d 6e5f 7479 7065    at.column_type
-00042660: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
-00042670: 5f70 6f73 6974 696f 6e2c 2061 742e 636f  _position, at.co
-00042680: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
-00042690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000426a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000426b0: 2061 742e 636f 6c75 6d6e 5f70 7265 6369   at.column_preci
-000426c0: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
-000426d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000426e0: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
-000426f0: 6d5f 6272 616e 6368 2c20 6174 2e6b 6579  m_branch, at.key
-00042700: 5f74 7970 652c 2031 2c20 7365 6c66 2e6f  _type, 1, self.o
-00042710: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
-00042720: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00042730: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00042740: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00042750: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00042760: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
-00042770: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
-00042780: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
-00042790: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
-000427a0: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
-000427b0: 2b20 7361 745f 656e 7469 7479 2c20 6861  + sat_entity, ha
-000427c0: 7368 5f6e 616d 6520 2b20 225f 4849 5354  sh_name + "_HIST
-000427d0: 2069 7320 6e75 6c6c 222c 2073 6174 5f6e   is null", sat_n
-000427e0: 756d 5f62 7261 6e63 682c 2073 656c 662e  um_branch, self.
-000427f0: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
-00042800: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00042810: 7475 616c 2e61 6464 5f65 6e74 7279 5f66  tual.add_entry_f
-00042820: 696c 7465 7273 285b 6e65 775f 6669 6c74  ilters([new_filt
-00042830: 6572 5d29 0d0a 0d0a 2020 2020 2020 2020  er])....        
-00042840: 7365 6c66 2e6c 6f67 2e6c 6f67 2873 656c  self.log.log(sel
-00042850: 662e 656e 6769 6e65 5f6e 616d 652c 2022  f.engine_name, "
-00042860: 4669 6e69 7368 6564 2074 6f20 7072 6f63  Finished to proc
-00042870: 6573 7320 4d65 7461 6461 7461 205b 204c  ess Metadata [ L
-00042880: 696e 6b20 7361 7465 6c6c 6974 6573 202d  ink satellites -
-00042890: 206e 6f6e 2063 6463 205d 2069 6e66 6f72   non cdc ] infor
-000428a0: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
-000428b0: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
-000428c0: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
-000428d0: 6476 5f6c 696e 6b5f 6372 6561 7469 6f6e  dv_link_creation
-000428e0: 5f73 6174 5f63 6463 2873 656c 662c 206c  _sat_cdc(self, l
-000428f0: 696e 6b2c 2073 6174 293a 0d0a 2020 2020  ink, sat):..    
-00042900: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
-00042910: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
-00042920: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
-00042930: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
-00042940: 205b 204c 696e 6b20 7361 7465 6c6c 6974   [ Link satellit
-00042950: 6573 202d 2063 6463 205d 2069 6e66 6f72  es - cdc ] infor
-00042960: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
-00042970: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 2020  EL_ONLY_LOG)..  
-00042980: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
-00042990: 7369 7469 6f6e 203d 2031 0d0a 2020 2020  sition = 1..    
-000429a0: 2020 2020 7072 6566 6978 5f65 7420 3d20      prefix_et = 
-000429b0: 2745 545f 270d 0a20 2020 2020 2020 2073  'ET_'..        s
-000429c0: 6174 5f63 6f64 5f65 6e74 6974 795f 736f  at_cod_entity_so
-000429d0: 7572 6365 203d 2073 6174 5b30 5d0d 0a20  urce = sat[0].. 
-000429e0: 2020 2020 2020 2073 6174 5f63 6f64 5f65         sat_cod_e
-000429f0: 6e74 6974 795f 7461 7267 6574 203d 2073  ntity_target = s
-00042a00: 6174 5b31 5d0d 0a20 2020 2020 2020 2073  at[1]..        s
-00042a10: 6174 5f6e 616d 6520 3d20 7361 745b 325d  at_name = sat[2]
-00042a20: 0d0a 2020 2020 2020 2020 7361 745f 6e75  ..        sat_nu
-00042a30: 6d5f 6272 616e 6368 203d 2031 2023 2053  m_branch = 1 # S
-00042a40: 6174 2063 616e 2774 2068 6176 6520 6d6f  at can't have mo
-00042a50: 7265 2074 6861 6e20 6f6e 6520 6272 616e  re than one bran
-00042a60: 6368 202d 3e20 7361 745b 335d 0d0a 2020  ch -> sat[3]..  
-00042a70: 2020 2020 2020 7361 745f 656e 7469 7479        sat_entity
-00042a80: 203d 2073 6174 5f6e 616d 650d 0a0d 0a20   = sat_name.... 
-00042a90: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
-00042aa0: 203d 2027 4841 5348 5f27 202b 206c 696e   = 'HASH_' + lin
-00042ab0: 6b2e 656e 7469 7479 5f6e 616d 650d 0a20  k.entity_name.. 
-00042ac0: 2020 2020 2020 2064 765f 7072 6f70 6572         dv_proper
-00042ad0: 7479 203d 2073 656c 662e 6d65 7461 6461  ty = self.metada
-00042ae0: 7461 5f61 6374 7561 6c2e 6765 745f 6476  ta_actual.get_dv
-00042af0: 5f70 726f 7065 7274 6965 735f 6672 6f6d  _properties_from
-00042b00: 5f63 6f64 5f65 6e74 6974 795f 616e 645f  _cod_entity_and_
-00042b10: 6e75 6d5f 636f 6e6e 6563 7469 6f6e 286c  num_connection(l
-00042b20: 696e 6b2e 636f 645f 656e 7469 7479 2c20  ink.cod_entity, 
-00042b30: 3029 0d0a 2020 2020 2020 2020 6966 2064  0)..        if d
-00042b40: 765f 7072 6f70 6572 7479 2069 7320 6e6f  v_property is no
-00042b50: 7420 4e6f 6e65 3a20 6861 7368 5f6e 616d  t None: hash_nam
-00042b60: 6520 3d20 6476 5f70 726f 7065 7274 792e  e = dv_property.
-00042b70: 6861 7368 5f6e 616d 650d 0a0d 0a20 2020  hash_name....   
-00042b80: 2020 2020 206e 6577 5f65 6e74 6974 795f       new_entity_
-00042b90: 7361 745f 656e 7469 7479 5f74 6d70 203d  sat_entity_tmp =
-00042ba0: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
-00042bb0: 745f 656e 7469 7479 2c20 7361 745f 656e  t_entity, sat_en
-00042bc0: 7469 7479 2c20 454e 5449 5459 5f54 422c  tity, ENTITY_TB,
-00042bd0: 206c 696e 6b2e 636f 645f 7061 7468 2c20   link.cod_path, 
-00042be0: 2749 4e53 4552 5427 2c20 7365 6c66 2e6f  'INSERT', self.o
-00042bf0: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
-00042c00: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00042c10: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
-00042c20: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
-00042c30: 5f73 6174 5f65 6e74 6974 795f 746d 705d  _sat_entity_tmp]
-00042c40: 290d 0a0d 0a20 2020 2020 2020 2068 6173  )....        has
-00042c50: 5f72 7320 3d20 4661 6c73 650d 0a20 2020  _rs = False..   
-00042c60: 2020 2020 2068 6173 5f74 6e20 3d20 4661       has_tn = Fa
-00042c70: 6c73 650d 0a20 2020 2020 2020 2068 6173  lse..        has
-00042c80: 5f61 6420 3d20 4661 6c73 650d 0a20 2020  _ad = False..   
-00042c90: 2020 2020 2074 656e 616e 745f 736f 7572       tenant_sour
-00042ca0: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
-00042cb0: 7461 5f61 6374 7561 6c2e 6765 745f 7465  ta_actual.get_te
-00042cc0: 6e61 6e74 5f6f 6e5f 6476 5f66 726f 6d5f  nant_on_dv_from_
-00042cd0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-00042ce0: 745f 616e 645f 6e75 6d5f 6272 616e 6368  t_and_num_branch
-00042cf0: 2873 6174 5f63 6f64 5f65 6e74 6974 795f  (sat_cod_entity_
-00042d00: 7461 7267 6574 2c20 7361 745f 6e75 6d5f  target, sat_num_
-00042d10: 6272 616e 6368 290d 0a20 2020 2020 2020  branch)..       
-00042d20: 2069 6620 6c65 6e28 7465 6e61 6e74 5f73   if len(tenant_s
-00042d30: 6f75 7263 6529 2021 3d20 303a 0d0a 2020  ource) != 0:..  
-00042d40: 2020 2020 2020 2020 2020 6861 735f 746e            has_tn
-00042d50: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00042d60: 2020 2020 2023 2047 6574 2064 6973 7469       # Get disti
-00042d70: 6e63 7420 6672 6f6d 2054 454e 414e 5453  nct from TENANTS
-00042d80: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
-00042d90: 6e61 6c5f 7465 6e61 6e74 5f6c 6973 7420  nal_tenant_list 
-00042da0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
-00042db0: 2020 666f 7220 746e 2069 6e20 7465 6e61    for tn in tena
-00042dc0: 6e74 5f73 6f75 7263 653a 0d0a 2020 2020  nt_source:..    
-00042dd0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00042de0: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
-00042df0: 7267 6574 206e 6f74 2069 6e20 5b78 2e63  rget not in [x.c
-00042e00: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
-00042e10: 7420 666f 7220 7820 696e 0d0a 2020 2020  t for x in..    
-00042e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042e40: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-00042e50: 616c 5f74 656e 616e 745f 6c69 7374 5d3a  al_tenant_list]:
-00042e60: 2066 696e 616c 5f74 656e 616e 745f 6c69   final_tenant_li
-00042e70: 7374 2e61 7070 656e 6428 746e 290d 0a20  st.append(tn).. 
-00042e80: 2020 2020 2020 2020 2020 2074 656e 616e             tenan
-00042e90: 745f 736f 7572 6365 203d 2066 696e 616c  t_source = final
-00042ea0: 5f74 656e 616e 745f 6c69 7374 0d0a 2020  _tenant_list..  
-00042eb0: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
-00042ec0: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
-00042ed0: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
-00042ee0: 6563 6f72 645f 736f 7572 6365 5f6f 6e5f  ecord_source_on_
-00042ef0: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
-00042f00: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
-00042f10: 6d5f 6272 616e 6368 2873 6174 5f63 6f64  m_branch(sat_cod
-00042f20: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
-00042f30: 7361 745f 6e75 6d5f 6272 616e 6368 290d  sat_num_branch).
-00042f40: 0a20 2020 2020 2020 2069 6620 7265 636f  .        if reco
-00042f50: 7264 5f73 6f75 7263 6520 6973 206e 6f74  rd_source is not
-00042f60: 204e 6f6e 653a 2068 6173 5f72 7320 3d20   None: has_rs = 
-00042f70: 5472 7565 0d0a 2020 2020 2020 2020 6170  True..        ap
-00042f80: 706c 6965 645f 6461 7465 203d 2073 656c  plied_date = sel
-00042f90: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00042fa0: 6c2e 6765 745f 6170 706c 6965 645f 6461  l.get_applied_da
-00042fb0: 7465 5f6f 6e5f 6476 5f66 726f 6d5f 636f  te_on_dv_from_co
-00042fc0: 645f 656e 7469 7479 5f74 6172 6765 7428  d_entity_target(
-00042fd0: 6c69 6e6b 2e63 6f64 5f65 6e74 6974 792c  link.cod_entity,
-00042fe0: 2073 6174 5b33 5d29 0d0a 2020 2020 2020   sat[3])..      
-00042ff0: 2020 6966 2061 7070 6c69 6564 5f64 6174    if applied_dat
-00043000: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
-00043010: 6173 5f61 6420 3d20 5472 7565 0d0a 0d0a  as_ad = True....
-00043020: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
-00043030: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
-00043040: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
-00043050: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
-00043060: 6128 290d 0a20 2020 2020 2020 206d 6435  a()..        md5
-00043070: 5f66 756e 6374 696f 6e20 3d20 7365 6c66  _function = self
-00043080: 2e67 6574 5f68 6173 685f 6b65 795f 6672  .get_hash_key_fr
-00043090: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
-000430a0: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
-000430b0: 6e63 6828 7361 745f 636f 645f 656e 7469  nch(sat_cod_enti
-000430c0: 7479 5f74 6172 6765 742c 2073 6174 5b33  ty_target, sat[3
-000430d0: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
-000430e0: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-000430f0: 6720 3d20 5b73 6174 5f63 6f64 5f65 6e74  g = [sat_cod_ent
-00043100: 6974 795f 736f 7572 6365 2c20 6d64 355f  ity_source, md5_
-00043110: 6675 6e63 7469 6f6e 2c20 7072 6566 6978  function, prefix
-00043120: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
-00043130: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00043140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043150: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
-00043160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043170: 2020 2020 2020 2020 2020 2020 2068 6173               has
-00043180: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
-00043190: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
-000431a0: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
-000431b0: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
-000431c0: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
-000431d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000431e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000431f0: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
-00043200: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
-00043210: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
-00043220: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
-00043230: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
-00043240: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
-00043250: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00043260: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-00043270: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-00043280: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-00043290: 290d 0a0d 0a20 2020 2020 2020 2073 7973  )....        sys
-000432a0: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
-000432b0: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
-000432c0: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
-000432d0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-000432e0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-000432f0: 7365 745f 6d61 7070 696e 6720 3d20 5b27  set_mapping = ['
-00043300: 272c 2073 656c 662e 636f 6e6e 6563 7469  ', self.connecti
-00043310: 6f6e 2e67 6574 5f73 7973 6461 7465 5f76  on.get_sysdate_v
-00043320: 616c 7565 2829 2c20 7072 6566 6978 5f65  alue(), prefix_e
-00043330: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
-00043340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043360: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
-00043370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043390: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
-000433a0: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
-000433b0: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
-000433c0: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
-000433d0: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
-000433e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000433f0: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
-00043400: 6d65 7461 6461 7461 5b32 5d2c 2073 6174  metadata[2], sat
-00043410: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
-00043420: 5f54 5950 455f 4e55 4c4c 2c20 312c 2073  _TYPE_NULL, 1, s
-00043430: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
-00043440: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00043450: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
-00043460: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
-00043470: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
-00043480: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
-00043490: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
-000434a0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
-000434b0: 2020 2020 2069 6620 6861 735f 7273 3a0d       if has_rs:.
-000434c0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000434d0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-000434e0: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
-000434f0: 7479 5f73 6f75 7263 652c 2072 6563 6f72  ty_source, recor
-00043500: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
-00043510: 6e61 6d65 5f73 6f75 7263 652c 0d0a 2020  name_source,..  
-00043520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043540: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
-00043550: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
-00043560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043570: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-00043580: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
-00043590: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
-000435a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000435b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000435c0: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
-000435d0: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-000435e0: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-000435f0: 6974 696f 6e2c 2072 6563 6f72 645f 736f  ition, record_so
-00043600: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
-00043610: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
-00043620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043630: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
-00043640: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
-00043650: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
-00043660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043670: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
-00043680: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
-00043690: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
-000436a0: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
-000436b0: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
-000436c0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-000436d0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-000436e0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-000436f0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
-00043700: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
-00043710: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
-00043720: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
-00043730: 2020 2020 2069 6620 6861 735f 6164 3a0d       if has_ad:.
-00043740: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00043750: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
-00043760: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
-00043770: 7479 5f73 6f75 7263 652c 2061 7070 6c69  ty_source, appli
-00043780: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
-00043790: 616d 655f 736f 7572 6365 2c0d 0a20 2020  ame_source,..   
-000437a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000437b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000437c0: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
-000437d0: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-000437e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000437f0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-00043800: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
-00043810: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00043820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043840: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
-00043850: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
-00043860: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00043870: 6f6e 2c20 6170 706c 6965 645f 6461 7465  on, applied_date
-00043880: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-00043890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000438a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000438b0: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
-000438c0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-000438d0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-000438e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000438f0: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
-00043900: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
-00043910: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
-00043920: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
-00043930: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
-00043940: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
-00043950: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00043960: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00043970: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
-00043980: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
-00043990: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
-000439a0: 675d 290d 0a0d 0a20 2020 2020 2020 2069  g])....        i
-000439b0: 6620 6861 735f 746e 3a0d 0a20 2020 2020  f has_tn:..     
-000439c0: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
-000439d0: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
-000439e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000439f0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
-00043a00: 7069 6e67 203d 205b 7361 745f 636f 645f  ping = [sat_cod_
-00043a10: 656e 7469 7479 5f73 6f75 7263 652c 2074  entity_source, t
-00043a20: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 736f  n.column_name_so
-00043a30: 7572 6365 2c20 7072 6566 6978 5f65 7420  urce, prefix_et 
-00043a40: 2b20 7361 745f 656e 7469 7479 2c0d 0a20  + sat_entity,.. 
-00043a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043a70: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
-00043a80: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
-00043a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043ab0: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f74       tn.column_t
-00043ac0: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
-00043ad0: 6e61 6c5f 706f 7369 7469 6f6e 2c20 746e  nal_position, tn
-00043ae0: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-00043af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043b10: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
-00043b20: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
-00043b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043b50: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
-00043b60: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
-00043b70: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
-00043b80: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00043b90: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
-00043ba0: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
-00043bb0: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
-00043bc0: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
-00043bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043be0: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
-00043bf0: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
-00043c00: 2020 616c 6c5f 6174 7472 6962 7574 6573    all_attributes
-00043c10: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00043c20: 5f61 6374 7561 6c2e 6765 745f 6174 7472  _actual.get_attr
-00043c30: 6962 7574 6573 5f6f 6e5f 6476 5f66 726f  ibutes_on_dv_fro
-00043c40: 6d5f 7361 7465 6c6c 6974 655f 6e61 6d65  m_satellite_name
-00043c50: 2873 6174 5f65 6e74 6974 7929 0d0a 0d0a  (sat_entity)....
-00043c60: 2020 2020 2020 2020 666f 7220 6174 2069          for at i
-00043c70: 6e20 616c 6c5f 6174 7472 6962 7574 6573  n all_attributes
-00043c80: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
-00043c90: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
-00043ca0: 6e67 203d 205b 6174 2e63 6f64 5f65 6e74  ng = [at.cod_ent
-00043cb0: 6974 795f 736f 7572 6365 2c20 6174 2e63  ity_source, at.c
-00043cc0: 6f6c 756d 6e5f 6e61 6d65 5f73 6f75 7263  olumn_name_sourc
-00043cd0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00043ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043cf0: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
-00043d00: 202b 2073 6174 5f65 6e74 6974 792c 0d0a   + sat_entity,..
-00043d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043d30: 2020 2061 742e 636f 6c75 6d6e 5f6e 616d     at.column_nam
-00043d40: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
-00043d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043d60: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00043d70: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
-00043d80: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
-00043d90: 6974 696f 6e2c 2061 742e 636f 6c75 6d6e  ition, at.column
-00043da0: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
-00043db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043dc0: 2020 2020 2020 2020 2020 2020 2061 742e               at.
-00043dd0: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
-00043de0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00043df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043e00: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
-00043e10: 616e 6368 2c20 6174 2e6b 6579 5f74 7970  anch, at.key_typ
-00043e20: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
-00043e30: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
-00043e40: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00043e50: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
-00043e60: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
-00043e70: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
-00043e80: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-00043e90: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
-00043ea0: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
-00043eb0: 2020 2020 6d64 355f 6675 6e63 7469 6f6e      md5_function
-00043ec0: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
-00043ed0: 6f6e 2e67 6574 5f6d 6435 5f66 756e 6374  on.get_md5_funct
-00043ee0: 696f 6e28 290d 0a20 2020 2020 2020 2063  ion()..        c
-00043ef0: 6173 745f 746f 5f73 7472 696e 6720 3d20  ast_to_string = 
-00043f00: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
-00043f10: 6765 745f 6361 7374 5f73 7472 696e 675f  get_cast_string_
-00043f20: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
-00043f30: 0d0a 2020 2020 2020 2020 626b 5f63 6f6e  ..        bk_con
-00043f40: 6361 7465 6e61 7465 203d 2027 270d 0a20  catenate = ''.. 
-00043f50: 2020 2020 2020 2066 6f72 2061 7420 696e         for at in
-00043f60: 2061 6c6c 5f61 7474 7269 6275 7465 733a   all_attributes:
-00043f70: 0d0a 2020 2020 2020 2020 2020 2020 626b  ..            bk
-00043f80: 5f66 696e 616c 203d 2063 6173 745f 746f  _final = cast_to
-00043f90: 5f73 7472 696e 672e 7265 706c 6163 6528  _string.replace(
-00043fa0: 275b 785d 272c 2061 742e 636f 6c75 6d6e  '[x]', at.column
-00043fb0: 5f6e 616d 655f 736f 7572 6365 290d 0a20  _name_source).. 
-00043fc0: 2020 2020 2020 2020 2020 2062 6b5f 636f             bk_co
-00043fd0: 6e63 6174 656e 6174 6520 2b3d 2062 6b5f  ncatenate += bk_
-00043fe0: 6669 6e61 6c20 2b20 227c 7c27 2220 2b20  final + "||'" + 
-00043ff0: 7365 6c66 2e6d 6f64 756c 655f 6476 5f63  self.module_dv_c
-00044000: 6861 725f 7365 7061 7261 746f 725f 6e61  har_separator_na
-00044010: 6d69 6e67 202b 2022 277c 7c22 0d0a 2020  ming + "'||"..  
-00044020: 2020 2020 2020 626b 5f63 6f6e 6361 7465        bk_concate
-00044030: 6e61 7465 203d 2062 6b5f 636f 6e63 6174  nate = bk_concat
-00044040: 656e 6174 655b 3a2d 325d 0d0a 2020 2020  enate[:-2]..    
-00044050: 2020 2020 6861 7364 6966 6620 3d20 6d64      hasdiff = md
-00044060: 355f 6675 6e63 7469 6f6e 2e72 6570 6c61  5_function.repla
-00044070: 6365 2827 5b78 5d27 2c20 626b 5f63 6f6e  ce('[x]', bk_con
-00044080: 6361 7465 6e61 7465 290d 0a20 2020 2020  catenate)..     
-00044090: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
-000440a0: 6170 7069 6e67 203d 205b 616c 6c5f 6174  apping = [all_at
-000440b0: 7472 6962 7574 6573 5b30 5d2e 636f 645f  tributes[0].cod_
-000440c0: 656e 7469 7479 5f73 6f75 7263 652c 2068  entity_source, h
-000440d0: 6173 6469 6666 2c0d 0a20 2020 2020 2020  asdiff,..       
-000440e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000440f0: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
-00044100: 7420 2b20 7361 745f 656e 7469 7479 2c20  t + sat_entity, 
-00044110: 2748 4153 4844 4946 4627 2c0d 0a20 2020  'HASHDIFF',..   
-00044120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044130: 2020 2020 2020 2020 2020 2020 6861 7368              hash
-00044140: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
-00044150: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
-00044160: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
-00044170: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
-00044180: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
-00044190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000441a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000441b0: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
-000441c0: 4b45 595f 5459 5045 5f48 4153 4844 4946  KEY_TYPE_HASHDIF
-000441d0: 462c 2031 2c20 7365 6c66 2e6f 776e 6572  F, 1, self.owner
-000441e0: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-000441f0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00044200: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
-00044210: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
-00044220: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
-00044230: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00044240: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
-00044250: 6e67 696e 655f 6e61 6d65 2c20 2246 696e  ngine_name, "Fin
-00044260: 6973 6865 6420 746f 2070 726f 6365 7373  ished to process
-00044270: 204d 6574 6164 6174 6120 5b20 4c69 6e6b   Metadata [ Link
-00044280: 2073 6174 656c 6c69 7465 7320 2d20 6364   satellites - cd
-00044290: 6320 5d20 696e 666f 726d 6174 696f 6e22  c ] information"
-000442a0: 2c20 4c4f 475f 4c45 5645 4c5f 4f4e 4c59  , LOG_LEVEL_ONLY
-000442b0: 5f4c 4f47 290d 0a0d 0a20 2020 2064 6566  _LOG)....    def
-000442c0: 2070 726f 6365 7373 5f64 765f 7072 6f70   process_dv_prop
-000442d0: 6572 7469 6573 2873 656c 6629 3a0d 0a20  erties(self):.. 
-000442e0: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
-000442f0: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
-00044300: 6e61 6d65 2c20 2253 7461 7274 696e 6720  name, "Starting 
-00044310: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
-00044320: 6174 6120 5b20 4456 2050 726f 7065 7274  ata [ DV Propert
-00044330: 6965 7320 5d20 696e 666f 726d 6174 696f  ies ] informatio
-00044340: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
-00044350: 4c59 5f4c 4f47 290d 0a20 2020 2020 2020  LY_LOG)..       
-00044360: 2061 6c6c 5f65 6e74 6974 6965 7320 3d20   all_entities = 
-00044370: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
-00044380: 656e 7472 7920 696e 205b 7820 666f 7220  entry in [x for 
-00044390: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
-000443a0: 7461 5f61 6374 7561 6c2e 656e 7472 795f  ta_actual.entry_
-000443b0: 6476 5f65 6e74 6974 795d 3a0d 0a20 2020  dv_entity]:..   
-000443c0: 2020 2020 2020 2020 206e 6577 5f65 6e74           new_ent
-000443d0: 6974 7920 3d20 5b65 6e74 7279 2e65 6e74  ity = [entry.ent
-000443e0: 6974 795f 6e61 6d65 2c20 656e 7472 792e  ity_name, entry.
-000443f0: 656e 7469 7479 5f74 7970 655d 0d0a 2020  entity_type]..  
-00044400: 2020 2020 2020 2020 2020 6966 206e 6577            if new
-00044410: 5f65 6e74 6974 7920 6e6f 7420 696e 2061  _entity not in a
-00044420: 6c6c 5f65 6e74 6974 6965 733a 2061 6c6c  ll_entities: all
-00044430: 5f65 6e74 6974 6965 732e 6170 7065 6e64  _entities.append
-00044440: 286e 6577 5f65 6e74 6974 7929 0d0a 2020  (new_entity)..  
-00044450: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
-00044460: 696e 205b 7820 666f 7220 7820 696e 2073  in [x for x in s
-00044470: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00044480: 7561 6c2e 656e 7472 795f 6476 5f65 6e74  ual.entry_dv_ent
-00044490: 6974 795d 3a0d 0a20 2020 2020 2020 2020  ity]:..         
-000444a0: 2020 2069 6620 656e 7472 792e 6e61 6d65     if entry.name
-000444b0: 5f73 7461 7475 735f 7472 6163 6b69 6e67  _status_tracking
-000444c0: 5f73 6174 656c 6c69 7465 2069 7320 4e6f  _satellite is No
-000444d0: 6e65 206f 7220 656e 7472 792e 6e61 6d65  ne or entry.name
-000444e0: 5f73 7461 7475 735f 7472 6163 6b69 6e67  _status_tracking
-000444f0: 5f73 6174 656c 6c69 7465 3d3d 2727 3a20  _satellite=='': 
-00044500: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
-00044510: 2020 2020 2020 6e65 775f 656e 7469 7479        new_entity
-00044520: 203d 205b 656e 7472 792e 6e61 6d65 5f73   = [entry.name_s
-00044530: 7461 7475 735f 7472 6163 6b69 6e67 5f73  tatus_tracking_s
-00044540: 6174 656c 6c69 7465 2c20 454e 5449 5459  atellite, ENTITY
-00044550: 5f53 5453 5d0d 0a20 2020 2020 2020 2020  _STS]..         
-00044560: 2020 2069 6620 6e65 775f 656e 7469 7479     if new_entity
-00044570: 206e 6f74 2069 6e20 616c 6c5f 656e 7469   not in all_enti
-00044580: 7469 6573 3a20 616c 6c5f 656e 7469 7469  ties: all_entiti
-00044590: 6573 2e61 7070 656e 6428 6e65 775f 656e  es.append(new_en
-000445a0: 7469 7479 290d 0a20 2020 2020 2020 2066  tity)..        f
-000445b0: 6f72 2065 6e74 7279 2069 6e20 5b78 2066  or entry in [x f
-000445c0: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-000445d0: 6164 6174 615f 6163 7475 616c 2e65 6e74  adata_actual.ent
-000445e0: 7279 5f64 765f 656e 7469 7479 5d3a 0d0a  ry_dv_entity]:..
-000445f0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00044600: 6e74 7279 2e6e 616d 655f 7265 636f 7264  ntry.name_record
-00044610: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
-00044620: 6974 6520 6973 204e 6f6e 6520 6f72 2065  ite is None or e
-00044630: 6e74 7279 2e6e 616d 655f 7265 636f 7264  ntry.name_record
-00044640: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
-00044650: 6974 6520 3d3d 2027 273a 2063 6f6e 7469  ite == '': conti
-00044660: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
-00044670: 206e 6577 5f65 6e74 6974 7920 3d20 5b65   new_entity = [e
-00044680: 6e74 7279 2e6e 616d 655f 7265 636f 7264  ntry.name_record
-00044690: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
-000446a0: 6974 652c 2045 4e54 4954 595f 5254 535d  ite, ENTITY_RTS]
-000446b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000446c0: 206e 6577 5f65 6e74 6974 7920 6e6f 7420   new_entity not 
-000446d0: 696e 2061 6c6c 5f65 6e74 6974 6965 733a  in all_entities:
-000446e0: 2061 6c6c 5f65 6e74 6974 6965 732e 6170   all_entities.ap
-000446f0: 7065 6e64 286e 6577 5f65 6e74 6974 7929  pend(new_entity)
-00044700: 0d0a 2020 2020 2020 2020 666f 7220 656e  ..        for en
-00044710: 7472 7920 696e 205b 7820 666f 7220 7820  try in [x for x 
-00044720: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
-00044730: 5f61 6374 7561 6c2e 656e 7472 795f 6476  _actual.entry_dv
-00044740: 5f65 6e74 6974 795d 3a0d 0a20 2020 2020  _entity]:..     
-00044750: 2020 2020 2020 2069 6620 656e 7472 792e         if entry.
-00044760: 6e61 6d65 5f65 6666 6563 7469 7669 7479  name_effectivity
-00044770: 5f73 6174 656c 6c69 7465 2069 7320 4e6f  _satellite is No
-00044780: 6e65 206f 7220 656e 7472 792e 6e61 6d65  ne or entry.name
-00044790: 5f65 6666 6563 7469 7669 7479 5f73 6174  _effectivity_sat
-000447a0: 656c 6c69 7465 203d 3d20 2727 3a20 636f  ellite == '': co
-000447b0: 6e74 696e 7565 0d0a 2020 2020 2020 2020  ntinue..        
-000447c0: 2020 2020 6e65 775f 656e 7469 7479 203d      new_entity =
-000447d0: 205b 656e 7472 792e 6e61 6d65 5f65 6666   [entry.name_eff
-000447e0: 6563 7469 7669 7479 5f73 6174 656c 6c69  ectivity_satelli
-000447f0: 7465 2c20 454e 5449 5459 5f53 4154 455d  te, ENTITY_SATE]
-00044800: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00044810: 206e 6577 5f65 6e74 6974 7920 6e6f 7420   new_entity not 
-00044820: 696e 2061 6c6c 5f65 6e74 6974 6965 733a  in all_entities:
-00044830: 2061 6c6c 5f65 6e74 6974 6965 732e 6170   all_entities.ap
-00044840: 7065 6e64 286e 6577 5f65 6e74 6974 7929  pend(new_entity)
-00044850: 0d0a 2020 2020 2020 2020 666f 7220 656e  ..        for en
-00044860: 7472 7920 696e 205b 7820 666f 7220 7820  try in [x for x 
-00044870: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
-00044880: 5f61 6374 7561 6c2e 656e 7472 795f 6476  _actual.entry_dv
-00044890: 5f6d 6170 7069 6e67 735d 3a0d 0a20 2020  _mappings]:..   
-000448a0: 2020 2020 2020 2020 2069 6620 656e 7472           if entr
-000448b0: 792e 7361 7465 6c6c 6974 655f 6e61 6d65  y.satellite_name
-000448c0: 2069 7320 4e6f 6e65 206f 7220 656e 7472   is None or entr
-000448d0: 792e 7361 7465 6c6c 6974 655f 6e61 6d65  y.satellite_name
-000448e0: 203d 3d20 2727 3a20 636f 6e74 696e 7565   == '': continue
-000448f0: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
-00044900: 775f 656e 7469 7479 203d 205b 656e 7472  w_entity = [entr
-00044910: 792e 7361 7465 6c6c 6974 655f 6e61 6d65  y.satellite_name
-00044920: 2c20 454e 5449 5459 5f53 4154 5d0d 0a20  , ENTITY_SAT].. 
-00044930: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
-00044940: 775f 656e 7469 7479 206e 6f74 2069 6e20  w_entity not in 
-00044950: 616c 6c5f 656e 7469 7469 6573 3a20 616c  all_entities: al
-00044960: 6c5f 656e 7469 7469 6573 2e61 7070 656e  l_entities.appen
-00044970: 6428 6e65 775f 656e 7469 7479 290d 0a0d  d(new_entity)...
-00044980: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-00044990: 5f61 6464 6564 203d 205b 5d0d 0a20 2020  _added = []..   
-000449a0: 2020 2020 2066 6f72 2065 6e74 7279 2069       for entry i
-000449b0: 6e20 616c 6c5f 656e 7469 7469 6573 3a0d  n all_entities:.
-000449c0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000449d0: 5f64 6174 6173 6574 5f69 6420 3d20 7365  _dataset_id = se
-000449e0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-000449f0: 6f61 642e 6765 745f 6461 7461 7365 745f  oad.get_dataset_
-00044a00: 6672 6f6d 5f64 6174 6173 6574 5f6e 616d  from_dataset_nam
-00044a10: 6528 656e 7472 795b 305d 292e 6964 5f64  e(entry[0]).id_d
-00044a20: 6174 6173 6574 0d0a 2020 2020 2020 2020  ataset..        
-00044a30: 2020 2020 6964 5f65 6e74 6974 795f 7479      id_entity_ty
-00044a40: 7065 203d 2073 656c 662e 6d65 7461 6461  pe = self.metada
-00044a50: 7461 5f61 6374 7561 6c2e 6765 745f 656e  ta_actual.get_en
-00044a60: 7469 7479 5f74 7970 655f 6672 6f6d 5f65  tity_type_from_e
-00044a70: 6e74 6974 795f 7479 7065 5f6e 616d 6528  ntity_type_name(
-00044a80: 656e 7472 795b 315d 292e 6964 5f65 6e74  entry[1]).id_ent
-00044a90: 6974 795f 7479 7065 0d0a 0d0a 2020 2020  ity_type....    
-00044aa0: 2020 2020 2020 2020 6f6c 645f 6461 7461          old_data
-00044ab0: 7365 745f 6476 203d 2073 656c 662e 6d65  set_dv = self.me
-00044ac0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-00044ad0: 745f 6461 7461 7365 745f 6476 5f66 726f  t_dataset_dv_fro
-00044ae0: 6d5f 6964 5f64 6174 6173 6574 286e 6577  m_id_dataset(new
-00044af0: 5f64 6174 6173 6574 5f69 6429 0d0a 0d0a  _dataset_id)....
-00044b00: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00044b10: 6c64 5f64 6174 6173 6574 5f64 7620 6973  ld_dataset_dv is
-00044b20: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00044b30: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-00044b40: 7365 745f 6476 203d 205b 6e65 775f 6461  set_dv = [new_da
-00044b50: 7461 7365 745f 6964 2c20 6964 5f65 6e74  taset_id, id_ent
-00044b60: 6974 795f 7479 7065 2c20 7365 6c66 2e6f  ity_type, self.o
-00044b70: 776e 6572 2c0d 0a20 2020 2020 2020 2020  wner,..         
-00044b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044ba0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e5f  self.connection_
-00044bb0: 6d65 7461 6461 7461 2e67 6574 5f73 7973  metadata.get_sys
-00044bc0: 6461 7465 5f76 616c 7565 2829 2c20 224e  date_value(), "N
-00044bd0: 554c 4c22 5d0d 0a20 2020 2020 2020 2020  ULL"]..         
-00044be0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-00044bf0: 6461 7461 5f74 6f5f 6c6f 6164 2e61 6464  data_to_load.add
-00044c00: 5f6f 6d5f 6461 7461 7365 745f 6476 285b  _om_dataset_dv([
-00044c10: 6e65 775f 6461 7461 7365 745f 6476 5d29  new_dataset_dv])
-00044c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00044c30: 2020 6461 7461 7365 745f 6164 6465 642e    dataset_added.
-00044c40: 6170 7065 6e64 286e 6577 5f64 6174 6173  append(new_datas
-00044c50: 6574 5f69 6429 0d0a 2020 2020 2020 2020  et_id)..        
-00044c60: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00044c70: 2020 2020 2020 2020 2020 2069 6620 6f6c             if ol
-00044c80: 645f 6461 7461 7365 745f 6476 2e69 645f  d_dataset_dv.id_
-00044c90: 656e 7469 7479 5f74 7970 6520 3d3d 2069  entity_type == i
-00044ca0: 645f 656e 7469 7479 5f74 7970 653a 0d0a  d_entity_type:..
-00044cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044cc0: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
-00044cd0: 6476 203d 205b 6f6c 645f 6461 7461 7365  dv = [old_datase
-00044ce0: 745f 6476 2e69 645f 6461 7461 7365 742c  t_dv.id_dataset,
-00044cf0: 206f 6c64 5f64 6174 6173 6574 5f64 762e   old_dataset_dv.
-00044d00: 6964 5f65 6e74 6974 795f 7479 7065 2c0d  id_entity_type,.
-00044d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00044d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044d40: 2020 2073 656c 662e 6f77 6e65 722c 2022     self.owner, "
-00044d50: 2722 202b 2073 7472 286f 6c64 5f64 6174  '" + str(old_dat
-00044d60: 6173 6574 5f64 762e 7374 6172 745f 6461  aset_dv.start_da
-00044d70: 7465 2920 2b20 2227 222c 2022 4e55 4c4c  te) + "'", "NULL
-00044d80: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-00044d90: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00044da0: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
-00044db0: 645f 6f6d 5f64 6174 6173 6574 5f64 7628  d_om_dataset_dv(
-00044dc0: 5b6e 6577 5f64 6174 6173 6574 5f64 765d  [new_dataset_dv]
-00044dd0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00044de0: 2020 2020 2020 2064 6174 6173 6574 5f61         dataset_a
-00044df0: 6464 6564 2e61 7070 656e 6428 6f6c 645f  dded.append(old_
-00044e00: 6461 7461 7365 745f 6476 2e69 645f 6461  dataset_dv.id_da
-00044e10: 7461 7365 7429 0d0a 2020 2020 2020 2020  taset)..        
-00044e20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00044e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044e40: 2020 206e 6577 5f64 6174 6173 6574 5f64     new_dataset_d
-00044e50: 7620 3d20 5b6f 6c64 5f64 6174 6173 6574  v = [old_dataset
-00044e60: 5f64 762e 6964 5f64 6174 6173 6574 2c20  _dv.id_dataset, 
-00044e70: 6f6c 645f 6461 7461 7365 745f 6476 2e69  old_dataset_dv.i
-00044e80: 645f 656e 7469 7479 5f74 7970 652c 0d0a  d_entity_type,..
-00044e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044ec0: 2020 7365 6c66 2e6f 776e 6572 2c20 2227    self.owner, "'
-00044ed0: 2220 2b20 7374 7228 6f6c 645f 6461 7461  " + str(old_data
-00044ee0: 7365 745f 6476 2e73 7461 7274 5f64 6174  set_dv.start_dat
-00044ef0: 6529 202b 2022 2722 2c0d 0a20 2020 2020  e) + "'",..     
-00044f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044f20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00044f30: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
-00044f40: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
-00044f50: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
-00044f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044f70: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-00044f80: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
-00044f90: 6173 6574 5f64 7628 5b6e 6577 5f64 6174  aset_dv([new_dat
-00044fa0: 6173 6574 5f64 765d 290d 0a0d 0a20 2020  aset_dv])....   
-00044fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044fc0: 206e 6577 5f64 6174 6173 6574 5f64 7620   new_dataset_dv 
-00044fd0: 3d20 5b6e 6577 5f64 6174 6173 6574 5f69  = [new_dataset_i
-00044fe0: 642c 2069 645f 656e 7469 7479 5f74 7970  d, id_entity_typ
-00044ff0: 652c 2073 656c 662e 6f77 6e65 722c 0d0a  e, self.owner,..
-00045000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00045030: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
-00045040: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
-00045050: 655f 7661 6c75 6528 292c 2022 4e55 4c4c  e_value(), "NULL
-00045060: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-00045070: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00045080: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
-00045090: 645f 6f6d 5f64 6174 6173 6574 5f64 7628  d_om_dataset_dv(
-000450a0: 5b6e 6577 5f64 6174 6173 6574 5f64 765d  [new_dataset_dv]
-000450b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000450c0: 2020 2020 2020 2064 6174 6173 6574 5f61         dataset_a
-000450d0: 6464 6564 2e61 7070 656e 6428 6e65 775f  dded.append(new_
-000450e0: 6461 7461 7365 745f 6964 290d 0a0d 0a20  dataset_id).... 
-000450f0: 2020 2020 2020 2066 6f72 2064 6174 6173         for datas
-00045100: 6574 5f64 7620 696e 205b 7820 666f 7220  et_dv in [x for 
-00045110: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
-00045120: 7461 5f61 6374 7561 6c2e 6f6d 5f64 6174  ta_actual.om_dat
-00045130: 6173 6574 5f64 7620 6966 2078 2e65 6e64  aset_dv if x.end
-00045140: 5f64 6174 6520 6973 204e 6f6e 655d 3a0d  _date is None]:.
-00045150: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00045160: 6461 7461 7365 745f 6476 2e69 645f 6461  dataset_dv.id_da
-00045170: 7461 7365 7420 6e6f 7420 696e 2064 6174  taset not in dat
-00045180: 6173 6574 5f61 6464 6564 3a0d 0a0d 0a20  aset_added:.... 
-00045190: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000451a0: 6f74 5f61 7272 6976 696e 675f 6461 7461  ot_arriving_data
-000451b0: 7365 745f 6578 6563 7574 696f 6e20 3d20  set_execution = 
-000451c0: 5b64 6174 6173 6574 5f64 762e 6964 5f64  [dataset_dv.id_d
-000451d0: 6174 6173 6574 2c20 6461 7461 7365 745f  ataset, dataset_
-000451e0: 6476 2e69 645f 656e 7469 7479 5f74 7970  dv.id_entity_typ
-000451f0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00045200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045220: 2020 2020 2020 7365 6c66 2e6f 776e 6572        self.owner
-00045230: 2c20 2227 2220 2b20 7374 7228 6461 7461  , "'" + str(data
-00045240: 7365 745f 6476 2e73 7461 7274 5f64 6174  set_dv.start_dat
-00045250: 6529 202b 2022 2722 2c0d 0a20 2020 2020  e) + "'",..     
-00045260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00045290: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
-000452a0: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
-000452b0: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
-000452c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000452d0: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
-000452e0: 642e 6164 645f 6f6d 5f64 6174 6173 6574  d.add_om_dataset
-000452f0: 5f64 7628 5b6e 6f74 5f61 7272 6976 696e  _dv([not_arrivin
-00045300: 675f 6461 7461 7365 745f 6578 6563 7574  g_dataset_execut
-00045310: 696f 6e5d 290d 0a0d 0a20 2020 2020 2020  ion])....       
-00045320: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
-00045330: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
-00045340: 2246 696e 6973 6865 6420 746f 2070 726f  "Finished to pro
-00045350: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
-00045360: 4456 2050 726f 7065 7274 6965 7320 5d20  DV Properties ] 
-00045370: 696e 666f 726d 6174 696f 6e22 2c20 4c4f  information", LO
-00045380: 475f 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47  G_LEVEL_ONLY_LOG
-00045390: 290d 0a0d 0a20 2020 2064 6566 2070 726f  )....    def pro
-000453a0: 6365 7373 5f65 6c74 5f73 6f75 7263 6573  cess_elt_sources
-000453b0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-000453c0: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
-000453d0: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
-000453e0: 2253 7461 7274 696e 6720 746f 2070 726f  "Starting to pro
-000453f0: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
-00045400: 536f 7572 6365 7320 5d20 696e 666f 726d  Sources ] inform
-00045410: 6174 696f 6e22 2c20 4c4f 475f 4c45 5645  ation", LOG_LEVE
-00045420: 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20 2020  L_ONLY_LOG)..   
-00045430: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00045440: 2323 2323 2323 2323 2323 2323 2320 4c4f  ############# LO
-00045450: 4144 2053 4f55 5243 4553 2061 6e64 2053  AD SOURCES and S
-00045460: 5045 4349 4649 4341 5449 4f4e 5320 2323  PECIFICATIONS ##
-00045470: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00045480: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00045490: 6e65 7874 5f69 645f 6461 7461 7365 7420  next_id_dataset 
-000454a0: 3d20 7365 6c66 2e6e 6578 745f 6964 5f64  = self.next_id_d
-000454b0: 6174 6173 6574 0d0a 2020 2020 2020 2020  ataset..        
-000454c0: 6e65 7874 5f69 645f 6461 7461 7365 745f  next_id_dataset_
-000454d0: 7370 6563 203d 2073 656c 662e 6e65 7874  spec = self.next
-000454e0: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
-000454f0: 0d0a 2020 2020 2020 2020 736f 7572 6365  ..        source
-00045500: 735f 6c6f 6164 6564 203d 205b 5d0d 0a20  s_loaded = [].. 
-00045510: 2020 2020 2020 2073 6f75 7263 6573 5f73         sources_s
-00045520: 7065 6373 5f6c 6f61 6465 6420 3d20 5b5d  pecs_loaded = []
-00045530: 0d0a 0d0a 2020 2020 2020 2020 2320 496e  ....        # In
-00045540: 7075 7420 536f 7572 6365 730d 0a20 2020  put Sources..   
-00045550: 2020 2020 2066 6f72 2065 6e74 6974 7920       for entity 
-00045560: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
-00045570: 5f61 6374 7561 6c2e 656e 7472 795f 656e  _actual.entry_en
-00045580: 7469 7479 3a0d 0a20 2020 2020 2020 2020  tity:..         
-00045590: 2020 2069 6620 656e 7469 7479 2e65 6e74     if entity.ent
-000455a0: 6974 795f 7479 7065 203d 3d20 454e 5449  ity_type == ENTI
-000455b0: 5459 5f53 5243 2061 6e64 2065 6e74 6974  TY_SRC and entit
-000455c0: 792e 7461 626c 655f 6e61 6d65 206e 6f74  y.table_name not
-000455d0: 2069 6e20 736f 7572 6365 735f 6c6f 6164   in sources_load
-000455e0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-000455f0: 2020 2020 2064 6174 6173 6574 203d 2073       dataset = s
-00045600: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00045610: 7561 6c2e 6765 745f 6461 7461 7365 745f  ual.get_dataset_
-00045620: 6672 6f6d 5f64 6174 6173 6574 5f6e 616d  from_dataset_nam
-00045630: 6528 656e 7469 7479 2e74 6162 6c65 5f6e  e(entity.table_n
-00045640: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-00045650: 2020 2020 2020 6964 5f65 6e74 6974 795f        id_entity_
-00045660: 7479 7065 203d 2028 7365 6c66 2e6d 6574  type = (self.met
-00045670: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
-00045680: 5f65 6e74 6974 795f 7479 7065 5f66 726f  _entity_type_fro
-00045690: 6d5f 656e 7469 7479 5f74 7970 655f 6e61  m_entity_type_na
-000456a0: 6d65 2845 4e54 4954 595f 5352 4329 292e  me(ENTITY_SRC)).
-000456b0: 6964 5f65 6e74 6974 795f 7479 7065 0d0a  id_entity_type..
-000456c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000456d0: 656e 645f 6461 7465 203d 2022 4e55 4c4c  end_date = "NULL
-000456e0: 220d 0a0d 0a20 2020 2020 2020 2020 2020  "....           
-000456f0: 2020 2020 2069 6620 6461 7461 7365 7420       if dataset 
-00045700: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00045710: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00045720: 4966 2074 6865 2064 6174 6173 6574 2064  If the dataset d
-00045730: 6f65 736e 2774 2065 7869 7374 2069 7420  oesn't exist it 
-00045740: 7769 6c6c 2062 6520 6164 6465 640d 0a20  will be added.. 
+000423e0: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
+000423f0: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
+00042400: 5245 434f 5244 5f53 4f55 5243 452c 2031  RECORD_SOURCE, 1
+00042410: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+00042420: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+00042430: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+00042440: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00042450: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00042460: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+00042470: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00042480: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00042490: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+000424a0: 6966 2068 6173 5f61 643a 0d0a 2020 2020  if has_ad:..    
+000424b0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+000424c0: 7365 745f 6d61 7070 696e 6720 3d20 5b70  set_mapping = [p
+000424d0: 7265 6669 785f 6574 202b 2073 6174 5f65  refix_et + sat_e
+000424e0: 6e74 6974 795f 6a6f 696e 2c20 6170 706c  ntity_join, appl
+000424f0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+00042500: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+00042510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042530: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00042540: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
+00042550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042560: 2020 2020 2020 2020 2020 2020 2061 7070               app
+00042570: 6c69 6564 5f64 6174 652e 636f 6c75 6d6e  lied_date.column
+00042580: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+00042590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000425a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000425b0: 2020 6170 706c 6965 645f 6461 7465 2e63    applied_date.c
+000425c0: 6f6c 756d 6e5f 7479 7065 5f74 6172 6765  olumn_type_targe
+000425d0: 742c 206f 7264 696e 616c 5f70 6f73 6974  t, ordinal_posit
+000425e0: 696f 6e2c 2061 7070 6c69 6564 5f64 6174  ion, applied_dat
+000425f0: 652e 636f 6c75 6d6e 5f6c 656e 6774 682c  e.column_length,
+00042600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042620: 2020 2020 2061 7070 6c69 6564 5f64 6174       applied_dat
+00042630: 652e 636f 6c75 6d6e 5f70 7265 6369 7369  e.column_precisi
+00042640: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+00042650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042660: 2020 2020 2020 2020 7361 745f 6e75 6d5f          sat_num_
+00042670: 6272 616e 6368 2c20 4b45 595f 5459 5045  branch, KEY_TYPE
+00042680: 5f41 5050 4c49 4544 5f44 4154 452c 2031  _APPLIED_DATE, 1
+00042690: 2c20 7365 6c66 2e6f 776e 6572 5d0d 0a20  , self.owner].. 
+000426a0: 2020 2020 2020 2020 2020 206f 7264 696e             ordin
+000426b0: 616c 5f70 6f73 6974 696f 6e20 2b3d 2031  al_position += 1
+000426c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000426d0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000426e0: 616c 2e61 6464 5f65 6e74 7279 5f64 6174  al.add_entry_dat
+000426f0: 6173 6574 5f6d 6170 7069 6e67 7328 5b6e  aset_mappings([n
+00042700: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00042710: 6e67 5d29 0d0a 0d0a 2020 2020 2020 2020  ng])....        
+00042720: 6966 2068 6173 5f74 6e3a 0d0a 2020 2020  if has_tn:..    
+00042730: 2020 2020 2020 2020 666f 7220 746e 2069          for tn i
+00042740: 6e20 7465 6e61 6e74 5f73 6f75 7263 653a  n tenant_source:
+00042750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042760: 2020 6e65 775f 6461 7461 7365 745f 6d61    new_dataset_ma
+00042770: 7070 696e 6720 3d20 5b70 7265 6669 785f  pping = [prefix_
+00042780: 6574 202b 2073 6174 5f65 6e74 6974 795f  et + sat_entity_
+00042790: 6a6f 696e 2c20 746e 2e63 6f6c 756d 6e5f  join, tn.column_
+000427a0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+000427b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427d0: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+000427e0: 2073 6174 5f65 6e74 6974 792c 0d0a 2020   sat_entity,..  
+000427f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042810: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f6e       tn.column_n
+00042820: 616d 655f 7461 7267 6574 2c0d 0a20 2020  ame_target,..   
+00042830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042850: 2020 2020 746e 2e63 6f6c 756d 6e5f 7479      tn.column_ty
+00042860: 7065 5f74 6172 6765 742c 206f 7264 696e  pe_target, ordin
+00042870: 616c 5f70 6f73 6974 696f 6e2c 2074 6e2e  al_position, tn.
+00042880: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+00042890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000428a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000428b0: 2020 2020 2020 2074 6e2e 636f 6c75 6d6e         tn.column
+000428c0: 5f70 7265 6369 7369 6f6e 2c0d 0a20 2020  _precision,..   
+000428d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000428e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000428f0: 2020 2020 312c 204b 4559 5f54 5950 455f      1, KEY_TYPE_
+00042900: 5445 4e41 4e54 2c20 312c 2073 656c 662e  TENANT, 1, self.
+00042910: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+00042920: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00042930: 6164 6174 615f 6163 7475 616c 2e61 6464  adata_actual.add
+00042940: 5f65 6e74 7279 5f64 6174 6173 6574 5f6d  _entry_dataset_m
+00042950: 6170 7069 6e67 7328 5b6e 6577 5f64 6174  appings([new_dat
+00042960: 6173 6574 5f6d 6170 7069 6e67 5d29 0d0a  aset_mapping])..
+00042970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042980: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00042990: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+000429a0: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+000429b0: 7069 6e67 203d 205b 7072 6566 6978 5f65  ping = [prefix_e
+000429c0: 7420 2b20 7361 745f 656e 7469 7479 5f6a  t + sat_entity_j
+000429d0: 6f69 6e2c 2027 4441 5445 5f43 5245 4154  oin, 'DATE_CREAT
+000429e0: 4544 272c 0d0a 2020 2020 2020 2020 2020  ED',..          
+000429f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a00: 2020 2020 2070 7265 6669 785f 6574 202b       prefix_et +
+00042a10: 2073 6174 5f65 6e74 6974 792c 2027 4441   sat_entity, 'DA
+00042a20: 5445 5f43 5245 4154 4544 272c 0d0a 2020  TE_CREATED',..  
+00042a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a40: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00042a50: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00042a60: 615b 305d 2c20 6f72 6469 6e61 6c5f 706f  a[0], ordinal_po
+00042a70: 7369 7469 6f6e 2c20 7379 7364 6174 655f  sition, sysdate_
+00042a80: 666f 725f 6d65 7461 6461 7461 5b31 5d2c  for_metadata[1],
+00042a90: 2073 7973 6461 7465 5f66 6f72 5f6d 6574   sysdate_for_met
+00042aa0: 6164 6174 615b 325d 2c0d 0a20 2020 2020  adata[2],..     
+00042ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ac0: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
+00042ad0: 6d5f 6272 616e 6368 2c20 4b45 595f 5459  m_branch, KEY_TY
+00042ae0: 5045 5f4e 554c 4c2c 2031 2c20 7365 6c66  PE_NULL, 1, self
+00042af0: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00042b00: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00042b10: 6e20 2b3d 2031 0d0a 2020 2020 2020 2020  n += 1..        
+00042b20: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00042b30: 7475 616c 2e61 6464 5f65 6e74 7279 5f64  tual.add_entry_d
+00042b40: 6174 6173 6574 5f6d 6170 7069 6e67 7328  ataset_mappings(
+00042b50: 5b6e 6577 5f64 6174 6173 6574 5f6d 6170  [new_dataset_map
+00042b60: 7069 6e67 5d29 0d0a 0d0a 2020 2020 2020  ping])....      
+00042b70: 2020 6966 2068 6173 5f64 636b 3a0d 0a20    if has_dck:.. 
+00042b80: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+00042b90: 636b 2069 6e20 6465 7065 6e64 656e 745f  ck in dependent_
+00042ba0: 6368 696c 645f 6b65 793a 0d0a 2020 2020  child_key:..    
+00042bb0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00042bc0: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00042bd0: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+00042be0: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
+00042bf0: 6463 6b2e 636f 6c75 6d6e 5f6e 616d 655f  dck.column_name_
+00042c00: 7461 7267 6574 2c20 7072 6566 6978 5f65  target, prefix_e
+00042c10: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
+00042c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c40: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
+00042c50: 6d6e 5f6e 616d 655f 7461 7267 6574 2c0d  mn_name_target,.
+00042c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c80: 2020 2020 2020 2020 6463 6b2e 636f 6c75          dck.colu
+00042c90: 6d6e 5f74 7970 655f 7461 7267 6574 2c20  mn_type_target, 
+00042ca0: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00042cb0: 2c20 6463 6b2e 636f 6c75 6d6e 5f6c 656e  , dck.column_len
+00042cc0: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
+00042cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ce0: 2020 2020 2020 2020 2020 2020 2064 636b               dck
+00042cf0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+00042d00: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00042d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d20: 2020 2020 2020 2020 2020 2031 2c20 4b45             1, KE
+00042d30: 595f 5459 5045 5f44 4550 454e 4445 4e54  Y_TYPE_DEPENDENT
+00042d40: 5f43 4849 4c44 5f4b 4559 2c20 312c 2073  _CHILD_KEY, 1, s
+00042d50: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00042d60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00042d70: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00042d80: 2e61 6464 5f65 6e74 7279 5f64 6174 6173  .add_entry_datas
+00042d90: 6574 5f6d 6170 7069 6e67 7328 5b6e 6577  et_mappings([new
+00042da0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00042db0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00042dc0: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00042dd0: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+00042de0: 2020 2020 2066 6f72 2061 7420 696e 2061       for at in a
+00042df0: 6c6c 5f61 7474 7269 6275 7465 733a 0d0a  ll_attributes:..
+00042e00: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00042e10: 6461 7461 7365 745f 6d61 7070 696e 6720  dataset_mapping 
+00042e20: 3d20 5b70 7265 6669 785f 6574 202b 2073  = [prefix_et + s
+00042e30: 6174 5f65 6e74 6974 795f 6a6f 696e 2c20  at_entity_join, 
+00042e40: 6174 2e63 6f6c 756d 6e5f 6e61 6d65 5f74  at.column_name_t
+00042e50: 6172 6765 742c 0d0a 2020 2020 2020 2020  arget,..        
+00042e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042e70: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+00042e80: 785f 6574 202b 2073 6174 5f65 6e74 6974  x_et + sat_entit
+00042e90: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+00042ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042eb0: 2020 2020 2020 2061 742e 636f 6c75 6d6e         at.column
+00042ec0: 5f6e 616d 655f 7461 7267 6574 2c0d 0a20  _name_target,.. 
+00042ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ef0: 2020 6174 2e63 6f6c 756d 6e5f 7479 7065    at.column_type
+00042f00: 5f74 6172 6765 742c 206f 7264 696e 616c  _target, ordinal
+00042f10: 5f70 6f73 6974 696f 6e2c 2061 742e 636f  _position, at.co
+00042f20: 6c75 6d6e 5f6c 656e 6774 682c 0d0a 2020  lumn_length,..  
+00042f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042f50: 2061 742e 636f 6c75 6d6e 5f70 7265 6369   at.column_preci
+00042f60: 7369 6f6e 2c0d 0a20 2020 2020 2020 2020  sion,..         
+00042f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042f80: 2020 2020 2020 2020 2020 7361 745f 6e75            sat_nu
+00042f90: 6d5f 6272 616e 6368 2c20 6174 2e6b 6579  m_branch, at.key
+00042fa0: 5f74 7970 652c 2031 2c20 7365 6c66 2e6f  _type, 1, self.o
+00042fb0: 776e 6572 5d0d 0a20 2020 2020 2020 2020  wner]..         
+00042fc0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00042fd0: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00042fe0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00042ff0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00043000: 6d61 7070 696e 675d 290d 0a20 2020 2020  mapping])..     
+00043010: 2020 2020 2020 206f 7264 696e 616c 5f70         ordinal_p
+00043020: 6f73 6974 696f 6e20 2b3d 2031 0d0a 0d0a  osition += 1....
+00043030: 2020 2020 2020 2020 6e65 775f 6669 6c74          new_filt
+00043040: 6572 203d 205b 7072 6566 6978 5f65 7420  er = [prefix_et 
+00043050: 2b20 7361 745f 656e 7469 7479 2c20 6861  + sat_entity, ha
+00043060: 7368 5f6e 616d 6520 2b20 225f 4849 5354  sh_name + "_HIST
+00043070: 2069 7320 6e75 6c6c 222c 2073 6174 5f6e   is null", sat_n
+00043080: 756d 5f62 7261 6e63 682c 2073 656c 662e  um_branch, self.
+00043090: 6f77 6e65 725d 0d0a 2020 2020 2020 2020  owner]..        
+000430a0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+000430b0: 7475 616c 2e61 6464 5f65 6e74 7279 5f66  tual.add_entry_f
+000430c0: 696c 7465 7273 285b 6e65 775f 6669 6c74  ilters([new_filt
+000430d0: 6572 5d29 0d0a 0d0a 2020 2020 2020 2020  er])....        
+000430e0: 7365 6c66 2e6c 6f67 2e6c 6f67 2873 656c  self.log.log(sel
+000430f0: 662e 656e 6769 6e65 5f6e 616d 652c 2022  f.engine_name, "
+00043100: 4669 6e69 7368 6564 2074 6f20 7072 6f63  Finished to proc
+00043110: 6573 7320 4d65 7461 6461 7461 205b 204c  ess Metadata [ L
+00043120: 696e 6b20 7361 7465 6c6c 6974 6573 202d  ink satellites -
+00043130: 206e 6f6e 2063 6463 205d 2069 6e66 6f72   non cdc ] infor
+00043140: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
+00043150: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
+00043160: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
+00043170: 6476 5f6c 696e 6b5f 6372 6561 7469 6f6e  dv_link_creation
+00043180: 5f73 6174 5f63 6463 2873 656c 662c 206c  _sat_cdc(self, l
+00043190: 696e 6b2c 2073 6174 293a 0d0a 2020 2020  ink, sat):..    
+000431a0: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
+000431b0: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
+000431c0: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
+000431d0: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
+000431e0: 205b 204c 696e 6b20 7361 7465 6c6c 6974   [ Link satellit
+000431f0: 6573 202d 2063 6463 205d 2069 6e66 6f72  es - cdc ] infor
+00043200: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
+00043210: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 2020  EL_ONLY_LOG)..  
+00043220: 2020 2020 2020 6f72 6469 6e61 6c5f 706f        ordinal_po
+00043230: 7369 7469 6f6e 203d 2031 0d0a 2020 2020  sition = 1..    
+00043240: 2020 2020 7072 6566 6978 5f65 7420 3d20      prefix_et = 
+00043250: 2745 545f 270d 0a20 2020 2020 2020 2073  'ET_'..        s
+00043260: 6174 5f63 6f64 5f65 6e74 6974 795f 736f  at_cod_entity_so
+00043270: 7572 6365 203d 2073 6174 5b30 5d0d 0a20  urce = sat[0].. 
+00043280: 2020 2020 2020 2073 6174 5f63 6f64 5f65         sat_cod_e
+00043290: 6e74 6974 795f 7461 7267 6574 203d 2073  ntity_target = s
+000432a0: 6174 5b31 5d0d 0a20 2020 2020 2020 2073  at[1]..        s
+000432b0: 6174 5f6e 616d 6520 3d20 7361 745b 325d  at_name = sat[2]
+000432c0: 0d0a 2020 2020 2020 2020 7361 745f 6e75  ..        sat_nu
+000432d0: 6d5f 6272 616e 6368 203d 2031 2023 2053  m_branch = 1 # S
+000432e0: 6174 2063 616e 2774 2068 6176 6520 6d6f  at can't have mo
+000432f0: 7265 2074 6861 6e20 6f6e 6520 6272 616e  re than one bran
+00043300: 6368 202d 3e20 7361 745b 335d 0d0a 2020  ch -> sat[3]..  
+00043310: 2020 2020 2020 7361 745f 656e 7469 7479        sat_entity
+00043320: 203d 2073 6174 5f6e 616d 650d 0a0d 0a20   = sat_name.... 
+00043330: 2020 2020 2020 2068 6173 685f 6e61 6d65         hash_name
+00043340: 203d 2027 4841 5348 5f27 202b 206c 696e   = 'HASH_' + lin
+00043350: 6b2e 656e 7469 7479 5f6e 616d 650d 0a20  k.entity_name.. 
+00043360: 2020 2020 2020 2064 765f 7072 6f70 6572         dv_proper
+00043370: 7479 203d 2073 656c 662e 6d65 7461 6461  ty = self.metada
+00043380: 7461 5f61 6374 7561 6c2e 6765 745f 6476  ta_actual.get_dv
+00043390: 5f70 726f 7065 7274 6965 735f 6672 6f6d  _properties_from
+000433a0: 5f63 6f64 5f65 6e74 6974 795f 616e 645f  _cod_entity_and_
+000433b0: 6e75 6d5f 636f 6e6e 6563 7469 6f6e 286c  num_connection(l
+000433c0: 696e 6b2e 636f 645f 656e 7469 7479 2c20  ink.cod_entity, 
+000433d0: 3029 0d0a 2020 2020 2020 2020 6966 2064  0)..        if d
+000433e0: 765f 7072 6f70 6572 7479 2069 7320 6e6f  v_property is no
+000433f0: 7420 4e6f 6e65 3a20 6861 7368 5f6e 616d  t None: hash_nam
+00043400: 6520 3d20 6476 5f70 726f 7065 7274 792e  e = dv_property.
+00043410: 6861 7368 5f6e 616d 650d 0a0d 0a20 2020  hash_name....   
+00043420: 2020 2020 206e 6577 5f65 6e74 6974 795f       new_entity_
+00043430: 7361 745f 656e 7469 7479 5f74 6d70 203d  sat_entity_tmp =
+00043440: 205b 7072 6566 6978 5f65 7420 2b20 7361   [prefix_et + sa
+00043450: 745f 656e 7469 7479 2c20 7361 745f 656e  t_entity, sat_en
+00043460: 7469 7479 2c20 454e 5449 5459 5f54 422c  tity, ENTITY_TB,
+00043470: 206c 696e 6b2e 636f 645f 7061 7468 2c20   link.cod_path, 
+00043480: 2749 4e53 4552 5427 2c20 7365 6c66 2e6f  'INSERT', self.o
+00043490: 776e 6572 5d0d 0a20 2020 2020 2020 2073  wner]..        s
+000434a0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+000434b0: 7561 6c2e 6164 645f 656e 7472 795f 656e  ual.add_entry_en
+000434c0: 7469 7479 285b 6e65 775f 656e 7469 7479  tity([new_entity
+000434d0: 5f73 6174 5f65 6e74 6974 795f 746d 705d  _sat_entity_tmp]
+000434e0: 290d 0a0d 0a20 2020 2020 2020 2068 6173  )....        has
+000434f0: 5f72 7320 3d20 4661 6c73 650d 0a20 2020  _rs = False..   
+00043500: 2020 2020 2068 6173 5f74 6e20 3d20 4661       has_tn = Fa
+00043510: 6c73 650d 0a20 2020 2020 2020 2068 6173  lse..        has
+00043520: 5f61 6420 3d20 4661 6c73 650d 0a20 2020  _ad = False..   
+00043530: 2020 2020 2074 656e 616e 745f 736f 7572       tenant_sour
+00043540: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
+00043550: 7461 5f61 6374 7561 6c2e 6765 745f 7465  ta_actual.get_te
+00043560: 6e61 6e74 5f6f 6e5f 6476 5f66 726f 6d5f  nant_on_dv_from_
+00043570: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+00043580: 745f 616e 645f 6e75 6d5f 6272 616e 6368  t_and_num_branch
+00043590: 2873 6174 5f63 6f64 5f65 6e74 6974 795f  (sat_cod_entity_
+000435a0: 7461 7267 6574 2c20 7361 745f 6e75 6d5f  target, sat_num_
+000435b0: 6272 616e 6368 290d 0a20 2020 2020 2020  branch)..       
+000435c0: 2069 6620 6c65 6e28 7465 6e61 6e74 5f73   if len(tenant_s
+000435d0: 6f75 7263 6529 2021 3d20 303a 0d0a 2020  ource) != 0:..  
+000435e0: 2020 2020 2020 2020 2020 6861 735f 746e            has_tn
+000435f0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00043600: 2020 2020 2023 2047 6574 2064 6973 7469       # Get disti
+00043610: 6e63 7420 6672 6f6d 2054 454e 414e 5453  nct from TENANTS
+00043620: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00043630: 6e61 6c5f 7465 6e61 6e74 5f6c 6973 7420  nal_tenant_list 
+00043640: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
+00043650: 2020 666f 7220 746e 2069 6e20 7465 6e61    for tn in tena
+00043660: 6e74 5f73 6f75 7263 653a 0d0a 2020 2020  nt_source:..    
+00043670: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00043680: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 7461  n.column_name_ta
+00043690: 7267 6574 206e 6f74 2069 6e20 5b78 2e63  rget not in [x.c
+000436a0: 6f6c 756d 6e5f 6e61 6d65 5f74 6172 6765  olumn_name_targe
+000436b0: 7420 666f 7220 7820 696e 0d0a 2020 2020  t for x in..    
+000436c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000436d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000436e0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
+000436f0: 616c 5f74 656e 616e 745f 6c69 7374 5d3a  al_tenant_list]:
+00043700: 2066 696e 616c 5f74 656e 616e 745f 6c69   final_tenant_li
+00043710: 7374 2e61 7070 656e 6428 746e 290d 0a20  st.append(tn).. 
+00043720: 2020 2020 2020 2020 2020 2074 656e 616e             tenan
+00043730: 745f 736f 7572 6365 203d 2066 696e 616c  t_source = final
+00043740: 5f74 656e 616e 745f 6c69 7374 0d0a 2020  _tenant_list..  
+00043750: 2020 2020 2020 7265 636f 7264 5f73 6f75        record_sou
+00043760: 7263 6520 3d20 7365 6c66 2e6d 6574 6164  rce = self.metad
+00043770: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
+00043780: 6563 6f72 645f 736f 7572 6365 5f6f 6e5f  ecord_source_on_
+00043790: 6476 5f66 726f 6d5f 636f 645f 656e 7469  dv_from_cod_enti
+000437a0: 7479 5f74 6172 6765 745f 616e 645f 6e75  ty_target_and_nu
+000437b0: 6d5f 6272 616e 6368 2873 6174 5f63 6f64  m_branch(sat_cod
+000437c0: 5f65 6e74 6974 795f 7461 7267 6574 2c20  _entity_target, 
+000437d0: 7361 745f 6e75 6d5f 6272 616e 6368 290d  sat_num_branch).
+000437e0: 0a20 2020 2020 2020 2069 6620 7265 636f  .        if reco
+000437f0: 7264 5f73 6f75 7263 6520 6973 206e 6f74  rd_source is not
+00043800: 204e 6f6e 653a 2068 6173 5f72 7320 3d20   None: has_rs = 
+00043810: 5472 7565 0d0a 2020 2020 2020 2020 6170  True..        ap
+00043820: 706c 6965 645f 6461 7465 203d 2073 656c  plied_date = sel
+00043830: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00043840: 6c2e 6765 745f 6170 706c 6965 645f 6461  l.get_applied_da
+00043850: 7465 5f6f 6e5f 6476 5f66 726f 6d5f 636f  te_on_dv_from_co
+00043860: 645f 656e 7469 7479 5f74 6172 6765 7428  d_entity_target(
+00043870: 6c69 6e6b 2e63 6f64 5f65 6e74 6974 792c  link.cod_entity,
+00043880: 2073 6174 5b33 5d29 0d0a 2020 2020 2020   sat[3])..      
+00043890: 2020 6966 2061 7070 6c69 6564 5f64 6174    if applied_dat
+000438a0: 6520 6973 206e 6f74 204e 6f6e 653a 2068  e is not None: h
+000438b0: 6173 5f61 6420 3d20 5472 7565 0d0a 0d0a  as_ad = True....
+000438c0: 2020 2020 2020 2020 6861 7368 5f66 6f72          hash_for
+000438d0: 5f6d 6574 6164 6174 6120 3d20 7365 6c66  _metadata = self
+000438e0: 2e63 6f6e 6e65 6374 696f 6e2e 6765 745f  .connection.get_
+000438f0: 6861 7368 5f66 6f72 5f6d 6574 6164 6174  hash_for_metadat
+00043900: 6128 290d 0a20 2020 2020 2020 206d 6435  a()..        md5
+00043910: 5f66 756e 6374 696f 6e20 3d20 7365 6c66  _function = self
+00043920: 2e67 6574 5f68 6173 685f 6b65 795f 6672  .get_hash_key_fr
+00043930: 6f6d 5f63 6f64 5f65 6e74 6974 795f 7461  om_cod_entity_ta
+00043940: 7267 6574 5f61 6e64 5f6e 756d 5f62 7261  rget_and_num_bra
+00043950: 6e63 6828 7361 745f 636f 645f 656e 7469  nch(sat_cod_enti
+00043960: 7479 5f74 6172 6765 742c 2073 6174 5b33  ty_target, sat[3
+00043970: 5d29 0d0a 0d0a 2020 2020 2020 2020 6e65  ])....        ne
+00043980: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00043990: 6720 3d20 5b73 6174 5f63 6f64 5f65 6e74  g = [sat_cod_ent
+000439a0: 6974 795f 736f 7572 6365 2c20 6d64 355f  ity_source, md5_
+000439b0: 6675 6e63 7469 6f6e 2c20 7072 6566 6978  function, prefix
+000439c0: 5f65 7420 2b20 7361 745f 656e 7469 7479  _et + sat_entity
+000439d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000439e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000439f0: 2020 6861 7368 5f6e 616d 652c 0d0a 2020    hash_name,..  
+00043a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043a10: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00043a20: 685f 666f 725f 6d65 7461 6461 7461 5b30  h_for_metadata[0
+00043a30: 5d2c 206f 7264 696e 616c 5f70 6f73 6974  ], ordinal_posit
+00043a40: 696f 6e2c 2068 6173 685f 666f 725f 6d65  ion, hash_for_me
+00043a50: 7461 6461 7461 5b31 5d2c 2068 6173 685f  tadata[1], hash_
+00043a60: 666f 725f 6d65 7461 6461 7461 5b32 5d2c  for_metadata[2],
+00043a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00043a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043a90: 2073 6174 5f6e 756d 5f62 7261 6e63 682c   sat_num_branch,
+00043aa0: 204b 4559 5f54 5950 455f 4841 5348 5f4b   KEY_TYPE_HASH_K
+00043ab0: 4559 2c20 312c 2073 656c 662e 6f77 6e65  EY, 1, self.owne
+00043ac0: 725d 0d0a 2020 2020 2020 2020 6f72 6469  r]..        ordi
+00043ad0: 6e61 6c5f 706f 7369 7469 6f6e 202b 3d20  nal_position += 
+00043ae0: 310d 0a20 2020 2020 2020 2073 656c 662e  1..        self.
+00043af0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00043b00: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00043b10: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00043b20: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00043b30: 290d 0a0d 0a20 2020 2020 2020 2073 7973  )....        sys
+00043b40: 6461 7465 5f66 6f72 5f6d 6574 6164 6174  date_for_metadat
+00043b50: 6120 3d20 7365 6c66 2e63 6f6e 6e65 6374  a = self.connect
+00043b60: 696f 6e2e 6765 745f 7379 7364 6174 655f  ion.get_sysdate_
+00043b70: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+00043b80: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00043b90: 7365 745f 6d61 7070 696e 6720 3d20 5b27  set_mapping = ['
+00043ba0: 272c 2073 656c 662e 636f 6e6e 6563 7469  ', self.connecti
+00043bb0: 6f6e 2e67 6574 5f73 7973 6461 7465 5f76  on.get_sysdate_v
+00043bc0: 616c 7565 2829 2c20 7072 6566 6978 5f65  alue(), prefix_e
+00043bd0: 7420 2b20 7361 745f 656e 7469 7479 2c0d  t + sat_entity,.
+00043be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043c00: 2744 4154 455f 4352 4541 5445 4427 2c0d  'DATE_CREATED',.
+00043c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043c30: 7379 7364 6174 655f 666f 725f 6d65 7461  sysdate_for_meta
+00043c40: 6461 7461 5b30 5d2c 206f 7264 696e 616c  data[0], ordinal
+00043c50: 5f70 6f73 6974 696f 6e2c 2073 7973 6461  _position, sysda
+00043c60: 7465 5f66 6f72 5f6d 6574 6164 6174 615b  te_for_metadata[
+00043c70: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
+00043c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043c90: 2020 2020 7379 7364 6174 655f 666f 725f      sysdate_for_
+00043ca0: 6d65 7461 6461 7461 5b32 5d2c 2073 6174  metadata[2], sat
+00043cb0: 5f6e 756d 5f62 7261 6e63 682c 204b 4559  _num_branch, KEY
+00043cc0: 5f54 5950 455f 4e55 4c4c 2c20 312c 2073  _TYPE_NULL, 1, s
+00043cd0: 656c 662e 6f77 6e65 725d 0d0a 2020 2020  elf.owner]..    
+00043ce0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00043cf0: 615f 6163 7475 616c 2e61 6464 5f65 6e74  a_actual.add_ent
+00043d00: 7279 5f64 6174 6173 6574 5f6d 6170 7069  ry_dataset_mappi
+00043d10: 6e67 7328 5b6e 6577 5f64 6174 6173 6574  ngs([new_dataset
+00043d20: 5f6d 6170 7069 6e67 5d29 0d0a 2020 2020  _mapping])..    
+00043d30: 2020 2020 6f72 6469 6e61 6c5f 706f 7369      ordinal_posi
+00043d40: 7469 6f6e 202b 3d20 310d 0a0d 0a20 2020  tion += 1....   
+00043d50: 2020 2020 2069 6620 6861 735f 7273 3a0d       if has_rs:.
+00043d60: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00043d70: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00043d80: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
+00043d90: 7479 5f73 6f75 7263 652c 2072 6563 6f72  ty_source, recor
+00043da0: 645f 736f 7572 6365 2e63 6f6c 756d 6e5f  d_source.column_
+00043db0: 6e61 6d65 5f73 6f75 7263 652c 0d0a 2020  name_source,..  
+00043dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043de0: 2070 7265 6669 785f 6574 202b 2073 6174   prefix_et + sat
+00043df0: 5f65 6e74 6974 792c 0d0a 2020 2020 2020  _entity,..      
+00043e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043e10: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00043e20: 6f72 645f 736f 7572 6365 2e63 6f6c 756d  ord_source.colum
+00043e30: 6e5f 6e61 6d65 5f74 6172 6765 742c 0d0a  n_name_target,..
+00043e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043e60: 2020 2072 6563 6f72 645f 736f 7572 6365     record_source
+00043e70: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00043e80: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00043e90: 6974 696f 6e2c 2072 6563 6f72 645f 736f  ition, record_so
+00043ea0: 7572 6365 2e63 6f6c 756d 6e5f 6c65 6e67  urce.column_leng
+00043eb0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+00043ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043ed0: 2020 2020 2020 2020 7265 636f 7264 5f73          record_s
+00043ee0: 6f75 7263 652e 636f 6c75 6d6e 5f70 7265  ource.column_pre
+00043ef0: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+00043f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043f10: 2020 2020 2020 2020 2020 2020 7361 745f              sat_
+00043f20: 6e75 6d5f 6272 616e 6368 2c20 4b45 595f  num_branch, KEY_
+00043f30: 5459 5045 5f52 4543 4f52 445f 534f 5552  TYPE_RECORD_SOUR
+00043f40: 4345 2c20 312c 2073 656c 662e 6f77 6e65  CE, 1, self.owne
+00043f50: 725d 0d0a 2020 2020 2020 2020 2020 2020  r]..            
+00043f60: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+00043f70: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
+00043f80: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00043f90: 5f61 6374 7561 6c2e 6164 645f 656e 7472  _actual.add_entr
+00043fa0: 795f 6461 7461 7365 745f 6d61 7070 696e  y_dataset_mappin
+00043fb0: 6773 285b 6e65 775f 6461 7461 7365 745f  gs([new_dataset_
+00043fc0: 6d61 7070 696e 675d 290d 0a0d 0a20 2020  mapping])....   
+00043fd0: 2020 2020 2069 6620 6861 735f 6164 3a0d       if has_ad:.
+00043fe0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00043ff0: 5f64 6174 6173 6574 5f6d 6170 7069 6e67  _dataset_mapping
+00044000: 203d 205b 7361 745f 636f 645f 656e 7469   = [sat_cod_enti
+00044010: 7479 5f73 6f75 7263 652c 2061 7070 6c69  ty_source, appli
+00044020: 6564 5f64 6174 652e 636f 6c75 6d6e 5f6e  ed_date.column_n
+00044030: 616d 655f 736f 7572 6365 2c0d 0a20 2020  ame_source,..   
+00044040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044060: 7072 6566 6978 5f65 7420 2b20 7361 745f  prefix_et + sat_
+00044070: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
+00044080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044090: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+000440a0: 6965 645f 6461 7465 2e63 6f6c 756d 6e5f  ied_date.column_
+000440b0: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+000440c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000440d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000440e0: 2061 7070 6c69 6564 5f64 6174 652e 636f   applied_date.co
+000440f0: 6c75 6d6e 5f74 7970 655f 7461 7267 6574  lumn_type_target
+00044100: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00044110: 6f6e 2c20 6170 706c 6965 645f 6461 7465  on, applied_date
+00044120: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00044130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044150: 2020 2020 6170 706c 6965 645f 6461 7465      applied_date
+00044160: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+00044170: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00044180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044190: 2020 2020 2020 2073 6174 5f6e 756d 5f62         sat_num_b
+000441a0: 7261 6e63 682c 204b 4559 5f54 5950 455f  ranch, KEY_TYPE_
+000441b0: 4150 504c 4945 445f 4441 5445 2c20 312c  APPLIED_DATE, 1,
+000441c0: 2073 656c 662e 6f77 6e65 725d 0d0a 2020   self.owner]..  
+000441d0: 2020 2020 2020 2020 2020 6f72 6469 6e61            ordina
+000441e0: 6c5f 706f 7369 7469 6f6e 202b 3d20 310d  l_position += 1.
+000441f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00044200: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00044210: 6c2e 6164 645f 656e 7472 795f 6461 7461  l.add_entry_data
+00044220: 7365 745f 6d61 7070 696e 6773 285b 6e65  set_mappings([ne
+00044230: 775f 6461 7461 7365 745f 6d61 7070 696e  w_dataset_mappin
+00044240: 675d 290d 0a0d 0a20 2020 2020 2020 2069  g])....        i
+00044250: 6620 6861 735f 746e 3a0d 0a20 2020 2020  f has_tn:..     
+00044260: 2020 2020 2020 2066 6f72 2074 6e20 696e         for tn in
+00044270: 2074 656e 616e 745f 736f 7572 6365 3a0d   tenant_source:.
+00044280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044290: 206e 6577 5f64 6174 6173 6574 5f6d 6170   new_dataset_map
+000442a0: 7069 6e67 203d 205b 7361 745f 636f 645f  ping = [sat_cod_
+000442b0: 656e 7469 7479 5f73 6f75 7263 652c 2074  entity_source, t
+000442c0: 6e2e 636f 6c75 6d6e 5f6e 616d 655f 736f  n.column_name_so
+000442d0: 7572 6365 2c20 7072 6566 6978 5f65 7420  urce, prefix_et 
+000442e0: 2b20 7361 745f 656e 7469 7479 2c0d 0a20  + sat_entity,.. 
+000442f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044310: 2020 2020 2020 746e 2e63 6f6c 756d 6e5f        tn.column_
+00044320: 6e61 6d65 5f74 6172 6765 742c 0d0a 2020  name_target,..  
+00044330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044350: 2020 2020 2074 6e2e 636f 6c75 6d6e 5f74       tn.column_t
+00044360: 7970 655f 7461 7267 6574 2c20 6f72 6469  ype_target, ordi
+00044370: 6e61 6c5f 706f 7369 7469 6f6e 2c20 746e  nal_position, tn
+00044380: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00044390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000443a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443b0: 2020 2020 2020 2020 746e 2e63 6f6c 756d          tn.colum
+000443c0: 6e5f 7072 6563 6973 696f 6e2c 0d0a 2020  n_precision,..  
+000443d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443f0: 2020 2020 2031 2c20 4b45 595f 5459 5045       1, KEY_TYPE
+00044400: 5f54 454e 414e 542c 2031 2c20 7365 6c66  _TENANT, 1, self
+00044410: 2e6f 776e 6572 5d0d 0a20 2020 2020 2020  .owner]..       
+00044420: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00044430: 7461 6461 7461 5f61 6374 7561 6c2e 6164  tadata_actual.ad
+00044440: 645f 656e 7472 795f 6461 7461 7365 745f  d_entry_dataset_
+00044450: 6d61 7070 696e 6773 285b 6e65 775f 6461  mappings([new_da
+00044460: 7461 7365 745f 6d61 7070 696e 675d 290d  taset_mapping]).
+00044470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044480: 206f 7264 696e 616c 5f70 6f73 6974 696f   ordinal_positio
+00044490: 6e20 2b3d 2031 0d0a 0d0a 2020 2020 2020  n += 1....      
+000444a0: 2020 616c 6c5f 6174 7472 6962 7574 6573    all_attributes
+000444b0: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+000444c0: 5f61 6374 7561 6c2e 6765 745f 6174 7472  _actual.get_attr
+000444d0: 6962 7574 6573 5f6f 6e5f 6476 5f66 726f  ibutes_on_dv_fro
+000444e0: 6d5f 7361 7465 6c6c 6974 655f 6e61 6d65  m_satellite_name
+000444f0: 2873 6174 5f65 6e74 6974 7929 0d0a 0d0a  (sat_entity)....
+00044500: 2020 2020 2020 2020 666f 7220 6174 2069          for at i
+00044510: 6e20 616c 6c5f 6174 7472 6962 7574 6573  n all_attributes
+00044520: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
+00044530: 6577 5f64 6174 6173 6574 5f6d 6170 7069  ew_dataset_mappi
+00044540: 6e67 203d 205b 6174 2e63 6f64 5f65 6e74  ng = [at.cod_ent
+00044550: 6974 795f 736f 7572 6365 2c20 6174 2e63  ity_source, at.c
+00044560: 6f6c 756d 6e5f 6e61 6d65 5f73 6f75 7263  olumn_name_sourc
+00044570: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00044580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044590: 2020 2020 2020 2070 7265 6669 785f 6574         prefix_et
+000445a0: 202b 2073 6174 5f65 6e74 6974 792c 0d0a   + sat_entity,..
+000445b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000445c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000445d0: 2020 2061 742e 636f 6c75 6d6e 5f6e 616d     at.column_nam
+000445e0: 655f 7461 7267 6574 2c0d 0a20 2020 2020  e_target,..     
+000445f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044600: 2020 2020 2020 2020 2020 2020 2020 6174                at
+00044610: 2e63 6f6c 756d 6e5f 7479 7065 5f74 6172  .column_type_tar
+00044620: 6765 742c 206f 7264 696e 616c 5f70 6f73  get, ordinal_pos
+00044630: 6974 696f 6e2c 2061 742e 636f 6c75 6d6e  ition, at.column
+00044640: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+00044650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044660: 2020 2020 2020 2020 2020 2020 2061 742e               at.
+00044670: 636f 6c75 6d6e 5f70 7265 6369 7369 6f6e  column_precision
+00044680: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00044690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000446a0: 2020 2020 2020 7361 745f 6e75 6d5f 6272        sat_num_br
+000446b0: 616e 6368 2c20 6174 2e6b 6579 5f74 7970  anch, at.key_typ
+000446c0: 652c 2031 2c20 7365 6c66 2e6f 776e 6572  e, 1, self.owner
+000446d0: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+000446e0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+000446f0: 7561 6c2e 6164 645f 656e 7472 795f 6461  ual.add_entry_da
+00044700: 7461 7365 745f 6d61 7070 696e 6773 285b  taset_mappings([
+00044710: 6e65 775f 6461 7461 7365 745f 6d61 7070  new_dataset_mapp
+00044720: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
+00044730: 2020 206f 7264 696e 616c 5f70 6f73 6974     ordinal_posit
+00044740: 696f 6e20 2b3d 2031 0d0a 0d0a 2020 2020  ion += 1....    
+00044750: 2020 2020 6d64 355f 6675 6e63 7469 6f6e      md5_function
+00044760: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
+00044770: 6f6e 2e67 6574 5f6d 6435 5f66 756e 6374  on.get_md5_funct
+00044780: 696f 6e28 290d 0a20 2020 2020 2020 2063  ion()..        c
+00044790: 6173 745f 746f 5f73 7472 696e 6720 3d20  ast_to_string = 
+000447a0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e2e  self.connection.
+000447b0: 6765 745f 6361 7374 5f73 7472 696e 675f  get_cast_string_
+000447c0: 666f 725f 6d65 7461 6461 7461 2829 0d0a  for_metadata()..
+000447d0: 0d0a 2020 2020 2020 2020 626b 5f63 6f6e  ..        bk_con
+000447e0: 6361 7465 6e61 7465 203d 2027 270d 0a20  catenate = ''.. 
+000447f0: 2020 2020 2020 2066 6f72 2061 7420 696e         for at in
+00044800: 2061 6c6c 5f61 7474 7269 6275 7465 733a   all_attributes:
+00044810: 0d0a 2020 2020 2020 2020 2020 2020 626b  ..            bk
+00044820: 5f66 696e 616c 203d 2063 6173 745f 746f  _final = cast_to
+00044830: 5f73 7472 696e 672e 7265 706c 6163 6528  _string.replace(
+00044840: 275b 785d 272c 2061 742e 636f 6c75 6d6e  '[x]', at.column
+00044850: 5f6e 616d 655f 736f 7572 6365 290d 0a20  _name_source).. 
+00044860: 2020 2020 2020 2020 2020 2062 6b5f 636f             bk_co
+00044870: 6e63 6174 656e 6174 6520 2b3d 2062 6b5f  ncatenate += bk_
+00044880: 6669 6e61 6c20 2b20 227c 7c27 2220 2b20  final + "||'" + 
+00044890: 7365 6c66 2e6d 6f64 756c 655f 6476 5f63  self.module_dv_c
+000448a0: 6861 725f 7365 7061 7261 746f 725f 6e61  har_separator_na
+000448b0: 6d69 6e67 202b 2022 277c 7c22 0d0a 2020  ming + "'||"..  
+000448c0: 2020 2020 2020 626b 5f63 6f6e 6361 7465        bk_concate
+000448d0: 6e61 7465 203d 2062 6b5f 636f 6e63 6174  nate = bk_concat
+000448e0: 656e 6174 655b 3a2d 325d 0d0a 2020 2020  enate[:-2]..    
+000448f0: 2020 2020 6861 7364 6966 6620 3d20 6d64      hasdiff = md
+00044900: 355f 6675 6e63 7469 6f6e 2e72 6570 6c61  5_function.repla
+00044910: 6365 2827 5b78 5d27 2c20 626b 5f63 6f6e  ce('[x]', bk_con
+00044920: 6361 7465 6e61 7465 290d 0a20 2020 2020  catenate)..     
+00044930: 2020 206e 6577 5f64 6174 6173 6574 5f6d     new_dataset_m
+00044940: 6170 7069 6e67 203d 205b 616c 6c5f 6174  apping = [all_at
+00044950: 7472 6962 7574 6573 5b30 5d2e 636f 645f  tributes[0].cod_
+00044960: 656e 7469 7479 5f73 6f75 7263 652c 2068  entity_source, h
+00044970: 6173 6469 6666 2c0d 0a20 2020 2020 2020  asdiff,..       
+00044980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044990: 2020 2020 2020 2020 7072 6566 6978 5f65          prefix_e
+000449a0: 7420 2b20 7361 745f 656e 7469 7479 2c20  t + sat_entity, 
+000449b0: 2748 4153 4844 4946 4627 2c0d 0a20 2020  'HASHDIFF',..   
+000449c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000449d0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+000449e0: 5f66 6f72 5f6d 6574 6164 6174 615b 305d  _for_metadata[0]
+000449f0: 2c20 6f72 6469 6e61 6c5f 706f 7369 7469  , ordinal_positi
+00044a00: 6f6e 2c20 6861 7368 5f66 6f72 5f6d 6574  on, hash_for_met
+00044a10: 6164 6174 615b 315d 2c20 6861 7368 5f66  adata[1], hash_f
+00044a20: 6f72 5f6d 6574 6164 6174 615b 325d 2c0d  or_metadata[2],.
+00044a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044a50: 7361 745f 6e75 6d5f 6272 616e 6368 2c20  sat_num_branch, 
+00044a60: 4b45 595f 5459 5045 5f48 4153 4844 4946  KEY_TYPE_HASHDIF
+00044a70: 462c 2031 2c20 7365 6c66 2e6f 776e 6572  F, 1, self.owner
+00044a80: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+00044a90: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00044aa0: 6164 645f 656e 7472 795f 6461 7461 7365  add_entry_datase
+00044ab0: 745f 6d61 7070 696e 6773 285b 6e65 775f  t_mappings([new_
+00044ac0: 6461 7461 7365 745f 6d61 7070 696e 675d  dataset_mapping]
+00044ad0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00044ae0: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
+00044af0: 6e67 696e 655f 6e61 6d65 2c20 2246 696e  ngine_name, "Fin
+00044b00: 6973 6865 6420 746f 2070 726f 6365 7373  ished to process
+00044b10: 204d 6574 6164 6174 6120 5b20 4c69 6e6b   Metadata [ Link
+00044b20: 2073 6174 656c 6c69 7465 7320 2d20 6364   satellites - cd
+00044b30: 6320 5d20 696e 666f 726d 6174 696f 6e22  c ] information"
+00044b40: 2c20 4c4f 475f 4c45 5645 4c5f 4f4e 4c59  , LOG_LEVEL_ONLY
+00044b50: 5f4c 4f47 290d 0a0d 0a20 2020 2064 6566  _LOG)....    def
+00044b60: 2070 726f 6365 7373 5f64 765f 7072 6f70   process_dv_prop
+00044b70: 6572 7469 6573 2873 656c 6629 3a0d 0a20  erties(self):.. 
+00044b80: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
+00044b90: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
+00044ba0: 6e61 6d65 2c20 2253 7461 7274 696e 6720  name, "Starting 
+00044bb0: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
+00044bc0: 6174 6120 5b20 4456 2050 726f 7065 7274  ata [ DV Propert
+00044bd0: 6965 7320 5d20 696e 666f 726d 6174 696f  ies ] informatio
+00044be0: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
+00044bf0: 4c59 5f4c 4f47 290d 0a20 2020 2020 2020  LY_LOG)..       
+00044c00: 2061 6c6c 5f65 6e74 6974 6965 7320 3d20   all_entities = 
+00044c10: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
+00044c20: 656e 7472 7920 696e 205b 7820 666f 7220  entry in [x for 
+00044c30: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
+00044c40: 7461 5f61 6374 7561 6c2e 656e 7472 795f  ta_actual.entry_
+00044c50: 6476 5f65 6e74 6974 795d 3a0d 0a20 2020  dv_entity]:..   
+00044c60: 2020 2020 2020 2020 206e 6577 5f65 6e74           new_ent
+00044c70: 6974 7920 3d20 5b65 6e74 7279 2e65 6e74  ity = [entry.ent
+00044c80: 6974 795f 6e61 6d65 2c20 656e 7472 792e  ity_name, entry.
+00044c90: 656e 7469 7479 5f74 7970 655d 0d0a 2020  entity_type]..  
+00044ca0: 2020 2020 2020 2020 2020 6966 206e 6577            if new
+00044cb0: 5f65 6e74 6974 7920 6e6f 7420 696e 2061  _entity not in a
+00044cc0: 6c6c 5f65 6e74 6974 6965 733a 2061 6c6c  ll_entities: all
+00044cd0: 5f65 6e74 6974 6965 732e 6170 7065 6e64  _entities.append
+00044ce0: 286e 6577 5f65 6e74 6974 7929 0d0a 2020  (new_entity)..  
+00044cf0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
+00044d00: 696e 205b 7820 666f 7220 7820 696e 2073  in [x for x in s
+00044d10: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00044d20: 7561 6c2e 656e 7472 795f 6476 5f65 6e74  ual.entry_dv_ent
+00044d30: 6974 795d 3a0d 0a20 2020 2020 2020 2020  ity]:..         
+00044d40: 2020 2069 6620 656e 7472 792e 6e61 6d65     if entry.name
+00044d50: 5f73 7461 7475 735f 7472 6163 6b69 6e67  _status_tracking
+00044d60: 5f73 6174 656c 6c69 7465 2069 7320 4e6f  _satellite is No
+00044d70: 6e65 206f 7220 656e 7472 792e 6e61 6d65  ne or entry.name
+00044d80: 5f73 7461 7475 735f 7472 6163 6b69 6e67  _status_tracking
+00044d90: 5f73 6174 656c 6c69 7465 3d3d 2727 3a20  _satellite=='': 
+00044da0: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
+00044db0: 2020 2020 2020 6e65 775f 656e 7469 7479        new_entity
+00044dc0: 203d 205b 656e 7472 792e 6e61 6d65 5f73   = [entry.name_s
+00044dd0: 7461 7475 735f 7472 6163 6b69 6e67 5f73  tatus_tracking_s
+00044de0: 6174 656c 6c69 7465 2c20 454e 5449 5459  atellite, ENTITY
+00044df0: 5f53 5453 5d0d 0a20 2020 2020 2020 2020  _STS]..         
+00044e00: 2020 2069 6620 6e65 775f 656e 7469 7479     if new_entity
+00044e10: 206e 6f74 2069 6e20 616c 6c5f 656e 7469   not in all_enti
+00044e20: 7469 6573 3a20 616c 6c5f 656e 7469 7469  ties: all_entiti
+00044e30: 6573 2e61 7070 656e 6428 6e65 775f 656e  es.append(new_en
+00044e40: 7469 7479 290d 0a20 2020 2020 2020 2066  tity)..        f
+00044e50: 6f72 2065 6e74 7279 2069 6e20 5b78 2066  or entry in [x f
+00044e60: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
+00044e70: 6164 6174 615f 6163 7475 616c 2e65 6e74  adata_actual.ent
+00044e80: 7279 5f64 765f 656e 7469 7479 5d3a 0d0a  ry_dv_entity]:..
+00044e90: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00044ea0: 6e74 7279 2e6e 616d 655f 7265 636f 7264  ntry.name_record
+00044eb0: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
+00044ec0: 6974 6520 6973 204e 6f6e 6520 6f72 2065  ite is None or e
+00044ed0: 6e74 7279 2e6e 616d 655f 7265 636f 7264  ntry.name_record
+00044ee0: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
+00044ef0: 6974 6520 3d3d 2027 273a 2063 6f6e 7469  ite == '': conti
+00044f00: 6e75 650d 0a20 2020 2020 2020 2020 2020  nue..           
+00044f10: 206e 6577 5f65 6e74 6974 7920 3d20 5b65   new_entity = [e
+00044f20: 6e74 7279 2e6e 616d 655f 7265 636f 7264  ntry.name_record
+00044f30: 5f74 7261 636b 696e 675f 7361 7465 6c6c  _tracking_satell
+00044f40: 6974 652c 2045 4e54 4954 595f 5254 535d  ite, ENTITY_RTS]
+00044f50: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00044f60: 206e 6577 5f65 6e74 6974 7920 6e6f 7420   new_entity not 
+00044f70: 696e 2061 6c6c 5f65 6e74 6974 6965 733a  in all_entities:
+00044f80: 2061 6c6c 5f65 6e74 6974 6965 732e 6170   all_entities.ap
+00044f90: 7065 6e64 286e 6577 5f65 6e74 6974 7929  pend(new_entity)
+00044fa0: 0d0a 2020 2020 2020 2020 666f 7220 656e  ..        for en
+00044fb0: 7472 7920 696e 205b 7820 666f 7220 7820  try in [x for x 
+00044fc0: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
+00044fd0: 5f61 6374 7561 6c2e 656e 7472 795f 6476  _actual.entry_dv
+00044fe0: 5f65 6e74 6974 795d 3a0d 0a20 2020 2020  _entity]:..     
+00044ff0: 2020 2020 2020 2069 6620 656e 7472 792e         if entry.
+00045000: 6e61 6d65 5f65 6666 6563 7469 7669 7479  name_effectivity
+00045010: 5f73 6174 656c 6c69 7465 2069 7320 4e6f  _satellite is No
+00045020: 6e65 206f 7220 656e 7472 792e 6e61 6d65  ne or entry.name
+00045030: 5f65 6666 6563 7469 7669 7479 5f73 6174  _effectivity_sat
+00045040: 656c 6c69 7465 203d 3d20 2727 3a20 636f  ellite == '': co
+00045050: 6e74 696e 7565 0d0a 2020 2020 2020 2020  ntinue..        
+00045060: 2020 2020 6e65 775f 656e 7469 7479 203d      new_entity =
+00045070: 205b 656e 7472 792e 6e61 6d65 5f65 6666   [entry.name_eff
+00045080: 6563 7469 7669 7479 5f73 6174 656c 6c69  ectivity_satelli
+00045090: 7465 2c20 454e 5449 5459 5f53 4154 455d  te, ENTITY_SATE]
+000450a0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000450b0: 206e 6577 5f65 6e74 6974 7920 6e6f 7420   new_entity not 
+000450c0: 696e 2061 6c6c 5f65 6e74 6974 6965 733a  in all_entities:
+000450d0: 2061 6c6c 5f65 6e74 6974 6965 732e 6170   all_entities.ap
+000450e0: 7065 6e64 286e 6577 5f65 6e74 6974 7929  pend(new_entity)
+000450f0: 0d0a 2020 2020 2020 2020 666f 7220 656e  ..        for en
+00045100: 7472 7920 696e 205b 7820 666f 7220 7820  try in [x for x 
+00045110: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
+00045120: 5f61 6374 7561 6c2e 656e 7472 795f 6476  _actual.entry_dv
+00045130: 5f6d 6170 7069 6e67 735d 3a0d 0a20 2020  _mappings]:..   
+00045140: 2020 2020 2020 2020 2069 6620 656e 7472           if entr
+00045150: 792e 7361 7465 6c6c 6974 655f 6e61 6d65  y.satellite_name
+00045160: 2069 7320 4e6f 6e65 206f 7220 656e 7472   is None or entr
+00045170: 792e 7361 7465 6c6c 6974 655f 6e61 6d65  y.satellite_name
+00045180: 203d 3d20 2727 3a20 636f 6e74 696e 7565   == '': continue
+00045190: 0d0a 2020 2020 2020 2020 2020 2020 6e65  ..            ne
+000451a0: 775f 656e 7469 7479 203d 205b 656e 7472  w_entity = [entr
+000451b0: 792e 7361 7465 6c6c 6974 655f 6e61 6d65  y.satellite_name
+000451c0: 2c20 454e 5449 5459 5f53 4154 5d0d 0a20  , ENTITY_SAT].. 
+000451d0: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
+000451e0: 775f 656e 7469 7479 206e 6f74 2069 6e20  w_entity not in 
+000451f0: 616c 6c5f 656e 7469 7469 6573 3a20 616c  all_entities: al
+00045200: 6c5f 656e 7469 7469 6573 2e61 7070 656e  l_entities.appen
+00045210: 6428 6e65 775f 656e 7469 7479 290d 0a0d  d(new_entity)...
+00045220: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
+00045230: 5f61 6464 6564 203d 205b 5d0d 0a20 2020  _added = []..   
+00045240: 2020 2020 2066 6f72 2065 6e74 7279 2069       for entry i
+00045250: 6e20 616c 6c5f 656e 7469 7469 6573 3a0d  n all_entities:.
+00045260: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00045270: 5f64 6174 6173 6574 5f69 6420 3d20 7365  _dataset_id = se
+00045280: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+00045290: 6f61 642e 6765 745f 6461 7461 7365 745f  oad.get_dataset_
+000452a0: 6672 6f6d 5f64 6174 6173 6574 5f6e 616d  from_dataset_nam
+000452b0: 6528 656e 7472 795b 305d 292e 6964 5f64  e(entry[0]).id_d
+000452c0: 6174 6173 6574 0d0a 2020 2020 2020 2020  ataset..        
+000452d0: 2020 2020 6964 5f65 6e74 6974 795f 7479      id_entity_ty
+000452e0: 7065 203d 2073 656c 662e 6d65 7461 6461  pe = self.metada
+000452f0: 7461 5f61 6374 7561 6c2e 6765 745f 656e  ta_actual.get_en
+00045300: 7469 7479 5f74 7970 655f 6672 6f6d 5f65  tity_type_from_e
+00045310: 6e74 6974 795f 7479 7065 5f6e 616d 6528  ntity_type_name(
+00045320: 656e 7472 795b 315d 292e 6964 5f65 6e74  entry[1]).id_ent
+00045330: 6974 795f 7479 7065 0d0a 0d0a 2020 2020  ity_type....    
+00045340: 2020 2020 2020 2020 6f6c 645f 6461 7461          old_data
+00045350: 7365 745f 6476 203d 2073 656c 662e 6d65  set_dv = self.me
+00045360: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+00045370: 745f 6461 7461 7365 745f 6476 5f66 726f  t_dataset_dv_fro
+00045380: 6d5f 6964 5f64 6174 6173 6574 286e 6577  m_id_dataset(new
+00045390: 5f64 6174 6173 6574 5f69 6429 0d0a 0d0a  _dataset_id)....
+000453a0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000453b0: 6c64 5f64 6174 6173 6574 5f64 7620 6973  ld_dataset_dv is
+000453c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000453d0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+000453e0: 7365 745f 6476 203d 205b 6e65 775f 6461  set_dv = [new_da
+000453f0: 7461 7365 745f 6964 2c20 6964 5f65 6e74  taset_id, id_ent
+00045400: 6974 795f 7479 7065 2c20 7365 6c66 2e6f  ity_type, self.o
+00045410: 776e 6572 2c0d 0a20 2020 2020 2020 2020  wner,..         
+00045420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045440: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e5f  self.connection_
+00045450: 6d65 7461 6461 7461 2e67 6574 5f73 7973  metadata.get_sys
+00045460: 6461 7465 5f76 616c 7565 2829 2c20 224e  date_value(), "N
+00045470: 554c 4c22 5d0d 0a20 2020 2020 2020 2020  ULL"]..         
+00045480: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+00045490: 6461 7461 5f74 6f5f 6c6f 6164 2e61 6464  data_to_load.add
+000454a0: 5f6f 6d5f 6461 7461 7365 745f 6476 285b  _om_dataset_dv([
+000454b0: 6e65 775f 6461 7461 7365 745f 6476 5d29  new_dataset_dv])
+000454c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000454d0: 2020 6461 7461 7365 745f 6164 6465 642e    dataset_added.
+000454e0: 6170 7065 6e64 286e 6577 5f64 6174 6173  append(new_datas
+000454f0: 6574 5f69 6429 0d0a 2020 2020 2020 2020  et_id)..        
+00045500: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00045510: 2020 2020 2020 2020 2020 2069 6620 6f6c             if ol
+00045520: 645f 6461 7461 7365 745f 6476 2e69 645f  d_dataset_dv.id_
+00045530: 656e 7469 7479 5f74 7970 6520 3d3d 2069  entity_type == i
+00045540: 645f 656e 7469 7479 5f74 7970 653a 0d0a  d_entity_type:..
+00045550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045560: 2020 2020 6e65 775f 6461 7461 7365 745f      new_dataset_
+00045570: 6476 203d 205b 6f6c 645f 6461 7461 7365  dv = [old_datase
+00045580: 745f 6476 2e69 645f 6461 7461 7365 742c  t_dv.id_dataset,
+00045590: 206f 6c64 5f64 6174 6173 6574 5f64 762e   old_dataset_dv.
+000455a0: 6964 5f65 6e74 6974 795f 7479 7065 2c0d  id_entity_type,.
+000455b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000455c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000455d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000455e0: 2020 2073 656c 662e 6f77 6e65 722c 2022     self.owner, "
+000455f0: 2722 202b 2073 7472 286f 6c64 5f64 6174  '" + str(old_dat
+00045600: 6173 6574 5f64 762e 7374 6172 745f 6461  aset_dv.start_da
+00045610: 7465 2920 2b20 2227 222c 2022 4e55 4c4c  te) + "'", "NULL
+00045620: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00045630: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00045640: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
+00045650: 645f 6f6d 5f64 6174 6173 6574 5f64 7628  d_om_dataset_dv(
+00045660: 5b6e 6577 5f64 6174 6173 6574 5f64 765d  [new_dataset_dv]
+00045670: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00045680: 2020 2020 2020 2064 6174 6173 6574 5f61         dataset_a
+00045690: 6464 6564 2e61 7070 656e 6428 6f6c 645f  dded.append(old_
+000456a0: 6461 7461 7365 745f 6476 2e69 645f 6461  dataset_dv.id_da
+000456b0: 7461 7365 7429 0d0a 2020 2020 2020 2020  taset)..        
+000456c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000456d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000456e0: 2020 206e 6577 5f64 6174 6173 6574 5f64     new_dataset_d
+000456f0: 7620 3d20 5b6f 6c64 5f64 6174 6173 6574  v = [old_dataset
+00045700: 5f64 762e 6964 5f64 6174 6173 6574 2c20  _dv.id_dataset, 
+00045710: 6f6c 645f 6461 7461 7365 745f 6476 2e69  old_dataset_dv.i
+00045720: 645f 656e 7469 7479 5f74 7970 652c 0d0a  d_entity_type,..
+00045730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045740: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00045750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045760: 2020 2069 645f 6461 7461 7365 7420 3d20     id_dataset = 
-00045770: 6e65 7874 5f69 645f 6461 7461 7365 740d  next_id_dataset.
-00045780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045790: 2020 2020 206e 6578 745f 6964 5f64 6174       next_id_dat
-000457a0: 6173 6574 202b 3d20 310d 0a20 2020 2020  aset += 1..     
-000457b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000457c0: 6e74 7279 5f70 6174 6820 3d20 7365 6c66  ntry_path = self
-000457d0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000457e0: 2e67 6574 5f65 6e74 7279 5f70 6174 685f  .get_entry_path_
-000457f0: 6672 6f6d 5f63 6f64 5f70 6174 6828 656e  from_cod_path(en
-00045800: 7469 7479 2e63 6f64 5f70 6174 6829 0d0a  tity.cod_path)..
-00045810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045820: 2020 2020 6964 5f70 6174 6820 3d20 2873      id_path = (s
-00045830: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00045840: 6c6f 6164 2e67 6574 5f70 6174 685f 6672  load.get_path_fr
-00045850: 6f6d 5f64 6174 6162 6173 655f 616e 645f  om_database_and_
-00045860: 7363 6865 6d61 2865 6e74 7279 5f70 6174  schema(entry_pat
-00045870: 682e 6461 7461 6261 7365 5f6e 616d 652c  h.database_name,
-00045880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00045890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045760: 2020 7365 6c66 2e6f 776e 6572 2c20 2227    self.owner, "'
+00045770: 2220 2b20 7374 7228 6f6c 645f 6461 7461  " + str(old_data
+00045780: 7365 745f 6476 2e73 7461 7274 5f64 6174  set_dv.start_dat
+00045790: 6529 202b 2022 2722 2c0d 0a20 2020 2020  e) + "'",..     
+000457a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000457b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000457c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000457d0: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
+000457e0: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
+000457f0: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
+00045800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045810: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+00045820: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
+00045830: 6173 6574 5f64 7628 5b6e 6577 5f64 6174  aset_dv([new_dat
+00045840: 6173 6574 5f64 765d 290d 0a0d 0a20 2020  aset_dv])....   
+00045850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045860: 206e 6577 5f64 6174 6173 6574 5f64 7620   new_dataset_dv 
+00045870: 3d20 5b6e 6577 5f64 6174 6173 6574 5f69  = [new_dataset_i
+00045880: 642c 2069 645f 656e 7469 7479 5f74 7970  d, id_entity_typ
+00045890: 652c 2073 656c 662e 6f77 6e65 722c 0d0a  e, self.owner,..
 000458a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000458b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000458c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000458d0: 2020 2020 2020 2020 2065 6e74 7279 5f70           entry_p
-000458e0: 6174 682e 7363 6865 6d61 5f6e 616d 6529  ath.schema_name)
-000458f0: 292e 6964 5f70 6174 680d 0a20 2020 2020  ).id_path..     
-00045900: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00045910: 7461 7274 5f64 6174 6520 3d20 7365 6c66  tart_date = self
-00045920: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
-00045930: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
-00045940: 5f76 616c 7565 2829 0d0a 2020 2020 2020  _value()..      
-00045950: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00045960: 775f 736f 7572 6365 203d 205b 6964 5f64  w_source = [id_d
-00045970: 6174 6173 6574 2c20 656e 7469 7479 2e74  ataset, entity.t
-00045980: 6162 6c65 5f6e 616d 652c 2069 645f 656e  able_name, id_en
-00045990: 7469 7479 5f74 7970 652c 2069 645f 7061  tity_type, id_pa
-000459a0: 7468 2c20 7365 6c66 2e6f 776e 6572 2c20  th, self.owner, 
-000459b0: 7374 6172 745f 6461 7465 2c0d 0a20 2020  start_date,..   
-000459c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000459d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000459e0: 6e64 5f64 6174 655d 0d0a 2020 2020 2020  nd_date]..      
-000459f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00045a00: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-00045a10: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
-00045a20: 6574 285b 6e65 775f 736f 7572 6365 5d29  et([new_source])
-00045a30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00045a40: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00045a50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00045a60: 2049 6620 7468 6520 6461 7461 7365 7420   If the dataset 
-00045a70: 6578 6973 7473 2c20 7765 206e 6565 6420  exists, we need 
-00045a80: 746f 2076 6572 6966 7920 6966 2061 6e79  to verify if any
-00045a90: 206f 6620 7468 6520 6174 7472 6962 7574   of the attribut
-00045aa0: 6520 6861 7320 6368 616e 6765 640d 0a20  e has changed.. 
+000458c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000458d0: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
+000458e0: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
+000458f0: 655f 7661 6c75 6528 292c 2022 4e55 4c4c  e_value(), "NULL
+00045900: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00045910: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00045920: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
+00045930: 645f 6f6d 5f64 6174 6173 6574 5f64 7628  d_om_dataset_dv(
+00045940: 5b6e 6577 5f64 6174 6173 6574 5f64 765d  [new_dataset_dv]
+00045950: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00045960: 2020 2020 2020 2064 6174 6173 6574 5f61         dataset_a
+00045970: 6464 6564 2e61 7070 656e 6428 6e65 775f  dded.append(new_
+00045980: 6461 7461 7365 745f 6964 290d 0a0d 0a20  dataset_id).... 
+00045990: 2020 2020 2020 2066 6f72 2064 6174 6173         for datas
+000459a0: 6574 5f64 7620 696e 205b 7820 666f 7220  et_dv in [x for 
+000459b0: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
+000459c0: 7461 5f61 6374 7561 6c2e 6f6d 5f64 6174  ta_actual.om_dat
+000459d0: 6173 6574 5f64 7620 6966 2078 2e65 6e64  aset_dv if x.end
+000459e0: 5f64 6174 6520 6973 204e 6f6e 655d 3a0d  _date is None]:.
+000459f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00045a00: 6461 7461 7365 745f 6476 2e69 645f 6461  dataset_dv.id_da
+00045a10: 7461 7365 7420 6e6f 7420 696e 2064 6174  taset not in dat
+00045a20: 6173 6574 5f61 6464 6564 3a0d 0a0d 0a20  aset_added:.... 
+00045a30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00045a40: 6f74 5f61 7272 6976 696e 675f 6461 7461  ot_arriving_data
+00045a50: 7365 745f 6578 6563 7574 696f 6e20 3d20  set_execution = 
+00045a60: 5b64 6174 6173 6574 5f64 762e 6964 5f64  [dataset_dv.id_d
+00045a70: 6174 6173 6574 2c20 6461 7461 7365 745f  ataset, dataset_
+00045a80: 6476 2e69 645f 656e 7469 7479 5f74 7970  dv.id_entity_typ
+00045a90: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00045aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00045ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045ac0: 2020 2065 6e74 7279 5f70 6174 6820 3d20     entry_path = 
-00045ad0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00045ae0: 7475 616c 2e67 6574 5f65 6e74 7279 5f70  tual.get_entry_p
-00045af0: 6174 685f 6672 6f6d 5f63 6f64 5f70 6174  ath_from_cod_pat
-00045b00: 6828 656e 7469 7479 2e63 6f64 5f70 6174  h(entity.cod_pat
-00045b10: 6829 0d0a 0d0a 2020 2020 2020 2020 2020  h)....          
-00045b20: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
-00045b30: 6865 2064 6174 6173 6574 2068 6173 2074  he dataset has t
-00045b40: 6865 2073 616d 6520 454e 5449 5459 2054  he same ENTITY T
-00045b50: 5950 4520 616e 6420 5041 5448 203d 3e20  YPE and PATH => 
-00045b60: 6164 6420 7468 6520 7361 6d65 2064 6174  add the same dat
-00045b70: 6173 6574 0d0a 2020 2020 2020 2020 2020  aset..          
-00045b80: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-00045b90: 6173 6574 2e69 645f 7061 7468 203d 3d20  aset.id_path == 
-00045ba0: 2873 656c 662e 6d65 7461 6461 7461 5f74  (self.metadata_t
-00045bb0: 6f5f 6c6f 6164 2e67 6574 5f70 6174 685f  o_load.get_path_
-00045bc0: 6672 6f6d 5f64 6174 6162 6173 655f 616e  from_database_an
-00045bd0: 645f 7363 6865 6d61 2865 6e74 7279 5f70  d_schema(entry_p
-00045be0: 6174 682e 6461 7461 6261 7365 5f6e 616d  ath.database_nam
-00045bf0: 652c 656e 7472 795f 7061 7468 2e73 6368  e,entry_path.sch
-00045c00: 656d 615f 6e61 6d65 2929 2e69 645f 7061  ema_name)).id_pa
-00045c10: 7468 205c 0d0a 2020 2020 2020 2020 2020  th \..          
-00045c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045c30: 2020 616e 6420 6461 7461 7365 742e 6964    and dataset.id
-00045c40: 5f65 6e74 6974 795f 7479 7065 203d 3d20  _entity_type == 
-00045c50: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00045c60: 7475 616c 2e67 6574 5f65 6e74 6974 795f  tual.get_entity_
-00045c70: 7479 7065 5f66 726f 6d5f 656e 7469 7479  type_from_entity
-00045c80: 5f74 7970 655f 6e61 6d65 2845 4e54 4954  _type_name(ENTIT
-00045c90: 595f 5352 4329 2e69 645f 656e 7469 7479  Y_SRC).id_entity
-00045ca0: 5f74 7970 653a 0d0a 2020 2020 2020 2020  _type:..        
-00045cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045cc0: 6964 5f64 6174 6173 6574 203d 2064 6174  id_dataset = dat
-00045cd0: 6173 6574 2e69 645f 6461 7461 7365 740d  aset.id_dataset.
-00045ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045cf0: 2020 2020 2020 2020 2069 645f 7061 7468           id_path
-00045d00: 203d 2064 6174 6173 6574 2e69 645f 7061   = dataset.id_pa
-00045d10: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
-00045d20: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-00045d30: 655f 736f 7572 6365 203d 205b 6461 7461  e_source = [data
-00045d40: 7365 742e 6964 5f64 6174 6173 6574 2c20  set.id_dataset, 
-00045d50: 6461 7461 7365 742e 6461 7461 7365 745f  dataset.dataset_
-00045d60: 6e61 6d65 2c20 6461 7461 7365 742e 6964  name, dataset.id
-00045d70: 5f65 6e74 6974 795f 7479 7065 2c0d 0a20  _entity_type,.. 
-00045d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045da0: 2020 2020 2020 2064 6174 6173 6574 2e69         dataset.i
-00045db0: 645f 7061 7468 2c20 6461 7461 7365 742e  d_path, dataset.
-00045dc0: 6d65 7461 5f6f 776e 6572 2c20 2227 2220  meta_owner, "'" 
-00045dd0: 2b20 7374 7228 6461 7461 7365 742e 7374  + str(dataset.st
-00045de0: 6172 745f 6461 7465 2920 2b20 2227 222c  art_date) + "'",
-00045df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00045e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045e10: 2020 2020 2020 2020 2020 224e 554c 4c22            "NULL"
-00045e20: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00045e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00045e40: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-00045e50: 2e61 6464 5f6f 6d5f 6461 7461 7365 7428  .add_om_dataset(
-00045e60: 5b63 6c6f 7365 5f73 6f75 7263 655d 290d  [close_source]).
-00045e70: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
-00045e80: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
-00045e90: 6520 7061 7468 206f 7220 6465 2065 6e74  e path or de ent
-00045ea0: 6974 7920 7479 7065 2068 6173 2063 6861  ity type has cha
-00045eb0: 6e67 6564 2c20 7468 6520 6163 7475 616c  nged, the actual
-00045ec0: 206e 6565 6473 2074 6f20 6265 2063 6c6f   needs to be clo
-00045ed0: 7365 6420 616e 6420 6164 6420 7468 6520  sed and add the 
-00045ee0: 6163 7475 616c 0d0a 2020 2020 2020 2020  actual..        
-00045ef0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00045f00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00045f10: 2020 2020 2020 2020 2020 2023 2043 6c6f             # Clo
-00045f20: 7365 2074 6865 2061 6374 7561 6c20 6f6e  se the actual on
-00045f30: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00045f40: 2020 2020 2020 2020 2020 2063 6c6f 7365             close
-00045f50: 5f73 6f75 7263 6520 3d20 5b64 6174 6173  _source = [datas
-00045f60: 6574 2e69 645f 6461 7461 7365 742c 2064  et.id_dataset, d
-00045f70: 6174 6173 6574 2e64 6174 6173 6574 5f6e  ataset.dataset_n
-00045f80: 616d 652c 2064 6174 6173 6574 2e69 645f  ame, dataset.id_
-00045f90: 656e 7469 7479 5f74 7970 652c 0d0a 2020  entity_type,..  
-00045fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045fc0: 2020 2020 2020 6461 7461 7365 742e 6964        dataset.id
-00045fd0: 5f70 6174 682c 0d0a 2020 2020 2020 2020  _path,..        
-00045fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045ac0: 2020 2020 2020 7365 6c66 2e6f 776e 6572        self.owner
+00045ad0: 2c20 2227 2220 2b20 7374 7228 6461 7461  , "'" + str(data
+00045ae0: 7365 745f 6476 2e73 7461 7274 5f64 6174  set_dv.start_dat
+00045af0: 6529 202b 2022 2722 2c0d 0a20 2020 2020  e) + "'",..     
+00045b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045b20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00045b30: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
+00045b40: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
+00045b50: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
+00045b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00045b70: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
+00045b80: 642e 6164 645f 6f6d 5f64 6174 6173 6574  d.add_om_dataset
+00045b90: 5f64 7628 5b6e 6f74 5f61 7272 6976 696e  _dv([not_arrivin
+00045ba0: 675f 6461 7461 7365 745f 6578 6563 7574  g_dataset_execut
+00045bb0: 696f 6e5d 290d 0a0d 0a20 2020 2020 2020  ion])....       
+00045bc0: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
+00045bd0: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
+00045be0: 2246 696e 6973 6865 6420 746f 2070 726f  "Finished to pro
+00045bf0: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
+00045c00: 4456 2050 726f 7065 7274 6965 7320 5d20  DV Properties ] 
+00045c10: 696e 666f 726d 6174 696f 6e22 2c20 4c4f  information", LO
+00045c20: 475f 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47  G_LEVEL_ONLY_LOG
+00045c30: 290d 0a0d 0a20 2020 2064 6566 2070 726f  )....    def pro
+00045c40: 6365 7373 5f65 6c74 5f73 6f75 7263 6573  cess_elt_sources
+00045c50: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00045c60: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
+00045c70: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
+00045c80: 2253 7461 7274 696e 6720 746f 2070 726f  "Starting to pro
+00045c90: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
+00045ca0: 536f 7572 6365 7320 5d20 696e 666f 726d  Sources ] inform
+00045cb0: 6174 696f 6e22 2c20 4c4f 475f 4c45 5645  ation", LOG_LEVE
+00045cc0: 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20 2020  L_ONLY_LOG)..   
+00045cd0: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+00045ce0: 2323 2323 2323 2323 2323 2323 2320 4c4f  ############# LO
+00045cf0: 4144 2053 4f55 5243 4553 2061 6e64 2053  AD SOURCES and S
+00045d00: 5045 4349 4649 4341 5449 4f4e 5320 2323  PECIFICATIONS ##
+00045d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00045d20: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
+00045d30: 6e65 7874 5f69 645f 6461 7461 7365 7420  next_id_dataset 
+00045d40: 3d20 7365 6c66 2e6e 6578 745f 6964 5f64  = self.next_id_d
+00045d50: 6174 6173 6574 0d0a 2020 2020 2020 2020  ataset..        
+00045d60: 6e65 7874 5f69 645f 6461 7461 7365 745f  next_id_dataset_
+00045d70: 7370 6563 203d 2073 656c 662e 6e65 7874  spec = self.next
+00045d80: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
+00045d90: 0d0a 2020 2020 2020 2020 736f 7572 6365  ..        source
+00045da0: 735f 6c6f 6164 6564 203d 205b 5d0d 0a20  s_loaded = [].. 
+00045db0: 2020 2020 2020 2073 6f75 7263 6573 5f73         sources_s
+00045dc0: 7065 6373 5f6c 6f61 6465 6420 3d20 5b5d  pecs_loaded = []
+00045dd0: 0d0a 0d0a 2020 2020 2020 2020 2320 496e  ....        # In
+00045de0: 7075 7420 536f 7572 6365 730d 0a20 2020  put Sources..   
+00045df0: 2020 2020 2066 6f72 2065 6e74 6974 7920       for entity 
+00045e00: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
+00045e10: 5f61 6374 7561 6c2e 656e 7472 795f 656e  _actual.entry_en
+00045e20: 7469 7479 3a0d 0a20 2020 2020 2020 2020  tity:..         
+00045e30: 2020 2069 6620 656e 7469 7479 2e65 6e74     if entity.ent
+00045e40: 6974 795f 7479 7065 203d 3d20 454e 5449  ity_type == ENTI
+00045e50: 5459 5f53 5243 2061 6e64 2065 6e74 6974  TY_SRC and entit
+00045e60: 792e 7461 626c 655f 6e61 6d65 206e 6f74  y.table_name not
+00045e70: 2069 6e20 736f 7572 6365 735f 6c6f 6164   in sources_load
+00045e80: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+00045e90: 2020 2020 2064 6174 6173 6574 203d 2073       dataset = s
+00045ea0: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00045eb0: 7561 6c2e 6765 745f 6461 7461 7365 745f  ual.get_dataset_
+00045ec0: 6672 6f6d 5f64 6174 6173 6574 5f6e 616d  from_dataset_nam
+00045ed0: 6528 656e 7469 7479 2e74 6162 6c65 5f6e  e(entity.table_n
+00045ee0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00045ef0: 2020 2020 2020 6964 5f65 6e74 6974 795f        id_entity_
+00045f00: 7479 7065 203d 2028 7365 6c66 2e6d 6574  type = (self.met
+00045f10: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+00045f20: 5f65 6e74 6974 795f 7479 7065 5f66 726f  _entity_type_fro
+00045f30: 6d5f 656e 7469 7479 5f74 7970 655f 6e61  m_entity_type_na
+00045f40: 6d65 2845 4e54 4954 595f 5352 4329 292e  me(ENTITY_SRC)).
+00045f50: 6964 5f65 6e74 6974 795f 7479 7065 0d0a  id_entity_type..
+00045f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045f70: 656e 645f 6461 7465 203d 2022 4e55 4c4c  end_date = "NULL
+00045f80: 220d 0a0d 0a20 2020 2020 2020 2020 2020  "....           
+00045f90: 2020 2020 2069 6620 6461 7461 7365 7420       if dataset 
+00045fa0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00045fb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00045fc0: 4966 2074 6865 2064 6174 6173 6574 2064  If the dataset d
+00045fd0: 6f65 736e 2774 2065 7869 7374 2069 7420  oesn't exist it 
+00045fe0: 7769 6c6c 2062 6520 6164 6465 640d 0a20  will be added.. 
 00045ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046000: 6461 7461 7365 742e 6d65 7461 5f6f 776e  dataset.meta_own
-00046010: 6572 2c20 2227 2220 2b20 7374 7228 6461  er, "'" + str(da
-00046020: 7461 7365 742e 7374 6172 745f 6461 7465  taset.start_date
-00046030: 2920 2b20 2227 222c 0d0a 2020 2020 2020  ) + "'",..      
-00046040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046060: 2020 7365 6c66 2e63 6f6e 6e65 6374 696f    self.connectio
-00046070: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
-00046080: 7973 6461 7465 5f76 616c 7565 2829 5d0d  ysdate_value()].
-00046090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000460a0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-000460b0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-000460c0: 6464 5f6f 6d5f 6461 7461 7365 7428 5b63  dd_om_dataset([c
-000460d0: 6c6f 7365 5f73 6f75 7263 655d 290d 0a0d  lose_source])...
-000460e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000460f0: 2020 2020 2020 2020 2069 645f 6461 7461           id_data
-00046100: 7365 7420 3d20 6e65 7874 5f69 645f 6461  set = next_id_da
-00046110: 7461 7365 740d 0a20 2020 2020 2020 2020  taset..         
-00046120: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00046130: 6578 745f 6964 5f64 6174 6173 6574 202b  ext_id_dataset +
-00046140: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00046150: 2020 2020 2020 2020 2020 2020 2069 645f               id_
-00046160: 7061 7468 203d 2028 7365 6c66 2e6d 6574  path = (self.met
-00046170: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
-00046180: 745f 7061 7468 5f66 726f 6d5f 6461 7461  t_path_from_data
-00046190: 6261 7365 5f61 6e64 5f73 6368 656d 6128  base_and_schema(
-000461a0: 656e 7472 795f 7061 7468 2e64 6174 6162  entry_path.datab
-000461b0: 6173 655f 6e61 6d65 2c0d 0a20 2020 2020  ase_name,..     
-000461c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000461d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000461e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000461f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046210: 2020 2020 2020 656e 7472 795f 7061 7468        entry_path
-00046220: 2e73 6368 656d 615f 6e61 6d65 2929 2e69  .schema_name)).i
-00046230: 645f 7061 7468 0d0a 2020 2020 2020 2020  d_path..        
-00046240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046250: 2320 4164 6420 7468 6520 7570 6461 7465  # Add the update
-00046260: 6420 6f6e 650d 0a20 2020 2020 2020 2020  d one..         
-00046270: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00046280: 7064 6174 6564 5f73 6f75 7263 6520 3d20  pdated_source = 
-00046290: 5b69 645f 6461 7461 7365 742c 2064 6174  [id_dataset, dat
-000462a0: 6173 6574 2e64 6174 6173 6574 5f6e 616d  aset.dataset_nam
-000462b0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-000462c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000462d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000462e0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000462f0: 2e67 6574 5f65 6e74 6974 795f 7479 7065  .get_entity_type
-00046300: 5f66 726f 6d5f 656e 7469 7479 5f74 7970  _from_entity_typ
-00046310: 655f 6e61 6d65 280d 0a20 2020 2020 2020  e_name(..       
-00046320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046340: 2020 2020 2045 4e54 4954 595f 5352 4329       ENTITY_SRC)
-00046350: 2e69 645f 656e 7469 7479 5f74 7970 652c  .id_entity_type,
-00046360: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046380: 2020 2020 2020 2020 2020 6964 5f70 6174            id_pat
-00046390: 682c 2064 6174 6173 6574 2e6d 6574 615f  h, dataset.meta_
-000463a0: 6f77 6e65 722c 2073 656c 662e 636f 6e6e  owner, self.conn
-000463b0: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
-000463c0: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
-000463d0: 6528 292c 0d0a 2020 2020 2020 2020 2020  e(),..          
-000463e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000463f0: 2020 2020 2020 2020 2020 2020 2020 224e                "N
-00046400: 554c 4c22 5d0d 0a20 2020 2020 2020 2020  ULL"]..         
-00046410: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00046420: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00046430: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-00046440: 7365 7428 5b75 7064 6174 6564 5f73 6f75  set([updated_sou
-00046450: 7263 655d 290d 0a20 2020 2020 2020 2020  rce])..         
-00046460: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00046470: 6174 6173 6574 203d 2073 656c 662e 6d65  ataset = self.me
-00046480: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e67  tadata_to_load.g
-00046490: 6574 5f64 6174 6173 6574 5f66 726f 6d5f  et_dataset_from_
-000464a0: 6461 7461 7365 745f 6e61 6d65 2864 6174  dataset_name(dat
-000464b0: 6173 6574 2e64 6174 6173 6574 5f6e 616d  aset.dataset_nam
-000464c0: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
-000464d0: 2020 2020 2020 736f 7572 6365 735f 6c6f        sources_lo
-000464e0: 6164 6564 2e61 7070 656e 6428 656e 7469  aded.append(enti
-000464f0: 7479 2e74 6162 6c65 5f6e 616d 6529 0d0a  ty.table_name)..
-00046500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046510: 2020 2320 4765 7420 4461 7461 7365 7420    # Get Dataset 
-00046520: 5370 6563 6966 6963 6174 696f 6e73 2066  Specifications f
-00046530: 726f 6d20 4461 7461 2044 6174 6162 6173  rom Data Databas
-00046540: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00046550: 2020 2076 6172 6961 626c 655f 636f 6e6e     variable_conn
-00046560: 6563 7469 6f6e 203d 2073 656c 662e 636f  ection = self.co
-00046570: 6e66 6967 7572 6174 696f 6e5f 6669 6c65  nfiguration_file
-00046580: 5b27 6461 7461 275d 5b27 636f 6e6e 6563  ['data']['connec
-00046590: 7469 6f6e 5f74 7970 6527 5d2e 6c6f 7765  tion_type'].lowe
-000465a0: 7228 2920 2b20 225f 6461 7461 6261 7365  r() + "_database
-000465b0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-000465c0: 2020 2063 6f6e 6669 6775 7261 7469 6f6e     configuration
-000465d0: 5f63 6f6e 6e65 6374 696f 6e5f 6461 7461  _connection_data
-000465e0: 203d 2073 656c 662e 636f 6e66 6967 7572   = self.configur
-000465f0: 6174 696f 6e5f 6669 6c65 5b27 6461 7461  ation_file['data
-00046600: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
-00046610: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
-00046620: 6e5f 636f 6e6e 6563 7469 6f6e 5f64 6174  n_connection_dat
-00046630: 615b 7661 7269 6162 6c65 5f63 6f6e 6e65  a[variable_conne
-00046640: 6374 696f 6e5d 203d 2028 7365 6c66 2e6d  ction] = (self.m
-00046650: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
-00046660: 6765 745f 7061 7468 5f66 726f 6d5f 6964  get_path_from_id
-00046670: 5f70 6174 6828 6964 5f70 6174 6829 292e  _path(id_path)).
-00046680: 6461 7461 6261 7365 5f6e 616d 650d 0a20  database_name.. 
-00046690: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000466a0: 656c 662e 636f 6e6e 6563 7469 6f6e 2e73  elf.connection.s
-000466b0: 6574 7570 5f63 6f6e 6e65 6374 696f 6e28  etup_connection(
-000466c0: 636f 6e66 6967 7572 6174 696f 6e5f 636f  configuration_co
-000466d0: 6e6e 6563 7469 6f6e 5f64 6174 612c 2073  nnection_data, s
-000466e0: 656c 662e 6c6f 6729 0d0a 2020 2020 2020  elf.log)..      
-000466f0: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-00046700: 6465 6669 6e69 7469 6f6e 203d 2073 656c  definition = sel
-00046710: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
-00046720: 5f74 6162 6c65 5f63 6f6c 756d 6e73 5f64  _table_columns_d
-00046730: 6566 696e 6974 696f 6e28 656e 7469 7479  efinition(entity
-00046740: 2e74 6162 6c65 5f6e 616d 6529 0d0a 2020  .table_name)..  
-00046750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00046760: 206c 656e 2874 6162 6c65 5f64 6566 696e   len(table_defin
-00046770: 6974 696f 6e29 203d 3d20 303a 2073 656c  ition) == 0: sel
-00046780: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
-00046790: 6e67 696e 655f 6e61 6d65 2c0d 0a20 2020  ngine_name,..   
-000467a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000467b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000467c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000467d0: 2020 2020 2020 2020 2022 536f 7572 6365           "Source
-000467e0: 205b 2027 2220 2b20 656e 7469 7479 2e74   [ '" + entity.t
-000467f0: 6162 6c65 5f6e 616d 6520 2b20 2227 205d  able_name + "' ]
-00046800: 2069 7320 6e6f 7420 6372 6561 7465 6420   is not created 
-00046810: 696e 2074 6865 2064 6174 6162 6173 652e  in the database.
-00046820: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00046830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046000: 2020 2069 645f 6461 7461 7365 7420 3d20     id_dataset = 
+00046010: 6e65 7874 5f69 645f 6461 7461 7365 740d  next_id_dataset.
+00046020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046030: 2020 2020 206e 6578 745f 6964 5f64 6174       next_id_dat
+00046040: 6173 6574 202b 3d20 310d 0a20 2020 2020  aset += 1..     
+00046050: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00046060: 6e74 7279 5f70 6174 6820 3d20 7365 6c66  ntry_path = self
+00046070: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00046080: 2e67 6574 5f65 6e74 7279 5f70 6174 685f  .get_entry_path_
+00046090: 6672 6f6d 5f63 6f64 5f70 6174 6828 656e  from_cod_path(en
+000460a0: 7469 7479 2e63 6f64 5f70 6174 6829 0d0a  tity.cod_path)..
+000460b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000460c0: 2020 2020 6964 5f70 6174 6820 3d20 2873      id_path = (s
+000460d0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+000460e0: 6c6f 6164 2e67 6574 5f70 6174 685f 6672  load.get_path_fr
+000460f0: 6f6d 5f64 6174 6162 6173 655f 616e 645f  om_database_and_
+00046100: 7363 6865 6d61 2865 6e74 7279 5f70 6174  schema(entry_pat
+00046110: 682e 6461 7461 6261 7365 5f6e 616d 652c  h.database_name,
+00046120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00046130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046170: 2020 2020 2020 2020 2065 6e74 7279 5f70           entry_p
+00046180: 6174 682e 7363 6865 6d61 5f6e 616d 6529  ath.schema_name)
+00046190: 292e 6964 5f70 6174 680d 0a20 2020 2020  ).id_path..     
+000461a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000461b0: 7461 7274 5f64 6174 6520 3d20 7365 6c66  tart_date = self
+000461c0: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
+000461d0: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
+000461e0: 5f76 616c 7565 2829 0d0a 2020 2020 2020  _value()..      
+000461f0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00046200: 775f 736f 7572 6365 203d 205b 6964 5f64  w_source = [id_d
+00046210: 6174 6173 6574 2c20 656e 7469 7479 2e74  ataset, entity.t
+00046220: 6162 6c65 5f6e 616d 652c 2069 645f 656e  able_name, id_en
+00046230: 7469 7479 5f74 7970 652c 2069 645f 7061  tity_type, id_pa
+00046240: 7468 2c20 7365 6c66 2e6f 776e 6572 2c20  th, self.owner, 
+00046250: 7374 6172 745f 6461 7465 2c0d 0a20 2020  start_date,..   
+00046260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046270: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00046280: 6e64 5f64 6174 655d 0d0a 2020 2020 2020  nd_date]..      
+00046290: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000462a0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+000462b0: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
+000462c0: 6574 285b 6e65 775f 736f 7572 6365 5d29  et([new_source])
+000462d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000462e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000462f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00046300: 2049 6620 7468 6520 6461 7461 7365 7420   If the dataset 
+00046310: 6578 6973 7473 2c20 7765 206e 6565 6420  exists, we need 
+00046320: 746f 2076 6572 6966 7920 6966 2061 6e79  to verify if any
+00046330: 206f 6620 7468 6520 6174 7472 6962 7574   of the attribut
+00046340: 6520 6861 7320 6368 616e 6765 640d 0a20  e has changed.. 
+00046350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046360: 2020 2065 6e74 7279 5f70 6174 6820 3d20     entry_path = 
+00046370: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00046380: 7475 616c 2e67 6574 5f65 6e74 7279 5f70  tual.get_entry_p
+00046390: 6174 685f 6672 6f6d 5f63 6f64 5f70 6174  ath_from_cod_pat
+000463a0: 6828 656e 7469 7479 2e63 6f64 5f70 6174  h(entity.cod_pat
+000463b0: 6829 0d0a 0d0a 2020 2020 2020 2020 2020  h)....          
+000463c0: 2020 2020 2020 2020 2020 2320 4966 2074            # If t
+000463d0: 6865 2064 6174 6173 6574 2068 6173 2074  he dataset has t
+000463e0: 6865 2073 616d 6520 454e 5449 5459 2054  he same ENTITY T
+000463f0: 5950 4520 616e 6420 5041 5448 203d 3e20  YPE and PATH => 
+00046400: 6164 6420 7468 6520 7361 6d65 2064 6174  add the same dat
+00046410: 6173 6574 0d0a 2020 2020 2020 2020 2020  aset..          
+00046420: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
+00046430: 6173 6574 2e69 645f 7061 7468 203d 3d20  aset.id_path == 
+00046440: 2873 656c 662e 6d65 7461 6461 7461 5f74  (self.metadata_t
+00046450: 6f5f 6c6f 6164 2e67 6574 5f70 6174 685f  o_load.get_path_
+00046460: 6672 6f6d 5f64 6174 6162 6173 655f 616e  from_database_an
+00046470: 645f 7363 6865 6d61 2865 6e74 7279 5f70  d_schema(entry_p
+00046480: 6174 682e 6461 7461 6261 7365 5f6e 616d  ath.database_nam
+00046490: 652c 656e 7472 795f 7061 7468 2e73 6368  e,entry_path.sch
+000464a0: 656d 615f 6e61 6d65 2929 2e69 645f 7061  ema_name)).id_pa
+000464b0: 7468 205c 0d0a 2020 2020 2020 2020 2020  th \..          
+000464c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000464d0: 2020 616e 6420 6461 7461 7365 742e 6964    and dataset.id
+000464e0: 5f65 6e74 6974 795f 7479 7065 203d 3d20  _entity_type == 
+000464f0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00046500: 7475 616c 2e67 6574 5f65 6e74 6974 795f  tual.get_entity_
+00046510: 7479 7065 5f66 726f 6d5f 656e 7469 7479  type_from_entity
+00046520: 5f74 7970 655f 6e61 6d65 2845 4e54 4954  _type_name(ENTIT
+00046530: 595f 5352 4329 2e69 645f 656e 7469 7479  Y_SRC).id_entity
+00046540: 5f74 7970 653a 0d0a 2020 2020 2020 2020  _type:..        
+00046550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046560: 6964 5f64 6174 6173 6574 203d 2064 6174  id_dataset = dat
+00046570: 6173 6574 2e69 645f 6461 7461 7365 740d  aset.id_dataset.
+00046580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046590: 2020 2020 2020 2020 2069 645f 7061 7468           id_path
+000465a0: 203d 2064 6174 6173 6574 2e69 645f 7061   = dataset.id_pa
+000465b0: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
+000465c0: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
+000465d0: 655f 736f 7572 6365 203d 205b 6461 7461  e_source = [data
+000465e0: 7365 742e 6964 5f64 6174 6173 6574 2c20  set.id_dataset, 
+000465f0: 6461 7461 7365 742e 6461 7461 7365 745f  dataset.dataset_
+00046600: 6e61 6d65 2c20 6461 7461 7365 742e 6964  name, dataset.id
+00046610: 5f65 6e74 6974 795f 7479 7065 2c0d 0a20  _entity_type,.. 
+00046620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046640: 2020 2020 2020 2064 6174 6173 6574 2e69         dataset.i
+00046650: 645f 7061 7468 2c20 6461 7461 7365 742e  d_path, dataset.
+00046660: 6d65 7461 5f6f 776e 6572 2c20 2227 2220  meta_owner, "'" 
+00046670: 2b20 7374 7228 6461 7461 7365 742e 7374  + str(dataset.st
+00046680: 6172 745f 6461 7465 2920 2b20 2227 222c  art_date) + "'",
+00046690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000466a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000466b0: 2020 2020 2020 2020 2020 224e 554c 4c22            "NULL"
+000466c0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000466d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000466e0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+000466f0: 2e61 6464 5f6f 6d5f 6461 7461 7365 7428  .add_om_dataset(
+00046700: 5b63 6c6f 7365 5f73 6f75 7263 655d 290d  [close_source]).
+00046710: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
+00046720: 2020 2020 2020 2020 2023 2049 6620 7468           # If th
+00046730: 6520 7061 7468 206f 7220 6465 2065 6e74  e path or de ent
+00046740: 6974 7920 7479 7065 2068 6173 2063 6861  ity type has cha
+00046750: 6e67 6564 2c20 7468 6520 6163 7475 616c  nged, the actual
+00046760: 206e 6565 6473 2074 6f20 6265 2063 6c6f   needs to be clo
+00046770: 7365 6420 616e 6420 6164 6420 7468 6520  sed and add the 
+00046780: 6163 7475 616c 0d0a 2020 2020 2020 2020  actual..        
+00046790: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000467a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000467b0: 2020 2020 2020 2020 2020 2023 2043 6c6f             # Clo
+000467c0: 7365 2074 6865 2061 6374 7561 6c20 6f6e  se the actual on
+000467d0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000467e0: 2020 2020 2020 2020 2020 2063 6c6f 7365             close
+000467f0: 5f73 6f75 7263 6520 3d20 5b64 6174 6173  _source = [datas
+00046800: 6574 2e69 645f 6461 7461 7365 742c 2064  et.id_dataset, d
+00046810: 6174 6173 6574 2e64 6174 6173 6574 5f6e  ataset.dataset_n
+00046820: 616d 652c 2064 6174 6173 6574 2e69 645f  ame, dataset.id_
+00046830: 656e 7469 7479 5f74 7970 652c 0d0a 2020  entity_type,..  
 00046840: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00046850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046860: 4c4f 475f 4c45 5645 4c5f 5741 524e 494e  LOG_LEVEL_WARNIN
-00046870: 4729 0d0a 0d0a 2020 2020 2020 2020 2020  G)....          
-00046880: 2020 2020 2020 2320 536f 7572 6365 2053        # Source S
-00046890: 7065 6369 6669 6361 7469 6f6e 0d0a 2020  pecification..  
-000468a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000468b0: 2064 6174 6173 6574 2069 7320 4e6f 6e65   dataset is None
-000468c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000468d0: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
-000468e0: 6461 7461 7365 7420 6973 206e 6577 2c20  dataset is new, 
-000468f0: 616c 6c20 7468 6520 6461 7461 7365 7420  all the dataset 
-00046900: 7370 6563 6966 6963 6174 696f 6e20 7769  specification wi
-00046910: 6c6c 2062 6520 6164 6465 640d 0a20 2020  ll be added..   
-00046920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046930: 2066 6f72 2074 6162 6c65 5f64 6566 696e   for table_defin
-00046940: 6974 696f 6e5f 7370 6563 2069 6e20 7461  ition_spec in ta
-00046950: 626c 655f 6465 6669 6e69 7469 6f6e 3a0d  ble_definition:.
-00046960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046970: 2020 2020 2020 2020 2069 645f 6461 7461           id_data
-00046980: 7365 745f 7370 6563 203d 206e 6578 745f  set_spec = next_
-00046990: 6964 5f64 6174 6173 6574 5f73 7065 630d  id_dataset_spec.
-000469a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000469b0: 2020 2020 2020 2020 206e 6578 745f 6964           next_id
-000469c0: 5f64 6174 6173 6574 5f73 7065 6320 2b3d  _dataset_spec +=
-000469d0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-000469e0: 2020 2020 2020 2020 2020 2020 6964 5f6b              id_k
-000469f0: 6579 5f74 7970 6520 3d20 2873 656c 662e  ey_type = (self.
-00046a00: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00046a10: 6765 745f 6b65 795f 7479 7065 5f66 726f  get_key_type_fro
-00046a20: 6d5f 6b65 795f 7479 7065 5f6e 616d 6528  m_key_type_name(
-00046a30: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
-00046a40: 5f73 7065 632e 6b65 795f 7479 7065 2929  _spec.key_type))
-00046a50: 2e69 645f 6b65 795f 7479 7065 0d0a 2020  .id_key_type..  
+00046860: 2020 2020 2020 6461 7461 7365 742e 6964        dataset.id
+00046870: 5f70 6174 682c 0d0a 2020 2020 2020 2020  _path,..        
+00046880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000468a0: 6461 7461 7365 742e 6d65 7461 5f6f 776e  dataset.meta_own
+000468b0: 6572 2c20 2227 2220 2b20 7374 7228 6461  er, "'" + str(da
+000468c0: 7461 7365 742e 7374 6172 745f 6461 7465  taset.start_date
+000468d0: 2920 2b20 2227 222c 0d0a 2020 2020 2020  ) + "'",..      
+000468e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000468f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046900: 2020 7365 6c66 2e63 6f6e 6e65 6374 696f    self.connectio
+00046910: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
+00046920: 7973 6461 7465 5f76 616c 7565 2829 5d0d  ysdate_value()].
+00046930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046940: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00046950: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+00046960: 6464 5f6f 6d5f 6461 7461 7365 7428 5b63  dd_om_dataset([c
+00046970: 6c6f 7365 5f73 6f75 7263 655d 290d 0a0d  lose_source])...
+00046980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046990: 2020 2020 2020 2020 2069 645f 6461 7461           id_data
+000469a0: 7365 7420 3d20 6e65 7874 5f69 645f 6461  set = next_id_da
+000469b0: 7461 7365 740d 0a20 2020 2020 2020 2020  taset..         
+000469c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000469d0: 6578 745f 6964 5f64 6174 6173 6574 202b  ext_id_dataset +
+000469e0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+000469f0: 2020 2020 2020 2020 2020 2020 2069 645f               id_
+00046a00: 7061 7468 203d 2028 7365 6c66 2e6d 6574  path = (self.met
+00046a10: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
+00046a20: 745f 7061 7468 5f66 726f 6d5f 6461 7461  t_path_from_data
+00046a30: 6261 7365 5f61 6e64 5f73 6368 656d 6128  base_and_schema(
+00046a40: 656e 7472 795f 7061 7468 2e64 6174 6162  entry_path.datab
+00046a50: 6173 655f 6e61 6d65 2c0d 0a20 2020 2020  ase_name,..     
 00046a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046a70: 2020 2020 2020 7374 6172 745f 6461 7465        start_date
-00046a80: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
-00046a90: 6f6e 5f6d 6574 6164 6174 612e 6765 745f  on_metadata.get_
-00046aa0: 7379 7364 6174 655f 7661 6c75 6528 290d  sysdate_value().
-00046ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046ac0: 2020 2020 2020 2020 2065 6e64 5f64 6174           end_dat
-00046ad0: 6520 3d20 224e 554c 4c22 0d0a 0d0a 2020  e = "NULL"....  
+00046a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046ab0: 2020 2020 2020 656e 7472 795f 7061 7468        entry_path
+00046ac0: 2e73 6368 656d 615f 6e61 6d65 2929 2e69  .schema_name)).i
+00046ad0: 645f 7061 7468 0d0a 2020 2020 2020 2020  d_path..        
 00046ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046af0: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
-00046b00: 745f 7370 6563 6966 6963 6174 696f 6e20  t_specification 
-00046b10: 3d20 5b69 645f 6461 7461 7365 745f 7370  = [id_dataset_sp
-00046b20: 6563 2c20 6964 5f64 6174 6173 6574 2c20  ec, id_dataset, 
-00046b30: 6964 5f6b 6579 5f74 7970 652c 0d0a 2020  id_key_type,..  
-00046b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046af0: 2320 4164 6420 7468 6520 7570 6461 7465  # Add the update
+00046b00: 6420 6f6e 650d 0a20 2020 2020 2020 2020  d one..         
+00046b10: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00046b20: 7064 6174 6564 5f73 6f75 7263 6520 3d20  pdated_source = 
+00046b30: 5b69 645f 6461 7461 7365 742c 2064 6174  [id_dataset, dat
+00046b40: 6173 6574 2e64 6174 6173 6574 5f6e 616d  aset.dataset_nam
+00046b50: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
 00046b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046b70: 2020 2074 6162 6c65 5f64 6566 696e 6974     table_definit
-00046b80: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
-00046b90: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
-00046ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046bc0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00046bd0: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
-00046be0: 632e 636f 6c75 6d6e 5f74 7970 652c 2074  c.column_type, t
-00046bf0: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-00046c00: 7370 6563 2e69 642c 0d0a 2020 2020 2020  spec.id,..      
+00046b70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00046b80: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00046b90: 2e67 6574 5f65 6e74 6974 795f 7479 7065  .get_entity_type
+00046ba0: 5f66 726f 6d5f 656e 7469 7479 5f74 7970  _from_entity_typ
+00046bb0: 655f 6e61 6d65 280d 0a20 2020 2020 2020  e_name(..       
+00046bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046be0: 2020 2020 2045 4e54 4954 595f 5352 4329       ENTITY_SRC)
+00046bf0: 2e69 645f 656e 7469 7479 5f74 7970 652c  .id_entity_type,
+00046c00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00046c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046c30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00046c40: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-00046c50: 7370 6563 2e69 735f 6e75 6c6c 6162 6c65  spec.is_nullable
-00046c60: 2c20 7461 626c 655f 6465 6669 6e69 7469  , table_definiti
-00046c70: 6f6e 5f73 7065 632e 636f 6c75 6d6e 5f6c  on_spec.column_l
-00046c80: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-00046c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046cb0: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-00046cc0: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
-00046cd0: 6563 2e63 6f6c 756d 6e5f 7072 6563 6973  ec.column_precis
-00046ce0: 696f 6e2c 2074 6162 6c65 5f64 6566 696e  ion, table_defin
-00046cf0: 6974 696f 6e5f 7370 6563 2e63 6f6c 756d  ition_spec.colum
-00046d00: 6e5f 7363 616c 652c 0d0a 2020 2020 2020  n_scale,..      
-00046d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046d30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00046d40: 656c 662e 6f77 6e65 722c 2073 7461 7274  elf.owner, start
-00046d50: 5f64 6174 652c 2065 6e64 5f64 6174 655d  _date, end_date]
-00046d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046d70: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00046d80: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
-00046d90: 6164 645f 6f6d 5f64 6174 6173 6574 5f73  add_om_dataset_s
-00046da0: 7065 6369 6669 6361 7469 6f6e 285b 6e65  pecification([ne
-00046db0: 775f 6461 7461 7365 745f 7370 6563 6966  w_dataset_specif
-00046dc0: 6963 6174 696f 6e5d 290d 0a20 2020 2020  ication])..     
-00046dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046de0: 2020 2073 6f75 7263 6573 5f73 7065 6373     sources_specs
-00046df0: 5f6c 6f61 6465 642e 6170 7065 6e64 285b  _loaded.append([
-00046e00: 6964 5f64 6174 6173 6574 2c20 7461 626c  id_dataset, tabl
-00046e10: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
-00046e20: 632e 636f 6c75 6d6e 5f6e 616d 655d 290d  c.column_name]).
-00046e30: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00046e40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00046e50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00046e60: 536f 7572 6365 2073 7065 6369 6669 6361  Source specifica
-00046e70: 7469 6f6e 2065 7869 7374 656e 740d 0a20  tion existent.. 
-00046e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046e90: 2020 2023 2055 7064 6174 6520 616e 7920     # Update any 
-00046ea0: 636f 6c75 6d6e 0d0a 2020 2020 2020 2020  column..        
-00046eb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00046ec0: 6578 6973 7465 6e74 5f63 6f6c 2069 6e20  existent_col in 
-00046ed0: 5b78 2066 6f72 2078 2069 6e20 7365 6c66  [x for x in self
-00046ee0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00046ef0: 2e6f 6d5f 6461 7461 7365 745f 7370 6563  .om_dataset_spec
-00046f00: 6966 6963 6174 696f 6e20 6966 2078 2e69  ification if x.i
-00046f10: 645f 6461 7461 7365 7420 3d3d 2064 6174  d_dataset == dat
-00046f20: 6173 6574 2e69 645f 6461 7461 7365 7420  aset.id_dataset 
-00046f30: 616e 6420 782e 656e 645f 6461 7465 2069  and x.end_date i
-00046f40: 7320 4e6f 6e65 5d3a 0d0a 2020 2020 2020  s None]:..      
-00046f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046f60: 2020 6669 6e64 6564 203d 2046 616c 7365    finded = False
-00046f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046f80: 2020 2020 2020 2020 2020 666f 7220 7461            for ta
-00046f90: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
-00046fa0: 7065 6320 696e 2074 6162 6c65 5f64 6566  pec in table_def
-00046fb0: 696e 6974 696f 6e3a 0d0a 2020 2020 2020  inition:..      
-00046fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046fd0: 2020 2020 2020 6964 5f6b 6579 5f74 7970        id_key_typ
-00046fe0: 6520 3d20 2873 656c 662e 6d65 7461 6461  e = (self.metada
-00046ff0: 7461 5f61 6374 7561 6c2e 6765 745f 6b65  ta_actual.get_ke
-00047000: 795f 7479 7065 5f66 726f 6d5f 6b65 795f  y_type_from_key_
-00047010: 7479 7065 5f6e 616d 6528 7461 626c 655f  type_name(table_
-00047020: 6465 6669 6e69 7469 6f6e 5f73 7065 632e  definition_spec.
-00047030: 6b65 795f 7479 7065 2929 2e69 645f 6b65  key_type)).id_ke
-00047040: 795f 7479 7065 0d0a 0d0a 2020 2020 2020  y_type....      
+00046c20: 2020 2020 2020 2020 2020 6964 5f70 6174            id_pat
+00046c30: 682c 2064 6174 6173 6574 2e6d 6574 615f  h, dataset.meta_
+00046c40: 6f77 6e65 722c 2073 656c 662e 636f 6e6e  owner, self.conn
+00046c50: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
+00046c60: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
+00046c70: 6528 292c 0d0a 2020 2020 2020 2020 2020  e(),..          
+00046c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046c90: 2020 2020 2020 2020 2020 2020 2020 224e                "N
+00046ca0: 554c 4c22 5d0d 0a20 2020 2020 2020 2020  ULL"]..         
+00046cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00046cc0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+00046cd0: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+00046ce0: 7365 7428 5b75 7064 6174 6564 5f73 6f75  set([updated_sou
+00046cf0: 7263 655d 290d 0a20 2020 2020 2020 2020  rce])..         
+00046d00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00046d10: 6174 6173 6574 203d 2073 656c 662e 6d65  ataset = self.me
+00046d20: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e67  tadata_to_load.g
+00046d30: 6574 5f64 6174 6173 6574 5f66 726f 6d5f  et_dataset_from_
+00046d40: 6461 7461 7365 745f 6e61 6d65 2864 6174  dataset_name(dat
+00046d50: 6173 6574 2e64 6174 6173 6574 5f6e 616d  aset.dataset_nam
+00046d60: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
+00046d70: 2020 2020 2020 736f 7572 6365 735f 6c6f        sources_lo
+00046d80: 6164 6564 2e61 7070 656e 6428 656e 7469  aded.append(enti
+00046d90: 7479 2e74 6162 6c65 5f6e 616d 6529 0d0a  ty.table_name)..
+00046da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00046db0: 2020 2320 4765 7420 4461 7461 7365 7420    # Get Dataset 
+00046dc0: 5370 6563 6966 6963 6174 696f 6e73 2066  Specifications f
+00046dd0: 726f 6d20 4461 7461 2044 6174 6162 6173  rom Data Databas
+00046de0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00046df0: 2020 2076 6172 6961 626c 655f 636f 6e6e     variable_conn
+00046e00: 6563 7469 6f6e 203d 2073 656c 662e 636f  ection = self.co
+00046e10: 6e66 6967 7572 6174 696f 6e5f 6669 6c65  nfiguration_file
+00046e20: 5b27 6461 7461 275d 5b27 636f 6e6e 6563  ['data']['connec
+00046e30: 7469 6f6e 5f74 7970 6527 5d2e 6c6f 7765  tion_type'].lowe
+00046e40: 7228 2920 2b20 225f 6461 7461 6261 7365  r() + "_database
+00046e50: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+00046e60: 2020 2063 6f6e 6669 6775 7261 7469 6f6e     configuration
+00046e70: 5f63 6f6e 6e65 6374 696f 6e5f 6461 7461  _connection_data
+00046e80: 203d 2073 656c 662e 636f 6e66 6967 7572   = self.configur
+00046e90: 6174 696f 6e5f 6669 6c65 5b27 6461 7461  ation_file['data
+00046ea0: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
+00046eb0: 2020 2020 636f 6e66 6967 7572 6174 696f      configuratio
+00046ec0: 6e5f 636f 6e6e 6563 7469 6f6e 5f64 6174  n_connection_dat
+00046ed0: 615b 7661 7269 6162 6c65 5f63 6f6e 6e65  a[variable_conne
+00046ee0: 6374 696f 6e5d 203d 2028 7365 6c66 2e6d  ction] = (self.m
+00046ef0: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
+00046f00: 6765 745f 7061 7468 5f66 726f 6d5f 6964  get_path_from_id
+00046f10: 5f70 6174 6828 6964 5f70 6174 6829 292e  _path(id_path)).
+00046f20: 6461 7461 6261 7365 5f6e 616d 650d 0a20  database_name.. 
+00046f30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00046f40: 656c 662e 636f 6e6e 6563 7469 6f6e 2e73  elf.connection.s
+00046f50: 6574 7570 5f63 6f6e 6e65 6374 696f 6e28  etup_connection(
+00046f60: 636f 6e66 6967 7572 6174 696f 6e5f 636f  configuration_co
+00046f70: 6e6e 6563 7469 6f6e 5f64 6174 612c 2073  nnection_data, s
+00046f80: 656c 662e 6c6f 6729 0d0a 2020 2020 2020  elf.log)..      
+00046f90: 2020 2020 2020 2020 2020 7461 626c 655f            table_
+00046fa0: 6465 6669 6e69 7469 6f6e 203d 2073 656c  definition = sel
+00046fb0: 662e 636f 6e6e 6563 7469 6f6e 2e67 6574  f.connection.get
+00046fc0: 5f74 6162 6c65 5f63 6f6c 756d 6e73 5f64  _table_columns_d
+00046fd0: 6566 696e 6974 696f 6e28 656e 7469 7479  efinition(entity
+00046fe0: 2e74 6162 6c65 5f6e 616d 6529 0d0a 2020  .table_name)..  
+00046ff0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00047000: 206c 656e 2874 6162 6c65 5f64 6566 696e   len(table_defin
+00047010: 6974 696f 6e29 203d 3d20 303a 2073 656c  ition) == 0: sel
+00047020: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
+00047030: 6e67 696e 655f 6e61 6d65 2c0d 0a20 2020  ngine_name,..   
+00047040: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00047050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047060: 2020 2020 2020 6368 6563 6b73 756d 5f65        checksum_e
-00047070: 7869 7374 656e 7420 3d20 7374 7228 0d0a  xistent = str(..
-00047080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000470a0: 6578 6973 7465 6e74 5f63 6f6c 2e69 645f  existent_col.id_
-000470b0: 6b65 795f 7479 7065 2920 2b20 6578 6973  key_type) + exis
-000470c0: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
-000470d0: 6e61 6d65 202b 2065 7869 7374 656e 745f  name + existent_
-000470e0: 636f 6c2e 636f 6c75 6d6e 5f74 7970 6520  col.column_type 
-000470f0: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
-00047100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047120: 2020 2020 2073 7472 2865 7869 7374 656e       str(existen
-00047130: 745f 636f 6c2e 6f72 6469 6e61 6c5f 706f  t_col.ordinal_po
-00047140: 7369 7469 6f6e 2920 2b20 7374 7228 0d0a  sition) + str(..
-00047150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047170: 6578 6973 7465 6e74 5f63 6f6c 2e69 735f  existent_col.is_
-00047180: 6e75 6c6c 6162 6c65 2920 2b20 7374 7228  nullable) + str(
-00047190: 6578 6973 7465 6e74 5f63 6f6c 2e63 6f6c  existent_col.col
-000471a0: 756d 6e5f 6c65 6e67 7468 2920 2b20 5c0d  umn_length) + \.
-000471b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047070: 2020 2020 2020 2020 2022 536f 7572 6365           "Source
+00047080: 205b 2027 2220 2b20 656e 7469 7479 2e74   [ '" + entity.t
+00047090: 6162 6c65 5f6e 616d 6520 2b20 2227 205d  able_name + "' ]
+000470a0: 2069 7320 6e6f 7420 6372 6561 7465 6420   is not created 
+000470b0: 696e 2074 6865 2064 6174 6162 6173 652e  in the database.
+000470c0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000470d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000470e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000470f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047100: 4c4f 475f 4c45 5645 4c5f 5741 524e 494e  LOG_LEVEL_WARNIN
+00047110: 4729 0d0a 0d0a 2020 2020 2020 2020 2020  G)....          
+00047120: 2020 2020 2020 2320 536f 7572 6365 2053        # Source S
+00047130: 7065 6369 6669 6361 7469 6f6e 0d0a 2020  pecification..  
+00047140: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00047150: 2064 6174 6173 6574 2069 7320 4e6f 6e65   dataset is None
+00047160: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00047170: 2020 2020 2020 2023 2049 6620 7468 6520         # If the 
+00047180: 6461 7461 7365 7420 6973 206e 6577 2c20  dataset is new, 
+00047190: 616c 6c20 7468 6520 6461 7461 7365 7420  all the dataset 
+000471a0: 7370 6563 6966 6963 6174 696f 6e20 7769  specification wi
+000471b0: 6c6c 2062 6520 6164 6465 640d 0a20 2020  ll be added..   
 000471c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000471d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000471e0: 2073 7472 2865 7869 7374 656e 745f 636f   str(existent_co
-000471f0: 6c2e 636f 6c75 6d6e 5f70 7265 6369 7369  l.column_precisi
-00047200: 6f6e 2920 2b20 7374 7228 6578 6973 7465  on) + str(existe
-00047210: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7363  nt_col.column_sc
-00047220: 616c 6529 0d0a 2020 2020 2020 2020 2020  ale)..          
-00047230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047240: 2020 6368 6563 6b73 756d 5f6e 6577 203d    checksum_new =
-00047250: 2073 7472 280d 0a20 2020 2020 2020 2020   str(..         
-00047260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047270: 2020 2020 2020 2069 645f 6b65 795f 7479         id_key_ty
-00047280: 7065 2920 2b20 7461 626c 655f 6465 6669  pe) + table_defi
-00047290: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
-000472a0: 6d6e 5f6e 616d 6520 2b20 7461 626c 655f  mn_name + table_
-000472b0: 6465 6669 6e69 7469 6f6e 5f73 7065 632e  definition_spec.
-000472c0: 636f 6c75 6d6e 5f74 7970 6520 2b20 5c0d  column_type + \.
-000472d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000472e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000472f0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
-00047300: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
-00047310: 5f73 7065 632e 6964 2920 2b20 7374 7228  _spec.id) + str(
-00047320: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
-00047330: 5f73 7065 632e 6973 5f6e 756c 6c61 626c  _spec.is_nullabl
-00047340: 6529 202b 2073 7472 280d 0a20 2020 2020  e) + str(..     
-00047350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047360: 2020 2020 2020 2020 2020 2074 6162 6c65             table
-00047370: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-00047380: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2920  .column_length) 
-00047390: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
-000473a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000473b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000473c0: 7374 7228 7461 626c 655f 6465 6669 6e69  str(table_defini
-000473d0: 7469 6f6e 5f73 7065 632e 636f 6c75 6d6e  tion_spec.column
-000473e0: 5f70 7265 6369 7369 6f6e 2920 2b20 7374  _precision) + st
-000473f0: 7228 7461 626c 655f 6465 6669 6e69 7469  r(table_definiti
-00047400: 6f6e 5f73 7065 632e 636f 6c75 6d6e 5f73  on_spec.column_s
-00047410: 6361 6c65 290d 0a20 2020 2020 2020 2020  cale)..         
-00047420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047430: 2020 2069 6620 6368 6563 6b73 756d 5f6e     if checksum_n
-00047440: 6577 203d 3d20 6368 6563 6b73 756d 5f65  ew == checksum_e
-00047450: 7869 7374 656e 743a 0d0a 2020 2020 2020  xistent:..      
-00047460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047470: 2020 2020 2020 2020 2020 6669 6e64 6564            finded
-00047480: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00047490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000474a0: 2020 2020 2020 2020 2023 2043 6f6c 756d           # Colum
-000474b0: 6e20 7468 6174 2065 7869 7374 7320 616c  n that exists al
-000474c0: 7265 6164 792c 2069 6620 6f6e 206f 7269  ready, if on ori
-000474d0: 6769 6e20 6973 2074 6865 2073 616d 652c  gin is the same,
-000474e0: 2077 6520 6d61 696e 7461 696e 2061 6c6c   we maintain all
-000474f0: 2074 6865 2069 6e66 6f0d 0a20 2020 2020   the info..     
-00047500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047510: 2020 2020 2020 2020 2020 2063 6c6f 7365             close
-00047520: 5f64 6174 6173 6574 5f73 7065 6369 6669  _dataset_specifi
-00047530: 6361 7469 6f6e 203d 205b 6578 6973 7465  cation = [existe
-00047540: 6e74 5f63 6f6c 2e69 645f 6461 7461 7365  nt_col.id_datase
-00047550: 745f 7370 6563 2c20 6461 7461 7365 742e  t_spec, dataset.
-00047560: 6964 5f64 6174 6173 6574 2c0d 0a20 2020  id_dataset,..   
-00047570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000475a0: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-000475b0: 7465 6e74 5f63 6f6c 2e69 645f 6b65 795f  tent_col.id_key_
-000475c0: 7479 7065 2c0d 0a20 2020 2020 2020 2020  type,..         
-000475d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000475e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000475f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047600: 2020 2020 2020 6578 6973 7465 6e74 5f63        existent_c
-00047610: 6f6c 2e63 6f6c 756d 6e5f 6e61 6d65 2c0d  ol.column_name,.
-00047620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00047630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047660: 6578 6973 7465 6e74 5f63 6f6c 2e63 6f6c  existent_col.col
-00047670: 756d 6e5f 7479 7065 2c0d 0a20 2020 2020  umn_type,..     
-00047680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000476a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000476b0: 2020 2020 2020 2020 2020 6578 6973 7465            existe
-000476c0: 6e74 5f63 6f6c 2e6f 7264 696e 616c 5f70  nt_col.ordinal_p
-000476d0: 6f73 6974 696f 6e2c 2065 7869 7374 656e  osition, existen
-000476e0: 745f 636f 6c2e 6973 5f6e 756c 6c61 626c  t_col.is_nullabl
-000476f0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00047700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000471d0: 2066 6f72 2074 6162 6c65 5f64 6566 696e   for table_defin
+000471e0: 6974 696f 6e5f 7370 6563 2069 6e20 7461  ition_spec in ta
+000471f0: 626c 655f 6465 6669 6e69 7469 6f6e 3a0d  ble_definition:.
+00047200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047210: 2020 2020 2020 2020 2069 645f 6461 7461           id_data
+00047220: 7365 745f 7370 6563 203d 206e 6578 745f  set_spec = next_
+00047230: 6964 5f64 6174 6173 6574 5f73 7065 630d  id_dataset_spec.
+00047240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047250: 2020 2020 2020 2020 206e 6578 745f 6964           next_id
+00047260: 5f64 6174 6173 6574 5f73 7065 6320 2b3d  _dataset_spec +=
+00047270: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00047280: 2020 2020 2020 2020 2020 2020 6964 5f6b              id_k
+00047290: 6579 5f74 7970 6520 3d20 2873 656c 662e  ey_type = (self.
+000472a0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+000472b0: 6765 745f 6b65 795f 7479 7065 5f66 726f  get_key_type_fro
+000472c0: 6d5f 6b65 795f 7479 7065 5f6e 616d 6528  m_key_type_name(
+000472d0: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
+000472e0: 5f73 7065 632e 6b65 795f 7479 7065 2929  _spec.key_type))
+000472f0: 2e69 645f 6b65 795f 7479 7065 0d0a 2020  .id_key_type..  
+00047300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047310: 2020 2020 2020 7374 6172 745f 6461 7465        start_date
+00047320: 203d 2073 656c 662e 636f 6e6e 6563 7469   = self.connecti
+00047330: 6f6e 5f6d 6574 6164 6174 612e 6765 745f  on_metadata.get_
+00047340: 7379 7364 6174 655f 7661 6c75 6528 290d  sysdate_value().
+00047350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047360: 2020 2020 2020 2020 2065 6e64 5f64 6174           end_dat
+00047370: 6520 3d20 224e 554c 4c22 0d0a 0d0a 2020  e = "NULL"....  
+00047380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047390: 2020 2020 2020 6e65 775f 6461 7461 7365        new_datase
+000473a0: 745f 7370 6563 6966 6963 6174 696f 6e20  t_specification 
+000473b0: 3d20 5b69 645f 6461 7461 7365 745f 7370  = [id_dataset_sp
+000473c0: 6563 2c20 6964 5f64 6174 6173 6574 2c20  ec, id_dataset, 
+000473d0: 6964 5f6b 6579 5f74 7970 652c 0d0a 2020  id_key_type,..  
+000473e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000473f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047410: 2020 2074 6162 6c65 5f64 6566 696e 6974     table_definit
+00047420: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
+00047430: 6e61 6d65 2c0d 0a20 2020 2020 2020 2020  name,..         
+00047440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047460: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+00047470: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
+00047480: 632e 636f 6c75 6d6e 5f74 7970 652c 2074  c.column_type, t
+00047490: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+000474a0: 7370 6563 2e69 642c 0d0a 2020 2020 2020  spec.id,..      
+000474b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000474c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000474d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000474e0: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+000474f0: 7370 6563 2e69 735f 6e75 6c6c 6162 6c65  spec.is_nullable
+00047500: 2c20 7461 626c 655f 6465 6669 6e69 7469  , table_definiti
+00047510: 6f6e 5f73 7065 632e 636f 6c75 6d6e 5f6c  on_spec.column_l
+00047520: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
+00047530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047550: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+00047560: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
+00047570: 6563 2e63 6f6c 756d 6e5f 7072 6563 6973  ec.column_precis
+00047580: 696f 6e2c 2074 6162 6c65 5f64 6566 696e  ion, table_defin
+00047590: 6974 696f 6e5f 7370 6563 2e63 6f6c 756d  ition_spec.colum
+000475a0: 6e5f 7363 616c 652c 0d0a 2020 2020 2020  n_scale,..      
+000475b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000475c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000475d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000475e0: 656c 662e 6f77 6e65 722c 2073 7461 7274  elf.owner, start
+000475f0: 5f64 6174 652c 2065 6e64 5f64 6174 655d  _date, end_date]
+00047600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047610: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00047620: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
+00047630: 6164 645f 6f6d 5f64 6174 6173 6574 5f73  add_om_dataset_s
+00047640: 7065 6369 6669 6361 7469 6f6e 285b 6e65  pecification([ne
+00047650: 775f 6461 7461 7365 745f 7370 6563 6966  w_dataset_specif
+00047660: 6963 6174 696f 6e5d 290d 0a20 2020 2020  ication])..     
+00047670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047680: 2020 2073 6f75 7263 6573 5f73 7065 6373     sources_specs
+00047690: 5f6c 6f61 6465 642e 6170 7065 6e64 285b  _loaded.append([
+000476a0: 6964 5f64 6174 6173 6574 2c20 7461 626c  id_dataset, tabl
+000476b0: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
+000476c0: 632e 636f 6c75 6d6e 5f6e 616d 655d 290d  c.column_name]).
+000476d0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+000476e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000476f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00047700: 536f 7572 6365 2073 7065 6369 6669 6361  Source specifica
+00047710: 7469 6f6e 2065 7869 7374 656e 740d 0a20  tion existent.. 
 00047720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047730: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
-00047740: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
-00047750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047780: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00047790: 7869 7374 656e 745f 636f 6c2e 636f 6c75  xistent_col.colu
-000477a0: 6d6e 5f70 7265 6369 7369 6f6e 2c20 6578  mn_precision, ex
-000477b0: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
-000477c0: 6e5f 7363 616c 652c 0d0a 2020 2020 2020  n_scale,..      
-000477d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000477e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047730: 2020 2023 2055 7064 6174 6520 616e 7920     # Update any 
+00047740: 636f 6c75 6d6e 0d0a 2020 2020 2020 2020  column..        
+00047750: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00047760: 6578 6973 7465 6e74 5f63 6f6c 2069 6e20  existent_col in 
+00047770: 5b78 2066 6f72 2078 2069 6e20 7365 6c66  [x for x in self
+00047780: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00047790: 2e6f 6d5f 6461 7461 7365 745f 7370 6563  .om_dataset_spec
+000477a0: 6966 6963 6174 696f 6e20 6966 2078 2e69  ification if x.i
+000477b0: 645f 6461 7461 7365 7420 3d3d 2064 6174  d_dataset == dat
+000477c0: 6173 6574 2e69 645f 6461 7461 7365 7420  aset.id_dataset 
+000477d0: 616e 6420 782e 656e 645f 6461 7465 2069  and x.end_date i
+000477e0: 7320 4e6f 6e65 5d3a 0d0a 2020 2020 2020  s None]:..      
 000477f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047800: 2020 2020 2020 2020 2065 7869 7374 656e           existen
-00047810: 745f 636f 6c2e 6d65 7461 5f6f 776e 6572  t_col.meta_owner
-00047820: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00047830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047860: 2020 2227 2220 2b20 7374 7228 6578 6973    "'" + str(exis
-00047870: 7465 6e74 5f63 6f6c 2e73 7461 7274 5f64  tent_col.start_d
-00047880: 6174 6529 202b 2022 2722 2c0d 0a20 2020  ate) + "'",..   
-00047890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000478a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000478b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000478c0: 2020 2020 2020 2020 2020 2020 224e 554c              "NUL
-000478d0: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
-000478e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000478f0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00047900: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
-00047910: 6d5f 6461 7461 7365 745f 7370 6563 6966  m_dataset_specif
-00047920: 6963 6174 696f 6e28 5b63 6c6f 7365 5f64  ication([close_d
-00047930: 6174 6173 6574 5f73 7065 6369 6669 6361  ataset_specifica
-00047940: 7469 6f6e 5d29 0d0a 2020 2020 2020 2020  tion])..        
-00047950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047960: 2020 2020 2020 2020 736f 7572 6365 735f          sources_
-00047970: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
-00047980: 656e 6428 5b65 7869 7374 656e 745f 636f  end([existent_co
-00047990: 6c2e 6964 5f64 6174 6173 6574 2c20 6578  l.id_dataset, ex
-000479a0: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
-000479b0: 6e5f 6e61 6d65 5d29 0d0a 0d0a 2020 2020  n_name])....    
-000479c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000479d0: 2020 2020 2320 436f 6c75 6d6e 2074 6861      # Column tha
-000479e0: 7420 6973 206e 6f20 6d6f 7265 206f 6e20  t is no more on 
-000479f0: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
+00047800: 2020 6669 6e64 6564 203d 2046 616c 7365    finded = False
+00047810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047820: 2020 2020 2020 2020 2020 666f 7220 7461            for ta
+00047830: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
+00047840: 7065 6320 696e 2074 6162 6c65 5f64 6566  pec in table_def
+00047850: 696e 6974 696f 6e3a 0d0a 2020 2020 2020  inition:..      
+00047860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047870: 2020 2020 2020 6964 5f6b 6579 5f74 7970        id_key_typ
+00047880: 6520 3d20 2873 656c 662e 6d65 7461 6461  e = (self.metada
+00047890: 7461 5f61 6374 7561 6c2e 6765 745f 6b65  ta_actual.get_ke
+000478a0: 795f 7479 7065 5f66 726f 6d5f 6b65 795f  y_type_from_key_
+000478b0: 7479 7065 5f6e 616d 6528 7461 626c 655f  type_name(table_
+000478c0: 6465 6669 6e69 7469 6f6e 5f73 7065 632e  definition_spec.
+000478d0: 6b65 795f 7479 7065 2929 2e69 645f 6b65  key_type)).id_ke
+000478e0: 795f 7479 7065 0d0a 0d0a 2020 2020 2020  y_type....      
+000478f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047900: 2020 2020 2020 6368 6563 6b73 756d 5f65        checksum_e
+00047910: 7869 7374 656e 7420 3d20 7374 7228 0d0a  xistent = str(..
+00047920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047940: 6578 6973 7465 6e74 5f63 6f6c 2e69 645f  existent_col.id_
+00047950: 6b65 795f 7479 7065 2920 2b20 6578 6973  key_type) + exis
+00047960: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
+00047970: 6e61 6d65 202b 2065 7869 7374 656e 745f  name + existent_
+00047980: 636f 6c2e 636f 6c75 6d6e 5f74 7970 6520  col.column_type 
+00047990: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
+000479a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000479b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000479c0: 2020 2020 2073 7472 2865 7869 7374 656e       str(existen
+000479d0: 745f 636f 6c2e 6f72 6469 6e61 6c5f 706f  t_col.ordinal_po
+000479e0: 7369 7469 6f6e 2920 2b20 7374 7228 0d0a  sition) + str(..
+000479f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00047a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047a10: 6966 206e 6f74 2066 696e 6465 643a 0d0a  if not finded:..
-00047a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047a30: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-00047a40: 655f 6461 7461 7365 745f 7370 6563 6966  e_dataset_specif
-00047a50: 6963 6174 696f 6e20 3d20 5b65 7869 7374  ication = [exist
-00047a60: 656e 745f 636f 6c2e 6964 5f64 6174 6173  ent_col.id_datas
-00047a70: 6574 5f73 7065 632c 2065 7869 7374 656e  et_spec, existen
-00047a80: 745f 636f 6c2e 6964 5f64 6174 6173 6574  t_col.id_dataset
-00047a90: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00047aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ac0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00047ad0: 6973 7465 6e74 5f63 6f6c 2e69 645f 6b65  istent_col.id_ke
-00047ae0: 795f 7479 7065 2c0d 0a20 2020 2020 2020  y_type,..       
-00047af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047a10: 6578 6973 7465 6e74 5f63 6f6c 2e69 735f  existent_col.is_
+00047a20: 6e75 6c6c 6162 6c65 2920 2b20 7374 7228  nullable) + str(
+00047a30: 6578 6973 7465 6e74 5f63 6f6c 2e63 6f6c  existent_col.col
+00047a40: 756d 6e5f 6c65 6e67 7468 2920 2b20 5c0d  umn_length) + \.
+00047a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047a80: 2073 7472 2865 7869 7374 656e 745f 636f   str(existent_co
+00047a90: 6c2e 636f 6c75 6d6e 5f70 7265 6369 7369  l.column_precisi
+00047aa0: 6f6e 2920 2b20 7374 7228 6578 6973 7465  on) + str(existe
+00047ab0: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7363  nt_col.column_sc
+00047ac0: 616c 6529 0d0a 2020 2020 2020 2020 2020  ale)..          
+00047ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ae0: 2020 6368 6563 6b73 756d 5f6e 6577 203d    checksum_new =
+00047af0: 2073 7472 280d 0a20 2020 2020 2020 2020   str(..         
 00047b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047b20: 2020 2020 6578 6973 7465 6e74 5f63 6f6c      existent_col
-00047b30: 2e63 6f6c 756d 6e5f 6e61 6d65 2c0d 0a20  .column_name,.. 
-00047b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047b70: 2020 2020 2020 2020 2020 6578 6973 7465            existe
-00047b80: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7479  nt_col.column_ty
-00047b90: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
-00047ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047bd0: 6578 6973 7465 6e74 5f63 6f6c 2e6f 7264  existent_col.ord
-00047be0: 696e 616c 5f70 6f73 6974 696f 6e2c 2065  inal_position, e
-00047bf0: 7869 7374 656e 745f 636f 6c2e 6973 5f6e  xistent_col.is_n
-00047c00: 756c 6c61 626c 652c 0d0a 2020 2020 2020  ullable,..      
-00047c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c40: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
-00047c50: 6c2e 636f 6c75 6d6e 5f6c 656e 6774 682c  l.column_length,
-00047c60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00047c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047c90: 2020 2020 2020 2020 2020 2020 2065 7869               exi
-00047ca0: 7374 656e 745f 636f 6c2e 636f 6c75 6d6e  stent_col.column
-00047cb0: 5f70 7265 6369 7369 6f6e 2c20 6578 6973  _precision, exis
-00047cc0: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
-00047cd0: 7363 616c 652c 0d0a 2020 2020 2020 2020  scale,..        
-00047ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047b10: 2020 2020 2020 2069 645f 6b65 795f 7479         id_key_ty
+00047b20: 7065 2920 2b20 7461 626c 655f 6465 6669  pe) + table_defi
+00047b30: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
+00047b40: 6d6e 5f6e 616d 6520 2b20 7461 626c 655f  mn_name + table_
+00047b50: 6465 6669 6e69 7469 6f6e 5f73 7065 632e  definition_spec.
+00047b60: 636f 6c75 6d6e 5f74 7970 6520 2b20 5c0d  column_type + \.
+00047b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047b90: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+00047ba0: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
+00047bb0: 5f73 7065 632e 6964 2920 2b20 7374 7228  _spec.id) + str(
+00047bc0: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
+00047bd0: 5f73 7065 632e 6973 5f6e 756c 6c61 626c  _spec.is_nullabl
+00047be0: 6529 202b 2073 7472 280d 0a20 2020 2020  e) + str(..     
+00047bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047c00: 2020 2020 2020 2020 2020 2074 6162 6c65             table
+00047c10: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+00047c20: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2920  .column_length) 
+00047c30: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
+00047c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047c60: 7374 7228 7461 626c 655f 6465 6669 6e69  str(table_defini
+00047c70: 7469 6f6e 5f73 7065 632e 636f 6c75 6d6e  tion_spec.column
+00047c80: 5f70 7265 6369 7369 6f6e 2920 2b20 7374  _precision) + st
+00047c90: 7228 7461 626c 655f 6465 6669 6e69 7469  r(table_definiti
+00047ca0: 6f6e 5f73 7065 632e 636f 6c75 6d6e 5f73  on_spec.column_s
+00047cb0: 6361 6c65 290d 0a20 2020 2020 2020 2020  cale)..         
+00047cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047cd0: 2020 2069 6620 6368 6563 6b73 756d 5f6e     if checksum_n
+00047ce0: 6577 203d 3d20 6368 6563 6b73 756d 5f65  ew == checksum_e
+00047cf0: 7869 7374 656e 743a 0d0a 2020 2020 2020  xistent:..      
 00047d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d10: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
-00047d20: 6d65 7461 5f6f 776e 6572 2c0d 0a20 2020  meta_owner,..   
+00047d10: 2020 2020 2020 2020 2020 6669 6e64 6564            finded
+00047d20: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
 00047d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047d60: 2020 2020 2020 2020 2227 2220 2b20 7374          "'" + st
-00047d70: 7228 6578 6973 7465 6e74 5f63 6f6c 2e73  r(existent_col.s
-00047d80: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
-00047d90: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00047d40: 2020 2020 2020 2020 2023 2043 6f6c 756d           # Colum
+00047d50: 6e20 7468 6174 2065 7869 7374 7320 616c  n that exists al
+00047d60: 7265 6164 792c 2069 6620 6f6e 206f 7269  ready, if on ori
+00047d70: 6769 6e20 6973 2074 6865 2073 616d 652c  gin is the same,
+00047d80: 2077 6520 6d61 696e 7461 696e 2061 6c6c   we maintain all
+00047d90: 2074 6865 2069 6e66 6f0d 0a20 2020 2020   the info..     
 00047da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047dc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00047dd0: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-00047de0: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-00047df0: 7465 5f76 616c 7565 2829 5d0d 0a20 2020  te_value()]..   
-00047e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047e10: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00047e20: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-00047e30: 6464 5f6f 6d5f 6461 7461 7365 745f 7370  dd_om_dataset_sp
-00047e40: 6563 6966 6963 6174 696f 6e28 5b63 6c6f  ecification([clo
-00047e50: 7365 5f64 6174 6173 6574 5f73 7065 6369  se_dataset_speci
-00047e60: 6669 6361 7469 6f6e 5d29 0d0a 2020 2020  fication])..    
+00047db0: 2020 2020 2020 2020 2020 2063 6c6f 7365             close
+00047dc0: 5f64 6174 6173 6574 5f73 7065 6369 6669  _dataset_specifi
+00047dd0: 6361 7469 6f6e 203d 205b 6578 6973 7465  cation = [existe
+00047de0: 6e74 5f63 6f6c 2e69 645f 6461 7461 7365  nt_col.id_datase
+00047df0: 745f 7370 6563 2c20 6461 7461 7365 742e  t_spec, dataset.
+00047e00: 6964 5f64 6174 6173 6574 2c0d 0a20 2020  id_dataset,..   
+00047e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e40: 2020 2020 2020 2020 2020 2020 6578 6973              exis
+00047e50: 7465 6e74 5f63 6f6c 2e69 645f 6b65 795f  tent_col.id_key_
+00047e60: 7479 7065 2c0d 0a20 2020 2020 2020 2020  type,..         
 00047e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047e80: 2020 2020 2020 2020 736f 7572 6365 735f          sources_
-00047e90: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
-00047ea0: 656e 6428 5b65 7869 7374 656e 745f 636f  end([existent_co
-00047eb0: 6c2e 6964 5f64 6174 6173 6574 2c20 6578  l.id_dataset, ex
-00047ec0: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
-00047ed0: 6e5f 6e61 6d65 5d29 0d0a 0d0a 2020 2020  n_name])....    
+00047e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ea0: 2020 2020 2020 6578 6973 7465 6e74 5f63        existent_c
+00047eb0: 6f6c 2e63 6f6c 756d 6e5f 6e61 6d65 2c0d  ol.column_name,.
+00047ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00047ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ef0: 2320 4164 6420 6e65 7720 636f 6c75 6d6e  # Add new column
-00047f00: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00047f10: 2020 2020 2020 2066 6f72 2074 6162 6c65         for table
-00047f20: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-00047f30: 2069 6e20 7461 626c 655f 6465 6669 6e69   in table_defini
-00047f40: 7469 6f6e 3a0d 0a20 2020 2020 2020 2020  tion:..         
-00047f50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00047f60: 696e 6465 6420 3d20 4661 6c73 650d 0a20  inded = False.. 
-00047f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047f80: 2020 2020 2020 2066 6f72 2065 7869 7374         for exist
-00047f90: 656e 745f 636f 6c20 696e 205b 7820 666f  ent_col in [x fo
-00047fa0: 7220 7820 696e 2073 656c 662e 6d65 7461  r x in self.meta
-00047fb0: 6461 7461 5f61 6374 7561 6c2e 6f6d 5f64  data_actual.om_d
-00047fc0: 6174 6173 6574 5f73 7065 6369 6669 6361  ataset_specifica
-00047fd0: 7469 6f6e 2069 6620 782e 6964 5f64 6174  tion if x.id_dat
-00047fe0: 6173 6574 203d 3d20 6461 7461 7365 742e  aset == dataset.
-00047ff0: 6964 5f64 6174 6173 6574 2061 6e64 2078  id_dataset and x
-00048000: 2e65 6e64 5f64 6174 6520 6973 204e 6f6e  .end_date is Non
-00048010: 655d 3a0d 0a20 2020 2020 2020 2020 2020  e]:..           
-00048020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048030: 2069 645f 6b65 795f 7479 7065 203d 2028   id_key_type = (
-00048040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048060: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00048070: 6163 7475 616c 2e67 6574 5f6b 6579 5f74  actual.get_key_t
-00048080: 7970 655f 6672 6f6d 5f6b 6579 5f74 7970  ype_from_key_typ
-00048090: 655f 6e61 6d65 2874 6162 6c65 5f64 6566  e_name(table_def
-000480a0: 696e 6974 696f 6e5f 7370 6563 2e6b 6579  inition_spec.key
-000480b0: 5f74 7970 6529 292e 6964 5f6b 6579 5f74  _type)).id_key_t
-000480c0: 7970 650d 0a0d 0a20 2020 2020 2020 2020  ype....         
+00047ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f00: 6578 6973 7465 6e74 5f63 6f6c 2e63 6f6c  existent_col.col
+00047f10: 756d 6e5f 7479 7065 2c0d 0a20 2020 2020  umn_type,..     
+00047f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047f50: 2020 2020 2020 2020 2020 6578 6973 7465            existe
+00047f60: 6e74 5f63 6f6c 2e6f 7264 696e 616c 5f70  nt_col.ordinal_p
+00047f70: 6f73 6974 696f 6e2c 2065 7869 7374 656e  osition, existen
+00047f80: 745f 636f 6c2e 6973 5f6e 756c 6c61 626c  t_col.is_nullabl
+00047f90: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00047fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047fd0: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
+00047fe0: 636f 6c75 6d6e 5f6c 656e 6774 682c 0d0a  column_length,..
+00047ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048020: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00048030: 7869 7374 656e 745f 636f 6c2e 636f 6c75  xistent_col.colu
+00048040: 6d6e 5f70 7265 6369 7369 6f6e 2c20 6578  mn_precision, ex
+00048050: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
+00048060: 6e5f 7363 616c 652c 0d0a 2020 2020 2020  n_scale,..      
+00048070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480a0: 2020 2020 2020 2020 2065 7869 7374 656e           existen
+000480b0: 745f 636f 6c2e 6d65 7461 5f6f 776e 6572  t_col.meta_owner
+000480c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 000480d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000480e0: 2020 2063 6865 636b 7375 6d5f 6578 6973     checksum_exis
-000480f0: 7465 6e74 203d 2073 7472 280d 0a20 2020  tent = str(..   
-00048100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048110: 2020 2020 2020 2020 2020 2020 2065 7869               exi
-00048120: 7374 656e 745f 636f 6c2e 6964 5f6b 6579  stent_col.id_key
-00048130: 5f74 7970 6529 202b 2065 7869 7374 656e  _type) + existen
-00048140: 745f 636f 6c2e 636f 6c75 6d6e 5f6e 616d  t_col.column_nam
-00048150: 6520 2b20 6578 6973 7465 6e74 5f63 6f6c  e + existent_col
-00048160: 2e63 6f6c 756d 6e5f 7479 7065 202b 205c  .column_type + \
-00048170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000480e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048100: 2020 2227 2220 2b20 7374 7228 6578 6973    "'" + str(exis
+00048110: 7465 6e74 5f63 6f6c 2e73 7461 7274 5f64  tent_col.start_d
+00048120: 6174 6529 202b 2022 2722 2c0d 0a20 2020  ate) + "'",..   
+00048130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048160: 2020 2020 2020 2020 2020 2020 224e 554c              "NUL
+00048170: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
 00048180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000481a0: 2020 7374 7228 6578 6973 7465 6e74 5f63    str(existent_c
-000481b0: 6f6c 2e6f 7264 696e 616c 5f70 6f73 6974  ol.ordinal_posit
-000481c0: 696f 6e29 202b 2073 7472 280d 0a20 2020  ion) + str(..   
-000481d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000481e0: 2020 2020 2020 2020 2020 2020 2065 7869               exi
-000481f0: 7374 656e 745f 636f 6c2e 6973 5f6e 756c  stent_col.is_nul
-00048200: 6c61 626c 6529 202b 2073 7472 2865 7869  lable) + str(exi
-00048210: 7374 656e 745f 636f 6c2e 636f 6c75 6d6e  stent_col.column
-00048220: 5f6c 656e 6774 6829 202b 205c 0d0a 2020  _length) + \..  
-00048230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048250: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00048260: 7228 6578 6973 7465 6e74 5f63 6f6c 2e63  r(existent_col.c
-00048270: 6f6c 756d 6e5f 7072 6563 6973 696f 6e29  olumn_precision)
-00048280: 202b 2073 7472 2865 7869 7374 656e 745f   + str(existent_
-00048290: 636f 6c2e 636f 6c75 6d6e 5f73 6361 6c65  col.column_scale
-000482a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000482b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000482c0: 6865 636b 7375 6d5f 6e65 7720 3d20 7374  hecksum_new = st
-000482d0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
-000482e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482f0: 2020 2020 6964 5f6b 6579 5f74 7970 6529      id_key_type)
-00048300: 202b 2074 6162 6c65 5f64 6566 696e 6974   + table_definit
-00048310: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
-00048320: 6e61 6d65 202b 2074 6162 6c65 5f64 6566  name + table_def
-00048330: 696e 6974 696f 6e5f 7370 6563 2e63 6f6c  inition_spec.col
-00048340: 756d 6e5f 7479 7065 202b 205c 0d0a 2020  umn_type + \..  
+00048190: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000481a0: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
+000481b0: 6d5f 6461 7461 7365 745f 7370 6563 6966  m_dataset_specif
+000481c0: 6963 6174 696f 6e28 5b63 6c6f 7365 5f64  ication([close_d
+000481d0: 6174 6173 6574 5f73 7065 6369 6669 6361  ataset_specifica
+000481e0: 7469 6f6e 5d29 0d0a 2020 2020 2020 2020  tion])..        
+000481f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048200: 2020 2020 2020 2020 736f 7572 6365 735f          sources_
+00048210: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
+00048220: 656e 6428 5b65 7869 7374 656e 745f 636f  end([existent_co
+00048230: 6c2e 6964 5f64 6174 6173 6574 2c20 6578  l.id_dataset, ex
+00048240: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
+00048250: 6e5f 6e61 6d65 5d29 0d0a 0d0a 2020 2020  n_name])....    
+00048260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048270: 2020 2020 2320 436f 6c75 6d6e 2074 6861      # Column tha
+00048280: 7420 6973 206e 6f20 6d6f 7265 206f 6e20  t is no more on 
+00048290: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
+000482a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000482b0: 6966 206e 6f74 2066 696e 6465 643a 0d0a  if not finded:..
+000482c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000482d0: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
+000482e0: 655f 6461 7461 7365 745f 7370 6563 6966  e_dataset_specif
+000482f0: 6963 6174 696f 6e20 3d20 5b65 7869 7374  ication = [exist
+00048300: 656e 745f 636f 6c2e 6964 5f64 6174 6173  ent_col.id_datas
+00048310: 6574 5f73 7065 632c 2065 7869 7374 656e  et_spec, existen
+00048320: 745f 636f 6c2e 6964 5f64 6174 6173 6574  t_col.id_dataset
+00048330: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00048340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00048350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048370: 2020 2020 2020 2020 2073 7472 2874 6162           str(tab
-00048380: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
-00048390: 6563 2e69 6429 202b 2073 7472 2874 6162  ec.id) + str(tab
-000483a0: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
-000483b0: 6563 2e69 735f 6e75 6c6c 6162 6c65 2920  ec.is_nullable) 
-000483c0: 2b20 7374 7228 0d0a 2020 2020 2020 2020  + str(..        
-000483d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000483e0: 2020 2020 2020 2020 7461 626c 655f 6465          table_de
-000483f0: 6669 6e69 7469 6f6e 5f73 7065 632e 636f  finition_spec.co
-00048400: 6c75 6d6e 5f6c 656e 6774 6829 202b 205c  lumn_length) + \
-00048410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048430: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00048440: 2874 6162 6c65 5f64 6566 696e 6974 696f  (table_definitio
-00048450: 6e5f 7370 6563 2e63 6f6c 756d 6e5f 7072  n_spec.column_pr
-00048460: 6563 6973 696f 6e29 202b 2073 7472 2874  ecision) + str(t
-00048470: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-00048480: 7370 6563 2e63 6f6c 756d 6e5f 7363 616c  spec.column_scal
-00048490: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000484a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000484b0: 6966 2063 6865 636b 7375 6d5f 6e65 7720  if checksum_new 
-000484c0: 3d3d 2063 6865 636b 7375 6d5f 6578 6973  == checksum_exis
-000484d0: 7465 6e74 3a0d 0a20 2020 2020 2020 2020  tent:..         
-000484e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000484f0: 2020 2020 2020 2066 696e 6465 6420 3d20         finded = 
-00048500: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00048360: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00048370: 6973 7465 6e74 5f63 6f6c 2e69 645f 6b65  istent_col.id_ke
+00048380: 795f 7479 7065 2c0d 0a20 2020 2020 2020  y_type,..       
+00048390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000483a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000483b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000483c0: 2020 2020 6578 6973 7465 6e74 5f63 6f6c      existent_col
+000483d0: 2e63 6f6c 756d 6e5f 6e61 6d65 2c0d 0a20  .column_name,.. 
+000483e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000483f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048410: 2020 2020 2020 2020 2020 6578 6973 7465            existe
+00048420: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7479  nt_col.column_ty
+00048430: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
+00048440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048470: 6578 6973 7465 6e74 5f63 6f6c 2e6f 7264  existent_col.ord
+00048480: 696e 616c 5f70 6f73 6974 696f 6e2c 2065  inal_position, e
+00048490: 7869 7374 656e 745f 636f 6c2e 6973 5f6e  xistent_col.is_n
+000484a0: 756c 6c61 626c 652c 0d0a 2020 2020 2020  ullable,..      
+000484b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000484c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000484d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000484e0: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
+000484f0: 6c2e 636f 6c75 6d6e 5f6c 656e 6774 682c  l.column_length,
+00048500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00048510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048520: 2020 2020 2020 6272 6561 6b0d 0a20 2020        break..   
-00048530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048540: 2020 2020 2023 204e 6577 2063 6f6c 756d       # New colum
-00048550: 6e20 6973 2061 6464 6564 206f 6e20 736f  n is added on so
-00048560: 7572 6365 0d0a 2020 2020 2020 2020 2020  urce..          
-00048570: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00048580: 206e 6f74 2066 696e 6465 643a 0d0a 2020   not finded:..  
+00048520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048530: 2020 2020 2020 2020 2020 2020 2065 7869               exi
+00048540: 7374 656e 745f 636f 6c2e 636f 6c75 6d6e  stent_col.column
+00048550: 5f70 7265 6369 7369 6f6e 2c20 6578 6973  _precision, exis
+00048560: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
+00048570: 7363 616c 652c 0d0a 2020 2020 2020 2020  scale,..        
+00048580: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00048590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000485a0: 2020 2020 2020 2020 2020 6964 5f64 6174            id_dat
-000485b0: 6173 6574 5f73 7065 6320 3d20 6e65 7874  aset_spec = next
-000485c0: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
-000485d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000485e0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000485f0: 7874 5f69 645f 6461 7461 7365 745f 7370  xt_id_dataset_sp
-00048600: 6563 202b 3d20 310d 0a20 2020 2020 2020  ec += 1..       
-00048610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048620: 2020 2020 2069 645f 6b65 795f 7479 7065       id_key_type
-00048630: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+000485a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000485b0: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
+000485c0: 6d65 7461 5f6f 776e 6572 2c0d 0a20 2020  meta_owner,..   
+000485d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000485e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000485f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048600: 2020 2020 2020 2020 2227 2220 2b20 7374          "'" + st
+00048610: 7228 6578 6973 7465 6e74 5f63 6f6c 2e73  r(existent_col.s
+00048620: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
+00048630: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00048640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048650: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00048660: 6174 615f 6163 7475 616c 2e67 6574 5f6b  ata_actual.get_k
-00048670: 6579 5f74 7970 655f 6672 6f6d 5f6b 6579  ey_type_from_key
-00048680: 5f74 7970 655f 6e61 6d65 2874 6162 6c65  _type_name(table
-00048690: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-000486a0: 2e6b 6579 5f74 7970 6529 292e 6964 5f6b  .key_type)).id_k
-000486b0: 6579 5f74 7970 650d 0a20 2020 2020 2020  ey_type..       
-000486c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000486d0: 2020 2020 2073 7461 7274 5f64 6174 6520       start_date 
-000486e0: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
-000486f0: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
-00048700: 7973 6461 7465 5f76 616c 7565 2829 0d0a  ysdate_value()..
+00048650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048660: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00048670: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+00048680: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+00048690: 7465 5f76 616c 7565 2829 5d0d 0a20 2020  te_value()]..   
+000486a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486b0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+000486c0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+000486d0: 6464 5f6f 6d5f 6461 7461 7365 745f 7370  dd_om_dataset_sp
+000486e0: 6563 6966 6963 6174 696f 6e28 5b63 6c6f  ecification([clo
+000486f0: 7365 5f64 6174 6173 6574 5f73 7065 6369  se_dataset_speci
+00048700: 6669 6361 7469 6f6e 5d29 0d0a 2020 2020  fication])..    
 00048710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048720: 2020 2020 2020 2020 2020 2020 656e 645f              end_
-00048730: 6461 7465 203d 2022 4e55 4c4c 220d 0a0d  date = "NULL"...
-00048740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048750: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00048760: 5f64 6174 6173 6574 5f73 7065 6369 6669  _dataset_specifi
-00048770: 6361 7469 6f6e 203d 205b 6964 5f64 6174  cation = [id_dat
-00048780: 6173 6574 5f73 7065 632c 2064 6174 6173  aset_spec, datas
-00048790: 6574 2e69 645f 6461 7461 7365 742c 2069  et.id_dataset, i
-000487a0: 645f 6b65 795f 7479 7065 2c0d 0a20 2020  d_key_type,..   
-000487b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000487c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000487d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000487e0: 2020 2020 2020 7461 626c 655f 6465 6669        table_defi
-000487f0: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
-00048800: 6d6e 5f6e 616d 652c 0d0a 2020 2020 2020  mn_name,..      
+00048720: 2020 2020 2020 2020 736f 7572 6365 735f          sources_
+00048730: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
+00048740: 656e 6428 5b65 7869 7374 656e 745f 636f  end([existent_co
+00048750: 6c2e 6964 5f64 6174 6173 6574 2c20 6578  l.id_dataset, ex
+00048760: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
+00048770: 6e5f 6e61 6d65 5d29 0d0a 0d0a 2020 2020  n_name])....    
+00048780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048790: 2320 4164 6420 6e65 7720 636f 6c75 6d6e  # Add new column
+000487a0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+000487b0: 2020 2020 2020 2066 6f72 2074 6162 6c65         for table
+000487c0: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+000487d0: 2069 6e20 7461 626c 655f 6465 6669 6e69   in table_defini
+000487e0: 7469 6f6e 3a0d 0a20 2020 2020 2020 2020  tion:..         
+000487f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00048800: 696e 6465 6420 3d20 4661 6c73 650d 0a20  inded = False.. 
 00048810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048840: 2020 2074 6162 6c65 5f64 6566 696e 6974     table_definit
-00048850: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
-00048860: 7479 7065 2c20 7461 626c 655f 6465 6669  type, table_defi
-00048870: 6e69 7469 6f6e 5f73 7065 632e 6964 2c0d  nition_spec.id,.
-00048880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000488a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000488b0: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-000488c0: 6465 6669 6e69 7469 6f6e 5f73 7065 632e  definition_spec.
-000488d0: 6973 5f6e 756c 6c61 626c 652c 0d0a 2020  is_nullable,..  
-000488e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048820: 2020 2020 2020 2066 6f72 2065 7869 7374         for exist
+00048830: 656e 745f 636f 6c20 696e 205b 7820 666f  ent_col in [x fo
+00048840: 7220 7820 696e 2073 656c 662e 6d65 7461  r x in self.meta
+00048850: 6461 7461 5f61 6374 7561 6c2e 6f6d 5f64  data_actual.om_d
+00048860: 6174 6173 6574 5f73 7065 6369 6669 6361  ataset_specifica
+00048870: 7469 6f6e 2069 6620 782e 6964 5f64 6174  tion if x.id_dat
+00048880: 6173 6574 203d 3d20 6461 7461 7365 742e  aset == dataset.
+00048890: 6964 5f64 6174 6173 6574 2061 6e64 2078  id_dataset and x
+000488a0: 2e65 6e64 5f64 6174 6520 6973 204e 6f6e  .end_date is Non
+000488b0: 655d 3a0d 0a20 2020 2020 2020 2020 2020  e]:..           
+000488c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000488d0: 2069 645f 6b65 795f 7479 7065 203d 2028   id_key_type = (
+000488e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000488f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048910: 2020 2020 2020 2074 6162 6c65 5f64 6566         table_def
-00048920: 696e 6974 696f 6e5f 7370 6563 2e63 6f6c  inition_spec.col
-00048930: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
-00048940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048970: 2020 2020 2020 7461 626c 655f 6465 6669        table_defi
-00048980: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
-00048990: 6d6e 5f70 7265 6369 7369 6f6e 2c20 7461  mn_precision, ta
-000489a0: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
-000489b0: 7065 632e 636f 6c75 6d6e 5f73 6361 6c65  pec.column_scale
-000489c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000489d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000489e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000489f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00048a00: 2e6f 776e 6572 2c20 7374 6172 745f 6461  .owner, start_da
-00048a10: 7465 2c20 656e 645f 6461 7465 5d0d 0a20  te, end_date].. 
+00048900: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00048910: 6163 7475 616c 2e67 6574 5f6b 6579 5f74  actual.get_key_t
+00048920: 7970 655f 6672 6f6d 5f6b 6579 5f74 7970  ype_from_key_typ
+00048930: 655f 6e61 6d65 2874 6162 6c65 5f64 6566  e_name(table_def
+00048940: 696e 6974 696f 6e5f 7370 6563 2e6b 6579  inition_spec.key
+00048950: 5f74 7970 6529 292e 6964 5f6b 6579 5f74  _type)).id_key_t
+00048960: 7970 650d 0a0d 0a20 2020 2020 2020 2020  ype....         
+00048970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048980: 2020 2063 6865 636b 7375 6d5f 6578 6973     checksum_exis
+00048990: 7465 6e74 203d 2073 7472 280d 0a20 2020  tent = str(..   
+000489a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000489b0: 2020 2020 2020 2020 2020 2020 2065 7869               exi
+000489c0: 7374 656e 745f 636f 6c2e 6964 5f6b 6579  stent_col.id_key
+000489d0: 5f74 7970 6529 202b 2065 7869 7374 656e  _type) + existen
+000489e0: 745f 636f 6c2e 636f 6c75 6d6e 5f6e 616d  t_col.column_nam
+000489f0: 6520 2b20 6578 6973 7465 6e74 5f63 6f6c  e + existent_col
+00048a00: 2e63 6f6c 756d 6e5f 7479 7065 202b 205c  .column_type + \
+00048a10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00048a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048a30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00048a40: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-00048a50: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
-00048a60: 7370 6563 6966 6963 6174 696f 6e28 5b6e  specification([n
-00048a70: 6577 5f64 6174 6173 6574 5f73 7065 6369  ew_dataset_speci
-00048a80: 6669 6361 7469 6f6e 5d29 0d0a 2020 2020  fication])..    
-00048a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048aa0: 2020 2020 2020 2020 736f 7572 6365 735f          sources_
-00048ab0: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
-00048ac0: 656e 6428 5b64 6174 6173 6574 2e69 645f  end([dataset.id_
-00048ad0: 6461 7461 7365 742c 2074 6162 6c65 5f64  dataset, table_d
-00048ae0: 6566 696e 6974 696f 6e5f 7370 6563 2e63  efinition_spec.c
-00048af0: 6f6c 756d 6e5f 6e61 6d65 5d29 0d0a 0d0a  olumn_name])....
-00048b00: 2020 2020 2020 2020 2320 436c 6f73 6520          # Close 
-00048b10: 736f 7572 6365 7320 7468 6174 206e 6f74  sources that not
-00048b20: 2061 7272 6976 6520 616e 796d 6f72 650d   arrive anymore.
-00048b30: 0a20 2020 2020 2020 2066 6f72 2064 6174  .        for dat
-00048b40: 6173 6574 2069 6e20 5b78 2066 6f72 2078  aset in [x for x
-00048b50: 2069 6e20 7365 6c66 2e6d 6574 6164 6174   in self.metadat
-00048b60: 615f 6163 7475 616c 2e6f 6d5f 6461 7461  a_actual.om_data
-00048b70: 7365 7420 6966 2078 2e69 645f 656e 7469  set if x.id_enti
-00048b80: 7479 5f74 7970 6520 3d3d 2073 656c 662e  ty_type == self.
-00048b90: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00048ba0: 6765 745f 656e 7469 7479 5f74 7970 655f  get_entity_type_
-00048bb0: 6672 6f6d 5f65 6e74 6974 795f 7479 7065  from_entity_type
-00048bc0: 5f6e 616d 6528 454e 5449 5459 5f53 5243  _name(ENTITY_SRC
-00048bd0: 292e 6964 5f65 6e74 6974 795f 7479 7065  ).id_entity_type
-00048be0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00048bf0: 6966 2064 6174 6173 6574 2e64 6174 6173  if dataset.datas
-00048c00: 6574 5f6e 616d 6520 6e6f 7420 696e 2073  et_name not in s
-00048c10: 6f75 7263 6573 5f6c 6f61 6465 6420 616e  ources_loaded an
-00048c20: 6420 6461 7461 7365 742e 656e 645f 6461  d dataset.end_da
-00048c30: 7465 2069 7320 4e6f 6e65 3a0d 0a20 2020  te is None:..   
-00048c40: 2020 2020 2020 2020 2020 2020 2063 6c6f               clo
-00048c50: 7365 5f73 6f75 7263 6520 3d20 5b64 6174  se_source = [dat
-00048c60: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
-00048c70: 2064 6174 6173 6574 2e64 6174 6173 6574   dataset.dataset
-00048c80: 5f6e 616d 652c 2064 6174 6173 6574 2e69  _name, dataset.i
-00048c90: 645f 656e 7469 7479 5f74 7970 652c 0d0a  d_entity_type,..
-00048ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048cc0: 6461 7461 7365 742e 6964 5f70 6174 682c  dataset.id_path,
-00048cd0: 2022 2722 202b 2064 6174 6173 6574 2e6d   "'" + dataset.m
-00048ce0: 6574 615f 6f77 6e65 7220 2b20 2227 222c  eta_owner + "'",
-00048cf0: 2022 2722 202b 2073 7472 2864 6174 6173   "'" + str(datas
-00048d00: 6574 2e73 7461 7274 5f64 6174 6529 202b  et.start_date) +
-00048d10: 2022 2722 2c0d 0a20 2020 2020 2020 2020   "'",..         
-00048d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d30: 2020 2020 2020 2073 656c 662e 636f 6e6e         self.conn
-00048d40: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
-00048d50: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
-00048d60: 6528 295d 0d0a 2020 2020 2020 2020 2020  e()]..          
-00048d70: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-00048d80: 6174 615f 746f 5f6c 6f61 642e 6164 645f  ata_to_load.add_
-00048d90: 6f6d 5f64 6174 6173 6574 285b 636c 6f73  om_dataset([clos
-00048da0: 655f 736f 7572 6365 5d29 0d0a 0d0a 2020  e_source])....  
-00048db0: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
-00048dc0: 2323 2323 2323 2323 2323 2323 2323 204c  ############## L
-00048dd0: 4f41 4420 414c 4c20 4f54 4845 5220 5441  OAD ALL OTHER TA
-00048de0: 424c 4553 2061 6e64 2053 5045 4349 4649  BLES and SPECIFI
-00048df0: 4341 5449 4f4e 5320 2323 2323 2323 2323  CATIONS ########
-00048e00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00048e10: 0d0a 2020 2020 2020 2020 2320 496e 7075  ..        # Inpu
-00048e20: 7420 536f 7572 6365 730d 0a20 2020 2020  t Sources..     
-00048e30: 2020 2074 6d70 5f6c 6f61 6465 6420 3d20     tmp_loaded = 
-00048e40: 5b5d 0d0a 2020 2020 2020 2020 746d 705f  []..        tmp_
-00048e50: 7370 6563 735f 6c6f 6164 6564 203d 205b  specs_loaded = [
-00048e60: 5d0d 0a0d 0a20 2020 2020 2020 2066 6f72  ]....        for
-00048e70: 2065 6e74 6974 7920 696e 2073 656c 662e   entity in self.
-00048e80: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00048e90: 656e 7472 795f 656e 7469 7479 3a0d 0a0d  entry_entity:...
-00048ea0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00048eb0: 2865 6e74 6974 792e 656e 7469 7479 5f74  (entity.entity_t
-00048ec0: 7970 6520 3d3d 2045 4e54 4954 595f 5442  ype == ENTITY_TB
-00048ed0: 206f 7220 656e 7469 7479 2e65 6e74 6974   or entity.entit
-00048ee0: 795f 7479 7065 203d 3d20 454e 5449 5459  y_type == ENTITY
-00048ef0: 5f57 4954 4820 6f72 2065 6e74 6974 792e  _WITH or entity.
-00048f00: 656e 7469 7479 5f74 7970 6520 3d3d 2045  entity_type == E
-00048f10: 4e54 4954 595f 5649 4557 2920 616e 6420  NTITY_VIEW) and 
-00048f20: 656e 7469 7479 2e74 6162 6c65 5f6e 616d  entity.table_nam
-00048f30: 6520 6e6f 7420 696e 2074 6d70 5f6c 6f61  e not in tmp_loa
-00048f40: 6465 643a 0d0a 2020 2020 2020 2020 2020  ded:..          
-00048f50: 2020 2020 2020 6461 7461 7365 7420 3d20        dataset = 
-00048f60: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-00048f70: 7475 616c 2e67 6574 5f64 6174 6173 6574  tual.get_dataset
-00048f80: 5f66 726f 6d5f 6461 7461 7365 745f 6e61  _from_dataset_na
-00048f90: 6d65 2865 6e74 6974 792e 7461 626c 655f  me(entity.table_
-00048fa0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-00048fb0: 2020 2020 2020 2069 645f 656e 7469 7479         id_entity
-00048fc0: 5f74 7970 6520 3d20 2873 656c 662e 6d65  _type = (self.me
-00048fd0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-00048fe0: 745f 656e 7469 7479 5f74 7970 655f 6672  t_entity_type_fr
-00048ff0: 6f6d 5f65 6e74 6974 795f 7479 7065 5f6e  om_entity_type_n
-00049000: 616d 6528 0d0a 2020 2020 2020 2020 2020  ame(..          
-00049010: 2020 2020 2020 2020 2020 656e 7469 7479            entity
-00049020: 2e65 6e74 6974 795f 7479 7065 2e75 7070  .entity_type.upp
-00049030: 6572 2829 2929 2e69 645f 656e 7469 7479  er())).id_entity
-00049040: 5f74 7970 650d 0a20 2020 2020 2020 2020  _type..         
-00049050: 2020 2020 2020 2065 6e64 5f64 6174 6520         end_date 
-00049060: 3d20 224e 554c 4c22 0d0a 2020 2020 2020  = "NULL"..      
-00049070: 2020 2020 2020 2020 2020 2320 4e65 7720            # New 
-00049080: 5465 6d70 6f72 616c 0d0a 2020 2020 2020  Temporal..      
-00049090: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-000490a0: 6173 6574 2069 7320 4e6f 6e65 3a0d 0a20  aset is None:.. 
+00048a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048a40: 2020 7374 7228 6578 6973 7465 6e74 5f63    str(existent_c
+00048a50: 6f6c 2e6f 7264 696e 616c 5f70 6f73 6974  ol.ordinal_posit
+00048a60: 696f 6e29 202b 2073 7472 280d 0a20 2020  ion) + str(..   
+00048a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048a80: 2020 2020 2020 2020 2020 2020 2065 7869               exi
+00048a90: 7374 656e 745f 636f 6c2e 6973 5f6e 756c  stent_col.is_nul
+00048aa0: 6c61 626c 6529 202b 2073 7472 2865 7869  lable) + str(exi
+00048ab0: 7374 656e 745f 636f 6c2e 636f 6c75 6d6e  stent_col.column
+00048ac0: 5f6c 656e 6774 6829 202b 205c 0d0a 2020  _length) + \..  
+00048ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048af0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00048b00: 7228 6578 6973 7465 6e74 5f63 6f6c 2e63  r(existent_col.c
+00048b10: 6f6c 756d 6e5f 7072 6563 6973 696f 6e29  olumn_precision)
+00048b20: 202b 2073 7472 2865 7869 7374 656e 745f   + str(existent_
+00048b30: 636f 6c2e 636f 6c75 6d6e 5f73 6361 6c65  col.column_scale
+00048b40: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00048b50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00048b60: 6865 636b 7375 6d5f 6e65 7720 3d20 7374  hecksum_new = st
+00048b70: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+00048b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b90: 2020 2020 6964 5f6b 6579 5f74 7970 6529      id_key_type)
+00048ba0: 202b 2074 6162 6c65 5f64 6566 696e 6974   + table_definit
+00048bb0: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
+00048bc0: 6e61 6d65 202b 2074 6162 6c65 5f64 6566  name + table_def
+00048bd0: 696e 6974 696f 6e5f 7370 6563 2e63 6f6c  inition_spec.col
+00048be0: 756d 6e5f 7479 7065 202b 205c 0d0a 2020  umn_type + \..  
+00048bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c10: 2020 2020 2020 2020 2073 7472 2874 6162           str(tab
+00048c20: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
+00048c30: 6563 2e69 6429 202b 2073 7472 2874 6162  ec.id) + str(tab
+00048c40: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
+00048c50: 6563 2e69 735f 6e75 6c6c 6162 6c65 2920  ec.is_nullable) 
+00048c60: 2b20 7374 7228 0d0a 2020 2020 2020 2020  + str(..        
+00048c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c80: 2020 2020 2020 2020 7461 626c 655f 6465          table_de
+00048c90: 6669 6e69 7469 6f6e 5f73 7065 632e 636f  finition_spec.co
+00048ca0: 6c75 6d6e 5f6c 656e 6774 6829 202b 205c  lumn_length) + \
+00048cb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048cd0: 2020 2020 2020 2020 2020 2020 2073 7472               str
+00048ce0: 2874 6162 6c65 5f64 6566 696e 6974 696f  (table_definitio
+00048cf0: 6e5f 7370 6563 2e63 6f6c 756d 6e5f 7072  n_spec.column_pr
+00048d00: 6563 6973 696f 6e29 202b 2073 7472 2874  ecision) + str(t
+00048d10: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+00048d20: 7370 6563 2e63 6f6c 756d 6e5f 7363 616c  spec.column_scal
+00048d30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00048d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d50: 6966 2063 6865 636b 7375 6d5f 6e65 7720  if checksum_new 
+00048d60: 3d3d 2063 6865 636b 7375 6d5f 6578 6973  == checksum_exis
+00048d70: 7465 6e74 3a0d 0a20 2020 2020 2020 2020  tent:..         
+00048d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048d90: 2020 2020 2020 2066 696e 6465 6420 3d20         finded = 
+00048da0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00048db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048dc0: 2020 2020 2020 6272 6561 6b0d 0a20 2020        break..   
+00048dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048de0: 2020 2020 2023 204e 6577 2063 6f6c 756d       # New colum
+00048df0: 6e20 6973 2061 6464 6564 206f 6e20 736f  n is added on so
+00048e00: 7572 6365 0d0a 2020 2020 2020 2020 2020  urce..          
+00048e10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00048e20: 206e 6f74 2066 696e 6465 643a 0d0a 2020   not finded:..  
+00048e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048e40: 2020 2020 2020 2020 2020 6964 5f64 6174            id_dat
+00048e50: 6173 6574 5f73 7065 6320 3d20 6e65 7874  aset_spec = next
+00048e60: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
+00048e70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048e80: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00048e90: 7874 5f69 645f 6461 7461 7365 745f 7370  xt_id_dataset_sp
+00048ea0: 6563 202b 3d20 310d 0a20 2020 2020 2020  ec += 1..       
+00048eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ec0: 2020 2020 2069 645f 6b65 795f 7479 7065       id_key_type
+00048ed0: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
+00048ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ef0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00048f00: 6174 615f 6163 7475 616c 2e67 6574 5f6b  ata_actual.get_k
+00048f10: 6579 5f74 7970 655f 6672 6f6d 5f6b 6579  ey_type_from_key
+00048f20: 5f74 7970 655f 6e61 6d65 2874 6162 6c65  _type_name(table
+00048f30: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+00048f40: 2e6b 6579 5f74 7970 6529 292e 6964 5f6b  .key_type)).id_k
+00048f50: 6579 5f74 7970 650d 0a20 2020 2020 2020  ey_type..       
+00048f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f70: 2020 2020 2073 7461 7274 5f64 6174 6520       start_date 
+00048f80: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
+00048f90: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
+00048fa0: 7973 6461 7465 5f76 616c 7565 2829 0d0a  ysdate_value()..
+00048fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048fc0: 2020 2020 2020 2020 2020 2020 656e 645f              end_
+00048fd0: 6461 7465 203d 2022 4e55 4c4c 220d 0a0d  date = "NULL"...
+00048fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048ff0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00049000: 5f64 6174 6173 6574 5f73 7065 6369 6669  _dataset_specifi
+00049010: 6361 7469 6f6e 203d 205b 6964 5f64 6174  cation = [id_dat
+00049020: 6173 6574 5f73 7065 632c 2064 6174 6173  aset_spec, datas
+00049030: 6574 2e69 645f 6461 7461 7365 742c 2069  et.id_dataset, i
+00049040: 645f 6b65 795f 7479 7065 2c0d 0a20 2020  d_key_type,..   
+00049050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049080: 2020 2020 2020 7461 626c 655f 6465 6669        table_defi
+00049090: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
+000490a0: 6d6e 5f6e 616d 652c 0d0a 2020 2020 2020  mn_name,..      
 000490b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000490c0: 2020 2023 204e 6577 2053 6f75 7263 650d     # New Source.
-000490d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000490e0: 2020 2020 2069 645f 6461 7461 7365 7420       id_dataset 
-000490f0: 3d20 6e65 7874 5f69 645f 6461 7461 7365  = next_id_datase
-00049100: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00049110: 2020 2020 2020 206e 6578 745f 6964 5f64         next_id_d
-00049120: 6174 6173 6574 202b 3d20 310d 0a20 2020  ataset += 1..   
+000490c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000490d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000490e0: 2020 2074 6162 6c65 5f64 6566 696e 6974     table_definit
+000490f0: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
+00049100: 7479 7065 2c20 7461 626c 655f 6465 6669  type, table_defi
+00049110: 6e69 7469 6f6e 5f73 7065 632e 6964 2c0d  nition_spec.id,.
+00049120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00049130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049140: 2065 6e74 7279 5f70 6174 6820 3d20 7365   entry_path = se
-00049150: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00049160: 616c 2e67 6574 5f65 6e74 7279 5f70 6174  al.get_entry_pat
-00049170: 685f 6672 6f6d 5f63 6f64 5f70 6174 6828  h_from_cod_path(
-00049180: 656e 7469 7479 2e63 6f64 5f70 6174 6829  entity.cod_path)
-00049190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000491a0: 2020 2020 2020 6964 5f70 6174 6820 3d20        id_path = 
-000491b0: 2873 656c 662e 6d65 7461 6461 7461 5f74  (self.metadata_t
-000491c0: 6f5f 6c6f 6164 2e67 6574 5f70 6174 685f  o_load.get_path_
-000491d0: 6672 6f6d 5f64 6174 6162 6173 655f 616e  from_database_an
-000491e0: 645f 7363 6865 6d61 2865 6e74 7279 5f70  d_schema(entry_p
-000491f0: 6174 682e 6461 7461 6261 7365 5f6e 616d  ath.database_nam
-00049200: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00049210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049250: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
-00049260: 5f70 6174 682e 7363 6865 6d61 5f6e 616d  _path.schema_nam
-00049270: 6529 292e 6964 5f70 6174 680d 0a20 2020  e)).id_path..   
+00049140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049150: 2020 2020 2020 2020 2020 7461 626c 655f            table_
+00049160: 6465 6669 6e69 7469 6f6e 5f73 7065 632e  definition_spec.
+00049170: 6973 5f6e 756c 6c61 626c 652c 0d0a 2020  is_nullable,..  
+00049180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000491a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000491b0: 2020 2020 2020 2074 6162 6c65 5f64 6566         table_def
+000491c0: 696e 6974 696f 6e5f 7370 6563 2e63 6f6c  inition_spec.col
+000491d0: 756d 6e5f 6c65 6e67 7468 2c0d 0a20 2020  umn_length,..   
+000491e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000491f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049210: 2020 2020 2020 7461 626c 655f 6465 6669        table_defi
+00049220: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
+00049230: 6d6e 5f70 7265 6369 7369 6f6e 2c20 7461  mn_precision, ta
+00049240: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
+00049250: 7065 632e 636f 6c75 6d6e 5f73 6361 6c65  pec.column_scale
+00049260: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00049270: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00049280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049290: 2073 7461 7274 5f64 6174 6520 3d20 7365   start_date = se
-000492a0: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-000492b0: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-000492c0: 7465 5f76 616c 7565 2829 0d0a 2020 2020  te_value()..    
-000492d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000492e0: 6e65 775f 736f 7572 6365 203d 205b 6964  new_source = [id
-000492f0: 5f64 6174 6173 6574 2c20 656e 7469 7479  _dataset, entity
-00049300: 2e74 6162 6c65 5f6e 616d 652c 2069 645f  .table_name, id_
-00049310: 656e 7469 7479 5f74 7970 652c 2069 645f  entity_type, id_
-00049320: 7061 7468 2c20 7365 6c66 2e6f 776e 6572  path, self.owner
-00049330: 2c20 7374 6172 745f 6461 7465 2c0d 0a20  , start_date,.. 
-00049340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049360: 2065 6e64 5f64 6174 655d 0d0a 2020 2020   end_date]..    
-00049370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049380: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-00049390: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
-000493a0: 6173 6574 285b 6e65 775f 736f 7572 6365  aset([new_source
-000493b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000493c0: 2020 2020 2020 2020 746d 705f 6c6f 6164          tmp_load
-000493d0: 6564 2e61 7070 656e 6428 5b65 6e74 6974  ed.append([entit
-000493e0: 792e 7461 626c 655f 6e61 6d65 2c20 6964  y.table_name, id
-000493f0: 5f65 6e74 6974 795f 7479 7065 2c20 6964  _entity_type, id
-00049400: 5f70 6174 685d 290d 0a20 2020 2020 2020  _path])..       
-00049410: 2020 2020 2020 2020 2023 2055 7064 6174           # Updat
-00049420: 6520 544d 500d 0a20 2020 2020 2020 2020  e TMP..         
-00049430: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00049440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049450: 2020 656e 7472 795f 7061 7468 203d 2073    entry_path = s
-00049460: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00049470: 7561 6c2e 6765 745f 656e 7472 795f 7061  ual.get_entry_pa
-00049480: 7468 5f66 726f 6d5f 636f 645f 7061 7468  th_from_cod_path
-00049490: 2865 6e74 6974 792e 636f 645f 7061 7468  (entity.cod_path
-000494a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000494b0: 2020 2020 2020 2023 2049 6620 6974 2773         # If it's
-000494c0: 2074 6865 2073 616d 650d 0a20 2020 2020   the same..     
-000494d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000494e0: 6620 6461 7461 7365 742e 6964 5f70 6174  f dataset.id_pat
-000494f0: 6820 3d3d 2028 7365 6c66 2e6d 6574 6164  h == (self.metad
-00049500: 6174 615f 746f 5f6c 6f61 642e 6765 745f  ata_to_load.get_
-00049510: 7061 7468 5f66 726f 6d5f 6461 7461 6261  path_from_databa
-00049520: 7365 5f61 6e64 5f73 6368 656d 6128 656e  se_and_schema(en
-00049530: 7472 795f 7061 7468 2e64 6174 6162 6173  try_path.databas
-00049540: 655f 6e61 6d65 2c0d 0a20 2020 2020 2020  e_name,..       
+00049290: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000492a0: 2e6f 776e 6572 2c20 7374 6172 745f 6461  .owner, start_da
+000492b0: 7465 2c20 656e 645f 6461 7465 5d0d 0a20  te, end_date].. 
+000492c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000492d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000492e0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+000492f0: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
+00049300: 7370 6563 6966 6963 6174 696f 6e28 5b6e  specification([n
+00049310: 6577 5f64 6174 6173 6574 5f73 7065 6369  ew_dataset_speci
+00049320: 6669 6361 7469 6f6e 5d29 0d0a 2020 2020  fication])..    
+00049330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049340: 2020 2020 2020 2020 736f 7572 6365 735f          sources_
+00049350: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
+00049360: 656e 6428 5b64 6174 6173 6574 2e69 645f  end([dataset.id_
+00049370: 6461 7461 7365 742c 2074 6162 6c65 5f64  dataset, table_d
+00049380: 6566 696e 6974 696f 6e5f 7370 6563 2e63  efinition_spec.c
+00049390: 6f6c 756d 6e5f 6e61 6d65 5d29 0d0a 0d0a  olumn_name])....
+000493a0: 2020 2020 2020 2020 2320 436c 6f73 6520          # Close 
+000493b0: 736f 7572 6365 7320 7468 6174 206e 6f74  sources that not
+000493c0: 2061 7272 6976 6520 616e 796d 6f72 650d   arrive anymore.
+000493d0: 0a20 2020 2020 2020 2066 6f72 2064 6174  .        for dat
+000493e0: 6173 6574 2069 6e20 5b78 2066 6f72 2078  aset in [x for x
+000493f0: 2069 6e20 7365 6c66 2e6d 6574 6164 6174   in self.metadat
+00049400: 615f 6163 7475 616c 2e6f 6d5f 6461 7461  a_actual.om_data
+00049410: 7365 7420 6966 2078 2e69 645f 656e 7469  set if x.id_enti
+00049420: 7479 5f74 7970 6520 3d3d 2073 656c 662e  ty_type == self.
+00049430: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00049440: 6765 745f 656e 7469 7479 5f74 7970 655f  get_entity_type_
+00049450: 6672 6f6d 5f65 6e74 6974 795f 7479 7065  from_entity_type
+00049460: 5f6e 616d 6528 454e 5449 5459 5f53 5243  _name(ENTITY_SRC
+00049470: 292e 6964 5f65 6e74 6974 795f 7479 7065  ).id_entity_type
+00049480: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00049490: 6966 2064 6174 6173 6574 2e64 6174 6173  if dataset.datas
+000494a0: 6574 5f6e 616d 6520 6e6f 7420 696e 2073  et_name not in s
+000494b0: 6f75 7263 6573 5f6c 6f61 6465 6420 616e  ources_loaded an
+000494c0: 6420 6461 7461 7365 742e 656e 645f 6461  d dataset.end_da
+000494d0: 7465 2069 7320 4e6f 6e65 3a0d 0a20 2020  te is None:..   
+000494e0: 2020 2020 2020 2020 2020 2020 2063 6c6f               clo
+000494f0: 7365 5f73 6f75 7263 6520 3d20 5b64 6174  se_source = [dat
+00049500: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
+00049510: 2064 6174 6173 6574 2e64 6174 6173 6574   dataset.dataset
+00049520: 5f6e 616d 652c 2064 6174 6173 6574 2e69  _name, dataset.i
+00049530: 645f 656e 7469 7479 5f74 7970 652c 0d0a  d_entity_type,..
+00049540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00049550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049590: 2020 2020 2065 6e74 7279 5f70 6174 682e       entry_path.
-000495a0: 7363 6865 6d61 5f6e 616d 6529 292e 6964  schema_name)).id
-000495b0: 5f70 6174 6820 5c0d 0a20 2020 2020 2020  _path \..       
+00049560: 6461 7461 7365 742e 6964 5f70 6174 682c  dataset.id_path,
+00049570: 2022 2722 202b 2064 6174 6173 6574 2e6d   "'" + dataset.m
+00049580: 6574 615f 6f77 6e65 7220 2b20 2227 222c  eta_owner + "'",
+00049590: 2022 2722 202b 2073 7472 2864 6174 6173   "'" + str(datas
+000495a0: 6574 2e73 7461 7274 5f64 6174 6529 202b  et.start_date) +
+000495b0: 2022 2722 2c0d 0a20 2020 2020 2020 2020   "'",..         
 000495c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000495d0: 2020 2020 2061 6e64 2073 656c 662e 6d65       and self.me
-000495e0: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
-000495f0: 745f 656e 7469 7479 5f74 7970 655f 6672  t_entity_type_fr
-00049600: 6f6d 5f65 6e74 6974 795f 7479 7065 5f6e  om_entity_type_n
-00049610: 616d 6528 656e 7469 7479 2e65 6e74 6974  ame(entity.entit
-00049620: 795f 7479 7065 292e 6964 5f65 6e74 6974  y_type).id_entit
-00049630: 795f 7479 7065 203d 3d20 6461 7461 7365  y_type == datase
-00049640: 742e 6964 5f65 6e74 6974 795f 7479 7065  t.id_entity_type
-00049650: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00049660: 2020 2020 2020 2020 2020 2069 645f 7061             id_pa
-00049670: 7468 203d 2064 6174 6173 6574 2e69 645f  th = dataset.id_
-00049680: 7061 7468 0d0a 2020 2020 2020 2020 2020  path..          
-00049690: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-000496a0: 6f73 655f 736f 7572 6365 203d 205b 6461  ose_source = [da
-000496b0: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
-000496c0: 2c20 6461 7461 7365 742e 6461 7461 7365  , dataset.datase
-000496d0: 745f 6e61 6d65 2c20 6461 7461 7365 742e  t_name, dataset.
-000496e0: 6964 5f65 6e74 6974 795f 7479 7065 2c0d  id_entity_type,.
-000496f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049710: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-00049720: 2e69 645f 7061 7468 2c20 6461 7461 7365  .id_path, datase
-00049730: 742e 6d65 7461 5f6f 776e 6572 2c20 2227  t.meta_owner, "'
-00049740: 2220 2b20 7374 7228 6461 7461 7365 742e  " + str(dataset.
-00049750: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
-00049760: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00049770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049780: 2020 2020 2020 2020 2020 2020 224e 554c              "NUL
-00049790: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
-000497a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000497b0: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
-000497c0: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
-000497d0: 7428 5b63 6c6f 7365 5f73 6f75 7263 655d  t([close_source]
-000497e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000497f0: 2020 2020 2020 2020 2020 2074 6d70 5f6c             tmp_l
-00049800: 6f61 6465 642e 6170 7065 6e64 285b 6461  oaded.append([da
-00049810: 7461 7365 742e 6461 7461 7365 745f 6e61  taset.dataset_na
-00049820: 6d65 2c20 6461 7461 7365 742e 6964 5f65  me, dataset.id_e
-00049830: 6e74 6974 795f 7479 7065 2c20 6461 7461  ntity_type, data
-00049840: 7365 742e 6964 5f70 6174 685d 290d 0a20  set.id_path]).. 
-00049850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049860: 2020 2020 2020 2069 645f 6461 7461 7365         id_datase
-00049870: 7420 3d20 6461 7461 7365 742e 6964 5f64  t = dataset.id_d
-00049880: 6174 6173 6574 0d0a 0d0a 2020 2020 2020  ataset....      
-00049890: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000498a0: 4966 2074 6865 2070 6174 6820 6f72 2074  If the path or t
-000498b0: 6865 2065 6e74 6974 7920 6861 7320 6368  he entity has ch
-000498c0: 616e 6765 642c 2074 6865 2061 6374 7561  anged, the actua
-000498d0: 6c20 6e65 6564 7320 746f 2062 6520 636c  l needs to be cl
-000498e0: 6f73 6564 2061 6e64 2061 6464 2074 6865  osed and add the
-000498f0: 2061 6374 7561 6c0d 0a20 2020 2020 2020   actual..       
-00049900: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00049910: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00049920: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00049930: 6461 7461 7365 742e 6964 5f65 6e74 6974  dataset.id_entit
-00049940: 795f 7479 7065 2021 3d20 7365 6c66 2e6d  y_type != self.m
-00049950: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-00049960: 6574 5f65 6e74 6974 795f 7479 7065 5f66  et_entity_type_f
-00049970: 726f 6d5f 656e 7469 7479 5f74 7970 655f  rom_entity_type_
-00049980: 6e61 6d65 2845 4e54 4954 595f 5352 4329  name(ENTITY_SRC)
-00049990: 2e69 645f 656e 7469 7479 5f74 7970 6529  .id_entity_type)
-000499a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000499b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000499c0: 6c6f 7365 5f73 6f75 7263 6520 3d20 5b64  lose_source = [d
-000499d0: 6174 6173 6574 2e69 645f 6461 7461 7365  ataset.id_datase
-000499e0: 742c 2064 6174 6173 6574 2e64 6174 6173  t, dataset.datas
-000499f0: 6574 5f6e 616d 652c 2064 6174 6173 6574  et_name, dataset
-00049a00: 2e69 645f 656e 7469 7479 5f74 7970 652c  .id_entity_type,
-00049a10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049a30: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00049a40: 7461 7365 742e 6964 5f70 6174 682c 2064  taset.id_path, d
-00049a50: 6174 6173 6574 2e6d 6574 615f 6f77 6e65  ataset.meta_owne
-00049a60: 722c 2022 2722 202b 2073 7472 2864 6174  r, "'" + str(dat
-00049a70: 6173 6574 2e73 7461 7274 5f64 6174 6529  aset.start_date)
-00049a80: 202b 2022 2722 2c0d 0a20 2020 2020 2020   + "'",..       
-00049a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ab0: 2020 2020 2073 656c 662e 636f 6e6e 6563       self.connec
-00049ac0: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
-00049ad0: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
-00049ae0: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-00049af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049b00: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-00049b10: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
-00049b20: 6173 6574 285b 636c 6f73 655f 736f 7572  aset([close_sour
-00049b30: 6365 5d29 0d0a 2020 2020 2020 2020 2020  ce])..          
-00049b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049b50: 2020 746d 705f 6c6f 6164 6564 2e61 7070    tmp_loaded.app
-00049b60: 656e 6428 5b64 6174 6173 6574 2e64 6174  end([dataset.dat
-00049b70: 6173 6574 5f6e 616d 652c 2064 6174 6173  aset_name, datas
-00049b80: 6574 2e69 645f 656e 7469 7479 5f74 7970  et.id_entity_typ
-00049b90: 652c 2064 6174 6173 6574 2e69 645f 7061  e, dataset.id_pa
-00049ba0: 7468 5d29 0d0a 0d0a 2020 2020 2020 2020  th])....        
-00049bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049bc0: 6964 5f64 6174 6173 6574 203d 206e 6578  id_dataset = nex
-00049bd0: 745f 6964 5f64 6174 6173 6574 0d0a 2020  t_id_dataset..  
+000495d0: 2020 2020 2020 2073 656c 662e 636f 6e6e         self.conn
+000495e0: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
+000495f0: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
+00049600: 6528 295d 0d0a 2020 2020 2020 2020 2020  e()]..          
+00049610: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00049620: 6174 615f 746f 5f6c 6f61 642e 6164 645f  ata_to_load.add_
+00049630: 6f6d 5f64 6174 6173 6574 285b 636c 6f73  om_dataset([clos
+00049640: 655f 736f 7572 6365 5d29 0d0a 0d0a 2020  e_source])....  
+00049650: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+00049660: 2323 2323 2323 2323 2323 2323 2323 204c  ############## L
+00049670: 4f41 4420 414c 4c20 4f54 4845 5220 5441  OAD ALL OTHER TA
+00049680: 424c 4553 2061 6e64 2053 5045 4349 4649  BLES and SPECIFI
+00049690: 4341 5449 4f4e 5320 2323 2323 2323 2323  CATIONS ########
+000496a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000496b0: 0d0a 2020 2020 2020 2020 2320 496e 7075  ..        # Inpu
+000496c0: 7420 536f 7572 6365 730d 0a20 2020 2020  t Sources..     
+000496d0: 2020 2074 6d70 5f6c 6f61 6465 6420 3d20     tmp_loaded = 
+000496e0: 5b5d 0d0a 2020 2020 2020 2020 746d 705f  []..        tmp_
+000496f0: 7370 6563 735f 6c6f 6164 6564 203d 205b  specs_loaded = [
+00049700: 5d0d 0a0d 0a20 2020 2020 2020 2066 6f72  ]....        for
+00049710: 2065 6e74 6974 7920 696e 2073 656c 662e   entity in self.
+00049720: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00049730: 656e 7472 795f 656e 7469 7479 3a0d 0a0d  entry_entity:...
+00049740: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00049750: 2865 6e74 6974 792e 656e 7469 7479 5f74  (entity.entity_t
+00049760: 7970 6520 3d3d 2045 4e54 4954 595f 5442  ype == ENTITY_TB
+00049770: 206f 7220 656e 7469 7479 2e65 6e74 6974   or entity.entit
+00049780: 795f 7479 7065 203d 3d20 454e 5449 5459  y_type == ENTITY
+00049790: 5f57 4954 4820 6f72 2065 6e74 6974 792e  _WITH or entity.
+000497a0: 656e 7469 7479 5f74 7970 6520 3d3d 2045  entity_type == E
+000497b0: 4e54 4954 595f 5649 4557 2920 616e 6420  NTITY_VIEW) and 
+000497c0: 656e 7469 7479 2e74 6162 6c65 5f6e 616d  entity.table_nam
+000497d0: 6520 6e6f 7420 696e 2074 6d70 5f6c 6f61  e not in tmp_loa
+000497e0: 6465 643a 0d0a 2020 2020 2020 2020 2020  ded:..          
+000497f0: 2020 2020 2020 6461 7461 7365 7420 3d20        dataset = 
+00049800: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+00049810: 7475 616c 2e67 6574 5f64 6174 6173 6574  tual.get_dataset
+00049820: 5f66 726f 6d5f 6461 7461 7365 745f 6e61  _from_dataset_na
+00049830: 6d65 2865 6e74 6974 792e 7461 626c 655f  me(entity.table_
+00049840: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
+00049850: 2020 2020 2020 2069 645f 656e 7469 7479         id_entity
+00049860: 5f74 7970 6520 3d20 2873 656c 662e 6d65  _type = (self.me
+00049870: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+00049880: 745f 656e 7469 7479 5f74 7970 655f 6672  t_entity_type_fr
+00049890: 6f6d 5f65 6e74 6974 795f 7479 7065 5f6e  om_entity_type_n
+000498a0: 616d 6528 0d0a 2020 2020 2020 2020 2020  ame(..          
+000498b0: 2020 2020 2020 2020 2020 656e 7469 7479            entity
+000498c0: 2e65 6e74 6974 795f 7479 7065 2e75 7070  .entity_type.upp
+000498d0: 6572 2829 2929 2e69 645f 656e 7469 7479  er())).id_entity
+000498e0: 5f74 7970 650d 0a20 2020 2020 2020 2020  _type..         
+000498f0: 2020 2020 2020 2065 6e64 5f64 6174 6520         end_date 
+00049900: 3d20 224e 554c 4c22 0d0a 2020 2020 2020  = "NULL"..      
+00049910: 2020 2020 2020 2020 2020 2320 4e65 7720            # New 
+00049920: 5465 6d70 6f72 616c 0d0a 2020 2020 2020  Temporal..      
+00049930: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
+00049940: 6173 6574 2069 7320 4e6f 6e65 3a0d 0a20  aset is None:.. 
+00049950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049960: 2020 2023 204e 6577 2053 6f75 7263 650d     # New Source.
+00049970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049980: 2020 2020 2069 645f 6461 7461 7365 7420       id_dataset 
+00049990: 3d20 6e65 7874 5f69 645f 6461 7461 7365  = next_id_datase
+000499a0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+000499b0: 2020 2020 2020 206e 6578 745f 6964 5f64         next_id_d
+000499c0: 6174 6173 6574 202b 3d20 310d 0a20 2020  ataset += 1..   
+000499d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000499e0: 2065 6e74 7279 5f70 6174 6820 3d20 7365   entry_path = se
+000499f0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00049a00: 616c 2e67 6574 5f65 6e74 7279 5f70 6174  al.get_entry_pat
+00049a10: 685f 6672 6f6d 5f63 6f64 5f70 6174 6828  h_from_cod_path(
+00049a20: 656e 7469 7479 2e63 6f64 5f70 6174 6829  entity.cod_path)
+00049a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049a40: 2020 2020 2020 6964 5f70 6174 6820 3d20        id_path = 
+00049a50: 2873 656c 662e 6d65 7461 6461 7461 5f74  (self.metadata_t
+00049a60: 6f5f 6c6f 6164 2e67 6574 5f70 6174 685f  o_load.get_path_
+00049a70: 6672 6f6d 5f64 6174 6162 6173 655f 616e  from_database_an
+00049a80: 645f 7363 6865 6d61 2865 6e74 7279 5f70  d_schema(entry_p
+00049a90: 6174 682e 6461 7461 6261 7365 5f6e 616d  ath.database_nam
+00049aa0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00049ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049af0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+00049b00: 5f70 6174 682e 7363 6865 6d61 5f6e 616d  _path.schema_nam
+00049b10: 6529 292e 6964 5f70 6174 680d 0a20 2020  e)).id_path..   
+00049b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049b30: 2073 7461 7274 5f64 6174 6520 3d20 7365   start_date = se
+00049b40: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+00049b50: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+00049b60: 7465 5f76 616c 7565 2829 0d0a 2020 2020  te_value()..    
+00049b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049b80: 6e65 775f 736f 7572 6365 203d 205b 6964  new_source = [id
+00049b90: 5f64 6174 6173 6574 2c20 656e 7469 7479  _dataset, entity
+00049ba0: 2e74 6162 6c65 5f6e 616d 652c 2069 645f  .table_name, id_
+00049bb0: 656e 7469 7479 5f74 7970 652c 2069 645f  entity_type, id_
+00049bc0: 7061 7468 2c20 7365 6c66 2e6f 776e 6572  path, self.owner
+00049bd0: 2c20 7374 6172 745f 6461 7465 2c0d 0a20  , start_date,.. 
 00049be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049bf0: 2020 2020 2020 6e65 7874 5f69 645f 6461        next_id_da
-00049c00: 7461 7365 7420 2b3d 2031 0d0a 2020 2020  taset += 1..    
+00049bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049c00: 2065 6e64 5f64 6174 655d 0d0a 2020 2020   end_date]..    
 00049c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c20: 2020 2020 6964 5f70 6174 6820 3d20 2873      id_path = (s
-00049c30: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00049c40: 6c6f 6164 2e67 6574 5f70 6174 685f 6672  load.get_path_fr
-00049c50: 6f6d 5f64 6174 6162 6173 655f 616e 645f  om_database_and_
-00049c60: 7363 6865 6d61 2865 6e74 7279 5f70 6174  schema(entry_pat
-00049c70: 682e 6461 7461 6261 7365 5f6e 616d 652c  h.database_name,
-00049c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049cd0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00049ce0: 7279 5f70 6174 682e 7363 6865 6d61 5f6e  ry_path.schema_n
-00049cf0: 616d 6529 292e 6964 5f70 6174 680d 0a20  ame)).id_path.. 
-00049d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049d10: 2020 2020 2020 2075 7064 6174 6564 5f73         updated_s
-00049d20: 6f75 7263 6520 3d20 5b69 645f 6461 7461  ource = [id_data
-00049d30: 7365 742c 2064 6174 6173 6574 2e64 6174  set, dataset.dat
-00049d40: 6173 6574 5f6e 616d 652c 0d0a 2020 2020  aset_name,..    
-00049d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049d70: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00049d80: 615f 6163 7475 616c 2e67 6574 5f65 6e74  a_actual.get_ent
-00049d90: 6974 795f 7479 7065 5f66 726f 6d5f 656e  ity_type_from_en
-00049da0: 7469 7479 5f74 7970 655f 6e61 6d65 280d  tity_type_name(.
-00049db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049dd0: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00049de0: 6974 792e 656e 7469 7479 5f74 7970 6529  ity.entity_type)
-00049df0: 2e69 645f 656e 7469 7479 5f74 7970 652c  .id_entity_type,
-00049e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049c20: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+00049c30: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
+00049c40: 6173 6574 285b 6e65 775f 736f 7572 6365  aset([new_source
+00049c50: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00049c60: 2020 2020 2020 2020 746d 705f 6c6f 6164          tmp_load
+00049c70: 6564 2e61 7070 656e 6428 5b65 6e74 6974  ed.append([entit
+00049c80: 792e 7461 626c 655f 6e61 6d65 2c20 6964  y.table_name, id
+00049c90: 5f65 6e74 6974 795f 7479 7065 2c20 6964  _entity_type, id
+00049ca0: 5f70 6174 685d 290d 0a20 2020 2020 2020  _path])..       
+00049cb0: 2020 2020 2020 2020 2023 2055 7064 6174           # Updat
+00049cc0: 6520 544d 500d 0a20 2020 2020 2020 2020  e TMP..         
+00049cd0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00049ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049cf0: 2020 656e 7472 795f 7061 7468 203d 2073    entry_path = s
+00049d00: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00049d10: 7561 6c2e 6765 745f 656e 7472 795f 7061  ual.get_entry_pa
+00049d20: 7468 5f66 726f 6d5f 636f 645f 7061 7468  th_from_cod_path
+00049d30: 2865 6e74 6974 792e 636f 645f 7061 7468  (entity.cod_path
+00049d40: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00049d50: 2020 2020 2020 2023 2049 6620 6974 2773         # If it's
+00049d60: 2074 6865 2073 616d 650d 0a20 2020 2020   the same..     
+00049d70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00049d80: 6620 6461 7461 7365 742e 6964 5f70 6174  f dataset.id_pat
+00049d90: 6820 3d3d 2028 7365 6c66 2e6d 6574 6164  h == (self.metad
+00049da0: 6174 615f 746f 5f6c 6f61 642e 6765 745f  ata_to_load.get_
+00049db0: 7061 7468 5f66 726f 6d5f 6461 7461 6261  path_from_databa
+00049dc0: 7365 5f61 6e64 5f73 6368 656d 6128 656e  se_and_schema(en
+00049dd0: 7472 795f 7061 7468 2e64 6174 6162 6173  try_path.databas
+00049de0: 655f 6e61 6d65 2c0d 0a20 2020 2020 2020  e_name,..       
+00049df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00049e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e20: 2020 2020 2020 2020 2020 6964 5f70 6174            id_pat
-00049e30: 682c 2064 6174 6173 6574 2e6d 6574 615f  h, dataset.meta_
-00049e40: 6f77 6e65 722c 2073 656c 662e 636f 6e6e  owner, self.conn
-00049e50: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
-00049e60: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
-00049e70: 6528 292c 0d0a 2020 2020 2020 2020 2020  e(),..          
-00049e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e90: 2020 2020 2020 2020 2020 2020 2020 224e                "N
-00049ea0: 554c 4c22 5d0d 0a20 2020 2020 2020 2020  ULL"]..         
-00049eb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00049ec0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00049ed0: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-00049ee0: 7365 7428 5b75 7064 6174 6564 5f73 6f75  set([updated_sou
-00049ef0: 7263 655d 290d 0a20 2020 2020 2020 2020  rce])..         
-00049f00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00049f10: 6174 6173 6574 203d 2073 656c 662e 6d65  ataset = self.me
-00049f20: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e67  tadata_to_load.g
-00049f30: 6574 5f64 6174 6173 6574 5f66 726f 6d5f  et_dataset_from_
-00049f40: 6461 7461 7365 745f 6e61 6d65 2864 6174  dataset_name(dat
-00049f50: 6173 6574 2e64 6174 6173 6574 5f6e 616d  aset.dataset_nam
-00049f60: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00049f70: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
-00049f80: 6c6f 6164 6564 2e61 7070 656e 6428 5b64  loaded.append([d
-00049f90: 6174 6173 6574 2e64 6174 6173 6574 5f6e  ataset.dataset_n
-00049fa0: 616d 652c 2064 6174 6173 6574 2e69 645f  ame, dataset.id_
-00049fb0: 656e 7469 7479 5f74 7970 652c 2069 645f  entity_type, id_
-00049fc0: 7061 7468 5d29 0d0a 0d0a 2020 2020 2020  path])....      
-00049fd0: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-00049fe0: 4461 7461 7365 7420 5370 6563 6966 6963  Dataset Specific
-00049ff0: 6174 696f 6e73 2066 726f 6d20 4461 7461  ations from Data
-0004a000: 2044 6174 6162 6173 650d 0a20 2020 2020   Database..     
-0004a010: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0004a020: 626c 655f 636f 6e6e 6563 7469 6f6e 203d  ble_connection =
-0004a030: 2073 656c 662e 636f 6e66 6967 7572 6174   self.configurat
-0004a040: 696f 6e5f 6669 6c65 5b27 6461 7461 275d  ion_file['data']
-0004a050: 5b27 636f 6e6e 6563 7469 6f6e 5f74 7970  ['connection_typ
-0004a060: 6527 5d2e 6c6f 7765 7228 2920 2b20 225f  e'].lower() + "_
-0004a070: 6461 7461 6261 7365 220d 0a20 2020 2020  database"..     
-0004a080: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0004a090: 6775 7261 7469 6f6e 5f63 6f6e 6e65 6374  guration_connect
-0004a0a0: 696f 6e5f 6461 7461 203d 2073 656c 662e  ion_data = self.
-0004a0b0: 636f 6e66 6967 7572 6174 696f 6e5f 6669  configuration_fi
-0004a0c0: 6c65 5b27 6461 7461 275d 0d0a 2020 2020  le['data']..    
-0004a0d0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-0004a0e0: 6967 7572 6174 696f 6e5f 636f 6e6e 6563  iguration_connec
-0004a0f0: 7469 6f6e 5f64 6174 615b 7661 7269 6162  tion_data[variab
-0004a100: 6c65 5f63 6f6e 6e65 6374 696f 6e5d 203d  le_connection] =
-0004a110: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-0004a120: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0004a130: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
-0004a140: 745f 7061 7468 5f66 726f 6d5f 6964 5f70  t_path_from_id_p
-0004a150: 6174 6828 6964 5f70 6174 6829 292e 6461  ath(id_path)).da
-0004a160: 7461 6261 7365 5f6e 616d 650d 0a20 2020  tabase_name..   
-0004a170: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0004a180: 656c 662e 636f 6e6e 6563 7469 6f6e 2e73  elf.connection.s
-0004a190: 6574 7570 5f63 6f6e 6e65 6374 696f 6e28  etup_connection(
-0004a1a0: 636f 6e66 6967 7572 6174 696f 6e5f 636f  configuration_co
-0004a1b0: 6e6e 6563 7469 6f6e 5f64 6174 612c 2073  nnection_data, s
-0004a1c0: 656c 662e 6c6f 6729 0d0a 2020 2020 2020  elf.log)..      
-0004a1d0: 2020 2020 2020 2020 2020 7461 626c 655f            table_
-0004a1e0: 6465 6669 6e69 7469 6f6e 203d 2073 656c  definition = sel
-0004a1f0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0004a200: 6c2e 6765 745f 636f 6c73 5f66 726f 6d5f  l.get_cols_from_
-0004a210: 636f 645f 656e 7469 7479 5f6f 6e5f 656e  cod_entity_on_en
-0004a220: 7472 7928 656e 7469 7479 2e63 6f64 5f65  try(entity.cod_e
-0004a230: 6e74 6974 7929 0d0a 2020 2020 2020 2020  ntity)..        
-0004a240: 2020 2020 2020 2020 2320 536f 7572 6365          # Source
-0004a250: 2053 7065 6369 6669 6361 7469 6f6e 0d0a   Specification..
-0004a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a270: 6966 2064 6174 6173 6574 2069 7320 4e6f  if dataset is No
-0004a280: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004a290: 2020 2020 2020 2020 2023 204e 6577 2053           # New S
-0004a2a0: 6f75 7263 6573 2053 7065 6369 6669 6361  ources Specifica
-0004a2b0: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-0004a2c0: 2020 2020 2020 2020 2020 666f 7220 7461            for ta
-0004a2d0: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
-0004a2e0: 7065 6320 696e 2074 6162 6c65 5f64 6566  pec in table_def
-0004a2f0: 696e 6974 696f 6e3a 0d0a 2020 2020 2020  inition:..      
-0004a300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a310: 2020 6964 5f64 6174 6173 6574 5f73 7065    id_dataset_spe
-0004a320: 6320 3d20 6e65 7874 5f69 645f 6461 7461  c = next_id_data
-0004a330: 7365 745f 7370 6563 0d0a 2020 2020 2020  set_spec..      
+00049e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049e30: 2020 2020 2065 6e74 7279 5f70 6174 682e       entry_path.
+00049e40: 7363 6865 6d61 5f6e 616d 6529 292e 6964  schema_name)).id
+00049e50: 5f70 6174 6820 5c0d 0a20 2020 2020 2020  _path \..       
+00049e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049e70: 2020 2020 2061 6e64 2073 656c 662e 6d65       and self.me
+00049e80: 7461 6461 7461 5f61 6374 7561 6c2e 6765  tadata_actual.ge
+00049e90: 745f 656e 7469 7479 5f74 7970 655f 6672  t_entity_type_fr
+00049ea0: 6f6d 5f65 6e74 6974 795f 7479 7065 5f6e  om_entity_type_n
+00049eb0: 616d 6528 656e 7469 7479 2e65 6e74 6974  ame(entity.entit
+00049ec0: 795f 7479 7065 292e 6964 5f65 6e74 6974  y_type).id_entit
+00049ed0: 795f 7479 7065 203d 3d20 6461 7461 7365  y_type == datase
+00049ee0: 742e 6964 5f65 6e74 6974 795f 7479 7065  t.id_entity_type
+00049ef0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00049f00: 2020 2020 2020 2020 2020 2069 645f 7061             id_pa
+00049f10: 7468 203d 2064 6174 6173 6574 2e69 645f  th = dataset.id_
+00049f20: 7061 7468 0d0a 2020 2020 2020 2020 2020  path..          
+00049f30: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00049f40: 6f73 655f 736f 7572 6365 203d 205b 6461  ose_source = [da
+00049f50: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
+00049f60: 2c20 6461 7461 7365 742e 6461 7461 7365  , dataset.datase
+00049f70: 745f 6e61 6d65 2c20 6461 7461 7365 742e  t_name, dataset.
+00049f80: 6964 5f65 6e74 6974 795f 7479 7065 2c0d  id_entity_type,.
+00049f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049fb0: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+00049fc0: 2e69 645f 7061 7468 2c20 6461 7461 7365  .id_path, datase
+00049fd0: 742e 6d65 7461 5f6f 776e 6572 2c20 2227  t.meta_owner, "'
+00049fe0: 2220 2b20 7374 7228 6461 7461 7365 742e  " + str(dataset.
+00049ff0: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
+0004a000: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0004a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a020: 2020 2020 2020 2020 2020 2020 224e 554c              "NUL
+0004a030: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
+0004a040: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0004a050: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
+0004a060: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
+0004a070: 7428 5b63 6c6f 7365 5f73 6f75 7263 655d  t([close_source]
+0004a080: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004a090: 2020 2020 2020 2020 2020 2074 6d70 5f6c             tmp_l
+0004a0a0: 6f61 6465 642e 6170 7065 6e64 285b 6461  oaded.append([da
+0004a0b0: 7461 7365 742e 6461 7461 7365 745f 6e61  taset.dataset_na
+0004a0c0: 6d65 2c20 6461 7461 7365 742e 6964 5f65  me, dataset.id_e
+0004a0d0: 6e74 6974 795f 7479 7065 2c20 6461 7461  ntity_type, data
+0004a0e0: 7365 742e 6964 5f70 6174 685d 290d 0a20  set.id_path]).. 
+0004a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a100: 2020 2020 2020 2069 645f 6461 7461 7365         id_datase
+0004a110: 7420 3d20 6461 7461 7365 742e 6964 5f64  t = dataset.id_d
+0004a120: 6174 6173 6574 0d0a 0d0a 2020 2020 2020  ataset....      
+0004a130: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0004a140: 4966 2074 6865 2070 6174 6820 6f72 2074  If the path or t
+0004a150: 6865 2065 6e74 6974 7920 6861 7320 6368  he entity has ch
+0004a160: 616e 6765 642c 2074 6865 2061 6374 7561  anged, the actua
+0004a170: 6c20 6e65 6564 7320 746f 2062 6520 636c  l needs to be cl
+0004a180: 6f73 6564 2061 6e64 2061 6464 2074 6865  osed and add the
+0004a190: 2061 6374 7561 6c0d 0a20 2020 2020 2020   actual..       
+0004a1a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0004a1b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0004a1c0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+0004a1d0: 6461 7461 7365 742e 6964 5f65 6e74 6974  dataset.id_entit
+0004a1e0: 795f 7479 7065 2021 3d20 7365 6c66 2e6d  y_type != self.m
+0004a1f0: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0004a200: 6574 5f65 6e74 6974 795f 7479 7065 5f66  et_entity_type_f
+0004a210: 726f 6d5f 656e 7469 7479 5f74 7970 655f  rom_entity_type_
+0004a220: 6e61 6d65 2845 4e54 4954 595f 5352 4329  name(ENTITY_SRC)
+0004a230: 2e69 645f 656e 7469 7479 5f74 7970 6529  .id_entity_type)
+0004a240: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004a250: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004a260: 6c6f 7365 5f73 6f75 7263 6520 3d20 5b64  lose_source = [d
+0004a270: 6174 6173 6574 2e69 645f 6461 7461 7365  ataset.id_datase
+0004a280: 742c 2064 6174 6173 6574 2e64 6174 6173  t, dataset.datas
+0004a290: 6574 5f6e 616d 652c 2064 6174 6173 6574  et_name, dataset
+0004a2a0: 2e69 645f 656e 7469 7479 5f74 7970 652c  .id_entity_type,
+0004a2b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a2d0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0004a2e0: 7461 7365 742e 6964 5f70 6174 682c 2064  taset.id_path, d
+0004a2f0: 6174 6173 6574 2e6d 6574 615f 6f77 6e65  ataset.meta_owne
+0004a300: 722c 2022 2722 202b 2073 7472 2864 6174  r, "'" + str(dat
+0004a310: 6173 6574 2e73 7461 7274 5f64 6174 6529  aset.start_date)
+0004a320: 202b 2022 2722 2c0d 0a20 2020 2020 2020   + "'",..       
+0004a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a350: 2020 6e65 7874 5f69 645f 6461 7461 7365    next_id_datase
-0004a360: 745f 7370 6563 202b 3d20 310d 0a20 2020  t_spec += 1..   
-0004a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a380: 2020 2020 2069 645f 6b65 795f 7479 7065       id_key_type
-0004a390: 203d 2028 7365 6c66 2e6d 6574 6164 6174   = (self.metadat
-0004a3a0: 615f 6163 7475 616c 2e67 6574 5f6b 6579  a_actual.get_key
-0004a3b0: 5f74 7970 655f 6672 6f6d 5f6b 6579 5f74  _type_from_key_t
-0004a3c0: 7970 655f 6e61 6d65 2874 6162 6c65 5f64  ype_name(table_d
-0004a3d0: 6566 696e 6974 696f 6e5f 7370 6563 2e6b  efinition_spec.k
-0004a3e0: 6579 5f74 7970 6529 292e 6964 5f6b 6579  ey_type)).id_key
-0004a3f0: 5f74 7970 650d 0a20 2020 2020 2020 2020  _type..         
-0004a400: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004a410: 7461 7274 5f64 6174 6520 3d20 7365 6c66  tart_date = self
-0004a420: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
-0004a430: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
-0004a440: 5f76 616c 7565 2829 0d0a 2020 2020 2020  _value()..      
+0004a350: 2020 2020 2073 656c 662e 636f 6e6e 6563       self.connec
+0004a360: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
+0004a370: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
+0004a380: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
+0004a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a3a0: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+0004a3b0: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
+0004a3c0: 6173 6574 285b 636c 6f73 655f 736f 7572  aset([close_sour
+0004a3d0: 6365 5d29 0d0a 2020 2020 2020 2020 2020  ce])..          
+0004a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a3f0: 2020 746d 705f 6c6f 6164 6564 2e61 7070    tmp_loaded.app
+0004a400: 656e 6428 5b64 6174 6173 6574 2e64 6174  end([dataset.dat
+0004a410: 6173 6574 5f6e 616d 652c 2064 6174 6173  aset_name, datas
+0004a420: 6574 2e69 645f 656e 7469 7479 5f74 7970  et.id_entity_typ
+0004a430: 652c 2064 6174 6173 6574 2e69 645f 7061  e, dataset.id_pa
+0004a440: 7468 5d29 0d0a 0d0a 2020 2020 2020 2020  th])....        
 0004a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a460: 2020 656e 645f 6461 7465 203d 2022 4e55    end_date = "NU
-0004a470: 4c4c 220d 0a0d 0a20 2020 2020 2020 2020  LL"....         
-0004a480: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0004a490: 6577 5f64 6174 6173 6574 5f73 7065 6369  ew_dataset_speci
-0004a4a0: 6669 6361 7469 6f6e 203d 205b 6964 5f64  fication = [id_d
-0004a4b0: 6174 6173 6574 5f73 7065 632c 2069 645f  ataset_spec, id_
-0004a4c0: 6461 7461 7365 742c 2069 645f 6b65 795f  dataset, id_key_
-0004a4d0: 7479 7065 2c0d 0a20 2020 2020 2020 2020  type,..         
-0004a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a500: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-0004a510: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
-0004a520: 632e 636f 6c75 6d6e 5f6e 616d 652c 0d0a  c.column_name,..
+0004a460: 6964 5f64 6174 6173 6574 203d 206e 6578  id_dataset = nex
+0004a470: 745f 6964 5f64 6174 6173 6574 0d0a 2020  t_id_dataset..  
+0004a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a490: 2020 2020 2020 6e65 7874 5f69 645f 6461        next_id_da
+0004a4a0: 7461 7365 7420 2b3d 2031 0d0a 2020 2020  taset += 1..    
+0004a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a4c0: 2020 2020 6964 5f70 6174 6820 3d20 2873      id_path = (s
+0004a4d0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+0004a4e0: 6c6f 6164 2e67 6574 5f70 6174 685f 6672  load.get_path_fr
+0004a4f0: 6f6d 5f64 6174 6162 6173 655f 616e 645f  om_database_and_
+0004a500: 7363 6865 6d61 2865 6e74 7279 5f70 6174  schema(entry_pat
+0004a510: 682e 6461 7461 6261 7365 5f6e 616d 652c  h.database_name,
+0004a520: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0004a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a560: 2020 2020 2074 6162 6c65 5f64 6566 696e       table_defin
-0004a570: 6974 696f 6e5f 7370 6563 2e63 6f6c 756d  ition_spec.colum
-0004a580: 6e5f 7479 7065 2c20 7461 626c 655f 6465  n_type, table_de
-0004a590: 6669 6e69 7469 6f6e 5f73 7065 632e 6964  finition_spec.id
-0004a5a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a5d0: 2020 2020 2020 2020 7461 626c 655f 6465          table_de
-0004a5e0: 6669 6e69 7469 6f6e 5f73 7065 632e 6973  finition_spec.is
-0004a5f0: 5f6e 756c 6c61 626c 652c 2074 6162 6c65  _nullable, table
-0004a600: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-0004a610: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-0004a620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a650: 2020 2020 2020 7461 626c 655f 6465 6669        table_defi
-0004a660: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
-0004a670: 6d6e 5f70 7265 6369 7369 6f6e 2c20 7461  mn_precision, ta
-0004a680: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
-0004a690: 7065 632e 636f 6c75 6d6e 5f73 6361 6c65  pec.column_scale
-0004a6a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a570: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+0004a580: 7279 5f70 6174 682e 7363 6865 6d61 5f6e  ry_path.schema_n
+0004a590: 616d 6529 292e 6964 5f70 6174 680d 0a20  ame)).id_path.. 
+0004a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a5b0: 2020 2020 2020 2075 7064 6174 6564 5f73         updated_s
+0004a5c0: 6f75 7263 6520 3d20 5b69 645f 6461 7461  ource = [id_data
+0004a5d0: 7365 742c 2064 6174 6173 6574 2e64 6174  set, dataset.dat
+0004a5e0: 6173 6574 5f6e 616d 652c 0d0a 2020 2020  aset_name,..    
+0004a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a610: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0004a620: 615f 6163 7475 616c 2e67 6574 5f65 6e74  a_actual.get_ent
+0004a630: 6974 795f 7479 7065 5f66 726f 6d5f 656e  ity_type_from_en
+0004a640: 7469 7479 5f74 7970 655f 6e61 6d65 280d  tity_type_name(.
+0004a650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a670: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+0004a680: 6974 792e 656e 7469 7479 5f74 7970 6529  ity.entity_type)
+0004a690: 2e69 645f 656e 7469 7479 5f74 7970 652c  .id_entity_type,
+0004a6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0004a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a6d0: 2020 2020 2020 2020 7365 6c66 2e6f 776e          self.own
-0004a6e0: 6572 2c20 7374 6172 745f 6461 7465 2c20  er, start_date, 
-0004a6f0: 656e 645f 6461 7465 5d0d 0a20 2020 2020  end_date]..     
-0004a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a710: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0004a720: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-0004a730: 6461 7461 7365 745f 7370 6563 6966 6963  dataset_specific
-0004a740: 6174 696f 6e28 5b6e 6577 5f64 6174 6173  ation([new_datas
-0004a750: 6574 5f73 7065 6369 6669 6361 7469 6f6e  et_specification
-0004a760: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0004a770: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
-0004a780: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
-0004a790: 656e 6428 5b69 645f 6461 7461 7365 742c  end([id_dataset,
-0004a7a0: 2074 6162 6c65 5f64 6566 696e 6974 696f   table_definitio
-0004a7b0: 6e5f 7370 6563 2e63 6f6c 756d 6e5f 6e61  n_spec.column_na
-0004a7c0: 6d65 5d29 0d0a 0d0a 2020 2020 2020 2020  me])....        
-0004a7d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0004a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a7f0: 2020 2023 2053 6f75 7263 6520 7370 6563     # Source spec
-0004a800: 6966 6963 6174 696f 6e20 6578 6973 7465  ification existe
-0004a810: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-0004a820: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
-0004a830: 2061 6e79 2063 6f6c 756d 6e0d 0a20 2020   any column..   
-0004a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a850: 2066 6f72 2065 7869 7374 656e 745f 636f   for existent_co
-0004a860: 6c20 696e 205b 7820 666f 7220 7820 696e  l in [x for x in
-0004a870: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0004a880: 6374 7561 6c2e 6f6d 5f64 6174 6173 6574  ctual.om_dataset
-0004a890: 5f73 7065 6369 6669 6361 7469 6f6e 2069  _specification i
-0004a8a0: 6620 782e 6964 5f64 6174 6173 6574 203d  f x.id_dataset =
-0004a8b0: 3d20 6461 7461 7365 742e 6964 5f64 6174  = dataset.id_dat
-0004a8c0: 6173 6574 2061 6e64 2078 2e65 6e64 5f64  aset and x.end_d
-0004a8d0: 6174 6520 6973 204e 6f6e 655d 3a0d 0a20  ate is None]:.. 
-0004a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a8f0: 2020 2020 2020 2066 696e 6465 6420 3d20         finded = 
-0004a900: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-0004a910: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004a920: 6f72 2074 6162 6c65 5f64 6566 696e 6974  or table_definit
-0004a930: 696f 6e5f 7370 6563 2069 6e20 7461 626c  ion_spec in tabl
-0004a940: 655f 6465 6669 6e69 7469 6f6e 3a0d 0a20  e_definition:.. 
-0004a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a960: 2020 2020 2020 2020 2020 2069 645f 6b65             id_ke
-0004a970: 795f 7479 7065 203d 2028 7365 6c66 2e6d  y_type = (self.m
-0004a980: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0004a990: 6574 5f6b 6579 5f74 7970 655f 6672 6f6d  et_key_type_from
-0004a9a0: 5f6b 6579 5f74 7970 655f 6e61 6d65 2874  _key_type_name(t
-0004a9b0: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-0004a9c0: 7370 6563 2e6b 6579 5f74 7970 6529 292e  spec.key_type)).
-0004a9d0: 6964 5f6b 6579 5f74 7970 650d 0a0d 0a20  id_key_type.... 
-0004a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a9f0: 2020 2020 2020 2020 2020 2063 6865 636b             check
-0004aa00: 7375 6d5f 6578 6973 7465 6e74 203d 2073  sum_existent = s
-0004aa10: 7472 280d 0a20 2020 2020 2020 2020 2020  tr(..           
-0004aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aa30: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
-0004aa40: 6c2e 6964 5f6b 6579 5f74 7970 6529 202b  l.id_key_type) +
-0004aa50: 2065 7869 7374 656e 745f 636f 6c2e 636f   existent_col.co
-0004aa60: 6c75 6d6e 5f6e 616d 6520 2b20 6578 6973  lumn_name + exis
-0004aa70: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
-0004aa80: 7479 7065 202b 205c 0d0a 2020 2020 2020  type + \..      
-0004aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aab0: 2020 2020 2020 2020 2020 7374 7228 6578            str(ex
-0004aac0: 6973 7465 6e74 5f63 6f6c 2e6f 7264 696e  istent_col.ordin
-0004aad0: 616c 5f70 6f73 6974 696f 6e29 202b 2073  al_position) + s
-0004aae0: 7472 280d 0a20 2020 2020 2020 2020 2020  tr(..           
-0004aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ab00: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
-0004ab10: 6c2e 6973 5f6e 756c 6c61 626c 6529 202b  l.is_nullable) +
-0004ab20: 2073 7472 2865 7869 7374 656e 745f 636f   str(existent_co
-0004ab30: 6c2e 636f 6c75 6d6e 5f6c 656e 6774 6829  l.column_length)
-0004ab40: 202b 205c 0d0a 2020 2020 2020 2020 2020   + \..          
-0004ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ab70: 2020 2020 2020 7374 7228 6578 6973 7465        str(existe
-0004ab80: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7072  nt_col.column_pr
-0004ab90: 6563 6973 696f 6e29 202b 2073 7472 2865  ecision) + str(e
-0004aba0: 7869 7374 656e 745f 636f 6c2e 636f 6c75  xistent_col.colu
-0004abb0: 6d6e 5f73 6361 6c65 290d 0a20 2020 2020  mn_scale)..     
-0004abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004abd0: 2020 2020 2020 2063 6865 636b 7375 6d5f         checksum_
-0004abe0: 6e65 7720 3d20 7374 7228 0d0a 2020 2020  new = str(..    
-0004abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac00: 2020 2020 2020 2020 2020 2020 6964 5f6b              id_k
-0004ac10: 6579 5f74 7970 6529 202b 2074 6162 6c65  ey_type) + table
-0004ac20: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-0004ac30: 2e63 6f6c 756d 6e5f 6e61 6d65 202b 2074  .column_name + t
-0004ac40: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-0004ac50: 7370 6563 2e63 6f6c 756d 6e5f 7479 7065  spec.column_type
-0004ac60: 202b 205c 0d0a 2020 2020 2020 2020 2020   + \..          
-0004ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ac90: 2073 7472 2874 6162 6c65 5f64 6566 696e   str(table_defin
-0004aca0: 6974 696f 6e5f 7370 6563 2e69 6429 202b  ition_spec.id) +
-0004acb0: 2073 7472 2874 6162 6c65 5f64 6566 696e   str(table_defin
-0004acc0: 6974 696f 6e5f 7370 6563 2e69 735f 6e75  ition_spec.is_nu
-0004acd0: 6c6c 6162 6c65 2920 2b20 7374 7228 0d0a  llable) + str(..
-0004ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a6c0: 2020 2020 2020 2020 2020 6964 5f70 6174            id_pat
+0004a6d0: 682c 2064 6174 6173 6574 2e6d 6574 615f  h, dataset.meta_
+0004a6e0: 6f77 6e65 722c 2073 656c 662e 636f 6e6e  owner, self.conn
+0004a6f0: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
+0004a700: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
+0004a710: 6528 292c 0d0a 2020 2020 2020 2020 2020  e(),..          
+0004a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a730: 2020 2020 2020 2020 2020 2020 2020 224e                "N
+0004a740: 554c 4c22 5d0d 0a20 2020 2020 2020 2020  ULL"]..         
+0004a750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004a760: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+0004a770: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+0004a780: 7365 7428 5b75 7064 6174 6564 5f73 6f75  set([updated_sou
+0004a790: 7263 655d 290d 0a20 2020 2020 2020 2020  rce])..         
+0004a7a0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0004a7b0: 6174 6173 6574 203d 2073 656c 662e 6d65  ataset = self.me
+0004a7c0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e67  tadata_to_load.g
+0004a7d0: 6574 5f64 6174 6173 6574 5f66 726f 6d5f  et_dataset_from_
+0004a7e0: 6461 7461 7365 745f 6e61 6d65 2864 6174  dataset_name(dat
+0004a7f0: 6173 6574 2e64 6174 6173 6574 5f6e 616d  aset.dataset_nam
+0004a800: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0004a810: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
+0004a820: 6c6f 6164 6564 2e61 7070 656e 6428 5b64  loaded.append([d
+0004a830: 6174 6173 6574 2e64 6174 6173 6574 5f6e  ataset.dataset_n
+0004a840: 616d 652c 2064 6174 6173 6574 2e69 645f  ame, dataset.id_
+0004a850: 656e 7469 7479 5f74 7970 652c 2069 645f  entity_type, id_
+0004a860: 7061 7468 5d29 0d0a 0d0a 2020 2020 2020  path])....      
+0004a870: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+0004a880: 4461 7461 7365 7420 5370 6563 6966 6963  Dataset Specific
+0004a890: 6174 696f 6e73 2066 726f 6d20 4461 7461  ations from Data
+0004a8a0: 2044 6174 6162 6173 650d 0a20 2020 2020   Database..     
+0004a8b0: 2020 2020 2020 2020 2020 2076 6172 6961             varia
+0004a8c0: 626c 655f 636f 6e6e 6563 7469 6f6e 203d  ble_connection =
+0004a8d0: 2073 656c 662e 636f 6e66 6967 7572 6174   self.configurat
+0004a8e0: 696f 6e5f 6669 6c65 5b27 6461 7461 275d  ion_file['data']
+0004a8f0: 5b27 636f 6e6e 6563 7469 6f6e 5f74 7970  ['connection_typ
+0004a900: 6527 5d2e 6c6f 7765 7228 2920 2b20 225f  e'].lower() + "_
+0004a910: 6461 7461 6261 7365 220d 0a20 2020 2020  database"..     
+0004a920: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+0004a930: 6775 7261 7469 6f6e 5f63 6f6e 6e65 6374  guration_connect
+0004a940: 696f 6e5f 6461 7461 203d 2073 656c 662e  ion_data = self.
+0004a950: 636f 6e66 6967 7572 6174 696f 6e5f 6669  configuration_fi
+0004a960: 6c65 5b27 6461 7461 275d 0d0a 2020 2020  le['data']..    
+0004a970: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0004a980: 6967 7572 6174 696f 6e5f 636f 6e6e 6563  iguration_connec
+0004a990: 7469 6f6e 5f64 6174 615b 7661 7269 6162  tion_data[variab
+0004a9a0: 6c65 5f63 6f6e 6e65 6374 696f 6e5d 203d  le_connection] =
+0004a9b0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+0004a9c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0004a9d0: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
+0004a9e0: 745f 7061 7468 5f66 726f 6d5f 6964 5f70  t_path_from_id_p
+0004a9f0: 6174 6828 6964 5f70 6174 6829 292e 6461  ath(id_path)).da
+0004aa00: 7461 6261 7365 5f6e 616d 650d 0a20 2020  tabase_name..   
+0004aa10: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0004aa20: 656c 662e 636f 6e6e 6563 7469 6f6e 2e73  elf.connection.s
+0004aa30: 6574 7570 5f63 6f6e 6e65 6374 696f 6e28  etup_connection(
+0004aa40: 636f 6e66 6967 7572 6174 696f 6e5f 636f  configuration_co
+0004aa50: 6e6e 6563 7469 6f6e 5f64 6174 612c 2073  nnection_data, s
+0004aa60: 656c 662e 6c6f 6729 0d0a 2020 2020 2020  elf.log)..      
+0004aa70: 2020 2020 2020 2020 2020 7461 626c 655f            table_
+0004aa80: 6465 6669 6e69 7469 6f6e 203d 2073 656c  definition = sel
+0004aa90: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0004aaa0: 6c2e 6765 745f 636f 6c73 5f66 726f 6d5f  l.get_cols_from_
+0004aab0: 636f 645f 656e 7469 7479 5f6f 6e5f 656e  cod_entity_on_en
+0004aac0: 7472 7928 656e 7469 7479 2e63 6f64 5f65  try(entity.cod_e
+0004aad0: 6e74 6974 7929 0d0a 2020 2020 2020 2020  ntity)..        
+0004aae0: 2020 2020 2020 2020 2320 536f 7572 6365          # Source
+0004aaf0: 2053 7065 6369 6669 6361 7469 6f6e 0d0a   Specification..
+0004ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ab10: 6966 2064 6174 6173 6574 2069 7320 4e6f  if dataset is No
+0004ab20: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004ab30: 2020 2020 2020 2020 2023 204e 6577 2053           # New S
+0004ab40: 6f75 7263 6573 2053 7065 6369 6669 6361  ources Specifica
+0004ab50: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
+0004ab60: 2020 2020 2020 2020 2020 666f 7220 7461            for ta
+0004ab70: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
+0004ab80: 7065 6320 696e 2074 6162 6c65 5f64 6566  pec in table_def
+0004ab90: 696e 6974 696f 6e3a 0d0a 2020 2020 2020  inition:..      
+0004aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004abb0: 2020 6964 5f64 6174 6173 6574 5f73 7065    id_dataset_spe
+0004abc0: 6320 3d20 6e65 7874 5f69 645f 6461 7461  c = next_id_data
+0004abd0: 7365 745f 7370 6563 0d0a 2020 2020 2020  set_spec..      
+0004abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004abf0: 2020 6e65 7874 5f69 645f 6461 7461 7365    next_id_datase
+0004ac00: 745f 7370 6563 202b 3d20 310d 0a20 2020  t_spec += 1..   
+0004ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ac20: 2020 2020 2069 645f 6b65 795f 7479 7065       id_key_type
+0004ac30: 203d 2028 7365 6c66 2e6d 6574 6164 6174   = (self.metadat
+0004ac40: 615f 6163 7475 616c 2e67 6574 5f6b 6579  a_actual.get_key
+0004ac50: 5f74 7970 655f 6672 6f6d 5f6b 6579 5f74  _type_from_key_t
+0004ac60: 7970 655f 6e61 6d65 2874 6162 6c65 5f64  ype_name(table_d
+0004ac70: 6566 696e 6974 696f 6e5f 7370 6563 2e6b  efinition_spec.k
+0004ac80: 6579 5f74 7970 6529 292e 6964 5f6b 6579  ey_type)).id_key
+0004ac90: 5f74 7970 650d 0a20 2020 2020 2020 2020  _type..         
+0004aca0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004acb0: 7461 7274 5f64 6174 6520 3d20 7365 6c66  tart_date = self
+0004acc0: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
+0004acd0: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
+0004ace0: 5f76 616c 7565 2829 0d0a 2020 2020 2020  _value()..      
 0004acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad00: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
-0004ad10: 5f73 7065 632e 636f 6c75 6d6e 5f6c 656e  _spec.column_len
-0004ad20: 6774 6829 202b 2073 7472 2874 6162 6c65  gth) + str(table
-0004ad30: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-0004ad40: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
-0004ad50: 6e29 202b 2073 7472 280d 0a20 2020 2020  n) + str(..     
-0004ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ad70: 2020 2020 2020 2020 2020 2074 6162 6c65             table
-0004ad80: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-0004ad90: 2e63 6f6c 756d 6e5f 7363 616c 6529 0d0a  .column_scale)..
-0004ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004adb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0004adc0: 6865 636b 7375 6d5f 6e65 7720 3d3d 2063  hecksum_new == c
-0004add0: 6865 636b 7375 6d5f 6578 6973 7465 6e74  hecksum_existent
-0004ade0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004ad00: 2020 656e 645f 6461 7465 203d 2022 4e55    end_date = "NU
+0004ad10: 4c4c 220d 0a0d 0a20 2020 2020 2020 2020  LL"....         
+0004ad20: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0004ad30: 6577 5f64 6174 6173 6574 5f73 7065 6369  ew_dataset_speci
+0004ad40: 6669 6361 7469 6f6e 203d 205b 6964 5f64  fication = [id_d
+0004ad50: 6174 6173 6574 5f73 7065 632c 2069 645f  ataset_spec, id_
+0004ad60: 6461 7461 7365 742c 2069 645f 6b65 795f  dataset, id_key_
+0004ad70: 7479 7065 2c0d 0a20 2020 2020 2020 2020  type,..         
+0004ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ada0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+0004adb0: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
+0004adc0: 632e 636f 6c75 6d6e 5f6e 616d 652c 0d0a  c.column_name,..
+0004add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae00: 2020 2066 696e 6465 6420 3d20 5472 7565     finded = True
-0004ae10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae30: 2020 2320 436f 6c75 6d6e 2074 6861 7420    # Column that 
-0004ae40: 6578 6973 7473 2061 6c72 6561 6479 2c20  exists already, 
-0004ae50: 6966 206f 6e20 6f72 6967 696e 2069 7320  if on origin is 
-0004ae60: 7468 6520 7361 6d65 2c20 7765 206d 6169  the same, we mai
-0004ae70: 6e74 6169 6e20 616c 6c20 7468 6520 696e  ntain all the in
-0004ae80: 666f 0d0a 2020 2020 2020 2020 2020 2020  fo..            
-0004ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aea0: 2020 2020 636c 6f73 655f 6461 7461 7365      close_datase
-0004aeb0: 745f 7370 6563 6966 6963 6174 696f 6e20  t_specification 
-0004aec0: 3d20 5b65 7869 7374 656e 745f 636f 6c2e  = [existent_col.
-0004aed0: 6964 5f64 6174 6173 6574 5f73 7065 632c  id_dataset_spec,
-0004aee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af20: 2064 6174 6173 6574 2e69 645f 6461 7461   dataset.id_data
-0004af30: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
-0004af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ae00: 2020 2020 2074 6162 6c65 5f64 6566 696e       table_defin
+0004ae10: 6974 696f 6e5f 7370 6563 2e63 6f6c 756d  ition_spec.colum
+0004ae20: 6e5f 7479 7065 2c20 7461 626c 655f 6465  n_type, table_de
+0004ae30: 6669 6e69 7469 6f6e 5f73 7065 632e 6964  finition_spec.id
+0004ae40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ae70: 2020 2020 2020 2020 7461 626c 655f 6465          table_de
+0004ae80: 6669 6e69 7469 6f6e 5f73 7065 632e 6973  finition_spec.is
+0004ae90: 5f6e 756c 6c61 626c 652c 2074 6162 6c65  _nullable, table
+0004aea0: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+0004aeb0: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+0004aec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004aef0: 2020 2020 2020 7461 626c 655f 6465 6669        table_defi
+0004af00: 6e69 7469 6f6e 5f73 7065 632e 636f 6c75  nition_spec.colu
+0004af10: 6d6e 5f70 7265 6369 7369 6f6e 2c20 7461  mn_precision, ta
+0004af20: 626c 655f 6465 6669 6e69 7469 6f6e 5f73  ble_definition_s
+0004af30: 7065 632e 636f 6c75 6d6e 5f73 6361 6c65  pec.column_scale
+0004af40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0004af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004af70: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
-0004af80: 6c2e 6964 5f6b 6579 5f74 7970 652c 0d0a  l.id_key_type,..
-0004af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004af70: 2020 2020 2020 2020 7365 6c66 2e6f 776e          self.own
+0004af80: 6572 2c20 7374 6172 745f 6461 7465 2c20  er, start_date, 
+0004af90: 656e 645f 6461 7465 5d0d 0a20 2020 2020  end_date]..     
 0004afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004afc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004afd0: 7869 7374 656e 745f 636f 6c2e 636f 6c75  xistent_col.colu
-0004afe0: 6d6e 5f6e 616d 652c 0d0a 2020 2020 2020  mn_name,..      
-0004aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b020: 2020 2020 2020 2020 2065 7869 7374 656e           existen
-0004b030: 745f 636f 6c2e 636f 6c75 6d6e 5f74 7970  t_col.column_typ
-0004b040: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0004b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b080: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
-0004b090: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
-0004b0a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0e0: 2020 6578 6973 7465 6e74 5f63 6f6c 2e69    existent_col.i
-0004b0f0: 735f 6e75 6c6c 6162 6c65 2c0d 0a20 2020  s_nullable,..   
-0004b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b130: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-0004b140: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
-0004b150: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0004b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004afb0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0004afc0: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+0004afd0: 6461 7461 7365 745f 7370 6563 6966 6963  dataset_specific
+0004afe0: 6174 696f 6e28 5b6e 6577 5f64 6174 6173  ation([new_datas
+0004aff0: 6574 5f73 7065 6369 6669 6361 7469 6f6e  et_specification
+0004b000: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0004b010: 2020 2020 2020 2020 2020 2020 746d 705f              tmp_
+0004b020: 7370 6563 735f 6c6f 6164 6564 2e61 7070  specs_loaded.app
+0004b030: 656e 6428 5b69 645f 6461 7461 7365 742c  end([id_dataset,
+0004b040: 2074 6162 6c65 5f64 6566 696e 6974 696f   table_definitio
+0004b050: 6e5f 7370 6563 2e63 6f6c 756d 6e5f 6e61  n_spec.column_na
+0004b060: 6d65 5d29 0d0a 0d0a 2020 2020 2020 2020  me])....        
+0004b070: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0004b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b090: 2020 2023 2053 6f75 7263 6520 7370 6563     # Source spec
+0004b0a0: 6966 6963 6174 696f 6e20 6578 6973 7465  ification existe
+0004b0b0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
+0004b0c0: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
+0004b0d0: 2061 6e79 2063 6f6c 756d 6e0d 0a20 2020   any column..   
+0004b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b0f0: 2066 6f72 2065 7869 7374 656e 745f 636f   for existent_co
+0004b100: 6c20 696e 205b 7820 666f 7220 7820 696e  l in [x for x in
+0004b110: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0004b120: 6374 7561 6c2e 6f6d 5f64 6174 6173 6574  ctual.om_dataset
+0004b130: 5f73 7065 6369 6669 6361 7469 6f6e 2069  _specification i
+0004b140: 6620 782e 6964 5f64 6174 6173 6574 203d  f x.id_dataset =
+0004b150: 3d20 6461 7461 7365 742e 6964 5f64 6174  = dataset.id_dat
+0004b160: 6173 6574 2061 6e64 2078 2e65 6e64 5f64  aset and x.end_d
+0004b170: 6174 6520 6973 204e 6f6e 655d 3a0d 0a20  ate is None]:.. 
 0004b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b190: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
-0004b1a0: 5f63 6f6c 2e63 6f6c 756d 6e5f 7072 6563  _col.column_prec
-0004b1b0: 6973 696f 6e2c 2065 7869 7374 656e 745f  ision, existent_
-0004b1c0: 636f 6c2e 636f 6c75 6d6e 5f73 6361 6c65  col.column_scale
-0004b1d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b190: 2020 2020 2020 2066 696e 6465 6420 3d20         finded = 
+0004b1a0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0004b1b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004b1c0: 6f72 2074 6162 6c65 5f64 6566 696e 6974  or table_definit
+0004b1d0: 696f 6e5f 7370 6563 2069 6e20 7461 626c  ion_spec in tabl
+0004b1e0: 655f 6465 6669 6e69 7469 6f6e 3a0d 0a20  e_definition:.. 
 0004b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b210: 2020 6578 6973 7465 6e74 5f63 6f6c 2e6d    existent_col.m
-0004b220: 6574 615f 6f77 6e65 722c 0d0a 2020 2020  eta_owner,..    
-0004b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b260: 2020 2020 2020 2020 2020 2022 2722 202b             "'" +
-0004b270: 2073 7472 2865 7869 7374 656e 745f 636f   str(existent_co
-0004b280: 6c2e 7374 6172 745f 6461 7465 2920 2b20  l.start_date) + 
-0004b290: 2227 222c 0d0a 2020 2020 2020 2020 2020  "'",..          
-0004b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b200: 2020 2020 2020 2020 2020 2069 645f 6b65             id_ke
+0004b210: 795f 7479 7065 203d 2028 7365 6c66 2e6d  y_type = (self.m
+0004b220: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0004b230: 6574 5f6b 6579 5f74 7970 655f 6672 6f6d  et_key_type_from
+0004b240: 5f6b 6579 5f74 7970 655f 6e61 6d65 2874  _key_type_name(t
+0004b250: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+0004b260: 7370 6563 2e6b 6579 5f74 7970 6529 292e  spec.key_type)).
+0004b270: 6964 5f6b 6579 5f74 7970 650d 0a0d 0a20  id_key_type.... 
+0004b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b290: 2020 2020 2020 2020 2020 2063 6865 636b             check
+0004b2a0: 7375 6d5f 6578 6973 7465 6e74 203d 2073  sum_existent = s
+0004b2b0: 7472 280d 0a20 2020 2020 2020 2020 2020  tr(..           
 0004b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2d0: 2020 2020 2022 4e55 4c4c 225d 0d0a 2020       "NULL"]..  
-0004b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b2f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004b300: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-0004b310: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
-0004b320: 6574 5f73 7065 6369 6669 6361 7469 6f6e  et_specification
-0004b330: 285b 636c 6f73 655f 6461 7461 7365 745f  ([close_dataset_
-0004b340: 7370 6563 6966 6963 6174 696f 6e5d 290d  specification]).
-0004b350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b370: 2074 6d70 5f73 7065 6373 5f6c 6f61 6465   tmp_specs_loade
-0004b380: 642e 6170 7065 6e64 285b 6461 7461 7365  d.append([datase
-0004b390: 742e 6964 5f64 6174 6173 6574 2c20 6578  t.id_dataset, ex
-0004b3a0: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
-0004b3b0: 6e5f 6e61 6d65 5d29 0d0a 0d0a 2020 2020  n_name])....    
-0004b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b3d0: 2020 2020 2320 436f 6c75 6d6e 2074 6861      # Column tha
-0004b3e0: 7420 6973 206e 6f20 6d6f 7265 206f 6e20  t is no more on 
-0004b3f0: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
+0004b2d0: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
+0004b2e0: 6c2e 6964 5f6b 6579 5f74 7970 6529 202b  l.id_key_type) +
+0004b2f0: 2065 7869 7374 656e 745f 636f 6c2e 636f   existent_col.co
+0004b300: 6c75 6d6e 5f6e 616d 6520 2b20 6578 6973  lumn_name + exis
+0004b310: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
+0004b320: 7479 7065 202b 205c 0d0a 2020 2020 2020  type + \..      
+0004b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b350: 2020 2020 2020 2020 2020 7374 7228 6578            str(ex
+0004b360: 6973 7465 6e74 5f63 6f6c 2e6f 7264 696e  istent_col.ordin
+0004b370: 616c 5f70 6f73 6974 696f 6e29 202b 2073  al_position) + s
+0004b380: 7472 280d 0a20 2020 2020 2020 2020 2020  tr(..           
+0004b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b3a0: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
+0004b3b0: 6c2e 6973 5f6e 756c 6c61 626c 6529 202b  l.is_nullable) +
+0004b3c0: 2073 7472 2865 7869 7374 656e 745f 636f   str(existent_co
+0004b3d0: 6c2e 636f 6c75 6d6e 5f6c 656e 6774 6829  l.column_length)
+0004b3e0: 202b 205c 0d0a 2020 2020 2020 2020 2020   + \..          
+0004b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b410: 6966 206e 6f74 2066 696e 6465 643a 0d0a  if not finded:..
-0004b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b430: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-0004b440: 655f 6461 7461 7365 745f 7370 6563 6966  e_dataset_specif
-0004b450: 6963 6174 696f 6e20 3d20 5b65 7869 7374  ication = [exist
-0004b460: 656e 745f 636f 6c2e 6964 5f64 6174 6173  ent_col.id_datas
-0004b470: 6574 5f73 7065 632c 2065 7869 7374 656e  et_spec, existen
-0004b480: 745f 636f 6c2e 6964 5f64 6174 6173 6574  t_col.id_dataset
-0004b490: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0004b4d0: 6973 7465 6e74 5f63 6f6c 2e69 645f 6b65  istent_col.id_ke
-0004b4e0: 795f 7479 7065 2c0d 0a20 2020 2020 2020  y_type,..       
-0004b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b410: 2020 2020 2020 7374 7228 6578 6973 7465        str(existe
+0004b420: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7072  nt_col.column_pr
+0004b430: 6563 6973 696f 6e29 202b 2073 7472 2865  ecision) + str(e
+0004b440: 7869 7374 656e 745f 636f 6c2e 636f 6c75  xistent_col.colu
+0004b450: 6d6e 5f73 6361 6c65 290d 0a20 2020 2020  mn_scale)..     
+0004b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b470: 2020 2020 2020 2063 6865 636b 7375 6d5f         checksum_
+0004b480: 6e65 7720 3d20 7374 7228 0d0a 2020 2020  new = str(..    
+0004b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4a0: 2020 2020 2020 2020 2020 2020 6964 5f6b              id_k
+0004b4b0: 6579 5f74 7970 6529 202b 2074 6162 6c65  ey_type) + table
+0004b4c0: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+0004b4d0: 2e63 6f6c 756d 6e5f 6e61 6d65 202b 2074  .column_name + t
+0004b4e0: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+0004b4f0: 7370 6563 2e63 6f6c 756d 6e5f 7479 7065  spec.column_type
+0004b500: 202b 205c 0d0a 2020 2020 2020 2020 2020   + \..          
 0004b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b520: 2020 2020 6578 6973 7465 6e74 5f63 6f6c      existent_col
-0004b530: 2e63 6f6c 756d 6e5f 6e61 6d65 2c0d 0a20  .column_name,.. 
-0004b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b570: 2020 2020 2020 2020 2020 6578 6973 7465            existe
-0004b580: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7479  nt_col.column_ty
-0004b590: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
-0004b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b5d0: 6578 6973 7465 6e74 5f63 6f6c 2e6f 7264  existent_col.ord
-0004b5e0: 696e 616c 5f70 6f73 6974 696f 6e2c 2065  inal_position, e
-0004b5f0: 7869 7374 656e 745f 636f 6c2e 6973 5f6e  xistent_col.is_n
-0004b600: 756c 6c61 626c 652c 0d0a 2020 2020 2020  ullable,..      
-0004b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b640: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
-0004b650: 6c2e 636f 6c75 6d6e 5f6c 656e 6774 682c  l.column_length,
-0004b660: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b690: 2020 2020 2020 2020 2020 2020 2065 7869               exi
-0004b6a0: 7374 656e 745f 636f 6c2e 636f 6c75 6d6e  stent_col.column
-0004b6b0: 5f70 7265 6369 7369 6f6e 2c20 6578 6973  _precision, exis
-0004b6c0: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
-0004b6d0: 7363 616c 652c 0d0a 2020 2020 2020 2020  scale,..        
-0004b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b710: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
-0004b720: 6d65 7461 5f6f 776e 6572 2c0d 0a20 2020  meta_owner,..   
+0004b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b530: 2073 7472 2874 6162 6c65 5f64 6566 696e   str(table_defin
+0004b540: 6974 696f 6e5f 7370 6563 2e69 6429 202b  ition_spec.id) +
+0004b550: 2073 7472 2874 6162 6c65 5f64 6566 696e   str(table_defin
+0004b560: 6974 696f 6e5f 7370 6563 2e69 735f 6e75  ition_spec.is_nu
+0004b570: 6c6c 6162 6c65 2920 2b20 7374 7228 0d0a  llable) + str(..
+0004b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b5a0: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
+0004b5b0: 5f73 7065 632e 636f 6c75 6d6e 5f6c 656e  _spec.column_len
+0004b5c0: 6774 6829 202b 2073 7472 2874 6162 6c65  gth) + str(table
+0004b5d0: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+0004b5e0: 2e63 6f6c 756d 6e5f 7072 6563 6973 696f  .column_precisio
+0004b5f0: 6e29 202b 2073 7472 280d 0a20 2020 2020  n) + str(..     
+0004b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b610: 2020 2020 2020 2020 2020 2074 6162 6c65             table
+0004b620: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+0004b630: 2e63 6f6c 756d 6e5f 7363 616c 6529 0d0a  .column_scale)..
+0004b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b650: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0004b660: 6865 636b 7375 6d5f 6e65 7720 3d3d 2063  hecksum_new == c
+0004b670: 6865 636b 7375 6d5f 6578 6973 7465 6e74  hecksum_existent
+0004b680: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b6a0: 2020 2066 696e 6465 6420 3d20 5472 7565     finded = True
+0004b6b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b6d0: 2020 2320 436f 6c75 6d6e 2074 6861 7420    # Column that 
+0004b6e0: 6578 6973 7473 2061 6c72 6561 6479 2c20  exists already, 
+0004b6f0: 6966 206f 6e20 6f72 6967 696e 2069 7320  if on origin is 
+0004b700: 7468 6520 7361 6d65 2c20 7765 206d 6169  the same, we mai
+0004b710: 6e74 6169 6e20 616c 6c20 7468 6520 696e  ntain all the in
+0004b720: 666f 0d0a 2020 2020 2020 2020 2020 2020  fo..            
 0004b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b760: 2020 2020 2020 2020 2227 2220 2b20 7374          "'" + st
-0004b770: 7228 6578 6973 7465 6e74 5f63 6f6c 2e73  r(existent_col.s
-0004b780: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
-0004b790: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004b740: 2020 2020 636c 6f73 655f 6461 7461 7365      close_datase
+0004b750: 745f 7370 6563 6966 6963 6174 696f 6e20  t_specification 
+0004b760: 3d20 5b65 7869 7374 656e 745f 636f 6c2e  = [existent_col.
+0004b770: 6964 5f64 6174 6173 6574 5f73 7065 632c  id_dataset_spec,
+0004b780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b7c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004b7d0: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-0004b7e0: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-0004b7f0: 7465 5f76 616c 7565 2829 5d0d 0a20 2020  te_value()]..   
+0004b7c0: 2064 6174 6173 6574 2e69 645f 6461 7461   dataset.id_data
+0004b7d0: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
+0004b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b810: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0004b820: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-0004b830: 6464 5f6f 6d5f 6461 7461 7365 745f 7370  dd_om_dataset_sp
-0004b840: 6563 6966 6963 6174 696f 6e28 5b63 6c6f  ecification([clo
-0004b850: 7365 5f64 6174 6173 6574 5f73 7065 6369  se_dataset_speci
-0004b860: 6669 6361 7469 6f6e 5d29 0d0a 2020 2020  fication])..    
-0004b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b880: 2020 2020 2020 2020 746d 705f 7370 6563          tmp_spec
-0004b890: 735f 6c6f 6164 6564 2e61 7070 656e 6428  s_loaded.append(
-0004b8a0: 5b65 7869 7374 656e 745f 636f 6c2e 6964  [existent_col.id
-0004b8b0: 5f64 6174 6173 6574 2c20 6578 6973 7465  _dataset, existe
-0004b8c0: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 6e61  nt_col.column_na
-0004b8d0: 6d65 5d29 0d0a 0d0a 2020 2020 2020 2020  me])....        
-0004b8e0: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
-0004b8f0: 6420 6e65 7720 636f 6c75 6d6e 730d 0a20  d new columns.. 
+0004b810: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
+0004b820: 6c2e 6964 5f6b 6579 5f74 7970 652c 0d0a  l.id_key_type,..
+0004b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b860: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004b870: 7869 7374 656e 745f 636f 6c2e 636f 6c75  xistent_col.colu
+0004b880: 6d6e 5f6e 616d 652c 0d0a 2020 2020 2020  mn_name,..      
+0004b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8c0: 2020 2020 2020 2020 2065 7869 7374 656e           existen
+0004b8d0: 745f 636f 6c2e 636f 6c75 6d6e 5f74 7970  t_col.column_typ
+0004b8e0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0004b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b910: 2020 2066 6f72 2074 6162 6c65 5f64 6566     for table_def
-0004b920: 696e 6974 696f 6e5f 7370 6563 2069 6e20  inition_spec in 
-0004b930: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
-0004b940: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004b950: 2020 2020 2020 2020 2020 2066 696e 6465             finde
-0004b960: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
+0004b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b920: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
+0004b930: 6f72 6469 6e61 6c5f 706f 7369 7469 6f6e  ordinal_position
+0004b940: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b980: 2020 2066 6f72 2065 7869 7374 656e 745f     for existent_
-0004b990: 636f 6c20 696e 205b 7820 666f 7220 7820  col in [x for x 
-0004b9a0: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
-0004b9b0: 5f61 6374 7561 6c2e 6f6d 5f64 6174 6173  _actual.om_datas
-0004b9c0: 6574 5f73 7065 6369 6669 6361 7469 6f6e  et_specification
-0004b9d0: 2069 6620 782e 6964 5f64 6174 6173 6574   if x.id_dataset
-0004b9e0: 203d 3d20 6461 7461 7365 742e 6964 5f64   == dataset.id_d
-0004b9f0: 6174 6173 6574 2061 6e64 2078 2e65 6e64  ataset and x.end
-0004ba00: 5f64 6174 6520 6973 204e 6f6e 655d 3a0d  _date is None]:.
-0004ba10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ba20: 2020 2020 2020 2020 2020 2020 2069 645f               id_
-0004ba30: 6b65 795f 7479 7065 203d 2028 0d0a 2020  key_type = (..  
-0004ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004ba60: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0004ba70: 616c 2e67 6574 5f6b 6579 5f74 7970 655f  al.get_key_type_
-0004ba80: 6672 6f6d 5f6b 6579 5f74 7970 655f 6e61  from_key_type_na
-0004ba90: 6d65 2874 6162 6c65 5f64 6566 696e 6974  me(table_definit
-0004baa0: 696f 6e5f 7370 6563 2e6b 6579 5f74 7970  ion_spec.key_typ
-0004bab0: 6529 292e 6964 5f6b 6579 5f74 7970 650d  e)).id_key_type.
-0004bac0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0004bad0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004bae0: 6865 636b 7375 6d5f 6578 6973 7465 6e74  hecksum_existent
-0004baf0: 203d 2073 7472 280d 0a20 2020 2020 2020   = str(..       
-0004bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb10: 2020 2020 2020 2020 2065 7869 7374 656e           existen
-0004bb20: 745f 636f 6c2e 6964 5f6b 6579 5f74 7970  t_col.id_key_typ
-0004bb30: 6529 202b 2065 7869 7374 656e 745f 636f  e) + existent_co
-0004bb40: 6c2e 636f 6c75 6d6e 5f6e 616d 6520 2b20  l.column_name + 
-0004bb50: 6578 6973 7465 6e74 5f63 6f6c 2e63 6f6c  existent_col.col
-0004bb60: 756d 6e5f 7479 7065 202b 205c 0d0a 2020  umn_type + \..  
-0004bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b980: 2020 6578 6973 7465 6e74 5f63 6f6c 2e69    existent_col.i
+0004b990: 735f 6e75 6c6c 6162 6c65 2c0d 0a20 2020  s_nullable,..   
+0004b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b9d0: 2020 2020 2020 2020 2020 2020 6578 6973              exis
+0004b9e0: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
+0004b9f0: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
+0004ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ba30: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
+0004ba40: 5f63 6f6c 2e63 6f6c 756d 6e5f 7072 6563  _col.column_prec
+0004ba50: 6973 696f 6e2c 2065 7869 7374 656e 745f  ision, existent_
+0004ba60: 636f 6c2e 636f 6c75 6d6e 5f73 6361 6c65  col.column_scale
+0004ba70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bab0: 2020 6578 6973 7465 6e74 5f63 6f6c 2e6d    existent_col.m
+0004bac0: 6574 615f 6f77 6e65 722c 0d0a 2020 2020  eta_owner,..    
+0004bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb00: 2020 2020 2020 2020 2020 2022 2722 202b             "'" +
+0004bb10: 2073 7472 2865 7869 7374 656e 745f 636f   str(existent_co
+0004bb20: 6c2e 7374 6172 745f 6461 7465 2920 2b20  l.start_date) + 
+0004bb30: 2227 222c 0d0a 2020 2020 2020 2020 2020  "'",..          
+0004bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bb70: 2020 2020 2022 4e55 4c4c 225d 0d0a 2020       "NULL"]..  
 0004bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bb90: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0004bba0: 7228 6578 6973 7465 6e74 5f63 6f6c 2e6f  r(existent_col.o
-0004bbb0: 7264 696e 616c 5f70 6f73 6974 696f 6e29  rdinal_position)
-0004bbc0: 202b 2073 7472 280d 0a20 2020 2020 2020   + str(..       
-0004bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bbe0: 2020 2020 2020 2020 2065 7869 7374 656e           existen
-0004bbf0: 745f 636f 6c2e 6973 5f6e 756c 6c61 626c  t_col.is_nullabl
-0004bc00: 6529 202b 2073 7472 2865 7869 7374 656e  e) + str(existen
-0004bc10: 745f 636f 6c2e 636f 6c75 6d6e 5f6c 656e  t_col.column_len
-0004bc20: 6774 6829 202b 205c 0d0a 2020 2020 2020  gth) + \..      
-0004bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bc50: 2020 2020 2020 2020 2020 7374 7228 6578            str(ex
-0004bc60: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
-0004bc70: 6e5f 7072 6563 6973 696f 6e29 202b 2073  n_precision) + s
-0004bc80: 7472 2865 7869 7374 656e 745f 636f 6c2e  tr(existent_col.
-0004bc90: 636f 6c75 6d6e 5f73 6361 6c65 290d 0a20  column_scale).. 
+0004bb90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0004bba0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+0004bbb0: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
+0004bbc0: 6574 5f73 7065 6369 6669 6361 7469 6f6e  et_specification
+0004bbd0: 285b 636c 6f73 655f 6461 7461 7365 745f  ([close_dataset_
+0004bbe0: 7370 6563 6966 6963 6174 696f 6e5d 290d  specification]).
+0004bbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc10: 2074 6d70 5f73 7065 6373 5f6c 6f61 6465   tmp_specs_loade
+0004bc20: 642e 6170 7065 6e64 285b 6461 7461 7365  d.append([datase
+0004bc30: 742e 6964 5f64 6174 6173 6574 2c20 6578  t.id_dataset, ex
+0004bc40: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
+0004bc50: 6e5f 6e61 6d65 5d29 0d0a 0d0a 2020 2020  n_name])....    
+0004bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bc70: 2020 2020 2320 436f 6c75 6d6e 2074 6861      # Column tha
+0004bc80: 7420 6973 206e 6f20 6d6f 7265 206f 6e20  t is no more on 
+0004bc90: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
 0004bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bcb0: 2020 2020 2020 2020 2020 2063 6865 636b             check
-0004bcc0: 7375 6d5f 6e65 7720 3d20 7374 7228 0d0a  sum_new = str(..
-0004bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bcf0: 6964 5f6b 6579 5f74 7970 6529 202b 2074  id_key_type) + t
-0004bd00: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-0004bd10: 7370 6563 2e63 6f6c 756d 6e5f 6e61 6d65  spec.column_name
-0004bd20: 202b 2074 6162 6c65 5f64 6566 696e 6974   + table_definit
-0004bd30: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
-0004bd40: 7479 7065 202b 205c 0d0a 2020 2020 2020  type + \..      
+0004bcb0: 6966 206e 6f74 2066 696e 6465 643a 0d0a  if not finded:..
+0004bcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bcd0: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
+0004bce0: 655f 6461 7461 7365 745f 7370 6563 6966  e_dataset_specif
+0004bcf0: 6963 6174 696f 6e20 3d20 5b65 7869 7374  ication = [exist
+0004bd00: 656e 745f 636f 6c2e 6964 5f64 6174 6173  ent_col.id_datas
+0004bd10: 6574 5f73 7065 632c 2065 7869 7374 656e  et_spec, existen
+0004bd20: 745f 636f 6c2e 6964 5f64 6174 6173 6574  t_col.id_dataset
+0004bd30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bd70: 2020 2020 2073 7472 2874 6162 6c65 5f64       str(table_d
-0004bd80: 6566 696e 6974 696f 6e5f 7370 6563 2e69  efinition_spec.i
-0004bd90: 6429 202b 2073 7472 2874 6162 6c65 5f64  d) + str(table_d
-0004bda0: 6566 696e 6974 696f 6e5f 7370 6563 2e69  efinition_spec.i
-0004bdb0: 735f 6e75 6c6c 6162 6c65 2920 2b20 7374  s_nullable) + st
-0004bdc0: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
-0004bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bde0: 2020 2020 7461 626c 655f 6465 6669 6e69      table_defini
-0004bdf0: 7469 6f6e 5f73 7065 632e 636f 6c75 6d6e  tion_spec.column
-0004be00: 5f6c 656e 6774 6829 202b 205c 0d0a 2020  _length) + \..  
-0004be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004be30: 2020 2020 2020 2020 2073 7472 2874 6162           str(tab
-0004be40: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
-0004be50: 6563 2e63 6f6c 756d 6e5f 7072 6563 6973  ec.column_precis
-0004be60: 696f 6e29 202b 2073 7472 2874 6162 6c65  ion) + str(table
-0004be70: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-0004be80: 2e63 6f6c 756d 6e5f 7363 616c 6529 0d0a  .column_scale)..
-0004be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bea0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0004beb0: 6865 636b 7375 6d5f 6e65 7720 3d3d 2063  hecksum_new == c
-0004bec0: 6865 636b 7375 6d5f 6578 6973 7465 6e74  hecksum_existent
-0004bed0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bef0: 2020 2066 696e 6465 6420 3d20 5472 7565     finded = True
+0004bd60: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0004bd70: 6973 7465 6e74 5f63 6f6c 2e69 645f 6b65  istent_col.id_ke
+0004bd80: 795f 7479 7065 2c0d 0a20 2020 2020 2020  y_type,..       
+0004bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bdc0: 2020 2020 6578 6973 7465 6e74 5f63 6f6c      existent_col
+0004bdd0: 2e63 6f6c 756d 6e5f 6e61 6d65 2c0d 0a20  .column_name,.. 
+0004bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be10: 2020 2020 2020 2020 2020 6578 6973 7465            existe
+0004be20: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 7479  nt_col.column_ty
+0004be30: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
+0004be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be70: 6578 6973 7465 6e74 5f63 6f6c 2e6f 7264  existent_col.ord
+0004be80: 696e 616c 5f70 6f73 6974 696f 6e2c 2065  inal_position, e
+0004be90: 7869 7374 656e 745f 636f 6c2e 6973 5f6e  xistent_col.is_n
+0004bea0: 756c 6c61 626c 652c 0d0a 2020 2020 2020  ullable,..      
+0004beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bee0: 2020 2020 2065 7869 7374 656e 745f 636f       existent_co
+0004bef0: 6c2e 636f 6c75 6d6e 5f6c 656e 6774 682c  l.column_length,
 0004bf00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0004bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf20: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
-0004bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf40: 2023 204e 6577 2063 6f6c 756d 6e20 6973   # New column is
-0004bf50: 2061 6464 6564 206f 6e20 736f 7572 6365   added on source
-0004bf60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004bf70: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0004bf80: 2066 696e 6465 643a 0d0a 2020 2020 2020   finded:..      
+0004bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bf30: 2020 2020 2020 2020 2020 2020 2065 7869               exi
+0004bf40: 7374 656e 745f 636f 6c2e 636f 6c75 6d6e  stent_col.column
+0004bf50: 5f70 7265 6369 7369 6f6e 2c20 6578 6973  _precision, exis
+0004bf60: 7465 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f  tent_col.column_
+0004bf70: 7363 616c 652c 0d0a 2020 2020 2020 2020  scale,..        
+0004bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bfa0: 2020 2020 2020 6964 5f64 6174 6173 6574        id_dataset
-0004bfb0: 5f73 7065 6320 3d20 6e65 7874 5f69 645f  _spec = next_id_
-0004bfc0: 6461 7461 7365 745f 7370 6563 0d0a 2020  dataset_spec..  
+0004bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bfb0: 2020 2065 7869 7374 656e 745f 636f 6c2e     existent_col.
+0004bfc0: 6d65 7461 5f6f 776e 6572 2c0d 0a20 2020  meta_owner,..   
 0004bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bfe0: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
-0004bff0: 645f 6461 7461 7365 745f 7370 6563 202b  d_dataset_spec +
-0004c000: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0004c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c020: 2069 645f 6b65 795f 7479 7065 203d 2028   id_key_type = (
-0004c030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c000: 2020 2020 2020 2020 2227 2220 2b20 7374          "'" + st
+0004c010: 7228 6578 6973 7465 6e74 5f63 6f6c 2e73  r(existent_col.s
+0004c020: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
+0004c030: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0004c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c050: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0004c060: 6163 7475 616c 2e67 6574 5f6b 6579 5f74  actual.get_key_t
-0004c070: 7970 655f 6672 6f6d 5f6b 6579 5f74 7970  ype_from_key_typ
-0004c080: 655f 6e61 6d65 2874 6162 6c65 5f64 6566  e_name(table_def
-0004c090: 696e 6974 696f 6e5f 7370 6563 2e6b 6579  inition_spec.key
-0004c0a0: 5f74 7970 6529 292e 6964 5f6b 6579 5f74  _type)).id_key_t
-0004c0b0: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
-0004c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c0d0: 2073 7461 7274 5f64 6174 6520 3d20 7365   start_date = se
-0004c0e0: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-0004c0f0: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-0004c100: 7465 5f76 616c 7565 2829 0d0a 2020 2020  te_value()..    
+0004c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c060: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0004c070: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+0004c080: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+0004c090: 7465 5f76 616c 7565 2829 5d0d 0a20 2020  te_value()]..   
+0004c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c0b0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0004c0c0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+0004c0d0: 6464 5f6f 6d5f 6461 7461 7365 745f 7370  dd_om_dataset_sp
+0004c0e0: 6563 6966 6963 6174 696f 6e28 5b63 6c6f  ecification([clo
+0004c0f0: 7365 5f64 6174 6173 6574 5f73 7065 6369  se_dataset_speci
+0004c100: 6669 6361 7469 6f6e 5d29 0d0a 2020 2020  fication])..    
 0004c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c120: 2020 2020 2020 2020 656e 645f 6461 7465          end_date
-0004c130: 203d 2022 4e55 4c4c 220d 0a0d 0a20 2020   = "NULL"....   
-0004c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c150: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
-0004c160: 6173 6574 5f73 7065 6369 6669 6361 7469  aset_specificati
-0004c170: 6f6e 203d 205b 6964 5f64 6174 6173 6574  on = [id_dataset
-0004c180: 5f73 7065 632c 2064 6174 6173 6574 2e69  _spec, dataset.i
-0004c190: 645f 6461 7461 7365 742c 2069 645f 6b65  d_dataset, id_ke
-0004c1a0: 795f 7479 7065 2c0d 0a20 2020 2020 2020  y_type,..       
-0004c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c1e0: 2020 7461 626c 655f 6465 6669 6e69 7469    table_definiti
-0004c1f0: 6f6e 5f73 7065 632e 636f 6c75 6d6e 5f6e  on_spec.column_n
-0004c200: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0004c120: 2020 2020 2020 2020 746d 705f 7370 6563          tmp_spec
+0004c130: 735f 6c6f 6164 6564 2e61 7070 656e 6428  s_loaded.append(
+0004c140: 5b65 7869 7374 656e 745f 636f 6c2e 6964  [existent_col.id
+0004c150: 5f64 6174 6173 6574 2c20 6578 6973 7465  _dataset, existe
+0004c160: 6e74 5f63 6f6c 2e63 6f6c 756d 6e5f 6e61  nt_col.column_na
+0004c170: 6d65 5d29 0d0a 0d0a 2020 2020 2020 2020  me])....        
+0004c180: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
+0004c190: 6420 6e65 7720 636f 6c75 6d6e 730d 0a20  d new columns.. 
+0004c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c1b0: 2020 2066 6f72 2074 6162 6c65 5f64 6566     for table_def
+0004c1c0: 696e 6974 696f 6e5f 7370 6563 2069 6e20  inition_spec in 
+0004c1d0: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
+0004c1e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004c1f0: 2020 2020 2020 2020 2020 2066 696e 6465             finde
+0004c200: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
 0004c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c230: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004c240: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
-0004c250: 7370 6563 2e63 6f6c 756d 6e5f 7479 7065  spec.column_type
-0004c260: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004c270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c290: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-0004c2a0: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
-0004c2b0: 632e 6964 2c0d 0a20 2020 2020 2020 2020  c.id,..         
-0004c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c220: 2020 2066 6f72 2065 7869 7374 656e 745f     for existent_
+0004c230: 636f 6c20 696e 205b 7820 666f 7220 7820  col in [x for x 
+0004c240: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
+0004c250: 5f61 6374 7561 6c2e 6f6d 5f64 6174 6173  _actual.om_datas
+0004c260: 6574 5f73 7065 6369 6669 6361 7469 6f6e  et_specification
+0004c270: 2069 6620 782e 6964 5f64 6174 6173 6574   if x.id_dataset
+0004c280: 203d 3d20 6461 7461 7365 742e 6964 5f64   == dataset.id_d
+0004c290: 6174 6173 6574 2061 6e64 2078 2e65 6e64  ataset and x.end
+0004c2a0: 5f64 6174 6520 6973 204e 6f6e 655d 3a0d  _date is None]:.
+0004c2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c2c0: 2020 2020 2020 2020 2020 2020 2069 645f               id_
+0004c2d0: 6b65 795f 7479 7065 203d 2028 0d0a 2020  key_type = (..  
 0004c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c2f0: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
-0004c300: 5f73 7065 632e 6973 5f6e 756c 6c61 626c  _spec.is_nullabl
-0004c310: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0004c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c340: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-0004c350: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
-0004c360: 6563 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ec.column_length
-0004c370: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c3a0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-0004c3b0: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
-0004c3c0: 632e 636f 6c75 6d6e 5f70 7265 6369 7369  c.column_precisi
-0004c3d0: 6f6e 2c20 7461 626c 655f 6465 6669 6e69  on, table_defini
-0004c3e0: 7469 6f6e 5f73 7065 632e 636f 6c75 6d6e  tion_spec.column
-0004c3f0: 5f73 6361 6c65 2c0d 0a20 2020 2020 2020  _scale,..       
-0004c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c2f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0004c300: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0004c310: 616c 2e67 6574 5f6b 6579 5f74 7970 655f  al.get_key_type_
+0004c320: 6672 6f6d 5f6b 6579 5f74 7970 655f 6e61  from_key_type_na
+0004c330: 6d65 2874 6162 6c65 5f64 6566 696e 6974  me(table_definit
+0004c340: 696f 6e5f 7370 6563 2e6b 6579 5f74 7970  ion_spec.key_typ
+0004c350: 6529 292e 6964 5f6b 6579 5f74 7970 650d  e)).id_key_type.
+0004c360: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0004c370: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004c380: 6865 636b 7375 6d5f 6578 6973 7465 6e74  hecksum_existent
+0004c390: 203d 2073 7472 280d 0a20 2020 2020 2020   = str(..       
+0004c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c3b0: 2020 2020 2020 2020 2065 7869 7374 656e           existen
+0004c3c0: 745f 636f 6c2e 6964 5f6b 6579 5f74 7970  t_col.id_key_typ
+0004c3d0: 6529 202b 2065 7869 7374 656e 745f 636f  e) + existent_co
+0004c3e0: 6c2e 636f 6c75 6d6e 5f6e 616d 6520 2b20  l.column_name + 
+0004c3f0: 6578 6973 7465 6e74 5f63 6f6c 2e63 6f6c  existent_col.col
+0004c400: 756d 6e5f 7479 7065 202b 205c 0d0a 2020  umn_type + \..  
 0004c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c430: 2020 7365 6c66 2e6f 776e 6572 2c20 7374    self.owner, st
-0004c440: 6172 745f 6461 7465 2c20 656e 645f 6461  art_date, end_da
-0004c450: 7465 5d0d 0a20 2020 2020 2020 2020 2020  te]..           
-0004c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c470: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
-0004c480: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
-0004c490: 7461 7365 745f 7370 6563 6966 6963 6174  taset_specificat
-0004c4a0: 696f 6e28 5b6e 6577 5f64 6174 6173 6574  ion([new_dataset
-0004c4b0: 5f73 7065 6369 6669 6361 7469 6f6e 5d29  _specification])
-0004c4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c4d0: 2020 2020 2020 2020 2020 2020 2020 746d                tm
-0004c4e0: 705f 7370 6563 735f 6c6f 6164 6564 2e61  p_specs_loaded.a
-0004c4f0: 7070 656e 6428 5b64 6174 6173 6574 2e69  ppend([dataset.i
-0004c500: 645f 6461 7461 7365 742c 2074 6162 6c65  d_dataset, table
-0004c510: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
-0004c520: 2e63 6f6c 756d 6e5f 6e61 6d65 5d29 0d0a  .column_name])..
-0004c530: 0d0a 2020 2020 2020 2020 2320 436c 6f73  ..        # Clos
-0004c540: 6520 7461 626c 6573 2074 6861 7420 6e6f  e tables that no
-0004c550: 7420 6172 7269 7665 2061 6e79 6d6f 7265  t arrive anymore
-0004c560: 0d0a 2020 2020 2020 2020 666f 7220 6461  ..        for da
-0004c570: 7461 7365 7420 696e 205b 7820 666f 7220  taset in [x for 
-0004c580: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
-0004c590: 7461 5f61 6374 7561 6c2e 6f6d 5f64 6174  ta_actual.om_dat
-0004c5a0: 6173 6574 2069 6620 782e 6964 5f65 6e74  aset if x.id_ent
-0004c5b0: 6974 795f 7479 7065 203d 3d20 7365 6c66  ity_type == self
-0004c5c0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-0004c5d0: 2e67 6574 5f65 6e74 6974 795f 7479 7065  .get_entity_type
-0004c5e0: 5f66 726f 6d5f 656e 7469 7479 5f74 7970  _from_entity_typ
-0004c5f0: 655f 6e61 6d65 2845 4e54 4954 595f 5442  e_name(ENTITY_TB
-0004c600: 292e 6964 5f65 6e74 6974 795f 7479 7065  ).id_entity_type
-0004c610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c620: 2020 2020 2020 2020 2020 6f72 2078 2e69            or x.i
-0004c630: 645f 656e 7469 7479 5f74 7970 653d 3d20  d_entity_type== 
-0004c640: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
-0004c650: 7475 616c 2e67 6574 5f65 6e74 6974 795f  tual.get_entity_
-0004c660: 7479 7065 5f66 726f 6d5f 656e 7469 7479  type_from_entity
-0004c670: 5f74 7970 655f 6e61 6d65 2845 4e54 4954  _type_name(ENTIT
-0004c680: 595f 5749 5448 292e 6964 5f65 6e74 6974  Y_WITH).id_entit
-0004c690: 795f 7479 7065 5d3a 0d0a 2020 2020 2020  y_type]:..      
-0004c6a0: 2020 2020 2020 6966 205b 6461 7461 7365        if [datase
-0004c6b0: 742e 6461 7461 7365 745f 6e61 6d65 2c20  t.dataset_name, 
-0004c6c0: 6461 7461 7365 742e 6964 5f65 6e74 6974  dataset.id_entit
-0004c6d0: 795f 7479 7065 2c20 6461 7461 7365 742e  y_type, dataset.
-0004c6e0: 6964 5f70 6174 685d 206e 6f74 2069 6e20  id_path] not in 
-0004c6f0: 746d 705f 6c6f 6164 6564 2061 6e64 2064  tmp_loaded and d
-0004c700: 6174 6173 6574 2e65 6e64 5f64 6174 6520  ataset.end_date 
-0004c710: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0004c720: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
-0004c730: 736f 7572 6365 203d 205b 6461 7461 7365  source = [datase
-0004c740: 742e 6964 5f64 6174 6173 6574 2c20 6461  t.id_dataset, da
-0004c750: 7461 7365 742e 6461 7461 7365 745f 6e61  taset.dataset_na
-0004c760: 6d65 2c20 6461 7461 7365 742e 6964 5f65  me, dataset.id_e
-0004c770: 6e74 6974 795f 7479 7065 2c0d 0a20 2020  ntity_type,..   
+0004c430: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0004c440: 7228 6578 6973 7465 6e74 5f63 6f6c 2e6f  r(existent_col.o
+0004c450: 7264 696e 616c 5f70 6f73 6974 696f 6e29  rdinal_position)
+0004c460: 202b 2073 7472 280d 0a20 2020 2020 2020   + str(..       
+0004c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c480: 2020 2020 2020 2020 2065 7869 7374 656e           existen
+0004c490: 745f 636f 6c2e 6973 5f6e 756c 6c61 626c  t_col.is_nullabl
+0004c4a0: 6529 202b 2073 7472 2865 7869 7374 656e  e) + str(existen
+0004c4b0: 745f 636f 6c2e 636f 6c75 6d6e 5f6c 656e  t_col.column_len
+0004c4c0: 6774 6829 202b 205c 0d0a 2020 2020 2020  gth) + \..      
+0004c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c4f0: 2020 2020 2020 2020 2020 7374 7228 6578            str(ex
+0004c500: 6973 7465 6e74 5f63 6f6c 2e63 6f6c 756d  istent_col.colum
+0004c510: 6e5f 7072 6563 6973 696f 6e29 202b 2073  n_precision) + s
+0004c520: 7472 2865 7869 7374 656e 745f 636f 6c2e  tr(existent_col.
+0004c530: 636f 6c75 6d6e 5f73 6361 6c65 290d 0a20  column_scale).. 
+0004c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c550: 2020 2020 2020 2020 2020 2063 6865 636b             check
+0004c560: 7375 6d5f 6e65 7720 3d20 7374 7228 0d0a  sum_new = str(..
+0004c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c590: 6964 5f6b 6579 5f74 7970 6529 202b 2074  id_key_type) + t
+0004c5a0: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+0004c5b0: 7370 6563 2e63 6f6c 756d 6e5f 6e61 6d65  spec.column_name
+0004c5c0: 202b 2074 6162 6c65 5f64 6566 696e 6974   + table_definit
+0004c5d0: 696f 6e5f 7370 6563 2e63 6f6c 756d 6e5f  ion_spec.column_
+0004c5e0: 7479 7065 202b 205c 0d0a 2020 2020 2020  type + \..      
+0004c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c610: 2020 2020 2073 7472 2874 6162 6c65 5f64       str(table_d
+0004c620: 6566 696e 6974 696f 6e5f 7370 6563 2e69  efinition_spec.i
+0004c630: 6429 202b 2073 7472 2874 6162 6c65 5f64  d) + str(table_d
+0004c640: 6566 696e 6974 696f 6e5f 7370 6563 2e69  efinition_spec.i
+0004c650: 735f 6e75 6c6c 6162 6c65 2920 2b20 7374  s_nullable) + st
+0004c660: 7228 0d0a 2020 2020 2020 2020 2020 2020  r(..            
+0004c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c680: 2020 2020 7461 626c 655f 6465 6669 6e69      table_defini
+0004c690: 7469 6f6e 5f73 7065 632e 636f 6c75 6d6e  tion_spec.column
+0004c6a0: 5f6c 656e 6774 6829 202b 205c 0d0a 2020  _length) + \..  
+0004c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c6d0: 2020 2020 2020 2020 2073 7472 2874 6162           str(tab
+0004c6e0: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
+0004c6f0: 6563 2e63 6f6c 756d 6e5f 7072 6563 6973  ec.column_precis
+0004c700: 696f 6e29 202b 2073 7472 2874 6162 6c65  ion) + str(table
+0004c710: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+0004c720: 2e63 6f6c 756d 6e5f 7363 616c 6529 0d0a  .column_scale)..
+0004c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c740: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0004c750: 6865 636b 7375 6d5f 6e65 7720 3d3d 2063  hecksum_new == c
+0004c760: 6865 636b 7375 6d5f 6578 6973 7465 6e74  hecksum_existent
+0004c770: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
 0004c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c790: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0004c7a0: 6173 6574 2e69 645f 7061 7468 2c20 6461  aset.id_path, da
-0004c7b0: 7461 7365 742e 6d65 7461 5f6f 776e 6572  taset.meta_owner
-0004c7c0: 2c20 2227 2220 2b20 7374 7228 6461 7461  , "'" + str(data
-0004c7d0: 7365 742e 7374 6172 745f 6461 7465 2920  set.start_date) 
-0004c7e0: 2b20 2227 222c 0d0a 2020 2020 2020 2020  + "'",..        
-0004c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c800: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-0004c810: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
-0004c820: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
-0004c830: 7565 2829 5d0d 0a20 2020 2020 2020 2020  ue()]..         
-0004c840: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
-0004c850: 6461 7461 5f74 6f5f 6c6f 6164 2e61 6464  data_to_load.add
-0004c860: 5f6f 6d5f 6461 7461 7365 7428 5b63 6c6f  _om_dataset([clo
-0004c870: 7365 5f73 6f75 7263 655d 290d 0a20 2020  se_source])..   
-0004c880: 2020 2020 2023 2043 6c6f 7365 2053 7065       # Close Spe
-0004c890: 6369 6669 6361 7469 6f6e 7320 7468 6174  cifications that
-0004c8a0: 206e 6f74 2061 7272 6976 6520 616e 796d   not arrive anym
-0004c8b0: 6f72 650d 0a20 2020 2020 2020 2066 6f72  ore..        for
-0004c8c0: 2064 6174 6173 6574 5f73 7065 6320 696e   dataset_spec in
-0004c8d0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0004c8e0: 6374 7561 6c2e 6f6d 5f64 6174 6173 6574  ctual.om_dataset
-0004c8f0: 5f73 7065 6369 6669 6361 7469 6f6e 3a0d  _specification:.
-0004c900: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0004c910: 5b64 6174 6173 6574 5f73 7065 632e 6964  [dataset_spec.id
-0004c920: 5f64 6174 6173 6574 2c20 6461 7461 7365  _dataset, datase
-0004c930: 745f 7370 6563 2e63 6f6c 756d 6e5f 6e61  t_spec.column_na
-0004c940: 6d65 5d20 6e6f 7420 696e 2074 6d70 5f73  me] not in tmp_s
-0004c950: 7065 6373 5f6c 6f61 6465 6420 616e 6420  pecs_loaded and 
-0004c960: 5b64 6174 6173 6574 5f73 7065 632e 6964  [dataset_spec.id
-0004c970: 5f64 6174 6173 6574 2c20 6461 7461 7365  _dataset, datase
-0004c980: 745f 7370 6563 2e63 6f6c 756d 6e5f 6e61  t_spec.column_na
-0004c990: 6d65 5d20 6e6f 7420 696e 2073 6f75 7263  me] not in sourc
-0004c9a0: 6573 5f73 7065 6373 5f6c 6f61 6465 6420  es_specs_loaded 
-0004c9b0: 616e 6420 6461 7461 7365 745f 7370 6563  and dataset_spec
-0004c9c0: 2e65 6e64 5f64 6174 6520 6973 204e 6f6e  .end_date is Non
-0004c9d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004c9e0: 2020 2020 636c 6f73 655f 6461 7461 7365      close_datase
-0004c9f0: 745f 7370 6563 203d 205b 6461 7461 7365  t_spec = [datase
-0004ca00: 745f 7370 6563 2e69 645f 6461 7461 7365  t_spec.id_datase
-0004ca10: 745f 7370 6563 2c20 6461 7461 7365 745f  t_spec, dataset_
-0004ca20: 7370 6563 2e69 645f 6461 7461 7365 742c  spec.id_dataset,
-0004ca30: 2064 6174 6173 6574 5f73 7065 632e 6964   dataset_spec.id
-0004ca40: 5f6b 6579 5f74 7970 652c 0d0a 2020 2020  _key_type,..    
+0004c790: 2020 2066 696e 6465 6420 3d20 5472 7565     finded = True
+0004c7a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c7c0: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
+0004c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c7e0: 2023 204e 6577 2063 6f6c 756d 6e20 6973   # New column is
+0004c7f0: 2061 6464 6564 206f 6e20 736f 7572 6365   added on source
+0004c800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004c810: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0004c820: 2066 696e 6465 643a 0d0a 2020 2020 2020   finded:..      
+0004c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c840: 2020 2020 2020 6964 5f64 6174 6173 6574        id_dataset
+0004c850: 5f73 7065 6320 3d20 6e65 7874 5f69 645f  _spec = next_id_
+0004c860: 6461 7461 7365 745f 7370 6563 0d0a 2020  dataset_spec..  
+0004c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c880: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
+0004c890: 645f 6461 7461 7365 745f 7370 6563 202b  d_dataset_spec +
+0004c8a0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+0004c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c8c0: 2069 645f 6b65 795f 7479 7065 203d 2028   id_key_type = (
+0004c8d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c8f0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0004c900: 6163 7475 616c 2e67 6574 5f6b 6579 5f74  actual.get_key_t
+0004c910: 7970 655f 6672 6f6d 5f6b 6579 5f74 7970  ype_from_key_typ
+0004c920: 655f 6e61 6d65 2874 6162 6c65 5f64 6566  e_name(table_def
+0004c930: 696e 6974 696f 6e5f 7370 6563 2e6b 6579  inition_spec.key
+0004c940: 5f74 7970 6529 292e 6964 5f6b 6579 5f74  _type)).id_key_t
+0004c950: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
+0004c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c970: 2073 7461 7274 5f64 6174 6520 3d20 7365   start_date = se
+0004c980: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+0004c990: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+0004c9a0: 7465 5f76 616c 7565 2829 0d0a 2020 2020  te_value()..    
+0004c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c9c0: 2020 2020 2020 2020 656e 645f 6461 7465          end_date
+0004c9d0: 203d 2022 4e55 4c4c 220d 0a0d 0a20 2020   = "NULL"....   
+0004c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c9f0: 2020 2020 2020 2020 206e 6577 5f64 6174           new_dat
+0004ca00: 6173 6574 5f73 7065 6369 6669 6361 7469  aset_specificati
+0004ca10: 6f6e 203d 205b 6964 5f64 6174 6173 6574  on = [id_dataset
+0004ca20: 5f73 7065 632c 2064 6174 6173 6574 2e69  _spec, dataset.i
+0004ca30: 645f 6461 7461 7365 742c 2069 645f 6b65  d_dataset, id_ke
+0004ca40: 795f 7479 7065 2c0d 0a20 2020 2020 2020  y_type,..       
 0004ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ca70: 2020 6461 7461 7365 745f 7370 6563 2e63    dataset_spec.c
-0004ca80: 6f6c 756d 6e5f 6e61 6d65 2c20 6461 7461  olumn_name, data
-0004ca90: 7365 745f 7370 6563 2e63 6f6c 756d 6e5f  set_spec.column_
-0004caa0: 7479 7065 2c20 6461 7461 7365 745f 7370  type, dataset_sp
-0004cab0: 6563 2e6f 7264 696e 616c 5f70 6f73 6974  ec.ordinal_posit
-0004cac0: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
-0004cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cae0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0004caf0: 7365 745f 7370 6563 2e69 735f 6e75 6c6c  set_spec.is_null
-0004cb00: 6162 6c65 2c20 6461 7461 7365 745f 7370  able, dataset_sp
-0004cb10: 6563 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ec.column_length
-0004cb20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb40: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-0004cb50: 5f73 7065 632e 636f 6c75 6d6e 5f70 7265  _spec.column_pre
-0004cb60: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0004ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ca80: 2020 7461 626c 655f 6465 6669 6e69 7469    table_definiti
+0004ca90: 6f6e 5f73 7065 632e 636f 6c75 6d6e 5f6e  on_spec.column_n
+0004caa0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
+0004cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cad0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0004cae0: 6162 6c65 5f64 6566 696e 6974 696f 6e5f  able_definition_
+0004caf0: 7370 6563 2e63 6f6c 756d 6e5f 7479 7065  spec.column_type
+0004cb00: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb30: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+0004cb40: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
+0004cb50: 632e 6964 2c0d 0a20 2020 2020 2020 2020  c.id,..         
+0004cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cb80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0004cb90: 6174 6173 6574 5f73 7065 632e 636f 6c75  ataset_spec.colu
-0004cba0: 6d6e 5f73 6361 6c65 2c20 6461 7461 7365  mn_scale, datase
-0004cbb0: 745f 7370 6563 2e6d 6574 615f 6f77 6e65  t_spec.meta_owne
-0004cbc0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+0004cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cb90: 7461 626c 655f 6465 6669 6e69 7469 6f6e  table_definition
+0004cba0: 5f73 7065 632e 6973 5f6e 756c 6c61 626c  _spec.is_nullabl
+0004cbb0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0004cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0004cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cbe0: 2020 2020 2020 2020 2020 2227 2220 2b20            "'" + 
-0004cbf0: 7374 7228 6461 7461 7365 745f 7370 6563  str(dataset_spec
-0004cc00: 2e73 7461 7274 5f64 6174 6529 202b 2022  .start_date) + "
-0004cc10: 2722 2c20 7365 6c66 2e63 6f6e 6e65 6374  '", self.connect
-0004cc20: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
-0004cc30: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
-0004cc40: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0004cc50: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0004cc60: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-0004cc70: 6461 7461 7365 745f 7370 6563 6966 6963  dataset_specific
-0004cc80: 6174 696f 6e28 5b63 6c6f 7365 5f64 6174  ation([close_dat
-0004cc90: 6173 6574 5f73 7065 635d 290d 0a0d 0a20  aset_spec]).... 
-0004cca0: 2020 2020 2020 2073 656c 662e 6e65 7874         self.next
-0004ccb0: 5f69 645f 6461 7461 7365 7420 3d20 6e65  _id_dataset = ne
-0004ccc0: 7874 5f69 645f 6461 7461 7365 740d 0a20  xt_id_dataset.. 
-0004ccd0: 2020 2020 2020 2073 656c 662e 6e65 7874         self.next
-0004cce0: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
-0004ccf0: 203d 206e 6578 745f 6964 5f64 6174 6173   = next_id_datas
-0004cd00: 6574 5f73 7065 630d 0a0d 0a20 2020 2020  et_spec....     
-0004cd10: 2020 2073 656c 662e 6c6f 672e 6c6f 6728     self.log.log(
-0004cd20: 7365 6c66 2e65 6e67 696e 655f 6e61 6d65  self.engine_name
-0004cd30: 2c20 2246 696e 6973 6865 6420 746f 2070  , "Finished to p
-0004cd40: 726f 6365 7373 204d 6574 6164 6174 6120  rocess Metadata 
-0004cd50: 5b20 536f 7572 6365 7320 5d20 696e 666f  [ Sources ] info
-0004cd60: 726d 6174 696f 6e22 2c20 4c4f 475f 4c45  rmation", LOG_LE
-0004cd70: 5645 4c5f 4f4e 4c59 5f4c 4f47 290d 0a0d  VEL_ONLY_LOG)...
-0004cd80: 0a20 2020 2064 6566 2070 726f 6365 7373  .    def process
-0004cd90: 5f65 6c74 5f6f 7264 6572 2873 656c 6629  _elt_order(self)
-0004cda0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0004cdb0: 6c6f 672e 6c6f 6728 7365 6c66 2e65 6e67  log.log(self.eng
-0004cdc0: 696e 655f 6e61 6d65 2c20 2253 7461 7274  ine_name, "Start
-0004cdd0: 696e 6720 746f 2070 726f 6365 7373 204d  ing to process M
-0004cde0: 6574 6164 6174 6120 5b20 4f72 6465 7220  etadata [ Order 
-0004cdf0: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
-0004ce00: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
-0004ce10: 4f47 290d 0a20 2020 2020 2020 206e 6578  OG)..        nex
-0004ce20: 745f 6964 5f74 5f6f 7264 6572 203d 2073  t_id_t_order = s
-0004ce30: 656c 662e 6e65 7874 5f69 645f 745f 6f72  elf.next_id_t_or
-0004ce40: 6465 720d 0a20 2020 2020 2020 2023 2323  der..        ###
-0004ce50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004ce60: 2323 2323 2320 4c4f 4144 204f 5244 4552  ##### LOAD ORDER
-0004ce70: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
-0004ce80: 2323 2323 2323 2323 230d 0a20 2020 2020  #########..     
-0004ce90: 2020 2023 2049 6e70 7574 204f 7264 6572     # Input Order
-0004cea0: 730d 0a20 2020 2020 2020 206f 7264 6572  s..        order
-0004ceb0: 5f6c 6f61 6465 6420 3d20 5b5d 0d0a 2020  _loaded = []..  
-0004cec0: 2020 2020 2020 666f 7220 6f72 6465 7220        for order 
-0004ced0: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
-0004cee0: 5f61 6374 7561 6c2e 656e 7472 795f 6f72  _actual.entry_or
-0004cef0: 6465 723a 0d0a 0d0a 2020 2020 2020 2020  der:....        
-0004cf00: 2020 2020 6461 7461 7365 7420 3d20 7365      dataset = se
-0004cf10: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-0004cf20: 6f61 642e 6765 745f 6461 7461 7365 745f  oad.get_dataset_
-0004cf30: 6672 6f6d 5f64 6174 6173 6574 5f6e 616d  from_dataset_nam
-0004cf40: 6528 7365 6c66 2e6d 6574 6164 6174 615f  e(self.metadata_
-0004cf50: 6163 7475 616c 2e67 6574 5f74 6162 6c65  actual.get_table
-0004cf60: 5f6e 616d 655f 6672 6f6d 5f63 6f64 5f65  _name_from_cod_e
-0004cf70: 6e74 6974 795f 6f6e 5f65 6e74 7279 286f  ntity_on_entry(o
-0004cf80: 7264 6572 2e63 6f64 5f65 6e74 6974 795f  rder.cod_entity_
-0004cf90: 7461 7267 6574 2929 0d0a 2020 2020 2020  target))..      
-0004cfa0: 2020 2020 2020 6461 7461 7365 745f 7372        dataset_sr
-0004cfb0: 6320 3d20 7365 6c66 2e6d 6574 6164 6174  c = self.metadat
-0004cfc0: 615f 746f 5f6c 6f61 642e 6765 745f 6461  a_to_load.get_da
-0004cfd0: 7461 7365 745f 6672 6f6d 5f64 6174 6173  taset_from_datas
-0004cfe0: 6574 5f6e 616d 6528 7365 6c66 2e6d 6574  et_name(self.met
-0004cff0: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
-0004d000: 5f74 6162 6c65 5f6e 616d 655f 6672 6f6d  _table_name_from
-0004d010: 5f63 6f64 5f65 6e74 6974 795f 6f6e 5f65  _cod_entity_on_e
-0004d020: 6e74 7279 286f 7264 6572 2e63 6f64 5f65  ntry(order.cod_e
-0004d030: 6e74 6974 795f 7372 6329 290d 0a20 2020  ntity_src))..   
-0004d040: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-0004d050: 5f73 7065 6320 3d20 7365 6c66 2e6d 6574  _spec = self.met
-0004d060: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
-0004d070: 745f 6461 7461 7365 745f 7370 6563 5f66  t_dataset_spec_f
-0004d080: 726f 6d5f 6964 5f64 6174 6173 6574 5f61  rom_id_dataset_a
-0004d090: 6e64 5f63 6f6c 756d 6e5f 6e61 6d65 2864  nd_column_name(d
-0004d0a0: 6174 6173 6574 5f73 7263 2e69 645f 6461  ataset_src.id_da
-0004d0b0: 7461 7365 742c 206f 7264 6572 2e63 6f6c  taset, order.col
-0004d0c0: 756d 6e5f 6e61 6d65 290d 0a0d 0a20 2020  umn_name)....   
-0004d0d0: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
-0004d0e0: 2049 6e63 6c75 6972 2065 7374 6120 7661   Incluir esta va
-0004d0f0: 6c69 6461 6369 c3b3 6e20 656e 2074 6f64  lidaci..n en tod
-0004d100: 6f73 206c 6f73 2070 726f 6365 736f 7320  os los procesos 
-0004d110: 2d3e 2053 6920 6e6f 2065 7869 7374 6520  -> Si no existe 
-0004d120: 656c 2063 616d 706f 202d 3e20 7361 6361  el campo -> saca
-0004d130: 7220 616c 6572 7461 0d0a 2020 2020 2020  r alerta..      
-0004d140: 2020 2020 2020 2320 6966 2064 6174 6173        # if datas
-0004d150: 6574 5f73 7065 6320 6973 204e 6f6e 653a  et_spec is None:
-0004d160: 202d 3e20 6c61 6e7a 6172 2065 7272 6f72   -> lanzar error
-0004d170: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-0004d180: 6465 725f 6578 6973 7465 6e74 203d 2073  der_existent = s
-0004d190: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-0004d1a0: 7561 6c2e 6765 745f 6f72 6465 725f 6672  ual.get_order_fr
-0004d1b0: 6f6d 5f69 645f 6461 7461 7365 745f 616e  om_id_dataset_an
-0004d1c0: 645f 6964 5f64 6174 6173 6574 5f73 7065  d_id_dataset_spe
-0004d1d0: 635f 616e 645f 6964 5f62 7261 6e63 6828  c_and_id_branch(
-0004d1e0: 6461 7461 7365 742e 6964 5f64 6174 6173  dataset.id_datas
-0004d1f0: 6574 2c20 6461 7461 7365 745f 7370 6563  et, dataset_spec
-0004d200: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
-0004d210: 2c20 6f72 6465 722e 6e75 6d5f 6272 616e  , order.num_bran
-0004d220: 6368 290d 0a0d 0a20 2020 2020 2020 2020  ch)....         
-0004d230: 2020 2069 6620 6f72 6465 725f 6578 6973     if order_exis
-0004d240: 7465 6e74 2069 7320 4e6f 6e65 3a0d 0a20  tent is None:.. 
-0004d250: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0004d260: 204e 6577 206f 7264 6572 0d0a 2020 2020   New order..    
-0004d270: 2020 2020 2020 2020 2020 2020 6964 5f74              id_t
-0004d280: 5f6f 7264 6572 203d 206e 6578 745f 6964  _order = next_id
-0004d290: 5f74 5f6f 7264 6572 0d0a 2020 2020 2020  _t_order..      
-0004d2a0: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
-0004d2b0: 645f 745f 6f72 6465 7220 2b3d 2031 0d0a  d_t_order += 1..
-0004d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d2d0: 6f72 6465 725f 7479 7065 203d 2073 656c  order_type = sel
-0004d2e0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0004d2f0: 6c2e 6765 745f 6f72 6465 725f 7479 7065  l.get_order_type
-0004d300: 5f66 726f 6d5f 6f72 6465 725f 7479 7065  _from_order_type
-0004d310: 5f76 616c 7565 286f 7264 6572 2e6f 7264  _value(order.ord
-0004d320: 6572 5f74 7970 6529 0d0a 2020 2020 2020  er_type)..      
-0004d330: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-0004d340: 6461 7465 203d 2073 656c 662e 636f 6e6e  date = self.conn
-0004d350: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
-0004d360: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
-0004d370: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
-0004d380: 2020 2020 206e 6577 5f6f 7264 6572 203d       new_order =
-0004d390: 205b 6964 5f74 5f6f 7264 6572 2c20 6461   [id_t_order, da
-0004d3a0: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
-0004d3b0: 2c20 6f72 6465 722e 6e75 6d5f 6272 616e  , order.num_bran
-0004d3c0: 6368 2c20 6461 7461 7365 745f 7370 6563  ch, dataset_spec
-0004d3d0: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
-0004d3e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d400: 6f72 6465 725f 7479 7065 2e69 645f 6f72  order_type.id_or
-0004d410: 6465 725f 7479 7065 2c20 7365 6c66 2e6f  der_type, self.o
-0004d420: 776e 6572 2c20 7374 6172 745f 6461 7465  wner, start_date
-0004d430: 2c20 274e 554c 4c27 5d0d 0a20 2020 2020  , 'NULL']..     
-0004d440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004d450: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-0004d460: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
-0004d470: 745f 6f72 6465 7228 5b6e 6577 5f6f 7264  t_order([new_ord
-0004d480: 6572 5d29 0d0a 2020 2020 2020 2020 2020  er])..          
-0004d490: 2020 2020 2020 6f72 6465 725f 6c6f 6164        order_load
-0004d4a0: 6564 2e61 7070 656e 6428 5b64 6174 6173  ed.append([datas
-0004d4b0: 6574 2e69 645f 6461 7461 7365 742c 206f  et.id_dataset, o
-0004d4c0: 7264 6572 2e6e 756d 5f62 7261 6e63 682c  rder.num_branch,
-0004d4d0: 2064 6174 6173 6574 5f73 7065 632e 6964   dataset_spec.id
-0004d4e0: 5f64 6174 6173 6574 5f73 7065 635d 290d  _dataset_spec]).
-0004d4f0: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
-0004d500: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0004d510: 2020 2020 2020 2320 5570 6461 7465 206f        # Update o
-0004d520: 7264 6572 206f 6e6c 790d 0a20 2020 2020  rder only..     
-0004d530: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-0004d540: 7468 6520 6174 7472 6962 7574 6573 2061  the attributes a
-0004d550: 7265 2074 6865 2064 6966 6572 656e 742c  re the diferent,
-0004d560: 2074 6865 2072 6567 6973 7465 7220 7769   the register wi
-0004d570: 6c6c 2062 6520 636c 6f73 6564 0d0a 2020  ll be closed..  
-0004d580: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004d590: 206f 7264 6572 5f65 7869 7374 656e 742e   order_existent.
-0004d5a0: 6964 5f6f 7264 6572 5f74 7970 6520 3d3d  id_order_type ==
-0004d5b0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-0004d5c0: 6374 7561 6c2e 6765 745f 6f72 6465 725f  ctual.get_order_
-0004d5d0: 7479 7065 5f66 726f 6d5f 6f72 6465 725f  type_from_order_
-0004d5e0: 7479 7065 5f76 616c 7565 280d 0a20 2020  type_value(..   
-0004d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d600: 2020 2020 206f 7264 6572 2e6f 7264 6572       order.order
-0004d610: 5f74 7970 6529 2e69 645f 6f72 6465 725f  _type).id_order_
-0004d620: 7479 7065 3a0d 0a20 2020 2020 2020 2020  type:..         
-0004d630: 2020 2020 2020 2020 2020 2073 616d 655f             same_
-0004d640: 6f72 6465 7220 3d20 5b6f 7264 6572 5f65  order = [order_e
-0004d650: 7869 7374 656e 742e 6964 5f74 5f6f 7264  xistent.id_t_ord
-0004d660: 6572 2c20 6f72 6465 725f 6578 6973 7465  er, order_existe
-0004d670: 6e74 2e69 645f 6461 7461 7365 742c 206f  nt.id_dataset, o
-0004d680: 7264 6572 5f65 7869 7374 656e 742e 6964  rder_existent.id
-0004d690: 5f62 7261 6e63 682c 0d0a 2020 2020 2020  _branch,..      
-0004d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6b0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0004d6c0: 725f 6578 6973 7465 6e74 2e69 645f 6461  r_existent.id_da
-0004d6d0: 7461 7365 745f 7370 6563 2c0d 0a20 2020  taset_spec,..   
-0004d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d6f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0004d700: 7264 6572 5f65 7869 7374 656e 742e 6964  rder_existent.id
-0004d710: 5f6f 7264 6572 5f74 7970 652c 206f 7264  _order_type, ord
-0004d720: 6572 5f65 7869 7374 656e 742e 6d65 7461  er_existent.meta
-0004d730: 5f6f 776e 6572 2c0d 0a20 2020 2020 2020  _owner,..       
-0004d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d750: 2020 2020 2020 2020 2020 2022 2722 202b             "'" +
-0004d760: 2073 7472 286f 7264 6572 5f65 7869 7374   str(order_exist
-0004d770: 656e 742e 7374 6172 745f 6461 7465 2920  ent.start_date) 
-0004d780: 2b20 2227 222c 2022 4e55 4c4c 225d 0d0a  + "'", "NULL"]..
-0004d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d7a0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0004d7b0: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
-0004d7c0: 5f64 6174 6173 6574 5f74 5f6f 7264 6572  _dataset_t_order
-0004d7d0: 285b 7361 6d65 5f6f 7264 6572 5d29 0d0a  ([same_order])..
-0004d7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d7f0: 2020 2020 6f72 6465 725f 6c6f 6164 6564      order_loaded
-0004d800: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
-0004d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d820: 2020 5b6f 7264 6572 5f65 7869 7374 656e    [order_existen
-0004d830: 742e 6964 5f64 6174 6173 6574 2c20 6f72  t.id_dataset, or
-0004d840: 6465 725f 6578 6973 7465 6e74 2e69 645f  der_existent.id_
-0004d850: 6272 616e 6368 2c20 6f72 6465 725f 6578  branch, order_ex
-0004d860: 6973 7465 6e74 2e69 645f 6461 7461 7365  istent.id_datase
-0004d870: 745f 7370 6563 5d29 0d0a 2020 2020 2020  t_spec])..      
-0004d880: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0004d890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d8a0: 2020 2020 2063 6c6f 7365 5f6f 7264 6572       close_order
-0004d8b0: 203d 205b 6f72 6465 725f 6578 6973 7465   = [order_existe
-0004d8c0: 6e74 2e69 645f 745f 6f72 6465 722c 206f  nt.id_t_order, o
-0004d8d0: 7264 6572 5f65 7869 7374 656e 742e 6964  rder_existent.id
-0004d8e0: 5f64 6174 6173 6574 2c20 6f72 6465 725f  _dataset, order_
-0004d8f0: 6578 6973 7465 6e74 2e69 645f 6272 616e  existent.id_bran
-0004d900: 6368 2c0d 0a20 2020 2020 2020 2020 2020  ch,..           
-0004d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d920: 2020 2020 2020 2020 6f72 6465 725f 6578          order_ex
-0004d930: 6973 7465 6e74 2e69 645f 6461 7461 7365  istent.id_datase
-0004d940: 745f 7370 6563 2c0d 0a20 2020 2020 2020  t_spec,..       
-0004d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d960: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0004d970: 725f 6578 6973 7465 6e74 2e69 645f 6f72  r_existent.id_or
-0004d980: 6465 725f 7479 7065 2c20 6f72 6465 725f  der_type, order_
-0004d990: 6578 6973 7465 6e74 2e6d 6574 615f 6f77  existent.meta_ow
-0004d9a0: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
-0004d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d9c0: 2020 2020 2020 2020 2022 2722 202b 2073           "'" + s
-0004d9d0: 7472 286f 7264 6572 5f65 7869 7374 656e  tr(order_existen
-0004d9e0: 742e 7374 6172 745f 6461 7465 2920 2b20  t.start_date) + 
-0004d9f0: 2227 222c 2073 656c 662e 636f 6e6e 6563  "'", self.connec
-0004da00: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
-0004da10: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
-0004da20: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-0004da30: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0004da40: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
-0004da50: 645f 6f6d 5f64 6174 6173 6574 5f74 5f6f  d_om_dataset_t_o
-0004da60: 7264 6572 285b 636c 6f73 655f 6f72 6465  rder([close_orde
-0004da70: 725d 290d 0a20 2020 2020 2020 2020 2020  r])..           
-0004da80: 2020 2020 2020 2020 206f 7264 6572 5f6c           order_l
-0004da90: 6f61 6465 642e 6170 7065 6e64 280d 0a20  oaded.append(.. 
-0004daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dab0: 2020 2020 2020 205b 6f72 6465 725f 6578         [order_ex
-0004dac0: 6973 7465 6e74 2e69 645f 6461 7461 7365  istent.id_datase
-0004dad0: 742c 206f 7264 6572 5f65 7869 7374 656e  t, order_existen
-0004dae0: 742e 6964 5f62 7261 6e63 682c 206f 7264  t.id_branch, ord
-0004daf0: 6572 5f65 7869 7374 656e 742e 6964 5f64  er_existent.id_d
-0004db00: 6174 6173 6574 5f73 7065 635d 290d 0a20  ataset_spec]).. 
-0004db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004db20: 2020 2069 645f 745f 6f72 6465 7220 3d20     id_t_order = 
-0004db30: 6e65 7874 5f69 645f 745f 6f72 6465 720d  next_id_t_order.
-0004db40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004db50: 2020 2020 206e 6578 745f 6964 5f74 5f6f       next_id_t_o
-0004db60: 7264 6572 202b 3d20 310d 0a20 2020 2020  rder += 1..     
-0004db70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0004db80: 6577 5f6f 7264 6572 203d 205b 6964 5f74  ew_order = [id_t
-0004db90: 5f6f 7264 6572 2c20 6461 7461 7365 742e  _order, dataset.
-0004dba0: 6964 5f64 6174 6173 6574 2c20 6f72 6465  id_dataset, orde
-0004dbb0: 722e 6e75 6d5f 6272 616e 6368 2c20 6461  r.num_branch, da
-0004dbc0: 7461 7365 745f 7370 6563 2e69 645f 6461  taset_spec.id_da
-0004dbd0: 7461 7365 745f 7370 6563 2c0d 0a20 2020  taset_spec,..   
-0004dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dbf0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004dc00: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0004dc10: 616c 2e67 6574 5f6f 7264 6572 5f74 7970  al.get_order_typ
-0004dc20: 655f 6672 6f6d 5f6f 7264 6572 5f74 7970  e_from_order_typ
-0004dc30: 655f 7661 6c75 6528 0d0a 2020 2020 2020  e_value(..      
-0004dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dc50: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0004dc60: 7264 6572 2e6f 7264 6572 5f74 7970 6529  rder.order_type)
-0004dc70: 2e69 645f 6f72 6465 725f 7479 7065 2c0d  .id_order_type,.
-0004dc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004cbe0: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+0004cbf0: 6c65 5f64 6566 696e 6974 696f 6e5f 7370  le_definition_sp
+0004cc00: 6563 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ec.column_length
+0004cc10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cc40: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+0004cc50: 655f 6465 6669 6e69 7469 6f6e 5f73 7065  e_definition_spe
+0004cc60: 632e 636f 6c75 6d6e 5f70 7265 6369 7369  c.column_precisi
+0004cc70: 6f6e 2c20 7461 626c 655f 6465 6669 6e69  on, table_defini
+0004cc80: 7469 6f6e 5f73 7065 632e 636f 6c75 6d6e  tion_spec.column
+0004cc90: 5f73 6361 6c65 2c0d 0a20 2020 2020 2020  _scale,..       
+0004cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ccd0: 2020 7365 6c66 2e6f 776e 6572 2c20 7374    self.owner, st
+0004cce0: 6172 745f 6461 7465 2c20 656e 645f 6461  art_date, end_da
+0004ccf0: 7465 5d0d 0a20 2020 2020 2020 2020 2020  te]..           
+0004cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cd10: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
+0004cd20: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
+0004cd30: 7461 7365 745f 7370 6563 6966 6963 6174  taset_specificat
+0004cd40: 696f 6e28 5b6e 6577 5f64 6174 6173 6574  ion([new_dataset
+0004cd50: 5f73 7065 6369 6669 6361 7469 6f6e 5d29  _specification])
+0004cd60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004cd70: 2020 2020 2020 2020 2020 2020 2020 746d                tm
+0004cd80: 705f 7370 6563 735f 6c6f 6164 6564 2e61  p_specs_loaded.a
+0004cd90: 7070 656e 6428 5b64 6174 6173 6574 2e69  ppend([dataset.i
+0004cda0: 645f 6461 7461 7365 742c 2074 6162 6c65  d_dataset, table
+0004cdb0: 5f64 6566 696e 6974 696f 6e5f 7370 6563  _definition_spec
+0004cdc0: 2e63 6f6c 756d 6e5f 6e61 6d65 5d29 0d0a  .column_name])..
+0004cdd0: 0d0a 2020 2020 2020 2020 2320 436c 6f73  ..        # Clos
+0004cde0: 6520 7461 626c 6573 2074 6861 7420 6e6f  e tables that no
+0004cdf0: 7420 6172 7269 7665 2061 6e79 6d6f 7265  t arrive anymore
+0004ce00: 0d0a 2020 2020 2020 2020 666f 7220 6461  ..        for da
+0004ce10: 7461 7365 7420 696e 205b 7820 666f 7220  taset in [x for 
+0004ce20: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
+0004ce30: 7461 5f61 6374 7561 6c2e 6f6d 5f64 6174  ta_actual.om_dat
+0004ce40: 6173 6574 2069 6620 782e 6964 5f65 6e74  aset if x.id_ent
+0004ce50: 6974 795f 7479 7065 203d 3d20 7365 6c66  ity_type == self
+0004ce60: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+0004ce70: 2e67 6574 5f65 6e74 6974 795f 7479 7065  .get_entity_type
+0004ce80: 5f66 726f 6d5f 656e 7469 7479 5f74 7970  _from_entity_typ
+0004ce90: 655f 6e61 6d65 2845 4e54 4954 595f 5442  e_name(ENTITY_TB
+0004cea0: 292e 6964 5f65 6e74 6974 795f 7479 7065  ).id_entity_type
+0004ceb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004cec0: 2020 2020 2020 2020 2020 6f72 2078 2e69            or x.i
+0004ced0: 645f 656e 7469 7479 5f74 7970 653d 3d20  d_entity_type== 
+0004cee0: 7365 6c66 2e6d 6574 6164 6174 615f 6163  self.metadata_ac
+0004cef0: 7475 616c 2e67 6574 5f65 6e74 6974 795f  tual.get_entity_
+0004cf00: 7479 7065 5f66 726f 6d5f 656e 7469 7479  type_from_entity
+0004cf10: 5f74 7970 655f 6e61 6d65 2845 4e54 4954  _type_name(ENTIT
+0004cf20: 595f 5749 5448 292e 6964 5f65 6e74 6974  Y_WITH).id_entit
+0004cf30: 795f 7479 7065 5d3a 0d0a 2020 2020 2020  y_type]:..      
+0004cf40: 2020 2020 2020 6966 205b 6461 7461 7365        if [datase
+0004cf50: 742e 6461 7461 7365 745f 6e61 6d65 2c20  t.dataset_name, 
+0004cf60: 6461 7461 7365 742e 6964 5f65 6e74 6974  dataset.id_entit
+0004cf70: 795f 7479 7065 2c20 6461 7461 7365 742e  y_type, dataset.
+0004cf80: 6964 5f70 6174 685d 206e 6f74 2069 6e20  id_path] not in 
+0004cf90: 746d 705f 6c6f 6164 6564 2061 6e64 2064  tmp_loaded and d
+0004cfa0: 6174 6173 6574 2e65 6e64 5f64 6174 6520  ataset.end_date 
+0004cfb0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0004cfc0: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
+0004cfd0: 736f 7572 6365 203d 205b 6461 7461 7365  source = [datase
+0004cfe0: 742e 6964 5f64 6174 6173 6574 2c20 6461  t.id_dataset, da
+0004cff0: 7461 7365 742e 6461 7461 7365 745f 6e61  taset.dataset_na
+0004d000: 6d65 2c20 6461 7461 7365 742e 6964 5f65  me, dataset.id_e
+0004d010: 6e74 6974 795f 7479 7065 2c0d 0a20 2020  ntity_type,..   
+0004d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d030: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0004d040: 6173 6574 2e69 645f 7061 7468 2c20 6461  aset.id_path, da
+0004d050: 7461 7365 742e 6d65 7461 5f6f 776e 6572  taset.meta_owner
+0004d060: 2c20 2227 2220 2b20 7374 7228 6461 7461  , "'" + str(data
+0004d070: 7365 742e 7374 6172 745f 6461 7465 2920  set.start_date) 
+0004d080: 2b20 2227 222c 0d0a 2020 2020 2020 2020  + "'",..        
+0004d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d0a0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+0004d0b0: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
+0004d0c0: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
+0004d0d0: 7565 2829 5d0d 0a20 2020 2020 2020 2020  ue()]..         
+0004d0e0: 2020 2020 2020 2073 656c 662e 6d65 7461         self.meta
+0004d0f0: 6461 7461 5f74 6f5f 6c6f 6164 2e61 6464  data_to_load.add
+0004d100: 5f6f 6d5f 6461 7461 7365 7428 5b63 6c6f  _om_dataset([clo
+0004d110: 7365 5f73 6f75 7263 655d 290d 0a20 2020  se_source])..   
+0004d120: 2020 2020 2023 2043 6c6f 7365 2053 7065       # Close Spe
+0004d130: 6369 6669 6361 7469 6f6e 7320 7468 6174  cifications that
+0004d140: 206e 6f74 2061 7272 6976 6520 616e 796d   not arrive anym
+0004d150: 6f72 650d 0a20 2020 2020 2020 2066 6f72  ore..        for
+0004d160: 2064 6174 6173 6574 5f73 7065 6320 696e   dataset_spec in
+0004d170: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0004d180: 6374 7561 6c2e 6f6d 5f64 6174 6173 6574  ctual.om_dataset
+0004d190: 5f73 7065 6369 6669 6361 7469 6f6e 3a0d  _specification:.
+0004d1a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0004d1b0: 5b64 6174 6173 6574 5f73 7065 632e 6964  [dataset_spec.id
+0004d1c0: 5f64 6174 6173 6574 2c20 6461 7461 7365  _dataset, datase
+0004d1d0: 745f 7370 6563 2e63 6f6c 756d 6e5f 6e61  t_spec.column_na
+0004d1e0: 6d65 5d20 6e6f 7420 696e 2074 6d70 5f73  me] not in tmp_s
+0004d1f0: 7065 6373 5f6c 6f61 6465 6420 616e 6420  pecs_loaded and 
+0004d200: 5b64 6174 6173 6574 5f73 7065 632e 6964  [dataset_spec.id
+0004d210: 5f64 6174 6173 6574 2c20 6461 7461 7365  _dataset, datase
+0004d220: 745f 7370 6563 2e63 6f6c 756d 6e5f 6e61  t_spec.column_na
+0004d230: 6d65 5d20 6e6f 7420 696e 2073 6f75 7263  me] not in sourc
+0004d240: 6573 5f73 7065 6373 5f6c 6f61 6465 6420  es_specs_loaded 
+0004d250: 616e 6420 6461 7461 7365 745f 7370 6563  and dataset_spec
+0004d260: 2e65 6e64 5f64 6174 6520 6973 204e 6f6e  .end_date is Non
+0004d270: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0004d280: 2020 2020 636c 6f73 655f 6461 7461 7365      close_datase
+0004d290: 745f 7370 6563 203d 205b 6461 7461 7365  t_spec = [datase
+0004d2a0: 745f 7370 6563 2e69 645f 6461 7461 7365  t_spec.id_datase
+0004d2b0: 745f 7370 6563 2c20 6461 7461 7365 745f  t_spec, dataset_
+0004d2c0: 7370 6563 2e69 645f 6461 7461 7365 742c  spec.id_dataset,
+0004d2d0: 2064 6174 6173 6574 5f73 7065 632e 6964   dataset_spec.id
+0004d2e0: 5f6b 6579 5f74 7970 652c 0d0a 2020 2020  _key_type,..    
+0004d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d310: 2020 6461 7461 7365 745f 7370 6563 2e63    dataset_spec.c
+0004d320: 6f6c 756d 6e5f 6e61 6d65 2c20 6461 7461  olumn_name, data
+0004d330: 7365 745f 7370 6563 2e63 6f6c 756d 6e5f  set_spec.column_
+0004d340: 7479 7065 2c20 6461 7461 7365 745f 7370  type, dataset_sp
+0004d350: 6563 2e6f 7264 696e 616c 5f70 6f73 6974  ec.ordinal_posit
+0004d360: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+0004d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d380: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0004d390: 7365 745f 7370 6563 2e69 735f 6e75 6c6c  set_spec.is_null
+0004d3a0: 6162 6c65 2c20 6461 7461 7365 745f 7370  able, dataset_sp
+0004d3b0: 6563 2e63 6f6c 756d 6e5f 6c65 6e67 7468  ec.column_length
+0004d3c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d3e0: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+0004d3f0: 5f73 7065 632e 636f 6c75 6d6e 5f70 7265  _spec.column_pre
+0004d400: 6369 7369 6f6e 2c0d 0a20 2020 2020 2020  cision,..       
+0004d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d420: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0004d430: 6174 6173 6574 5f73 7065 632e 636f 6c75  ataset_spec.colu
+0004d440: 6d6e 5f73 6361 6c65 2c20 6461 7461 7365  mn_scale, datase
+0004d450: 745f 7370 6563 2e6d 6574 615f 6f77 6e65  t_spec.meta_owne
+0004d460: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+0004d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d480: 2020 2020 2020 2020 2020 2227 2220 2b20            "'" + 
+0004d490: 7374 7228 6461 7461 7365 745f 7370 6563  str(dataset_spec
+0004d4a0: 2e73 7461 7274 5f64 6174 6529 202b 2022  .start_date) + "
+0004d4b0: 2722 2c20 7365 6c66 2e63 6f6e 6e65 6374  '", self.connect
+0004d4c0: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
+0004d4d0: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
+0004d4e0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0004d4f0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+0004d500: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+0004d510: 6461 7461 7365 745f 7370 6563 6966 6963  dataset_specific
+0004d520: 6174 696f 6e28 5b63 6c6f 7365 5f64 6174  ation([close_dat
+0004d530: 6173 6574 5f73 7065 635d 290d 0a0d 0a20  aset_spec]).... 
+0004d540: 2020 2020 2020 2073 656c 662e 6e65 7874         self.next
+0004d550: 5f69 645f 6461 7461 7365 7420 3d20 6e65  _id_dataset = ne
+0004d560: 7874 5f69 645f 6461 7461 7365 740d 0a20  xt_id_dataset.. 
+0004d570: 2020 2020 2020 2073 656c 662e 6e65 7874         self.next
+0004d580: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
+0004d590: 203d 206e 6578 745f 6964 5f64 6174 6173   = next_id_datas
+0004d5a0: 6574 5f73 7065 630d 0a0d 0a20 2020 2020  et_spec....     
+0004d5b0: 2020 2073 656c 662e 6c6f 672e 6c6f 6728     self.log.log(
+0004d5c0: 7365 6c66 2e65 6e67 696e 655f 6e61 6d65  self.engine_name
+0004d5d0: 2c20 2246 696e 6973 6865 6420 746f 2070  , "Finished to p
+0004d5e0: 726f 6365 7373 204d 6574 6164 6174 6120  rocess Metadata 
+0004d5f0: 5b20 536f 7572 6365 7320 5d20 696e 666f  [ Sources ] info
+0004d600: 726d 6174 696f 6e22 2c20 4c4f 475f 4c45  rmation", LOG_LE
+0004d610: 5645 4c5f 4f4e 4c59 5f4c 4f47 290d 0a0d  VEL_ONLY_LOG)...
+0004d620: 0a20 2020 2064 6566 2070 726f 6365 7373  .    def process
+0004d630: 5f65 6c74 5f6f 7264 6572 2873 656c 6629  _elt_order(self)
+0004d640: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0004d650: 6c6f 672e 6c6f 6728 7365 6c66 2e65 6e67  log.log(self.eng
+0004d660: 696e 655f 6e61 6d65 2c20 2253 7461 7274  ine_name, "Start
+0004d670: 696e 6720 746f 2070 726f 6365 7373 204d  ing to process M
+0004d680: 6574 6164 6174 6120 5b20 4f72 6465 7220  etadata [ Order 
+0004d690: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+0004d6a0: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+0004d6b0: 4f47 290d 0a20 2020 2020 2020 206e 6578  OG)..        nex
+0004d6c0: 745f 6964 5f74 5f6f 7264 6572 203d 2073  t_id_t_order = s
+0004d6d0: 656c 662e 6e65 7874 5f69 645f 745f 6f72  elf.next_id_t_or
+0004d6e0: 6465 720d 0a20 2020 2020 2020 2023 2323  der..        ###
+0004d6f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004d700: 2323 2323 2320 4c4f 4144 204f 5244 4552  ##### LOAD ORDER
+0004d710: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+0004d720: 2323 2323 2323 2323 230d 0a20 2020 2020  #########..     
+0004d730: 2020 2023 2049 6e70 7574 204f 7264 6572     # Input Order
+0004d740: 730d 0a20 2020 2020 2020 206f 7264 6572  s..        order
+0004d750: 5f6c 6f61 6465 6420 3d20 5b5d 0d0a 2020  _loaded = []..  
+0004d760: 2020 2020 2020 666f 7220 6f72 6465 7220        for order 
+0004d770: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
+0004d780: 5f61 6374 7561 6c2e 656e 7472 795f 6f72  _actual.entry_or
+0004d790: 6465 723a 0d0a 0d0a 2020 2020 2020 2020  der:....        
+0004d7a0: 2020 2020 6461 7461 7365 7420 3d20 7365      dataset = se
+0004d7b0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+0004d7c0: 6f61 642e 6765 745f 6461 7461 7365 745f  oad.get_dataset_
+0004d7d0: 6672 6f6d 5f64 6174 6173 6574 5f6e 616d  from_dataset_nam
+0004d7e0: 6528 7365 6c66 2e6d 6574 6164 6174 615f  e(self.metadata_
+0004d7f0: 6163 7475 616c 2e67 6574 5f74 6162 6c65  actual.get_table
+0004d800: 5f6e 616d 655f 6672 6f6d 5f63 6f64 5f65  _name_from_cod_e
+0004d810: 6e74 6974 795f 6f6e 5f65 6e74 7279 286f  ntity_on_entry(o
+0004d820: 7264 6572 2e63 6f64 5f65 6e74 6974 795f  rder.cod_entity_
+0004d830: 7461 7267 6574 2929 0d0a 2020 2020 2020  target))..      
+0004d840: 2020 2020 2020 6461 7461 7365 745f 7372        dataset_sr
+0004d850: 6320 3d20 7365 6c66 2e6d 6574 6164 6174  c = self.metadat
+0004d860: 615f 746f 5f6c 6f61 642e 6765 745f 6461  a_to_load.get_da
+0004d870: 7461 7365 745f 6672 6f6d 5f64 6174 6173  taset_from_datas
+0004d880: 6574 5f6e 616d 6528 7365 6c66 2e6d 6574  et_name(self.met
+0004d890: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+0004d8a0: 5f74 6162 6c65 5f6e 616d 655f 6672 6f6d  _table_name_from
+0004d8b0: 5f63 6f64 5f65 6e74 6974 795f 6f6e 5f65  _cod_entity_on_e
+0004d8c0: 6e74 7279 286f 7264 6572 2e63 6f64 5f65  ntry(order.cod_e
+0004d8d0: 6e74 6974 795f 7372 6329 290d 0a20 2020  ntity_src))..   
+0004d8e0: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+0004d8f0: 5f73 7065 6320 3d20 7365 6c66 2e6d 6574  _spec = self.met
+0004d900: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
+0004d910: 745f 6461 7461 7365 745f 7370 6563 5f66  t_dataset_spec_f
+0004d920: 726f 6d5f 6964 5f64 6174 6173 6574 5f61  rom_id_dataset_a
+0004d930: 6e64 5f63 6f6c 756d 6e5f 6e61 6d65 2864  nd_column_name(d
+0004d940: 6174 6173 6574 5f73 7263 2e69 645f 6461  ataset_src.id_da
+0004d950: 7461 7365 742c 206f 7264 6572 2e63 6f6c  taset, order.col
+0004d960: 756d 6e5f 6e61 6d65 290d 0a0d 0a20 2020  umn_name)....   
+0004d970: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
+0004d980: 2049 6e63 6c75 6972 2065 7374 6120 7661   Incluir esta va
+0004d990: 6c69 6461 6369 c3b3 6e20 656e 2074 6f64  lidaci..n en tod
+0004d9a0: 6f73 206c 6f73 2070 726f 6365 736f 7320  os los procesos 
+0004d9b0: 2d3e 2053 6920 6e6f 2065 7869 7374 6520  -> Si no existe 
+0004d9c0: 656c 2063 616d 706f 202d 3e20 7361 6361  el campo -> saca
+0004d9d0: 7220 616c 6572 7461 0d0a 2020 2020 2020  r alerta..      
+0004d9e0: 2020 2020 2020 2320 6966 2064 6174 6173        # if datas
+0004d9f0: 6574 5f73 7065 6320 6973 204e 6f6e 653a  et_spec is None:
+0004da00: 202d 3e20 6c61 6e7a 6172 2065 7272 6f72   -> lanzar error
+0004da10: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+0004da20: 6465 725f 6578 6973 7465 6e74 203d 2073  der_existent = s
+0004da30: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+0004da40: 7561 6c2e 6765 745f 6f72 6465 725f 6672  ual.get_order_fr
+0004da50: 6f6d 5f69 645f 6461 7461 7365 745f 616e  om_id_dataset_an
+0004da60: 645f 6964 5f64 6174 6173 6574 5f73 7065  d_id_dataset_spe
+0004da70: 635f 616e 645f 6964 5f62 7261 6e63 6828  c_and_id_branch(
+0004da80: 6461 7461 7365 742e 6964 5f64 6174 6173  dataset.id_datas
+0004da90: 6574 2c20 6461 7461 7365 745f 7370 6563  et, dataset_spec
+0004daa0: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
+0004dab0: 2c20 6f72 6465 722e 6e75 6d5f 6272 616e  , order.num_bran
+0004dac0: 6368 290d 0a0d 0a20 2020 2020 2020 2020  ch)....         
+0004dad0: 2020 2069 6620 6f72 6465 725f 6578 6973     if order_exis
+0004dae0: 7465 6e74 2069 7320 4e6f 6e65 3a0d 0a20  tent is None:.. 
+0004daf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0004db00: 204e 6577 206f 7264 6572 0d0a 2020 2020   New order..    
+0004db10: 2020 2020 2020 2020 2020 2020 6964 5f74              id_t
+0004db20: 5f6f 7264 6572 203d 206e 6578 745f 6964  _order = next_id
+0004db30: 5f74 5f6f 7264 6572 0d0a 2020 2020 2020  _t_order..      
+0004db40: 2020 2020 2020 2020 2020 6e65 7874 5f69            next_i
+0004db50: 645f 745f 6f72 6465 7220 2b3d 2031 0d0a  d_t_order += 1..
+0004db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004db70: 6f72 6465 725f 7479 7065 203d 2073 656c  order_type = sel
+0004db80: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0004db90: 6c2e 6765 745f 6f72 6465 725f 7479 7065  l.get_order_type
+0004dba0: 5f66 726f 6d5f 6f72 6465 725f 7479 7065  _from_order_type
+0004dbb0: 5f76 616c 7565 286f 7264 6572 2e6f 7264  _value(order.ord
+0004dbc0: 6572 5f74 7970 6529 0d0a 2020 2020 2020  er_type)..      
+0004dbd0: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+0004dbe0: 6461 7465 203d 2073 656c 662e 636f 6e6e  date = self.conn
+0004dbf0: 6563 7469 6f6e 5f6d 6574 6164 6174 612e  ection_metadata.
+0004dc00: 6765 745f 7379 7364 6174 655f 7661 6c75  get_sysdate_valu
+0004dc10: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+0004dc20: 2020 2020 206e 6577 5f6f 7264 6572 203d       new_order =
+0004dc30: 205b 6964 5f74 5f6f 7264 6572 2c20 6461   [id_t_order, da
+0004dc40: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
+0004dc50: 2c20 6f72 6465 722e 6e75 6d5f 6272 616e  , order.num_bran
+0004dc60: 6368 2c20 6461 7461 7365 745f 7370 6563  ch, dataset_spec
+0004dc70: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
+0004dc80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0004dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dca0: 2020 7365 6c66 2e6f 776e 6572 2c20 7365    self.owner, se
-0004dcb0: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-0004dcc0: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-0004dcd0: 7465 5f76 616c 7565 2829 2c20 224e 554c  te_value(), "NUL
-0004dce0: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
-0004dcf0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0004dd00: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-0004dd10: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
-0004dd20: 6f72 6465 7228 5b6e 6577 5f6f 7264 6572  order([new_order
-0004dd30: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0004dd40: 2020 2020 2020 2020 6f72 6465 725f 6c6f          order_lo
-0004dd50: 6164 6564 2e61 7070 656e 6428 5b64 6174  aded.append([dat
-0004dd60: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
-0004dd70: 206f 7264 6572 2e6e 756d 5f62 7261 6e63   order.num_branc
-0004dd80: 682c 2064 6174 6173 6574 5f73 7065 632e  h, dataset_spec.
-0004dd90: 6964 5f64 6174 6173 6574 5f73 7065 635d  id_dataset_spec]
-0004dda0: 290d 0a0d 0a20 2020 2020 2020 2023 2043  )....        # C
-0004ddb0: 6c6f 7365 206f 7264 6572 2074 6861 7420  lose order that 
-0004ddc0: 6e6f 7420 6172 7269 7665 2061 6e79 6d6f  not arrive anymo
-0004ddd0: 7265 0d0a 2020 2020 2020 2020 666f 7220  re..        for 
-0004dde0: 6f72 6465 725f 7479 7065 2069 6e20 5b78  order_type in [x
-0004ddf0: 2066 6f72 2078 2069 6e20 7365 6c66 2e6d   for x in self.m
-0004de00: 6574 6164 6174 615f 6163 7475 616c 2e6f  etadata_actual.o
-0004de10: 6d5f 6461 7461 7365 745f 745f 6f72 6465  m_dataset_t_orde
-0004de20: 7220 6966 2078 2e65 6e64 5f64 6174 6520  r if x.end_date 
-0004de30: 6973 204e 6f6e 655d 3a0d 0a20 2020 2020  is None]:..     
-0004de40: 2020 2020 2020 2069 6620 5b6f 7264 6572         if [order
-0004de50: 5f74 7970 652e 6964 5f64 6174 6173 6574  _type.id_dataset
-0004de60: 2c20 6f72 6465 725f 7479 7065 2e69 645f  , order_type.id_
-0004de70: 6272 616e 6368 2c20 6f72 6465 725f 7479  branch, order_ty
-0004de80: 7065 2e69 645f 6461 7461 7365 745f 7370  pe.id_dataset_sp
-0004de90: 6563 5d20 6e6f 7420 696e 206f 7264 6572  ec] not in order
-0004dea0: 5f6c 6f61 6465 643a 0d0a 2020 2020 2020  _loaded:..      
-0004deb0: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
-0004dec0: 6f72 6465 7220 3d20 5b6f 7264 6572 5f74  order = [order_t
-0004ded0: 7970 652e 6964 5f74 5f6f 7264 6572 2c20  ype.id_t_order, 
-0004dee0: 6f72 6465 725f 7479 7065 2e69 645f 6461  order_type.id_da
-0004def0: 7461 7365 742c 206f 7264 6572 5f74 7970  taset, order_typ
-0004df00: 652e 6964 5f62 7261 6e63 682c 0d0a 2020  e.id_branch,..  
-0004df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004df20: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-0004df30: 6572 5f74 7970 652e 6964 5f64 6174 6173  er_type.id_datas
-0004df40: 6574 5f73 7065 632c 0d0a 2020 2020 2020  et_spec,..      
-0004df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004df60: 2020 2020 2020 2020 206f 7264 6572 5f74           order_t
-0004df70: 7970 652e 6964 5f6f 7264 6572 5f74 7970  ype.id_order_typ
-0004df80: 652c 206f 7264 6572 5f74 7970 652e 6d65  e, order_type.me
-0004df90: 7461 5f6f 776e 6572 2c20 2227 2220 2b20  ta_owner, "'" + 
-0004dfa0: 7374 7228 6f72 6465 725f 7479 7065 2e73  str(order_type.s
-0004dfb0: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
-0004dfc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dfe0: 2020 7365 6c66 2e63 6f6e 6e65 6374 696f    self.connectio
-0004dff0: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
-0004e000: 7973 6461 7465 5f76 616c 7565 2829 5d0d  ysdate_value()].
-0004e010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e020: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
-0004e030: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
-0004e040: 7461 7365 745f 745f 6f72 6465 7228 5b63  taset_t_order([c
-0004e050: 6c6f 7365 5f6f 7264 6572 5d29 0d0a 0d0a  lose_order])....
-0004e060: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0004e070: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
-0004e080: 5f6e 616d 652c 2022 4669 6e69 7368 6564  _name, "Finished
-0004e090: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
-0004e0a0: 6461 7461 205b 204f 7264 6572 205d 2069  data [ Order ] i
-0004e0b0: 6e66 6f72 6d61 7469 6f6e 222c 204c 4f47  nformation", LOG
-0004e0c0: 5f4c 4556 454c 5f4f 4e4c 595f 4c4f 4729  _LEVEL_ONLY_LOG)
-0004e0d0: 0d0a 0d0a 2020 2020 6465 6620 7072 6f63  ....    def proc
-0004e0e0: 6573 735f 656c 745f 6669 6c65 7328 7365  ess_elt_files(se
-0004e0f0: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
-0004e100: 6c66 2e6c 6f67 2e6c 6f67 2873 656c 662e  lf.log.log(self.
-0004e110: 656e 6769 6e65 5f6e 616d 652c 2022 5374  engine_name, "St
-0004e120: 6172 7469 6e67 2074 6f20 7072 6f63 6573  arting to proces
-0004e130: 7320 4d65 7461 6461 7461 205b 2046 696c  s Metadata [ Fil
-0004e140: 6573 205d 2069 6e66 6f72 6d61 7469 6f6e  es ] information
-0004e150: 222c 204c 4f47 5f4c 4556 454c 5f4f 4e4c  ", LOG_LEVEL_ONL
-0004e160: 595f 4c4f 4729 0d0a 2020 2020 2020 2020  Y_LOG)..        
-0004e170: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004e180: 2323 2323 2323 2323 204c 4f41 4420 4f52  ######## LOAD OR
-0004e190: 4445 5220 2323 2323 2323 2323 2323 2323  DER ############
-0004e1a0: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
-0004e1b0: 2020 2020 2020 2320 496e 7075 7420 4f72        # Input Or
-0004e1c0: 6465 7273 0d0a 2020 2020 2020 2020 6669  ders..        fi
-0004e1d0: 6c65 735f 6c6f 6164 6564 203d 205b 5d0d  les_loaded = [].
-0004e1e0: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
-0004e1f0: 6520 696e 2073 656c 662e 6d65 7461 6461  e in self.metada
-0004e200: 7461 5f61 6374 7561 6c2e 656e 7472 795f  ta_actual.entry_
-0004e210: 6669 6c65 733a 0d0a 0d0a 2020 2020 2020  files:....      
-0004e220: 2020 2020 2020 6461 7461 7365 7420 3d20        dataset = 
-0004e230: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-0004e240: 5f6c 6f61 642e 6765 745f 6461 7461 7365  _load.get_datase
-0004e250: 745f 6672 6f6d 5f64 6174 6173 6574 5f6e  t_from_dataset_n
-0004e260: 616d 6528 7365 6c66 2e6d 6574 6164 6174  ame(self.metadat
-0004e270: 615f 6163 7475 616c 2e67 6574 5f74 6162  a_actual.get_tab
-0004e280: 6c65 5f6e 616d 655f 6672 6f6d 5f63 6f64  le_name_from_cod
-0004e290: 5f65 6e74 6974 795f 6f6e 5f65 6e74 7279  _entity_on_entry
-0004e2a0: 2866 696c 652e 636f 645f 656e 7469 7479  (file.cod_entity
-0004e2b0: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-0004e2c0: 2020 6461 7461 7365 745f 6669 6c65 5f65    dataset_file_e
-0004e2d0: 7869 7374 656e 7420 3d20 7365 6c66 2e6d  xistent = self.m
-0004e2e0: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-0004e2f0: 6574 5f6f 6d5f 6461 7461 7365 745f 6669  et_om_dataset_fi
-0004e300: 6c65 5f66 726f 6d5f 6964 5f64 6174 6173  le_from_id_datas
-0004e310: 6574 2864 6174 6173 6574 2e69 645f 6461  et(dataset.id_da
-0004e320: 7461 7365 7429 0d0a 0d0a 2020 2020 2020  taset)....      
-0004e330: 2020 2020 2020 6966 2064 6174 6173 6574        if dataset
-0004e340: 5f66 696c 655f 6578 6973 7465 6e74 2069  _file_existent i
-0004e350: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-0004e360: 2020 2020 2020 2020 2023 204e 6577 2066           # New f
-0004e370: 696c 650d 0a20 2020 2020 2020 2020 2020  ile..           
-0004e380: 2020 2020 2073 7461 7274 5f64 6174 6520       start_date 
-0004e390: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
-0004e3a0: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
-0004e3b0: 7973 6461 7465 5f76 616c 7565 2829 0d0a  ysdate_value()..
-0004e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3d0: 6e65 775f 6669 6c65 203d 205b 6461 7461  new_file = [data
-0004e3e0: 7365 742e 6964 5f64 6174 6173 6574 2c20  set.id_dataset, 
-0004e3f0: 6669 6c65 2e66 696c 655f 7061 7468 2c20  file.file_path, 
-0004e400: 6669 6c65 2e66 696c 655f 6e61 6d65 2c20  file.file_name, 
-0004e410: 6669 6c65 2e64 656c 696d 6974 6572 5f63  file.delimiter_c
-0004e420: 6861 7261 6374 6572 2c0d 0a20 2020 2020  haracter,..     
-0004e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e440: 2020 2020 2020 2073 656c 662e 6f77 6e65         self.owne
-0004e450: 722c 2073 7461 7274 5f64 6174 652c 2027  r, start_date, '
-0004e460: 4e55 4c4c 275d 0d0a 2020 2020 2020 2020  NULL']..        
-0004e470: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-0004e480: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
-0004e490: 645f 6f6d 5f64 6174 6173 6574 5f66 696c  d_om_dataset_fil
-0004e4a0: 6528 5b6e 6577 5f66 696c 655d 290d 0a20  e([new_file]).. 
-0004e4b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004e4c0: 696c 6573 5f6c 6f61 6465 642e 6170 7065  iles_loaded.appe
-0004e4d0: 6e64 285b 6461 7461 7365 742e 6964 5f64  nd([dataset.id_d
-0004e4e0: 6174 6173 6574 2c20 6669 6c65 2e66 696c  ataset, file.fil
-0004e4f0: 655f 7061 7468 2c20 6669 6c65 2e66 696c  e_path, file.fil
-0004e500: 655f 6e61 6d65 2c20 6669 6c65 2e64 656c  e_name, file.del
-0004e510: 696d 6974 6572 5f63 6861 7261 6374 6572  imiter_character
-0004e520: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
-0004e530: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0004e540: 2020 2020 2020 2020 2023 2055 7064 6174           # Updat
-0004e550: 6520 6669 6c65 206f 6e6c 790d 0a20 2020  e file only..   
-0004e560: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-0004e570: 6620 7468 6520 6174 7472 6962 7574 6573  f the attributes
-0004e580: 2061 7265 2074 6865 2064 6966 6572 656e   are the diferen
-0004e590: 742c 2074 6865 2072 6567 6973 7465 7220  t, the register 
-0004e5a0: 7769 6c6c 2062 6520 636c 6f73 6564 0d0a  will be closed..
-0004e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e5c0: 6966 2064 6174 6173 6574 5f66 696c 655f  if dataset_file_
-0004e5d0: 6578 6973 7465 6e74 2e66 696c 655f 7061  existent.file_pa
-0004e5e0: 7468 203d 3d20 6669 6c65 2e66 696c 655f  th == file.file_
-0004e5f0: 7061 7468 205c 0d0a 2020 2020 2020 2020  path \..        
-0004e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e610: 616e 6420 6461 7461 7365 745f 6669 6c65  and dataset_file
-0004e620: 5f65 7869 7374 656e 742e 6669 6c65 5f6e  _existent.file_n
-0004e630: 616d 6520 3d3d 2066 696c 652e 6669 6c65  ame == file.file
-0004e640: 5f6e 616d 6520 5c0d 0a20 2020 2020 2020  _name \..       
-0004e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e660: 2061 6e64 2064 6174 6173 6574 5f66 696c   and dataset_fil
-0004e670: 655f 6578 6973 7465 6e74 2e64 656c 696d  e_existent.delim
-0004e680: 6974 6572 5f63 6861 7261 6374 6572 203d  iter_character =
-0004e690: 3d20 6669 6c65 2e64 656c 696d 6974 6572  = file.delimiter
-0004e6a0: 5f63 6861 7261 6374 6572 3a0d 0a20 2020  _character:..   
-0004e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e6c0: 2073 616d 655f 6669 6c65 203d 205b 6461   same_file = [da
-0004e6d0: 7461 7365 745f 6669 6c65 5f65 7869 7374  taset_file_exist
-0004e6e0: 656e 742e 6964 5f64 6174 6173 6574 2c20  ent.id_dataset, 
-0004e6f0: 6461 7461 7365 745f 6669 6c65 5f65 7869  dataset_file_exi
-0004e700: 7374 656e 742e 6669 6c65 5f70 6174 682c  stent.file_path,
-0004e710: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e730: 2020 2064 6174 6173 6574 5f66 696c 655f     dataset_file_
-0004e740: 6578 6973 7465 6e74 2e66 696c 655f 6e61  existent.file_na
-0004e750: 6d65 2c20 6461 7461 7365 745f 6669 6c65  me, dataset_file
-0004e760: 5f65 7869 7374 656e 742e 6465 6c69 6d69  _existent.delimi
-0004e770: 7465 725f 6368 6172 6163 7465 722c 0d0a  ter_character,..
-0004e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e7a0: 2064 6174 6173 6574 5f66 696c 655f 6578   dataset_file_ex
-0004e7b0: 6973 7465 6e74 2e6d 6574 615f 6f77 6e65  istent.meta_owne
-0004e7c0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-0004e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e7e0: 2020 2020 2022 2722 202b 2073 7472 2864       "'" + str(d
-0004e7f0: 6174 6173 6574 5f66 696c 655f 6578 6973  ataset_file_exis
-0004e800: 7465 6e74 2e73 7461 7274 5f64 6174 6529  tent.start_date)
-0004e810: 202b 2022 2722 2c20 224e 554c 4c22 5d0d   + "'", "NULL"].
-0004e820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e830: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-0004e840: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
-0004e850: 6d5f 6461 7461 7365 745f 6669 6c65 285b  m_dataset_file([
-0004e860: 7361 6d65 5f66 696c 655d 290d 0a20 2020  same_file])..   
+0004dca0: 6f72 6465 725f 7479 7065 2e69 645f 6f72  order_type.id_or
+0004dcb0: 6465 725f 7479 7065 2c20 7365 6c66 2e6f  der_type, self.o
+0004dcc0: 776e 6572 2c20 7374 6172 745f 6461 7465  wner, start_date
+0004dcd0: 2c20 274e 554c 4c27 5d0d 0a20 2020 2020  , 'NULL']..     
+0004dce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004dcf0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+0004dd00: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
+0004dd10: 745f 6f72 6465 7228 5b6e 6577 5f6f 7264  t_order([new_ord
+0004dd20: 6572 5d29 0d0a 2020 2020 2020 2020 2020  er])..          
+0004dd30: 2020 2020 2020 6f72 6465 725f 6c6f 6164        order_load
+0004dd40: 6564 2e61 7070 656e 6428 5b64 6174 6173  ed.append([datas
+0004dd50: 6574 2e69 645f 6461 7461 7365 742c 206f  et.id_dataset, o
+0004dd60: 7264 6572 2e6e 756d 5f62 7261 6e63 682c  rder.num_branch,
+0004dd70: 2064 6174 6173 6574 5f73 7065 632e 6964   dataset_spec.id
+0004dd80: 5f64 6174 6173 6574 5f73 7065 635d 290d  _dataset_spec]).
+0004dd90: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
+0004dda0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0004ddb0: 2020 2020 2020 2320 5570 6461 7465 206f        # Update o
+0004ddc0: 7264 6572 206f 6e6c 790d 0a20 2020 2020  rder only..     
+0004ddd0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+0004dde0: 7468 6520 6174 7472 6962 7574 6573 2061  the attributes a
+0004ddf0: 7265 2074 6865 2064 6966 6572 656e 742c  re the diferent,
+0004de00: 2074 6865 2072 6567 6973 7465 7220 7769   the register wi
+0004de10: 6c6c 2062 6520 636c 6f73 6564 0d0a 2020  ll be closed..  
+0004de20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004de30: 206f 7264 6572 5f65 7869 7374 656e 742e   order_existent.
+0004de40: 6964 5f6f 7264 6572 5f74 7970 6520 3d3d  id_order_type ==
+0004de50: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+0004de60: 6374 7561 6c2e 6765 745f 6f72 6465 725f  ctual.get_order_
+0004de70: 7479 7065 5f66 726f 6d5f 6f72 6465 725f  type_from_order_
+0004de80: 7479 7065 5f76 616c 7565 280d 0a20 2020  type_value(..   
+0004de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dea0: 2020 2020 206f 7264 6572 2e6f 7264 6572       order.order
+0004deb0: 5f74 7970 6529 2e69 645f 6f72 6465 725f  _type).id_order_
+0004dec0: 7479 7065 3a0d 0a20 2020 2020 2020 2020  type:..         
+0004ded0: 2020 2020 2020 2020 2020 2073 616d 655f             same_
+0004dee0: 6f72 6465 7220 3d20 5b6f 7264 6572 5f65  order = [order_e
+0004def0: 7869 7374 656e 742e 6964 5f74 5f6f 7264  xistent.id_t_ord
+0004df00: 6572 2c20 6f72 6465 725f 6578 6973 7465  er, order_existe
+0004df10: 6e74 2e69 645f 6461 7461 7365 742c 206f  nt.id_dataset, o
+0004df20: 7264 6572 5f65 7869 7374 656e 742e 6964  rder_existent.id
+0004df30: 5f62 7261 6e63 682c 0d0a 2020 2020 2020  _branch,..      
+0004df40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004df50: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0004df60: 725f 6578 6973 7465 6e74 2e69 645f 6461  r_existent.id_da
+0004df70: 7461 7365 745f 7370 6563 2c0d 0a20 2020  taset_spec,..   
+0004df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004df90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0004dfa0: 7264 6572 5f65 7869 7374 656e 742e 6964  rder_existent.id
+0004dfb0: 5f6f 7264 6572 5f74 7970 652c 206f 7264  _order_type, ord
+0004dfc0: 6572 5f65 7869 7374 656e 742e 6d65 7461  er_existent.meta
+0004dfd0: 5f6f 776e 6572 2c0d 0a20 2020 2020 2020  _owner,..       
+0004dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dff0: 2020 2020 2020 2020 2020 2022 2722 202b             "'" +
+0004e000: 2073 7472 286f 7264 6572 5f65 7869 7374   str(order_exist
+0004e010: 656e 742e 7374 6172 745f 6461 7465 2920  ent.start_date) 
+0004e020: 2b20 2227 222c 2022 4e55 4c4c 225d 0d0a  + "'", "NULL"]..
+0004e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e040: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0004e050: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
+0004e060: 5f64 6174 6173 6574 5f74 5f6f 7264 6572  _dataset_t_order
+0004e070: 285b 7361 6d65 5f6f 7264 6572 5d29 0d0a  ([same_order])..
+0004e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e090: 2020 2020 6f72 6465 725f 6c6f 6164 6564      order_loaded
+0004e0a0: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
+0004e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e0c0: 2020 5b6f 7264 6572 5f65 7869 7374 656e    [order_existen
+0004e0d0: 742e 6964 5f64 6174 6173 6574 2c20 6f72  t.id_dataset, or
+0004e0e0: 6465 725f 6578 6973 7465 6e74 2e69 645f  der_existent.id_
+0004e0f0: 6272 616e 6368 2c20 6f72 6465 725f 6578  branch, order_ex
+0004e100: 6973 7465 6e74 2e69 645f 6461 7461 7365  istent.id_datase
+0004e110: 745f 7370 6563 5d29 0d0a 2020 2020 2020  t_spec])..      
+0004e120: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0004e130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e140: 2020 2020 2063 6c6f 7365 5f6f 7264 6572       close_order
+0004e150: 203d 205b 6f72 6465 725f 6578 6973 7465   = [order_existe
+0004e160: 6e74 2e69 645f 745f 6f72 6465 722c 206f  nt.id_t_order, o
+0004e170: 7264 6572 5f65 7869 7374 656e 742e 6964  rder_existent.id
+0004e180: 5f64 6174 6173 6574 2c20 6f72 6465 725f  _dataset, order_
+0004e190: 6578 6973 7465 6e74 2e69 645f 6272 616e  existent.id_bran
+0004e1a0: 6368 2c0d 0a20 2020 2020 2020 2020 2020  ch,..           
+0004e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e1c0: 2020 2020 2020 2020 6f72 6465 725f 6578          order_ex
+0004e1d0: 6973 7465 6e74 2e69 645f 6461 7461 7365  istent.id_datase
+0004e1e0: 745f 7370 6563 2c0d 0a20 2020 2020 2020  t_spec,..       
+0004e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e200: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0004e210: 725f 6578 6973 7465 6e74 2e69 645f 6f72  r_existent.id_or
+0004e220: 6465 725f 7479 7065 2c20 6f72 6465 725f  der_type, order_
+0004e230: 6578 6973 7465 6e74 2e6d 6574 615f 6f77  existent.meta_ow
+0004e240: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
+0004e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e260: 2020 2020 2020 2020 2022 2722 202b 2073           "'" + s
+0004e270: 7472 286f 7264 6572 5f65 7869 7374 656e  tr(order_existen
+0004e280: 742e 7374 6172 745f 6461 7465 2920 2b20  t.start_date) + 
+0004e290: 2227 222c 2073 656c 662e 636f 6e6e 6563  "'", self.connec
+0004e2a0: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
+0004e2b0: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
+0004e2c0: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
+0004e2d0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0004e2e0: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
+0004e2f0: 645f 6f6d 5f64 6174 6173 6574 5f74 5f6f  d_om_dataset_t_o
+0004e300: 7264 6572 285b 636c 6f73 655f 6f72 6465  rder([close_orde
+0004e310: 725d 290d 0a20 2020 2020 2020 2020 2020  r])..           
+0004e320: 2020 2020 2020 2020 206f 7264 6572 5f6c           order_l
+0004e330: 6f61 6465 642e 6170 7065 6e64 280d 0a20  oaded.append(.. 
+0004e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e350: 2020 2020 2020 205b 6f72 6465 725f 6578         [order_ex
+0004e360: 6973 7465 6e74 2e69 645f 6461 7461 7365  istent.id_datase
+0004e370: 742c 206f 7264 6572 5f65 7869 7374 656e  t, order_existen
+0004e380: 742e 6964 5f62 7261 6e63 682c 206f 7264  t.id_branch, ord
+0004e390: 6572 5f65 7869 7374 656e 742e 6964 5f64  er_existent.id_d
+0004e3a0: 6174 6173 6574 5f73 7065 635d 290d 0a20  ataset_spec]).. 
+0004e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e3c0: 2020 2069 645f 745f 6f72 6465 7220 3d20     id_t_order = 
+0004e3d0: 6e65 7874 5f69 645f 745f 6f72 6465 720d  next_id_t_order.
+0004e3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e3f0: 2020 2020 206e 6578 745f 6964 5f74 5f6f       next_id_t_o
+0004e400: 7264 6572 202b 3d20 310d 0a20 2020 2020  rder += 1..     
+0004e410: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0004e420: 6577 5f6f 7264 6572 203d 205b 6964 5f74  ew_order = [id_t
+0004e430: 5f6f 7264 6572 2c20 6461 7461 7365 742e  _order, dataset.
+0004e440: 6964 5f64 6174 6173 6574 2c20 6f72 6465  id_dataset, orde
+0004e450: 722e 6e75 6d5f 6272 616e 6368 2c20 6461  r.num_branch, da
+0004e460: 7461 7365 745f 7370 6563 2e69 645f 6461  taset_spec.id_da
+0004e470: 7461 7365 745f 7370 6563 2c0d 0a20 2020  taset_spec,..   
+0004e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e490: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0004e4a0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0004e4b0: 616c 2e67 6574 5f6f 7264 6572 5f74 7970  al.get_order_typ
+0004e4c0: 655f 6672 6f6d 5f6f 7264 6572 5f74 7970  e_from_order_typ
+0004e4d0: 655f 7661 6c75 6528 0d0a 2020 2020 2020  e_value(..      
+0004e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e4f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0004e500: 7264 6572 2e6f 7264 6572 5f74 7970 6529  rder.order_type)
+0004e510: 2e69 645f 6f72 6465 725f 7479 7065 2c0d  .id_order_type,.
+0004e520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e540: 2020 7365 6c66 2e6f 776e 6572 2c20 7365    self.owner, se
+0004e550: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+0004e560: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+0004e570: 7465 5f76 616c 7565 2829 2c20 224e 554c  te_value(), "NUL
+0004e580: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
+0004e590: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0004e5a0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+0004e5b0: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
+0004e5c0: 6f72 6465 7228 5b6e 6577 5f6f 7264 6572  order([new_order
+0004e5d0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0004e5e0: 2020 2020 2020 2020 6f72 6465 725f 6c6f          order_lo
+0004e5f0: 6164 6564 2e61 7070 656e 6428 5b64 6174  aded.append([dat
+0004e600: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
+0004e610: 206f 7264 6572 2e6e 756d 5f62 7261 6e63   order.num_branc
+0004e620: 682c 2064 6174 6173 6574 5f73 7065 632e  h, dataset_spec.
+0004e630: 6964 5f64 6174 6173 6574 5f73 7065 635d  id_dataset_spec]
+0004e640: 290d 0a0d 0a20 2020 2020 2020 2023 2043  )....        # C
+0004e650: 6c6f 7365 206f 7264 6572 2074 6861 7420  lose order that 
+0004e660: 6e6f 7420 6172 7269 7665 2061 6e79 6d6f  not arrive anymo
+0004e670: 7265 0d0a 2020 2020 2020 2020 666f 7220  re..        for 
+0004e680: 6f72 6465 725f 7479 7065 2069 6e20 5b78  order_type in [x
+0004e690: 2066 6f72 2078 2069 6e20 7365 6c66 2e6d   for x in self.m
+0004e6a0: 6574 6164 6174 615f 6163 7475 616c 2e6f  etadata_actual.o
+0004e6b0: 6d5f 6461 7461 7365 745f 745f 6f72 6465  m_dataset_t_orde
+0004e6c0: 7220 6966 2078 2e65 6e64 5f64 6174 6520  r if x.end_date 
+0004e6d0: 6973 204e 6f6e 655d 3a0d 0a20 2020 2020  is None]:..     
+0004e6e0: 2020 2020 2020 2069 6620 5b6f 7264 6572         if [order
+0004e6f0: 5f74 7970 652e 6964 5f64 6174 6173 6574  _type.id_dataset
+0004e700: 2c20 6f72 6465 725f 7479 7065 2e69 645f  , order_type.id_
+0004e710: 6272 616e 6368 2c20 6f72 6465 725f 7479  branch, order_ty
+0004e720: 7065 2e69 645f 6461 7461 7365 745f 7370  pe.id_dataset_sp
+0004e730: 6563 5d20 6e6f 7420 696e 206f 7264 6572  ec] not in order
+0004e740: 5f6c 6f61 6465 643a 0d0a 2020 2020 2020  _loaded:..      
+0004e750: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
+0004e760: 6f72 6465 7220 3d20 5b6f 7264 6572 5f74  order = [order_t
+0004e770: 7970 652e 6964 5f74 5f6f 7264 6572 2c20  ype.id_t_order, 
+0004e780: 6f72 6465 725f 7479 7065 2e69 645f 6461  order_type.id_da
+0004e790: 7461 7365 742c 206f 7264 6572 5f74 7970  taset, order_typ
+0004e7a0: 652e 6964 5f62 7261 6e63 682c 0d0a 2020  e.id_branch,..  
+0004e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e7c0: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0004e7d0: 6572 5f74 7970 652e 6964 5f64 6174 6173  er_type.id_datas
+0004e7e0: 6574 5f73 7065 632c 0d0a 2020 2020 2020  et_spec,..      
+0004e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e800: 2020 2020 2020 2020 206f 7264 6572 5f74           order_t
+0004e810: 7970 652e 6964 5f6f 7264 6572 5f74 7970  ype.id_order_typ
+0004e820: 652c 206f 7264 6572 5f74 7970 652e 6d65  e, order_type.me
+0004e830: 7461 5f6f 776e 6572 2c20 2227 2220 2b20  ta_owner, "'" + 
+0004e840: 7374 7228 6f72 6465 725f 7479 7065 2e73  str(order_type.s
+0004e850: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
+0004e860: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0004e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e880: 2066 696c 6573 5f6c 6f61 6465 642e 6170   files_loaded.ap
-0004e890: 7065 6e64 285b 6461 7461 7365 745f 6669  pend([dataset_fi
-0004e8a0: 6c65 5f65 7869 7374 656e 742e 6964 5f64  le_existent.id_d
-0004e8b0: 6174 6173 6574 2c20 6461 7461 7365 745f  ataset, dataset_
-0004e8c0: 6669 6c65 5f65 7869 7374 656e 742e 6669  file_existent.fi
-0004e8d0: 6c65 5f70 6174 682c 2064 6174 6173 6574  le_path, dataset
-0004e8e0: 5f66 696c 655f 6578 6973 7465 6e74 2e66  _file_existent.f
-0004e8f0: 696c 655f 6e61 6d65 2c20 6461 7461 7365  ile_name, datase
-0004e900: 745f 6669 6c65 5f65 7869 7374 656e 742e  t_file_existent.
-0004e910: 6465 6c69 6d69 7465 725f 6368 6172 6163  delimiter_charac
-0004e920: 7465 725d 290d 0a20 2020 2020 2020 2020  ter])..         
-0004e930: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0004e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e950: 2020 636c 6f73 655f 6669 6c65 203d 205b    close_file = [
-0004e960: 6461 7461 7365 745f 6669 6c65 5f65 7869  dataset_file_exi
-0004e970: 7374 656e 742e 6964 5f64 6174 6173 6574  stent.id_dataset
-0004e980: 2c20 6461 7461 7365 745f 6669 6c65 5f65  , dataset_file_e
-0004e990: 7869 7374 656e 742e 6669 6c65 5f70 6174  xistent.file_pat
-0004e9a0: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
-0004e9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e9c0: 2020 2020 2064 6174 6173 6574 5f66 696c       dataset_fil
-0004e9d0: 655f 6578 6973 7465 6e74 2e66 696c 655f  e_existent.file_
-0004e9e0: 6e61 6d65 2c20 6461 7461 7365 745f 6669  name, dataset_fi
-0004e9f0: 6c65 5f65 7869 7374 656e 742e 6465 6c69  le_existent.deli
-0004ea00: 6d69 7465 725f 6368 6172 6163 7465 722c  miter_character,
-0004ea10: 2064 6174 6173 6574 5f66 696c 655f 6578   dataset_file_ex
-0004ea20: 6973 7465 6e74 2e6d 6574 615f 6f77 6e65  istent.meta_owne
-0004ea30: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-0004ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ea50: 2020 2020 2020 2022 2722 202b 2073 7472         "'" + str
-0004ea60: 2864 6174 6173 6574 5f66 696c 655f 6578  (dataset_file_ex
-0004ea70: 6973 7465 6e74 2e73 7461 7274 5f64 6174  istent.start_dat
-0004ea80: 6529 202b 2022 2722 2c20 7365 6c66 2e63  e) + "'", self.c
-0004ea90: 6f6e 6e65 6374 696f 6e5f 6d65 7461 6461  onnection_metada
-0004eaa0: 7461 2e67 6574 5f73 7973 6461 7465 5f76  ta.get_sysdate_v
-0004eab0: 616c 7565 2829 5d0d 0a20 2020 2020 2020  alue()]..       
-0004eac0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0004ead0: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
-0004eae0: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
-0004eaf0: 745f 6669 6c65 285b 636c 6f73 655f 6669  t_file([close_fi
-0004eb00: 6c65 5d29 0d0a 2020 2020 2020 2020 2020  le])..          
-0004eb10: 2020 2020 2020 2020 2020 6669 6c65 735f            files_
-0004eb20: 6c6f 6164 6564 2e61 7070 656e 6428 5b64  loaded.append([d
-0004eb30: 6174 6173 6574 5f66 696c 655f 6578 6973  ataset_file_exis
-0004eb40: 7465 6e74 2e69 645f 6461 7461 7365 742c  tent.id_dataset,
-0004eb50: 2064 6174 6173 6574 5f66 696c 655f 6578   dataset_file_ex
-0004eb60: 6973 7465 6e74 2e66 696c 655f 7061 7468  istent.file_path
-0004eb70: 2c20 6461 7461 7365 745f 6669 6c65 5f65  , dataset_file_e
-0004eb80: 7869 7374 656e 742e 6669 6c65 5f6e 616d  xistent.file_nam
-0004eb90: 652c 2064 6174 6173 6574 5f66 696c 655f  e, dataset_file_
-0004eba0: 6578 6973 7465 6e74 2e64 656c 696d 6974  existent.delimit
-0004ebb0: 6572 5f63 6861 7261 6374 6572 5d29 0d0a  er_character])..
-0004ebc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ebd0: 2020 2020 2020 6e65 775f 6669 6c65 203d        new_file =
-0004ebe0: 205b 6461 7461 7365 742e 6964 5f64 6174   [dataset.id_dat
-0004ebf0: 6173 6574 2c20 6669 6c65 2e66 696c 655f  aset, file.file_
-0004ec00: 7061 7468 2c20 6669 6c65 2e66 696c 655f  path, file.file_
-0004ec10: 6e61 6d65 2c20 6669 6c65 2e64 656c 696d  name, file.delim
-0004ec20: 6974 6572 5f63 6861 7261 6374 6572 2c0d  iter_character,.
-0004ec30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ec50: 2020 7365 6c66 2e6f 776e 6572 2c20 7365    self.owner, se
-0004ec60: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-0004ec70: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-0004ec80: 7465 5f76 616c 7565 2829 2c20 224e 554c  te_value(), "NUL
-0004ec90: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
-0004eca0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0004ecb0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-0004ecc0: 6464 5f6f 6d5f 6461 7461 7365 745f 6669  dd_om_dataset_fi
-0004ecd0: 6c65 285b 6e65 775f 6669 6c65 5d29 0d0a  le([new_file])..
-0004ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ecf0: 2020 2020 6669 6c65 735f 6c6f 6164 6564      files_loaded
-0004ed00: 2e61 7070 656e 6428 5b64 6174 6173 6574  .append([dataset
-0004ed10: 2e69 645f 6461 7461 7365 742c 2066 696c  .id_dataset, fil
-0004ed20: 652e 6669 6c65 5f70 6174 682c 2066 696c  e.file_path, fil
-0004ed30: 652e 6669 6c65 5f6e 616d 652c 2066 696c  e.file_name, fil
-0004ed40: 652e 6465 6c69 6d69 7465 725f 6368 6172  e.delimiter_char
-0004ed50: 6163 7465 725d 290d 0a0d 0a20 2020 2020  acter])....     
-0004ed60: 2020 2023 2043 6c6f 7365 206f 7264 6572     # Close order
-0004ed70: 2074 6861 7420 6e6f 7420 6172 7269 7665   that not arrive
-0004ed80: 2061 6e79 6d6f 7265 0d0a 2020 2020 2020   anymore..      
-0004ed90: 2020 666f 7220 6669 6c65 2069 6e20 5b78    for file in [x
-0004eda0: 2066 6f72 2078 2069 6e20 7365 6c66 2e6d   for x in self.m
-0004edb0: 6574 6164 6174 615f 6163 7475 616c 2e6f  etadata_actual.o
-0004edc0: 6d5f 6461 7461 7365 745f 6669 6c65 2069  m_dataset_file i
-0004edd0: 6620 782e 656e 645f 6461 7465 2069 7320  f x.end_date is 
-0004ede0: 4e6f 6e65 5d3a 0d0a 2020 2020 2020 2020  None]:..        
-0004edf0: 2020 2020 6966 205b 6669 6c65 2e69 645f      if [file.id_
-0004ee00: 6461 7461 7365 742c 2066 696c 652e 6669  dataset, file.fi
-0004ee10: 6c65 5f70 6174 682c 2066 696c 652e 6669  le_path, file.fi
-0004ee20: 6c65 5f6e 616d 652c 2066 696c 652e 6465  le_name, file.de
-0004ee30: 6c69 6d69 7465 725f 6368 6172 6163 7465  limiter_characte
-0004ee40: 725d 206e 6f74 2069 6e20 6669 6c65 735f  r] not in files_
-0004ee50: 6c6f 6164 6564 3a0d 0a20 2020 2020 2020  loaded:..       
-0004ee60: 2020 2020 2020 2020 2063 6c6f 7365 5f66           close_f
-0004ee70: 696c 6520 3d20 5b66 696c 652e 6964 5f64  ile = [file.id_d
-0004ee80: 6174 6173 6574 2c20 6669 6c65 2e66 696c  ataset, file.fil
-0004ee90: 655f 7061 7468 2c20 6669 6c65 2e66 696c  e_path, file.fil
-0004eea0: 655f 6e61 6d65 2c20 6669 6c65 2e64 656c  e_name, file.del
-0004eeb0: 696d 6974 6572 5f63 6861 7261 6374 6572  imiter_character
-0004eec0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eee0: 2020 6669 6c65 2e6d 6574 615f 6f77 6e65    file.meta_owne
-0004eef0: 722c 2022 2722 202b 2073 7472 2866 696c  r, "'" + str(fil
-0004ef00: 652e 7374 6172 745f 6461 7465 2920 2b20  e.start_date) + 
-0004ef10: 2227 222c 0d0a 2020 2020 2020 2020 2020  "'",..          
-0004ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ef30: 2020 2020 2073 656c 662e 636f 6e6e 6563       self.connec
-0004ef40: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
-0004ef50: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
-0004ef60: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-0004ef70: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-0004ef80: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
-0004ef90: 5f64 6174 6173 6574 5f66 696c 6528 5b63  _dataset_file([c
-0004efa0: 6c6f 7365 5f66 696c 655d 290d 0a0d 0a20  lose_file]).... 
-0004efb0: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
-0004efc0: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
-0004efd0: 6e61 6d65 2c20 2246 696e 6973 6865 6420  name, "Finished 
-0004efe0: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
-0004eff0: 6174 6120 5b20 4669 6c65 7320 5d20 696e  ata [ Files ] in
-0004f000: 666f 726d 6174 696f 6e22 2c20 4c4f 475f  formation", LOG_
-0004f010: 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47 290d  LEVEL_ONLY_LOG).
-0004f020: 0a0d 0a20 2020 2064 6566 2070 726f 6365  ...    def proce
-0004f030: 7373 5f65 6c74 5f72 656c 6174 696f 6e73  ss_elt_relations
-0004f040: 6869 7028 7365 6c66 293a 0d0a 2020 2020  hip(self):..    
-0004f050: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
-0004f060: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
-0004f070: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
-0004f080: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
-0004f090: 205b 2052 656c 6174 696f 6e73 6869 7020   [ Relationship 
-0004f0a0: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
-0004f0b0: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
-0004f0c0: 4f47 290d 0a0d 0a20 2020 2020 2020 206e  OG)....        n
-0004f0d0: 6578 745f 6964 5f72 656c 6174 696f 6e73  ext_id_relations
-0004f0e0: 6869 7020 3d20 7365 6c66 2e6e 6578 745f  hip = self.next_
-0004f0f0: 6964 5f72 656c 6174 696f 6e73 6869 700d  id_relationship.
-0004f100: 0a20 2020 2020 2020 2023 2323 2323 2323  .        #######
-0004f110: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004f120: 2320 4c4f 4144 2052 454c 4154 494f 4e53  # LOAD RELATIONS
-0004f130: 4849 5053 2023 2323 2323 2323 2323 2323  HIPS ###########
-0004f140: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
-0004f150: 2020 2020 2020 2023 2049 6e70 7574 2072         # Input r
-0004f160: 656c 6174 696f 6e73 6869 7073 0d0a 2020  elationships..  
-0004f170: 2020 2020 2020 7265 6c61 7469 6f6e 7368        relationsh
-0004f180: 6970 735f 6c6f 6164 6564 203d 205b 5d0d  ips_loaded = [].
-0004f190: 0a20 2020 2020 2020 2066 6f72 2072 656c  .        for rel
-0004f1a0: 6174 696f 6e73 6869 7020 696e 2073 656c  ationship in sel
-0004f1b0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0004f1c0: 6c2e 656e 7472 795f 6461 7461 7365 745f  l.entry_dataset_
-0004f1d0: 7265 6c61 7469 6f6e 7368 6970 3a0d 0a20  relationship:.. 
-0004f1e0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
-0004f1f0: 6574 5f6d 6173 7465 7220 3d20 7365 6c66  et_master = self
-0004f200: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
-0004f210: 642e 6765 745f 6461 7461 7365 745f 6672  d.get_dataset_fr
-0004f220: 6f6d 5f64 6174 6173 6574 5f6e 616d 6528  om_dataset_name(
-0004f230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f240: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-0004f250: 6163 7475 616c 2e67 6574 5f74 6162 6c65  actual.get_table
-0004f260: 5f6e 616d 655f 6672 6f6d 5f63 6f64 5f65  _name_from_cod_e
-0004f270: 6e74 6974 795f 6f6e 5f65 6e74 7279 2872  ntity_on_entry(r
-0004f280: 656c 6174 696f 6e73 6869 702e 636f 645f  elationship.cod_
-0004f290: 656e 7469 7479 5f6d 6173 7465 7229 290d  entity_master)).
-0004f2a0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-0004f2b0: 6173 6574 5f73 7065 635f 6d61 7374 6572  aset_spec_master
-0004f2c0: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-0004f2d0: 5f74 6f5f 6c6f 6164 2e67 6574 5f64 6174  _to_load.get_dat
-0004f2e0: 6173 6574 5f73 7065 635f 6672 6f6d 5f69  aset_spec_from_i
-0004f2f0: 645f 6461 7461 7365 745f 616e 645f 636f  d_dataset_and_co
-0004f300: 6c75 6d6e 5f6e 616d 6528 0d0a 2020 2020  lumn_name(..    
-0004f310: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0004f320: 7365 745f 6d61 7374 6572 2e69 645f 6461  set_master.id_da
-0004f330: 7461 7365 742c 2072 656c 6174 696f 6e73  taset, relations
-0004f340: 6869 702e 636f 6c75 6d6e 5f6e 616d 655f  hip.column_name_
-0004f350: 6d61 7374 6572 290d 0a0d 0a20 2020 2020  master)....     
-0004f360: 2020 2020 2020 2064 6174 6173 6574 5f64         dataset_d
-0004f370: 6574 6169 6c20 3d20 7365 6c66 2e6d 6574  etail = self.met
-0004f380: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
-0004f390: 745f 6461 7461 7365 745f 6672 6f6d 5f64  t_dataset_from_d
-0004f3a0: 6174 6173 6574 5f6e 616d 6528 0d0a 2020  ataset_name(..  
-0004f3b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004f3c0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-0004f3d0: 616c 2e67 6574 5f74 6162 6c65 5f6e 616d  al.get_table_nam
-0004f3e0: 655f 6672 6f6d 5f63 6f64 5f65 6e74 6974  e_from_cod_entit
-0004f3f0: 795f 6f6e 5f65 6e74 7279 2872 656c 6174  y_on_entry(relat
-0004f400: 696f 6e73 6869 702e 636f 645f 656e 7469  ionship.cod_enti
-0004f410: 7479 5f64 6574 6169 6c29 290d 0a20 2020  ty_detail))..   
-0004f420: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-0004f430: 5f73 7065 635f 6465 7461 696c 203d 2073  _spec_detail = s
-0004f440: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-0004f450: 6c6f 6164 2e67 6574 5f64 6174 6173 6574  load.get_dataset
-0004f460: 5f73 7065 635f 6672 6f6d 5f69 645f 6461  _spec_from_id_da
-0004f470: 7461 7365 745f 616e 645f 636f 6c75 6d6e  taset_and_column
-0004f480: 5f6e 616d 6528 0d0a 2020 2020 2020 2020  _name(..        
-0004f490: 2020 2020 2020 2020 6461 7461 7365 745f          dataset_
-0004f4a0: 6465 7461 696c 2e69 645f 6461 7461 7365  detail.id_datase
-0004f4b0: 742c 2072 656c 6174 696f 6e73 6869 702e  t, relationship.
-0004f4c0: 636f 6c75 6d6e 5f6e 616d 655f 6465 7461  column_name_deta
-0004f4d0: 696c 290d 0a20 2020 2020 2020 2020 2020  il)..           
-0004f4e0: 206a 6f69 6e5f 7479 7065 203d 2073 656c   join_type = sel
-0004f4f0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-0004f500: 6c2e 6765 745f 6a6f 696e 5f74 7970 655f  l.get_join_type_
-0004f510: 6672 6f6d 5f6a 6f69 6e5f 6e61 6d65 2872  from_join_name(r
-0004f520: 656c 6174 696f 6e73 6869 702e 7265 6c61  elationship.rela
-0004f530: 7469 6f6e 7368 6970 5f74 7970 6529 0d0a  tionship_type)..
-0004f540: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0004f550: 6c61 7469 6f6e 7368 6970 5f65 7869 7374  lationship_exist
-0004f560: 656e 7420 3d20 7365 6c66 2e6d 6574 6164  ent = self.metad
-0004f570: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
-0004f580: 656c 6174 696f 6e73 6869 705f 6672 6f6d  elationship_from
-0004f590: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
-0004f5a0: 5f6d 6173 7465 725f 616e 645f 6465 7461  _master_and_deta
-0004f5b0: 696c 280d 0a20 2020 2020 2020 2020 2020  il(..           
-0004f5c0: 2020 2020 2064 6174 6173 6574 5f73 7065       dataset_spe
-0004f5d0: 635f 6d61 7374 6572 2e69 645f 6461 7461  c_master.id_data
-0004f5e0: 7365 745f 7370 6563 2c0d 0a20 2020 2020  set_spec,..     
-0004f5f0: 2020 2020 2020 2020 2020 2064 6174 6173             datas
-0004f600: 6574 5f73 7065 635f 6465 7461 696c 2e69  et_spec_detail.i
-0004f610: 645f 6461 7461 7365 745f 7370 6563 290d  d_dataset_spec).
-0004f620: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-0004f630: 6620 7265 6c61 7469 6f6e 7368 6970 5f65  f relationship_e
-0004f640: 7869 7374 656e 7420 6973 204e 6f6e 653a  xistent is None:
-0004f650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f660: 2020 2320 4e65 7720 7265 6c61 7469 6f6e    # New relation
-0004f670: 7368 6970 0d0a 2020 2020 2020 2020 2020  ship..          
-0004f680: 2020 2020 2020 6964 5f72 656c 6174 696f        id_relatio
-0004f690: 6e73 6869 7020 3d20 6e65 7874 5f69 645f  nship = next_id_
-0004f6a0: 7265 6c61 7469 6f6e 7368 6970 0d0a 2020  relationship..  
-0004f6b0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0004f6c0: 7874 5f69 645f 7265 6c61 7469 6f6e 7368  xt_id_relationsh
-0004f6d0: 6970 202b 3d20 310d 0a0d 0a20 2020 2020  ip += 1....     
-0004f6e0: 2020 2020 2020 2020 2020 206e 6577 5f72             new_r
-0004f6f0: 656c 6174 696f 6e73 6869 7020 3d20 5b69  elationship = [i
-0004f700: 645f 7265 6c61 7469 6f6e 7368 6970 2c20  d_relationship, 
-0004f710: 6461 7461 7365 745f 7370 6563 5f6d 6173  dataset_spec_mas
-0004f720: 7465 722e 6964 5f64 6174 6173 6574 5f73  ter.id_dataset_s
-0004f730: 7065 632c 0d0a 2020 2020 2020 2020 2020  pec,..          
-0004f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f750: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-0004f760: 745f 7370 6563 5f64 6574 6169 6c2e 6964  t_spec_detail.id
-0004f770: 5f64 6174 6173 6574 5f73 7065 632c 0d0a  _dataset_spec,..
-0004f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f7a0: 2020 2020 6a6f 696e 5f74 7970 652e 6964      join_type.id
-0004f7b0: 5f6a 6f69 6e5f 7479 7065 2c20 7365 6c66  _join_type, self
-0004f7c0: 2e6f 776e 6572 2c20 7365 6c66 2e63 6f6e  .owner, self.con
-0004f7d0: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
-0004f7e0: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
-0004f7f0: 7565 2829 2c20 224e 554c 4c22 5d0d 0a20  ue(), "NULL"].. 
-0004f800: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004f810: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-0004f820: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-0004f830: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
-0004f840: 7328 5b6e 6577 5f72 656c 6174 696f 6e73  s([new_relations
-0004f850: 6869 705d 290d 0a20 2020 2020 2020 2020  hip])..         
-0004f860: 2020 2020 2020 2072 656c 6174 696f 6e73         relations
-0004f870: 6869 7073 5f6c 6f61 6465 642e 6170 7065  hips_loaded.appe
-0004f880: 6e64 285b 6461 7461 7365 745f 7370 6563  nd([dataset_spec
-0004f890: 5f6d 6173 7465 722e 6964 5f64 6174 6173  _master.id_datas
-0004f8a0: 6574 5f73 7065 632c 2064 6174 6173 6574  et_spec, dataset
-0004f8b0: 5f73 7065 635f 6465 7461 696c 2e69 645f  _spec_detail.id_
-0004f8c0: 6461 7461 7365 745f 7370 6563 5d29 0d0a  dataset_spec])..
-0004f8d0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0004f8e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0004f8f0: 2020 2020 2023 2055 7064 6174 6520 7265       # Update re
-0004f900: 6c61 7469 6f6e 7368 6970 0d0a 2020 2020  lationship..    
-0004f910: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0004f920: 656c 6174 696f 6e73 6869 705f 6578 6973  elationship_exis
-0004f930: 7465 6e74 2e69 645f 6a6f 696e 5f74 7970  tent.id_join_typ
-0004f940: 6520 3d3d 206a 6f69 6e5f 7479 7065 2e69  e == join_type.i
-0004f950: 645f 6a6f 696e 5f74 7970 653a 0d0a 2020  d_join_type:..  
-0004f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f970: 2020 6f6c 645f 7265 6c61 7469 6f6e 7368    old_relationsh
-0004f980: 6970 203d 205b 7265 6c61 7469 6f6e 7368  ip = [relationsh
-0004f990: 6970 5f65 7869 7374 656e 742e 6964 5f72  ip_existent.id_r
-0004f9a0: 656c 6174 696f 6e73 6869 702c 0d0a 2020  elationship,..  
-0004f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f9d0: 2020 2020 2020 7265 6c61 7469 6f6e 7368        relationsh
-0004f9e0: 6970 5f65 7869 7374 656e 742e 6964 5f64  ip_existent.id_d
-0004f9f0: 6174 6173 6574 5f73 7065 635f 6d61 7374  ataset_spec_mast
-0004fa00: 6572 2c0d 0a20 2020 2020 2020 2020 2020  er,..           
-0004fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa20: 2020 2020 2020 2020 2020 2020 2072 656c               rel
-0004fa30: 6174 696f 6e73 6869 705f 6578 6973 7465  ationship_existe
-0004fa40: 6e74 2e69 645f 6461 7461 7365 745f 7370  nt.id_dataset_sp
-0004fa50: 6563 5f64 6574 6169 6c2c 0d0a 2020 2020  ec_detail,..    
-0004fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa80: 2020 2020 7265 6c61 7469 6f6e 7368 6970      relationship
-0004fa90: 5f65 7869 7374 656e 742e 6964 5f6a 6f69  _existent.id_joi
-0004faa0: 6e5f 7479 7065 2c20 7265 6c61 7469 6f6e  n_type, relation
-0004fab0: 7368 6970 5f65 7869 7374 656e 742e 6d65  ship_existent.me
-0004fac0: 7461 5f6f 776e 6572 2c0d 0a20 2020 2020  ta_owner,..     
-0004fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004faf0: 2020 2022 2722 202b 2073 7472 2872 656c     "'" + str(rel
-0004fb00: 6174 696f 6e73 6869 705f 6578 6973 7465  ationship_existe
-0004fb10: 6e74 2e73 7461 7274 5f64 6174 6529 202b  nt.start_date) +
-0004fb20: 2022 2722 2c20 224e 554c 4c22 5d0d 0a20   "'", "NULL"].. 
-0004fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fb40: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-0004fb50: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-0004fb60: 6461 7461 7365 745f 7265 6c61 7469 6f6e  dataset_relation
-0004fb70: 7368 6970 7328 5b6f 6c64 5f72 656c 6174  ships([old_relat
-0004fb80: 696f 6e73 6869 705d 290d 0a20 2020 2020  ionship])..     
-0004fb90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004fba0: 656c 6174 696f 6e73 6869 7073 5f6c 6f61  elationships_loa
-0004fbb0: 6465 642e 6170 7065 6e64 280d 0a20 2020  ded.append(..   
-0004fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fbd0: 2020 2020 205b 7265 6c61 7469 6f6e 7368       [relationsh
-0004fbe0: 6970 5f65 7869 7374 656e 742e 6964 5f64  ip_existent.id_d
-0004fbf0: 6174 6173 6574 5f73 7065 635f 6d61 7374  ataset_spec_mast
-0004fc00: 6572 2c20 7265 6c61 7469 6f6e 7368 6970  er, relationship
-0004fc10: 5f65 7869 7374 656e 742e 6964 5f64 6174  _existent.id_dat
-0004fc20: 6173 6574 5f73 7065 635f 6465 7461 696c  aset_spec_detail
-0004fc30: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0004fc40: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0004fc50: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0004fc60: 6c64 5f72 656c 6174 696f 6e73 6869 7020  ld_relationship 
-0004fc70: 3d20 5b72 656c 6174 696f 6e73 6869 705f  = [relationship_
-0004fc80: 6578 6973 7465 6e74 2e69 645f 7265 6c61  existent.id_rela
-0004fc90: 7469 6f6e 7368 6970 2c0d 0a20 2020 2020  tionship,..     
-0004fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fcc0: 2020 2072 656c 6174 696f 6e73 6869 705f     relationship_
-0004fcd0: 6578 6973 7465 6e74 2e69 645f 6461 7461  existent.id_data
-0004fce0: 7365 745f 7370 6563 5f6d 6173 7465 722c  set_spec_master,
-0004fcf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd10: 2020 2020 2020 2020 2020 7265 6c61 7469            relati
-0004fd20: 6f6e 7368 6970 5f65 7869 7374 656e 742e  onship_existent.
-0004fd30: 6964 5f64 6174 6173 6574 5f73 7065 635f  id_dataset_spec_
-0004fd40: 6465 7461 696c 2c0d 0a20 2020 2020 2020  detail,..       
-0004fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fd70: 2072 656c 6174 696f 6e73 6869 705f 6578   relationship_ex
-0004fd80: 6973 7465 6e74 2e69 645f 6a6f 696e 5f74  istent.id_join_t
-0004fd90: 7970 652c 2072 656c 6174 696f 6e73 6869  ype, relationshi
-0004fda0: 705f 6578 6973 7465 6e74 2e6d 6574 615f  p_existent.meta_
-0004fdb0: 6f77 6e65 722c 0d0a 2020 2020 2020 2020  owner,..        
-0004fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fde0: 2227 2220 2b20 7374 7228 7265 6c61 7469  "'" + str(relati
-0004fdf0: 6f6e 7368 6970 5f65 7869 7374 656e 742e  onship_existent.
-0004fe00: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
-0004fe10: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0004fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fe30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004fe40: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
-0004fe50: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
-0004fe60: 5f76 616c 7565 2829 5d0d 0a20 2020 2020  _value()]..     
-0004fe70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004fe80: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-0004fe90: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-0004fea0: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
-0004feb0: 7328 5b6f 6c64 5f72 656c 6174 696f 6e73  s([old_relations
-0004fec0: 6869 705d 290d 0a20 2020 2020 2020 2020  hip])..         
-0004fed0: 2020 2020 2020 2020 2020 2072 656c 6174             relat
-0004fee0: 696f 6e73 6869 7073 5f6c 6f61 6465 642e  ionships_loaded.
-0004fef0: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
-0004ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ff10: 205b 7265 6c61 7469 6f6e 7368 6970 5f65   [relationship_e
-0004ff20: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
-0004ff30: 6574 5f73 7065 635f 6d61 7374 6572 2c20  et_spec_master, 
-0004ff40: 7265 6c61 7469 6f6e 7368 6970 5f65 7869  relationship_exi
-0004ff50: 7374 656e 742e 6964 5f64 6174 6173 6574  stent.id_dataset
-0004ff60: 5f73 7065 635f 6465 7461 696c 5d29 0d0a  _spec_detail])..
-0004ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ff80: 2020 2020 6964 5f72 656c 6174 696f 6e73      id_relations
-0004ff90: 6869 7020 3d20 6e65 7874 5f69 645f 7265  hip = next_id_re
-0004ffa0: 6c61 7469 6f6e 7368 6970 0d0a 2020 2020  lationship..    
-0004ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ffc0: 6e65 7874 5f69 645f 7265 6c61 7469 6f6e  next_id_relation
-0004ffd0: 7368 6970 202b 3d20 310d 0a20 2020 2020  ship += 1..     
-0004ffe0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0004fff0: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
-00050000: 3d20 5b69 645f 7265 6c61 7469 6f6e 7368  = [id_relationsh
-00050010: 6970 2c20 6461 7461 7365 745f 7370 6563  ip, dataset_spec
-00050020: 5f6d 6173 7465 722e 6964 5f64 6174 6173  _master.id_datas
-00050030: 6574 5f73 7065 632c 0d0a 2020 2020 2020  et_spec,..      
-00050040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050060: 2020 6461 7461 7365 745f 7370 6563 5f64    dataset_spec_d
-00050070: 6574 6169 6c2e 6964 5f64 6174 6173 6574  etail.id_dataset
-00050080: 5f73 7065 632c 0d0a 2020 2020 2020 2020  _spec,..        
-00050090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000500a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000500b0: 6a6f 696e 5f74 7970 652e 6964 5f6a 6f69  join_type.id_joi
-000500c0: 6e5f 7479 7065 2c20 7365 6c66 2e6f 776e  n_type, self.own
-000500d0: 6572 2c20 7365 6c66 2e63 6f6e 6e65 6374  er, self.connect
-000500e0: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
-000500f0: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
-00050100: 2c20 224e 554c 4c22 5d0d 0a20 2020 2020  , "NULL"]..     
-00050110: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00050120: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00050130: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-00050140: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
-00050150: 7328 5b6e 6577 5f72 656c 6174 696f 6e73  s([new_relations
-00050160: 6869 705d 290d 0a20 2020 2020 2020 2020  hip])..         
-00050170: 2020 2020 2020 2020 2020 2072 656c 6174             relat
-00050180: 696f 6e73 6869 7073 5f6c 6f61 6465 642e  ionships_loaded.
-00050190: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
-000501a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000501b0: 205b 6461 7461 7365 745f 7370 6563 5f6d   [dataset_spec_m
-000501c0: 6173 7465 722e 6964 5f64 6174 6173 6574  aster.id_dataset
-000501d0: 5f73 7065 632c 2064 6174 6173 6574 5f73  _spec, dataset_s
-000501e0: 7065 635f 6465 7461 696c 2e69 645f 6461  pec_detail.id_da
-000501f0: 7461 7365 745f 7370 6563 5d29 0d0a 0d0a  taset_spec])....
-00050200: 2020 2020 2020 2020 2320 436c 6f73 6520          # Close 
-00050210: 7265 6c61 7469 6f6e 7368 6970 7320 7468  relationships th
-00050220: 6174 206e 6f74 2061 7272 6976 6520 616e  at not arrive an
-00050230: 796d 6f72 650d 0a20 2020 2020 2020 2066  ymore..        f
-00050240: 6f72 2072 656c 6174 696f 6e73 6869 7020  or relationship 
-00050250: 696e 205b 7820 666f 7220 7820 696e 2073  in [x for x in s
-00050260: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
-00050270: 7561 6c2e 6f6d 5f64 6174 6173 6574 5f72  ual.om_dataset_r
-00050280: 656c 6174 696f 6e73 6869 7073 2069 6620  elationships if 
-00050290: 782e 656e 645f 6461 7465 2069 7320 4e6f  x.end_date is No
-000502a0: 6e65 5d3a 0d0a 2020 2020 2020 2020 2020  ne]:..          
-000502b0: 2020 6966 205b 7265 6c61 7469 6f6e 7368    if [relationsh
-000502c0: 6970 2e69 645f 6461 7461 7365 745f 7370  ip.id_dataset_sp
-000502d0: 6563 5f6d 6173 7465 722c 2072 656c 6174  ec_master, relat
-000502e0: 696f 6e73 6869 702e 6964 5f64 6174 6173  ionship.id_datas
-000502f0: 6574 5f73 7065 635f 6465 7461 696c 5d20  et_spec_detail] 
-00050300: 6e6f 7420 696e 2072 656c 6174 696f 6e73  not in relations
-00050310: 6869 7073 5f6c 6f61 6465 643a 0d0a 2020  hips_loaded:..  
-00050320: 2020 2020 2020 2020 2020 2020 2020 6f6c                ol
-00050330: 645f 7265 6c61 7469 6f6e 7368 6970 203d  d_relationship =
-00050340: 205b 7265 6c61 7469 6f6e 7368 6970 2e69   [relationship.i
-00050350: 645f 7265 6c61 7469 6f6e 7368 6970 2c0d  d_relationship,.
-00050360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e880: 2020 7365 6c66 2e63 6f6e 6e65 6374 696f    self.connectio
+0004e890: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
+0004e8a0: 7973 6461 7465 5f76 616c 7565 2829 5d0d  ysdate_value()].
+0004e8b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e8c0: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
+0004e8d0: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
+0004e8e0: 7461 7365 745f 745f 6f72 6465 7228 5b63  taset_t_order([c
+0004e8f0: 6c6f 7365 5f6f 7264 6572 5d29 0d0a 0d0a  lose_order])....
+0004e900: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0004e910: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
+0004e920: 5f6e 616d 652c 2022 4669 6e69 7368 6564  _name, "Finished
+0004e930: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
+0004e940: 6461 7461 205b 204f 7264 6572 205d 2069  data [ Order ] i
+0004e950: 6e66 6f72 6d61 7469 6f6e 222c 204c 4f47  nformation", LOG
+0004e960: 5f4c 4556 454c 5f4f 4e4c 595f 4c4f 4729  _LEVEL_ONLY_LOG)
+0004e970: 0d0a 0d0a 2020 2020 6465 6620 7072 6f63  ....    def proc
+0004e980: 6573 735f 656c 745f 6669 6c65 7328 7365  ess_elt_files(se
+0004e990: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
+0004e9a0: 6c66 2e6c 6f67 2e6c 6f67 2873 656c 662e  lf.log.log(self.
+0004e9b0: 656e 6769 6e65 5f6e 616d 652c 2022 5374  engine_name, "St
+0004e9c0: 6172 7469 6e67 2074 6f20 7072 6f63 6573  arting to proces
+0004e9d0: 7320 4d65 7461 6461 7461 205b 2046 696c  s Metadata [ Fil
+0004e9e0: 6573 205d 2069 6e66 6f72 6d61 7469 6f6e  es ] information
+0004e9f0: 222c 204c 4f47 5f4c 4556 454c 5f4f 4e4c  ", LOG_LEVEL_ONL
+0004ea00: 595f 4c4f 4729 0d0a 2020 2020 2020 2020  Y_LOG)..        
+0004ea10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004ea20: 2323 2323 2323 2323 204c 4f41 4420 4f52  ######## LOAD OR
+0004ea30: 4445 5220 2323 2323 2323 2323 2323 2323  DER ############
+0004ea40: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
+0004ea50: 2020 2020 2020 2320 496e 7075 7420 4f72        # Input Or
+0004ea60: 6465 7273 0d0a 2020 2020 2020 2020 6669  ders..        fi
+0004ea70: 6c65 735f 6c6f 6164 6564 203d 205b 5d0d  les_loaded = [].
+0004ea80: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
+0004ea90: 6520 696e 2073 656c 662e 6d65 7461 6461  e in self.metada
+0004eaa0: 7461 5f61 6374 7561 6c2e 656e 7472 795f  ta_actual.entry_
+0004eab0: 6669 6c65 733a 0d0a 0d0a 2020 2020 2020  files:....      
+0004eac0: 2020 2020 2020 6461 7461 7365 7420 3d20        dataset = 
+0004ead0: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+0004eae0: 5f6c 6f61 642e 6765 745f 6461 7461 7365  _load.get_datase
+0004eaf0: 745f 6672 6f6d 5f64 6174 6173 6574 5f6e  t_from_dataset_n
+0004eb00: 616d 6528 7365 6c66 2e6d 6574 6164 6174  ame(self.metadat
+0004eb10: 615f 6163 7475 616c 2e67 6574 5f74 6162  a_actual.get_tab
+0004eb20: 6c65 5f6e 616d 655f 6672 6f6d 5f63 6f64  le_name_from_cod
+0004eb30: 5f65 6e74 6974 795f 6f6e 5f65 6e74 7279  _entity_on_entry
+0004eb40: 2866 696c 652e 636f 645f 656e 7469 7479  (file.cod_entity
+0004eb50: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+0004eb60: 2020 6461 7461 7365 745f 6669 6c65 5f65    dataset_file_e
+0004eb70: 7869 7374 656e 7420 3d20 7365 6c66 2e6d  xistent = self.m
+0004eb80: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+0004eb90: 6574 5f6f 6d5f 6461 7461 7365 745f 6669  et_om_dataset_fi
+0004eba0: 6c65 5f66 726f 6d5f 6964 5f64 6174 6173  le_from_id_datas
+0004ebb0: 6574 2864 6174 6173 6574 2e69 645f 6461  et(dataset.id_da
+0004ebc0: 7461 7365 7429 0d0a 0d0a 2020 2020 2020  taset)....      
+0004ebd0: 2020 2020 2020 6966 2064 6174 6173 6574        if dataset
+0004ebe0: 5f66 696c 655f 6578 6973 7465 6e74 2069  _file_existent i
+0004ebf0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0004ec00: 2020 2020 2020 2020 2023 204e 6577 2066           # New f
+0004ec10: 696c 650d 0a20 2020 2020 2020 2020 2020  ile..           
+0004ec20: 2020 2020 2073 7461 7274 5f64 6174 6520       start_date 
+0004ec30: 3d20 7365 6c66 2e63 6f6e 6e65 6374 696f  = self.connectio
+0004ec40: 6e5f 6d65 7461 6461 7461 2e67 6574 5f73  n_metadata.get_s
+0004ec50: 7973 6461 7465 5f76 616c 7565 2829 0d0a  ysdate_value()..
+0004ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ec70: 6e65 775f 6669 6c65 203d 205b 6461 7461  new_file = [data
+0004ec80: 7365 742e 6964 5f64 6174 6173 6574 2c20  set.id_dataset, 
+0004ec90: 6669 6c65 2e66 696c 655f 7061 7468 2c20  file.file_path, 
+0004eca0: 6669 6c65 2e66 696c 655f 6e61 6d65 2c20  file.file_name, 
+0004ecb0: 6669 6c65 2e64 656c 696d 6974 6572 5f63  file.delimiter_c
+0004ecc0: 6861 7261 6374 6572 2c0d 0a20 2020 2020  haracter,..     
+0004ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ece0: 2020 2020 2020 2073 656c 662e 6f77 6e65         self.owne
+0004ecf0: 722c 2073 7461 7274 5f64 6174 652c 2027  r, start_date, '
+0004ed00: 4e55 4c4c 275d 0d0a 2020 2020 2020 2020  NULL']..        
+0004ed10: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+0004ed20: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
+0004ed30: 645f 6f6d 5f64 6174 6173 6574 5f66 696c  d_om_dataset_fil
+0004ed40: 6528 5b6e 6577 5f66 696c 655d 290d 0a20  e([new_file]).. 
+0004ed50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004ed60: 696c 6573 5f6c 6f61 6465 642e 6170 7065  iles_loaded.appe
+0004ed70: 6e64 285b 6461 7461 7365 742e 6964 5f64  nd([dataset.id_d
+0004ed80: 6174 6173 6574 2c20 6669 6c65 2e66 696c  ataset, file.fil
+0004ed90: 655f 7061 7468 2c20 6669 6c65 2e66 696c  e_path, file.fil
+0004eda0: 655f 6e61 6d65 2c20 6669 6c65 2e64 656c  e_name, file.del
+0004edb0: 696d 6974 6572 5f63 6861 7261 6374 6572  imiter_character
+0004edc0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+0004edd0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0004ede0: 2020 2020 2020 2020 2023 2055 7064 6174           # Updat
+0004edf0: 6520 6669 6c65 206f 6e6c 790d 0a20 2020  e file only..   
+0004ee00: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+0004ee10: 6620 7468 6520 6174 7472 6962 7574 6573  f the attributes
+0004ee20: 2061 7265 2074 6865 2064 6966 6572 656e   are the diferen
+0004ee30: 742c 2074 6865 2072 6567 6973 7465 7220  t, the register 
+0004ee40: 7769 6c6c 2062 6520 636c 6f73 6564 0d0a  will be closed..
+0004ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ee60: 6966 2064 6174 6173 6574 5f66 696c 655f  if dataset_file_
+0004ee70: 6578 6973 7465 6e74 2e66 696c 655f 7061  existent.file_pa
+0004ee80: 7468 203d 3d20 6669 6c65 2e66 696c 655f  th == file.file_
+0004ee90: 7061 7468 205c 0d0a 2020 2020 2020 2020  path \..        
+0004eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eeb0: 616e 6420 6461 7461 7365 745f 6669 6c65  and dataset_file
+0004eec0: 5f65 7869 7374 656e 742e 6669 6c65 5f6e  _existent.file_n
+0004eed0: 616d 6520 3d3d 2066 696c 652e 6669 6c65  ame == file.file
+0004eee0: 5f6e 616d 6520 5c0d 0a20 2020 2020 2020  _name \..       
+0004eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ef00: 2061 6e64 2064 6174 6173 6574 5f66 696c   and dataset_fil
+0004ef10: 655f 6578 6973 7465 6e74 2e64 656c 696d  e_existent.delim
+0004ef20: 6974 6572 5f63 6861 7261 6374 6572 203d  iter_character =
+0004ef30: 3d20 6669 6c65 2e64 656c 696d 6974 6572  = file.delimiter
+0004ef40: 5f63 6861 7261 6374 6572 3a0d 0a20 2020  _character:..   
+0004ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ef60: 2073 616d 655f 6669 6c65 203d 205b 6461   same_file = [da
+0004ef70: 7461 7365 745f 6669 6c65 5f65 7869 7374  taset_file_exist
+0004ef80: 656e 742e 6964 5f64 6174 6173 6574 2c20  ent.id_dataset, 
+0004ef90: 6461 7461 7365 745f 6669 6c65 5f65 7869  dataset_file_exi
+0004efa0: 7374 656e 742e 6669 6c65 5f70 6174 682c  stent.file_path,
+0004efb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004efd0: 2020 2064 6174 6173 6574 5f66 696c 655f     dataset_file_
+0004efe0: 6578 6973 7465 6e74 2e66 696c 655f 6e61  existent.file_na
+0004eff0: 6d65 2c20 6461 7461 7365 745f 6669 6c65  me, dataset_file
+0004f000: 5f65 7869 7374 656e 742e 6465 6c69 6d69  _existent.delimi
+0004f010: 7465 725f 6368 6172 6163 7465 722c 0d0a  ter_character,..
+0004f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f040: 2064 6174 6173 6574 5f66 696c 655f 6578   dataset_file_ex
+0004f050: 6973 7465 6e74 2e6d 6574 615f 6f77 6e65  istent.meta_owne
+0004f060: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+0004f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f080: 2020 2020 2022 2722 202b 2073 7472 2864       "'" + str(d
+0004f090: 6174 6173 6574 5f66 696c 655f 6578 6973  ataset_file_exis
+0004f0a0: 7465 6e74 2e73 7461 7274 5f64 6174 6529  tent.start_date)
+0004f0b0: 202b 2022 2722 2c20 224e 554c 4c22 5d0d   + "'", "NULL"].
+0004f0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f0d0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+0004f0e0: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
+0004f0f0: 6d5f 6461 7461 7365 745f 6669 6c65 285b  m_dataset_file([
+0004f100: 7361 6d65 5f66 696c 655d 290d 0a20 2020  same_file])..   
+0004f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f120: 2066 696c 6573 5f6c 6f61 6465 642e 6170   files_loaded.ap
+0004f130: 7065 6e64 285b 6461 7461 7365 745f 6669  pend([dataset_fi
+0004f140: 6c65 5f65 7869 7374 656e 742e 6964 5f64  le_existent.id_d
+0004f150: 6174 6173 6574 2c20 6461 7461 7365 745f  ataset, dataset_
+0004f160: 6669 6c65 5f65 7869 7374 656e 742e 6669  file_existent.fi
+0004f170: 6c65 5f70 6174 682c 2064 6174 6173 6574  le_path, dataset
+0004f180: 5f66 696c 655f 6578 6973 7465 6e74 2e66  _file_existent.f
+0004f190: 696c 655f 6e61 6d65 2c20 6461 7461 7365  ile_name, datase
+0004f1a0: 745f 6669 6c65 5f65 7869 7374 656e 742e  t_file_existent.
+0004f1b0: 6465 6c69 6d69 7465 725f 6368 6172 6163  delimiter_charac
+0004f1c0: 7465 725d 290d 0a20 2020 2020 2020 2020  ter])..         
+0004f1d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0004f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f1f0: 2020 636c 6f73 655f 6669 6c65 203d 205b    close_file = [
+0004f200: 6461 7461 7365 745f 6669 6c65 5f65 7869  dataset_file_exi
+0004f210: 7374 656e 742e 6964 5f64 6174 6173 6574  stent.id_dataset
+0004f220: 2c20 6461 7461 7365 745f 6669 6c65 5f65  , dataset_file_e
+0004f230: 7869 7374 656e 742e 6669 6c65 5f70 6174  xistent.file_pat
+0004f240: 682c 0d0a 2020 2020 2020 2020 2020 2020  h,..            
+0004f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f260: 2020 2020 2064 6174 6173 6574 5f66 696c       dataset_fil
+0004f270: 655f 6578 6973 7465 6e74 2e66 696c 655f  e_existent.file_
+0004f280: 6e61 6d65 2c20 6461 7461 7365 745f 6669  name, dataset_fi
+0004f290: 6c65 5f65 7869 7374 656e 742e 6465 6c69  le_existent.deli
+0004f2a0: 6d69 7465 725f 6368 6172 6163 7465 722c  miter_character,
+0004f2b0: 2064 6174 6173 6574 5f66 696c 655f 6578   dataset_file_ex
+0004f2c0: 6973 7465 6e74 2e6d 6574 615f 6f77 6e65  istent.meta_owne
+0004f2d0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+0004f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f2f0: 2020 2020 2020 2022 2722 202b 2073 7472         "'" + str
+0004f300: 2864 6174 6173 6574 5f66 696c 655f 6578  (dataset_file_ex
+0004f310: 6973 7465 6e74 2e73 7461 7274 5f64 6174  istent.start_dat
+0004f320: 6529 202b 2022 2722 2c20 7365 6c66 2e63  e) + "'", self.c
+0004f330: 6f6e 6e65 6374 696f 6e5f 6d65 7461 6461  onnection_metada
+0004f340: 7461 2e67 6574 5f73 7973 6461 7465 5f76  ta.get_sysdate_v
+0004f350: 616c 7565 2829 5d0d 0a20 2020 2020 2020  alue()]..       
+0004f360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0004f370: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
+0004f380: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
+0004f390: 745f 6669 6c65 285b 636c 6f73 655f 6669  t_file([close_fi
+0004f3a0: 6c65 5d29 0d0a 2020 2020 2020 2020 2020  le])..          
+0004f3b0: 2020 2020 2020 2020 2020 6669 6c65 735f            files_
+0004f3c0: 6c6f 6164 6564 2e61 7070 656e 6428 5b64  loaded.append([d
+0004f3d0: 6174 6173 6574 5f66 696c 655f 6578 6973  ataset_file_exis
+0004f3e0: 7465 6e74 2e69 645f 6461 7461 7365 742c  tent.id_dataset,
+0004f3f0: 2064 6174 6173 6574 5f66 696c 655f 6578   dataset_file_ex
+0004f400: 6973 7465 6e74 2e66 696c 655f 7061 7468  istent.file_path
+0004f410: 2c20 6461 7461 7365 745f 6669 6c65 5f65  , dataset_file_e
+0004f420: 7869 7374 656e 742e 6669 6c65 5f6e 616d  xistent.file_nam
+0004f430: 652c 2064 6174 6173 6574 5f66 696c 655f  e, dataset_file_
+0004f440: 6578 6973 7465 6e74 2e64 656c 696d 6974  existent.delimit
+0004f450: 6572 5f63 6861 7261 6374 6572 5d29 0d0a  er_character])..
+0004f460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f470: 2020 2020 2020 6e65 775f 6669 6c65 203d        new_file =
+0004f480: 205b 6461 7461 7365 742e 6964 5f64 6174   [dataset.id_dat
+0004f490: 6173 6574 2c20 6669 6c65 2e66 696c 655f  aset, file.file_
+0004f4a0: 7061 7468 2c20 6669 6c65 2e66 696c 655f  path, file.file_
+0004f4b0: 6e61 6d65 2c20 6669 6c65 2e64 656c 696d  name, file.delim
+0004f4c0: 6974 6572 5f63 6861 7261 6374 6572 2c0d  iter_character,.
+0004f4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f4f0: 2020 7365 6c66 2e6f 776e 6572 2c20 7365    self.owner, se
+0004f500: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+0004f510: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+0004f520: 7465 5f76 616c 7565 2829 2c20 224e 554c  te_value(), "NUL
+0004f530: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
+0004f540: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0004f550: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+0004f560: 6464 5f6f 6d5f 6461 7461 7365 745f 6669  dd_om_dataset_fi
+0004f570: 6c65 285b 6e65 775f 6669 6c65 5d29 0d0a  le([new_file])..
+0004f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f590: 2020 2020 6669 6c65 735f 6c6f 6164 6564      files_loaded
+0004f5a0: 2e61 7070 656e 6428 5b64 6174 6173 6574  .append([dataset
+0004f5b0: 2e69 645f 6461 7461 7365 742c 2066 696c  .id_dataset, fil
+0004f5c0: 652e 6669 6c65 5f70 6174 682c 2066 696c  e.file_path, fil
+0004f5d0: 652e 6669 6c65 5f6e 616d 652c 2066 696c  e.file_name, fil
+0004f5e0: 652e 6465 6c69 6d69 7465 725f 6368 6172  e.delimiter_char
+0004f5f0: 6163 7465 725d 290d 0a0d 0a20 2020 2020  acter])....     
+0004f600: 2020 2023 2043 6c6f 7365 206f 7264 6572     # Close order
+0004f610: 2074 6861 7420 6e6f 7420 6172 7269 7665   that not arrive
+0004f620: 2061 6e79 6d6f 7265 0d0a 2020 2020 2020   anymore..      
+0004f630: 2020 666f 7220 6669 6c65 2069 6e20 5b78    for file in [x
+0004f640: 2066 6f72 2078 2069 6e20 7365 6c66 2e6d   for x in self.m
+0004f650: 6574 6164 6174 615f 6163 7475 616c 2e6f  etadata_actual.o
+0004f660: 6d5f 6461 7461 7365 745f 6669 6c65 2069  m_dataset_file i
+0004f670: 6620 782e 656e 645f 6461 7465 2069 7320  f x.end_date is 
+0004f680: 4e6f 6e65 5d3a 0d0a 2020 2020 2020 2020  None]:..        
+0004f690: 2020 2020 6966 205b 6669 6c65 2e69 645f      if [file.id_
+0004f6a0: 6461 7461 7365 742c 2066 696c 652e 6669  dataset, file.fi
+0004f6b0: 6c65 5f70 6174 682c 2066 696c 652e 6669  le_path, file.fi
+0004f6c0: 6c65 5f6e 616d 652c 2066 696c 652e 6465  le_name, file.de
+0004f6d0: 6c69 6d69 7465 725f 6368 6172 6163 7465  limiter_characte
+0004f6e0: 725d 206e 6f74 2069 6e20 6669 6c65 735f  r] not in files_
+0004f6f0: 6c6f 6164 6564 3a0d 0a20 2020 2020 2020  loaded:..       
+0004f700: 2020 2020 2020 2020 2063 6c6f 7365 5f66           close_f
+0004f710: 696c 6520 3d20 5b66 696c 652e 6964 5f64  ile = [file.id_d
+0004f720: 6174 6173 6574 2c20 6669 6c65 2e66 696c  ataset, file.fil
+0004f730: 655f 7061 7468 2c20 6669 6c65 2e66 696c  e_path, file.fil
+0004f740: 655f 6e61 6d65 2c20 6669 6c65 2e64 656c  e_name, file.del
+0004f750: 696d 6974 6572 5f63 6861 7261 6374 6572  imiter_character
+0004f760: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f780: 2020 6669 6c65 2e6d 6574 615f 6f77 6e65    file.meta_owne
+0004f790: 722c 2022 2722 202b 2073 7472 2866 696c  r, "'" + str(fil
+0004f7a0: 652e 7374 6172 745f 6461 7465 2920 2b20  e.start_date) + 
+0004f7b0: 2227 222c 0d0a 2020 2020 2020 2020 2020  "'",..          
+0004f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f7d0: 2020 2020 2073 656c 662e 636f 6e6e 6563       self.connec
+0004f7e0: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
+0004f7f0: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
+0004f800: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
+0004f810: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+0004f820: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
+0004f830: 5f64 6174 6173 6574 5f66 696c 6528 5b63  _dataset_file([c
+0004f840: 6c6f 7365 5f66 696c 655d 290d 0a0d 0a20  lose_file]).... 
+0004f850: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
+0004f860: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
+0004f870: 6e61 6d65 2c20 2246 696e 6973 6865 6420  name, "Finished 
+0004f880: 746f 2070 726f 6365 7373 204d 6574 6164  to process Metad
+0004f890: 6174 6120 5b20 4669 6c65 7320 5d20 696e  ata [ Files ] in
+0004f8a0: 666f 726d 6174 696f 6e22 2c20 4c4f 475f  formation", LOG_
+0004f8b0: 4c45 5645 4c5f 4f4e 4c59 5f4c 4f47 290d  LEVEL_ONLY_LOG).
+0004f8c0: 0a0d 0a20 2020 2064 6566 2070 726f 6365  ...    def proce
+0004f8d0: 7373 5f65 6c74 5f72 656c 6174 696f 6e73  ss_elt_relations
+0004f8e0: 6869 7028 7365 6c66 293a 0d0a 2020 2020  hip(self):..    
+0004f8f0: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
+0004f900: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
+0004f910: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
+0004f920: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
+0004f930: 205b 2052 656c 6174 696f 6e73 6869 7020   [ Relationship 
+0004f940: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+0004f950: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+0004f960: 4f47 290d 0a0d 0a20 2020 2020 2020 206e  OG)....        n
+0004f970: 6578 745f 6964 5f72 656c 6174 696f 6e73  ext_id_relations
+0004f980: 6869 7020 3d20 7365 6c66 2e6e 6578 745f  hip = self.next_
+0004f990: 6964 5f72 656c 6174 696f 6e73 6869 700d  id_relationship.
+0004f9a0: 0a20 2020 2020 2020 2023 2323 2323 2323  .        #######
+0004f9b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004f9c0: 2320 4c4f 4144 2052 454c 4154 494f 4e53  # LOAD RELATIONS
+0004f9d0: 4849 5053 2023 2323 2323 2323 2323 2323  HIPS ###########
+0004f9e0: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
+0004f9f0: 2020 2020 2020 2023 2049 6e70 7574 2072         # Input r
+0004fa00: 656c 6174 696f 6e73 6869 7073 0d0a 2020  elationships..  
+0004fa10: 2020 2020 2020 7265 6c61 7469 6f6e 7368        relationsh
+0004fa20: 6970 735f 6c6f 6164 6564 203d 205b 5d0d  ips_loaded = [].
+0004fa30: 0a20 2020 2020 2020 2066 6f72 2072 656c  .        for rel
+0004fa40: 6174 696f 6e73 6869 7020 696e 2073 656c  ationship in sel
+0004fa50: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0004fa60: 6c2e 656e 7472 795f 6461 7461 7365 745f  l.entry_dataset_
+0004fa70: 7265 6c61 7469 6f6e 7368 6970 3a0d 0a20  relationship:.. 
+0004fa80: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+0004fa90: 6574 5f6d 6173 7465 7220 3d20 7365 6c66  et_master = self
+0004faa0: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
+0004fab0: 642e 6765 745f 6461 7461 7365 745f 6672  d.get_dataset_fr
+0004fac0: 6f6d 5f64 6174 6173 6574 5f6e 616d 6528  om_dataset_name(
+0004fad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004fae0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+0004faf0: 6163 7475 616c 2e67 6574 5f74 6162 6c65  actual.get_table
+0004fb00: 5f6e 616d 655f 6672 6f6d 5f63 6f64 5f65  _name_from_cod_e
+0004fb10: 6e74 6974 795f 6f6e 5f65 6e74 7279 2872  ntity_on_entry(r
+0004fb20: 656c 6174 696f 6e73 6869 702e 636f 645f  elationship.cod_
+0004fb30: 656e 7469 7479 5f6d 6173 7465 7229 290d  entity_master)).
+0004fb40: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0004fb50: 6173 6574 5f73 7065 635f 6d61 7374 6572  aset_spec_master
+0004fb60: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+0004fb70: 5f74 6f5f 6c6f 6164 2e67 6574 5f64 6174  _to_load.get_dat
+0004fb80: 6173 6574 5f73 7065 635f 6672 6f6d 5f69  aset_spec_from_i
+0004fb90: 645f 6461 7461 7365 745f 616e 645f 636f  d_dataset_and_co
+0004fba0: 6c75 6d6e 5f6e 616d 6528 0d0a 2020 2020  lumn_name(..    
+0004fbb0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0004fbc0: 7365 745f 6d61 7374 6572 2e69 645f 6461  set_master.id_da
+0004fbd0: 7461 7365 742c 2072 656c 6174 696f 6e73  taset, relations
+0004fbe0: 6869 702e 636f 6c75 6d6e 5f6e 616d 655f  hip.column_name_
+0004fbf0: 6d61 7374 6572 290d 0a0d 0a20 2020 2020  master)....     
+0004fc00: 2020 2020 2020 2064 6174 6173 6574 5f64         dataset_d
+0004fc10: 6574 6169 6c20 3d20 7365 6c66 2e6d 6574  etail = self.met
+0004fc20: 6164 6174 615f 746f 5f6c 6f61 642e 6765  adata_to_load.ge
+0004fc30: 745f 6461 7461 7365 745f 6672 6f6d 5f64  t_dataset_from_d
+0004fc40: 6174 6173 6574 5f6e 616d 6528 0d0a 2020  ataset_name(..  
+0004fc50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0004fc60: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+0004fc70: 616c 2e67 6574 5f74 6162 6c65 5f6e 616d  al.get_table_nam
+0004fc80: 655f 6672 6f6d 5f63 6f64 5f65 6e74 6974  e_from_cod_entit
+0004fc90: 795f 6f6e 5f65 6e74 7279 2872 656c 6174  y_on_entry(relat
+0004fca0: 696f 6e73 6869 702e 636f 645f 656e 7469  ionship.cod_enti
+0004fcb0: 7479 5f64 6574 6169 6c29 290d 0a20 2020  ty_detail))..   
+0004fcc0: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+0004fcd0: 5f73 7065 635f 6465 7461 696c 203d 2073  _spec_detail = s
+0004fce0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+0004fcf0: 6c6f 6164 2e67 6574 5f64 6174 6173 6574  load.get_dataset
+0004fd00: 5f73 7065 635f 6672 6f6d 5f69 645f 6461  _spec_from_id_da
+0004fd10: 7461 7365 745f 616e 645f 636f 6c75 6d6e  taset_and_column
+0004fd20: 5f6e 616d 6528 0d0a 2020 2020 2020 2020  _name(..        
+0004fd30: 2020 2020 2020 2020 6461 7461 7365 745f          dataset_
+0004fd40: 6465 7461 696c 2e69 645f 6461 7461 7365  detail.id_datase
+0004fd50: 742c 2072 656c 6174 696f 6e73 6869 702e  t, relationship.
+0004fd60: 636f 6c75 6d6e 5f6e 616d 655f 6465 7461  column_name_deta
+0004fd70: 696c 290d 0a20 2020 2020 2020 2020 2020  il)..           
+0004fd80: 206a 6f69 6e5f 7479 7065 203d 2073 656c   join_type = sel
+0004fd90: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+0004fda0: 6c2e 6765 745f 6a6f 696e 5f74 7970 655f  l.get_join_type_
+0004fdb0: 6672 6f6d 5f6a 6f69 6e5f 6e61 6d65 2872  from_join_name(r
+0004fdc0: 656c 6174 696f 6e73 6869 702e 7265 6c61  elationship.rela
+0004fdd0: 7469 6f6e 7368 6970 5f74 7970 6529 0d0a  tionship_type)..
+0004fde0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0004fdf0: 6c61 7469 6f6e 7368 6970 5f65 7869 7374  lationship_exist
+0004fe00: 656e 7420 3d20 7365 6c66 2e6d 6574 6164  ent = self.metad
+0004fe10: 6174 615f 6163 7475 616c 2e67 6574 5f72  ata_actual.get_r
+0004fe20: 656c 6174 696f 6e73 6869 705f 6672 6f6d  elationship_from
+0004fe30: 5f69 645f 6461 7461 7365 745f 7370 6563  _id_dataset_spec
+0004fe40: 5f6d 6173 7465 725f 616e 645f 6465 7461  _master_and_deta
+0004fe50: 696c 280d 0a20 2020 2020 2020 2020 2020  il(..           
+0004fe60: 2020 2020 2064 6174 6173 6574 5f73 7065       dataset_spe
+0004fe70: 635f 6d61 7374 6572 2e69 645f 6461 7461  c_master.id_data
+0004fe80: 7365 745f 7370 6563 2c0d 0a20 2020 2020  set_spec,..     
+0004fe90: 2020 2020 2020 2020 2020 2064 6174 6173             datas
+0004fea0: 6574 5f73 7065 635f 6465 7461 696c 2e69  et_spec_detail.i
+0004feb0: 645f 6461 7461 7365 745f 7370 6563 290d  d_dataset_spec).
+0004fec0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+0004fed0: 6620 7265 6c61 7469 6f6e 7368 6970 5f65  f relationship_e
+0004fee0: 7869 7374 656e 7420 6973 204e 6f6e 653a  xistent is None:
+0004fef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004ff00: 2020 2320 4e65 7720 7265 6c61 7469 6f6e    # New relation
+0004ff10: 7368 6970 0d0a 2020 2020 2020 2020 2020  ship..          
+0004ff20: 2020 2020 2020 6964 5f72 656c 6174 696f        id_relatio
+0004ff30: 6e73 6869 7020 3d20 6e65 7874 5f69 645f  nship = next_id_
+0004ff40: 7265 6c61 7469 6f6e 7368 6970 0d0a 2020  relationship..  
+0004ff50: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0004ff60: 7874 5f69 645f 7265 6c61 7469 6f6e 7368  xt_id_relationsh
+0004ff70: 6970 202b 3d20 310d 0a0d 0a20 2020 2020  ip += 1....     
+0004ff80: 2020 2020 2020 2020 2020 206e 6577 5f72             new_r
+0004ff90: 656c 6174 696f 6e73 6869 7020 3d20 5b69  elationship = [i
+0004ffa0: 645f 7265 6c61 7469 6f6e 7368 6970 2c20  d_relationship, 
+0004ffb0: 6461 7461 7365 745f 7370 6563 5f6d 6173  dataset_spec_mas
+0004ffc0: 7465 722e 6964 5f64 6174 6173 6574 5f73  ter.id_dataset_s
+0004ffd0: 7065 632c 0d0a 2020 2020 2020 2020 2020  pec,..          
+0004ffe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004fff0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+00050000: 745f 7370 6563 5f64 6574 6169 6c2e 6964  t_spec_detail.id
+00050010: 5f64 6174 6173 6574 5f73 7065 632c 0d0a  _dataset_spec,..
+00050020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050040: 2020 2020 6a6f 696e 5f74 7970 652e 6964      join_type.id
+00050050: 5f6a 6f69 6e5f 7479 7065 2c20 7365 6c66  _join_type, self
+00050060: 2e6f 776e 6572 2c20 7365 6c66 2e63 6f6e  .owner, self.con
+00050070: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
+00050080: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
+00050090: 7565 2829 2c20 224e 554c 4c22 5d0d 0a20  ue(), "NULL"].. 
+000500a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000500b0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+000500c0: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+000500d0: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
+000500e0: 7328 5b6e 6577 5f72 656c 6174 696f 6e73  s([new_relations
+000500f0: 6869 705d 290d 0a20 2020 2020 2020 2020  hip])..         
+00050100: 2020 2020 2020 2072 656c 6174 696f 6e73         relations
+00050110: 6869 7073 5f6c 6f61 6465 642e 6170 7065  hips_loaded.appe
+00050120: 6e64 285b 6461 7461 7365 745f 7370 6563  nd([dataset_spec
+00050130: 5f6d 6173 7465 722e 6964 5f64 6174 6173  _master.id_datas
+00050140: 6574 5f73 7065 632c 2064 6174 6173 6574  et_spec, dataset
+00050150: 5f73 7065 635f 6465 7461 696c 2e69 645f  _spec_detail.id_
+00050160: 6461 7461 7365 745f 7370 6563 5d29 0d0a  dataset_spec])..
+00050170: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00050180: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00050190: 2020 2020 2023 2055 7064 6174 6520 7265       # Update re
+000501a0: 6c61 7469 6f6e 7368 6970 0d0a 2020 2020  lationship..    
+000501b0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000501c0: 656c 6174 696f 6e73 6869 705f 6578 6973  elationship_exis
+000501d0: 7465 6e74 2e69 645f 6a6f 696e 5f74 7970  tent.id_join_typ
+000501e0: 6520 3d3d 206a 6f69 6e5f 7479 7065 2e69  e == join_type.i
+000501f0: 645f 6a6f 696e 5f74 7970 653a 0d0a 2020  d_join_type:..  
+00050200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050210: 2020 6f6c 645f 7265 6c61 7469 6f6e 7368    old_relationsh
+00050220: 6970 203d 205b 7265 6c61 7469 6f6e 7368  ip = [relationsh
+00050230: 6970 5f65 7869 7374 656e 742e 6964 5f72  ip_existent.id_r
+00050240: 656c 6174 696f 6e73 6869 702c 0d0a 2020  elationship,..  
+00050250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050270: 2020 2020 2020 7265 6c61 7469 6f6e 7368        relationsh
+00050280: 6970 5f65 7869 7374 656e 742e 6964 5f64  ip_existent.id_d
+00050290: 6174 6173 6574 5f73 7065 635f 6d61 7374  ataset_spec_mast
+000502a0: 6572 2c0d 0a20 2020 2020 2020 2020 2020  er,..           
+000502b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000502c0: 2020 2020 2020 2020 2020 2020 2072 656c               rel
+000502d0: 6174 696f 6e73 6869 705f 6578 6973 7465  ationship_existe
+000502e0: 6e74 2e69 645f 6461 7461 7365 745f 7370  nt.id_dataset_sp
+000502f0: 6563 5f64 6574 6169 6c2c 0d0a 2020 2020  ec_detail,..    
+00050300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050320: 2020 2020 7265 6c61 7469 6f6e 7368 6970      relationship
+00050330: 5f65 7869 7374 656e 742e 6964 5f6a 6f69  _existent.id_joi
+00050340: 6e5f 7479 7065 2c20 7265 6c61 7469 6f6e  n_type, relation
+00050350: 7368 6970 5f65 7869 7374 656e 742e 6d65  ship_existent.me
+00050360: 7461 5f6f 776e 6572 2c0d 0a20 2020 2020  ta_owner,..     
 00050370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050380: 2020 2020 2072 656c 6174 696f 6e73 6869       relationshi
-00050390: 702e 6964 5f64 6174 6173 6574 5f73 7065  p.id_dataset_spe
-000503a0: 635f 6d61 7374 6572 2c0d 0a20 2020 2020  c_master,..     
-000503b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000503c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000503d0: 656c 6174 696f 6e73 6869 702e 6964 5f64  elationship.id_d
-000503e0: 6174 6173 6574 5f73 7065 635f 6465 7461  ataset_spec_deta
-000503f0: 696c 2c0d 0a20 2020 2020 2020 2020 2020  il,..           
-00050400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050410: 2020 2020 2020 2020 2072 656c 6174 696f           relatio
-00050420: 6e73 6869 702e 6964 5f6a 6f69 6e5f 7479  nship.id_join_ty
-00050430: 7065 2c20 7265 6c61 7469 6f6e 7368 6970  pe, relationship
-00050440: 2e6d 6574 615f 6f77 6e65 722c 0d0a 2020  .meta_owner,..  
-00050450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050390: 2020 2022 2722 202b 2073 7472 2872 656c     "'" + str(rel
+000503a0: 6174 696f 6e73 6869 705f 6578 6973 7465  ationship_existe
+000503b0: 6e74 2e73 7461 7274 5f64 6174 6529 202b  nt.start_date) +
+000503c0: 2022 2722 2c20 224e 554c 4c22 5d0d 0a20   "'", "NULL"].. 
+000503d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000503e0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+000503f0: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+00050400: 6461 7461 7365 745f 7265 6c61 7469 6f6e  dataset_relation
+00050410: 7368 6970 7328 5b6f 6c64 5f72 656c 6174  ships([old_relat
+00050420: 696f 6e73 6869 705d 290d 0a20 2020 2020  ionship])..     
+00050430: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00050440: 656c 6174 696f 6e73 6869 7073 5f6c 6f61  elationships_loa
+00050450: 6465 642e 6170 7065 6e64 280d 0a20 2020  ded.append(..   
 00050460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050470: 2020 2227 2220 2b20 7374 7228 7265 6c61    "'" + str(rela
-00050480: 7469 6f6e 7368 6970 2e73 7461 7274 5f64  tionship.start_d
-00050490: 6174 6529 202b 2022 2722 2c20 7365 6c66  ate) + "'", self
-000504a0: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
-000504b0: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
-000504c0: 5f76 616c 7565 2829 5d0d 0a20 2020 2020  _value()]..     
-000504d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000504e0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-000504f0: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
-00050500: 7265 6c61 7469 6f6e 7368 6970 7328 5b6f  relationships([o
-00050510: 6c64 5f72 656c 6174 696f 6e73 6869 705d  ld_relationship]
-00050520: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00050530: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
-00050540: 6e67 696e 655f 6e61 6d65 2c20 2246 696e  ngine_name, "Fin
-00050550: 6973 6865 6420 746f 2070 726f 6365 7373  ished to process
-00050560: 204d 6574 6164 6174 6120 5b20 5265 6c61   Metadata [ Rela
-00050570: 7469 6f6e 7368 6970 205d 2069 6e66 6f72  tionship ] infor
-00050580: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
-00050590: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
-000505a0: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
-000505b0: 656c 745f 6167 6772 6567 6174 6f72 2873  elt_aggregator(s
-000505c0: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
-000505d0: 656c 662e 6c6f 672e 6c6f 6728 7365 6c66  elf.log.log(self
-000505e0: 2e65 6e67 696e 655f 6e61 6d65 2c20 2253  .engine_name, "S
-000505f0: 7461 7274 696e 6720 746f 2070 726f 6365  tarting to proce
-00050600: 7373 204d 6574 6164 6174 6120 5b20 4167  ss Metadata [ Ag
-00050610: 6772 6567 6174 6f72 205d 2069 6e66 6f72  gregator ] infor
-00050620: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
-00050630: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
-00050640: 2020 2020 2020 2020 6e65 7874 5f69 645f          next_id_
-00050650: 6167 6720 3d20 7365 6c66 2e6e 6578 745f  agg = self.next_
-00050660: 6964 5f61 6767 0d0a 2020 2020 2020 2020  id_agg..        
-00050670: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00050680: 2323 2323 2323 2323 204c 4f41 4420 4147  ######## LOAD AG
-00050690: 4752 4547 4154 4f52 2023 2323 2323 2323  GREGATOR #######
-000506a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000506b0: 230d 0a20 2020 2020 2020 2023 2049 6e70  #..        # Inp
-000506c0: 7574 204f 7264 6572 730d 0a20 2020 2020  ut Orders..     
-000506d0: 2020 2061 6767 5f6c 6f61 6465 6420 3d20     agg_loaded = 
-000506e0: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
-000506f0: 6167 6720 696e 2073 656c 662e 6d65 7461  agg in self.meta
-00050700: 6461 7461 5f61 6374 7561 6c2e 656e 7472  data_actual.entr
-00050710: 795f 6167 6772 6567 6174 6f72 733a 0d0a  y_aggregators:..
-00050720: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00050730: 7365 7420 3d20 7365 6c66 2e6d 6574 6164  set = self.metad
-00050740: 6174 615f 746f 5f6c 6f61 642e 6765 745f  ata_to_load.get_
-00050750: 6461 7461 7365 745f 6672 6f6d 5f64 6174  dataset_from_dat
-00050760: 6173 6574 5f6e 616d 6528 7365 6c66 2e6d  aset_name(self.m
-00050770: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-00050780: 6574 5f74 6162 6c65 5f6e 616d 655f 6672  et_table_name_fr
-00050790: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6f6e  om_cod_entity_on
-000507a0: 5f65 6e74 7279 2861 6767 2e63 6f64 5f65  _entry(agg.cod_e
-000507b0: 6e74 6974 795f 7461 7267 6574 2929 0d0a  ntity_target))..
-000507c0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-000507d0: 7365 745f 7372 6320 3d20 7365 6c66 2e6d  set_src = self.m
-000507e0: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
-000507f0: 6765 745f 6461 7461 7365 745f 6672 6f6d  get_dataset_from
-00050800: 5f64 6174 6173 6574 5f6e 616d 6528 7365  _dataset_name(se
-00050810: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00050820: 616c 2e67 6574 5f74 6162 6c65 5f6e 616d  al.get_table_nam
-00050830: 655f 6672 6f6d 5f63 6f64 5f65 6e74 6974  e_from_cod_entit
-00050840: 795f 6f6e 5f65 6e74 7279 2861 6767 2e63  y_on_entry(agg.c
-00050850: 6f64 5f65 6e74 6974 795f 7372 6329 290d  od_entity_src)).
-00050860: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00050870: 6173 6574 5f73 7065 6320 3d20 7365 6c66  aset_spec = self
-00050880: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
-00050890: 642e 6765 745f 6461 7461 7365 745f 7370  d.get_dataset_sp
-000508a0: 6563 5f66 726f 6d5f 6964 5f64 6174 6173  ec_from_id_datas
-000508b0: 6574 5f61 6e64 5f63 6f6c 756d 6e5f 6e61  et_and_column_na
-000508c0: 6d65 2864 6174 6173 6574 5f73 7263 2e69  me(dataset_src.i
-000508d0: 645f 6461 7461 7365 742c 2061 6767 2e63  d_dataset, agg.c
-000508e0: 6f6c 756d 6e5f 6e61 6d65 290d 0a20 2020  olumn_name)..   
-000508f0: 2020 2020 2020 2020 2061 6767 5f65 7869           agg_exi
-00050900: 7374 656e 7420 3d20 7365 6c66 2e6d 6574  stent = self.met
-00050910: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
-00050920: 5f61 6767 7265 6761 746f 725f 6672 6f6d  _aggregator_from
-00050930: 5f69 645f 6461 7461 7365 745f 616e 645f  _id_dataset_and_
-00050940: 6964 5f64 6174 6173 6574 5f73 7065 635f  id_dataset_spec_
-00050950: 616e 645f 6964 5f62 7261 6e63 6828 0d0a  and_id_branch(..
-00050960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050970: 6461 7461 7365 742e 6964 5f64 6174 6173  dataset.id_datas
-00050980: 6574 2c20 6461 7461 7365 745f 7370 6563  et, dataset_spec
-00050990: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
-000509a0: 2c20 6167 672e 6e75 6d5f 6272 616e 6368  , agg.num_branch
-000509b0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-000509c0: 2069 6620 6167 675f 6578 6973 7465 6e74   if agg_existent
-000509d0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000509e0: 2020 2020 2020 2020 2020 2069 645f 745f             id_t_
-000509f0: 6167 6720 3d20 6e65 7874 5f69 645f 6167  agg = next_id_ag
-00050a00: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
-00050a10: 2020 206e 6578 745f 6964 5f61 6767 202b     next_id_agg +
-00050a20: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00050a30: 2020 2020 206e 6577 5f61 6767 203d 205b       new_agg = [
-00050a40: 6964 5f74 5f61 6767 2c20 6461 7461 7365  id_t_agg, datase
-00050a50: 742e 6964 5f64 6174 6173 6574 2c20 6167  t.id_dataset, ag
-00050a60: 672e 6e75 6d5f 6272 616e 6368 2c20 6461  g.num_branch, da
-00050a70: 7461 7365 745f 7370 6563 2e69 645f 6461  taset_spec.id_da
-00050a80: 7461 7365 745f 7370 6563 2c20 7365 6c66  taset_spec, self
-00050a90: 2e6f 776e 6572 2c0d 0a20 2020 2020 2020  .owner,..       
-00050aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ab0: 2020 2020 7365 6c66 2e63 6f6e 6e65 6374      self.connect
-00050ac0: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
-00050ad0: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
-00050ae0: 2c20 224e 554c 4c22 5d0d 0a20 2020 2020  , "NULL"]..     
-00050af0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00050b00: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-00050b10: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
-00050b20: 745f 6167 6728 5b6e 6577 5f61 6767 5d29  t_agg([new_agg])
-00050b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050b40: 2020 6167 675f 6c6f 6164 6564 2e61 7070    agg_loaded.app
-00050b50: 656e 6428 5b64 6174 6173 6574 2e69 645f  end([dataset.id_
-00050b60: 6461 7461 7365 742c 2061 6767 2e6e 756d  dataset, agg.num
-00050b70: 5f62 7261 6e63 682c 2064 6174 6173 6574  _branch, dataset
-00050b80: 5f73 7065 632e 6964 5f64 6174 6173 6574  _spec.id_dataset
-00050b90: 5f73 7065 635d 290d 0a20 2020 2020 2020  _spec])..       
-00050ba0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00050bb0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00050bc0: 6167 6720 3d20 5b61 6767 5f65 7869 7374  agg = [agg_exist
-00050bd0: 656e 742e 6964 5f74 5f61 6767 2c20 6167  ent.id_t_agg, ag
-00050be0: 675f 6578 6973 7465 6e74 2e69 645f 6461  g_existent.id_da
-00050bf0: 7461 7365 742c 2061 6767 5f65 7869 7374  taset, agg_exist
-00050c00: 656e 742e 6964 5f62 7261 6e63 682c 0d0a  ent.id_branch,..
+00050470: 2020 2020 205b 7265 6c61 7469 6f6e 7368       [relationsh
+00050480: 6970 5f65 7869 7374 656e 742e 6964 5f64  ip_existent.id_d
+00050490: 6174 6173 6574 5f73 7065 635f 6d61 7374  ataset_spec_mast
+000504a0: 6572 2c20 7265 6c61 7469 6f6e 7368 6970  er, relationship
+000504b0: 5f65 7869 7374 656e 742e 6964 5f64 6174  _existent.id_dat
+000504c0: 6173 6574 5f73 7065 635f 6465 7461 696c  aset_spec_detail
+000504d0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+000504e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+000504f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00050500: 6c64 5f72 656c 6174 696f 6e73 6869 7020  ld_relationship 
+00050510: 3d20 5b72 656c 6174 696f 6e73 6869 705f  = [relationship_
+00050520: 6578 6973 7465 6e74 2e69 645f 7265 6c61  existent.id_rela
+00050530: 7469 6f6e 7368 6970 2c0d 0a20 2020 2020  tionship,..     
+00050540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050560: 2020 2072 656c 6174 696f 6e73 6869 705f     relationship_
+00050570: 6578 6973 7465 6e74 2e69 645f 6461 7461  existent.id_data
+00050580: 7365 745f 7370 6563 5f6d 6173 7465 722c  set_spec_master,
+00050590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000505a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000505b0: 2020 2020 2020 2020 2020 7265 6c61 7469            relati
+000505c0: 6f6e 7368 6970 5f65 7869 7374 656e 742e  onship_existent.
+000505d0: 6964 5f64 6174 6173 6574 5f73 7065 635f  id_dataset_spec_
+000505e0: 6465 7461 696c 2c0d 0a20 2020 2020 2020  detail,..       
+000505f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050610: 2072 656c 6174 696f 6e73 6869 705f 6578   relationship_ex
+00050620: 6973 7465 6e74 2e69 645f 6a6f 696e 5f74  istent.id_join_t
+00050630: 7970 652c 2072 656c 6174 696f 6e73 6869  ype, relationshi
+00050640: 705f 6578 6973 7465 6e74 2e6d 6574 615f  p_existent.meta_
+00050650: 6f77 6e65 722c 0d0a 2020 2020 2020 2020  owner,..        
+00050660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050680: 2227 2220 2b20 7374 7228 7265 6c61 7469  "'" + str(relati
+00050690: 6f6e 7368 6970 5f65 7869 7374 656e 742e  onship_existent.
+000506a0: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
+000506b0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+000506c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000506d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000506e0: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
+000506f0: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
+00050700: 5f76 616c 7565 2829 5d0d 0a20 2020 2020  _value()]..     
+00050710: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00050720: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+00050730: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+00050740: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
+00050750: 7328 5b6f 6c64 5f72 656c 6174 696f 6e73  s([old_relations
+00050760: 6869 705d 290d 0a20 2020 2020 2020 2020  hip])..         
+00050770: 2020 2020 2020 2020 2020 2072 656c 6174             relat
+00050780: 696f 6e73 6869 7073 5f6c 6f61 6465 642e  ionships_loaded.
+00050790: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+000507a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000507b0: 205b 7265 6c61 7469 6f6e 7368 6970 5f65   [relationship_e
+000507c0: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
+000507d0: 6574 5f73 7065 635f 6d61 7374 6572 2c20  et_spec_master, 
+000507e0: 7265 6c61 7469 6f6e 7368 6970 5f65 7869  relationship_exi
+000507f0: 7374 656e 742e 6964 5f64 6174 6173 6574  stent.id_dataset
+00050800: 5f73 7065 635f 6465 7461 696c 5d29 0d0a  _spec_detail])..
+00050810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050820: 2020 2020 6964 5f72 656c 6174 696f 6e73      id_relations
+00050830: 6869 7020 3d20 6e65 7874 5f69 645f 7265  hip = next_id_re
+00050840: 6c61 7469 6f6e 7368 6970 0d0a 2020 2020  lationship..    
+00050850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050860: 6e65 7874 5f69 645f 7265 6c61 7469 6f6e  next_id_relation
+00050870: 7368 6970 202b 3d20 310d 0a20 2020 2020  ship += 1..     
+00050880: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00050890: 6577 5f72 656c 6174 696f 6e73 6869 7020  ew_relationship 
+000508a0: 3d20 5b69 645f 7265 6c61 7469 6f6e 7368  = [id_relationsh
+000508b0: 6970 2c20 6461 7461 7365 745f 7370 6563  ip, dataset_spec
+000508c0: 5f6d 6173 7465 722e 6964 5f64 6174 6173  _master.id_datas
+000508d0: 6574 5f73 7065 632c 0d0a 2020 2020 2020  et_spec,..      
+000508e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000508f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050900: 2020 6461 7461 7365 745f 7370 6563 5f64    dataset_spec_d
+00050910: 6574 6169 6c2e 6964 5f64 6174 6173 6574  etail.id_dataset
+00050920: 5f73 7065 632c 0d0a 2020 2020 2020 2020  _spec,..        
+00050930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050950: 6a6f 696e 5f74 7970 652e 6964 5f6a 6f69  join_type.id_joi
+00050960: 6e5f 7479 7065 2c20 7365 6c66 2e6f 776e  n_type, self.own
+00050970: 6572 2c20 7365 6c66 2e63 6f6e 6e65 6374  er, self.connect
+00050980: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
+00050990: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
+000509a0: 2c20 224e 554c 4c22 5d0d 0a20 2020 2020  , "NULL"]..     
+000509b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000509c0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+000509d0: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+000509e0: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
+000509f0: 7328 5b6e 6577 5f72 656c 6174 696f 6e73  s([new_relations
+00050a00: 6869 705d 290d 0a20 2020 2020 2020 2020  hip])..         
+00050a10: 2020 2020 2020 2020 2020 2072 656c 6174             relat
+00050a20: 696f 6e73 6869 7073 5f6c 6f61 6465 642e  ionships_loaded.
+00050a30: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00050a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050a50: 205b 6461 7461 7365 745f 7370 6563 5f6d   [dataset_spec_m
+00050a60: 6173 7465 722e 6964 5f64 6174 6173 6574  aster.id_dataset
+00050a70: 5f73 7065 632c 2064 6174 6173 6574 5f73  _spec, dataset_s
+00050a80: 7065 635f 6465 7461 696c 2e69 645f 6461  pec_detail.id_da
+00050a90: 7461 7365 745f 7370 6563 5d29 0d0a 0d0a  taset_spec])....
+00050aa0: 2020 2020 2020 2020 2320 436c 6f73 6520          # Close 
+00050ab0: 7265 6c61 7469 6f6e 7368 6970 7320 7468  relationships th
+00050ac0: 6174 206e 6f74 2061 7272 6976 6520 616e  at not arrive an
+00050ad0: 796d 6f72 650d 0a20 2020 2020 2020 2066  ymore..        f
+00050ae0: 6f72 2072 656c 6174 696f 6e73 6869 7020  or relationship 
+00050af0: 696e 205b 7820 666f 7220 7820 696e 2073  in [x for x in s
+00050b00: 656c 662e 6d65 7461 6461 7461 5f61 6374  elf.metadata_act
+00050b10: 7561 6c2e 6f6d 5f64 6174 6173 6574 5f72  ual.om_dataset_r
+00050b20: 656c 6174 696f 6e73 6869 7073 2069 6620  elationships if 
+00050b30: 782e 656e 645f 6461 7465 2069 7320 4e6f  x.end_date is No
+00050b40: 6e65 5d3a 0d0a 2020 2020 2020 2020 2020  ne]:..          
+00050b50: 2020 6966 205b 7265 6c61 7469 6f6e 7368    if [relationsh
+00050b60: 6970 2e69 645f 6461 7461 7365 745f 7370  ip.id_dataset_sp
+00050b70: 6563 5f6d 6173 7465 722c 2072 656c 6174  ec_master, relat
+00050b80: 696f 6e73 6869 702e 6964 5f64 6174 6173  ionship.id_datas
+00050b90: 6574 5f73 7065 635f 6465 7461 696c 5d20  et_spec_detail] 
+00050ba0: 6e6f 7420 696e 2072 656c 6174 696f 6e73  not in relations
+00050bb0: 6869 7073 5f6c 6f61 6465 643a 0d0a 2020  hips_loaded:..  
+00050bc0: 2020 2020 2020 2020 2020 2020 2020 6f6c                ol
+00050bd0: 645f 7265 6c61 7469 6f6e 7368 6970 203d  d_relationship =
+00050be0: 205b 7265 6c61 7469 6f6e 7368 6970 2e69   [relationship.i
+00050bf0: 645f 7265 6c61 7469 6f6e 7368 6970 2c0d  d_relationship,.
+00050c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00050c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050c20: 2020 2020 2020 2020 2020 2061 6767 5f65             agg_e
-00050c30: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
-00050c40: 6574 5f73 7065 632c 0d0a 2020 2020 2020  et_spec,..      
+00050c20: 2020 2020 2072 656c 6174 696f 6e73 6869       relationshi
+00050c30: 702e 6964 5f64 6174 6173 6574 5f73 7065  p.id_dataset_spe
+00050c40: 635f 6d61 7374 6572 2c0d 0a20 2020 2020  c_master,..     
 00050c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050c60: 2020 2020 2061 6767 5f65 7869 7374 656e       agg_existen
-00050c70: 742e 6d65 7461 5f6f 776e 6572 2c20 2227  t.meta_owner, "'
-00050c80: 2220 2b20 7374 7228 6167 675f 6578 6973  " + str(agg_exis
-00050c90: 7465 6e74 2e73 7461 7274 5f64 6174 6529  tent.start_date)
-00050ca0: 202b 2022 2722 2c20 224e 554c 4c22 5d0d   + "'", "NULL"].
-00050cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00050cc0: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
-00050cd0: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
-00050ce0: 7461 7365 745f 745f 6167 6728 5b6e 6577  taset_t_agg([new
-00050cf0: 5f61 6767 5d29 0d0a 2020 2020 2020 2020  _agg])..        
-00050d00: 2020 2020 2020 2020 6167 675f 6c6f 6164          agg_load
-00050d10: 6564 2e61 7070 656e 6428 5b61 6767 5f65  ed.append([agg_e
-00050d20: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
-00050d30: 6574 2c20 6167 675f 6578 6973 7465 6e74  et, agg_existent
-00050d40: 2e69 645f 6272 616e 6368 2c20 6167 675f  .id_branch, agg_
-00050d50: 6578 6973 7465 6e74 2e69 645f 6461 7461  existent.id_data
-00050d60: 7365 745f 7370 6563 5d29 0d0a 0d0a 2020  set_spec])....  
-00050d70: 2020 2020 2020 666f 7220 6167 6720 696e        for agg in
-00050d80: 205b 7820 666f 7220 7820 696e 2073 656c   [x for x in sel
-00050d90: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00050da0: 6c2e 6f6d 5f64 6174 6173 6574 5f74 5f61  l.om_dataset_t_a
-00050db0: 6767 2069 6620 782e 656e 645f 6461 7465  gg if x.end_date
-00050dc0: 2069 7320 4e6f 6e65 5d3a 0d0a 2020 2020   is None]:..    
-00050dd0: 2020 2020 2020 2020 6966 205b 6167 672e          if [agg.
-00050de0: 6964 5f64 6174 6173 6574 2c20 6167 672e  id_dataset, agg.
-00050df0: 6964 5f62 7261 6e63 682c 2061 6767 2e69  id_branch, agg.i
-00050e00: 645f 6461 7461 7365 745f 7370 6563 5d20  d_dataset_spec] 
-00050e10: 6e6f 7420 696e 2061 6767 5f6c 6f61 6465  not in agg_loade
-00050e20: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00050e30: 2020 2020 6e65 775f 6167 6720 3d20 5b61      new_agg = [a
-00050e40: 6767 2e69 645f 745f 6167 672c 2061 6767  gg.id_t_agg, agg
-00050e50: 2e69 645f 6461 7461 7365 742c 2061 6767  .id_dataset, agg
-00050e60: 2e69 645f 6272 616e 6368 2c0d 0a20 2020  .id_branch,..   
-00050e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050e80: 2020 2020 2020 2020 6167 672e 6964 5f64          agg.id_d
-00050e90: 6174 6173 6574 5f73 7065 632c 0d0a 2020  ataset_spec,..  
-00050ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050eb0: 2020 2020 2020 2020 2061 6767 2e6d 6574           agg.met
-00050ec0: 615f 6f77 6e65 722c 2022 2722 202b 2073  a_owner, "'" + s
-00050ed0: 7472 2861 6767 2e73 7461 7274 5f64 6174  tr(agg.start_dat
-00050ee0: 6529 202b 2022 2722 2c20 7365 6c66 2e63  e) + "'", self.c
-00050ef0: 6f6e 6e65 6374 696f 6e5f 6d65 7461 6461  onnection_metada
-00050f00: 7461 2e67 6574 5f73 7973 6461 7465 5f76  ta.get_sysdate_v
-00050f10: 616c 7565 2829 5d0d 0a20 2020 2020 2020  alue()]..       
-00050f20: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00050f30: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-00050f40: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
-00050f50: 6167 6728 5b6e 6577 5f61 6767 5d29 0d0a  agg([new_agg])..
-00050f60: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-00050f70: 6f67 2e6c 6f67 2873 656c 662e 656e 6769  og.log(self.engi
-00050f80: 6e65 5f6e 616d 652c 2022 4669 6e69 7368  ne_name, "Finish
-00050f90: 6564 2074 6f20 7072 6f63 6573 7320 4d65  ed to process Me
-00050fa0: 7461 6461 7461 205b 2041 6767 7265 6761  tadata [ Aggrega
-00050fb0: 746f 7220 5d20 696e 666f 726d 6174 696f  tor ] informatio
-00050fc0: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
-00050fd0: 4c59 5f4c 4f47 290d 0a0d 0a20 2020 2064  LY_LOG)....    d
-00050fe0: 6566 2070 726f 6365 7373 5f65 6c74 5f64  ef process_elt_d
-00050ff0: 6973 7469 6e63 7428 7365 6c66 293a 0d0a  istinct(self):..
-00051000: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00051010: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
-00051020: 5f6e 616d 652c 2022 5374 6172 7469 6e67  _name, "Starting
-00051030: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
-00051040: 6461 7461 205b 2044 6973 7469 6e63 7420  data [ Distinct 
-00051050: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
-00051060: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
-00051070: 4f47 290d 0a20 2020 2020 2020 2023 2323  OG)..        ###
-00051080: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00051090: 2323 2323 2320 4c4f 4144 2044 4953 5449  ##### LOAD DISTI
-000510a0: 4e43 5420 2323 2323 2323 2323 2323 2323  NCT ############
-000510b0: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
-000510c0: 2020 2020 2020 2320 496e 7075 7420 6469        # Input di
-000510d0: 7374 696e 6374 0d0a 2020 2020 2020 2020  stinct..        
-000510e0: 6e65 7874 5f69 645f 745f 6469 7374 696e  next_id_t_distin
-000510f0: 6374 203d 2073 656c 662e 6e65 7874 5f69  ct = self.next_i
-00051100: 645f 745f 6469 7374 696e 6374 0d0a 2020  d_t_distinct..  
-00051110: 2020 2020 2020 6469 7374 696e 6374 5f6c        distinct_l
-00051120: 6f61 6465 6420 3d20 5b5d 0d0a 2020 2020  oaded = []..    
-00051130: 2020 2020 666f 7220 6d61 7070 696e 6720      for mapping 
-00051140: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
-00051150: 5f61 6374 7561 6c2e 656e 7472 795f 6461  _actual.entry_da
-00051160: 7461 7365 745f 6d61 7070 696e 6773 3a0d  taset_mappings:.
-00051170: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00051180: 6173 6574 203d 2073 656c 662e 6d65 7461  aset = self.meta
-00051190: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
-000511a0: 5f64 6174 6173 6574 5f66 726f 6d5f 6461  _dataset_from_da
-000511b0: 7461 7365 745f 6e61 6d65 2873 656c 662e  taset_name(self.
-000511c0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-000511d0: 6765 745f 7461 626c 655f 6e61 6d65 5f66  get_table_name_f
-000511e0: 726f 6d5f 636f 645f 656e 7469 7479 5f6f  rom_cod_entity_o
-000511f0: 6e5f 656e 7472 7928 6d61 7070 696e 672e  n_entry(mapping.
-00051200: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-00051210: 7429 290d 0a20 2020 2020 2020 2020 2020  t))..           
-00051220: 2069 645f 6272 616e 6368 203d 206d 6170   id_branch = map
-00051230: 7069 6e67 2e6e 756d 5f62 7261 6e63 680d  ping.num_branch.
-00051240: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
-00051250: 7469 6e63 745f 6578 6973 7465 6e74 203d  tinct_existent =
-00051260: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00051270: 6374 7561 6c2e 6765 745f 6469 7374 696e  ctual.get_distin
-00051280: 6374 5f66 726f 6d5f 6964 5f64 6174 6173  ct_from_id_datas
-00051290: 6574 5f61 6e64 5f62 7261 6e63 6828 6461  et_and_branch(da
-000512a0: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
-000512b0: 2c20 6964 5f62 7261 6e63 6829 0d0a 2020  , id_branch)..  
-000512c0: 2020 2020 2020 2020 2020 7377 5f64 6973            sw_dis
-000512d0: 7469 6e63 7420 3d20 6d61 7070 696e 672e  tinct = mapping.
-000512e0: 7377 5f64 6973 7469 6e63 740d 0a20 2020  sw_distinct..   
-000512f0: 2020 2020 2020 2020 2069 6620 5b64 6174           if [dat
-00051300: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
-00051310: 2069 645f 6272 616e 6368 5d20 696e 2064   id_branch] in d
-00051320: 6973 7469 6e63 745f 6c6f 6164 6564 3a20  istinct_loaded: 
-00051330: 636f 6e74 696e 7565 0d0a 0d0a 2020 2020  continue....    
-00051340: 2020 2020 2020 2020 6966 2064 6973 7469          if disti
-00051350: 6e63 745f 6578 6973 7465 6e74 2069 7320  nct_existent is 
-00051360: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00051370: 2020 2020 2020 2069 645f 745f 6469 7374         id_t_dist
-00051380: 696e 6374 203d 206e 6578 745f 6964 5f74  inct = next_id_t
-00051390: 5f64 6973 7469 6e63 740d 0a20 2020 2020  _distinct..     
-000513a0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-000513b0: 6964 5f74 5f64 6973 7469 6e63 7420 2b3d  id_t_distinct +=
-000513c0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-000513d0: 2020 2020 6e65 775f 6469 7374 696e 6374      new_distinct
-000513e0: 203d 205b 6964 5f74 5f64 6973 7469 6e63   = [id_t_distinc
-000513f0: 742c 2064 6174 6173 6574 2e69 645f 6461  t, dataset.id_da
-00051400: 7461 7365 742c 2069 645f 6272 616e 6368  taset, id_branch
-00051410: 2c20 7377 5f64 6973 7469 6e63 742c 2073  , sw_distinct, s
-00051420: 656c 662e 6f77 6e65 722c 0d0a 2020 2020  elf.owner,..    
-00051430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051440: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00051450: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
-00051460: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
-00051470: 5f76 616c 7565 2829 2c20 224e 554c 4c22  _value(), "NULL"
-00051480: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00051490: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-000514a0: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-000514b0: 6461 7461 7365 745f 745f 6469 7374 696e  dataset_t_distin
-000514c0: 6374 285b 6e65 775f 6469 7374 696e 6374  ct([new_distinct
-000514d0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000514e0: 2020 2020 6469 7374 696e 6374 5f6c 6f61      distinct_loa
-000514f0: 6465 642e 6170 7065 6e64 285b 6461 7461  ded.append([data
-00051500: 7365 742e 6964 5f64 6174 6173 6574 2c20  set.id_dataset, 
-00051510: 6964 5f62 7261 6e63 685d 290d 0a0d 0a20  id_branch]).... 
-00051520: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00051530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051540: 2020 6966 2073 775f 6469 7374 696e 6374    if sw_distinct
-00051550: 203d 3d20 6469 7374 696e 6374 5f65 7869   == distinct_exi
-00051560: 7374 656e 742e 7377 5f64 6973 7469 6e63  stent.sw_distinc
-00051570: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00051580: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
-00051590: 5f64 6973 7469 6e63 7420 3d20 5b64 6973  _distinct = [dis
-000515a0: 7469 6e63 745f 6578 6973 7465 6e74 2e69  tinct_existent.i
-000515b0: 645f 745f 6469 7374 696e 6374 2c20 6469  d_t_distinct, di
-000515c0: 7374 696e 6374 5f65 7869 7374 656e 742e  stinct_existent.
-000515d0: 6964 5f64 6174 6173 6574 2c0d 0a20 2020  id_dataset,..   
-000515e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000515f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051600: 2020 2020 2020 6469 7374 696e 6374 5f65        distinct_e
-00051610: 7869 7374 656e 742e 6964 5f62 7261 6e63  xistent.id_branc
-00051620: 682c 2064 6973 7469 6e63 745f 6578 6973  h, distinct_exis
-00051630: 7465 6e74 2e73 775f 6469 7374 696e 6374  tent.sw_distinct
-00051640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051650: 2020 2020 2020 2020 2020 2c20 6469 7374            , dist
-00051660: 696e 6374 5f65 7869 7374 656e 742e 6d65  inct_existent.me
-00051670: 7461 5f6f 776e 6572 2c20 2227 2220 2b20  ta_owner, "'" + 
-00051680: 7374 7228 6469 7374 696e 6374 5f65 7869  str(distinct_exi
-00051690: 7374 656e 742e 7374 6172 745f 6461 7465  stent.start_date
-000516a0: 2920 2b20 2227 222c 2022 4e55 4c4c 225d  ) + "'", "NULL"]
-000516b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000516c0: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
-000516d0: 6174 615f 746f 5f6c 6f61 642e 6164 645f  ata_to_load.add_
-000516e0: 6f6d 5f64 6174 6173 6574 5f74 5f64 6973  om_dataset_t_dis
-000516f0: 7469 6e63 7428 5b65 7869 7374 656e 745f  tinct([existent_
-00051700: 6469 7374 696e 6374 5d29 0d0a 2020 2020  distinct])..    
+00050c60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00050c70: 656c 6174 696f 6e73 6869 702e 6964 5f64  elationship.id_d
+00050c80: 6174 6173 6574 5f73 7065 635f 6465 7461  ataset_spec_deta
+00050c90: 696c 2c0d 0a20 2020 2020 2020 2020 2020  il,..           
+00050ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050cb0: 2020 2020 2020 2020 2072 656c 6174 696f           relatio
+00050cc0: 6e73 6869 702e 6964 5f6a 6f69 6e5f 7479  nship.id_join_ty
+00050cd0: 7065 2c20 7265 6c61 7469 6f6e 7368 6970  pe, relationship
+00050ce0: 2e6d 6574 615f 6f77 6e65 722c 0d0a 2020  .meta_owner,..  
+00050cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050d10: 2020 2227 2220 2b20 7374 7228 7265 6c61    "'" + str(rela
+00050d20: 7469 6f6e 7368 6970 2e73 7461 7274 5f64  tionship.start_d
+00050d30: 6174 6529 202b 2022 2722 2c20 7365 6c66  ate) + "'", self
+00050d40: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
+00050d50: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
+00050d60: 5f76 616c 7565 2829 5d0d 0a20 2020 2020  _value()]..     
+00050d70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00050d80: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+00050d90: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
+00050da0: 7265 6c61 7469 6f6e 7368 6970 7328 5b6f  relationships([o
+00050db0: 6c64 5f72 656c 6174 696f 6e73 6869 705d  ld_relationship]
+00050dc0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00050dd0: 662e 6c6f 672e 6c6f 6728 7365 6c66 2e65  f.log.log(self.e
+00050de0: 6e67 696e 655f 6e61 6d65 2c20 2246 696e  ngine_name, "Fin
+00050df0: 6973 6865 6420 746f 2070 726f 6365 7373  ished to process
+00050e00: 204d 6574 6164 6174 6120 5b20 5265 6c61   Metadata [ Rela
+00050e10: 7469 6f6e 7368 6970 205d 2069 6e66 6f72  tionship ] infor
+00050e20: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
+00050e30: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
+00050e40: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
+00050e50: 656c 745f 6167 6772 6567 6174 6f72 2873  elt_aggregator(s
+00050e60: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+00050e70: 656c 662e 6c6f 672e 6c6f 6728 7365 6c66  elf.log.log(self
+00050e80: 2e65 6e67 696e 655f 6e61 6d65 2c20 2253  .engine_name, "S
+00050e90: 7461 7274 696e 6720 746f 2070 726f 6365  tarting to proce
+00050ea0: 7373 204d 6574 6164 6174 6120 5b20 4167  ss Metadata [ Ag
+00050eb0: 6772 6567 6174 6f72 205d 2069 6e66 6f72  gregator ] infor
+00050ec0: 6d61 7469 6f6e 222c 204c 4f47 5f4c 4556  mation", LOG_LEV
+00050ed0: 454c 5f4f 4e4c 595f 4c4f 4729 0d0a 0d0a  EL_ONLY_LOG)....
+00050ee0: 2020 2020 2020 2020 6e65 7874 5f69 645f          next_id_
+00050ef0: 6167 6720 3d20 7365 6c66 2e6e 6578 745f  agg = self.next_
+00050f00: 6964 5f61 6767 0d0a 2020 2020 2020 2020  id_agg..        
+00050f10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00050f20: 2323 2323 2323 2323 204c 4f41 4420 4147  ######## LOAD AG
+00050f30: 4752 4547 4154 4f52 2023 2323 2323 2323  GREGATOR #######
+00050f40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00050f50: 230d 0a20 2020 2020 2020 2023 2049 6e70  #..        # Inp
+00050f60: 7574 204f 7264 6572 730d 0a20 2020 2020  ut Orders..     
+00050f70: 2020 2061 6767 5f6c 6f61 6465 6420 3d20     agg_loaded = 
+00050f80: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
+00050f90: 6167 6720 696e 2073 656c 662e 6d65 7461  agg in self.meta
+00050fa0: 6461 7461 5f61 6374 7561 6c2e 656e 7472  data_actual.entr
+00050fb0: 795f 6167 6772 6567 6174 6f72 733a 0d0a  y_aggregators:..
+00050fc0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00050fd0: 7365 7420 3d20 7365 6c66 2e6d 6574 6164  set = self.metad
+00050fe0: 6174 615f 746f 5f6c 6f61 642e 6765 745f  ata_to_load.get_
+00050ff0: 6461 7461 7365 745f 6672 6f6d 5f64 6174  dataset_from_dat
+00051000: 6173 6574 5f6e 616d 6528 7365 6c66 2e6d  aset_name(self.m
+00051010: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+00051020: 6574 5f74 6162 6c65 5f6e 616d 655f 6672  et_table_name_fr
+00051030: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6f6e  om_cod_entity_on
+00051040: 5f65 6e74 7279 2861 6767 2e63 6f64 5f65  _entry(agg.cod_e
+00051050: 6e74 6974 795f 7461 7267 6574 2929 0d0a  ntity_target))..
+00051060: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00051070: 7365 745f 7372 6320 3d20 7365 6c66 2e6d  set_src = self.m
+00051080: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
+00051090: 6765 745f 6461 7461 7365 745f 6672 6f6d  get_dataset_from
+000510a0: 5f64 6174 6173 6574 5f6e 616d 6528 7365  _dataset_name(se
+000510b0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+000510c0: 616c 2e67 6574 5f74 6162 6c65 5f6e 616d  al.get_table_nam
+000510d0: 655f 6672 6f6d 5f63 6f64 5f65 6e74 6974  e_from_cod_entit
+000510e0: 795f 6f6e 5f65 6e74 7279 2861 6767 2e63  y_on_entry(agg.c
+000510f0: 6f64 5f65 6e74 6974 795f 7372 6329 290d  od_entity_src)).
+00051100: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00051110: 6173 6574 5f73 7065 6320 3d20 7365 6c66  aset_spec = self
+00051120: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
+00051130: 642e 6765 745f 6461 7461 7365 745f 7370  d.get_dataset_sp
+00051140: 6563 5f66 726f 6d5f 6964 5f64 6174 6173  ec_from_id_datas
+00051150: 6574 5f61 6e64 5f63 6f6c 756d 6e5f 6e61  et_and_column_na
+00051160: 6d65 2864 6174 6173 6574 5f73 7263 2e69  me(dataset_src.i
+00051170: 645f 6461 7461 7365 742c 2061 6767 2e63  d_dataset, agg.c
+00051180: 6f6c 756d 6e5f 6e61 6d65 290d 0a20 2020  olumn_name)..   
+00051190: 2020 2020 2020 2020 2061 6767 5f65 7869           agg_exi
+000511a0: 7374 656e 7420 3d20 7365 6c66 2e6d 6574  stent = self.met
+000511b0: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+000511c0: 5f61 6767 7265 6761 746f 725f 6672 6f6d  _aggregator_from
+000511d0: 5f69 645f 6461 7461 7365 745f 616e 645f  _id_dataset_and_
+000511e0: 6964 5f64 6174 6173 6574 5f73 7065 635f  id_dataset_spec_
+000511f0: 616e 645f 6964 5f62 7261 6e63 6828 0d0a  and_id_branch(..
+00051200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051210: 6461 7461 7365 742e 6964 5f64 6174 6173  dataset.id_datas
+00051220: 6574 2c20 6461 7461 7365 745f 7370 6563  et, dataset_spec
+00051230: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
+00051240: 2c20 6167 672e 6e75 6d5f 6272 616e 6368  , agg.num_branch
+00051250: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00051260: 2069 6620 6167 675f 6578 6973 7465 6e74   if agg_existent
+00051270: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00051280: 2020 2020 2020 2020 2020 2069 645f 745f             id_t_
+00051290: 6167 6720 3d20 6e65 7874 5f69 645f 6167  agg = next_id_ag
+000512a0: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
+000512b0: 2020 206e 6578 745f 6964 5f61 6767 202b     next_id_agg +
+000512c0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+000512d0: 2020 2020 206e 6577 5f61 6767 203d 205b       new_agg = [
+000512e0: 6964 5f74 5f61 6767 2c20 6461 7461 7365  id_t_agg, datase
+000512f0: 742e 6964 5f64 6174 6173 6574 2c20 6167  t.id_dataset, ag
+00051300: 672e 6e75 6d5f 6272 616e 6368 2c20 6461  g.num_branch, da
+00051310: 7461 7365 745f 7370 6563 2e69 645f 6461  taset_spec.id_da
+00051320: 7461 7365 745f 7370 6563 2c20 7365 6c66  taset_spec, self
+00051330: 2e6f 776e 6572 2c0d 0a20 2020 2020 2020  .owner,..       
+00051340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051350: 2020 2020 7365 6c66 2e63 6f6e 6e65 6374      self.connect
+00051360: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
+00051370: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
+00051380: 2c20 224e 554c 4c22 5d0d 0a20 2020 2020  , "NULL"]..     
+00051390: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000513a0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+000513b0: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
+000513c0: 745f 6167 6728 5b6e 6577 5f61 6767 5d29  t_agg([new_agg])
+000513d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000513e0: 2020 6167 675f 6c6f 6164 6564 2e61 7070    agg_loaded.app
+000513f0: 656e 6428 5b64 6174 6173 6574 2e69 645f  end([dataset.id_
+00051400: 6461 7461 7365 742c 2061 6767 2e6e 756d  dataset, agg.num
+00051410: 5f62 7261 6e63 682c 2064 6174 6173 6574  _branch, dataset
+00051420: 5f73 7065 632e 6964 5f64 6174 6173 6574  _spec.id_dataset
+00051430: 5f73 7065 635d 290d 0a20 2020 2020 2020  _spec])..       
+00051440: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00051450: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00051460: 6167 6720 3d20 5b61 6767 5f65 7869 7374  agg = [agg_exist
+00051470: 656e 742e 6964 5f74 5f61 6767 2c20 6167  ent.id_t_agg, ag
+00051480: 675f 6578 6973 7465 6e74 2e69 645f 6461  g_existent.id_da
+00051490: 7461 7365 742c 2061 6767 5f65 7869 7374  taset, agg_exist
+000514a0: 656e 742e 6964 5f62 7261 6e63 682c 0d0a  ent.id_branch,..
+000514b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000514c0: 2020 2020 2020 2020 2020 2061 6767 5f65             agg_e
+000514d0: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
+000514e0: 6574 5f73 7065 632c 0d0a 2020 2020 2020  et_spec,..      
+000514f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051500: 2020 2020 2061 6767 5f65 7869 7374 656e       agg_existen
+00051510: 742e 6d65 7461 5f6f 776e 6572 2c20 2227  t.meta_owner, "'
+00051520: 2220 2b20 7374 7228 6167 675f 6578 6973  " + str(agg_exis
+00051530: 7465 6e74 2e73 7461 7274 5f64 6174 6529  tent.start_date)
+00051540: 202b 2022 2722 2c20 224e 554c 4c22 5d0d   + "'", "NULL"].
+00051550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051560: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
+00051570: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
+00051580: 7461 7365 745f 745f 6167 6728 5b6e 6577  taset_t_agg([new
+00051590: 5f61 6767 5d29 0d0a 2020 2020 2020 2020  _agg])..        
+000515a0: 2020 2020 2020 2020 6167 675f 6c6f 6164          agg_load
+000515b0: 6564 2e61 7070 656e 6428 5b61 6767 5f65  ed.append([agg_e
+000515c0: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
+000515d0: 6574 2c20 6167 675f 6578 6973 7465 6e74  et, agg_existent
+000515e0: 2e69 645f 6272 616e 6368 2c20 6167 675f  .id_branch, agg_
+000515f0: 6578 6973 7465 6e74 2e69 645f 6461 7461  existent.id_data
+00051600: 7365 745f 7370 6563 5d29 0d0a 0d0a 2020  set_spec])....  
+00051610: 2020 2020 2020 666f 7220 6167 6720 696e        for agg in
+00051620: 205b 7820 666f 7220 7820 696e 2073 656c   [x for x in sel
+00051630: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+00051640: 6c2e 6f6d 5f64 6174 6173 6574 5f74 5f61  l.om_dataset_t_a
+00051650: 6767 2069 6620 782e 656e 645f 6461 7465  gg if x.end_date
+00051660: 2069 7320 4e6f 6e65 5d3a 0d0a 2020 2020   is None]:..    
+00051670: 2020 2020 2020 2020 6966 205b 6167 672e          if [agg.
+00051680: 6964 5f64 6174 6173 6574 2c20 6167 672e  id_dataset, agg.
+00051690: 6964 5f62 7261 6e63 682c 2061 6767 2e69  id_branch, agg.i
+000516a0: 645f 6461 7461 7365 745f 7370 6563 5d20  d_dataset_spec] 
+000516b0: 6e6f 7420 696e 2061 6767 5f6c 6f61 6465  not in agg_loade
+000516c0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+000516d0: 2020 2020 6e65 775f 6167 6720 3d20 5b61      new_agg = [a
+000516e0: 6767 2e69 645f 745f 6167 672c 2061 6767  gg.id_t_agg, agg
+000516f0: 2e69 645f 6461 7461 7365 742c 2061 6767  .id_dataset, agg
+00051700: 2e69 645f 6272 616e 6368 2c0d 0a20 2020  .id_branch,..   
 00051710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051720: 6469 7374 696e 6374 5f6c 6f61 6465 642e  distinct_loaded.
-00051730: 6170 7065 6e64 285b 6469 7374 696e 6374  append([distinct
-00051740: 5f65 7869 7374 656e 742e 6964 5f64 6174  _existent.id_dat
-00051750: 6173 6574 2c20 6469 7374 696e 6374 5f65  aset, distinct_e
-00051760: 7869 7374 656e 742e 6964 5f62 7261 6e63  xistent.id_branc
-00051770: 685d 290d 0a20 2020 2020 2020 2020 2020  h])..           
-00051780: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00051790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000517a0: 6578 6973 7465 6e74 5f64 6973 7469 6e63  existent_distinc
-000517b0: 7420 3d20 5b64 6973 7469 6e63 745f 6578  t = [distinct_ex
-000517c0: 6973 7465 6e74 2e69 645f 745f 6469 7374  istent.id_t_dist
-000517d0: 696e 6374 2c20 6469 7374 696e 6374 5f65  inct, distinct_e
-000517e0: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
-000517f0: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
-00051800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051810: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00051820: 7374 696e 6374 5f65 7869 7374 656e 742e  stinct_existent.
-00051830: 6964 5f62 7261 6e63 682c 2064 6973 7469  id_branch, disti
-00051840: 6e63 745f 6578 6973 7465 6e74 2e73 775f  nct_existent.sw_
-00051850: 6469 7374 696e 6374 2c0d 0a20 2020 2020  distinct,..     
-00051860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051880: 2020 2020 6469 7374 696e 6374 5f65 7869      distinct_exi
-00051890: 7374 656e 742e 6d65 7461 5f6f 776e 6572  stent.meta_owner
-000518a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000518b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000518c0: 2020 2020 2020 2020 2020 2020 2227 2220              "'" 
-000518d0: 2b20 7374 7228 6469 7374 696e 6374 5f65  + str(distinct_e
-000518e0: 7869 7374 656e 742e 7374 6172 745f 6461  xistent.start_da
-000518f0: 7465 2920 2b20 2227 222c 0d0a 2020 2020  te) + "'",..    
-00051900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051920: 2020 2020 2073 656c 662e 636f 6e6e 6563       self.connec
-00051930: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
-00051940: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
-00051950: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-00051960: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-00051970: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
-00051980: 645f 6f6d 5f64 6174 6173 6574 5f74 5f64  d_om_dataset_t_d
-00051990: 6973 7469 6e63 7428 5b65 7869 7374 656e  istinct([existen
-000519a0: 745f 6469 7374 696e 6374 5d29 0d0a 2020  t_distinct])..  
-000519b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000519c0: 2020 6469 7374 696e 6374 5f6c 6f61 6465    distinct_loade
-000519d0: 642e 6170 7065 6e64 285b 6469 7374 696e  d.append([distin
-000519e0: 6374 5f65 7869 7374 656e 742e 6964 5f64  ct_existent.id_d
-000519f0: 6174 6173 6574 2c20 6469 7374 696e 6374  ataset, distinct
-00051a00: 5f65 7869 7374 656e 742e 6964 5f62 7261  _existent.id_bra
-00051a10: 6e63 685d 290d 0a0d 0a20 2020 2020 2020  nch])....       
-00051a20: 2020 2020 2020 2020 2020 2020 2069 645f               id_
-00051a30: 745f 6469 7374 696e 6374 203d 206e 6578  t_distinct = nex
-00051a40: 745f 6964 5f74 5f64 6973 7469 6e63 740d  t_id_t_distinct.
-00051a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051a60: 2020 2020 206e 6578 745f 6964 5f74 5f64       next_id_t_d
-00051a70: 6973 7469 6e63 7420 2b3d 2031 0d0a 2020  istinct += 1..  
-00051a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051a90: 2020 6e65 775f 6469 7374 696e 6374 203d    new_distinct =
-00051aa0: 205b 6964 5f74 5f64 6973 7469 6e63 742c   [id_t_distinct,
-00051ab0: 2064 6174 6173 6574 2e69 645f 6461 7461   dataset.id_data
-00051ac0: 7365 742c 2069 645f 6272 616e 6368 2c20  set, id_branch, 
-00051ad0: 7377 5f64 6973 7469 6e63 742c 2073 656c  sw_distinct, sel
-00051ae0: 662e 6f77 6e65 722c 0d0a 2020 2020 2020  f.owner,..      
-00051af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051b00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00051b10: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
-00051b20: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
-00051b30: 7465 5f76 616c 7565 2829 2c20 224e 554c  te_value(), "NUL
-00051b40: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
-00051b50: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00051b60: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-00051b70: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
-00051b80: 6469 7374 696e 6374 285b 6e65 775f 6469  distinct([new_di
-00051b90: 7374 696e 6374 5d29 0d0a 2020 2020 2020  stinct])..      
-00051ba0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00051bb0: 7374 696e 6374 5f6c 6f61 6465 642e 6170  stinct_loaded.ap
-00051bc0: 7065 6e64 285b 6461 7461 7365 742e 6964  pend([dataset.id
-00051bd0: 5f64 6174 6173 6574 2c20 6964 5f62 7261  _dataset, id_bra
-00051be0: 6e63 685d 290d 0a0d 0a20 2020 2020 2020  nch])....       
-00051bf0: 2066 6f72 2064 6973 7469 6e63 7420 696e   for distinct in
-00051c00: 205b 7820 666f 7220 7820 696e 2073 656c   [x for x in sel
-00051c10: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
-00051c20: 6c2e 6f6d 5f64 6174 6173 6574 5f74 5f64  l.om_dataset_t_d
-00051c30: 6973 7469 6e63 7420 6966 2078 2e65 6e64  istinct if x.end
-00051c40: 5f64 6174 6520 6973 204e 6f6e 655d 3a0d  _date is None]:.
-00051c50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00051c60: 5b64 6973 7469 6e63 742e 6964 5f64 6174  [distinct.id_dat
-00051c70: 6173 6574 2c20 6469 7374 696e 6374 2e69  aset, distinct.i
-00051c80: 645f 6272 616e 6368 5d20 6e6f 7420 696e  d_branch] not in
-00051c90: 2064 6973 7469 6e63 745f 6c6f 6164 6564   distinct_loaded
-00051ca0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00051cb0: 2020 2063 6c6f 7365 5f64 6973 7469 6e63     close_distinc
-00051cc0: 7420 3d20 5b64 6973 7469 6e63 742e 6964  t = [distinct.id
-00051cd0: 5f74 5f64 6973 7469 6e63 742c 2064 6973  _t_distinct, dis
-00051ce0: 7469 6e63 742e 6964 5f64 6174 6173 6574  tinct.id_dataset
-00051cf0: 2c20 6469 7374 696e 6374 2e69 645f 6272  , distinct.id_br
-00051d00: 616e 6368 2c20 6469 7374 696e 6374 2e73  anch, distinct.s
-00051d10: 775f 6469 7374 696e 6374 0d0a 2020 2020  w_distinct..    
-00051d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051d30: 2c20 6469 7374 696e 6374 2e6d 6574 615f  , distinct.meta_
-00051d40: 6f77 6e65 722c 2022 2722 202b 2073 7472  owner, "'" + str
-00051d50: 2864 6973 7469 6e63 742e 7374 6172 745f  (distinct.start_
-00051d60: 6461 7465 2920 2b20 2227 222c 2073 656c  date) + "'", sel
-00051d70: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
-00051d80: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
-00051d90: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
-00051da0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00051db0: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
-00051dc0: 642e 6164 645f 6f6d 5f64 6174 6173 6574  d.add_om_dataset
-00051dd0: 5f74 5f64 6973 7469 6e63 7428 5b63 6c6f  _t_distinct([clo
-00051de0: 7365 5f64 6973 7469 6e63 745d 290d 0a0d  se_distinct])...
-00051df0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00051e00: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
-00051e10: 655f 6e61 6d65 2c20 2246 696e 6973 6865  e_name, "Finishe
-00051e20: 6420 746f 2070 726f 6365 7373 204d 6574  d to process Met
-00051e30: 6164 6174 6120 5b20 4469 7374 696e 6374  adata [ Distinct
-00051e40: 205d 2069 6e66 6f72 6d61 7469 6f6e 222c   ] information",
-00051e50: 204c 4f47 5f4c 4556 454c 5f4f 4e4c 595f   LOG_LEVEL_ONLY_
-00051e60: 4c4f 4729 0d0a 0d0a 2020 2020 6465 6620  LOG)....    def 
-00051e70: 7072 6f63 6573 735f 656c 745f 6d61 7070  process_elt_mapp
-00051e80: 696e 6728 7365 6c66 293a 0d0a 2020 2020  ing(self):..    
-00051e90: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
-00051ea0: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
-00051eb0: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
-00051ec0: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
-00051ed0: 205b 204d 6170 7069 6e67 205d 2069 6e66   [ Mapping ] inf
-00051ee0: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
-00051ef0: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
-00051f00: 2020 2020 2020 2020 2323 2323 2323 2323          ########
-00051f10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00051f20: 204c 4f41 4420 4d41 5050 494e 4720 2323   LOAD MAPPING ##
-00051f30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00051f40: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00051f50: 6e65 7874 5f69 645f 745f 6d61 7070 696e  next_id_t_mappin
-00051f60: 6720 3d20 7365 6c66 2e6e 6578 745f 6964  g = self.next_id
-00051f70: 5f74 5f6d 6170 7069 6e67 0d0a 0d0a 2020  _t_mapping....  
-00051f80: 2020 2020 2020 6d61 7070 696e 675f 6c6f        mapping_lo
-00051f90: 6164 6564 203d 205b 5d0d 0a20 2020 2020  aded = []..     
-00051fa0: 2020 2066 6f72 206d 6170 7069 6e67 2069     for mapping i
-00051fb0: 6e20 7365 6c66 2e6d 6574 6164 6174 615f  n self.metadata_
-00051fc0: 6163 7475 616c 2e65 6e74 7279 5f64 6174  actual.entry_dat
-00051fd0: 6173 6574 5f6d 6170 7069 6e67 733a 0d0a  aset_mappings:..
-00051fe0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00051ff0: 7365 7420 3d20 7365 6c66 2e6d 6574 6164  set = self.metad
-00052000: 6174 615f 746f 5f6c 6f61 642e 6765 745f  ata_to_load.get_
-00052010: 6461 7461 7365 745f 6672 6f6d 5f64 6174  dataset_from_dat
-00052020: 6173 6574 5f6e 616d 6528 7365 6c66 2e6d  aset_name(self.m
-00052030: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-00052040: 6574 5f74 6162 6c65 5f6e 616d 655f 6672  et_table_name_fr
-00052050: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6f6e  om_cod_entity_on
-00052060: 5f65 6e74 7279 286d 6170 7069 6e67 2e63  _entry(mapping.c
-00052070: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
-00052080: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00052090: 6461 7461 7365 745f 7370 6563 203d 2073  dataset_spec = s
-000520a0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-000520b0: 6c6f 6164 2e67 6574 5f64 6174 6173 6574  load.get_dataset
-000520c0: 5f73 7065 635f 6672 6f6d 5f69 645f 6461  _spec_from_id_da
-000520d0: 7461 7365 745f 616e 645f 636f 6c75 6d6e  taset_and_column
-000520e0: 5f6e 616d 6528 6461 7461 7365 742e 6964  _name(dataset.id
-000520f0: 5f64 6174 6173 6574 2c0d 0a20 2020 2020  _dataset,..     
+00051720: 2020 2020 2020 2020 6167 672e 6964 5f64          agg.id_d
+00051730: 6174 6173 6574 5f73 7065 632c 0d0a 2020  ataset_spec,..  
+00051740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051750: 2020 2020 2020 2020 2061 6767 2e6d 6574           agg.met
+00051760: 615f 6f77 6e65 722c 2022 2722 202b 2073  a_owner, "'" + s
+00051770: 7472 2861 6767 2e73 7461 7274 5f64 6174  tr(agg.start_dat
+00051780: 6529 202b 2022 2722 2c20 7365 6c66 2e63  e) + "'", self.c
+00051790: 6f6e 6e65 6374 696f 6e5f 6d65 7461 6461  onnection_metada
+000517a0: 7461 2e67 6574 5f73 7973 6461 7465 5f76  ta.get_sysdate_v
+000517b0: 616c 7565 2829 5d0d 0a20 2020 2020 2020  alue()]..       
+000517c0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+000517d0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+000517e0: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
+000517f0: 6167 6728 5b6e 6577 5f61 6767 5d29 0d0a  agg([new_agg])..
+00051800: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00051810: 6f67 2e6c 6f67 2873 656c 662e 656e 6769  og.log(self.engi
+00051820: 6e65 5f6e 616d 652c 2022 4669 6e69 7368  ne_name, "Finish
+00051830: 6564 2074 6f20 7072 6f63 6573 7320 4d65  ed to process Me
+00051840: 7461 6461 7461 205b 2041 6767 7265 6761  tadata [ Aggrega
+00051850: 746f 7220 5d20 696e 666f 726d 6174 696f  tor ] informatio
+00051860: 6e22 2c20 4c4f 475f 4c45 5645 4c5f 4f4e  n", LOG_LEVEL_ON
+00051870: 4c59 5f4c 4f47 290d 0a0d 0a20 2020 2064  LY_LOG)....    d
+00051880: 6566 2070 726f 6365 7373 5f65 6c74 5f64  ef process_elt_d
+00051890: 6973 7469 6e63 7428 7365 6c66 293a 0d0a  istinct(self):..
+000518a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+000518b0: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
+000518c0: 5f6e 616d 652c 2022 5374 6172 7469 6e67  _name, "Starting
+000518d0: 2074 6f20 7072 6f63 6573 7320 4d65 7461   to process Meta
+000518e0: 6461 7461 205b 2044 6973 7469 6e63 7420  data [ Distinct 
+000518f0: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+00051900: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+00051910: 4f47 290d 0a20 2020 2020 2020 2023 2323  OG)..        ###
+00051920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00051930: 2323 2323 2320 4c4f 4144 2044 4953 5449  ##### LOAD DISTI
+00051940: 4e43 5420 2323 2323 2323 2323 2323 2323  NCT ############
+00051950: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
+00051960: 2020 2020 2020 2320 496e 7075 7420 6469        # Input di
+00051970: 7374 696e 6374 0d0a 2020 2020 2020 2020  stinct..        
+00051980: 6e65 7874 5f69 645f 745f 6469 7374 696e  next_id_t_distin
+00051990: 6374 203d 2073 656c 662e 6e65 7874 5f69  ct = self.next_i
+000519a0: 645f 745f 6469 7374 696e 6374 0d0a 2020  d_t_distinct..  
+000519b0: 2020 2020 2020 6469 7374 696e 6374 5f6c        distinct_l
+000519c0: 6f61 6465 6420 3d20 5b5d 0d0a 2020 2020  oaded = []..    
+000519d0: 2020 2020 666f 7220 6d61 7070 696e 6720      for mapping 
+000519e0: 696e 2073 656c 662e 6d65 7461 6461 7461  in self.metadata
+000519f0: 5f61 6374 7561 6c2e 656e 7472 795f 6461  _actual.entry_da
+00051a00: 7461 7365 745f 6d61 7070 696e 6773 3a0d  taset_mappings:.
+00051a10: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00051a20: 6173 6574 203d 2073 656c 662e 6d65 7461  aset = self.meta
+00051a30: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
+00051a40: 5f64 6174 6173 6574 5f66 726f 6d5f 6461  _dataset_from_da
+00051a50: 7461 7365 745f 6e61 6d65 2873 656c 662e  taset_name(self.
+00051a60: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00051a70: 6765 745f 7461 626c 655f 6e61 6d65 5f66  get_table_name_f
+00051a80: 726f 6d5f 636f 645f 656e 7469 7479 5f6f  rom_cod_entity_o
+00051a90: 6e5f 656e 7472 7928 6d61 7070 696e 672e  n_entry(mapping.
+00051aa0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+00051ab0: 7429 290d 0a20 2020 2020 2020 2020 2020  t))..           
+00051ac0: 2069 645f 6272 616e 6368 203d 206d 6170   id_branch = map
+00051ad0: 7069 6e67 2e6e 756d 5f62 7261 6e63 680d  ping.num_branch.
+00051ae0: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+00051af0: 7469 6e63 745f 6578 6973 7465 6e74 203d  tinct_existent =
+00051b00: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00051b10: 6374 7561 6c2e 6765 745f 6469 7374 696e  ctual.get_distin
+00051b20: 6374 5f66 726f 6d5f 6964 5f64 6174 6173  ct_from_id_datas
+00051b30: 6574 5f61 6e64 5f62 7261 6e63 6828 6461  et_and_branch(da
+00051b40: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
+00051b50: 2c20 6964 5f62 7261 6e63 6829 0d0a 2020  , id_branch)..  
+00051b60: 2020 2020 2020 2020 2020 7377 5f64 6973            sw_dis
+00051b70: 7469 6e63 7420 3d20 6d61 7070 696e 672e  tinct = mapping.
+00051b80: 7377 5f64 6973 7469 6e63 740d 0a20 2020  sw_distinct..   
+00051b90: 2020 2020 2020 2020 2069 6620 5b64 6174           if [dat
+00051ba0: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
+00051bb0: 2069 645f 6272 616e 6368 5d20 696e 2064   id_branch] in d
+00051bc0: 6973 7469 6e63 745f 6c6f 6164 6564 3a20  istinct_loaded: 
+00051bd0: 636f 6e74 696e 7565 0d0a 0d0a 2020 2020  continue....    
+00051be0: 2020 2020 2020 2020 6966 2064 6973 7469          if disti
+00051bf0: 6e63 745f 6578 6973 7465 6e74 2069 7320  nct_existent is 
+00051c00: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00051c10: 2020 2020 2020 2069 645f 745f 6469 7374         id_t_dist
+00051c20: 696e 6374 203d 206e 6578 745f 6964 5f74  inct = next_id_t
+00051c30: 5f64 6973 7469 6e63 740d 0a20 2020 2020  _distinct..     
+00051c40: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+00051c50: 6964 5f74 5f64 6973 7469 6e63 7420 2b3d  id_t_distinct +=
+00051c60: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00051c70: 2020 2020 6e65 775f 6469 7374 696e 6374      new_distinct
+00051c80: 203d 205b 6964 5f74 5f64 6973 7469 6e63   = [id_t_distinc
+00051c90: 742c 2064 6174 6173 6574 2e69 645f 6461  t, dataset.id_da
+00051ca0: 7461 7365 742c 2069 645f 6272 616e 6368  taset, id_branch
+00051cb0: 2c20 7377 5f64 6973 7469 6e63 742c 2073  , sw_distinct, s
+00051cc0: 656c 662e 6f77 6e65 722c 0d0a 2020 2020  elf.owner,..    
+00051cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051ce0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00051cf0: 2e63 6f6e 6e65 6374 696f 6e5f 6d65 7461  .connection_meta
+00051d00: 6461 7461 2e67 6574 5f73 7973 6461 7465  data.get_sysdate
+00051d10: 5f76 616c 7565 2829 2c20 224e 554c 4c22  _value(), "NULL"
+00051d20: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00051d30: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00051d40: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+00051d50: 6461 7461 7365 745f 745f 6469 7374 696e  dataset_t_distin
+00051d60: 6374 285b 6e65 775f 6469 7374 696e 6374  ct([new_distinct
+00051d70: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00051d80: 2020 2020 6469 7374 696e 6374 5f6c 6f61      distinct_loa
+00051d90: 6465 642e 6170 7065 6e64 285b 6461 7461  ded.append([data
+00051da0: 7365 742e 6964 5f64 6174 6173 6574 2c20  set.id_dataset, 
+00051db0: 6964 5f62 7261 6e63 685d 290d 0a0d 0a20  id_branch]).... 
+00051dc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00051dd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051de0: 2020 6966 2073 775f 6469 7374 696e 6374    if sw_distinct
+00051df0: 203d 3d20 6469 7374 696e 6374 5f65 7869   == distinct_exi
+00051e00: 7374 656e 742e 7377 5f64 6973 7469 6e63  stent.sw_distinc
+00051e10: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00051e20: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
+00051e30: 5f64 6973 7469 6e63 7420 3d20 5b64 6973  _distinct = [dis
+00051e40: 7469 6e63 745f 6578 6973 7465 6e74 2e69  tinct_existent.i
+00051e50: 645f 745f 6469 7374 696e 6374 2c20 6469  d_t_distinct, di
+00051e60: 7374 696e 6374 5f65 7869 7374 656e 742e  stinct_existent.
+00051e70: 6964 5f64 6174 6173 6574 2c0d 0a20 2020  id_dataset,..   
+00051e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051ea0: 2020 2020 2020 6469 7374 696e 6374 5f65        distinct_e
+00051eb0: 7869 7374 656e 742e 6964 5f62 7261 6e63  xistent.id_branc
+00051ec0: 682c 2064 6973 7469 6e63 745f 6578 6973  h, distinct_exis
+00051ed0: 7465 6e74 2e73 775f 6469 7374 696e 6374  tent.sw_distinct
+00051ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051ef0: 2020 2020 2020 2020 2020 2c20 6469 7374            , dist
+00051f00: 696e 6374 5f65 7869 7374 656e 742e 6d65  inct_existent.me
+00051f10: 7461 5f6f 776e 6572 2c20 2227 2220 2b20  ta_owner, "'" + 
+00051f20: 7374 7228 6469 7374 696e 6374 5f65 7869  str(distinct_exi
+00051f30: 7374 656e 742e 7374 6172 745f 6461 7465  stent.start_date
+00051f40: 2920 2b20 2227 222c 2022 4e55 4c4c 225d  ) + "'", "NULL"]
+00051f50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051f60: 2020 2020 2020 7365 6c66 2e6d 6574 6164        self.metad
+00051f70: 6174 615f 746f 5f6c 6f61 642e 6164 645f  ata_to_load.add_
+00051f80: 6f6d 5f64 6174 6173 6574 5f74 5f64 6973  om_dataset_t_dis
+00051f90: 7469 6e63 7428 5b65 7869 7374 656e 745f  tinct([existent_
+00051fa0: 6469 7374 696e 6374 5d29 0d0a 2020 2020  distinct])..    
+00051fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051fc0: 6469 7374 696e 6374 5f6c 6f61 6465 642e  distinct_loaded.
+00051fd0: 6170 7065 6e64 285b 6469 7374 696e 6374  append([distinct
+00051fe0: 5f65 7869 7374 656e 742e 6964 5f64 6174  _existent.id_dat
+00051ff0: 6173 6574 2c20 6469 7374 696e 6374 5f65  aset, distinct_e
+00052000: 7869 7374 656e 742e 6964 5f62 7261 6e63  xistent.id_branc
+00052010: 685d 290d 0a20 2020 2020 2020 2020 2020  h])..           
+00052020: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00052030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052040: 6578 6973 7465 6e74 5f64 6973 7469 6e63  existent_distinc
+00052050: 7420 3d20 5b64 6973 7469 6e63 745f 6578  t = [distinct_ex
+00052060: 6973 7465 6e74 2e69 645f 745f 6469 7374  istent.id_t_dist
+00052070: 696e 6374 2c20 6469 7374 696e 6374 5f65  inct, distinct_e
+00052080: 7869 7374 656e 742e 6964 5f64 6174 6173  xistent.id_datas
+00052090: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
+000520a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000520b0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+000520c0: 7374 696e 6374 5f65 7869 7374 656e 742e  stinct_existent.
+000520d0: 6964 5f62 7261 6e63 682c 2064 6973 7469  id_branch, disti
+000520e0: 6e63 745f 6578 6973 7465 6e74 2e73 775f  nct_existent.sw_
+000520f0: 6469 7374 696e 6374 2c0d 0a20 2020 2020  distinct,..     
 00052100: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00052110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052150: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00052160: 7069 6e67 2e63 6f6c 756d 6e5f 6e61 6d65  ping.column_name
-00052170: 5f74 6172 6765 7429 0d0a 2020 2020 2020  _target)..      
-00052180: 2020 2020 2020 6964 5f62 7261 6e63 6820        id_branch 
-00052190: 3d20 6d61 7070 696e 672e 6e75 6d5f 6272  = mapping.num_br
-000521a0: 616e 6368 0d0a 2020 2020 2020 2020 2020  anch..          
-000521b0: 2020 7661 6c75 655f 6d61 7070 696e 6720    value_mapping 
-000521c0: 3d20 6d61 7070 696e 672e 7661 6c75 655f  = mapping.value_
-000521d0: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
-000521e0: 2020 2020 6461 7461 7365 745f 736f 7572      dataset_sour
-000521f0: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
-00052200: 7461 5f74 6f5f 6c6f 6164 2e67 6574 5f64  ta_to_load.get_d
-00052210: 6174 6173 6574 5f66 726f 6d5f 6461 7461  ataset_from_data
-00052220: 7365 745f 6e61 6d65 280d 0a20 2020 2020  set_name(..     
-00052230: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00052240: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00052250: 6765 745f 7461 626c 655f 6e61 6d65 5f66  get_table_name_f
-00052260: 726f 6d5f 636f 645f 656e 7469 7479 5f6f  rom_cod_entity_o
-00052270: 6e5f 656e 7472 7928 6d61 7070 696e 672e  n_entry(mapping.
-00052280: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
-00052290: 6529 290d 0a0d 0a20 2020 2020 2020 2020  e))....         
-000522a0: 2020 2023 2054 4f44 4f3a 2053 6561 7263     # TODO: Searc
-000522b0: 6820 736f 7572 6365 2074 6162 6c65 7320  h source tables 
-000522c0: 6672 6f6d 2045 4e54 5259 5f44 4154 4153  from ENTRY_DATAS
-000522d0: 4554 5f4d 4150 5049 4e47 5320 746f 2062  ET_MAPPINGS to b
-000522e0: 6520 6162 6c65 2074 6f20 6163 6365 7074  e able to accept
-000522f0: 2064 6966 6665 7265 6e74 2063 6f6c 756d   different colum
-00052300: 6e73 2066 726f 6d20 6469 6665 7265 6e74  ns from diferent
-00052310: 2074 6162 6c65 7320 6f6e 206f 6e6c 7920   tables on only 
-00052320: 6f6e 6520 6d61 7070 696e 672e 0d0a 2020  one mapping...  
-00052330: 2020 2020 2020 2020 2020 616c 6c5f 636f            all_co
-00052340: 6c75 6d6e 735f 6672 6f6d 5f73 6f75 7263  lumns_from_sourc
-00052350: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-00052360: 615f 746f 5f6c 6f61 642e 6765 745f 616c  a_to_load.get_al
-00052370: 6c5f 636f 6c75 6d6e 735f 6672 6f6d 5f74  l_columns_from_t
-00052380: 6162 6c65 5f6e 616d 6528 0d0a 2020 2020  able_name(..    
-00052390: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000523a0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-000523b0: 2e67 6574 5f74 6162 6c65 5f6e 616d 655f  .get_table_name_
-000523c0: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-000523d0: 6f6e 5f65 6e74 7279 286d 6170 7069 6e67  on_entry(mapping
-000523e0: 2e63 6f64 5f65 6e74 6974 795f 736f 7572  .cod_entity_sour
-000523f0: 6365 2929 0d0a 2020 2020 2020 2020 2020  ce))..          
-00052400: 2020 666f 7220 636f 6c20 696e 2061 6c6c    for col in all
-00052410: 5f63 6f6c 756d 6e73 5f66 726f 6d5f 736f  _columns_from_so
-00052420: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
-00052430: 2020 2020 2020 2069 6620 7265 2e73 6561         if re.sea
-00052440: 7263 6828 7222 5c73 2b7c 5c28 2c22 202b  rch(r"\s+|\(," +
-00052450: 2063 6f6c 202b 2022 5c73 2b7c 5c29 7c2c   col + "\s+|\)|,
-00052460: 222c 2076 616c 7565 5f6d 6170 7069 6e67  ", value_mapping
-00052470: 2920 6f72 2072 652e 7365 6172 6368 2872  ) or re.search(r
-00052480: 2228 5e22 202b 2063 6f6c 202b 2022 2429  "(^" + col + "$)
-00052490: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000524a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-000524f0: 655f 6d61 7070 696e 6729 3a0d 0a20 2020  e_mapping):..   
-00052500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052510: 2064 6174 6173 6574 5f73 7065 635f 736f   dataset_spec_so
-00052520: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
-00052530: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
-00052540: 5f64 6174 6173 6574 5f73 7065 635f 6672  _dataset_spec_fr
-00052550: 6f6d 5f69 645f 6461 7461 7365 745f 616e  om_id_dataset_an
-00052560: 645f 636f 6c75 6d6e 5f6e 616d 6528 0d0a  d_column_name(..
-00052570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052580: 2020 2020 2020 2020 6461 7461 7365 745f          dataset_
-00052590: 736f 7572 6365 2e69 645f 6461 7461 7365  source.id_datase
-000525a0: 742c 2063 6f6c 290d 0a20 2020 2020 2020  t, col)..       
-000525b0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000525c0: 7565 5f6d 6170 7069 6e67 203d 2072 652e  ue_mapping = re.
-000525d0: 7375 6228 636f 6c2c 2022 5b22 202b 2073  sub(col, "[" + s
-000525e0: 7472 2864 6174 6173 6574 5f73 7065 635f  tr(dataset_spec_
-000525f0: 736f 7572 6365 2e69 645f 6461 7461 7365  source.id_datase
-00052600: 745f 7370 6563 2920 2b20 225d 222c 2076  t_spec) + "]", v
-00052610: 616c 7565 5f6d 6170 7069 6e67 290d 0a0d  alue_mapping)...
-00052620: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00052630: 6173 6574 5f74 5f6d 6170 7069 6e67 203d  aset_t_mapping =
-00052640: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00052650: 6374 7561 6c2e 6765 745f 6461 7461 7365  ctual.get_datase
-00052660: 745f 745f 6d61 7070 696e 675f 6672 6f6d  t_t_mapping_from
-00052670: 5f69 645f 6272 616e 6368 5f61 6e64 5f69  _id_branch_and_i
-00052680: 645f 6461 7461 7365 745f 7370 6563 5f61  d_dataset_spec_a
-00052690: 6e64 5f76 616c 7565 5f6d 6170 7069 6e67  nd_value_mapping
-000526a0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000526b0: 2020 2069 645f 6272 616e 6368 2c20 6461     id_branch, da
-000526c0: 7461 7365 745f 7370 6563 2e69 645f 6461  taset_spec.id_da
-000526d0: 7461 7365 745f 7370 6563 2c20 7661 6c75  taset_spec, valu
-000526e0: 655f 6d61 7070 696e 6729 0d0a 0d0a 2020  e_mapping)....  
-000526f0: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
-00052700: 6173 6574 5f74 5f6d 6170 7069 6e67 2069  aset_t_mapping i
-00052710: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00052720: 2020 2020 2020 2020 2069 645f 745f 6d61           id_t_ma
-00052730: 7070 696e 6720 3d20 6e65 7874 5f69 645f  pping = next_id_
-00052740: 745f 6d61 7070 696e 670d 0a20 2020 2020  t_mapping..     
-00052750: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-00052760: 6964 5f74 5f6d 6170 7069 6e67 202b 3d20  id_t_mapping += 
-00052770: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00052780: 2020 206e 6577 5f64 6174 6173 6574 5f74     new_dataset_t
-00052790: 5f6d 6170 7069 6e67 203d 205b 6964 5f74  _mapping = [id_t
-000527a0: 5f6d 6170 7069 6e67 2c20 6964 5f62 7261  _mapping, id_bra
-000527b0: 6e63 682c 2064 6174 6173 6574 5f73 7065  nch, dataset_spe
-000527c0: 632e 6964 5f64 6174 6173 6574 5f73 7065  c.id_dataset_spe
-000527d0: 632c 2076 616c 7565 5f6d 6170 7069 6e67  c, value_mapping
-000527e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000527f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052800: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00052810: 2e6f 776e 6572 2c20 7365 6c66 2e63 6f6e  .owner, self.con
-00052820: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
-00052830: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
-00052840: 7565 2829 2c20 224e 554c 4c22 5d0d 0a20  ue(), "NULL"].. 
-00052850: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00052860: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00052870: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-00052880: 7365 745f 745f 6d61 7070 696e 6728 5b6e  set_t_mapping([n
-00052890: 6577 5f64 6174 6173 6574 5f74 5f6d 6170  ew_dataset_t_map
-000528a0: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
-000528b0: 2020 2020 2020 2020 6d61 7070 696e 675f          mapping_
-000528c0: 6c6f 6164 6564 2e61 7070 656e 6428 5b69  loaded.append([i
-000528d0: 645f 6272 616e 6368 2c20 6461 7461 7365  d_branch, datase
-000528e0: 745f 7370 6563 2e69 645f 6461 7461 7365  t_spec.id_datase
-000528f0: 745f 7370 6563 2c20 7661 6c75 655f 6d61  t_spec, value_ma
-00052900: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-00052910: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00052920: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00052930: 2076 616c 7565 5f6d 6170 7069 6e67 203d   value_mapping =
-00052940: 3d20 6461 7461 7365 745f 745f 6d61 7070  = dataset_t_mapp
-00052950: 696e 672e 7661 6c75 655f 6d61 7070 696e  ing.value_mappin
-00052960: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-00052970: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
-00052980: 5f6d 6170 7069 6e67 203d 205b 6461 7461  _mapping = [data
-00052990: 7365 745f 745f 6d61 7070 696e 672e 6964  set_t_mapping.id
-000529a0: 5f74 5f6d 6170 7069 6e67 2c20 6461 7461  _t_mapping, data
-000529b0: 7365 745f 745f 6d61 7070 696e 672e 6964  set_t_mapping.id
-000529c0: 5f62 7261 6e63 682c 0d0a 2020 2020 2020  _branch,..      
+00052120: 2020 2020 6469 7374 696e 6374 5f65 7869      distinct_exi
+00052130: 7374 656e 742e 6d65 7461 5f6f 776e 6572  stent.meta_owner
+00052140: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00052150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052160: 2020 2020 2020 2020 2020 2020 2227 2220              "'" 
+00052170: 2b20 7374 7228 6469 7374 696e 6374 5f65  + str(distinct_e
+00052180: 7869 7374 656e 742e 7374 6172 745f 6461  xistent.start_da
+00052190: 7465 2920 2b20 2227 222c 0d0a 2020 2020  te) + "'",..    
+000521a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000521b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000521c0: 2020 2020 2073 656c 662e 636f 6e6e 6563       self.connec
+000521d0: 7469 6f6e 5f6d 6574 6164 6174 612e 6765  tion_metadata.ge
+000521e0: 745f 7379 7364 6174 655f 7661 6c75 6528  t_sysdate_value(
+000521f0: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
+00052200: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
+00052210: 6164 6174 615f 746f 5f6c 6f61 642e 6164  adata_to_load.ad
+00052220: 645f 6f6d 5f64 6174 6173 6574 5f74 5f64  d_om_dataset_t_d
+00052230: 6973 7469 6e63 7428 5b65 7869 7374 656e  istinct([existen
+00052240: 745f 6469 7374 696e 6374 5d29 0d0a 2020  t_distinct])..  
+00052250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052260: 2020 6469 7374 696e 6374 5f6c 6f61 6465    distinct_loade
+00052270: 642e 6170 7065 6e64 285b 6469 7374 696e  d.append([distin
+00052280: 6374 5f65 7869 7374 656e 742e 6964 5f64  ct_existent.id_d
+00052290: 6174 6173 6574 2c20 6469 7374 696e 6374  ataset, distinct
+000522a0: 5f65 7869 7374 656e 742e 6964 5f62 7261  _existent.id_bra
+000522b0: 6e63 685d 290d 0a0d 0a20 2020 2020 2020  nch])....       
+000522c0: 2020 2020 2020 2020 2020 2020 2069 645f               id_
+000522d0: 745f 6469 7374 696e 6374 203d 206e 6578  t_distinct = nex
+000522e0: 745f 6964 5f74 5f64 6973 7469 6e63 740d  t_id_t_distinct.
+000522f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052300: 2020 2020 206e 6578 745f 6964 5f74 5f64       next_id_t_d
+00052310: 6973 7469 6e63 7420 2b3d 2031 0d0a 2020  istinct += 1..  
+00052320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052330: 2020 6e65 775f 6469 7374 696e 6374 203d    new_distinct =
+00052340: 205b 6964 5f74 5f64 6973 7469 6e63 742c   [id_t_distinct,
+00052350: 2064 6174 6173 6574 2e69 645f 6461 7461   dataset.id_data
+00052360: 7365 742c 2069 645f 6272 616e 6368 2c20  set, id_branch, 
+00052370: 7377 5f64 6973 7469 6e63 742c 2073 656c  sw_distinct, sel
+00052380: 662e 6f77 6e65 722c 0d0a 2020 2020 2020  f.owner,..      
+00052390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000523a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000523b0: 6c66 2e63 6f6e 6e65 6374 696f 6e5f 6d65  lf.connection_me
+000523c0: 7461 6461 7461 2e67 6574 5f73 7973 6461  tadata.get_sysda
+000523d0: 7465 5f76 616c 7565 2829 2c20 224e 554c  te_value(), "NUL
+000523e0: 4c22 5d0d 0a20 2020 2020 2020 2020 2020  L"]..           
+000523f0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00052400: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+00052410: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
+00052420: 6469 7374 696e 6374 285b 6e65 775f 6469  distinct([new_di
+00052430: 7374 696e 6374 5d29 0d0a 2020 2020 2020  stinct])..      
+00052440: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00052450: 7374 696e 6374 5f6c 6f61 6465 642e 6170  stinct_loaded.ap
+00052460: 7065 6e64 285b 6461 7461 7365 742e 6964  pend([dataset.id
+00052470: 5f64 6174 6173 6574 2c20 6964 5f62 7261  _dataset, id_bra
+00052480: 6e63 685d 290d 0a0d 0a20 2020 2020 2020  nch])....       
+00052490: 2066 6f72 2064 6973 7469 6e63 7420 696e   for distinct in
+000524a0: 205b 7820 666f 7220 7820 696e 2073 656c   [x for x in sel
+000524b0: 662e 6d65 7461 6461 7461 5f61 6374 7561  f.metadata_actua
+000524c0: 6c2e 6f6d 5f64 6174 6173 6574 5f74 5f64  l.om_dataset_t_d
+000524d0: 6973 7469 6e63 7420 6966 2078 2e65 6e64  istinct if x.end
+000524e0: 5f64 6174 6520 6973 204e 6f6e 655d 3a0d  _date is None]:.
+000524f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00052500: 5b64 6973 7469 6e63 742e 6964 5f64 6174  [distinct.id_dat
+00052510: 6173 6574 2c20 6469 7374 696e 6374 2e69  aset, distinct.i
+00052520: 645f 6272 616e 6368 5d20 6e6f 7420 696e  d_branch] not in
+00052530: 2064 6973 7469 6e63 745f 6c6f 6164 6564   distinct_loaded
+00052540: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00052550: 2020 2063 6c6f 7365 5f64 6973 7469 6e63     close_distinc
+00052560: 7420 3d20 5b64 6973 7469 6e63 742e 6964  t = [distinct.id
+00052570: 5f74 5f64 6973 7469 6e63 742c 2064 6973  _t_distinct, dis
+00052580: 7469 6e63 742e 6964 5f64 6174 6173 6574  tinct.id_dataset
+00052590: 2c20 6469 7374 696e 6374 2e69 645f 6272  , distinct.id_br
+000525a0: 616e 6368 2c20 6469 7374 696e 6374 2e73  anch, distinct.s
+000525b0: 775f 6469 7374 696e 6374 0d0a 2020 2020  w_distinct..    
+000525c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000525d0: 2c20 6469 7374 696e 6374 2e6d 6574 615f  , distinct.meta_
+000525e0: 6f77 6e65 722c 2022 2722 202b 2073 7472  owner, "'" + str
+000525f0: 2864 6973 7469 6e63 742e 7374 6172 745f  (distinct.start_
+00052600: 6461 7465 2920 2b20 2227 222c 2073 656c  date) + "'", sel
+00052610: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
+00052620: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
+00052630: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
+00052640: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00052650: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
+00052660: 642e 6164 645f 6f6d 5f64 6174 6173 6574  d.add_om_dataset
+00052670: 5f74 5f64 6973 7469 6e63 7428 5b63 6c6f  _t_distinct([clo
+00052680: 7365 5f64 6973 7469 6e63 745d 290d 0a0d  se_distinct])...
+00052690: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+000526a0: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
+000526b0: 655f 6e61 6d65 2c20 2246 696e 6973 6865  e_name, "Finishe
+000526c0: 6420 746f 2070 726f 6365 7373 204d 6574  d to process Met
+000526d0: 6164 6174 6120 5b20 4469 7374 696e 6374  adata [ Distinct
+000526e0: 205d 2069 6e66 6f72 6d61 7469 6f6e 222c   ] information",
+000526f0: 204c 4f47 5f4c 4556 454c 5f4f 4e4c 595f   LOG_LEVEL_ONLY_
+00052700: 4c4f 4729 0d0a 0d0a 2020 2020 6465 6620  LOG)....    def 
+00052710: 7072 6f63 6573 735f 656c 745f 6d61 7070  process_elt_mapp
+00052720: 696e 6728 7365 6c66 293a 0d0a 2020 2020  ing(self):..    
+00052730: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
+00052740: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
+00052750: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
+00052760: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
+00052770: 205b 204d 6170 7069 6e67 205d 2069 6e66   [ Mapping ] inf
+00052780: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
+00052790: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
+000527a0: 2020 2020 2020 2020 2323 2323 2323 2323          ########
+000527b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000527c0: 204c 4f41 4420 4d41 5050 494e 4720 2323   LOAD MAPPING ##
+000527d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000527e0: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
+000527f0: 6e65 7874 5f69 645f 745f 6d61 7070 696e  next_id_t_mappin
+00052800: 6720 3d20 7365 6c66 2e6e 6578 745f 6964  g = self.next_id
+00052810: 5f74 5f6d 6170 7069 6e67 0d0a 0d0a 2020  _t_mapping....  
+00052820: 2020 2020 2020 6d61 7070 696e 675f 6c6f        mapping_lo
+00052830: 6164 6564 203d 205b 5d0d 0a20 2020 2020  aded = []..     
+00052840: 2020 2066 6f72 206d 6170 7069 6e67 2069     for mapping i
+00052850: 6e20 7365 6c66 2e6d 6574 6164 6174 615f  n self.metadata_
+00052860: 6163 7475 616c 2e65 6e74 7279 5f64 6174  actual.entry_dat
+00052870: 6173 6574 5f6d 6170 7069 6e67 733a 0d0a  aset_mappings:..
+00052880: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00052890: 7365 7420 3d20 7365 6c66 2e6d 6574 6164  set = self.metad
+000528a0: 6174 615f 746f 5f6c 6f61 642e 6765 745f  ata_to_load.get_
+000528b0: 6461 7461 7365 745f 6672 6f6d 5f64 6174  dataset_from_dat
+000528c0: 6173 6574 5f6e 616d 6528 7365 6c66 2e6d  aset_name(self.m
+000528d0: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+000528e0: 6574 5f74 6162 6c65 5f6e 616d 655f 6672  et_table_name_fr
+000528f0: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6f6e  om_cod_entity_on
+00052900: 5f65 6e74 7279 286d 6170 7069 6e67 2e63  _entry(mapping.c
+00052910: 6f64 5f65 6e74 6974 795f 7461 7267 6574  od_entity_target
+00052920: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00052930: 6461 7461 7365 745f 7370 6563 203d 2073  dataset_spec = s
+00052940: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+00052950: 6c6f 6164 2e67 6574 5f64 6174 6173 6574  load.get_dataset
+00052960: 5f73 7065 635f 6672 6f6d 5f69 645f 6461  _spec_from_id_da
+00052970: 7461 7365 745f 616e 645f 636f 6c75 6d6e  taset_and_column
+00052980: 5f6e 616d 6528 6461 7461 7365 742e 6964  _name(dataset.id
+00052990: 5f64 6174 6173 6574 2c0d 0a20 2020 2020  _dataset,..     
+000529a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000529b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000529c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000529d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000529e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000529f0: 2020 6461 7461 7365 745f 745f 6d61 7070    dataset_t_mapp
-00052a00: 696e 672e 6964 5f64 6174 6173 6574 5f73  ing.id_dataset_s
-00052a10: 7065 632c 2064 6174 6173 6574 5f74 5f6d  pec, dataset_t_m
-00052a20: 6170 7069 6e67 2e76 616c 7565 5f6d 6170  apping.value_map
-00052a30: 7069 6e67 2c0d 0a20 2020 2020 2020 2020  ping,..         
-00052a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052a50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00052a60: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
-00052a70: 2e6d 6574 615f 6f77 6e65 722c 2022 2722  .meta_owner, "'"
-00052a80: 202b 2073 7472 2864 6174 6173 6574 5f74   + str(dataset_t
-00052a90: 5f6d 6170 7069 6e67 2e73 7461 7274 5f64  _mapping.start_d
-00052aa0: 6174 6529 202b 2022 2722 2c0d 0a20 2020  ate) + "'",..   
-00052ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ad0: 2020 2020 2022 4e55 4c4c 225d 0d0a 2020       "NULL"]..  
-00052ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052af0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-00052b00: 746f 5f6c 6f61 642e 6164 645f 6f6d 5f64  to_load.add_om_d
-00052b10: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
-00052b20: 285b 6578 6973 7465 6e74 5f6d 6170 7069  ([existent_mappi
-00052b30: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
-00052b40: 2020 2020 2020 2020 2020 6d61 7070 696e            mappin
-00052b50: 675f 6c6f 6164 6564 2e61 7070 656e 6428  g_loaded.append(
-00052b60: 5b64 6174 6173 6574 5f74 5f6d 6170 7069  [dataset_t_mappi
-00052b70: 6e67 2e69 645f 6272 616e 6368 2c20 6461  ng.id_branch, da
-00052b80: 7461 7365 745f 745f 6d61 7070 696e 672e  taset_t_mapping.
-00052b90: 6964 5f64 6174 6173 6574 5f73 7065 632c  id_dataset_spec,
-00052ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052bc0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00052bd0: 6173 6574 5f74 5f6d 6170 7069 6e67 2e76  aset_t_mapping.v
-00052be0: 616c 7565 5f6d 6170 7069 6e67 5d29 0d0a  alue_mapping])..
-00052bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c00: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00052c10: 2020 2020 2020 2020 2020 2065 7869 7374             exist
-00052c20: 656e 745f 6d61 7070 696e 6720 3d20 5b64  ent_mapping = [d
-00052c30: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
-00052c40: 2e69 645f 745f 6d61 7070 696e 672c 2064  .id_t_mapping, d
-00052c50: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
-00052c60: 2e69 645f 6272 616e 6368 2c0d 0a20 2020  .id_branch,..   
-00052c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052c90: 2020 2020 2064 6174 6173 6574 5f74 5f6d       dataset_t_m
-00052ca0: 6170 7069 6e67 2e69 645f 6461 7461 7365  apping.id_datase
-00052cb0: 745f 7370 6563 2c20 6461 7461 7365 745f  t_spec, dataset_
-00052cc0: 745f 6d61 7070 696e 672e 7661 6c75 655f  t_mapping.value_
-00052cd0: 6d61 7070 696e 672c 0d0a 2020 2020 2020  mapping,..      
-00052ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052d00: 2020 6461 7461 7365 745f 745f 6d61 7070    dataset_t_mapp
-00052d10: 696e 672e 6d65 7461 5f6f 776e 6572 2c20  ing.meta_owner, 
-00052d20: 2227 2220 2b20 7374 7228 6461 7461 7365  "'" + str(datase
-00052d30: 745f 745f 6d61 7070 696e 672e 7374 6172  t_t_mapping.star
-00052d40: 745f 6461 7465 2920 2b20 2227 222c 0d0a  t_date) + "'",..
+000529f0: 2020 2020 2020 2020 2020 2020 206d 6170               map
+00052a00: 7069 6e67 2e63 6f6c 756d 6e5f 6e61 6d65  ping.column_name
+00052a10: 5f74 6172 6765 7429 0d0a 2020 2020 2020  _target)..      
+00052a20: 2020 2020 2020 6964 5f62 7261 6e63 6820        id_branch 
+00052a30: 3d20 6d61 7070 696e 672e 6e75 6d5f 6272  = mapping.num_br
+00052a40: 616e 6368 0d0a 2020 2020 2020 2020 2020  anch..          
+00052a50: 2020 7661 6c75 655f 6d61 7070 696e 6720    value_mapping 
+00052a60: 3d20 6d61 7070 696e 672e 7661 6c75 655f  = mapping.value_
+00052a70: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
+00052a80: 2020 2020 6461 7461 7365 745f 736f 7572      dataset_sour
+00052a90: 6365 203d 2073 656c 662e 6d65 7461 6461  ce = self.metada
+00052aa0: 7461 5f74 6f5f 6c6f 6164 2e67 6574 5f64  ta_to_load.get_d
+00052ab0: 6174 6173 6574 5f66 726f 6d5f 6461 7461  ataset_from_data
+00052ac0: 7365 745f 6e61 6d65 280d 0a20 2020 2020  set_name(..     
+00052ad0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00052ae0: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00052af0: 6765 745f 7461 626c 655f 6e61 6d65 5f66  get_table_name_f
+00052b00: 726f 6d5f 636f 645f 656e 7469 7479 5f6f  rom_cod_entity_o
+00052b10: 6e5f 656e 7472 7928 6d61 7070 696e 672e  n_entry(mapping.
+00052b20: 636f 645f 656e 7469 7479 5f73 6f75 7263  cod_entity_sourc
+00052b30: 6529 290d 0a0d 0a20 2020 2020 2020 2020  e))....         
+00052b40: 2020 2023 2054 4f44 4f3a 2053 6561 7263     # TODO: Searc
+00052b50: 6820 736f 7572 6365 2074 6162 6c65 7320  h source tables 
+00052b60: 6672 6f6d 2045 4e54 5259 5f44 4154 4153  from ENTRY_DATAS
+00052b70: 4554 5f4d 4150 5049 4e47 5320 746f 2062  ET_MAPPINGS to b
+00052b80: 6520 6162 6c65 2074 6f20 6163 6365 7074  e able to accept
+00052b90: 2064 6966 6665 7265 6e74 2063 6f6c 756d   different colum
+00052ba0: 6e73 2066 726f 6d20 6469 6665 7265 6e74  ns from diferent
+00052bb0: 2074 6162 6c65 7320 6f6e 206f 6e6c 7920   tables on only 
+00052bc0: 6f6e 6520 6d61 7070 696e 672e 0d0a 2020  one mapping...  
+00052bd0: 2020 2020 2020 2020 2020 616c 6c5f 636f            all_co
+00052be0: 6c75 6d6e 735f 6672 6f6d 5f73 6f75 7263  lumns_from_sourc
+00052bf0: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+00052c00: 615f 746f 5f6c 6f61 642e 6765 745f 616c  a_to_load.get_al
+00052c10: 6c5f 636f 6c75 6d6e 735f 6672 6f6d 5f74  l_columns_from_t
+00052c20: 6162 6c65 5f6e 616d 6528 0d0a 2020 2020  able_name(..    
+00052c30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00052c40: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00052c50: 2e67 6574 5f74 6162 6c65 5f6e 616d 655f  .get_table_name_
+00052c60: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+00052c70: 6f6e 5f65 6e74 7279 286d 6170 7069 6e67  on_entry(mapping
+00052c80: 2e63 6f64 5f65 6e74 6974 795f 736f 7572  .cod_entity_sour
+00052c90: 6365 2929 0d0a 2020 2020 2020 2020 2020  ce))..          
+00052ca0: 2020 666f 7220 636f 6c20 696e 2061 6c6c    for col in all
+00052cb0: 5f63 6f6c 756d 6e73 5f66 726f 6d5f 736f  _columns_from_so
+00052cc0: 7572 6365 3a0d 0a20 2020 2020 2020 2020  urce:..         
+00052cd0: 2020 2020 2020 2069 6620 7265 2e73 6561         if re.sea
+00052ce0: 7263 6828 7222 5c73 2b7c 5c28 2c22 202b  rch(r"\s+|\(," +
+00052cf0: 2063 6f6c 202b 2022 5c73 2b7c 5c29 7c2c   col + "\s+|\)|,
+00052d00: 222c 2076 616c 7565 5f6d 6170 7069 6e67  ", value_mapping
+00052d10: 2920 6f72 2072 652e 7365 6172 6368 2872  ) or re.search(r
+00052d20: 2228 5e22 202b 2063 6f6c 202b 2022 2429  "(^" + col + "$)
+00052d30: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00052d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00052d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00052d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052d70: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00052d80: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
-00052d90: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
-00052da0: 7565 2829 5d0d 0a20 2020 2020 2020 2020  ue()]..         
-00052db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00052dc0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-00052dd0: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
-00052de0: 745f 6d61 7070 696e 6728 5b65 7869 7374  t_mapping([exist
-00052df0: 656e 745f 6d61 7070 696e 675d 290d 0a20  ent_mapping]).. 
-00052e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e10: 2020 206d 6170 7069 6e67 5f6c 6f61 6465     mapping_loade
-00052e20: 642e 6170 7065 6e64 285b 6461 7461 7365  d.append([datase
-00052e30: 745f 745f 6d61 7070 696e 672e 6964 5f62  t_t_mapping.id_b
-00052e40: 7261 6e63 682c 2064 6174 6173 6574 5f74  ranch, dataset_t
-00052e50: 5f6d 6170 7069 6e67 2e69 645f 6461 7461  _mapping.id_data
-00052e60: 7365 745f 7370 6563 2c0d 0a20 2020 2020  set_spec,..     
-00052e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052e90: 2020 2020 2020 6461 7461 7365 745f 745f        dataset_t_
-00052ea0: 6d61 7070 696e 672e 7661 6c75 655f 6d61  mapping.value_ma
-00052eb0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
-00052ec0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00052ed0: 645f 745f 6d61 7070 696e 6720 3d20 6e65  d_t_mapping = ne
-00052ee0: 7874 5f69 645f 745f 6d61 7070 696e 670d  xt_id_t_mapping.
-00052ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052f00: 2020 2020 206e 6578 745f 6964 5f74 5f6d       next_id_t_m
-00052f10: 6170 7069 6e67 202b 3d20 310d 0a20 2020  apping += 1..   
-00052f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052f30: 206e 6577 5f64 6174 6173 6574 5f74 5f6d   new_dataset_t_m
-00052f40: 6170 7069 6e67 203d 205b 6964 5f74 5f6d  apping = [id_t_m
-00052f50: 6170 7069 6e67 2c20 6964 5f62 7261 6e63  apping, id_branc
-00052f60: 682c 2064 6174 6173 6574 5f73 7065 632e  h, dataset_spec.
-00052f70: 6964 5f64 6174 6173 6574 5f73 7065 632c  id_dataset_spec,
-00052f80: 2076 616c 7565 5f6d 6170 7069 6e67 2c0d   value_mapping,.
-00052f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052fb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00052fc0: 6c66 2e6f 776e 6572 2c20 7365 6c66 2e63  lf.owner, self.c
-00052fd0: 6f6e 6e65 6374 696f 6e5f 6d65 7461 6461  onnection_metada
-00052fe0: 7461 2e67 6574 5f73 7973 6461 7465 5f76  ta.get_sysdate_v
-00052ff0: 616c 7565 2829 2c20 224e 554c 4c22 5d0d  alue(), "NULL"].
-00053000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053010: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00053020: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
-00053030: 6d5f 6461 7461 7365 745f 745f 6d61 7070  m_dataset_t_mapp
-00053040: 696e 6728 5b6e 6577 5f64 6174 6173 6574  ing([new_dataset
-00053050: 5f74 5f6d 6170 7069 6e67 5d29 0d0a 2020  _t_mapping])..  
-00053060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053070: 2020 6d61 7070 696e 675f 6c6f 6164 6564    mapping_loaded
-00053080: 2e61 7070 656e 6428 5b69 645f 6272 616e  .append([id_bran
-00053090: 6368 2c20 6461 7461 7365 745f 7370 6563  ch, dataset_spec
-000530a0: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
-000530b0: 2c20 7661 6c75 655f 6d61 7070 696e 675d  , value_mapping]
-000530c0: 290d 0a0d 0a20 2020 2020 2020 2066 6f72  )....        for
-000530d0: 206d 6170 7069 6e67 2069 6e20 5b78 2066   mapping in [x f
-000530e0: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-000530f0: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
-00053100: 6461 7461 7365 745f 745f 6d61 7070 696e  dataset_t_mappin
-00053110: 6720 6966 2078 2e65 6e64 5f64 6174 6520  g if x.end_date 
-00053120: 6973 204e 6f6e 655d 3a0d 0a20 2020 2020  is None]:..     
-00053130: 2020 2020 2020 2069 6620 5b6d 6170 7069         if [mappi
-00053140: 6e67 2e69 645f 6272 616e 6368 2c20 6d61  ng.id_branch, ma
-00053150: 7070 696e 672e 6964 5f64 6174 6173 6574  pping.id_dataset
-00053160: 5f73 7065 632c 206d 6170 7069 6e67 2e76  _spec, mapping.v
-00053170: 616c 7565 5f6d 6170 7069 6e67 5d20 6e6f  alue_mapping] no
-00053180: 7420 696e 206d 6170 7069 6e67 5f6c 6f61  t in mapping_loa
-00053190: 6465 643a 0d0a 2020 2020 2020 2020 2020  ded:..          
-000531a0: 2020 2020 2020 636c 6f73 655f 6d61 7070        close_mapp
-000531b0: 696e 6720 3d20 5b6d 6170 7069 6e67 2e69  ing = [mapping.i
-000531c0: 645f 745f 6d61 7070 696e 672c 206d 6170  d_t_mapping, map
-000531d0: 7069 6e67 2e69 645f 6272 616e 6368 2c0d  ping.id_branch,.
-000531e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000531f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053200: 2020 6d61 7070 696e 672e 6964 5f64 6174    mapping.id_dat
-00053210: 6173 6574 5f73 7065 632c 206d 6170 7069  aset_spec, mappi
-00053220: 6e67 2e76 616c 7565 5f6d 6170 7069 6e67  ng.value_mapping
-00053230: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00053240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053250: 2020 2020 6d61 7070 696e 672e 6d65 7461      mapping.meta
-00053260: 5f6f 776e 6572 2c20 2227 2220 2b20 7374  _owner, "'" + st
-00053270: 7228 6d61 7070 696e 672e 7374 6172 745f  r(mapping.start_
-00053280: 6461 7465 2920 2b20 2227 222c 0d0a 2020  date) + "'",..  
-00053290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000532a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000532b0: 656c 662e 636f 6e6e 6563 7469 6f6e 5f6d  elf.connection_m
-000532c0: 6574 6164 6174 612e 6765 745f 7379 7364  etadata.get_sysd
-000532d0: 6174 655f 7661 6c75 6528 295d 0d0a 2020  ate_value()]..  
-000532e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000532f0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-00053300: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
-00053310: 6574 5f74 5f6d 6170 7069 6e67 285b 636c  et_t_mapping([cl
-00053320: 6f73 655f 6d61 7070 696e 675d 290d 0a0d  ose_mapping])...
-00053330: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00053340: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
-00053350: 655f 6e61 6d65 2c20 2246 696e 6973 6865  e_name, "Finishe
-00053360: 6420 746f 2070 726f 6365 7373 204d 6574  d to process Met
-00053370: 6164 6174 6120 5b20 4d61 7070 696e 6720  adata [ Mapping 
-00053380: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
-00053390: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
-000533a0: 4f47 290d 0a0d 0a20 2020 2064 6566 2070  OG)....    def p
-000533b0: 726f 6365 7373 5f65 6c74 5f66 696c 7465  rocess_elt_filte
-000533c0: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
-000533d0: 2020 7365 6c66 2e6c 6f67 2e6c 6f67 2873    self.log.log(s
-000533e0: 656c 662e 656e 6769 6e65 5f6e 616d 652c  elf.engine_name,
-000533f0: 2022 5374 6172 7469 6e67 2074 6f20 7072   "Starting to pr
-00053400: 6f63 6573 7320 4d65 7461 6461 7461 205b  ocess Metadata [
-00053410: 2046 696c 7465 7220 5d20 696e 666f 726d   Filter ] inform
-00053420: 6174 696f 6e22 2c20 4c4f 475f 4c45 5645  ation", LOG_LEVE
-00053430: 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20 2020  L_ONLY_LOG)..   
-00053440: 2020 2020 206e 6578 745f 6964 5f74 5f66       next_id_t_f
-00053450: 696c 7465 7220 3d20 7365 6c66 2e6e 6578  ilter = self.nex
-00053460: 745f 6964 5f74 5f66 696c 7465 720d 0a20  t_id_t_filter.. 
-00053470: 2020 2020 2020 2023 2323 2323 2323 2323         #########
-00053480: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
-00053490: 4c4f 4144 2046 494c 5445 5220 2323 2323  LOAD FILTER ####
-000534a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000534b0: 2323 2323 0d0a 2020 2020 2020 2020 6669  ####..        fi
-000534c0: 6c74 6572 5f6c 6f61 6465 6420 3d20 5b5d  lter_loaded = []
-000534d0: 0d0a 2020 2020 2020 2020 666f 7220 6669  ..        for fi
-000534e0: 6c74 6572 2069 6e20 7365 6c66 2e6d 6574  lter in self.met
-000534f0: 6164 6174 615f 6163 7475 616c 2e65 6e74  adata_actual.ent
-00053500: 7279 5f66 696c 7465 7273 3a0d 0a20 2020  ry_filters:..   
-00053510: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-00053520: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
-00053530: 5f74 6f5f 6c6f 6164 2e67 6574 5f64 6174  _to_load.get_dat
-00053540: 6173 6574 5f66 726f 6d5f 6461 7461 7365  aset_from_datase
-00053550: 745f 6e61 6d65 2873 656c 662e 6d65 7461  t_name(self.meta
-00053560: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
-00053570: 7461 626c 655f 6e61 6d65 5f66 726f 6d5f  table_name_from_
-00053580: 636f 645f 656e 7469 7479 5f6f 6e5f 656e  cod_entity_on_en
-00053590: 7472 7928 6669 6c74 6572 2e63 6f64 5f65  try(filter.cod_e
-000535a0: 6e74 6974 795f 7461 7267 6574 2929 0d0a  ntity_target))..
-000535b0: 2020 2020 2020 2020 2020 2020 6964 5f62              id_b
-000535c0: 7261 6e63 6820 3d20 6669 6c74 6572 2e6e  ranch = filter.n
-000535d0: 756d 5f62 7261 6e63 680d 0a20 2020 2020  um_branch..     
-000535e0: 2020 2020 2020 2076 616c 7565 5f6d 6170         value_map
-000535f0: 7069 6e67 203d 2066 696c 7465 722e 7661  ping = filter.va
-00053600: 6c75 650d 0a0d 0a20 2020 2020 2020 2020  lue....         
-00053610: 2020 2061 6c6c 5f73 6f75 7263 655f 7461     all_source_ta
-00053620: 626c 6573 203d 2073 656c 662e 6d65 7461  bles = self.meta
-00053630: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
-00053640: 5f61 6c6c 5f73 6f75 7263 655f 7461 626c  _all_source_tabl
-00053650: 6573 5f66 726f 6d5f 7461 7267 6574 5f74  es_from_target_t
-00053660: 6162 6c65 5f6e 616d 6528 7365 6c66 2e6d  able_name(self.m
-00053670: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
-00053680: 6574 5f74 6162 6c65 5f6e 616d 655f 6672  et_table_name_fr
-00053690: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6f6e  om_cod_entity_on
-000536a0: 5f65 6e74 7279 2866 696c 7465 722e 636f  _entry(filter.co
-000536b0: 645f 656e 7469 7479 5f74 6172 6765 7429  d_entity_target)
-000536c0: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-000536d0: 6f72 2073 6f75 7263 6520 696e 2061 6c6c  or source in all
-000536e0: 5f73 6f75 7263 655f 7461 626c 6573 3a0d  _source_tables:.
-000536f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053700: 2064 6174 6173 6574 5f73 6f75 7263 6520   dataset_source 
-00053710: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
-00053720: 746f 5f6c 6f61 642e 6765 745f 6461 7461  to_load.get_data
-00053730: 7365 745f 6672 6f6d 5f64 6174 6173 6574  set_from_dataset
-00053740: 5f6e 616d 6528 736f 7572 6365 290d 0a20  _name(source).. 
-00053750: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00053760: 6c6c 5f63 6f6c 756d 6e73 5f66 726f 6d5f  ll_columns_from_
-00053770: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
-00053780: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e67  tadata_to_load.g
-00053790: 6574 5f61 6c6c 5f63 6f6c 756d 6e73 5f66  et_all_columns_f
-000537a0: 726f 6d5f 7461 626c 655f 6e61 6d65 2864  rom_table_name(d
-000537b0: 6174 6173 6574 5f73 6f75 7263 652e 6461  ataset_source.da
-000537c0: 7461 7365 745f 6e61 6d65 290d 0a20 2020  taset_name)..   
-000537d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000537e0: 2063 6f6c 2069 6e20 616c 6c5f 636f 6c75   col in all_colu
-000537f0: 6d6e 735f 6672 6f6d 5f73 6f75 7263 653a  mns_from_source:
-00053800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00053810: 2020 2020 2020 6966 2072 652e 7365 6172        if re.sear
-00053820: 6368 2872 2228 5c73 2b7c 5c28 7c5e 2922  ch(r"(\s+|\(|^)"
-00053830: 2b63 6f6c 2b22 285c 732b 7c5c 297c 2429  +col+"(\s+|\)|$)
-00053840: 222c 2076 616c 7565 5f6d 6170 7069 6e67  ", value_mapping
-00053850: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00053860: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00053870: 7365 745f 7370 6563 5f73 6f75 7263 6520  set_spec_source 
-00053880: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
-00053890: 746f 5f6c 6f61 642e 6765 745f 6461 7461  to_load.get_data
-000538a0: 7365 745f 7370 6563 5f66 726f 6d5f 6964  set_spec_from_id
-000538b0: 5f64 6174 6173 6574 5f61 6e64 5f63 6f6c  _dataset_and_col
-000538c0: 756d 6e5f 6e61 6d65 2864 6174 6173 6574  umn_name(dataset
-000538d0: 5f73 6f75 7263 652e 6964 5f64 6174 6173  _source.id_datas
-000538e0: 6574 2c20 636f 6c29 0d0a 2020 2020 2020  et, col)..      
-000538f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053900: 2020 7661 6c75 655f 6d61 7070 696e 6720    value_mapping 
-00053910: 3d20 7265 2e73 7562 2863 6f6c 2c20 225b  = re.sub(col, "[
-00053920: 2220 2b20 7374 7228 6461 7461 7365 745f  " + str(dataset_
-00053930: 7370 6563 5f73 6f75 7263 652e 6964 5f64  spec_source.id_d
-00053940: 6174 6173 6574 5f73 7065 6329 202b 2022  ataset_spec) + "
-00053950: 5d22 2c20 7661 6c75 655f 6d61 7070 696e  ]", value_mappin
-00053960: 6729 0d0a 0d0a 2020 2020 2020 2020 2020  g)....          
-00053970: 2020 6461 7461 7365 745f 745f 6669 6c74    dataset_t_filt
-00053980: 6572 203d 2073 656c 662e 6d65 7461 6461  er = self.metada
-00053990: 7461 5f61 6374 7561 6c2e 6765 745f 6461  ta_actual.get_da
-000539a0: 7461 7365 745f 745f 6669 6c74 6572 5f66  taset_t_filter_f
-000539b0: 726f 6d5f 6964 5f64 6174 6173 6574 5f61  rom_id_dataset_a
-000539c0: 6e64 5f69 645f 6272 616e 6368 5f61 6e64  nd_id_branch_and
-000539d0: 5f76 616c 7565 5f66 696c 7465 7228 6461  _value_filter(da
-000539e0: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
-000539f0: 2c20 6964 5f62 7261 6e63 682c 2076 616c  , id_branch, val
-00053a00: 7565 5f6d 6170 7069 6e67 290d 0a20 2020  ue_mapping)..   
-00053a10: 2020 2020 2020 2020 2069 6620 6461 7461           if data
-00053a20: 7365 745f 745f 6669 6c74 6572 2069 7320  set_t_filter is 
-00053a30: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00053a40: 2020 2020 2020 2069 645f 745f 6669 6c74         id_t_filt
-00053a50: 6572 203d 206e 6578 745f 6964 5f74 5f66  er = next_id_t_f
-00053a60: 696c 7465 720d 0a20 2020 2020 2020 2020  ilter..         
-00053a70: 2020 2020 2020 206e 6578 745f 6964 5f74         next_id_t
-00053a80: 5f66 696c 7465 7220 2b3d 2031 0d0a 2020  _filter += 1..  
-00053a90: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00053aa0: 775f 6461 7461 7365 745f 745f 6669 6c74  w_dataset_t_filt
-00053ab0: 6572 203d 205b 6964 5f74 5f66 696c 7465  er = [id_t_filte
-00053ac0: 722c 2064 6174 6173 6574 2e69 645f 6461  r, dataset.id_da
-00053ad0: 7461 7365 742c 2069 645f 6272 616e 6368  taset, id_branch
-00053ae0: 2c20 7661 6c75 655f 6d61 7070 696e 672c  , value_mapping,
-00053af0: 2073 656c 662e 6f77 6e65 722c 0d0a 2020   self.owner,..  
-00053b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053b20: 2020 2020 2020 7365 6c66 2e63 6f6e 6e65        self.conne
-00053b30: 6374 696f 6e5f 6d65 7461 6461 7461 2e67  ction_metadata.g
-00053b40: 6574 5f73 7973 6461 7465 5f76 616c 7565  et_sysdate_value
-00053b50: 2829 2c20 224e 554c 4c22 5d0d 0a20 2020  (), "NULL"]..   
-00053b60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00053b70: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
-00053b80: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
-00053b90: 745f 745f 6669 6c74 6572 285b 6e65 775f  t_t_filter([new_
-00053ba0: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
-00053bb0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00053bc0: 2020 2020 6669 6c74 6572 5f6c 6f61 6465      filter_loade
-00053bd0: 642e 6170 7065 6e64 285b 6461 7461 7365  d.append([datase
-00053be0: 742e 6964 5f64 6174 6173 6574 2c20 6964  t.id_dataset, id
-00053bf0: 5f62 7261 6e63 682c 2076 616c 7565 5f6d  _branch, value_m
-00053c00: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
-00053c10: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00053c20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00053c30: 6620 7661 6c75 655f 6d61 7070 696e 6720  f value_mapping 
-00053c40: 3d3d 2064 6174 6173 6574 5f74 5f66 696c  == dataset_t_fil
-00053c50: 7465 722e 7661 6c75 655f 6669 6c74 6572  ter.value_filter
-00053c60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00053c70: 2020 2020 2020 2065 7869 7374 656e 745f         existent_
-00053c80: 6669 6c74 6572 203d 205b 6461 7461 7365  filter = [datase
-00053c90: 745f 745f 6669 6c74 6572 2e69 645f 745f  t_t_filter.id_t_
-00053ca0: 6669 6c74 6572 2c20 6461 7461 7365 745f  filter, dataset_
-00053cb0: 745f 6669 6c74 6572 2e69 645f 6461 7461  t_filter.id_data
-00053cc0: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
-00053cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053ce0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00053cf0: 6173 6574 5f74 5f66 696c 7465 722e 6964  aset_t_filter.id
-00053d00: 5f62 7261 6e63 682c 0d0a 2020 2020 2020  _branch,..      
-00053d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d30: 2064 6174 6173 6574 5f74 5f66 696c 7465   dataset_t_filte
-00053d40: 722e 7661 6c75 655f 6669 6c74 6572 2c20  r.value_filter, 
-00053d50: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
-00053d60: 2e6d 6574 615f 6f77 6e65 722c 0d0a 2020  .meta_owner,..  
-00053d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053d90: 2020 2020 2022 2722 202b 2073 7472 2864       "'" + str(d
-00053da0: 6174 6173 6574 5f74 5f66 696c 7465 722e  ataset_t_filter.
-00053db0: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
-00053dc0: 222c 2022 4e55 4c4c 225d 0d0a 2020 2020  ", "NULL"]..    
-00053dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053de0: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-00053df0: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
-00053e00: 6173 6574 5f74 5f66 696c 7465 7228 5b65  aset_t_filter([e
-00053e10: 7869 7374 656e 745f 6669 6c74 6572 5d29  xistent_filter])
-00053e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00053e30: 2020 2020 2020 6669 6c74 6572 5f6c 6f61        filter_loa
-00053e40: 6465 642e 6170 7065 6e64 280d 0a20 2020  ded.append(..   
-00053e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053e60: 2020 2020 205b 6461 7461 7365 745f 745f       [dataset_t_
-00053e70: 6669 6c74 6572 2e69 645f 6461 7461 7365  filter.id_datase
-00053e80: 742c 2064 6174 6173 6574 5f74 5f66 696c  t, dataset_t_fil
-00053e90: 7465 722e 6964 5f62 7261 6e63 682c 2064  ter.id_branch, d
-00053ea0: 6174 6173 6574 5f74 5f66 696c 7465 722e  ataset_t_filter.
-00053eb0: 7661 6c75 655f 6669 6c74 6572 5d29 0d0a  value_filter])..
-00053ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053ed0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00053ee0: 2020 2020 2020 2020 2020 2065 7869 7374             exist
-00053ef0: 656e 745f 6669 6c74 6572 203d 205b 6461  ent_filter = [da
-00053f00: 7461 7365 745f 745f 6669 6c74 6572 2e69  taset_t_filter.i
-00053f10: 645f 745f 6669 6c74 6572 2c20 6461 7461  d_t_filter, data
-00053f20: 7365 745f 745f 6669 6c74 6572 2e69 645f  set_t_filter.id_
-00053f30: 6461 7461 7365 742c 0d0a 2020 2020 2020  dataset,..      
-00053f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053f60: 2064 6174 6173 6574 5f74 5f66 696c 7465   dataset_t_filte
-00053f70: 722e 6964 5f62 7261 6e63 682c 0d0a 2020  r.id_branch,..  
-00053f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053fa0: 2020 2020 2064 6174 6173 6574 5f74 5f66       dataset_t_f
-00053fb0: 696c 7465 722e 7661 6c75 655f 6669 6c74  ilter.value_filt
-00053fc0: 6572 2c20 6461 7461 7365 745f 745f 6669  er, dataset_t_fi
-00053fd0: 6c74 6572 2e6d 6574 615f 6f77 6e65 722c  lter.meta_owner,
-00053fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00053ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054000: 2020 2020 2020 2020 2022 2722 202b 2073           "'" + s
-00054010: 7472 2864 6174 6173 6574 5f74 5f66 696c  tr(dataset_t_fil
-00054020: 7465 722e 7374 6172 745f 6461 7465 2920  ter.start_date) 
-00054030: 2b20 2227 222c 0d0a 2020 2020 2020 2020  + "'",..        
-00054040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054050: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00054060: 656c 662e 636f 6e6e 6563 7469 6f6e 5f6d  elf.connection_m
-00054070: 6574 6164 6174 612e 6765 745f 7379 7364  etadata.get_sysd
-00054080: 6174 655f 7661 6c75 6528 295d 0d0a 2020  ate_value()]..  
-00054090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000540a0: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
-000540b0: 746f 5f6c 6f61 642e 6164 645f 6f6d 5f64  to_load.add_om_d
-000540c0: 6174 6173 6574 5f74 5f66 696c 7465 7228  ataset_t_filter(
-000540d0: 5b65 7869 7374 656e 745f 6669 6c74 6572  [existent_filter
-000540e0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000540f0: 2020 2020 2020 2020 6669 6c74 6572 5f6c          filter_l
-00054100: 6f61 6465 642e 6170 7065 6e64 285b 6461  oaded.append([da
-00054110: 7461 7365 745f 745f 6669 6c74 6572 2e69  taset_t_filter.i
-00054120: 645f 6461 7461 7365 742c 2064 6174 6173  d_dataset, datas
-00054130: 6574 5f74 5f66 696c 7465 722e 6964 5f62  et_t_filter.id_b
-00054140: 7261 6e63 682c 2064 6174 6173 6574 5f74  ranch, dataset_t
-00054150: 5f66 696c 7465 722e 7661 6c75 655f 6669  _filter.value_fi
-00054160: 6c74 6572 5d29 0d0a 0d0a 2020 2020 2020  lter])....      
-00054170: 2020 2020 2020 2020 2020 2020 2020 6964                id
-00054180: 5f74 5f66 696c 7465 7220 3d20 6e65 7874  _t_filter = next
-00054190: 5f69 645f 745f 6669 6c74 6572 0d0a 2020  _id_t_filter..  
-000541a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000541b0: 2020 6e65 7874 5f69 645f 745f 6669 6c74    next_id_t_filt
-000541c0: 6572 202b 3d20 310d 0a20 2020 2020 2020  er += 1..       
-000541d0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-000541e0: 5f64 6174 6173 6574 5f74 5f66 696c 7465  _dataset_t_filte
-000541f0: 7220 3d20 5b69 645f 745f 6669 6c74 6572  r = [id_t_filter
-00054200: 2c20 6461 7461 7365 742e 6964 5f64 6174  , dataset.id_dat
-00054210: 6173 6574 2c20 6964 5f62 7261 6e63 682c  aset, id_branch,
-00054220: 2076 616c 7565 5f6d 6170 7069 6e67 2c20   value_mapping, 
-00054230: 7365 6c66 2e6f 776e 6572 2c0d 0a20 2020  self.owner,..   
-00054240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054260: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00054270: 6e6e 6563 7469 6f6e 5f6d 6574 6164 6174  nnection_metadat
-00054280: 612e 6765 745f 7379 7364 6174 655f 7661  a.get_sysdate_va
-00054290: 6c75 6528 292c 2022 4e55 4c4c 225d 0d0a  lue(), "NULL"]..
-000542a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000542b0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-000542c0: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
-000542d0: 5f64 6174 6173 6574 5f74 5f66 696c 7465  _dataset_t_filte
-000542e0: 7228 5b6e 6577 5f64 6174 6173 6574 5f74  r([new_dataset_t
-000542f0: 5f66 696c 7465 725d 290d 0a20 2020 2020  _filter])..     
-00054300: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00054310: 696c 7465 725f 6c6f 6164 6564 2e61 7070  ilter_loaded.app
-00054320: 656e 6428 5b64 6174 6173 6574 2e69 645f  end([dataset.id_
-00054330: 6461 7461 7365 742c 2069 645f 6272 616e  dataset, id_bran
-00054340: 6368 2c20 7661 6c75 655f 6d61 7070 696e  ch, value_mappin
-00054350: 675d 290d 0a0d 0a20 2020 2020 2020 2066  g])....        f
-00054360: 6f72 2066 696c 7465 7220 696e 205b 7820  or filter in [x 
-00054370: 666f 7220 7820 696e 2073 656c 662e 6d65  for x in self.me
-00054380: 7461 6461 7461 5f61 6374 7561 6c2e 6f6d  tadata_actual.om
-00054390: 5f64 6174 6173 6574 5f74 5f66 696c 7465  _dataset_t_filte
-000543a0: 7220 6966 2078 2e65 6e64 5f64 6174 6520  r if x.end_date 
-000543b0: 6973 204e 6f6e 655d 3a0d 0a20 2020 2020  is None]:..     
-000543c0: 2020 2020 2020 2069 6620 5b66 696c 7465         if [filte
-000543d0: 722e 6964 5f64 6174 6173 6574 2c20 6669  r.id_dataset, fi
-000543e0: 6c74 6572 2e69 645f 6272 616e 6368 2c20  lter.id_branch, 
-000543f0: 6669 6c74 6572 2e76 616c 7565 5f66 696c  filter.value_fil
-00054400: 7465 725d 206e 6f74 2069 6e20 6669 6c74  ter] not in filt
-00054410: 6572 5f6c 6f61 6465 643a 0d0a 2020 2020  er_loaded:..    
-00054420: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-00054430: 655f 6669 6c74 6572 203d 205b 6669 6c74  e_filter = [filt
-00054440: 6572 2e69 645f 745f 6669 6c74 6572 2c20  er.id_t_filter, 
-00054450: 6669 6c74 6572 2e69 645f 6461 7461 7365  filter.id_datase
-00054460: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
-00054470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054480: 2020 2020 6669 6c74 6572 2e69 645f 6272      filter.id_br
-00054490: 616e 6368 2c0d 0a20 2020 2020 2020 2020  anch,..         
-000544a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000544b0: 2020 2020 2020 2066 696c 7465 722e 7661         filter.va
-000544c0: 6c75 655f 6669 6c74 6572 2c20 6669 6c74  lue_filter, filt
-000544d0: 6572 2e6d 6574 615f 6f77 6e65 722c 0d0a  er.meta_owner,..
-000544e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000544f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054500: 2227 2220 2b20 7374 7228 6669 6c74 6572  "'" + str(filter
-00054510: 2e73 7461 7274 5f64 6174 6529 202b 2022  .start_date) + "
-00054520: 2722 2c20 7365 6c66 2e63 6f6e 6e65 6374  '", self.connect
-00054530: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
-00054540: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
-00054550: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00054560: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00054570: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-00054580: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
-00054590: 285b 636c 6f73 655f 6669 6c74 6572 5d29  ([close_filter])
-000545a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000545b0: 2e6c 6f67 2e6c 6f67 2873 656c 662e 656e  .log.log(self.en
-000545c0: 6769 6e65 5f6e 616d 652c 2022 4669 6e69  gine_name, "Fini
-000545d0: 7368 6564 2074 6f20 7072 6f63 6573 7320  shed to process 
-000545e0: 4d65 7461 6461 7461 205b 2046 696c 7465  Metadata [ Filte
-000545f0: 7220 5d20 696e 666f 726d 6174 696f 6e22  r ] information"
-00054600: 2c20 4c4f 475f 4c45 5645 4c5f 4f4e 4c59  , LOG_LEVEL_ONLY
-00054610: 5f4c 4f47 290d 0a0d 0a20 2020 2064 6566  _LOG)....    def
-00054620: 2070 726f 6365 7373 5f65 6c74 5f68 6176   process_elt_hav
-00054630: 696e 6728 7365 6c66 293a 0d0a 2020 2020  ing(self):..    
-00054640: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
-00054650: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
-00054660: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
-00054670: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
-00054680: 205b 2048 6176 696e 6720 5d20 696e 666f   [ Having ] info
-00054690: 726d 6174 696f 6e22 2c20 4c4f 475f 4c45  rmation", LOG_LE
-000546a0: 5645 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20  VEL_ONLY_LOG).. 
-000546b0: 2020 2020 2020 206e 6578 745f 6964 5f74         next_id_t
-000546c0: 5f68 6176 696e 6720 3d20 7365 6c66 2e6e  _having = self.n
-000546d0: 6578 745f 6964 5f74 5f68 6176 696e 670d  ext_id_t_having.
-000546e0: 0a20 2020 2020 2020 2023 2323 2323 2323  .        #######
-000546f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00054700: 2320 4c4f 4144 2048 4156 494e 4720 2323  # LOAD HAVING ##
-00054710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00054720: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00054730: 6861 7669 6e67 5f6c 6f61 6465 6420 3d20  having_loaded = 
-00054740: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
-00054750: 6861 7669 6e67 2069 6e20 7365 6c66 2e6d  having in self.m
-00054760: 6574 6164 6174 615f 6163 7475 616c 2e65  etadata_actual.e
-00054770: 6e74 7279 5f68 6176 696e 673a 0d0a 2020  ntry_having:..  
-00054780: 2020 2020 2020 2020 2020 6461 7461 7365            datase
-00054790: 7420 3d20 7365 6c66 2e6d 6574 6164 6174  t = self.metadat
-000547a0: 615f 746f 5f6c 6f61 642e 6765 745f 6461  a_to_load.get_da
-000547b0: 7461 7365 745f 6672 6f6d 5f64 6174 6173  taset_from_datas
-000547c0: 6574 5f6e 616d 6528 7365 6c66 2e6d 6574  et_name(self.met
-000547d0: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
-000547e0: 5f74 6162 6c65 5f6e 616d 655f 6672 6f6d  _table_name_from
-000547f0: 5f63 6f64 5f65 6e74 6974 795f 6f6e 5f65  _cod_entity_on_e
-00054800: 6e74 7279 2868 6176 696e 672e 636f 645f  ntry(having.cod_
-00054810: 656e 7469 7479 5f74 6172 6765 7429 290d  entity_target)).
-00054820: 0a20 2020 2020 2020 2020 2020 2069 645f  .            id_
-00054830: 6272 616e 6368 203d 2068 6176 696e 672e  branch = having.
-00054840: 6e75 6d5f 6272 616e 6368 0d0a 2020 2020  num_branch..    
-00054850: 2020 2020 2020 2020 7661 6c75 655f 6861          value_ha
-00054860: 7669 6e67 203d 2068 6176 696e 672e 7661  ving = having.va
-00054870: 6c75 650d 0a0d 0a20 2020 2020 2020 2020  lue....         
-00054880: 2020 2061 6c6c 5f73 6f75 7263 655f 7461     all_source_ta
-00054890: 626c 6573 203d 2073 656c 662e 6d65 7461  bles = self.meta
-000548a0: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
-000548b0: 5f61 6c6c 5f73 6f75 7263 655f 7461 626c  _all_source_tabl
-000548c0: 6573 5f66 726f 6d5f 7461 7267 6574 5f74  es_from_target_t
-000548d0: 6162 6c65 5f6e 616d 6528 0d0a 2020 2020  able_name(..    
-000548e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000548f0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00054900: 2e67 6574 5f74 6162 6c65 5f6e 616d 655f  .get_table_name_
-00054910: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
-00054920: 6f6e 5f65 6e74 7279 2868 6176 696e 672e  on_entry(having.
-00054930: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
-00054940: 7429 290d 0a20 2020 2020 2020 2020 2020  t))..           
-00054950: 2066 6f72 2073 6f75 7263 6520 696e 2061   for source in a
-00054960: 6c6c 5f73 6f75 7263 655f 7461 626c 6573  ll_source_tables
-00054970: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00054980: 2020 2064 6174 6173 6574 5f73 6f75 7263     dataset_sourc
-00054990: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
-000549a0: 615f 746f 5f6c 6f61 642e 6765 745f 6461  a_to_load.get_da
-000549b0: 7461 7365 745f 6672 6f6d 5f64 6174 6173  taset_from_datas
-000549c0: 6574 5f6e 616d 6528 736f 7572 6365 290d  et_name(source).
-000549d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000549e0: 2061 6c6c 5f63 6f6c 756d 6e73 5f66 726f   all_columns_fro
-000549f0: 6d5f 736f 7572 6365 203d 2073 656c 662e  m_source = self.
-00054a00: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
-00054a10: 2e67 6574 5f61 6c6c 5f63 6f6c 756d 6e73  .get_all_columns
-00054a20: 5f66 726f 6d5f 7461 626c 655f 6e61 6d65  _from_table_name
-00054a30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00054a40: 2020 2020 2020 2064 6174 6173 6574 5f73         dataset_s
-00054a50: 6f75 7263 652e 6461 7461 7365 745f 6e61  ource.dataset_na
-00054a60: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00054a70: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
-00054a80: 616c 6c5f 636f 6c75 6d6e 735f 6672 6f6d  all_columns_from
-00054a90: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
-00054aa0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00054ab0: 2072 652e 7365 6172 6368 2872 225c 732b   re.search(r"\s+
-00054ac0: 7c5c 282c 2220 2b20 636f 6c20 2b20 225c  |\(," + col + "\
-00054ad0: 732b 7c5c 297c 2c22 2c20 7661 6c75 655f  s+|\)|,", value_
-00054ae0: 6861 7669 6e67 2920 6f72 2072 652e 7365  having) or re.se
-00054af0: 6172 6368 2872 2228 5e22 202b 2063 6f6c  arch(r"(^" + col
-00054b00: 202b 2022 2429 222c 2076 616c 7565 5f68   + "$)", value_h
-00054b10: 6176 696e 6729 3a0d 0a20 2020 2020 2020  aving):..       
-00054b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054b30: 2064 6174 6173 6574 5f73 7065 635f 736f   dataset_spec_so
-00054b40: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
-00054b50: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
-00054b60: 5f64 6174 6173 6574 5f73 7065 635f 6672  _dataset_spec_fr
-00054b70: 6f6d 5f69 645f 6461 7461 7365 745f 616e  om_id_dataset_an
-00054b80: 645f 636f 6c75 6d6e 5f6e 616d 6528 0d0a  d_column_name(..
-00054b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054ba0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00054bb0: 7365 745f 736f 7572 6365 2e69 645f 6461  set_source.id_da
-00054bc0: 7461 7365 742c 2063 6f6c 290d 0a20 2020  taset, col)..   
-00054bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054be0: 2020 2020 2076 616c 7565 5f68 6176 696e       value_havin
-00054bf0: 6720 3d20 7265 2e73 7562 2863 6f6c 2c20  g = re.sub(col, 
-00054c00: 225b 2220 2b20 7374 7228 6461 7461 7365  "[" + str(datase
-00054c10: 745f 7370 6563 5f73 6f75 7263 652e 6964  t_spec_source.id
-00054c20: 5f64 6174 6173 6574 5f73 7065 6329 202b  _dataset_spec) +
-00054c30: 2022 5d22 2c20 7661 6c75 655f 6861 7669   "]", value_havi
-00054c40: 6e67 290d 0a0d 0a20 2020 2020 2020 2020  ng)....         
-00054c50: 2020 2064 6174 6173 6574 5f74 5f68 6176     dataset_t_hav
-00054c60: 696e 6720 3d20 7365 6c66 2e6d 6574 6164  ing = self.metad
-00054c70: 6174 615f 6163 7475 616c 2e67 6574 5f64  ata_actual.get_d
-00054c80: 6174 6173 6574 5f74 5f68 6176 696e 675f  ataset_t_having_
-00054c90: 6672 6f6d 5f69 645f 6461 7461 7365 745f  from_id_dataset_
-00054ca0: 616e 645f 6964 5f62 7261 6e63 685f 616e  and_id_branch_an
-00054cb0: 645f 7661 6c75 655f 6861 7669 6e67 280d  d_value_having(.
-00054cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054cd0: 2064 6174 6173 6574 2e69 645f 6461 7461   dataset.id_data
-00054ce0: 7365 742c 2069 645f 6272 616e 6368 2c20  set, id_branch, 
-00054cf0: 7661 6c75 655f 6861 7669 6e67 290d 0a0d  value_having)...
-00054d00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00054d10: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
-00054d20: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00054d30: 2020 2020 2020 2020 2020 2069 645f 745f             id_t_
-00054d40: 6861 7669 6e67 203d 206e 6578 745f 6964  having = next_id
-00054d50: 5f74 5f68 6176 696e 670d 0a20 2020 2020  _t_having..     
-00054d60: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-00054d70: 6964 5f74 5f68 6176 696e 6720 2b3d 2031  id_t_having += 1
-00054d80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00054d90: 2020 6e65 775f 6461 7461 7365 745f 745f    new_dataset_t_
-00054da0: 6861 7669 6e67 203d 205b 6964 5f74 5f68  having = [id_t_h
-00054db0: 6176 696e 672c 2064 6174 6173 6574 2e69  aving, dataset.i
-00054dc0: 645f 6461 7461 7365 742c 2069 645f 6272  d_dataset, id_br
-00054dd0: 616e 6368 2c20 7661 6c75 655f 6861 7669  anch, value_havi
-00054de0: 6e67 2c20 7365 6c66 2e6f 776e 6572 2c0d  ng, self.owner,.
-00054df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054e10: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00054e20: 6e6e 6563 7469 6f6e 5f6d 6574 6164 6174  nnection_metadat
-00054e30: 612e 6765 745f 7379 7364 6174 655f 7661  a.get_sysdate_va
-00054e40: 6c75 6528 292c 2022 4e55 4c4c 225d 0d0a  lue(), "NULL"]..
-00054e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054e60: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-00054e70: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
-00054e80: 6173 6574 5f74 5f68 6176 696e 6728 5b6e  aset_t_having([n
-00054e90: 6577 5f64 6174 6173 6574 5f74 5f68 6176  ew_dataset_t_hav
-00054ea0: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
-00054eb0: 2020 2020 2020 2068 6176 696e 675f 6c6f         having_lo
-00054ec0: 6164 6564 2e61 7070 656e 6428 5b64 6174  aded.append([dat
-00054ed0: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
-00054ee0: 2069 645f 6272 616e 6368 2c20 7661 6c75   id_branch, valu
-00054ef0: 655f 6861 7669 6e67 5d29 0d0a 0d0a 2020  e_having])....  
-00054f00: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00054f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054f20: 2069 6620 7661 6c75 655f 6861 7669 6e67   if value_having
-00054f30: 203d 3d20 6461 7461 7365 745f 745f 6861   == dataset_t_ha
-00054f40: 7669 6e67 2e76 616c 7565 5f68 6176 696e  ving.value_havin
-00054f50: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-00054f60: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
-00054f70: 5f68 6176 696e 6720 3d20 5b64 6174 6173  _having = [datas
-00054f80: 6574 5f74 5f68 6176 696e 672e 6964 5f74  et_t_having.id_t
-00054f90: 5f68 6176 696e 672c 2064 6174 6173 6574  _having, dataset
-00054fa0: 5f74 5f68 6176 696e 672e 6964 5f64 6174  _t_having.id_dat
-00054fb0: 6173 6574 2c0d 0a20 2020 2020 2020 2020  aset,..         
-00054fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054fd0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00054fe0: 7461 7365 745f 745f 6861 7669 6e67 2e69  taset_t_having.i
-00054ff0: 645f 6272 616e 6368 2c0d 0a20 2020 2020  d_branch,..     
-00055000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055020: 2020 6461 7461 7365 745f 745f 6861 7669    dataset_t_havi
-00055030: 6e67 2e76 616c 7565 5f68 6176 696e 672c  ng.value_having,
-00055040: 2064 6174 6173 6574 5f74 5f68 6176 696e   dataset_t_havin
-00055050: 672e 6d65 7461 5f6f 776e 6572 2c0d 0a20  g.meta_owner,.. 
-00055060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055080: 2020 2020 2020 2227 2220 2b20 7374 7228        "'" + str(
-00055090: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
-000550a0: 2e73 7461 7274 5f64 6174 6529 202b 2022  .start_date) + "
-000550b0: 2722 2c20 224e 554c 4c22 5d0d 0a20 2020  '", "NULL"]..   
-000550c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000550d0: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
-000550e0: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
-000550f0: 7461 7365 745f 745f 6861 7669 6e67 285b  taset_t_having([
-00055100: 6578 6973 7465 6e74 5f68 6176 696e 675d  existent_having]
-00055110: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00055120: 2020 2020 2020 2068 6176 696e 675f 6c6f         having_lo
-00055130: 6164 6564 2e61 7070 656e 6428 0d0a 2020  aded.append(..  
-00055140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055150: 2020 2020 2020 5b64 6174 6173 6574 5f74        [dataset_t
-00055160: 5f68 6176 696e 672e 6964 5f64 6174 6173  _having.id_datas
-00055170: 6574 2c20 6461 7461 7365 745f 745f 6861  et, dataset_t_ha
-00055180: 7669 6e67 2e69 645f 6272 616e 6368 2c20  ving.id_branch, 
-00055190: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
-000551a0: 2e76 616c 7565 5f68 6176 696e 675d 290d  .value_having]).
-000551b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000551c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000551d0: 2020 2020 2020 2020 2020 2020 6578 6973              exis
-000551e0: 7465 6e74 5f68 6176 696e 6720 3d20 5b64  tent_having = [d
-000551f0: 6174 6173 6574 5f74 5f68 6176 696e 672e  ataset_t_having.
-00055200: 6964 5f74 5f68 6176 696e 672c 2064 6174  id_t_having, dat
-00055210: 6173 6574 5f74 5f68 6176 696e 672e 6964  aset_t_having.id
-00055220: 5f64 6174 6173 6574 2c0d 0a20 2020 2020  _dataset,..     
-00055230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055250: 2020 6461 7461 7365 745f 745f 6861 7669    dataset_t_havi
-00055260: 6e67 2e69 645f 6272 616e 6368 2c0d 0a20  ng.id_branch,.. 
-00055270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055290: 2020 2020 2020 6461 7461 7365 745f 745f        dataset_t_
-000552a0: 6861 7669 6e67 2e76 616c 7565 5f68 6176  having.value_hav
-000552b0: 696e 672c 2064 6174 6173 6574 5f74 5f68  ing, dataset_t_h
-000552c0: 6176 696e 672e 6d65 7461 5f6f 776e 6572  aving.meta_owner
-000552d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000552e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000552f0: 2020 2020 2020 2020 2020 2227 2220 2b20            "'" + 
-00055300: 7374 7228 6461 7461 7365 745f 745f 6861  str(dataset_t_ha
-00055310: 7669 6e67 2e73 7461 7274 5f64 6174 6529  ving.start_date)
-00055320: 202b 2022 2722 2c0d 0a20 2020 2020 2020   + "'",..       
-00055330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055350: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e5f  self.connection_
-00055360: 6d65 7461 6461 7461 2e67 6574 5f73 7973  metadata.get_sys
-00055370: 6461 7465 5f76 616c 7565 2829 5d0d 0a20  date_value()].. 
-00055380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055390: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-000553a0: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-000553b0: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
-000553c0: 285b 6578 6973 7465 6e74 5f68 6176 696e  ([existent_havin
-000553d0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
-000553e0: 2020 2020 2020 2020 2068 6176 696e 675f           having_
-000553f0: 6c6f 6164 6564 2e61 7070 656e 6428 0d0a  loaded.append(..
-00055400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055410: 2020 2020 2020 2020 5b64 6174 6173 6574          [dataset
-00055420: 5f74 5f68 6176 696e 672e 6964 5f64 6174  _t_having.id_dat
-00055430: 6173 6574 2c20 6461 7461 7365 745f 745f  aset, dataset_t_
-00055440: 6861 7669 6e67 2e69 645f 6272 616e 6368  having.id_branch
-00055450: 2c20 6461 7461 7365 745f 745f 6861 7669  , dataset_t_havi
-00055460: 6e67 2e76 616c 7565 5f68 6176 696e 675d  ng.value_having]
-00055470: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00055480: 2020 2020 2020 2020 2069 645f 745f 6861           id_t_ha
-00055490: 7669 6e67 203d 206e 6578 745f 6964 5f74  ving = next_id_t
-000554a0: 5f68 6176 696e 670d 0a20 2020 2020 2020  _having..       
-000554b0: 2020 2020 2020 2020 2020 2020 206e 6578               nex
-000554c0: 745f 6964 5f74 5f68 6176 696e 6720 2b3d  t_id_t_having +=
-000554d0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
-000554e0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-000554f0: 7365 745f 745f 6861 7669 6e67 203d 205b  set_t_having = [
-00055500: 6964 5f74 5f68 6176 696e 672c 2064 6174  id_t_having, dat
-00055510: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
-00055520: 2069 645f 6272 616e 6368 2c20 7661 6c75   id_branch, valu
-00055530: 655f 6861 7669 6e67 2c0d 0a20 2020 2020  e_having,..     
-00055540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055560: 2020 2020 2020 2073 656c 662e 6f77 6e65         self.owne
-00055570: 722c 2073 656c 662e 636f 6e6e 6563 7469  r, self.connecti
-00055580: 6f6e 5f6d 6574 6164 6174 612e 6765 745f  on_metadata.get_
-00055590: 7379 7364 6174 655f 7661 6c75 6528 292c  sysdate_value(),
-000555a0: 2022 4e55 4c4c 225d 0d0a 2020 2020 2020   "NULL"]..      
-000555b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000555c0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-000555d0: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
-000555e0: 6574 5f74 5f68 6176 696e 6728 5b6e 6577  et_t_having([new
-000555f0: 5f64 6174 6173 6574 5f74 5f68 6176 696e  _dataset_t_havin
-00055600: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
-00055610: 2020 2020 2020 2020 2068 6176 696e 675f           having_
-00055620: 6c6f 6164 6564 2e61 7070 656e 6428 5b64  loaded.append([d
-00055630: 6174 6173 6574 2e69 645f 6461 7461 7365  ataset.id_datase
-00055640: 742c 2069 645f 6272 616e 6368 2c20 7661  t, id_branch, va
-00055650: 6c75 655f 6861 7669 6e67 5d29 0d0a 0d0a  lue_having])....
-00055660: 2020 2020 2020 2020 666f 7220 6861 7669          for havi
-00055670: 6e67 2069 6e20 5b78 2066 6f72 2078 2069  ng in [x for x i
-00055680: 6e20 7365 6c66 2e6d 6574 6164 6174 615f  n self.metadata_
-00055690: 6163 7475 616c 2e6f 6d5f 6461 7461 7365  actual.om_datase
-000556a0: 745f 745f 6861 7669 6e67 2069 6620 782e  t_t_having if x.
-000556b0: 656e 645f 6461 7465 2069 7320 4e6f 6e65  end_date is None
-000556c0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-000556d0: 6966 205b 6861 7669 6e67 2e69 645f 6461  if [having.id_da
-000556e0: 7461 7365 742c 2068 6176 696e 672e 6964  taset, having.id
-000556f0: 5f62 7261 6e63 682c 2068 6176 696e 672e  _branch, having.
-00055700: 7661 6c75 655f 6861 7669 6e67 5d20 6e6f  value_having] no
-00055710: 7420 696e 2068 6176 696e 675f 6c6f 6164  t in having_load
-00055720: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00055730: 2020 2020 2063 6c6f 7365 5f68 6176 696e       close_havin
-00055740: 6720 3d20 5b68 6176 696e 672e 6964 5f74  g = [having.id_t
-00055750: 5f68 6176 696e 672c 2068 6176 696e 672e  _having, having.
-00055760: 6964 5f64 6174 6173 6574 2c0d 0a20 2020  id_dataset,..   
-00055770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055780: 2020 2020 2020 2020 2020 2020 2068 6176               hav
-00055790: 696e 672e 6964 5f62 7261 6e63 682c 0d0a  ing.id_branch,..
-000557a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000557b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000557c0: 6861 7669 6e67 2e76 616c 7565 5f68 6176  having.value_hav
-000557d0: 696e 672c 2068 6176 696e 672e 6d65 7461  ing, having.meta
-000557e0: 5f6f 776e 6572 2c0d 0a20 2020 2020 2020  _owner,..       
-000557f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055800: 2020 2020 2020 2020 2022 2722 202b 2073           "'" + s
-00055810: 7472 2868 6176 696e 672e 7374 6172 745f  tr(having.start_
-00055820: 6461 7465 2920 2b20 2227 222c 2073 656c  date) + "'", sel
-00055830: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
-00055840: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
-00055850: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
-00055860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00055870: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
-00055880: 642e 6164 645f 6f6d 5f64 6174 6173 6574  d.add_om_dataset
-00055890: 5f74 5f68 6176 696e 6728 5b63 6c6f 7365  _t_having([close
-000558a0: 5f68 6176 696e 675d 290d 0a0d 0a20 2020  _having])....   
-000558b0: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
-000558c0: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
-000558d0: 6d65 2c20 2246 696e 6973 6865 6420 746f  me, "Finished to
-000558e0: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
-000558f0: 6120 5b20 4861 7669 6e67 205d 2069 6e66  a [ Having ] inf
-00055900: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
-00055910: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
-00055920: 0d0a 2020 2020 6465 6620 7072 6f63 6573  ..    def proces
-00055930: 735f 656c 745f 6869 7374 6f72 6963 616c  s_elt_historical
-00055940: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00055950: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
-00055960: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
-00055970: 2253 7461 7274 696e 6720 746f 2070 726f  "Starting to pro
-00055980: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
-00055990: 4869 7374 6f72 6963 616c 205d 2069 6e66  Historical ] inf
-000559a0: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
-000559b0: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
-000559c0: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
-000559d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000559e0: 2323 204c 4f41 4420 4849 5354 4f52 4943  ## LOAD HISTORIC
-000559f0: 204d 4554 4144 4154 4120 2323 2323 2323   METADATA ######
-00055a00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00055a10: 2323 0d0a 2020 2020 2020 2020 666f 7220  ##..        for 
-00055a20: 7061 7468 2069 6e20 5b78 2066 6f72 2078  path in [x for x
-00055a30: 2069 6e20 7365 6c66 2e6d 6574 6164 6174   in self.metadat
-00055a40: 615f 6163 7475 616c 2e6f 6d5f 6461 7461  a_actual.om_data
-00055a50: 7365 745f 7061 7468 2069 6620 782e 656e  set_path if x.en
-00055a60: 645f 6461 7465 2069 7320 6e6f 7420 4e6f  d_date is not No
-00055a70: 6e65 5d3a 0d0a 2020 2020 2020 2020 2020  ne]:..          
-00055a80: 2020 636c 6f73 655f 7061 7468 203d 205b    close_path = [
-00055a90: 7061 7468 2e69 645f 7061 7468 2c20 7061  path.id_path, pa
-00055aa0: 7468 2e64 6174 6162 6173 655f 6e61 6d65  th.database_name
-00055ab0: 2c20 7061 7468 2e73 6368 656d 615f 6e61  , path.schema_na
-00055ac0: 6d65 2c20 7061 7468 2e6d 6574 615f 6f77  me, path.meta_ow
-00055ad0: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
+00052d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052d80: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00052d90: 655f 6d61 7070 696e 6729 3a0d 0a20 2020  e_mapping):..   
+00052da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052db0: 2064 6174 6173 6574 5f73 7065 635f 736f   dataset_spec_so
+00052dc0: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
+00052dd0: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
+00052de0: 5f64 6174 6173 6574 5f73 7065 635f 6672  _dataset_spec_fr
+00052df0: 6f6d 5f69 645f 6461 7461 7365 745f 616e  om_id_dataset_an
+00052e00: 645f 636f 6c75 6d6e 5f6e 616d 6528 0d0a  d_column_name(..
+00052e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052e20: 2020 2020 2020 2020 6461 7461 7365 745f          dataset_
+00052e30: 736f 7572 6365 2e69 645f 6461 7461 7365  source.id_datase
+00052e40: 742c 2063 6f6c 290d 0a20 2020 2020 2020  t, col)..       
+00052e50: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00052e60: 7565 5f6d 6170 7069 6e67 203d 2072 652e  ue_mapping = re.
+00052e70: 7375 6228 636f 6c2c 2022 5b22 202b 2073  sub(col, "[" + s
+00052e80: 7472 2864 6174 6173 6574 5f73 7065 635f  tr(dataset_spec_
+00052e90: 736f 7572 6365 2e69 645f 6461 7461 7365  source.id_datase
+00052ea0: 745f 7370 6563 2920 2b20 225d 222c 2076  t_spec) + "]", v
+00052eb0: 616c 7565 5f6d 6170 7069 6e67 290d 0a0d  alue_mapping)...
+00052ec0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00052ed0: 6173 6574 5f74 5f6d 6170 7069 6e67 203d  aset_t_mapping =
+00052ee0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+00052ef0: 6374 7561 6c2e 6765 745f 6461 7461 7365  ctual.get_datase
+00052f00: 745f 745f 6d61 7070 696e 675f 6672 6f6d  t_t_mapping_from
+00052f10: 5f69 645f 6272 616e 6368 5f61 6e64 5f69  _id_branch_and_i
+00052f20: 645f 6461 7461 7365 745f 7370 6563 5f61  d_dataset_spec_a
+00052f30: 6e64 5f76 616c 7565 5f6d 6170 7069 6e67  nd_value_mapping
+00052f40: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00052f50: 2020 2069 645f 6272 616e 6368 2c20 6461     id_branch, da
+00052f60: 7461 7365 745f 7370 6563 2e69 645f 6461  taset_spec.id_da
+00052f70: 7461 7365 745f 7370 6563 2c20 7661 6c75  taset_spec, valu
+00052f80: 655f 6d61 7070 696e 6729 0d0a 0d0a 2020  e_mapping)....  
+00052f90: 2020 2020 2020 2020 2020 6966 2064 6174            if dat
+00052fa0: 6173 6574 5f74 5f6d 6170 7069 6e67 2069  aset_t_mapping i
+00052fb0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00052fc0: 2020 2020 2020 2020 2069 645f 745f 6d61           id_t_ma
+00052fd0: 7070 696e 6720 3d20 6e65 7874 5f69 645f  pping = next_id_
+00052fe0: 745f 6d61 7070 696e 670d 0a20 2020 2020  t_mapping..     
+00052ff0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+00053000: 6964 5f74 5f6d 6170 7069 6e67 202b 3d20  id_t_mapping += 
+00053010: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+00053020: 2020 206e 6577 5f64 6174 6173 6574 5f74     new_dataset_t
+00053030: 5f6d 6170 7069 6e67 203d 205b 6964 5f74  _mapping = [id_t
+00053040: 5f6d 6170 7069 6e67 2c20 6964 5f62 7261  _mapping, id_bra
+00053050: 6e63 682c 2064 6174 6173 6574 5f73 7065  nch, dataset_spe
+00053060: 632e 6964 5f64 6174 6173 6574 5f73 7065  c.id_dataset_spe
+00053070: 632c 2076 616c 7565 5f6d 6170 7069 6e67  c, value_mapping
+00053080: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00053090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000530a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000530b0: 2e6f 776e 6572 2c20 7365 6c66 2e63 6f6e  .owner, self.con
+000530c0: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
+000530d0: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
+000530e0: 7565 2829 2c20 224e 554c 4c22 5d0d 0a20  ue(), "NULL"].. 
+000530f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00053100: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+00053110: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+00053120: 7365 745f 745f 6d61 7070 696e 6728 5b6e  set_t_mapping([n
+00053130: 6577 5f64 6174 6173 6574 5f74 5f6d 6170  ew_dataset_t_map
+00053140: 7069 6e67 5d29 0d0a 2020 2020 2020 2020  ping])..        
+00053150: 2020 2020 2020 2020 6d61 7070 696e 675f          mapping_
+00053160: 6c6f 6164 6564 2e61 7070 656e 6428 5b69  loaded.append([i
+00053170: 645f 6272 616e 6368 2c20 6461 7461 7365  d_branch, datase
+00053180: 745f 7370 6563 2e69 645f 6461 7461 7365  t_spec.id_datase
+00053190: 745f 7370 6563 2c20 7661 6c75 655f 6d61  t_spec, value_ma
+000531a0: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+000531b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000531c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000531d0: 2076 616c 7565 5f6d 6170 7069 6e67 203d   value_mapping =
+000531e0: 3d20 6461 7461 7365 745f 745f 6d61 7070  = dataset_t_mapp
+000531f0: 696e 672e 7661 6c75 655f 6d61 7070 696e  ing.value_mappin
+00053200: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+00053210: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
+00053220: 5f6d 6170 7069 6e67 203d 205b 6461 7461  _mapping = [data
+00053230: 7365 745f 745f 6d61 7070 696e 672e 6964  set_t_mapping.id
+00053240: 5f74 5f6d 6170 7069 6e67 2c20 6461 7461  _t_mapping, data
+00053250: 7365 745f 745f 6d61 7070 696e 672e 6964  set_t_mapping.id
+00053260: 5f62 7261 6e63 682c 0d0a 2020 2020 2020  _branch,..      
+00053270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053290: 2020 6461 7461 7365 745f 745f 6d61 7070    dataset_t_mapp
+000532a0: 696e 672e 6964 5f64 6174 6173 6574 5f73  ing.id_dataset_s
+000532b0: 7065 632c 2064 6174 6173 6574 5f74 5f6d  pec, dataset_t_m
+000532c0: 6170 7069 6e67 2e76 616c 7565 5f6d 6170  apping.value_map
+000532d0: 7069 6e67 2c0d 0a20 2020 2020 2020 2020  ping,..         
+000532e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000532f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00053300: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
+00053310: 2e6d 6574 615f 6f77 6e65 722c 2022 2722  .meta_owner, "'"
+00053320: 202b 2073 7472 2864 6174 6173 6574 5f74   + str(dataset_t
+00053330: 5f6d 6170 7069 6e67 2e73 7461 7274 5f64  _mapping.start_d
+00053340: 6174 6529 202b 2022 2722 2c0d 0a20 2020  ate) + "'",..   
+00053350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053370: 2020 2020 2022 4e55 4c4c 225d 0d0a 2020       "NULL"]..  
+00053380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053390: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+000533a0: 746f 5f6c 6f61 642e 6164 645f 6f6d 5f64  to_load.add_om_d
+000533b0: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
+000533c0: 285b 6578 6973 7465 6e74 5f6d 6170 7069  ([existent_mappi
+000533d0: 6e67 5d29 0d0a 2020 2020 2020 2020 2020  ng])..          
+000533e0: 2020 2020 2020 2020 2020 6d61 7070 696e            mappin
+000533f0: 675f 6c6f 6164 6564 2e61 7070 656e 6428  g_loaded.append(
+00053400: 5b64 6174 6173 6574 5f74 5f6d 6170 7069  [dataset_t_mappi
+00053410: 6e67 2e69 645f 6272 616e 6368 2c20 6461  ng.id_branch, da
+00053420: 7461 7365 745f 745f 6d61 7070 696e 672e  taset_t_mapping.
+00053430: 6964 5f64 6174 6173 6574 5f73 7065 632c  id_dataset_spec,
+00053440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00053450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053460: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00053470: 6173 6574 5f74 5f6d 6170 7069 6e67 2e76  aset_t_mapping.v
+00053480: 616c 7565 5f6d 6170 7069 6e67 5d29 0d0a  alue_mapping])..
+00053490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000534a0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000534b0: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+000534c0: 656e 745f 6d61 7070 696e 6720 3d20 5b64  ent_mapping = [d
+000534d0: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
+000534e0: 2e69 645f 745f 6d61 7070 696e 672c 2064  .id_t_mapping, d
+000534f0: 6174 6173 6574 5f74 5f6d 6170 7069 6e67  ataset_t_mapping
+00053500: 2e69 645f 6272 616e 6368 2c0d 0a20 2020  .id_branch,..   
+00053510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053530: 2020 2020 2064 6174 6173 6574 5f74 5f6d       dataset_t_m
+00053540: 6170 7069 6e67 2e69 645f 6461 7461 7365  apping.id_datase
+00053550: 745f 7370 6563 2c20 6461 7461 7365 745f  t_spec, dataset_
+00053560: 745f 6d61 7070 696e 672e 7661 6c75 655f  t_mapping.value_
+00053570: 6d61 7070 696e 672c 0d0a 2020 2020 2020  mapping,..      
+00053580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000535a0: 2020 6461 7461 7365 745f 745f 6d61 7070    dataset_t_mapp
+000535b0: 696e 672e 6d65 7461 5f6f 776e 6572 2c20  ing.meta_owner, 
+000535c0: 2227 2220 2b20 7374 7228 6461 7461 7365  "'" + str(datase
+000535d0: 745f 745f 6d61 7070 696e 672e 7374 6172  t_t_mapping.star
+000535e0: 745f 6461 7465 2920 2b20 2227 222c 0d0a  t_date) + "'",..
+000535f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053610: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00053620: 6e65 6374 696f 6e5f 6d65 7461 6461 7461  nection_metadata
+00053630: 2e67 6574 5f73 7973 6461 7465 5f76 616c  .get_sysdate_val
+00053640: 7565 2829 5d0d 0a20 2020 2020 2020 2020  ue()]..         
+00053650: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00053660: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+00053670: 2e61 6464 5f6f 6d5f 6461 7461 7365 745f  .add_om_dataset_
+00053680: 745f 6d61 7070 696e 6728 5b65 7869 7374  t_mapping([exist
+00053690: 656e 745f 6d61 7070 696e 675d 290d 0a20  ent_mapping]).. 
+000536a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000536b0: 2020 206d 6170 7069 6e67 5f6c 6f61 6465     mapping_loade
+000536c0: 642e 6170 7065 6e64 285b 6461 7461 7365  d.append([datase
+000536d0: 745f 745f 6d61 7070 696e 672e 6964 5f62  t_t_mapping.id_b
+000536e0: 7261 6e63 682c 2064 6174 6173 6574 5f74  ranch, dataset_t
+000536f0: 5f6d 6170 7069 6e67 2e69 645f 6461 7461  _mapping.id_data
+00053700: 7365 745f 7370 6563 2c0d 0a20 2020 2020  set_spec,..     
+00053710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053730: 2020 2020 2020 6461 7461 7365 745f 745f        dataset_t_
+00053740: 6d61 7070 696e 672e 7661 6c75 655f 6d61  mapping.value_ma
+00053750: 7070 696e 675d 290d 0a0d 0a20 2020 2020  pping])....     
+00053760: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00053770: 645f 745f 6d61 7070 696e 6720 3d20 6e65  d_t_mapping = ne
+00053780: 7874 5f69 645f 745f 6d61 7070 696e 670d  xt_id_t_mapping.
+00053790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000537a0: 2020 2020 206e 6578 745f 6964 5f74 5f6d       next_id_t_m
+000537b0: 6170 7069 6e67 202b 3d20 310d 0a20 2020  apping += 1..   
+000537c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000537d0: 206e 6577 5f64 6174 6173 6574 5f74 5f6d   new_dataset_t_m
+000537e0: 6170 7069 6e67 203d 205b 6964 5f74 5f6d  apping = [id_t_m
+000537f0: 6170 7069 6e67 2c20 6964 5f62 7261 6e63  apping, id_branc
+00053800: 682c 2064 6174 6173 6574 5f73 7065 632e  h, dataset_spec.
+00053810: 6964 5f64 6174 6173 6574 5f73 7065 632c  id_dataset_spec,
+00053820: 2076 616c 7565 5f6d 6170 7069 6e67 2c0d   value_mapping,.
+00053830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053850: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00053860: 6c66 2e6f 776e 6572 2c20 7365 6c66 2e63  lf.owner, self.c
+00053870: 6f6e 6e65 6374 696f 6e5f 6d65 7461 6461  onnection_metada
+00053880: 7461 2e67 6574 5f73 7973 6461 7465 5f76  ta.get_sysdate_v
+00053890: 616c 7565 2829 2c20 224e 554c 4c22 5d0d  alue(), "NULL"].
+000538a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000538b0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000538c0: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
+000538d0: 6d5f 6461 7461 7365 745f 745f 6d61 7070  m_dataset_t_mapp
+000538e0: 696e 6728 5b6e 6577 5f64 6174 6173 6574  ing([new_dataset
+000538f0: 5f74 5f6d 6170 7069 6e67 5d29 0d0a 2020  _t_mapping])..  
+00053900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053910: 2020 6d61 7070 696e 675f 6c6f 6164 6564    mapping_loaded
+00053920: 2e61 7070 656e 6428 5b69 645f 6272 616e  .append([id_bran
+00053930: 6368 2c20 6461 7461 7365 745f 7370 6563  ch, dataset_spec
+00053940: 2e69 645f 6461 7461 7365 745f 7370 6563  .id_dataset_spec
+00053950: 2c20 7661 6c75 655f 6d61 7070 696e 675d  , value_mapping]
+00053960: 290d 0a0d 0a20 2020 2020 2020 2066 6f72  )....        for
+00053970: 206d 6170 7069 6e67 2069 6e20 5b78 2066   mapping in [x f
+00053980: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
+00053990: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
+000539a0: 6461 7461 7365 745f 745f 6d61 7070 696e  dataset_t_mappin
+000539b0: 6720 6966 2078 2e65 6e64 5f64 6174 6520  g if x.end_date 
+000539c0: 6973 204e 6f6e 655d 3a0d 0a20 2020 2020  is None]:..     
+000539d0: 2020 2020 2020 2069 6620 5b6d 6170 7069         if [mappi
+000539e0: 6e67 2e69 645f 6272 616e 6368 2c20 6d61  ng.id_branch, ma
+000539f0: 7070 696e 672e 6964 5f64 6174 6173 6574  pping.id_dataset
+00053a00: 5f73 7065 632c 206d 6170 7069 6e67 2e76  _spec, mapping.v
+00053a10: 616c 7565 5f6d 6170 7069 6e67 5d20 6e6f  alue_mapping] no
+00053a20: 7420 696e 206d 6170 7069 6e67 5f6c 6f61  t in mapping_loa
+00053a30: 6465 643a 0d0a 2020 2020 2020 2020 2020  ded:..          
+00053a40: 2020 2020 2020 636c 6f73 655f 6d61 7070        close_mapp
+00053a50: 696e 6720 3d20 5b6d 6170 7069 6e67 2e69  ing = [mapping.i
+00053a60: 645f 745f 6d61 7070 696e 672c 206d 6170  d_t_mapping, map
+00053a70: 7069 6e67 2e69 645f 6272 616e 6368 2c0d  ping.id_branch,.
+00053a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053aa0: 2020 6d61 7070 696e 672e 6964 5f64 6174    mapping.id_dat
+00053ab0: 6173 6574 5f73 7065 632c 206d 6170 7069  aset_spec, mappi
+00053ac0: 6e67 2e76 616c 7565 5f6d 6170 7069 6e67  ng.value_mapping
+00053ad0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00053ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053af0: 2020 2020 6d61 7070 696e 672e 6d65 7461      mapping.meta
+00053b00: 5f6f 776e 6572 2c20 2227 2220 2b20 7374  _owner, "'" + st
+00053b10: 7228 6d61 7070 696e 672e 7374 6172 745f  r(mapping.start_
+00053b20: 6461 7465 2920 2b20 2227 222c 0d0a 2020  date) + "'",..  
+00053b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00053b50: 656c 662e 636f 6e6e 6563 7469 6f6e 5f6d  elf.connection_m
+00053b60: 6574 6164 6174 612e 6765 745f 7379 7364  etadata.get_sysd
+00053b70: 6174 655f 7661 6c75 6528 295d 0d0a 2020  ate_value()]..  
+00053b80: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00053b90: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+00053ba0: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
+00053bb0: 6574 5f74 5f6d 6170 7069 6e67 285b 636c  et_t_mapping([cl
+00053bc0: 6f73 655f 6d61 7070 696e 675d 290d 0a0d  ose_mapping])...
+00053bd0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00053be0: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
+00053bf0: 655f 6e61 6d65 2c20 2246 696e 6973 6865  e_name, "Finishe
+00053c00: 6420 746f 2070 726f 6365 7373 204d 6574  d to process Met
+00053c10: 6164 6174 6120 5b20 4d61 7070 696e 6720  adata [ Mapping 
+00053c20: 5d20 696e 666f 726d 6174 696f 6e22 2c20  ] information", 
+00053c30: 4c4f 475f 4c45 5645 4c5f 4f4e 4c59 5f4c  LOG_LEVEL_ONLY_L
+00053c40: 4f47 290d 0a0d 0a20 2020 2064 6566 2070  OG)....    def p
+00053c50: 726f 6365 7373 5f65 6c74 5f66 696c 7465  rocess_elt_filte
+00053c60: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
+00053c70: 2020 7365 6c66 2e6c 6f67 2e6c 6f67 2873    self.log.log(s
+00053c80: 656c 662e 656e 6769 6e65 5f6e 616d 652c  elf.engine_name,
+00053c90: 2022 5374 6172 7469 6e67 2074 6f20 7072   "Starting to pr
+00053ca0: 6f63 6573 7320 4d65 7461 6461 7461 205b  ocess Metadata [
+00053cb0: 2046 696c 7465 7220 5d20 696e 666f 726d   Filter ] inform
+00053cc0: 6174 696f 6e22 2c20 4c4f 475f 4c45 5645  ation", LOG_LEVE
+00053cd0: 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20 2020  L_ONLY_LOG)..   
+00053ce0: 2020 2020 206e 6578 745f 6964 5f74 5f66       next_id_t_f
+00053cf0: 696c 7465 7220 3d20 7365 6c66 2e6e 6578  ilter = self.nex
+00053d00: 745f 6964 5f74 5f66 696c 7465 720d 0a20  t_id_t_filter.. 
+00053d10: 2020 2020 2020 2023 2323 2323 2323 2323         #########
+00053d20: 2323 2323 2323 2323 2323 2323 2323 2320  ############### 
+00053d30: 4c4f 4144 2046 494c 5445 5220 2323 2323  LOAD FILTER ####
+00053d40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00053d50: 2323 2323 0d0a 2020 2020 2020 2020 6669  ####..        fi
+00053d60: 6c74 6572 5f6c 6f61 6465 6420 3d20 5b5d  lter_loaded = []
+00053d70: 0d0a 2020 2020 2020 2020 666f 7220 6669  ..        for fi
+00053d80: 6c74 6572 2069 6e20 7365 6c66 2e6d 6574  lter in self.met
+00053d90: 6164 6174 615f 6163 7475 616c 2e65 6e74  adata_actual.ent
+00053da0: 7279 5f66 696c 7465 7273 3a0d 0a20 2020  ry_filters:..   
+00053db0: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
+00053dc0: 203d 2073 656c 662e 6d65 7461 6461 7461   = self.metadata
+00053dd0: 5f74 6f5f 6c6f 6164 2e67 6574 5f64 6174  _to_load.get_dat
+00053de0: 6173 6574 5f66 726f 6d5f 6461 7461 7365  aset_from_datase
+00053df0: 745f 6e61 6d65 2873 656c 662e 6d65 7461  t_name(self.meta
+00053e00: 6461 7461 5f61 6374 7561 6c2e 6765 745f  data_actual.get_
+00053e10: 7461 626c 655f 6e61 6d65 5f66 726f 6d5f  table_name_from_
+00053e20: 636f 645f 656e 7469 7479 5f6f 6e5f 656e  cod_entity_on_en
+00053e30: 7472 7928 6669 6c74 6572 2e63 6f64 5f65  try(filter.cod_e
+00053e40: 6e74 6974 795f 7461 7267 6574 2929 0d0a  ntity_target))..
+00053e50: 2020 2020 2020 2020 2020 2020 6964 5f62              id_b
+00053e60: 7261 6e63 6820 3d20 6669 6c74 6572 2e6e  ranch = filter.n
+00053e70: 756d 5f62 7261 6e63 680d 0a20 2020 2020  um_branch..     
+00053e80: 2020 2020 2020 2076 616c 7565 5f6d 6170         value_map
+00053e90: 7069 6e67 203d 2066 696c 7465 722e 7661  ping = filter.va
+00053ea0: 6c75 650d 0a0d 0a20 2020 2020 2020 2020  lue....         
+00053eb0: 2020 2061 6c6c 5f73 6f75 7263 655f 7461     all_source_ta
+00053ec0: 626c 6573 203d 2073 656c 662e 6d65 7461  bles = self.meta
+00053ed0: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
+00053ee0: 5f61 6c6c 5f73 6f75 7263 655f 7461 626c  _all_source_tabl
+00053ef0: 6573 5f66 726f 6d5f 7461 7267 6574 5f74  es_from_target_t
+00053f00: 6162 6c65 5f6e 616d 6528 7365 6c66 2e6d  able_name(self.m
+00053f10: 6574 6164 6174 615f 6163 7475 616c 2e67  etadata_actual.g
+00053f20: 6574 5f74 6162 6c65 5f6e 616d 655f 6672  et_table_name_fr
+00053f30: 6f6d 5f63 6f64 5f65 6e74 6974 795f 6f6e  om_cod_entity_on
+00053f40: 5f65 6e74 7279 2866 696c 7465 722e 636f  _entry(filter.co
+00053f50: 645f 656e 7469 7479 5f74 6172 6765 7429  d_entity_target)
+00053f60: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00053f70: 6f72 2073 6f75 7263 6520 696e 2061 6c6c  or source in all
+00053f80: 5f73 6f75 7263 655f 7461 626c 6573 3a0d  _source_tables:.
+00053f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053fa0: 2064 6174 6173 6574 5f73 6f75 7263 6520   dataset_source 
+00053fb0: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00053fc0: 746f 5f6c 6f61 642e 6765 745f 6461 7461  to_load.get_data
+00053fd0: 7365 745f 6672 6f6d 5f64 6174 6173 6574  set_from_dataset
+00053fe0: 5f6e 616d 6528 736f 7572 6365 290d 0a20  _name(source).. 
+00053ff0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00054000: 6c6c 5f63 6f6c 756d 6e73 5f66 726f 6d5f  ll_columns_from_
+00054010: 736f 7572 6365 203d 2073 656c 662e 6d65  source = self.me
+00054020: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e67  tadata_to_load.g
+00054030: 6574 5f61 6c6c 5f63 6f6c 756d 6e73 5f66  et_all_columns_f
+00054040: 726f 6d5f 7461 626c 655f 6e61 6d65 2864  rom_table_name(d
+00054050: 6174 6173 6574 5f73 6f75 7263 652e 6461  ataset_source.da
+00054060: 7461 7365 745f 6e61 6d65 290d 0a20 2020  taset_name)..   
+00054070: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00054080: 2063 6f6c 2069 6e20 616c 6c5f 636f 6c75   col in all_colu
+00054090: 6d6e 735f 6672 6f6d 5f73 6f75 7263 653a  mns_from_source:
+000540a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000540b0: 2020 2020 2020 6966 2072 652e 7365 6172        if re.sear
+000540c0: 6368 2872 2228 5c73 2b7c 5c28 7c5e 2922  ch(r"(\s+|\(|^)"
+000540d0: 2b63 6f6c 2b22 285c 732b 7c5c 297c 2429  +col+"(\s+|\)|$)
+000540e0: 222c 2076 616c 7565 5f6d 6170 7069 6e67  ", value_mapping
+000540f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00054100: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00054110: 7365 745f 7370 6563 5f73 6f75 7263 6520  set_spec_source 
+00054120: 3d20 7365 6c66 2e6d 6574 6164 6174 615f  = self.metadata_
+00054130: 746f 5f6c 6f61 642e 6765 745f 6461 7461  to_load.get_data
+00054140: 7365 745f 7370 6563 5f66 726f 6d5f 6964  set_spec_from_id
+00054150: 5f64 6174 6173 6574 5f61 6e64 5f63 6f6c  _dataset_and_col
+00054160: 756d 6e5f 6e61 6d65 2864 6174 6173 6574  umn_name(dataset
+00054170: 5f73 6f75 7263 652e 6964 5f64 6174 6173  _source.id_datas
+00054180: 6574 2c20 636f 6c29 0d0a 2020 2020 2020  et, col)..      
+00054190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000541a0: 2020 7661 6c75 655f 6d61 7070 696e 6720    value_mapping 
+000541b0: 3d20 7265 2e73 7562 2863 6f6c 2c20 225b  = re.sub(col, "[
+000541c0: 2220 2b20 7374 7228 6461 7461 7365 745f  " + str(dataset_
+000541d0: 7370 6563 5f73 6f75 7263 652e 6964 5f64  spec_source.id_d
+000541e0: 6174 6173 6574 5f73 7065 6329 202b 2022  ataset_spec) + "
+000541f0: 5d22 2c20 7661 6c75 655f 6d61 7070 696e  ]", value_mappin
+00054200: 6729 0d0a 0d0a 2020 2020 2020 2020 2020  g)....          
+00054210: 2020 6461 7461 7365 745f 745f 6669 6c74    dataset_t_filt
+00054220: 6572 203d 2073 656c 662e 6d65 7461 6461  er = self.metada
+00054230: 7461 5f61 6374 7561 6c2e 6765 745f 6461  ta_actual.get_da
+00054240: 7461 7365 745f 745f 6669 6c74 6572 5f66  taset_t_filter_f
+00054250: 726f 6d5f 6964 5f64 6174 6173 6574 5f61  rom_id_dataset_a
+00054260: 6e64 5f69 645f 6272 616e 6368 5f61 6e64  nd_id_branch_and
+00054270: 5f76 616c 7565 5f66 696c 7465 7228 6461  _value_filter(da
+00054280: 7461 7365 742e 6964 5f64 6174 6173 6574  taset.id_dataset
+00054290: 2c20 6964 5f62 7261 6e63 682c 2076 616c  , id_branch, val
+000542a0: 7565 5f6d 6170 7069 6e67 290d 0a20 2020  ue_mapping)..   
+000542b0: 2020 2020 2020 2020 2069 6620 6461 7461           if data
+000542c0: 7365 745f 745f 6669 6c74 6572 2069 7320  set_t_filter is 
+000542d0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000542e0: 2020 2020 2020 2069 645f 745f 6669 6c74         id_t_filt
+000542f0: 6572 203d 206e 6578 745f 6964 5f74 5f66  er = next_id_t_f
+00054300: 696c 7465 720d 0a20 2020 2020 2020 2020  ilter..         
+00054310: 2020 2020 2020 206e 6578 745f 6964 5f74         next_id_t
+00054320: 5f66 696c 7465 7220 2b3d 2031 0d0a 2020  _filter += 1..  
+00054330: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00054340: 775f 6461 7461 7365 745f 745f 6669 6c74  w_dataset_t_filt
+00054350: 6572 203d 205b 6964 5f74 5f66 696c 7465  er = [id_t_filte
+00054360: 722c 2064 6174 6173 6574 2e69 645f 6461  r, dataset.id_da
+00054370: 7461 7365 742c 2069 645f 6272 616e 6368  taset, id_branch
+00054380: 2c20 7661 6c75 655f 6d61 7070 696e 672c  , value_mapping,
+00054390: 2073 656c 662e 6f77 6e65 722c 0d0a 2020   self.owner,..  
+000543a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000543b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000543c0: 2020 2020 2020 7365 6c66 2e63 6f6e 6e65        self.conne
+000543d0: 6374 696f 6e5f 6d65 7461 6461 7461 2e67  ction_metadata.g
+000543e0: 6574 5f73 7973 6461 7465 5f76 616c 7565  et_sysdate_value
+000543f0: 2829 2c20 224e 554c 4c22 5d0d 0a20 2020  (), "NULL"]..   
+00054400: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00054410: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
+00054420: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
+00054430: 745f 745f 6669 6c74 6572 285b 6e65 775f  t_t_filter([new_
+00054440: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
+00054450: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00054460: 2020 2020 6669 6c74 6572 5f6c 6f61 6465      filter_loade
+00054470: 642e 6170 7065 6e64 285b 6461 7461 7365  d.append([datase
+00054480: 742e 6964 5f64 6174 6173 6574 2c20 6964  t.id_dataset, id
+00054490: 5f62 7261 6e63 682c 2076 616c 7565 5f6d  _branch, value_m
+000544a0: 6170 7069 6e67 5d29 0d0a 0d0a 2020 2020  apping])....    
+000544b0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000544c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000544d0: 6620 7661 6c75 655f 6d61 7070 696e 6720  f value_mapping 
+000544e0: 3d3d 2064 6174 6173 6574 5f74 5f66 696c  == dataset_t_fil
+000544f0: 7465 722e 7661 6c75 655f 6669 6c74 6572  ter.value_filter
+00054500: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00054510: 2020 2020 2020 2065 7869 7374 656e 745f         existent_
+00054520: 6669 6c74 6572 203d 205b 6461 7461 7365  filter = [datase
+00054530: 745f 745f 6669 6c74 6572 2e69 645f 745f  t_t_filter.id_t_
+00054540: 6669 6c74 6572 2c20 6461 7461 7365 745f  filter, dataset_
+00054550: 745f 6669 6c74 6572 2e69 645f 6461 7461  t_filter.id_data
+00054560: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
+00054570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054580: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00054590: 6173 6574 5f74 5f66 696c 7465 722e 6964  aset_t_filter.id
+000545a0: 5f62 7261 6e63 682c 0d0a 2020 2020 2020  _branch,..      
+000545b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000545c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000545d0: 2064 6174 6173 6574 5f74 5f66 696c 7465   dataset_t_filte
+000545e0: 722e 7661 6c75 655f 6669 6c74 6572 2c20  r.value_filter, 
+000545f0: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
+00054600: 2e6d 6574 615f 6f77 6e65 722c 0d0a 2020  .meta_owner,..  
+00054610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054630: 2020 2020 2022 2722 202b 2073 7472 2864       "'" + str(d
+00054640: 6174 6173 6574 5f74 5f66 696c 7465 722e  ataset_t_filter.
+00054650: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
+00054660: 222c 2022 4e55 4c4c 225d 0d0a 2020 2020  ", "NULL"]..    
+00054670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054680: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+00054690: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
+000546a0: 6173 6574 5f74 5f66 696c 7465 7228 5b65  aset_t_filter([e
+000546b0: 7869 7374 656e 745f 6669 6c74 6572 5d29  xistent_filter])
+000546c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000546d0: 2020 2020 2020 6669 6c74 6572 5f6c 6f61        filter_loa
+000546e0: 6465 642e 6170 7065 6e64 280d 0a20 2020  ded.append(..   
+000546f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054700: 2020 2020 205b 6461 7461 7365 745f 745f       [dataset_t_
+00054710: 6669 6c74 6572 2e69 645f 6461 7461 7365  filter.id_datase
+00054720: 742c 2064 6174 6173 6574 5f74 5f66 696c  t, dataset_t_fil
+00054730: 7465 722e 6964 5f62 7261 6e63 682c 2064  ter.id_branch, d
+00054740: 6174 6173 6574 5f74 5f66 696c 7465 722e  ataset_t_filter.
+00054750: 7661 6c75 655f 6669 6c74 6572 5d29 0d0a  value_filter])..
+00054760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054770: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00054780: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+00054790: 656e 745f 6669 6c74 6572 203d 205b 6461  ent_filter = [da
+000547a0: 7461 7365 745f 745f 6669 6c74 6572 2e69  taset_t_filter.i
+000547b0: 645f 745f 6669 6c74 6572 2c20 6461 7461  d_t_filter, data
+000547c0: 7365 745f 745f 6669 6c74 6572 2e69 645f  set_t_filter.id_
+000547d0: 6461 7461 7365 742c 0d0a 2020 2020 2020  dataset,..      
+000547e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000547f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054800: 2064 6174 6173 6574 5f74 5f66 696c 7465   dataset_t_filte
+00054810: 722e 6964 5f62 7261 6e63 682c 0d0a 2020  r.id_branch,..  
+00054820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054840: 2020 2020 2064 6174 6173 6574 5f74 5f66       dataset_t_f
+00054850: 696c 7465 722e 7661 6c75 655f 6669 6c74  ilter.value_filt
+00054860: 6572 2c20 6461 7461 7365 745f 745f 6669  er, dataset_t_fi
+00054870: 6c74 6572 2e6d 6574 615f 6f77 6e65 722c  lter.meta_owner,
+00054880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00054890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000548a0: 2020 2020 2020 2020 2022 2722 202b 2073           "'" + s
+000548b0: 7472 2864 6174 6173 6574 5f74 5f66 696c  tr(dataset_t_fil
+000548c0: 7465 722e 7374 6172 745f 6461 7465 2920  ter.start_date) 
+000548d0: 2b20 2227 222c 0d0a 2020 2020 2020 2020  + "'",..        
+000548e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000548f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00054900: 656c 662e 636f 6e6e 6563 7469 6f6e 5f6d  elf.connection_m
+00054910: 6574 6164 6174 612e 6765 745f 7379 7364  etadata.get_sysd
+00054920: 6174 655f 7661 6c75 6528 295d 0d0a 2020  ate_value()]..  
+00054930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054940: 2020 7365 6c66 2e6d 6574 6164 6174 615f    self.metadata_
+00054950: 746f 5f6c 6f61 642e 6164 645f 6f6d 5f64  to_load.add_om_d
+00054960: 6174 6173 6574 5f74 5f66 696c 7465 7228  ataset_t_filter(
+00054970: 5b65 7869 7374 656e 745f 6669 6c74 6572  [existent_filter
+00054980: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00054990: 2020 2020 2020 2020 6669 6c74 6572 5f6c          filter_l
+000549a0: 6f61 6465 642e 6170 7065 6e64 285b 6461  oaded.append([da
+000549b0: 7461 7365 745f 745f 6669 6c74 6572 2e69  taset_t_filter.i
+000549c0: 645f 6461 7461 7365 742c 2064 6174 6173  d_dataset, datas
+000549d0: 6574 5f74 5f66 696c 7465 722e 6964 5f62  et_t_filter.id_b
+000549e0: 7261 6e63 682c 2064 6174 6173 6574 5f74  ranch, dataset_t
+000549f0: 5f66 696c 7465 722e 7661 6c75 655f 6669  _filter.value_fi
+00054a00: 6c74 6572 5d29 0d0a 0d0a 2020 2020 2020  lter])....      
+00054a10: 2020 2020 2020 2020 2020 2020 2020 6964                id
+00054a20: 5f74 5f66 696c 7465 7220 3d20 6e65 7874  _t_filter = next
+00054a30: 5f69 645f 745f 6669 6c74 6572 0d0a 2020  _id_t_filter..  
+00054a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054a50: 2020 6e65 7874 5f69 645f 745f 6669 6c74    next_id_t_filt
+00054a60: 6572 202b 3d20 310d 0a20 2020 2020 2020  er += 1..       
+00054a70: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00054a80: 5f64 6174 6173 6574 5f74 5f66 696c 7465  _dataset_t_filte
+00054a90: 7220 3d20 5b69 645f 745f 6669 6c74 6572  r = [id_t_filter
+00054aa0: 2c20 6461 7461 7365 742e 6964 5f64 6174  , dataset.id_dat
+00054ab0: 6173 6574 2c20 6964 5f62 7261 6e63 682c  aset, id_branch,
+00054ac0: 2076 616c 7565 5f6d 6170 7069 6e67 2c20   value_mapping, 
+00054ad0: 7365 6c66 2e6f 776e 6572 2c0d 0a20 2020  self.owner,..   
+00054ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054b00: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00054b10: 6e6e 6563 7469 6f6e 5f6d 6574 6164 6174  nnection_metadat
+00054b20: 612e 6765 745f 7379 7364 6174 655f 7661  a.get_sysdate_va
+00054b30: 6c75 6528 292c 2022 4e55 4c4c 225d 0d0a  lue(), "NULL"]..
+00054b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054b50: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00054b60: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
+00054b70: 5f64 6174 6173 6574 5f74 5f66 696c 7465  _dataset_t_filte
+00054b80: 7228 5b6e 6577 5f64 6174 6173 6574 5f74  r([new_dataset_t
+00054b90: 5f66 696c 7465 725d 290d 0a20 2020 2020  _filter])..     
+00054ba0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00054bb0: 696c 7465 725f 6c6f 6164 6564 2e61 7070  ilter_loaded.app
+00054bc0: 656e 6428 5b64 6174 6173 6574 2e69 645f  end([dataset.id_
+00054bd0: 6461 7461 7365 742c 2069 645f 6272 616e  dataset, id_bran
+00054be0: 6368 2c20 7661 6c75 655f 6d61 7070 696e  ch, value_mappin
+00054bf0: 675d 290d 0a0d 0a20 2020 2020 2020 2066  g])....        f
+00054c00: 6f72 2066 696c 7465 7220 696e 205b 7820  or filter in [x 
+00054c10: 666f 7220 7820 696e 2073 656c 662e 6d65  for x in self.me
+00054c20: 7461 6461 7461 5f61 6374 7561 6c2e 6f6d  tadata_actual.om
+00054c30: 5f64 6174 6173 6574 5f74 5f66 696c 7465  _dataset_t_filte
+00054c40: 7220 6966 2078 2e65 6e64 5f64 6174 6520  r if x.end_date 
+00054c50: 6973 204e 6f6e 655d 3a0d 0a20 2020 2020  is None]:..     
+00054c60: 2020 2020 2020 2069 6620 5b66 696c 7465         if [filte
+00054c70: 722e 6964 5f64 6174 6173 6574 2c20 6669  r.id_dataset, fi
+00054c80: 6c74 6572 2e69 645f 6272 616e 6368 2c20  lter.id_branch, 
+00054c90: 6669 6c74 6572 2e76 616c 7565 5f66 696c  filter.value_fil
+00054ca0: 7465 725d 206e 6f74 2069 6e20 6669 6c74  ter] not in filt
+00054cb0: 6572 5f6c 6f61 6465 643a 0d0a 2020 2020  er_loaded:..    
+00054cc0: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
+00054cd0: 655f 6669 6c74 6572 203d 205b 6669 6c74  e_filter = [filt
+00054ce0: 6572 2e69 645f 745f 6669 6c74 6572 2c20  er.id_t_filter, 
+00054cf0: 6669 6c74 6572 2e69 645f 6461 7461 7365  filter.id_datase
+00054d00: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+00054d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054d20: 2020 2020 6669 6c74 6572 2e69 645f 6272      filter.id_br
+00054d30: 616e 6368 2c0d 0a20 2020 2020 2020 2020  anch,..         
+00054d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054d50: 2020 2020 2020 2066 696c 7465 722e 7661         filter.va
+00054d60: 6c75 655f 6669 6c74 6572 2c20 6669 6c74  lue_filter, filt
+00054d70: 6572 2e6d 6574 615f 6f77 6e65 722c 0d0a  er.meta_owner,..
+00054d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054da0: 2227 2220 2b20 7374 7228 6669 6c74 6572  "'" + str(filter
+00054db0: 2e73 7461 7274 5f64 6174 6529 202b 2022  .start_date) + "
+00054dc0: 2722 2c20 7365 6c66 2e63 6f6e 6e65 6374  '", self.connect
+00054dd0: 696f 6e5f 6d65 7461 6461 7461 2e67 6574  ion_metadata.get
+00054de0: 5f73 7973 6461 7465 5f76 616c 7565 2829  _sysdate_value()
+00054df0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00054e00: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00054e10: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+00054e20: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
+00054e30: 285b 636c 6f73 655f 6669 6c74 6572 5d29  ([close_filter])
+00054e40: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00054e50: 2e6c 6f67 2e6c 6f67 2873 656c 662e 656e  .log.log(self.en
+00054e60: 6769 6e65 5f6e 616d 652c 2022 4669 6e69  gine_name, "Fini
+00054e70: 7368 6564 2074 6f20 7072 6f63 6573 7320  shed to process 
+00054e80: 4d65 7461 6461 7461 205b 2046 696c 7465  Metadata [ Filte
+00054e90: 7220 5d20 696e 666f 726d 6174 696f 6e22  r ] information"
+00054ea0: 2c20 4c4f 475f 4c45 5645 4c5f 4f4e 4c59  , LOG_LEVEL_ONLY
+00054eb0: 5f4c 4f47 290d 0a0d 0a20 2020 2064 6566  _LOG)....    def
+00054ec0: 2070 726f 6365 7373 5f65 6c74 5f68 6176   process_elt_hav
+00054ed0: 696e 6728 7365 6c66 293a 0d0a 2020 2020  ing(self):..    
+00054ee0: 2020 2020 7365 6c66 2e6c 6f67 2e6c 6f67      self.log.log
+00054ef0: 2873 656c 662e 656e 6769 6e65 5f6e 616d  (self.engine_nam
+00054f00: 652c 2022 5374 6172 7469 6e67 2074 6f20  e, "Starting to 
+00054f10: 7072 6f63 6573 7320 4d65 7461 6461 7461  process Metadata
+00054f20: 205b 2048 6176 696e 6720 5d20 696e 666f   [ Having ] info
+00054f30: 726d 6174 696f 6e22 2c20 4c4f 475f 4c45  rmation", LOG_LE
+00054f40: 5645 4c5f 4f4e 4c59 5f4c 4f47 290d 0a20  VEL_ONLY_LOG).. 
+00054f50: 2020 2020 2020 206e 6578 745f 6964 5f74         next_id_t
+00054f60: 5f68 6176 696e 6720 3d20 7365 6c66 2e6e  _having = self.n
+00054f70: 6578 745f 6964 5f74 5f68 6176 696e 670d  ext_id_t_having.
+00054f80: 0a20 2020 2020 2020 2023 2323 2323 2323  .        #######
+00054f90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00054fa0: 2320 4c4f 4144 2048 4156 494e 4720 2323  # LOAD HAVING ##
+00054fb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00054fc0: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
+00054fd0: 6861 7669 6e67 5f6c 6f61 6465 6420 3d20  having_loaded = 
+00054fe0: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
+00054ff0: 6861 7669 6e67 2069 6e20 7365 6c66 2e6d  having in self.m
+00055000: 6574 6164 6174 615f 6163 7475 616c 2e65  etadata_actual.e
+00055010: 6e74 7279 5f68 6176 696e 673a 0d0a 2020  ntry_having:..  
+00055020: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+00055030: 7420 3d20 7365 6c66 2e6d 6574 6164 6174  t = self.metadat
+00055040: 615f 746f 5f6c 6f61 642e 6765 745f 6461  a_to_load.get_da
+00055050: 7461 7365 745f 6672 6f6d 5f64 6174 6173  taset_from_datas
+00055060: 6574 5f6e 616d 6528 7365 6c66 2e6d 6574  et_name(self.met
+00055070: 6164 6174 615f 6163 7475 616c 2e67 6574  adata_actual.get
+00055080: 5f74 6162 6c65 5f6e 616d 655f 6672 6f6d  _table_name_from
+00055090: 5f63 6f64 5f65 6e74 6974 795f 6f6e 5f65  _cod_entity_on_e
+000550a0: 6e74 7279 2868 6176 696e 672e 636f 645f  ntry(having.cod_
+000550b0: 656e 7469 7479 5f74 6172 6765 7429 290d  entity_target)).
+000550c0: 0a20 2020 2020 2020 2020 2020 2069 645f  .            id_
+000550d0: 6272 616e 6368 203d 2068 6176 696e 672e  branch = having.
+000550e0: 6e75 6d5f 6272 616e 6368 0d0a 2020 2020  num_branch..    
+000550f0: 2020 2020 2020 2020 7661 6c75 655f 6861          value_ha
+00055100: 7669 6e67 203d 2068 6176 696e 672e 7661  ving = having.va
+00055110: 6c75 650d 0a0d 0a20 2020 2020 2020 2020  lue....         
+00055120: 2020 2061 6c6c 5f73 6f75 7263 655f 7461     all_source_ta
+00055130: 626c 6573 203d 2073 656c 662e 6d65 7461  bles = self.meta
+00055140: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
+00055150: 5f61 6c6c 5f73 6f75 7263 655f 7461 626c  _all_source_tabl
+00055160: 6573 5f66 726f 6d5f 7461 7267 6574 5f74  es_from_target_t
+00055170: 6162 6c65 5f6e 616d 6528 0d0a 2020 2020  able_name(..    
+00055180: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00055190: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+000551a0: 2e67 6574 5f74 6162 6c65 5f6e 616d 655f  .get_table_name_
+000551b0: 6672 6f6d 5f63 6f64 5f65 6e74 6974 795f  from_cod_entity_
+000551c0: 6f6e 5f65 6e74 7279 2868 6176 696e 672e  on_entry(having.
+000551d0: 636f 645f 656e 7469 7479 5f74 6172 6765  cod_entity_targe
+000551e0: 7429 290d 0a20 2020 2020 2020 2020 2020  t))..           
+000551f0: 2066 6f72 2073 6f75 7263 6520 696e 2061   for source in a
+00055200: 6c6c 5f73 6f75 7263 655f 7461 626c 6573  ll_source_tables
+00055210: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00055220: 2020 2064 6174 6173 6574 5f73 6f75 7263     dataset_sourc
+00055230: 6520 3d20 7365 6c66 2e6d 6574 6164 6174  e = self.metadat
+00055240: 615f 746f 5f6c 6f61 642e 6765 745f 6461  a_to_load.get_da
+00055250: 7461 7365 745f 6672 6f6d 5f64 6174 6173  taset_from_datas
+00055260: 6574 5f6e 616d 6528 736f 7572 6365 290d  et_name(source).
+00055270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055280: 2061 6c6c 5f63 6f6c 756d 6e73 5f66 726f   all_columns_fro
+00055290: 6d5f 736f 7572 6365 203d 2073 656c 662e  m_source = self.
+000552a0: 6d65 7461 6461 7461 5f74 6f5f 6c6f 6164  metadata_to_load
+000552b0: 2e67 6574 5f61 6c6c 5f63 6f6c 756d 6e73  .get_all_columns
+000552c0: 5f66 726f 6d5f 7461 626c 655f 6e61 6d65  _from_table_name
+000552d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000552e0: 2020 2020 2020 2064 6174 6173 6574 5f73         dataset_s
+000552f0: 6f75 7263 652e 6461 7461 7365 745f 6e61  ource.dataset_na
+00055300: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
+00055310: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
+00055320: 616c 6c5f 636f 6c75 6d6e 735f 6672 6f6d  all_columns_from
+00055330: 5f73 6f75 7263 653a 0d0a 2020 2020 2020  _source:..      
+00055340: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00055350: 2072 652e 7365 6172 6368 2872 225c 732b   re.search(r"\s+
+00055360: 7c5c 282c 2220 2b20 636f 6c20 2b20 225c  |\(," + col + "\
+00055370: 732b 7c5c 297c 2c22 2c20 7661 6c75 655f  s+|\)|,", value_
+00055380: 6861 7669 6e67 2920 6f72 2072 652e 7365  having) or re.se
+00055390: 6172 6368 2872 2228 5e22 202b 2063 6f6c  arch(r"(^" + col
+000553a0: 202b 2022 2429 222c 2076 616c 7565 5f68   + "$)", value_h
+000553b0: 6176 696e 6729 3a0d 0a20 2020 2020 2020  aving):..       
+000553c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000553d0: 2064 6174 6173 6574 5f73 7065 635f 736f   dataset_spec_so
+000553e0: 7572 6365 203d 2073 656c 662e 6d65 7461  urce = self.meta
+000553f0: 6461 7461 5f74 6f5f 6c6f 6164 2e67 6574  data_to_load.get
+00055400: 5f64 6174 6173 6574 5f73 7065 635f 6672  _dataset_spec_fr
+00055410: 6f6d 5f69 645f 6461 7461 7365 745f 616e  om_id_dataset_an
+00055420: 645f 636f 6c75 6d6e 5f6e 616d 6528 0d0a  d_column_name(..
+00055430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055440: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00055450: 7365 745f 736f 7572 6365 2e69 645f 6461  set_source.id_da
+00055460: 7461 7365 742c 2063 6f6c 290d 0a20 2020  taset, col)..   
+00055470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055480: 2020 2020 2076 616c 7565 5f68 6176 696e       value_havin
+00055490: 6720 3d20 7265 2e73 7562 2863 6f6c 2c20  g = re.sub(col, 
+000554a0: 225b 2220 2b20 7374 7228 6461 7461 7365  "[" + str(datase
+000554b0: 745f 7370 6563 5f73 6f75 7263 652e 6964  t_spec_source.id
+000554c0: 5f64 6174 6173 6574 5f73 7065 6329 202b  _dataset_spec) +
+000554d0: 2022 5d22 2c20 7661 6c75 655f 6861 7669   "]", value_havi
+000554e0: 6e67 290d 0a0d 0a20 2020 2020 2020 2020  ng)....         
+000554f0: 2020 2064 6174 6173 6574 5f74 5f68 6176     dataset_t_hav
+00055500: 696e 6720 3d20 7365 6c66 2e6d 6574 6164  ing = self.metad
+00055510: 6174 615f 6163 7475 616c 2e67 6574 5f64  ata_actual.get_d
+00055520: 6174 6173 6574 5f74 5f68 6176 696e 675f  ataset_t_having_
+00055530: 6672 6f6d 5f69 645f 6461 7461 7365 745f  from_id_dataset_
+00055540: 616e 645f 6964 5f62 7261 6e63 685f 616e  and_id_branch_an
+00055550: 645f 7661 6c75 655f 6861 7669 6e67 280d  d_value_having(.
+00055560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055570: 2064 6174 6173 6574 2e69 645f 6461 7461   dataset.id_data
+00055580: 7365 742c 2069 645f 6272 616e 6368 2c20  set, id_branch, 
+00055590: 7661 6c75 655f 6861 7669 6e67 290d 0a0d  value_having)...
+000555a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000555b0: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
+000555c0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000555d0: 2020 2020 2020 2020 2020 2069 645f 745f             id_t_
+000555e0: 6861 7669 6e67 203d 206e 6578 745f 6964  having = next_id
+000555f0: 5f74 5f68 6176 696e 670d 0a20 2020 2020  _t_having..     
+00055600: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+00055610: 6964 5f74 5f68 6176 696e 6720 2b3d 2031  id_t_having += 1
+00055620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00055630: 2020 6e65 775f 6461 7461 7365 745f 745f    new_dataset_t_
+00055640: 6861 7669 6e67 203d 205b 6964 5f74 5f68  having = [id_t_h
+00055650: 6176 696e 672c 2064 6174 6173 6574 2e69  aving, dataset.i
+00055660: 645f 6461 7461 7365 742c 2069 645f 6272  d_dataset, id_br
+00055670: 616e 6368 2c20 7661 6c75 655f 6861 7669  anch, value_havi
+00055680: 6e67 2c20 7365 6c66 2e6f 776e 6572 2c0d  ng, self.owner,.
+00055690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000556a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000556b0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+000556c0: 6e6e 6563 7469 6f6e 5f6d 6574 6164 6174  nnection_metadat
+000556d0: 612e 6765 745f 7379 7364 6174 655f 7661  a.get_sysdate_va
+000556e0: 6c75 6528 292c 2022 4e55 4c4c 225d 0d0a  lue(), "NULL"]..
+000556f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055700: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+00055710: 5f6c 6f61 642e 6164 645f 6f6d 5f64 6174  _load.add_om_dat
+00055720: 6173 6574 5f74 5f68 6176 696e 6728 5b6e  aset_t_having([n
+00055730: 6577 5f64 6174 6173 6574 5f74 5f68 6176  ew_dataset_t_hav
+00055740: 696e 675d 290d 0a20 2020 2020 2020 2020  ing])..         
+00055750: 2020 2020 2020 2068 6176 696e 675f 6c6f         having_lo
+00055760: 6164 6564 2e61 7070 656e 6428 5b64 6174  aded.append([dat
+00055770: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
+00055780: 2069 645f 6272 616e 6368 2c20 7661 6c75   id_branch, valu
+00055790: 655f 6861 7669 6e67 5d29 0d0a 0d0a 2020  e_having])....  
+000557a0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000557b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000557c0: 2069 6620 7661 6c75 655f 6861 7669 6e67   if value_having
+000557d0: 203d 3d20 6461 7461 7365 745f 745f 6861   == dataset_t_ha
+000557e0: 7669 6e67 2e76 616c 7565 5f68 6176 696e  ving.value_havin
+000557f0: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+00055800: 2020 2020 2020 2020 6578 6973 7465 6e74          existent
+00055810: 5f68 6176 696e 6720 3d20 5b64 6174 6173  _having = [datas
+00055820: 6574 5f74 5f68 6176 696e 672e 6964 5f74  et_t_having.id_t
+00055830: 5f68 6176 696e 672c 2064 6174 6173 6574  _having, dataset
+00055840: 5f74 5f68 6176 696e 672e 6964 5f64 6174  _t_having.id_dat
+00055850: 6173 6574 2c0d 0a20 2020 2020 2020 2020  aset,..         
+00055860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055870: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00055880: 7461 7365 745f 745f 6861 7669 6e67 2e69  taset_t_having.i
+00055890: 645f 6272 616e 6368 2c0d 0a20 2020 2020  d_branch,..     
+000558a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000558b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000558c0: 2020 6461 7461 7365 745f 745f 6861 7669    dataset_t_havi
+000558d0: 6e67 2e76 616c 7565 5f68 6176 696e 672c  ng.value_having,
+000558e0: 2064 6174 6173 6574 5f74 5f68 6176 696e   dataset_t_havin
+000558f0: 672e 6d65 7461 5f6f 776e 6572 2c0d 0a20  g.meta_owner,.. 
+00055900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055920: 2020 2020 2020 2227 2220 2b20 7374 7228        "'" + str(
+00055930: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
+00055940: 2e73 7461 7274 5f64 6174 6529 202b 2022  .start_date) + "
+00055950: 2722 2c20 224e 554c 4c22 5d0d 0a20 2020  '", "NULL"]..   
+00055960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055970: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
+00055980: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
+00055990: 7461 7365 745f 745f 6861 7669 6e67 285b  taset_t_having([
+000559a0: 6578 6973 7465 6e74 5f68 6176 696e 675d  existent_having]
+000559b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000559c0: 2020 2020 2020 2068 6176 696e 675f 6c6f         having_lo
+000559d0: 6164 6564 2e61 7070 656e 6428 0d0a 2020  aded.append(..  
+000559e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000559f0: 2020 2020 2020 5b64 6174 6173 6574 5f74        [dataset_t
+00055a00: 5f68 6176 696e 672e 6964 5f64 6174 6173  _having.id_datas
+00055a10: 6574 2c20 6461 7461 7365 745f 745f 6861  et, dataset_t_ha
+00055a20: 7669 6e67 2e69 645f 6272 616e 6368 2c20  ving.id_branch, 
+00055a30: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
+00055a40: 2e76 616c 7565 5f68 6176 696e 675d 290d  .value_having]).
+00055a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055a60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00055a70: 2020 2020 2020 2020 2020 2020 6578 6973              exis
+00055a80: 7465 6e74 5f68 6176 696e 6720 3d20 5b64  tent_having = [d
+00055a90: 6174 6173 6574 5f74 5f68 6176 696e 672e  ataset_t_having.
+00055aa0: 6964 5f74 5f68 6176 696e 672c 2064 6174  id_t_having, dat
+00055ab0: 6173 6574 5f74 5f68 6176 696e 672e 6964  aset_t_having.id
+00055ac0: 5f64 6174 6173 6574 2c0d 0a20 2020 2020  _dataset,..     
+00055ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00055ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055af0: 2227 2220 2b20 7374 7228 7061 7468 2e73  "'" + str(path.s
-00055b00: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
-00055b10: 2c20 2227 2220 2b20 7374 7228 7061 7468  , "'" + str(path
-00055b20: 2e65 6e64 5f64 6174 6529 202b 2022 2722  .end_date) + "'"
-00055b30: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
-00055b40: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00055b50: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-00055b60: 7365 745f 7061 7468 285b 636c 6f73 655f  set_path([close_
-00055b70: 7061 7468 5d29 0d0a 0d0a 2020 2020 2020  path])....      
-00055b80: 2020 666f 7220 736f 7572 6365 2069 6e20    for source in 
-00055b90: 5b78 2066 6f72 2078 2069 6e20 7365 6c66  [x for x in self
-00055ba0: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
-00055bb0: 2e6f 6d5f 6461 7461 7365 7420 6966 2078  .om_dataset if x
-00055bc0: 2e65 6e64 5f64 6174 6520 6973 206e 6f74  .end_date is not
-00055bd0: 204e 6f6e 655d 3a0d 0a20 2020 2020 2020   None]:..       
-00055be0: 2020 2020 2063 6c6f 7365 5f73 6f75 7263       close_sourc
-00055bf0: 6520 3d20 5b73 6f75 7263 652e 6964 5f64  e = [source.id_d
-00055c00: 6174 6173 6574 2c20 736f 7572 6365 2e64  ataset, source.d
-00055c10: 6174 6173 6574 5f6e 616d 652c 2073 6f75  ataset_name, sou
-00055c20: 7263 652e 6964 5f65 6e74 6974 795f 7479  rce.id_entity_ty
-00055c30: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
-00055c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055c50: 2073 6f75 7263 652e 6964 5f70 6174 682c   source.id_path,
-00055c60: 2073 6f75 7263 652e 6d65 7461 5f6f 776e   source.meta_own
-00055c70: 6572 2c20 2227 2220 2b20 7374 7228 736f  er, "'" + str(so
-00055c80: 7572 6365 2e73 7461 7274 5f64 6174 6529  urce.start_date)
-00055c90: 202b 2022 2722 2c0d 0a20 2020 2020 2020   + "'",..       
+00055af0: 2020 6461 7461 7365 745f 745f 6861 7669    dataset_t_havi
+00055b00: 6e67 2e69 645f 6272 616e 6368 2c0d 0a20  ng.id_branch,.. 
+00055b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055b30: 2020 2020 2020 6461 7461 7365 745f 745f        dataset_t_
+00055b40: 6861 7669 6e67 2e76 616c 7565 5f68 6176  having.value_hav
+00055b50: 696e 672c 2064 6174 6173 6574 5f74 5f68  ing, dataset_t_h
+00055b60: 6176 696e 672e 6d65 7461 5f6f 776e 6572  aving.meta_owner
+00055b70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00055b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055b90: 2020 2020 2020 2020 2020 2227 2220 2b20            "'" + 
+00055ba0: 7374 7228 6461 7461 7365 745f 745f 6861  str(dataset_t_ha
+00055bb0: 7669 6e67 2e73 7461 7274 5f64 6174 6529  ving.start_date)
+00055bc0: 202b 2022 2722 2c0d 0a20 2020 2020 2020   + "'",..       
+00055bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055bf0: 7365 6c66 2e63 6f6e 6e65 6374 696f 6e5f  self.connection_
+00055c00: 6d65 7461 6461 7461 2e67 6574 5f73 7973  metadata.get_sys
+00055c10: 6461 7465 5f76 616c 7565 2829 5d0d 0a20  date_value()].. 
+00055c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055c30: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00055c40: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+00055c50: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
+00055c60: 285b 6578 6973 7465 6e74 5f68 6176 696e  ([existent_havin
+00055c70: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+00055c80: 2020 2020 2020 2020 2068 6176 696e 675f           having_
+00055c90: 6c6f 6164 6564 2e61 7070 656e 6428 0d0a  loaded.append(..
 00055ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055cb0: 2020 2020 2022 2722 202b 2073 7472 2873       "'" + str(s
-00055cc0: 6f75 7263 652e 656e 645f 6461 7465 2920  ource.end_date) 
-00055cd0: 2b20 2227 225d 0d0a 2020 2020 2020 2020  + "'"]..        
-00055ce0: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
-00055cf0: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
-00055d00: 5f64 6174 6173 6574 285b 636c 6f73 655f  _dataset([close_
-00055d10: 736f 7572 6365 5d29 0d0a 0d0a 2020 2020  source])....    
-00055d20: 2020 2020 666f 7220 636c 6f73 6564 5f63      for closed_c
-00055d30: 6f6c 2069 6e20 5b78 2066 6f72 2078 2069  ol in [x for x i
-00055d40: 6e20 7365 6c66 2e6d 6574 6164 6174 615f  n self.metadata_
-00055d50: 6163 7475 616c 2e6f 6d5f 6461 7461 7365  actual.om_datase
-00055d60: 745f 7370 6563 6966 6963 6174 696f 6e20  t_specification 
-00055d70: 6966 2078 2e65 6e64 5f64 6174 6520 6973  if x.end_date is
-00055d80: 206e 6f74 204e 6f6e 655d 3a0d 0a20 2020   not None]:..   
-00055d90: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00055da0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-00055db0: 6464 5f6f 6d5f 6461 7461 7365 745f 7370  dd_om_dataset_sp
-00055dc0: 6563 6966 6963 6174 696f 6e28 5b5b 636c  ecification([[cl
-00055dd0: 6f73 6564 5f63 6f6c 2e69 645f 6461 7461  osed_col.id_data
-00055de0: 7365 745f 7370 6563 2c20 636c 6f73 6564  set_spec, closed
-00055df0: 5f63 6f6c 2e69 645f 6461 7461 7365 742c  _col.id_dataset,
-00055e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00055e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055e40: 2020 2063 6c6f 7365 645f 636f 6c2e 6964     closed_col.id
-00055e50: 5f6b 6579 5f74 7970 652c 2063 6c6f 7365  _key_type, close
-00055e60: 645f 636f 6c2e 636f 6c75 6d6e 5f6e 616d  d_col.column_nam
-00055e70: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00055e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055eb0: 2020 2020 2063 6c6f 7365 645f 636f 6c2e       closed_col.
-00055ec0: 636f 6c75 6d6e 5f74 7970 652c 0d0a 2020  column_type,..  
-00055ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00055f10: 6c6f 7365 645f 636f 6c2e 6f72 6469 6e61  losed_col.ordina
-00055f20: 6c5f 706f 7369 7469 6f6e 2c20 636c 6f73  l_position, clos
-00055f30: 6564 5f63 6f6c 2e69 735f 6e75 6c6c 6162  ed_col.is_nullab
-00055f40: 6c65 2c0d 0a20 2020 2020 2020 2020 2020  le,..           
-00055f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f80: 2020 2020 2020 636c 6f73 6564 5f63 6f6c        closed_col
-00055f90: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
-00055fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00055fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055fe0: 2020 636c 6f73 6564 5f63 6f6c 2e63 6f6c    closed_col.col
-00055ff0: 756d 6e5f 7072 6563 6973 696f 6e2c 2063  umn_precision, c
-00056000: 6c6f 7365 645f 636f 6c2e 636f 6c75 6d6e  losed_col.column
-00056010: 5f73 6361 6c65 2c0d 0a20 2020 2020 2020  _scale,..       
-00056020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055cb0: 2020 2020 2020 2020 5b64 6174 6173 6574          [dataset
+00055cc0: 5f74 5f68 6176 696e 672e 6964 5f64 6174  _t_having.id_dat
+00055cd0: 6173 6574 2c20 6461 7461 7365 745f 745f  aset, dataset_t_
+00055ce0: 6861 7669 6e67 2e69 645f 6272 616e 6368  having.id_branch
+00055cf0: 2c20 6461 7461 7365 745f 745f 6861 7669  , dataset_t_havi
+00055d00: 6e67 2e76 616c 7565 5f68 6176 696e 675d  ng.value_having]
+00055d10: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00055d20: 2020 2020 2020 2020 2069 645f 745f 6861           id_t_ha
+00055d30: 7669 6e67 203d 206e 6578 745f 6964 5f74  ving = next_id_t
+00055d40: 5f68 6176 696e 670d 0a20 2020 2020 2020  _having..       
+00055d50: 2020 2020 2020 2020 2020 2020 206e 6578               nex
+00055d60: 745f 6964 5f74 5f68 6176 696e 6720 2b3d  t_id_t_having +=
+00055d70: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+00055d80: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
+00055d90: 7365 745f 745f 6861 7669 6e67 203d 205b  set_t_having = [
+00055da0: 6964 5f74 5f68 6176 696e 672c 2064 6174  id_t_having, dat
+00055db0: 6173 6574 2e69 645f 6461 7461 7365 742c  aset.id_dataset,
+00055dc0: 2069 645f 6272 616e 6368 2c20 7661 6c75   id_branch, valu
+00055dd0: 655f 6861 7669 6e67 2c0d 0a20 2020 2020  e_having,..     
+00055de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055e00: 2020 2020 2020 2073 656c 662e 6f77 6e65         self.owne
+00055e10: 722c 2073 656c 662e 636f 6e6e 6563 7469  r, self.connecti
+00055e20: 6f6e 5f6d 6574 6164 6174 612e 6765 745f  on_metadata.get_
+00055e30: 7379 7364 6174 655f 7661 6c75 6528 292c  sysdate_value(),
+00055e40: 2022 4e55 4c4c 225d 0d0a 2020 2020 2020   "NULL"]..      
+00055e50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00055e60: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+00055e70: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
+00055e80: 6574 5f74 5f68 6176 696e 6728 5b6e 6577  et_t_having([new
+00055e90: 5f64 6174 6173 6574 5f74 5f68 6176 696e  _dataset_t_havin
+00055ea0: 675d 290d 0a20 2020 2020 2020 2020 2020  g])..           
+00055eb0: 2020 2020 2020 2020 2068 6176 696e 675f           having_
+00055ec0: 6c6f 6164 6564 2e61 7070 656e 6428 5b64  loaded.append([d
+00055ed0: 6174 6173 6574 2e69 645f 6461 7461 7365  ataset.id_datase
+00055ee0: 742c 2069 645f 6272 616e 6368 2c20 7661  t, id_branch, va
+00055ef0: 6c75 655f 6861 7669 6e67 5d29 0d0a 0d0a  lue_having])....
+00055f00: 2020 2020 2020 2020 666f 7220 6861 7669          for havi
+00055f10: 6e67 2069 6e20 5b78 2066 6f72 2078 2069  ng in [x for x i
+00055f20: 6e20 7365 6c66 2e6d 6574 6164 6174 615f  n self.metadata_
+00055f30: 6163 7475 616c 2e6f 6d5f 6461 7461 7365  actual.om_datase
+00055f40: 745f 745f 6861 7669 6e67 2069 6620 782e  t_t_having if x.
+00055f50: 656e 645f 6461 7465 2069 7320 4e6f 6e65  end_date is None
+00055f60: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00055f70: 6966 205b 6861 7669 6e67 2e69 645f 6461  if [having.id_da
+00055f80: 7461 7365 742c 2068 6176 696e 672e 6964  taset, having.id
+00055f90: 5f62 7261 6e63 682c 2068 6176 696e 672e  _branch, having.
+00055fa0: 7661 6c75 655f 6861 7669 6e67 5d20 6e6f  value_having] no
+00055fb0: 7420 696e 2068 6176 696e 675f 6c6f 6164  t in having_load
+00055fc0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+00055fd0: 2020 2020 2063 6c6f 7365 5f68 6176 696e       close_havin
+00055fe0: 6720 3d20 5b68 6176 696e 672e 6964 5f74  g = [having.id_t
+00055ff0: 5f68 6176 696e 672c 2068 6176 696e 672e  _having, having.
+00056000: 6964 5f64 6174 6173 6574 2c0d 0a20 2020  id_dataset,..   
+00056010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056020: 2020 2020 2020 2020 2020 2020 2068 6176               hav
+00056030: 696e 672e 6964 5f62 7261 6e63 682c 0d0a  ing.id_branch,..
 00056040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056050: 2020 2020 2020 2020 2020 636c 6f73 6564            closed
-00056060: 5f63 6f6c 2e6d 6574 615f 6f77 6e65 722c  _col.meta_owner,
-00056070: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00056080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056060: 6861 7669 6e67 2e76 616c 7565 5f68 6176  having.value_hav
+00056070: 696e 672c 2068 6176 696e 672e 6d65 7461  ing, having.meta
+00056080: 5f6f 776e 6572 2c0d 0a20 2020 2020 2020  _owner,..       
 00056090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000560a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000560b0: 2020 2022 2722 202b 2073 7472 2863 6c6f     "'" + str(clo
-000560c0: 7365 645f 636f 6c2e 7374 6172 745f 6461  sed_col.start_da
-000560d0: 7465 2920 2b20 2227 222c 0d0a 2020 2020  te) + "'",..    
-000560e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000560f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056110: 2020 2020 2020 2020 2020 2020 2022 2722               "'"
-00056120: 202b 2073 7472 2863 6c6f 7365 645f 636f   + str(closed_co
-00056130: 6c2e 656e 645f 6461 7465 2920 2b20 2227  l.end_date) + "'
-00056140: 225d 5d29 0d0a 0d0a 2020 2020 2020 2020  "]])....        
-00056150: 666f 7220 6f72 6465 725f 7479 7065 2069  for order_type i
-00056160: 6e20 5b78 2066 6f72 2078 2069 6e20 7365  n [x for x in se
-00056170: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00056180: 616c 2e6f 6d5f 6461 7461 7365 745f 745f  al.om_dataset_t_
-00056190: 6f72 6465 7220 6966 2078 2e65 6e64 5f64  order if x.end_d
-000561a0: 6174 6520 6973 206e 6f74 204e 6f6e 655d  ate is not None]
-000561b0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-000561c0: 6c6f 7365 5f6f 7264 6572 203d 205b 6f72  lose_order = [or
-000561d0: 6465 725f 7479 7065 2e69 645f 745f 6f72  der_type.id_t_or
-000561e0: 6465 722c 206f 7264 6572 5f74 7970 652e  der, order_type.
-000561f0: 6964 5f64 6174 6173 6574 2c20 6f72 6465  id_dataset, orde
-00056200: 725f 7479 7065 2e69 645f 6272 616e 6368  r_type.id_branch
-00056210: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00056220: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00056230: 6465 725f 7479 7065 2e69 645f 6461 7461  der_type.id_data
-00056240: 7365 745f 7370 6563 2c0d 0a20 2020 2020  set_spec,..     
-00056250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056260: 2020 2020 2020 6f72 6465 725f 7479 7065        order_type
-00056270: 2e69 645f 6f72 6465 725f 7479 7065 2c20  .id_order_type, 
-00056280: 6f72 6465 725f 7479 7065 2e6d 6574 615f  order_type.meta_
-00056290: 6f77 6e65 722c 2022 2722 202b 2073 7472  owner, "'" + str
-000562a0: 286f 7264 6572 5f74 7970 652e 7374 6172  (order_type.star
-000562b0: 745f 6461 7465 2920 2b20 2227 222c 0d0a  t_date) + "'",..
-000562c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000562d0: 2020 2020 2020 2020 2020 2022 2722 202b             "'" +
-000562e0: 2073 7472 286f 7264 6572 5f74 7970 652e   str(order_type.
-000562f0: 656e 645f 6461 7465 2920 2b20 2227 225d  end_date) + "'"]
-00056300: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00056310: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-00056320: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
-00056330: 6574 5f74 5f6f 7264 6572 285b 636c 6f73  et_t_order([clos
-00056340: 655f 6f72 6465 725d 290d 0a0d 0a20 2020  e_order])....   
-00056350: 2020 2020 2066 6f72 2072 656c 6174 696f       for relatio
-00056360: 6e73 6869 7020 696e 205b 7820 666f 7220  nship in [x for 
-00056370: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
-00056380: 7461 5f61 6374 7561 6c2e 6f6d 5f64 6174  ta_actual.om_dat
-00056390: 6173 6574 5f72 656c 6174 696f 6e73 6869  aset_relationshi
-000563a0: 7073 2069 6620 782e 656e 645f 6461 7465  ps if x.end_date
-000563b0: 2069 7320 6e6f 7420 4e6f 6e65 5d3a 0d0a   is not None]:..
-000563c0: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
-000563d0: 7265 6c61 7469 6f6e 7368 6970 203d 205b  relationship = [
-000563e0: 7265 6c61 7469 6f6e 7368 6970 2e69 645f  relationship.id_
-000563f0: 7265 6c61 7469 6f6e 7368 6970 2c0d 0a20  relationship,.. 
-00056400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056410: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00056420: 656c 6174 696f 6e73 6869 702e 6964 5f64  elationship.id_d
-00056430: 6174 6173 6574 5f73 7065 635f 6d61 7374  ataset_spec_mast
-00056440: 6572 2c0d 0a20 2020 2020 2020 2020 2020  er,..           
-00056450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056460: 2020 2020 2072 656c 6174 696f 6e73 6869       relationshi
-00056470: 702e 6964 5f64 6174 6173 6574 5f73 7065  p.id_dataset_spe
-00056480: 635f 6465 7461 696c 2c0d 0a20 2020 2020  c_detail,..     
-00056490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000564a0: 2020 2020 2020 2020 2020 2072 656c 6174             relat
-000564b0: 696f 6e73 6869 702e 6964 5f6a 6f69 6e5f  ionship.id_join_
-000564c0: 7479 7065 2c20 7265 6c61 7469 6f6e 7368  type, relationsh
-000564d0: 6970 2e6d 6574 615f 6f77 6e65 722c 0d0a  ip.meta_owner,..
+000560a0: 2020 2020 2020 2020 2022 2722 202b 2073           "'" + s
+000560b0: 7472 2868 6176 696e 672e 7374 6172 745f  tr(having.start_
+000560c0: 6461 7465 2920 2b20 2227 222c 2073 656c  date) + "'", sel
+000560d0: 662e 636f 6e6e 6563 7469 6f6e 5f6d 6574  f.connection_met
+000560e0: 6164 6174 612e 6765 745f 7379 7364 6174  adata.get_sysdat
+000560f0: 655f 7661 6c75 6528 295d 0d0a 2020 2020  e_value()]..    
+00056100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00056110: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
+00056120: 642e 6164 645f 6f6d 5f64 6174 6173 6574  d.add_om_dataset
+00056130: 5f74 5f68 6176 696e 6728 5b63 6c6f 7365  _t_having([close
+00056140: 5f68 6176 696e 675d 290d 0a0d 0a20 2020  _having])....   
+00056150: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
+00056160: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
+00056170: 6d65 2c20 2246 696e 6973 6865 6420 746f  me, "Finished to
+00056180: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
+00056190: 6120 5b20 4861 7669 6e67 205d 2069 6e66  a [ Having ] inf
+000561a0: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
+000561b0: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
+000561c0: 0d0a 2020 2020 6465 6620 7072 6f63 6573  ..    def proces
+000561d0: 735f 656c 745f 6869 7374 6f72 6963 616c  s_elt_historical
+000561e0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+000561f0: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
+00056200: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
+00056210: 2253 7461 7274 696e 6720 746f 2070 726f  "Starting to pro
+00056220: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
+00056230: 4869 7374 6f72 6963 616c 205d 2069 6e66  Historical ] inf
+00056240: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
+00056250: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
+00056260: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
+00056270: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00056280: 2323 204c 4f41 4420 4849 5354 4f52 4943  ## LOAD HISTORIC
+00056290: 204d 4554 4144 4154 4120 2323 2323 2323   METADATA ######
+000562a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000562b0: 2323 0d0a 2020 2020 2020 2020 666f 7220  ##..        for 
+000562c0: 7061 7468 2069 6e20 5b78 2066 6f72 2078  path in [x for x
+000562d0: 2069 6e20 7365 6c66 2e6d 6574 6164 6174   in self.metadat
+000562e0: 615f 6163 7475 616c 2e6f 6d5f 6461 7461  a_actual.om_data
+000562f0: 7365 745f 7061 7468 2069 6620 782e 656e  set_path if x.en
+00056300: 645f 6461 7465 2069 7320 6e6f 7420 4e6f  d_date is not No
+00056310: 6e65 5d3a 0d0a 2020 2020 2020 2020 2020  ne]:..          
+00056320: 2020 636c 6f73 655f 7061 7468 203d 205b    close_path = [
+00056330: 7061 7468 2e69 645f 7061 7468 2c20 7061  path.id_path, pa
+00056340: 7468 2e64 6174 6162 6173 655f 6e61 6d65  th.database_name
+00056350: 2c20 7061 7468 2e73 6368 656d 615f 6e61  , path.schema_na
+00056360: 6d65 2c20 7061 7468 2e6d 6574 615f 6f77  me, path.meta_ow
+00056370: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
+00056380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056390: 2227 2220 2b20 7374 7228 7061 7468 2e73  "'" + str(path.s
+000563a0: 7461 7274 5f64 6174 6529 202b 2022 2722  tart_date) + "'"
+000563b0: 2c20 2227 2220 2b20 7374 7228 7061 7468  , "'" + str(path
+000563c0: 2e65 6e64 5f64 6174 6529 202b 2022 2722  .end_date) + "'"
+000563d0: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+000563e0: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+000563f0: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+00056400: 7365 745f 7061 7468 285b 636c 6f73 655f  set_path([close_
+00056410: 7061 7468 5d29 0d0a 0d0a 2020 2020 2020  path])....      
+00056420: 2020 666f 7220 736f 7572 6365 2069 6e20    for source in 
+00056430: 5b78 2066 6f72 2078 2069 6e20 7365 6c66  [x for x in self
+00056440: 2e6d 6574 6164 6174 615f 6163 7475 616c  .metadata_actual
+00056450: 2e6f 6d5f 6461 7461 7365 7420 6966 2078  .om_dataset if x
+00056460: 2e65 6e64 5f64 6174 6520 6973 206e 6f74  .end_date is not
+00056470: 204e 6f6e 655d 3a0d 0a20 2020 2020 2020   None]:..       
+00056480: 2020 2020 2063 6c6f 7365 5f73 6f75 7263       close_sourc
+00056490: 6520 3d20 5b73 6f75 7263 652e 6964 5f64  e = [source.id_d
+000564a0: 6174 6173 6574 2c20 736f 7572 6365 2e64  ataset, source.d
+000564b0: 6174 6173 6574 5f6e 616d 652c 2073 6f75  ataset_name, sou
+000564c0: 7263 652e 6964 5f65 6e74 6974 795f 7479  rce.id_entity_ty
+000564d0: 7065 2c0d 0a20 2020 2020 2020 2020 2020  pe,..           
 000564e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000564f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056500: 2227 2220 2b20 7374 7228 7265 6c61 7469  "'" + str(relati
-00056510: 6f6e 7368 6970 2e73 7461 7274 5f64 6174  onship.start_dat
-00056520: 6529 202b 2022 2722 2c20 2227 2220 2b20  e) + "'", "'" + 
-00056530: 7374 7228 7265 6c61 7469 6f6e 7368 6970  str(relationship
-00056540: 2e65 6e64 5f64 6174 6529 202b 2022 2722  .end_date) + "'"
-00056550: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
-00056560: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00056570: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
-00056580: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
-00056590: 7328 5b6f 6c64 5f72 656c 6174 696f 6e73  s([old_relations
-000565a0: 6869 705d 290d 0a0d 0a20 2020 2020 2020  hip])....       
-000565b0: 2066 6f72 2061 6767 2069 6e20 5b78 2066   for agg in [x f
-000565c0: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-000565d0: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
-000565e0: 6461 7461 7365 745f 745f 6167 6720 6966  dataset_t_agg if
-000565f0: 2078 2e65 6e64 5f64 6174 6520 6973 206e   x.end_date is n
-00056600: 6f74 204e 6f6e 655d 3a0d 0a20 2020 2020  ot None]:..     
-00056610: 2020 2020 2020 206e 6577 5f61 6767 203d         new_agg =
-00056620: 205b 6167 672e 6964 5f74 5f61 6767 2c20   [agg.id_t_agg, 
-00056630: 6167 672e 6964 5f64 6174 6173 6574 2c20  agg.id_dataset, 
-00056640: 6167 672e 6964 5f62 7261 6e63 682c 0d0a  agg.id_branch,..
-00056650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056660: 2020 2020 2020 2061 6767 2e69 645f 6461         agg.id_da
-00056670: 7461 7365 745f 7370 6563 2c0d 0a20 2020  taset_spec,..   
-00056680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056690: 2020 2020 6167 672e 6d65 7461 5f6f 776e      agg.meta_own
-000566a0: 6572 2c20 2227 2220 2b20 7374 7228 6167  er, "'" + str(ag
-000566b0: 672e 7374 6172 745f 6461 7465 2920 2b20  g.start_date) + 
-000566c0: 2227 222c 2022 2722 202b 2073 7472 2861  "'", "'" + str(a
-000566d0: 6767 2e65 6e64 5f64 6174 6529 202b 2022  gg.end_date) + "
-000566e0: 2722 5d0d 0a20 2020 2020 2020 2020 2020  '"]..           
-000566f0: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
-00056700: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
-00056710: 7461 7365 745f 745f 6167 6728 5b6e 6577  taset_t_agg([new
-00056720: 5f61 6767 5d29 0d0a 0d0a 2020 2020 2020  _agg])....      
-00056730: 2020 666f 7220 6469 7374 696e 6374 2069    for distinct i
-00056740: 6e20 5b78 2066 6f72 2078 2069 6e20 7365  n [x for x in se
-00056750: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
-00056760: 616c 2e6f 6d5f 6461 7461 7365 745f 745f  al.om_dataset_t_
-00056770: 6469 7374 696e 6374 2069 6620 782e 656e  distinct if x.en
-00056780: 645f 6461 7465 2069 7320 6e6f 7420 4e6f  d_date is not No
-00056790: 6e65 5d3a 0d0a 2020 2020 2020 2020 2020  ne]:..          
-000567a0: 2020 636c 6f73 655f 6469 7374 696e 6374    close_distinct
-000567b0: 203d 205b 6469 7374 696e 6374 2e69 645f   = [distinct.id_
-000567c0: 745f 6469 7374 696e 6374 2c20 6469 7374  t_distinct, dist
-000567d0: 696e 6374 2e69 645f 6461 7461 7365 742c  inct.id_dataset,
-000567e0: 2064 6973 7469 6e63 742e 6964 5f62 7261   distinct.id_bra
-000567f0: 6e63 682c 2064 6973 7469 6e63 742e 7377  nch, distinct.sw
-00056800: 5f64 6973 7469 6e63 740d 0a20 2020 2020  _distinct..     
-00056810: 2020 2020 2020 2020 2020 202c 2064 6973             , dis
-00056820: 7469 6e63 742e 6d65 7461 5f6f 776e 6572  tinct.meta_owner
-00056830: 2c20 2227 2220 2b20 7374 7228 6469 7374  , "'" + str(dist
-00056840: 696e 6374 2e73 7461 7274 5f64 6174 6529  inct.start_date)
-00056850: 202b 2022 2722 2c20 2227 2220 2b20 7374   + "'", "'" + st
-00056860: 7228 6469 7374 696e 6374 2e65 6e64 5f64  r(distinct.end_d
-00056870: 6174 6529 202b 2022 2722 5d0d 0a20 2020  ate) + "'"]..   
-00056880: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00056890: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
-000568a0: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
-000568b0: 6469 7374 696e 6374 285b 636c 6f73 655f  distinct([close_
-000568c0: 6469 7374 696e 6374 5d29 0d0a 0d0a 2020  distinct])....  
-000568d0: 2020 2020 2020 666f 7220 6d61 7070 696e        for mappin
-000568e0: 6720 696e 205b 7820 666f 7220 7820 696e  g in [x for x in
-000568f0: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
-00056900: 6374 7561 6c2e 6f6d 5f64 6174 6173 6574  ctual.om_dataset
-00056910: 5f74 5f6d 6170 7069 6e67 2069 6620 782e  _t_mapping if x.
-00056920: 656e 645f 6461 7465 2069 7320 6e6f 7420  end_date is not 
-00056930: 4e6f 6e65 5d3a 0d0a 2020 2020 2020 2020  None]:..        
-00056940: 2020 2020 636c 6f73 655f 6d61 7070 696e      close_mappin
-00056950: 6720 3d20 5b6d 6170 7069 6e67 2e69 645f  g = [mapping.id_
-00056960: 745f 6d61 7070 696e 672c 206d 6170 7069  t_mapping, mappi
-00056970: 6e67 2e69 645f 6272 616e 6368 2c0d 0a20  ng.id_branch,.. 
+000564f0: 2073 6f75 7263 652e 6964 5f70 6174 682c   source.id_path,
+00056500: 2073 6f75 7263 652e 6d65 7461 5f6f 776e   source.meta_own
+00056510: 6572 2c20 2227 2220 2b20 7374 7228 736f  er, "'" + str(so
+00056520: 7572 6365 2e73 7461 7274 5f64 6174 6529  urce.start_date)
+00056530: 202b 2022 2722 2c0d 0a20 2020 2020 2020   + "'",..       
+00056540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056550: 2020 2020 2022 2722 202b 2073 7472 2873       "'" + str(s
+00056560: 6f75 7263 652e 656e 645f 6461 7465 2920  ource.end_date) 
+00056570: 2b20 2227 225d 0d0a 2020 2020 2020 2020  + "'"]..        
+00056580: 2020 2020 7365 6c66 2e6d 6574 6164 6174      self.metadat
+00056590: 615f 746f 5f6c 6f61 642e 6164 645f 6f6d  a_to_load.add_om
+000565a0: 5f64 6174 6173 6574 285b 636c 6f73 655f  _dataset([close_
+000565b0: 736f 7572 6365 5d29 0d0a 0d0a 2020 2020  source])....    
+000565c0: 2020 2020 666f 7220 636c 6f73 6564 5f63      for closed_c
+000565d0: 6f6c 2069 6e20 5b78 2066 6f72 2078 2069  ol in [x for x i
+000565e0: 6e20 7365 6c66 2e6d 6574 6164 6174 615f  n self.metadata_
+000565f0: 6163 7475 616c 2e6f 6d5f 6461 7461 7365  actual.om_datase
+00056600: 745f 7370 6563 6966 6963 6174 696f 6e20  t_specification 
+00056610: 6966 2078 2e65 6e64 5f64 6174 6520 6973  if x.end_date is
+00056620: 206e 6f74 204e 6f6e 655d 3a0d 0a20 2020   not None]:..   
+00056630: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00056640: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+00056650: 6464 5f6f 6d5f 6461 7461 7365 745f 7370  dd_om_dataset_sp
+00056660: 6563 6966 6963 6174 696f 6e28 5b5b 636c  ecification([[cl
+00056670: 6f73 6564 5f63 6f6c 2e69 645f 6461 7461  osed_col.id_data
+00056680: 7365 745f 7370 6563 2c20 636c 6f73 6564  set_spec, closed
+00056690: 5f63 6f6c 2e69 645f 6461 7461 7365 742c  _col.id_dataset,
+000566a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000566b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000566c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000566d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000566e0: 2020 2063 6c6f 7365 645f 636f 6c2e 6964     closed_col.id
+000566f0: 5f6b 6579 5f74 7970 652c 2063 6c6f 7365  _key_type, close
+00056700: 645f 636f 6c2e 636f 6c75 6d6e 5f6e 616d  d_col.column_nam
+00056710: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00056720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056750: 2020 2020 2063 6c6f 7365 645f 636f 6c2e       closed_col.
+00056760: 636f 6c75 6d6e 5f74 7970 652c 0d0a 2020  column_type,..  
+00056770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000567a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000567b0: 6c6f 7365 645f 636f 6c2e 6f72 6469 6e61  losed_col.ordina
+000567c0: 6c5f 706f 7369 7469 6f6e 2c20 636c 6f73  l_position, clos
+000567d0: 6564 5f63 6f6c 2e69 735f 6e75 6c6c 6162  ed_col.is_nullab
+000567e0: 6c65 2c0d 0a20 2020 2020 2020 2020 2020  le,..           
+000567f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056820: 2020 2020 2020 636c 6f73 6564 5f63 6f6c        closed_col
+00056830: 2e63 6f6c 756d 6e5f 6c65 6e67 7468 2c0d  .column_length,.
+00056840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00056850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056880: 2020 636c 6f73 6564 5f63 6f6c 2e63 6f6c    closed_col.col
+00056890: 756d 6e5f 7072 6563 6973 696f 6e2c 2063  umn_precision, c
+000568a0: 6c6f 7365 645f 636f 6c2e 636f 6c75 6d6e  losed_col.column
+000568b0: 5f73 6361 6c65 2c0d 0a20 2020 2020 2020  _scale,..       
+000568c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000568d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000568e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000568f0: 2020 2020 2020 2020 2020 636c 6f73 6564            closed
+00056900: 5f63 6f6c 2e6d 6574 615f 6f77 6e65 722c  _col.meta_owner,
+00056910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00056920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056950: 2020 2022 2722 202b 2073 7472 2863 6c6f     "'" + str(clo
+00056960: 7365 645f 636f 6c2e 7374 6172 745f 6461  sed_col.start_da
+00056970: 7465 2920 2b20 2227 222c 0d0a 2020 2020  te) + "'",..    
 00056980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056990: 2020 2020 2020 2020 2020 2020 6d61 7070              mapp
-000569a0: 696e 672e 6964 5f64 6174 6173 6574 5f73  ing.id_dataset_s
-000569b0: 7065 632c 206d 6170 7069 6e67 2e76 616c  pec, mapping.val
-000569c0: 7565 5f6d 6170 7069 6e67 2c0d 0a20 2020  ue_mapping,..   
-000569d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000569e0: 2020 2020 2020 2020 2020 6d61 7070 696e            mappin
-000569f0: 672e 6d65 7461 5f6f 776e 6572 2c20 2227  g.meta_owner, "'
-00056a00: 2220 2b20 7374 7228 6d61 7070 696e 672e  " + str(mapping.
-00056a10: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
-00056a20: 222c 2022 2722 202b 2073 7472 286d 6170  ", "'" + str(map
-00056a30: 7069 6e67 2e65 6e64 5f64 6174 6529 202b  ping.end_date) +
-00056a40: 2022 2722 5d0d 0a20 2020 2020 2020 2020   "'"]..         
-00056a50: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
-00056a60: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
-00056a70: 6461 7461 7365 745f 745f 6d61 7070 696e  dataset_t_mappin
-00056a80: 6728 5b63 6c6f 7365 5f6d 6170 7069 6e67  g([close_mapping
-00056a90: 5d29 0d0a 0d0a 2020 2020 2020 2020 666f  ])....        fo
-00056aa0: 7220 6669 6c74 6572 2069 6e20 5b78 2066  r filter in [x f
-00056ab0: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-00056ac0: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
-00056ad0: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
-00056ae0: 2069 6620 782e 656e 645f 6461 7465 2069   if x.end_date i
-00056af0: 7320 6e6f 7420 4e6f 6e65 5d3a 0d0a 2020  s not None]:..  
-00056b00: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
-00056b10: 6669 6c74 6572 203d 205b 6669 6c74 6572  filter = [filter
-00056b20: 2e69 645f 745f 6669 6c74 6572 2c20 6669  .id_t_filter, fi
-00056b30: 6c74 6572 2e69 645f 6461 7461 7365 742c  lter.id_dataset,
-00056b40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00056b50: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00056b60: 6c74 6572 2e69 645f 6272 616e 6368 2c0d  lter.id_branch,.
-00056b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00056b80: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00056b90: 7465 722e 7661 6c75 655f 6669 6c74 6572  ter.value_filter
-00056ba0: 2c20 6669 6c74 6572 2e6d 6574 615f 6f77  , filter.meta_ow
-00056bb0: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
-00056bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056bd0: 2020 2227 2220 2b20 7374 7228 6669 6c74    "'" + str(filt
-00056be0: 6572 2e73 7461 7274 5f64 6174 6529 202b  er.start_date) +
-00056bf0: 2022 2722 2c20 2227 2220 2b20 7374 7228   "'", "'" + str(
-00056c00: 6669 6c74 6572 2e65 6e64 5f64 6174 6529  filter.end_date)
-00056c10: 202b 2022 2722 5d0d 0a20 2020 2020 2020   + "'"]..       
-00056c20: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00056c30: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
-00056c40: 6d5f 6461 7461 7365 745f 745f 6669 6c74  m_dataset_t_filt
-00056c50: 6572 285b 636c 6f73 655f 6669 6c74 6572  er([close_filter
-00056c60: 5d29 0d0a 0d0a 2020 2020 2020 2020 666f  ])....        fo
-00056c70: 7220 6861 7669 6e67 2069 6e20 5b78 2066  r having in [x f
-00056c80: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-00056c90: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
-00056ca0: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
-00056cb0: 2069 6620 782e 656e 645f 6461 7465 2069   if x.end_date i
-00056cc0: 7320 6e6f 7420 4e6f 6e65 5d3a 0d0a 2020  s not None]:..  
-00056cd0: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
-00056ce0: 6861 7669 6e67 203d 205b 6861 7669 6e67  having = [having
-00056cf0: 2e69 645f 745f 6861 7669 6e67 2c20 6861  .id_t_having, ha
-00056d00: 7669 6e67 2e69 645f 6461 7461 7365 742c  ving.id_dataset,
-00056d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00056d20: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00056d30: 7669 6e67 2e69 645f 6272 616e 6368 2c0d  ving.id_branch,.
-00056d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00056d50: 2020 2020 2020 2020 2020 2020 2068 6176               hav
-00056d60: 696e 672e 7661 6c75 655f 6861 7669 6e67  ing.value_having
-00056d70: 2c20 6861 7669 6e67 2e6d 6574 615f 6f77  , having.meta_ow
-00056d80: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
+00056990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000569a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000569b0: 2020 2020 2020 2020 2020 2020 2022 2722               "'"
+000569c0: 202b 2073 7472 2863 6c6f 7365 645f 636f   + str(closed_co
+000569d0: 6c2e 656e 645f 6461 7465 2920 2b20 2227  l.end_date) + "'
+000569e0: 225d 5d29 0d0a 0d0a 2020 2020 2020 2020  "]])....        
+000569f0: 666f 7220 6f72 6465 725f 7479 7065 2069  for order_type i
+00056a00: 6e20 5b78 2066 6f72 2078 2069 6e20 7365  n [x for x in se
+00056a10: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00056a20: 616c 2e6f 6d5f 6461 7461 7365 745f 745f  al.om_dataset_t_
+00056a30: 6f72 6465 7220 6966 2078 2e65 6e64 5f64  order if x.end_d
+00056a40: 6174 6520 6973 206e 6f74 204e 6f6e 655d  ate is not None]
+00056a50: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
+00056a60: 6c6f 7365 5f6f 7264 6572 203d 205b 6f72  lose_order = [or
+00056a70: 6465 725f 7479 7065 2e69 645f 745f 6f72  der_type.id_t_or
+00056a80: 6465 722c 206f 7264 6572 5f74 7970 652e  der, order_type.
+00056a90: 6964 5f64 6174 6173 6574 2c20 6f72 6465  id_dataset, orde
+00056aa0: 725f 7479 7065 2e69 645f 6272 616e 6368  r_type.id_branch
+00056ab0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00056ac0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00056ad0: 6465 725f 7479 7065 2e69 645f 6461 7461  der_type.id_data
+00056ae0: 7365 745f 7370 6563 2c0d 0a20 2020 2020  set_spec,..     
+00056af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056b00: 2020 2020 2020 6f72 6465 725f 7479 7065        order_type
+00056b10: 2e69 645f 6f72 6465 725f 7479 7065 2c20  .id_order_type, 
+00056b20: 6f72 6465 725f 7479 7065 2e6d 6574 615f  order_type.meta_
+00056b30: 6f77 6e65 722c 2022 2722 202b 2073 7472  owner, "'" + str
+00056b40: 286f 7264 6572 5f74 7970 652e 7374 6172  (order_type.star
+00056b50: 745f 6461 7465 2920 2b20 2227 222c 0d0a  t_date) + "'",..
+00056b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056b70: 2020 2020 2020 2020 2020 2022 2722 202b             "'" +
+00056b80: 2073 7472 286f 7264 6572 5f74 7970 652e   str(order_type.
+00056b90: 656e 645f 6461 7465 2920 2b20 2227 225d  end_date) + "'"]
+00056ba0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00056bb0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+00056bc0: 6f61 642e 6164 645f 6f6d 5f64 6174 6173  oad.add_om_datas
+00056bd0: 6574 5f74 5f6f 7264 6572 285b 636c 6f73  et_t_order([clos
+00056be0: 655f 6f72 6465 725d 290d 0a0d 0a20 2020  e_order])....   
+00056bf0: 2020 2020 2066 6f72 2072 656c 6174 696f       for relatio
+00056c00: 6e73 6869 7020 696e 205b 7820 666f 7220  nship in [x for 
+00056c10: 7820 696e 2073 656c 662e 6d65 7461 6461  x in self.metada
+00056c20: 7461 5f61 6374 7561 6c2e 6f6d 5f64 6174  ta_actual.om_dat
+00056c30: 6173 6574 5f72 656c 6174 696f 6e73 6869  aset_relationshi
+00056c40: 7073 2069 6620 782e 656e 645f 6461 7465  ps if x.end_date
+00056c50: 2069 7320 6e6f 7420 4e6f 6e65 5d3a 0d0a   is not None]:..
+00056c60: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
+00056c70: 7265 6c61 7469 6f6e 7368 6970 203d 205b  relationship = [
+00056c80: 7265 6c61 7469 6f6e 7368 6970 2e69 645f  relationship.id_
+00056c90: 7265 6c61 7469 6f6e 7368 6970 2c0d 0a20  relationship,.. 
+00056ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056cb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00056cc0: 656c 6174 696f 6e73 6869 702e 6964 5f64  elationship.id_d
+00056cd0: 6174 6173 6574 5f73 7065 635f 6d61 7374  ataset_spec_mast
+00056ce0: 6572 2c0d 0a20 2020 2020 2020 2020 2020  er,..           
+00056cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056d00: 2020 2020 2072 656c 6174 696f 6e73 6869       relationshi
+00056d10: 702e 6964 5f64 6174 6173 6574 5f73 7065  p.id_dataset_spe
+00056d20: 635f 6465 7461 696c 2c0d 0a20 2020 2020  c_detail,..     
+00056d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056d40: 2020 2020 2020 2020 2020 2072 656c 6174             relat
+00056d50: 696f 6e73 6869 702e 6964 5f6a 6f69 6e5f  ionship.id_join_
+00056d60: 7479 7065 2c20 7265 6c61 7469 6f6e 7368  type, relationsh
+00056d70: 6970 2e6d 6574 615f 6f77 6e65 722c 0d0a  ip.meta_owner,..
+00056d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00056d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056da0: 2020 2227 2220 2b20 7374 7228 6861 7669    "'" + str(havi
-00056db0: 6e67 2e73 7461 7274 5f64 6174 6529 202b  ng.start_date) +
-00056dc0: 2022 2722 2c20 2227 2220 2b20 7374 7228   "'", "'" + str(
-00056dd0: 6861 7669 6e67 2e65 6e64 5f64 6174 6529  having.end_date)
-00056de0: 202b 2022 2722 5d0d 0a20 2020 2020 2020   + "'"]..       
-00056df0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
-00056e00: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
-00056e10: 6d5f 6461 7461 7365 745f 745f 6861 7669  m_dataset_t_havi
-00056e20: 6e67 285b 636c 6f73 655f 6861 7669 6e67  ng([close_having
-00056e30: 5d29 0d0a 0d0a 2020 2020 2020 2020 666f  ])....        fo
-00056e40: 7220 6578 6563 7574 696f 6e20 696e 205b  r execution in [
-00056e50: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
-00056e60: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
-00056e70: 6f6d 5f64 6174 6173 6574 5f65 7865 6375  om_dataset_execu
-00056e80: 7469 6f6e 2069 6620 782e 656e 645f 6461  tion if x.end_da
-00056e90: 7465 2069 7320 6e6f 7420 4e6f 6e65 5d3a  te is not None]:
-00056ea0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00056eb0: 636c 6f73 655f 6578 6563 7574 696f 6e20  close_execution 
-00056ec0: 3d20 5b65 7865 6375 7469 6f6e 2e69 645f  = [execution.id_
-00056ed0: 6461 7461 7365 742c 2065 7865 6375 7469  dataset, executi
-00056ee0: 6f6e 2e69 645f 7175 6572 795f 7479 7065  on.id_query_type
-00056ef0: 2c20 6578 6563 7574 696f 6e2e 6d65 7461  , execution.meta
-00056f00: 5f6f 776e 6572 2c0d 0a20 2020 2020 2020  _owner,..       
-00056f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056f20: 2020 2020 2020 2020 2227 2220 2b73 7472          "'" +str
-00056f30: 2865 7865 6375 7469 6f6e 2e73 7461 7274  (execution.start
-00056f40: 5f64 6174 6529 2b20 2227 222c 2022 2722  _date)+ "'", "'"
-00056f50: 202b 7374 7228 6578 6563 7574 696f 6e2e   +str(execution.
-00056f60: 656e 645f 6461 7465 292b 2022 2722 5d0d  end_date)+ "'"].
-00056f70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00056f80: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
-00056f90: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
-00056fa0: 745f 6578 6563 7574 696f 6e28 5b63 6c6f  t_execution([clo
-00056fb0: 7365 5f65 7865 6375 7469 6f6e 5d29 0d0a  se_execution])..
-00056fc0: 0d0a 2020 2020 2020 2020 666f 7220 6461  ..        for da
-00056fd0: 7461 7365 745f 6476 2069 6e20 5b78 2066  taset_dv in [x f
-00056fe0: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
-00056ff0: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
-00057000: 6461 7461 7365 745f 6476 2069 6620 782e  dataset_dv if x.
-00057010: 656e 645f 6461 7465 2069 7320 6e6f 7420  end_date is not 
-00057020: 4e6f 6e65 5d3a 0d0a 0d0a 2020 2020 2020  None]:....      
-00057030: 2020 2020 2020 636c 6f73 655f 6461 7461        close_data
-00057040: 7365 745f 6476 203d 205b 6461 7461 7365  set_dv = [datase
-00057050: 745f 6476 2e69 645f 6461 7461 7365 742c  t_dv.id_dataset,
-00057060: 2064 6174 6173 6574 5f64 762e 6964 5f65   dataset_dv.id_e
-00057070: 6e74 6974 795f 7479 7065 2c20 6461 7461  ntity_type, data
-00057080: 7365 745f 6476 2e6d 6574 615f 6f77 6e65  set_dv.meta_owne
-00057090: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-000570a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000570b0: 2020 2022 2722 202b 7374 7228 6461 7461     "'" +str(data
-000570c0: 7365 745f 6476 2e73 7461 7274 5f64 6174  set_dv.start_dat
-000570d0: 6529 2b20 2227 222c 2022 2722 202b 7374  e)+ "'", "'" +st
-000570e0: 7228 6461 7461 7365 745f 6476 2e65 6e64  r(dataset_dv.end
-000570f0: 5f64 6174 6529 2b20 2227 225d 0d0a 2020  _date)+ "'"]..  
-00057100: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00057110: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
-00057120: 6164 645f 6f6d 5f64 6174 6173 6574 5f64  add_om_dataset_d
-00057130: 7628 5b63 6c6f 7365 5f64 6174 6173 6574  v([close_dataset
-00057140: 5f64 765d 290d 0a0d 0a20 2020 2020 2020  _dv])....       
-00057150: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
-00057160: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
-00057170: 2246 696e 6973 6865 6420 746f 2070 726f  "Finished to pro
-00057180: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
-00057190: 4869 7374 6f72 6963 616c 205d 2069 6e66  Historical ] inf
-000571a0: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
-000571b0: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
-000571c0: 0d0a 2020 2020 6465 6620 7072 6f63 6573  ..    def proces
-000571d0: 735f 6476 2873 656c 6629 3a0d 0a20 2020  s_dv(self):..   
-000571e0: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
-000571f0: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
-00057200: 6d65 2c20 2253 7461 7274 696e 6720 746f  me, "Starting to
-00057210: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
-00057220: 6120 6672 6f6d 2044 5620 4d6f 6475 6c65  a from DV Module
-00057230: 222c 204c 4f47 5f4c 4556 454c 5f49 4e46  ", LOG_LEVEL_INF
-00057240: 4f29 0d0a 0d0a 2020 2020 2020 2020 7365  O)....        se
-00057250: 6c66 2e70 726f 6365 7373 5f64 765f 6875  lf.process_dv_hu
-00057260: 6228 290d 0a20 2020 2020 2020 2073 656c  b()..        sel
-00057270: 662e 7072 6f63 6573 735f 6476 5f6c 696e  f.process_dv_lin
-00057280: 6b28 290d 0a0d 0a20 2020 2020 2020 2073  k()....        s
-00057290: 656c 662e 6c6f 672e 6c6f 6728 7365 6c66  elf.log.log(self
-000572a0: 2e65 6e67 696e 655f 6e61 6d65 2c20 2246  .engine_name, "F
-000572b0: 696e 6973 6865 6420 746f 2070 726f 6365  inished to proce
-000572c0: 7373 204d 6574 6164 6174 6120 6672 6f6d  ss Metadata from
-000572d0: 2044 5620 4d6f 6475 6c65 222c 204c 4f47   DV Module", LOG
-000572e0: 5f4c 4556 454c 5f49 4e46 4f29 0d0a 0d0a  _LEVEL_INFO)....
-000572f0: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
-00057300: 6476 5f66 696e 616c 2873 656c 6629 3a0d  dv_final(self):.
-00057310: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00057320: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
-00057330: 655f 6e61 6d65 2c20 2253 7461 7274 696e  e_name, "Startin
-00057340: 6720 746f 2070 726f 6365 7373 204d 6574  g to process Met
-00057350: 6164 6174 6120 4456 205b 2065 6e64 2070  adata DV [ end p
-00057360: 6861 7365 205d 222c 204c 4f47 5f4c 4556  hase ]", LOG_LEV
-00057370: 454c 5f49 4e46 4f29 0d0a 0d0a 2020 2020  EL_INFO)....    
-00057380: 2020 2020 7365 6c66 2e70 726f 6365 7373      self.process
-00057390: 5f64 765f 7072 6f70 6572 7469 6573 2829  _dv_properties()
-000573a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000573b0: 2e6c 6f67 2e6c 6f67 2873 656c 662e 656e  .log.log(self.en
-000573c0: 6769 6e65 5f6e 616d 652c 2022 4669 6e69  gine_name, "Fini
-000573d0: 7368 6564 2074 6f20 7072 6f63 6573 7320  shed to process 
-000573e0: 4d65 7461 6461 7461 2044 5620 5b20 656e  Metadata DV [ en
-000573f0: 6420 7068 6173 6520 5d22 2c20 4c4f 475f  d phase ]", LOG_
-00057400: 4c45 5645 4c5f 494e 464f 290d 0a0d 0a20  LEVEL_INFO).... 
-00057410: 2020 2064 6566 2075 706c 6f61 645f 6d65     def upload_me
-00057420: 7461 6461 7461 2873 656c 6629 3a0d 0a20  tadata(self):.. 
-00057430: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
-00057440: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
-00057450: 6e61 6d65 2c20 2253 7461 7274 696e 6720  name, "Starting 
-00057460: 746f 2075 706c 6f61 6420 616c 6c20 7468  to upload all th
-00057470: 6520 6d65 7461 6461 7461 2070 726f 6365  e metadata proce
-00057480: 7373 6564 222c 204c 4f47 5f4c 4556 454c  ssed", LOG_LEVEL
-00057490: 5f49 4e46 4f29 0d0a 0d0a 2020 2020 2020  _INFO)....      
-000574a0: 2020 636f 6e6e 6563 7469 6f6e 5f74 7970    connection_typ
-000574b0: 6520 3d20 7365 6c66 2e63 6f6e 6669 6775  e = self.configu
-000574c0: 7261 7469 6f6e 5f66 696c 655b 276d 6574  ration_file['met
-000574d0: 6164 6174 6127 5d5b 2763 6f6e 6e65 6374  adata']['connect
-000574e0: 696f 6e5f 7479 7065 275d 0d0a 2020 2020  ion_type']..    
-000574f0: 2020 2020 636f 6e6e 6563 7469 6f6e 203d      connection =
-00057500: 2043 6f6e 6e65 6374 696f 6e46 6163 746f   ConnectionFacto
-00057510: 7279 2829 2e67 6574 5f63 6f6e 6e65 6374  ry().get_connect
-00057520: 696f 6e28 636f 6e6e 6563 7469 6f6e 5f74  ion(connection_t
-00057530: 7970 6529 0d0a 2020 2020 2020 2020 636f  ype)..        co
-00057540: 6e6e 6563 7469 6f6e 2e73 6574 7570 5f63  nnection.setup_c
-00057550: 6f6e 6e65 6374 696f 6e28 7365 6c66 2e63  onnection(self.c
-00057560: 6f6e 6669 6775 7261 7469 6f6e 5f66 696c  onfiguration_fil
-00057570: 655b 276d 6574 6164 6174 6127 5d2c 2073  e['metadata'], s
-00057580: 656c 662e 6c6f 6729 0d0a 2020 2020 2020  elf.log)..      
-00057590: 2020 7768 6572 655f 6669 6c74 6572 5f6f    where_filter_o
-000575a0: 776e 6572 203d 2022 4d45 5441 5f4f 574e  wner = "META_OWN
-000575b0: 4552 3d27 2220 2b20 7365 6c66 2e6f 776e  ER='" + self.own
-000575c0: 6572 202b 2022 2722 0d0a 2020 2020 2020  er + "'"..      
-000575d0: 2020 636f 6d6d 6974 5f76 616c 7565 735f    commit_values_
-000575e0: 6261 7463 6820 3d20 7365 6c66 2e70 726f  batch = self.pro
-000575f0: 7065 7274 6965 735f 6669 6c65 5b27 6f70  perties_file['op
-00057600: 7469 6f6e 7327 5d5b 276d 6178 5f63 6f6d  tions']['max_com
-00057610: 6d69 745f 6261 7463 6827 5d0d 0a0d 0a20  mit_batch'].... 
-00057620: 2020 2020 2020 2023 204f 4d5f 4441 5441         # OM_DATA
-00057630: 5345 545f 5041 5448 0d0a 2020 2020 2020  SET_PATH..      
-00057640: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
-00057650: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057660: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
-00057670: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
-00057680: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00057690: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
-000576a0: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
-000576b0: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
-000576c0: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
-000576d0: 595f 5459 5045 5f44 454c 4554 4529 0d0a  Y_TYPE_DELETE)..
-000576e0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-000576f0: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
-00057700: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
-00057710: 5041 5448 290d 0a20 2020 2020 2020 2071  PATH)..        q
-00057720: 7565 7279 2e73 6574 5f77 6865 7265 5f66  uery.set_where_f
-00057730: 696c 7465 7273 2877 6865 7265 5f66 696c  ilters(where_fil
-00057740: 7465 725f 6f77 6e65 7229 0d0a 2020 2020  ter_owner)..    
-00057750: 2020 2020 636f 6e6e 6563 7469 6f6e 2e65      connection.e
-00057760: 7865 6375 7465 2873 7472 2871 7565 7279  xecute(str(query
-00057770: 2929 0d0a 0d0a 2020 2020 2020 2020 7175  ))....        qu
-00057780: 6572 7920 3d20 5175 6572 7928 290d 0a20  ery = Query().. 
-00057790: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-000577a0: 5f64 6174 6162 6173 6528 636f 6e6e 6563  _database(connec
-000577b0: 7469 6f6e 5f74 7970 6529 0d0a 2020 2020  tion_type)..    
-000577c0: 2020 2020 7175 6572 792e 7365 745f 7661      query.set_va
-000577d0: 6c75 6573 5f62 6174 6368 2863 6f6d 6d69  lues_batch(commi
-000577e0: 745f 7661 6c75 6573 5f62 6174 6368 290d  t_values_batch).
-000577f0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-00057800: 6574 5f74 7970 6528 5155 4552 595f 5459  et_type(QUERY_TY
-00057810: 5045 5f56 414c 5545 5329 0d0a 2020 2020  PE_VALUES)..    
-00057820: 2020 2020 7175 6572 792e 7365 745f 7461      query.set_ta
-00057830: 7267 6574 5f74 6162 6c65 2854 4142 4c45  rget_table(TABLE
-00057840: 5f4f 4d5f 4441 5441 5345 545f 5041 5448  _OM_DATASET_PATH
-00057850: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057860: 2e73 6574 5f69 6e73 6572 745f 636f 6c75  .set_insert_colu
-00057870: 6d6e 7328 434f 4c55 4d4e 535f 4f4d 5f44  mns(COLUMNS_OM_D
-00057880: 4154 4153 4554 5f50 4154 4829 0d0a 2020  ATASET_PATH)..  
-00057890: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
-000578a0: 6861 735f 6865 6164 6572 2846 616c 7365  has_header(False
-000578b0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-000578c0: 2e73 6574 5f76 616c 7565 7328 7365 6c66  .set_values(self
-000578d0: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
-000578e0: 642e 6f6d 5f64 6174 6173 6574 5f70 6174  d.om_dataset_pat
-000578f0: 6829 0d0a 2020 2020 2020 2020 636f 6e6e  h)..        conn
-00057900: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
-00057910: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
-00057920: 2020 2020 2020 2320 4f4d 5f44 4154 4153        # OM_DATAS
-00057930: 4554 0d0a 2020 2020 2020 2020 7175 6572  ET..        quer
-00057940: 7920 3d20 5175 6572 7928 290d 0a20 2020  y = Query()..   
-00057950: 2020 2020 2071 7565 7279 2e73 6574 5f64       query.set_d
-00057960: 6174 6162 6173 6528 636f 6e6e 6563 7469  atabase(connecti
-00057970: 6f6e 5f74 7970 6529 0d0a 2020 2020 2020  on_type)..      
-00057980: 2020 7175 6572 792e 7365 745f 7661 6c75    query.set_valu
-00057990: 6573 5f62 6174 6368 2863 6f6d 6d69 745f  es_batch(commit_
-000579a0: 7661 6c75 6573 5f62 6174 6368 290d 0a20  values_batch).. 
-000579b0: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-000579c0: 5f74 7970 6528 5155 4552 595f 5459 5045  _type(QUERY_TYPE
-000579d0: 5f44 454c 4554 4529 0d0a 2020 2020 2020  _DELETE)..      
-000579e0: 2020 7175 6572 792e 7365 745f 7461 7267    query.set_targ
-000579f0: 6574 5f74 6162 6c65 2854 4142 4c45 5f4f  et_table(TABLE_O
-00057a00: 4d5f 4441 5441 5345 5429 0d0a 2020 2020  M_DATASET)..    
-00057a10: 2020 2020 7175 6572 792e 7365 745f 7768      query.set_wh
-00057a20: 6572 655f 6669 6c74 6572 7328 7768 6572  ere_filters(wher
-00057a30: 655f 6669 6c74 6572 5f6f 776e 6572 290d  e_filter_owner).
-00057a40: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-00057a50: 696f 6e2e 6578 6563 7574 6528 7374 7228  ion.execute(str(
-00057a60: 7175 6572 7929 290d 0a0d 0a20 2020 2020  query))....     
-00057a70: 2020 2071 7565 7279 203d 2051 7565 7279     query = Query
-00057a80: 2829 0d0a 2020 2020 2020 2020 7175 6572  ()..        quer
-00057a90: 792e 7365 745f 6461 7461 6261 7365 2863  y.set_database(c
-00057aa0: 6f6e 6e65 6374 696f 6e5f 7479 7065 290d  onnection_type).
-00057ab0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-00057ac0: 6574 5f76 616c 7565 735f 6261 7463 6828  et_values_batch(
-00057ad0: 636f 6d6d 6974 5f76 616c 7565 735f 6261  commit_values_ba
-00057ae0: 7463 6829 0d0a 2020 2020 2020 2020 7175  tch)..        qu
-00057af0: 6572 792e 7365 745f 7479 7065 2851 5545  ery.set_type(QUE
-00057b00: 5259 5f54 5950 455f 5641 4c55 4553 290d  RY_TYPE_VALUES).
-00057b10: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-00057b20: 6574 5f74 6172 6765 745f 7461 626c 6528  et_target_table(
-00057b30: 5441 424c 455f 4f4d 5f44 4154 4153 4554  TABLE_OM_DATASET
-00057b40: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057b50: 2e73 6574 5f69 6e73 6572 745f 636f 6c75  .set_insert_colu
-00057b60: 6d6e 7328 434f 4c55 4d4e 535f 4f4d 5f44  mns(COLUMNS_OM_D
-00057b70: 4154 4153 4554 290d 0a20 2020 2020 2020  ATASET)..       
-00057b80: 2071 7565 7279 2e73 6574 5f68 6173 5f68   query.set_has_h
-00057b90: 6561 6465 7228 4661 6c73 6529 0d0a 2020  eader(False)..  
-00057ba0: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
-00057bb0: 7661 6c75 6573 2873 656c 662e 6d65 7461  values(self.meta
-00057bc0: 6461 7461 5f74 6f5f 6c6f 6164 2e6f 6d5f  data_to_load.om_
-00057bd0: 6461 7461 7365 7429 0d0a 2020 2020 2020  dataset)..      
-00057be0: 2020 636f 6e6e 6563 7469 6f6e 2e65 7865    connection.exe
-00057bf0: 6375 7465 2873 7472 2871 7565 7279 2929  cute(str(query))
-00057c00: 0d0a 0d0a 2020 2020 2020 2020 2320 4f4d  ....        # OM
-00057c10: 5f44 4154 4153 4554 5f44 560d 0a20 2020  _DATASET_DV..   
-00057c20: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
-00057c30: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
-00057c40: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
-00057c50: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
-00057c60: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057c70: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
-00057c80: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
-00057c90: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
-00057ca0: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
-00057cb0: 5545 5259 5f54 5950 455f 4445 4c45 5445  UERY_TYPE_DELETE
-00057cc0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057cd0: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
-00057ce0: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
-00057cf0: 4554 5f44 5629 0d0a 2020 2020 2020 2020  ET_DV)..        
-00057d00: 7175 6572 792e 7365 745f 7768 6572 655f  query.set_where_
-00057d10: 6669 6c74 6572 7328 7768 6572 655f 6669  filters(where_fi
-00057d20: 6c74 6572 5f6f 776e 6572 290d 0a20 2020  lter_owner)..   
-00057d30: 2020 2020 2063 6f6e 6e65 6374 696f 6e2e       connection.
-00057d40: 6578 6563 7574 6528 7374 7228 7175 6572  execute(str(quer
-00057d50: 7929 290d 0a0d 0a20 2020 2020 2020 2071  y))....        q
-00057d60: 7565 7279 203d 2051 7565 7279 2829 0d0a  uery = Query()..
-00057d70: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00057d80: 745f 6461 7461 6261 7365 2863 6f6e 6e65  t_database(conne
-00057d90: 6374 696f 6e5f 7479 7065 290d 0a20 2020  ction_type)..   
-00057da0: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
-00057db0: 616c 7565 735f 6261 7463 6828 636f 6d6d  alues_batch(comm
-00057dc0: 6974 5f76 616c 7565 735f 6261 7463 6829  it_values_batch)
-00057dd0: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00057de0: 7365 745f 7479 7065 2851 5545 5259 5f54  set_type(QUERY_T
-00057df0: 5950 455f 5641 4c55 4553 290d 0a20 2020  YPE_VALUES)..   
-00057e00: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
-00057e10: 6172 6765 745f 7461 626c 6528 5441 424c  arget_table(TABL
-00057e20: 455f 4f4d 5f44 4154 4153 4554 5f44 5629  E_OM_DATASET_DV)
-00057e30: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00057e40: 7365 745f 696e 7365 7274 5f63 6f6c 756d  set_insert_colum
-00057e50: 6e73 2843 4f4c 554d 4e53 5f4f 4d5f 4441  ns(COLUMNS_OM_DA
-00057e60: 5441 5345 545f 4456 290d 0a20 2020 2020  TASET_DV)..     
-00057e70: 2020 2071 7565 7279 2e73 6574 5f68 6173     query.set_has
-00057e80: 5f68 6561 6465 7228 4661 6c73 6529 0d0a  _header(False)..
-00057e90: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00057ea0: 745f 7661 6c75 6573 2873 656c 662e 6d65  t_values(self.me
-00057eb0: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e6f  tadata_to_load.o
-00057ec0: 6d5f 6461 7461 7365 745f 6476 290d 0a20  m_dataset_dv).. 
-00057ed0: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
-00057ee0: 6e2e 6578 6563 7574 6528 7374 7228 7175  n.execute(str(qu
-00057ef0: 6572 7929 290d 0a0d 0a20 2020 2020 2020  ery))....       
-00057f00: 2023 204f 4d5f 4441 5441 5345 545f 5350   # OM_DATASET_SP
-00057f10: 4543 4946 4943 4154 494f 4e0d 0a20 2020  ECIFICATION..   
-00057f20: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
-00057f30: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
-00057f40: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
-00057f50: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
-00057f60: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057f70: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
-00057f80: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
-00057f90: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
-00057fa0: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
-00057fb0: 5545 5259 5f54 5950 455f 4445 4c45 5445  UERY_TYPE_DELETE
-00057fc0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00057fd0: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
-00057fe0: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
-00057ff0: 4554 5f53 5045 4349 4649 4341 5449 4f4e  ET_SPECIFICATION
-00058000: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00058010: 2e73 6574 5f77 6865 7265 5f66 696c 7465  .set_where_filte
-00058020: 7273 2877 6865 7265 5f66 696c 7465 725f  rs(where_filter_
-00058030: 6f77 6e65 7229 0d0a 2020 2020 2020 2020  owner)..        
-00058040: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
-00058050: 7465 2873 7472 2871 7565 7279 2929 0d0a  te(str(query))..
-00058060: 0d0a 2020 2020 2020 2020 7175 6572 7920  ..        query 
-00058070: 3d20 5175 6572 7928 290d 0a20 2020 2020  = Query()..     
-00058080: 2020 2071 7565 7279 2e73 6574 5f64 6174     query.set_dat
-00058090: 6162 6173 6528 636f 6e6e 6563 7469 6f6e  abase(connection
-000580a0: 5f74 7970 6529 0d0a 2020 2020 2020 2020  _type)..        
-000580b0: 7175 6572 792e 7365 745f 7661 6c75 6573  query.set_values
-000580c0: 5f62 6174 6368 2863 6f6d 6d69 745f 7661  _batch(commit_va
-000580d0: 6c75 6573 5f62 6174 6368 290d 0a20 2020  lues_batch)..   
-000580e0: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
-000580f0: 7970 6528 5155 4552 595f 5459 5045 5f56  ype(QUERY_TYPE_V
-00058100: 414c 5545 5329 0d0a 2020 2020 2020 2020  ALUES)..        
-00058110: 7175 6572 792e 7365 745f 7461 7267 6574  query.set_target
-00058120: 5f74 6162 6c65 2854 4142 4c45 5f4f 4d5f  _table(TABLE_OM_
-00058130: 4441 5441 5345 545f 5350 4543 4946 4943  DATASET_SPECIFIC
-00058140: 4154 494f 4e29 0d0a 2020 2020 2020 2020  ATION)..        
-00058150: 7175 6572 792e 7365 745f 696e 7365 7274  query.set_insert
-00058160: 5f63 6f6c 756d 6e73 2843 4f4c 554d 4e53  _columns(COLUMNS
-00058170: 5f4f 4d5f 4441 5441 5345 545f 5350 4543  _OM_DATASET_SPEC
-00058180: 4946 4943 4154 494f 4e29 0d0a 2020 2020  IFICATION)..    
-00058190: 2020 2020 7175 6572 792e 7365 745f 6861      query.set_ha
-000581a0: 735f 6865 6164 6572 2846 616c 7365 290d  s_header(False).
-000581b0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-000581c0: 6574 5f76 616c 7565 7328 7365 6c66 2e6d  et_values(self.m
-000581d0: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
-000581e0: 6f6d 5f64 6174 6173 6574 5f73 7065 6369  om_dataset_speci
-000581f0: 6669 6361 7469 6f6e 290d 0a20 2020 2020  fication)..     
-00058200: 2020 2063 6f6e 6e65 6374 696f 6e2e 6578     connection.ex
-00058210: 6563 7574 6528 7374 7228 7175 6572 7929  ecute(str(query)
-00058220: 290d 0a0d 0a20 2020 2020 2020 2023 204f  )....        # O
-00058230: 4d5f 4441 5441 5345 545f 5245 4c41 5449  M_DATASET_RELATI
-00058240: 4f4e 5348 4950 530d 0a20 2020 2020 2020  ONSHIPS..       
-00058250: 2071 7565 7279 203d 2051 7565 7279 2829   query = Query()
-00058260: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00058270: 7365 745f 6461 7461 6261 7365 2863 6f6e  set_database(con
-00058280: 6e65 6374 696f 6e5f 7479 7065 290d 0a20  nection_type).. 
-00058290: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-000582a0: 5f76 616c 7565 735f 6261 7463 6828 636f  _values_batch(co
-000582b0: 6d6d 6974 5f76 616c 7565 735f 6261 7463  mmit_values_batc
-000582c0: 6829 0d0a 2020 2020 2020 2020 7175 6572  h)..        quer
-000582d0: 792e 7365 745f 7479 7065 2851 5545 5259  y.set_type(QUERY
-000582e0: 5f54 5950 455f 4445 4c45 5445 290d 0a20  _TYPE_DELETE).. 
-000582f0: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-00058300: 5f74 6172 6765 745f 7461 626c 6528 5441  _target_table(TA
-00058310: 424c 455f 4f4d 5f44 4154 4153 4554 5f52  BLE_OM_DATASET_R
-00058320: 454c 4154 494f 4e53 4849 5053 290d 0a20  ELATIONSHIPS).. 
-00058330: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-00058340: 5f77 6865 7265 5f66 696c 7465 7273 2877  _where_filters(w
-00058350: 6865 7265 5f66 696c 7465 725f 6f77 6e65  here_filter_owne
-00058360: 7229 0d0a 2020 2020 2020 2020 636f 6e6e  r)..        conn
-00058370: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
-00058380: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
-00058390: 2020 2020 2020 7175 6572 7920 3d20 5175        query = Qu
-000583a0: 6572 7928 290d 0a20 2020 2020 2020 2071  ery()..        q
-000583b0: 7565 7279 2e73 6574 5f64 6174 6162 6173  uery.set_databas
-000583c0: 6528 636f 6e6e 6563 7469 6f6e 5f74 7970  e(connection_typ
-000583d0: 6529 0d0a 2020 2020 2020 2020 7175 6572  e)..        quer
-000583e0: 792e 7365 745f 7661 6c75 6573 5f62 6174  y.set_values_bat
-000583f0: 6368 2863 6f6d 6d69 745f 7661 6c75 6573  ch(commit_values
-00058400: 5f62 6174 6368 290d 0a20 2020 2020 2020  _batch)..       
-00058410: 2071 7565 7279 2e73 6574 5f74 7970 6528   query.set_type(
-00058420: 5155 4552 595f 5459 5045 5f56 414c 5545  QUERY_TYPE_VALUE
-00058430: 5329 0d0a 2020 2020 2020 2020 7175 6572  S)..        quer
-00058440: 792e 7365 745f 7461 7267 6574 5f74 6162  y.set_target_tab
-00058450: 6c65 2854 4142 4c45 5f4f 4d5f 4441 5441  le(TABLE_OM_DATA
-00058460: 5345 545f 5245 4c41 5449 4f4e 5348 4950  SET_RELATIONSHIP
-00058470: 5329 0d0a 2020 2020 2020 2020 7175 6572  S)..        quer
-00058480: 792e 7365 745f 696e 7365 7274 5f63 6f6c  y.set_insert_col
-00058490: 756d 6e73 2843 4f4c 554d 4e53 5f4f 4d5f  umns(COLUMNS_OM_
-000584a0: 4441 5441 5345 545f 5245 4c41 5449 4f4e  DATASET_RELATION
-000584b0: 5348 4950 5329 0d0a 2020 2020 2020 2020  SHIPS)..        
-000584c0: 7175 6572 792e 7365 745f 6861 735f 6865  query.set_has_he
-000584d0: 6164 6572 2846 616c 7365 290d 0a20 2020  ader(False)..   
-000584e0: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
-000584f0: 616c 7565 7328 7365 6c66 2e6d 6574 6164  alues(self.metad
-00058500: 6174 615f 746f 5f6c 6f61 642e 6f6d 5f64  ata_to_load.om_d
-00058510: 6174 6173 6574 5f72 656c 6174 696f 6e73  ataset_relations
-00058520: 6869 7073 290d 0a20 2020 2020 2020 2063  hips)..        c
-00058530: 6f6e 6e65 6374 696f 6e2e 6578 6563 7574  onnection.execut
-00058540: 6528 7374 7228 7175 6572 7929 290d 0a0d  e(str(query))...
-00058550: 0a20 2020 2020 2020 2023 204f 4d5f 4441  .        # OM_DA
-00058560: 5441 5345 545f 545f 4147 470d 0a20 2020  TASET_T_AGG..   
-00058570: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
-00058580: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
-00058590: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
-000585a0: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
-000585b0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-000585c0: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
-000585d0: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
-000585e0: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
-000585f0: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
-00058600: 5545 5259 5f54 5950 455f 4445 4c45 5445  UERY_TYPE_DELETE
-00058610: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00058620: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
-00058630: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
-00058640: 4554 5f54 5f41 4747 290d 0a20 2020 2020  ET_T_AGG)..     
-00058650: 2020 2071 7565 7279 2e73 6574 5f77 6865     query.set_whe
-00058660: 7265 5f66 696c 7465 7273 2877 6865 7265  re_filters(where
-00058670: 5f66 696c 7465 725f 6f77 6e65 7229 0d0a  _filter_owner)..
-00058680: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00058690: 6f6e 2e65 7865 6375 7465 2873 7472 2871  on.execute(str(q
-000586a0: 7565 7279 2929 0d0a 0d0a 2020 2020 2020  uery))....      
-000586b0: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
-000586c0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-000586d0: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
-000586e0: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
-000586f0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00058700: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
-00058710: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
-00058720: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
-00058730: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
-00058740: 595f 5459 5045 5f56 414c 5545 5329 0d0a  Y_TYPE_VALUES)..
-00058750: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00058760: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
-00058770: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
-00058780: 545f 4147 4729 0d0a 2020 2020 2020 2020  T_AGG)..        
-00058790: 7175 6572 792e 7365 745f 696e 7365 7274  query.set_insert
-000587a0: 5f63 6f6c 756d 6e73 2843 4f4c 554d 4e53  _columns(COLUMNS
-000587b0: 5f4f 4d5f 4441 5441 5345 545f 545f 4147  _OM_DATASET_T_AG
-000587c0: 4729 0d0a 2020 2020 2020 2020 7175 6572  G)..        quer
-000587d0: 792e 7365 745f 6861 735f 6865 6164 6572  y.set_has_header
-000587e0: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
-000587f0: 2071 7565 7279 2e73 6574 5f76 616c 7565   query.set_value
-00058800: 7328 7365 6c66 2e6d 6574 6164 6174 615f  s(self.metadata_
-00058810: 746f 5f6c 6f61 642e 6f6d 5f64 6174 6173  to_load.om_datas
-00058820: 6574 5f74 5f61 6767 290d 0a20 2020 2020  et_t_agg)..     
-00058830: 2020 2063 6f6e 6e65 6374 696f 6e2e 6578     connection.ex
-00058840: 6563 7574 6528 7374 7228 7175 6572 7929  ecute(str(query)
-00058850: 290d 0a0d 0a20 2020 2020 2020 2023 204f  )....        # O
-00058860: 4d5f 4441 5441 5345 545f 545f 4f52 4445  M_DATASET_T_ORDE
-00058870: 520d 0a20 2020 2020 2020 2071 7565 7279  R..        query
-00058880: 203d 2051 7565 7279 2829 0d0a 2020 2020   = Query()..    
-00058890: 2020 2020 7175 6572 792e 7365 745f 6461      query.set_da
-000588a0: 7461 6261 7365 2863 6f6e 6e65 6374 696f  tabase(connectio
-000588b0: 6e5f 7479 7065 290d 0a20 2020 2020 2020  n_type)..       
-000588c0: 2071 7565 7279 2e73 6574 5f76 616c 7565   query.set_value
-000588d0: 735f 6261 7463 6828 636f 6d6d 6974 5f76  s_batch(commit_v
-000588e0: 616c 7565 735f 6261 7463 6829 0d0a 2020  alues_batch)..  
-000588f0: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
-00058900: 7479 7065 2851 5545 5259 5f54 5950 455f  type(QUERY_TYPE_
-00058910: 4445 4c45 5445 290d 0a20 2020 2020 2020  DELETE)..       
-00058920: 2071 7565 7279 2e73 6574 5f74 6172 6765   query.set_targe
-00058930: 745f 7461 626c 6528 5441 424c 455f 4f4d  t_table(TABLE_OM
-00058940: 5f44 4154 4153 4554 5f54 5f4f 5244 4552  _DATASET_T_ORDER
-00058950: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00058960: 2e73 6574 5f77 6865 7265 5f66 696c 7465  .set_where_filte
-00058970: 7273 2877 6865 7265 5f66 696c 7465 725f  rs(where_filter_
-00058980: 6f77 6e65 7229 0d0a 2020 2020 2020 2020  owner)..        
-00058990: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
-000589a0: 7465 2873 7472 2871 7565 7279 2929 0d0a  te(str(query))..
-000589b0: 0d0a 2020 2020 2020 2020 7175 6572 7920  ..        query 
-000589c0: 3d20 5175 6572 7928 290d 0a20 2020 2020  = Query()..     
-000589d0: 2020 2071 7565 7279 2e73 6574 5f64 6174     query.set_dat
-000589e0: 6162 6173 6528 636f 6e6e 6563 7469 6f6e  abase(connection
-000589f0: 5f74 7970 6529 0d0a 2020 2020 2020 2020  _type)..        
-00058a00: 7175 6572 792e 7365 745f 7661 6c75 6573  query.set_values
-00058a10: 5f62 6174 6368 2863 6f6d 6d69 745f 7661  _batch(commit_va
-00058a20: 6c75 6573 5f62 6174 6368 290d 0a20 2020  lues_batch)..   
-00058a30: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
-00058a40: 7970 6528 5155 4552 595f 5459 5045 5f56  ype(QUERY_TYPE_V
-00058a50: 414c 5545 5329 0d0a 2020 2020 2020 2020  ALUES)..        
-00058a60: 7175 6572 792e 7365 745f 7461 7267 6574  query.set_target
-00058a70: 5f74 6162 6c65 2854 4142 4c45 5f4f 4d5f  _table(TABLE_OM_
-00058a80: 4441 5441 5345 545f 545f 4f52 4445 5229  DATASET_T_ORDER)
-00058a90: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00058aa0: 7365 745f 696e 7365 7274 5f63 6f6c 756d  set_insert_colum
-00058ab0: 6e73 2843 4f4c 554d 4e53 5f4f 4d5f 4441  ns(COLUMNS_OM_DA
-00058ac0: 5441 5345 545f 545f 4f52 4445 5229 0d0a  TASET_T_ORDER)..
-00058ad0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00058ae0: 745f 6861 735f 6865 6164 6572 2846 616c  t_has_header(Fal
-00058af0: 7365 290d 0a20 2020 2020 2020 2071 7565  se)..        que
-00058b00: 7279 2e73 6574 5f76 616c 7565 7328 7365  ry.set_values(se
-00058b10: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
-00058b20: 6f61 642e 6f6d 5f64 6174 6173 6574 5f74  oad.om_dataset_t
-00058b30: 5f6f 7264 6572 290d 0a20 2020 2020 2020  _order)..       
-00058b40: 2063 6f6e 6e65 6374 696f 6e2e 6578 6563   connection.exec
-00058b50: 7574 6528 7374 7228 7175 6572 7929 290d  ute(str(query)).
-00058b60: 0a0d 0a20 2020 2020 2020 2023 204f 4d5f  ...        # OM_
-00058b70: 4441 5441 5345 545f 545f 4d41 5050 494e  DATASET_T_MAPPIN
-00058b80: 470d 0a20 2020 2020 2020 2071 7565 7279  G..        query
-00058b90: 203d 2051 7565 7279 2829 0d0a 2020 2020   = Query()..    
-00058ba0: 2020 2020 7175 6572 792e 7365 745f 6461      query.set_da
-00058bb0: 7461 6261 7365 2863 6f6e 6e65 6374 696f  tabase(connectio
-00058bc0: 6e5f 7479 7065 290d 0a20 2020 2020 2020  n_type)..       
-00058bd0: 2071 7565 7279 2e73 6574 5f76 616c 7565   query.set_value
-00058be0: 735f 6261 7463 6828 636f 6d6d 6974 5f76  s_batch(commit_v
-00058bf0: 616c 7565 735f 6261 7463 6829 0d0a 2020  alues_batch)..  
-00058c00: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
-00058c10: 7479 7065 2851 5545 5259 5f54 5950 455f  type(QUERY_TYPE_
-00058c20: 4445 4c45 5445 290d 0a20 2020 2020 2020  DELETE)..       
-00058c30: 2071 7565 7279 2e73 6574 5f74 6172 6765   query.set_targe
-00058c40: 745f 7461 626c 6528 5441 424c 455f 4f4d  t_table(TABLE_OM
-00058c50: 5f44 4154 4153 4554 5f54 5f4d 4150 5049  _DATASET_T_MAPPI
-00058c60: 4e47 290d 0a20 2020 2020 2020 2071 7565  NG)..        que
-00058c70: 7279 2e73 6574 5f77 6865 7265 5f66 696c  ry.set_where_fil
-00058c80: 7465 7273 2877 6865 7265 5f66 696c 7465  ters(where_filte
-00058c90: 725f 6f77 6e65 7229 0d0a 2020 2020 2020  r_owner)..      
-00058ca0: 2020 636f 6e6e 6563 7469 6f6e 2e65 7865    connection.exe
-00058cb0: 6375 7465 2873 7472 2871 7565 7279 2929  cute(str(query))
-00058cc0: 0d0a 0d0a 2020 2020 2020 2020 7175 6572  ....        quer
-00058cd0: 7920 3d20 5175 6572 7928 290d 0a20 2020  y = Query()..   
-00058ce0: 2020 2020 2071 7565 7279 2e73 6574 5f64       query.set_d
-00058cf0: 6174 6162 6173 6528 636f 6e6e 6563 7469  atabase(connecti
-00058d00: 6f6e 5f74 7970 6529 0d0a 2020 2020 2020  on_type)..      
-00058d10: 2020 7175 6572 792e 7365 745f 7661 6c75    query.set_valu
-00058d20: 6573 5f62 6174 6368 2863 6f6d 6d69 745f  es_batch(commit_
-00058d30: 7661 6c75 6573 5f62 6174 6368 290d 0a20  values_batch).. 
-00058d40: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-00058d50: 5f74 7970 6528 5155 4552 595f 5459 5045  _type(QUERY_TYPE
-00058d60: 5f56 414c 5545 5329 0d0a 2020 2020 2020  _VALUES)..      
-00058d70: 2020 7175 6572 792e 7365 745f 7461 7267    query.set_targ
-00058d80: 6574 5f74 6162 6c65 2854 4142 4c45 5f4f  et_table(TABLE_O
-00058d90: 4d5f 4441 5441 5345 545f 545f 4d41 5050  M_DATASET_T_MAPP
-00058da0: 494e 4729 0d0a 2020 2020 2020 2020 7175  ING)..        qu
-00058db0: 6572 792e 7365 745f 696e 7365 7274 5f63  ery.set_insert_c
-00058dc0: 6f6c 756d 6e73 2843 4f4c 554d 4e53 5f4f  olumns(COLUMNS_O
-00058dd0: 4d5f 4441 5441 5345 545f 545f 4d41 5050  M_DATASET_T_MAPP
-00058de0: 494e 4729 0d0a 2020 2020 2020 2020 7175  ING)..        qu
-00058df0: 6572 792e 7365 745f 6861 735f 6865 6164  ery.set_has_head
-00058e00: 6572 2846 616c 7365 290d 0a20 2020 2020  er(False)..     
-00058e10: 2020 2071 7565 7279 2e73 6574 5f76 616c     query.set_val
-00058e20: 7565 7328 7365 6c66 2e6d 6574 6164 6174  ues(self.metadat
-00058e30: 615f 746f 5f6c 6f61 642e 6f6d 5f64 6174  a_to_load.om_dat
-00058e40: 6173 6574 5f74 5f6d 6170 7069 6e67 290d  aset_t_mapping).
-00058e50: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-00058e60: 696f 6e2e 6578 6563 7574 6528 7374 7228  ion.execute(str(
-00058e70: 7175 6572 7929 290d 0a0d 0a20 2020 2020  query))....     
-00058e80: 2020 2023 204f 4d5f 4441 5441 5345 545f     # OM_DATASET_
-00058e90: 545f 4449 5354 494e 4354 0d0a 2020 2020  T_DISTINCT..    
-00058ea0: 2020 2020 7175 6572 7920 3d20 5175 6572      query = Quer
-00058eb0: 7928 290d 0a20 2020 2020 2020 2071 7565  y()..        que
-00058ec0: 7279 2e73 6574 5f64 6174 6162 6173 6528  ry.set_database(
-00058ed0: 636f 6e6e 6563 7469 6f6e 5f74 7970 6529  connection_type)
-00058ee0: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00058ef0: 7365 745f 7661 6c75 6573 5f62 6174 6368  set_values_batch
-00058f00: 2863 6f6d 6d69 745f 7661 6c75 6573 5f62  (commit_values_b
-00058f10: 6174 6368 290d 0a20 2020 2020 2020 2071  atch)..        q
-00058f20: 7565 7279 2e73 6574 5f74 7970 6528 5155  uery.set_type(QU
-00058f30: 4552 595f 5459 5045 5f44 454c 4554 4529  ERY_TYPE_DELETE)
-00058f40: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00058f50: 7365 745f 7461 7267 6574 5f74 6162 6c65  set_target_table
-00058f60: 2854 4142 4c45 5f4f 4d5f 4441 5441 5345  (TABLE_OM_DATASE
-00058f70: 545f 545f 4449 5354 494e 4354 290d 0a20  T_T_DISTINCT).. 
-00058f80: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-00058f90: 5f77 6865 7265 5f66 696c 7465 7273 2877  _where_filters(w
-00058fa0: 6865 7265 5f66 696c 7465 725f 6f77 6e65  here_filter_owne
-00058fb0: 7229 0d0a 2020 2020 2020 2020 636f 6e6e  r)..        conn
-00058fc0: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
-00058fd0: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
-00058fe0: 2020 2020 2020 7175 6572 7920 3d20 5175        query = Qu
-00058ff0: 6572 7928 290d 0a20 2020 2020 2020 2071  ery()..        q
-00059000: 7565 7279 2e73 6574 5f64 6174 6162 6173  uery.set_databas
-00059010: 6528 636f 6e6e 6563 7469 6f6e 5f74 7970  e(connection_typ
-00059020: 6529 0d0a 2020 2020 2020 2020 7175 6572  e)..        quer
-00059030: 792e 7365 745f 7661 6c75 6573 5f62 6174  y.set_values_bat
-00059040: 6368 2863 6f6d 6d69 745f 7661 6c75 6573  ch(commit_values
-00059050: 5f62 6174 6368 290d 0a20 2020 2020 2020  _batch)..       
-00059060: 2071 7565 7279 2e73 6574 5f74 7970 6528   query.set_type(
-00059070: 5155 4552 595f 5459 5045 5f56 414c 5545  QUERY_TYPE_VALUE
-00059080: 5329 0d0a 2020 2020 2020 2020 7175 6572  S)..        quer
-00059090: 792e 7365 745f 7461 7267 6574 5f74 6162  y.set_target_tab
-000590a0: 6c65 2854 4142 4c45 5f4f 4d5f 4441 5441  le(TABLE_OM_DATA
-000590b0: 5345 545f 545f 4449 5354 494e 4354 290d  SET_T_DISTINCT).
-000590c0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-000590d0: 6574 5f69 6e73 6572 745f 636f 6c75 6d6e  et_insert_column
-000590e0: 7328 434f 4c55 4d4e 535f 4f4d 5f44 4154  s(COLUMNS_OM_DAT
-000590f0: 4153 4554 5f54 5f44 4953 5449 4e43 5429  ASET_T_DISTINCT)
-00059100: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00059110: 7365 745f 6861 735f 6865 6164 6572 2846  set_has_header(F
-00059120: 616c 7365 290d 0a20 2020 2020 2020 2071  alse)..        q
-00059130: 7565 7279 2e73 6574 5f76 616c 7565 7328  uery.set_values(
-00059140: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
-00059150: 5f6c 6f61 642e 6f6d 5f64 6174 6173 6574  _load.om_dataset
-00059160: 5f74 5f64 6973 7469 6e63 7429 0d0a 2020  _t_distinct)..  
-00059170: 2020 2020 2020 636f 6e6e 6563 7469 6f6e        connection
-00059180: 2e65 7865 6375 7465 2873 7472 2871 7565  .execute(str(que
-00059190: 7279 2929 0d0a 0d0a 2020 2020 2020 2020  ry))....        
-000591a0: 2320 4f4d 5f44 4154 4153 4554 5f54 5f46  # OM_DATASET_T_F
-000591b0: 494c 5445 520d 0a20 2020 2020 2020 2071  ILTER..        q
-000591c0: 7565 7279 203d 2051 7565 7279 2829 0d0a  uery = Query()..
-000591d0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-000591e0: 745f 6461 7461 6261 7365 2863 6f6e 6e65  t_database(conne
-000591f0: 6374 696f 6e5f 7479 7065 290d 0a20 2020  ction_type)..   
-00059200: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
-00059210: 616c 7565 735f 6261 7463 6828 636f 6d6d  alues_batch(comm
-00059220: 6974 5f76 616c 7565 735f 6261 7463 6829  it_values_batch)
-00059230: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00059240: 7365 745f 7479 7065 2851 5545 5259 5f54  set_type(QUERY_T
-00059250: 5950 455f 4445 4c45 5445 290d 0a20 2020  YPE_DELETE)..   
-00059260: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
-00059270: 6172 6765 745f 7461 626c 6528 5441 424c  arget_table(TABL
-00059280: 455f 4f4d 5f44 4154 4153 4554 5f54 5f46  E_OM_DATASET_T_F
-00059290: 494c 5445 5229 0d0a 2020 2020 2020 2020  ILTER)..        
-000592a0: 7175 6572 792e 7365 745f 7768 6572 655f  query.set_where_
-000592b0: 6669 6c74 6572 7328 7768 6572 655f 6669  filters(where_fi
-000592c0: 6c74 6572 5f6f 776e 6572 290d 0a20 2020  lter_owner)..   
-000592d0: 2020 2020 2063 6f6e 6e65 6374 696f 6e2e       connection.
-000592e0: 6578 6563 7574 6528 7374 7228 7175 6572  execute(str(quer
-000592f0: 7929 290d 0a0d 0a20 2020 2020 2020 2071  y))....        q
-00059300: 7565 7279 203d 2051 7565 7279 2829 0d0a  uery = Query()..
-00059310: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00059320: 745f 6461 7461 6261 7365 2863 6f6e 6e65  t_database(conne
-00059330: 6374 696f 6e5f 7479 7065 290d 0a20 2020  ction_type)..   
-00059340: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
-00059350: 616c 7565 735f 6261 7463 6828 636f 6d6d  alues_batch(comm
-00059360: 6974 5f76 616c 7565 735f 6261 7463 6829  it_values_batch)
-00059370: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
-00059380: 7365 745f 7479 7065 2851 5545 5259 5f54  set_type(QUERY_T
-00059390: 5950 455f 5641 4c55 4553 290d 0a20 2020  YPE_VALUES)..   
-000593a0: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
-000593b0: 6172 6765 745f 7461 626c 6528 5441 424c  arget_table(TABL
-000593c0: 455f 4f4d 5f44 4154 4153 4554 5f54 5f46  E_OM_DATASET_T_F
-000593d0: 494c 5445 5229 0d0a 2020 2020 2020 2020  ILTER)..        
-000593e0: 7175 6572 792e 7365 745f 696e 7365 7274  query.set_insert
-000593f0: 5f63 6f6c 756d 6e73 2843 4f4c 554d 4e53  _columns(COLUMNS
-00059400: 5f4f 4d5f 4441 5441 5345 545f 545f 4649  _OM_DATASET_T_FI
-00059410: 4c54 4552 290d 0a20 2020 2020 2020 2071  LTER)..        q
-00059420: 7565 7279 2e73 6574 5f68 6173 5f68 6561  uery.set_has_hea
-00059430: 6465 7228 4661 6c73 6529 0d0a 2020 2020  der(False)..    
-00059440: 2020 2020 7175 6572 792e 7365 745f 7661      query.set_va
-00059450: 6c75 6573 2873 656c 662e 6d65 7461 6461  lues(self.metada
-00059460: 7461 5f74 6f5f 6c6f 6164 2e6f 6d5f 6461  ta_to_load.om_da
-00059470: 7461 7365 745f 745f 6669 6c74 6572 290d  taset_t_filter).
-00059480: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
-00059490: 696f 6e2e 6578 6563 7574 6528 7374 7228  ion.execute(str(
-000594a0: 7175 6572 7929 290d 0a0d 0a20 2020 2020  query))....     
-000594b0: 2020 2023 204f 4d5f 4441 5441 5345 545f     # OM_DATASET_
-000594c0: 545f 4841 5649 4e47 0d0a 2020 2020 2020  T_HAVING..      
-000594d0: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
-000594e0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-000594f0: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
-00059500: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
-00059510: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00059520: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
-00059530: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
-00059540: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
-00059550: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
-00059560: 595f 5459 5045 5f44 454c 4554 4529 0d0a  Y_TYPE_DELETE)..
-00059570: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00059580: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
-00059590: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
-000595a0: 545f 4841 5649 4e47 290d 0a20 2020 2020  T_HAVING)..     
-000595b0: 2020 2071 7565 7279 2e73 6574 5f77 6865     query.set_whe
-000595c0: 7265 5f66 696c 7465 7273 2877 6865 7265  re_filters(where
-000595d0: 5f66 696c 7465 725f 6f77 6e65 7229 0d0a  _filter_owner)..
-000595e0: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-000595f0: 6f6e 2e65 7865 6375 7465 2873 7472 2871  on.execute(str(q
-00059600: 7565 7279 2929 0d0a 0d0a 2020 2020 2020  uery))....      
-00059610: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
-00059620: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00059630: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
-00059640: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
-00059650: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-00059660: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
-00059670: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
-00059680: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
-00059690: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
-000596a0: 595f 5459 5045 5f56 414c 5545 5329 0d0a  Y_TYPE_VALUES)..
-000596b0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-000596c0: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
-000596d0: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
-000596e0: 545f 4841 5649 4e47 290d 0a20 2020 2020  T_HAVING)..     
-000596f0: 2020 2071 7565 7279 2e73 6574 5f69 6e73     query.set_ins
-00059700: 6572 745f 636f 6c75 6d6e 7328 434f 4c55  ert_columns(COLU
-00059710: 4d4e 535f 4f4d 5f44 4154 4153 4554 5f54  MNS_OM_DATASET_T
-00059720: 5f48 4156 494e 4729 0d0a 2020 2020 2020  _HAVING)..      
-00059730: 2020 7175 6572 792e 7365 745f 6861 735f    query.set_has_
-00059740: 6865 6164 6572 2846 616c 7365 290d 0a20  header(False).. 
-00059750: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
-00059760: 5f76 616c 7565 7328 7365 6c66 2e6d 6574  _values(self.met
-00059770: 6164 6174 615f 746f 5f6c 6f61 642e 6f6d  adata_to_load.om
-00059780: 5f64 6174 6173 6574 5f74 5f68 6176 696e  _dataset_t_havin
-00059790: 6729 0d0a 2020 2020 2020 2020 636f 6e6e  g)..        conn
-000597a0: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
-000597b0: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
-000597c0: 2020 2020 2020 2320 4f4d 5f44 4154 4153        # OM_DATAS
-000597d0: 4554 5f45 5845 4355 5449 4f4e 0d0a 2020  ET_EXECUTION..  
-000597e0: 2020 2020 2020 7175 6572 7920 3d20 5175        query = Qu
-000597f0: 6572 7928 290d 0a20 2020 2020 2020 2071  ery()..        q
-00059800: 7565 7279 2e73 6574 5f64 6174 6162 6173  uery.set_databas
-00059810: 6528 636f 6e6e 6563 7469 6f6e 5f74 7970  e(connection_typ
-00059820: 6529 0d0a 2020 2020 2020 2020 7175 6572  e)..        quer
-00059830: 792e 7365 745f 7661 6c75 6573 5f62 6174  y.set_values_bat
-00059840: 6368 2863 6f6d 6d69 745f 7661 6c75 6573  ch(commit_values
-00059850: 5f62 6174 6368 290d 0a20 2020 2020 2020  _batch)..       
-00059860: 2071 7565 7279 2e73 6574 5f74 7970 6528   query.set_type(
-00059870: 5155 4552 595f 5459 5045 5f44 454c 4554  QUERY_TYPE_DELET
-00059880: 4529 0d0a 2020 2020 2020 2020 7175 6572  E)..        quer
-00059890: 792e 7365 745f 7461 7267 6574 5f74 6162  y.set_target_tab
-000598a0: 6c65 2854 4142 4c45 5f4f 4d5f 4441 5441  le(TABLE_OM_DATA
-000598b0: 5345 545f 4558 4543 5554 494f 4e29 0d0a  SET_EXECUTION)..
-000598c0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
-000598d0: 745f 7768 6572 655f 6669 6c74 6572 7328  t_where_filters(
-000598e0: 7768 6572 655f 6669 6c74 6572 5f6f 776e  where_filter_own
-000598f0: 6572 290d 0a20 2020 2020 2020 2063 6f6e  er)..        con
-00059900: 6e65 6374 696f 6e2e 6578 6563 7574 6528  nection.execute(
-00059910: 7374 7228 7175 6572 7929 290d 0a0d 0a20  str(query)).... 
-00059920: 2020 2020 2020 2071 7565 7279 203d 2051         query = Q
-00059930: 7565 7279 2829 0d0a 2020 2020 2020 2020  uery()..        
-00059940: 7175 6572 792e 7365 745f 6461 7461 6261  query.set_databa
-00059950: 7365 2863 6f6e 6e65 6374 696f 6e5f 7479  se(connection_ty
-00059960: 7065 290d 0a20 2020 2020 2020 2071 7565  pe)..        que
-00059970: 7279 2e73 6574 5f76 616c 7565 735f 6261  ry.set_values_ba
-00059980: 7463 6828 636f 6d6d 6974 5f76 616c 7565  tch(commit_value
-00059990: 735f 6261 7463 6829 0d0a 2020 2020 2020  s_batch)..      
-000599a0: 2020 7175 6572 792e 7365 745f 7479 7065    query.set_type
-000599b0: 2851 5545 5259 5f54 5950 455f 5641 4c55  (QUERY_TYPE_VALU
-000599c0: 4553 290d 0a20 2020 2020 2020 2071 7565  ES)..        que
-000599d0: 7279 2e73 6574 5f74 6172 6765 745f 7461  ry.set_target_ta
-000599e0: 626c 6528 5441 424c 455f 4f4d 5f44 4154  ble(TABLE_OM_DAT
-000599f0: 4153 4554 5f45 5845 4355 5449 4f4e 290d  ASET_EXECUTION).
-00059a00: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-00059a10: 6574 5f69 6e73 6572 745f 636f 6c75 6d6e  et_insert_column
-00059a20: 7328 434f 4c55 4d4e 535f 4f4d 5f44 4154  s(COLUMNS_OM_DAT
-00059a30: 4153 4554 5f45 5845 4355 5449 4f4e 290d  ASET_EXECUTION).
-00059a40: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
-00059a50: 6574 5f68 6173 5f68 6561 6465 7228 4661  et_has_header(Fa
-00059a60: 6c73 6529 0d0a 2020 2020 2020 2020 7175  lse)..        qu
-00059a70: 6572 792e 7365 745f 7661 6c75 6573 2873  ery.set_values(s
-00059a80: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
-00059a90: 6c6f 6164 2e6f 6d5f 6461 7461 7365 745f  load.om_dataset_
-00059aa0: 6578 6563 7574 696f 6e29 0d0a 2020 2020  execution)..    
-00059ab0: 2020 2020 636f 6e6e 6563 7469 6f6e 2e65      connection.e
-00059ac0: 7865 6375 7465 2873 7472 2871 7565 7279  xecute(str(query
-00059ad0: 2929 0d0a 0d0a 2020 2020 2020 2020 2320  ))....        # 
-00059ae0: 4f4d 5f44 4154 4153 4554 5f46 494c 450d  OM_DATASET_FILE.
-00059af0: 0a20 2020 2020 2020 2071 7565 7279 203d  .        query =
-00059b00: 2051 7565 7279 2829 0d0a 2020 2020 2020   Query()..      
-00059b10: 2020 7175 6572 792e 7365 745f 6461 7461    query.set_data
-00059b20: 6261 7365 2863 6f6e 6e65 6374 696f 6e5f  base(connection_
-00059b30: 7479 7065 290d 0a20 2020 2020 2020 2071  type)..        q
-00059b40: 7565 7279 2e73 6574 5f76 616c 7565 735f  uery.set_values_
-00059b50: 6261 7463 6828 636f 6d6d 6974 5f76 616c  batch(commit_val
-00059b60: 7565 735f 6261 7463 6829 0d0a 2020 2020  ues_batch)..    
-00059b70: 2020 2020 7175 6572 792e 7365 745f 7479      query.set_ty
-00059b80: 7065 2851 5545 5259 5f54 5950 455f 4445  pe(QUERY_TYPE_DE
-00059b90: 4c45 5445 290d 0a20 2020 2020 2020 2071  LETE)..        q
-00059ba0: 7565 7279 2e73 6574 5f74 6172 6765 745f  uery.set_target_
-00059bb0: 7461 626c 6528 5441 424c 455f 4f4d 5f44  table(TABLE_OM_D
-00059bc0: 4154 4153 4554 5f46 494c 4529 0d0a 2020  ATASET_FILE)..  
-00059bd0: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
-00059be0: 7768 6572 655f 6669 6c74 6572 7328 7768  where_filters(wh
-00059bf0: 6572 655f 6669 6c74 6572 5f6f 776e 6572  ere_filter_owner
-00059c00: 290d 0a20 2020 2020 2020 2063 6f6e 6e65  )..        conne
-00059c10: 6374 696f 6e2e 6578 6563 7574 6528 7374  ction.execute(st
-00059c20: 7228 7175 6572 7929 290d 0a0d 0a20 2020  r(query))....   
-00059c30: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
-00059c40: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
-00059c50: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
-00059c60: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
-00059c70: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00059c80: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
-00059c90: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
-00059ca0: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
-00059cb0: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
-00059cc0: 5545 5259 5f54 5950 455f 5641 4c55 4553  UERY_TYPE_VALUES
-00059cd0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
-00059ce0: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
-00059cf0: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
-00059d00: 4554 5f46 494c 4529 0d0a 2020 2020 2020  ET_FILE)..      
-00059d10: 2020 7175 6572 792e 7365 745f 696e 7365    query.set_inse
-00059d20: 7274 5f63 6f6c 756d 6e73 2843 4f4c 554d  rt_columns(COLUM
-00059d30: 4e53 5f4f 4d5f 4441 5441 5345 545f 4649  NS_OM_DATASET_FI
-00059d40: 4c45 290d 0a20 2020 2020 2020 2071 7565  LE)..        que
-00059d50: 7279 2e73 6574 5f68 6173 5f68 6561 6465  ry.set_has_heade
-00059d60: 7228 4661 6c73 6529 0d0a 2020 2020 2020  r(False)..      
-00059d70: 2020 7175 6572 792e 7365 745f 7661 6c75    query.set_valu
-00059d80: 6573 2873 656c 662e 6d65 7461 6461 7461  es(self.metadata
-00059d90: 5f74 6f5f 6c6f 6164 2e6f 6d5f 6461 7461  _to_load.om_data
-00059da0: 7365 745f 6669 6c65 290d 0a20 2020 2020  set_file)..     
-00059db0: 2020 2063 6f6e 6e65 6374 696f 6e2e 6578     connection.ex
-00059dc0: 6563 7574 6528 7374 7228 7175 6572 7929  ecute(str(query)
-00059dd0: 290d 0a0d 0a20 2020 2020 2020 2063 6f6e  )....        con
-00059de0: 6e65 6374 696f 6e2e 636f 6d6d 6974 2829  nection.commit()
-00059df0: 0d0a 2020 2020 2020 2020 636f 6e6e 6563  ..        connec
-00059e00: 7469 6f6e 2e63 6c6f 7365 2829 0d0a 0d0a  tion.close()....
-00059e10: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00059e20: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
-00059e30: 5f6e 616d 652c 2022 5570 6c6f 6164 696e  _name, "Uploadin
-00059e40: 6720 636f 6d70 6c65 7465 6422 2c20 4c4f  g completed", LO
-00059e50: 475f 4c45 5645 4c5f 494e 464f 290d 0a    G_LEVEL_INFO)..
+00056da0: 2227 2220 2b20 7374 7228 7265 6c61 7469  "'" + str(relati
+00056db0: 6f6e 7368 6970 2e73 7461 7274 5f64 6174  onship.start_dat
+00056dc0: 6529 202b 2022 2722 2c20 2227 2220 2b20  e) + "'", "'" + 
+00056dd0: 7374 7228 7265 6c61 7469 6f6e 7368 6970  str(relationship
+00056de0: 2e65 6e64 5f64 6174 6529 202b 2022 2722  .end_date) + "'"
+00056df0: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+00056e00: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+00056e10: 6c6f 6164 2e61 6464 5f6f 6d5f 6461 7461  load.add_om_data
+00056e20: 7365 745f 7265 6c61 7469 6f6e 7368 6970  set_relationship
+00056e30: 7328 5b6f 6c64 5f72 656c 6174 696f 6e73  s([old_relations
+00056e40: 6869 705d 290d 0a0d 0a20 2020 2020 2020  hip])....       
+00056e50: 2066 6f72 2061 6767 2069 6e20 5b78 2066   for agg in [x f
+00056e60: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
+00056e70: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
+00056e80: 6461 7461 7365 745f 745f 6167 6720 6966  dataset_t_agg if
+00056e90: 2078 2e65 6e64 5f64 6174 6520 6973 206e   x.end_date is n
+00056ea0: 6f74 204e 6f6e 655d 3a0d 0a20 2020 2020  ot None]:..     
+00056eb0: 2020 2020 2020 206e 6577 5f61 6767 203d         new_agg =
+00056ec0: 205b 6167 672e 6964 5f74 5f61 6767 2c20   [agg.id_t_agg, 
+00056ed0: 6167 672e 6964 5f64 6174 6173 6574 2c20  agg.id_dataset, 
+00056ee0: 6167 672e 6964 5f62 7261 6e63 682c 0d0a  agg.id_branch,..
+00056ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056f00: 2020 2020 2020 2061 6767 2e69 645f 6461         agg.id_da
+00056f10: 7461 7365 745f 7370 6563 2c0d 0a20 2020  taset_spec,..   
+00056f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056f30: 2020 2020 6167 672e 6d65 7461 5f6f 776e      agg.meta_own
+00056f40: 6572 2c20 2227 2220 2b20 7374 7228 6167  er, "'" + str(ag
+00056f50: 672e 7374 6172 745f 6461 7465 2920 2b20  g.start_date) + 
+00056f60: 2227 222c 2022 2722 202b 2073 7472 2861  "'", "'" + str(a
+00056f70: 6767 2e65 6e64 5f64 6174 6529 202b 2022  gg.end_date) + "
+00056f80: 2722 5d0d 0a20 2020 2020 2020 2020 2020  '"]..           
+00056f90: 2073 656c 662e 6d65 7461 6461 7461 5f74   self.metadata_t
+00056fa0: 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f 6461  o_load.add_om_da
+00056fb0: 7461 7365 745f 745f 6167 6728 5b6e 6577  taset_t_agg([new
+00056fc0: 5f61 6767 5d29 0d0a 0d0a 2020 2020 2020  _agg])....      
+00056fd0: 2020 666f 7220 6469 7374 696e 6374 2069    for distinct i
+00056fe0: 6e20 5b78 2066 6f72 2078 2069 6e20 7365  n [x for x in se
+00056ff0: 6c66 2e6d 6574 6164 6174 615f 6163 7475  lf.metadata_actu
+00057000: 616c 2e6f 6d5f 6461 7461 7365 745f 745f  al.om_dataset_t_
+00057010: 6469 7374 696e 6374 2069 6620 782e 656e  distinct if x.en
+00057020: 645f 6461 7465 2069 7320 6e6f 7420 4e6f  d_date is not No
+00057030: 6e65 5d3a 0d0a 2020 2020 2020 2020 2020  ne]:..          
+00057040: 2020 636c 6f73 655f 6469 7374 696e 6374    close_distinct
+00057050: 203d 205b 6469 7374 696e 6374 2e69 645f   = [distinct.id_
+00057060: 745f 6469 7374 696e 6374 2c20 6469 7374  t_distinct, dist
+00057070: 696e 6374 2e69 645f 6461 7461 7365 742c  inct.id_dataset,
+00057080: 2064 6973 7469 6e63 742e 6964 5f62 7261   distinct.id_bra
+00057090: 6e63 682c 2064 6973 7469 6e63 742e 7377  nch, distinct.sw
+000570a0: 5f64 6973 7469 6e63 740d 0a20 2020 2020  _distinct..     
+000570b0: 2020 2020 2020 2020 2020 202c 2064 6973             , dis
+000570c0: 7469 6e63 742e 6d65 7461 5f6f 776e 6572  tinct.meta_owner
+000570d0: 2c20 2227 2220 2b20 7374 7228 6469 7374  , "'" + str(dist
+000570e0: 696e 6374 2e73 7461 7274 5f64 6174 6529  inct.start_date)
+000570f0: 202b 2022 2722 2c20 2227 2220 2b20 7374   + "'", "'" + st
+00057100: 7228 6469 7374 696e 6374 2e65 6e64 5f64  r(distinct.end_d
+00057110: 6174 6529 202b 2022 2722 5d0d 0a20 2020  ate) + "'"]..   
+00057120: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+00057130: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e61  tadata_to_load.a
+00057140: 6464 5f6f 6d5f 6461 7461 7365 745f 745f  dd_om_dataset_t_
+00057150: 6469 7374 696e 6374 285b 636c 6f73 655f  distinct([close_
+00057160: 6469 7374 696e 6374 5d29 0d0a 0d0a 2020  distinct])....  
+00057170: 2020 2020 2020 666f 7220 6d61 7070 696e        for mappin
+00057180: 6720 696e 205b 7820 666f 7220 7820 696e  g in [x for x in
+00057190: 2073 656c 662e 6d65 7461 6461 7461 5f61   self.metadata_a
+000571a0: 6374 7561 6c2e 6f6d 5f64 6174 6173 6574  ctual.om_dataset
+000571b0: 5f74 5f6d 6170 7069 6e67 2069 6620 782e  _t_mapping if x.
+000571c0: 656e 645f 6461 7465 2069 7320 6e6f 7420  end_date is not 
+000571d0: 4e6f 6e65 5d3a 0d0a 2020 2020 2020 2020  None]:..        
+000571e0: 2020 2020 636c 6f73 655f 6d61 7070 696e      close_mappin
+000571f0: 6720 3d20 5b6d 6170 7069 6e67 2e69 645f  g = [mapping.id_
+00057200: 745f 6d61 7070 696e 672c 206d 6170 7069  t_mapping, mappi
+00057210: 6e67 2e69 645f 6272 616e 6368 2c0d 0a20  ng.id_branch,.. 
+00057220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057230: 2020 2020 2020 2020 2020 2020 6d61 7070              mapp
+00057240: 696e 672e 6964 5f64 6174 6173 6574 5f73  ing.id_dataset_s
+00057250: 7065 632c 206d 6170 7069 6e67 2e76 616c  pec, mapping.val
+00057260: 7565 5f6d 6170 7069 6e67 2c0d 0a20 2020  ue_mapping,..   
+00057270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057280: 2020 2020 2020 2020 2020 6d61 7070 696e            mappin
+00057290: 672e 6d65 7461 5f6f 776e 6572 2c20 2227  g.meta_owner, "'
+000572a0: 2220 2b20 7374 7228 6d61 7070 696e 672e  " + str(mapping.
+000572b0: 7374 6172 745f 6461 7465 2920 2b20 2227  start_date) + "'
+000572c0: 222c 2022 2722 202b 2073 7472 286d 6170  ", "'" + str(map
+000572d0: 7069 6e67 2e65 6e64 5f64 6174 6529 202b  ping.end_date) +
+000572e0: 2022 2722 5d0d 0a20 2020 2020 2020 2020   "'"]..         
+000572f0: 2020 2073 656c 662e 6d65 7461 6461 7461     self.metadata
+00057300: 5f74 6f5f 6c6f 6164 2e61 6464 5f6f 6d5f  _to_load.add_om_
+00057310: 6461 7461 7365 745f 745f 6d61 7070 696e  dataset_t_mappin
+00057320: 6728 5b63 6c6f 7365 5f6d 6170 7069 6e67  g([close_mapping
+00057330: 5d29 0d0a 0d0a 2020 2020 2020 2020 666f  ])....        fo
+00057340: 7220 6669 6c74 6572 2069 6e20 5b78 2066  r filter in [x f
+00057350: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
+00057360: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
+00057370: 6461 7461 7365 745f 745f 6669 6c74 6572  dataset_t_filter
+00057380: 2069 6620 782e 656e 645f 6461 7465 2069   if x.end_date i
+00057390: 7320 6e6f 7420 4e6f 6e65 5d3a 0d0a 2020  s not None]:..  
+000573a0: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
+000573b0: 6669 6c74 6572 203d 205b 6669 6c74 6572  filter = [filter
+000573c0: 2e69 645f 745f 6669 6c74 6572 2c20 6669  .id_t_filter, fi
+000573d0: 6c74 6572 2e69 645f 6461 7461 7365 742c  lter.id_dataset,
+000573e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000573f0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00057400: 6c74 6572 2e69 645f 6272 616e 6368 2c0d  lter.id_branch,.
+00057410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057420: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00057430: 7465 722e 7661 6c75 655f 6669 6c74 6572  ter.value_filter
+00057440: 2c20 6669 6c74 6572 2e6d 6574 615f 6f77  , filter.meta_ow
+00057450: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
+00057460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057470: 2020 2227 2220 2b20 7374 7228 6669 6c74    "'" + str(filt
+00057480: 6572 2e73 7461 7274 5f64 6174 6529 202b  er.start_date) +
+00057490: 2022 2722 2c20 2227 2220 2b20 7374 7228   "'", "'" + str(
+000574a0: 6669 6c74 6572 2e65 6e64 5f64 6174 6529  filter.end_date)
+000574b0: 202b 2022 2722 5d0d 0a20 2020 2020 2020   + "'"]..       
+000574c0: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000574d0: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
+000574e0: 6d5f 6461 7461 7365 745f 745f 6669 6c74  m_dataset_t_filt
+000574f0: 6572 285b 636c 6f73 655f 6669 6c74 6572  er([close_filter
+00057500: 5d29 0d0a 0d0a 2020 2020 2020 2020 666f  ])....        fo
+00057510: 7220 6861 7669 6e67 2069 6e20 5b78 2066  r having in [x f
+00057520: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
+00057530: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
+00057540: 6461 7461 7365 745f 745f 6861 7669 6e67  dataset_t_having
+00057550: 2069 6620 782e 656e 645f 6461 7465 2069   if x.end_date i
+00057560: 7320 6e6f 7420 4e6f 6e65 5d3a 0d0a 2020  s not None]:..  
+00057570: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
+00057580: 6861 7669 6e67 203d 205b 6861 7669 6e67  having = [having
+00057590: 2e69 645f 745f 6861 7669 6e67 2c20 6861  .id_t_having, ha
+000575a0: 7669 6e67 2e69 645f 6461 7461 7365 742c  ving.id_dataset,
+000575b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000575c0: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+000575d0: 7669 6e67 2e69 645f 6272 616e 6368 2c0d  ving.id_branch,.
+000575e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000575f0: 2020 2020 2020 2020 2020 2020 2068 6176               hav
+00057600: 696e 672e 7661 6c75 655f 6861 7669 6e67  ing.value_having
+00057610: 2c20 6861 7669 6e67 2e6d 6574 615f 6f77  , having.meta_ow
+00057620: 6e65 722c 0d0a 2020 2020 2020 2020 2020  ner,..          
+00057630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057640: 2020 2227 2220 2b20 7374 7228 6861 7669    "'" + str(havi
+00057650: 6e67 2e73 7461 7274 5f64 6174 6529 202b  ng.start_date) +
+00057660: 2022 2722 2c20 2227 2220 2b20 7374 7228   "'", "'" + str(
+00057670: 6861 7669 6e67 2e65 6e64 5f64 6174 6529  having.end_date)
+00057680: 202b 2022 2722 5d0d 0a20 2020 2020 2020   + "'"]..       
+00057690: 2020 2020 2073 656c 662e 6d65 7461 6461       self.metada
+000576a0: 7461 5f74 6f5f 6c6f 6164 2e61 6464 5f6f  ta_to_load.add_o
+000576b0: 6d5f 6461 7461 7365 745f 745f 6861 7669  m_dataset_t_havi
+000576c0: 6e67 285b 636c 6f73 655f 6861 7669 6e67  ng([close_having
+000576d0: 5d29 0d0a 0d0a 2020 2020 2020 2020 666f  ])....        fo
+000576e0: 7220 6578 6563 7574 696f 6e20 696e 205b  r execution in [
+000576f0: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
+00057700: 6d65 7461 6461 7461 5f61 6374 7561 6c2e  metadata_actual.
+00057710: 6f6d 5f64 6174 6173 6574 5f65 7865 6375  om_dataset_execu
+00057720: 7469 6f6e 2069 6620 782e 656e 645f 6461  tion if x.end_da
+00057730: 7465 2069 7320 6e6f 7420 4e6f 6e65 5d3a  te is not None]:
+00057740: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00057750: 636c 6f73 655f 6578 6563 7574 696f 6e20  close_execution 
+00057760: 3d20 5b65 7865 6375 7469 6f6e 2e69 645f  = [execution.id_
+00057770: 6461 7461 7365 742c 2065 7865 6375 7469  dataset, executi
+00057780: 6f6e 2e69 645f 7175 6572 795f 7479 7065  on.id_query_type
+00057790: 2c20 6578 6563 7574 696f 6e2e 6d65 7461  , execution.meta
+000577a0: 5f6f 776e 6572 2c0d 0a20 2020 2020 2020  _owner,..       
+000577b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000577c0: 2020 2020 2020 2020 2227 2220 2b73 7472          "'" +str
+000577d0: 2865 7865 6375 7469 6f6e 2e73 7461 7274  (execution.start
+000577e0: 5f64 6174 6529 2b20 2227 222c 2022 2722  _date)+ "'", "'"
+000577f0: 202b 7374 7228 6578 6563 7574 696f 6e2e   +str(execution.
+00057800: 656e 645f 6461 7465 292b 2022 2722 5d0d  end_date)+ "'"].
+00057810: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00057820: 662e 6d65 7461 6461 7461 5f74 6f5f 6c6f  f.metadata_to_lo
+00057830: 6164 2e61 6464 5f6f 6d5f 6461 7461 7365  ad.add_om_datase
+00057840: 745f 6578 6563 7574 696f 6e28 5b63 6c6f  t_execution([clo
+00057850: 7365 5f65 7865 6375 7469 6f6e 5d29 0d0a  se_execution])..
+00057860: 0d0a 2020 2020 2020 2020 666f 7220 6461  ..        for da
+00057870: 7461 7365 745f 6476 2069 6e20 5b78 2066  taset_dv in [x f
+00057880: 6f72 2078 2069 6e20 7365 6c66 2e6d 6574  or x in self.met
+00057890: 6164 6174 615f 6163 7475 616c 2e6f 6d5f  adata_actual.om_
+000578a0: 6461 7461 7365 745f 6476 2069 6620 782e  dataset_dv if x.
+000578b0: 656e 645f 6461 7465 2069 7320 6e6f 7420  end_date is not 
+000578c0: 4e6f 6e65 5d3a 0d0a 0d0a 2020 2020 2020  None]:....      
+000578d0: 2020 2020 2020 636c 6f73 655f 6461 7461        close_data
+000578e0: 7365 745f 6476 203d 205b 6461 7461 7365  set_dv = [datase
+000578f0: 745f 6476 2e69 645f 6461 7461 7365 742c  t_dv.id_dataset,
+00057900: 2064 6174 6173 6574 5f64 762e 6964 5f65   dataset_dv.id_e
+00057910: 6e74 6974 795f 7479 7065 2c20 6461 7461  ntity_type, data
+00057920: 7365 745f 6476 2e6d 6574 615f 6f77 6e65  set_dv.meta_owne
+00057930: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
+00057940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057950: 2020 2022 2722 202b 7374 7228 6461 7461     "'" +str(data
+00057960: 7365 745f 6476 2e73 7461 7274 5f64 6174  set_dv.start_dat
+00057970: 6529 2b20 2227 222c 2022 2722 202b 7374  e)+ "'", "'" +st
+00057980: 7228 6461 7461 7365 745f 6476 2e65 6e64  r(dataset_dv.end
+00057990: 5f64 6174 6529 2b20 2227 225d 0d0a 2020  _date)+ "'"]..  
+000579a0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+000579b0: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
+000579c0: 6164 645f 6f6d 5f64 6174 6173 6574 5f64  add_om_dataset_d
+000579d0: 7628 5b63 6c6f 7365 5f64 6174 6173 6574  v([close_dataset
+000579e0: 5f64 765d 290d 0a0d 0a20 2020 2020 2020  _dv])....       
+000579f0: 2073 656c 662e 6c6f 672e 6c6f 6728 7365   self.log.log(se
+00057a00: 6c66 2e65 6e67 696e 655f 6e61 6d65 2c20  lf.engine_name, 
+00057a10: 2246 696e 6973 6865 6420 746f 2070 726f  "Finished to pro
+00057a20: 6365 7373 204d 6574 6164 6174 6120 5b20  cess Metadata [ 
+00057a30: 4869 7374 6f72 6963 616c 205d 2069 6e66  Historical ] inf
+00057a40: 6f72 6d61 7469 6f6e 222c 204c 4f47 5f4c  ormation", LOG_L
+00057a50: 4556 454c 5f4f 4e4c 595f 4c4f 4729 0d0a  EVEL_ONLY_LOG)..
+00057a60: 0d0a 2020 2020 6465 6620 7072 6f63 6573  ..    def proces
+00057a70: 735f 6476 2873 656c 6629 3a0d 0a20 2020  s_dv(self):..   
+00057a80: 2020 2020 2073 656c 662e 6c6f 672e 6c6f       self.log.lo
+00057a90: 6728 7365 6c66 2e65 6e67 696e 655f 6e61  g(self.engine_na
+00057aa0: 6d65 2c20 2253 7461 7274 696e 6720 746f  me, "Starting to
+00057ab0: 2070 726f 6365 7373 204d 6574 6164 6174   process Metadat
+00057ac0: 6120 6672 6f6d 2044 5620 4d6f 6475 6c65  a from DV Module
+00057ad0: 222c 204c 4f47 5f4c 4556 454c 5f49 4e46  ", LOG_LEVEL_INF
+00057ae0: 4f29 0d0a 0d0a 2020 2020 2020 2020 7365  O)....        se
+00057af0: 6c66 2e70 726f 6365 7373 5f64 765f 6875  lf.process_dv_hu
+00057b00: 6228 290d 0a20 2020 2020 2020 2073 656c  b()..        sel
+00057b10: 662e 7072 6f63 6573 735f 6476 5f6c 696e  f.process_dv_lin
+00057b20: 6b28 290d 0a0d 0a20 2020 2020 2020 2073  k()....        s
+00057b30: 656c 662e 6c6f 672e 6c6f 6728 7365 6c66  elf.log.log(self
+00057b40: 2e65 6e67 696e 655f 6e61 6d65 2c20 2246  .engine_name, "F
+00057b50: 696e 6973 6865 6420 746f 2070 726f 6365  inished to proce
+00057b60: 7373 204d 6574 6164 6174 6120 6672 6f6d  ss Metadata from
+00057b70: 2044 5620 4d6f 6475 6c65 222c 204c 4f47   DV Module", LOG
+00057b80: 5f4c 4556 454c 5f49 4e46 4f29 0d0a 0d0a  _LEVEL_INFO)....
+00057b90: 2020 2020 6465 6620 7072 6f63 6573 735f      def process_
+00057ba0: 6476 5f66 696e 616c 2873 656c 6629 3a0d  dv_final(self):.
+00057bb0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00057bc0: 672e 6c6f 6728 7365 6c66 2e65 6e67 696e  g.log(self.engin
+00057bd0: 655f 6e61 6d65 2c20 2253 7461 7274 696e  e_name, "Startin
+00057be0: 6720 746f 2070 726f 6365 7373 204d 6574  g to process Met
+00057bf0: 6164 6174 6120 4456 205b 2065 6e64 2070  adata DV [ end p
+00057c00: 6861 7365 205d 222c 204c 4f47 5f4c 4556  hase ]", LOG_LEV
+00057c10: 454c 5f49 4e46 4f29 0d0a 0d0a 2020 2020  EL_INFO)....    
+00057c20: 2020 2020 7365 6c66 2e70 726f 6365 7373      self.process
+00057c30: 5f64 765f 7072 6f70 6572 7469 6573 2829  _dv_properties()
+00057c40: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00057c50: 2e6c 6f67 2e6c 6f67 2873 656c 662e 656e  .log.log(self.en
+00057c60: 6769 6e65 5f6e 616d 652c 2022 4669 6e69  gine_name, "Fini
+00057c70: 7368 6564 2074 6f20 7072 6f63 6573 7320  shed to process 
+00057c80: 4d65 7461 6461 7461 2044 5620 5b20 656e  Metadata DV [ en
+00057c90: 6420 7068 6173 6520 5d22 2c20 4c4f 475f  d phase ]", LOG_
+00057ca0: 4c45 5645 4c5f 494e 464f 290d 0a0d 0a20  LEVEL_INFO).... 
+00057cb0: 2020 2064 6566 2075 706c 6f61 645f 6d65     def upload_me
+00057cc0: 7461 6461 7461 2873 656c 6629 3a0d 0a20  tadata(self):.. 
+00057cd0: 2020 2020 2020 2073 656c 662e 6c6f 672e         self.log.
+00057ce0: 6c6f 6728 7365 6c66 2e65 6e67 696e 655f  log(self.engine_
+00057cf0: 6e61 6d65 2c20 2253 7461 7274 696e 6720  name, "Starting 
+00057d00: 746f 2075 706c 6f61 6420 616c 6c20 7468  to upload all th
+00057d10: 6520 6d65 7461 6461 7461 2070 726f 6365  e metadata proce
+00057d20: 7373 6564 222c 204c 4f47 5f4c 4556 454c  ssed", LOG_LEVEL
+00057d30: 5f49 4e46 4f29 0d0a 0d0a 2020 2020 2020  _INFO)....      
+00057d40: 2020 636f 6e6e 6563 7469 6f6e 5f74 7970    connection_typ
+00057d50: 6520 3d20 7365 6c66 2e63 6f6e 6669 6775  e = self.configu
+00057d60: 7261 7469 6f6e 5f66 696c 655b 276d 6574  ration_file['met
+00057d70: 6164 6174 6127 5d5b 2763 6f6e 6e65 6374  adata']['connect
+00057d80: 696f 6e5f 7479 7065 275d 0d0a 2020 2020  ion_type']..    
+00057d90: 2020 2020 636f 6e6e 6563 7469 6f6e 203d      connection =
+00057da0: 2043 6f6e 6e65 6374 696f 6e46 6163 746f   ConnectionFacto
+00057db0: 7279 2829 2e67 6574 5f63 6f6e 6e65 6374  ry().get_connect
+00057dc0: 696f 6e28 636f 6e6e 6563 7469 6f6e 5f74  ion(connection_t
+00057dd0: 7970 6529 0d0a 2020 2020 2020 2020 636f  ype)..        co
+00057de0: 6e6e 6563 7469 6f6e 2e73 6574 7570 5f63  nnection.setup_c
+00057df0: 6f6e 6e65 6374 696f 6e28 7365 6c66 2e63  onnection(self.c
+00057e00: 6f6e 6669 6775 7261 7469 6f6e 5f66 696c  onfiguration_fil
+00057e10: 655b 276d 6574 6164 6174 6127 5d2c 2073  e['metadata'], s
+00057e20: 656c 662e 6c6f 6729 0d0a 2020 2020 2020  elf.log)..      
+00057e30: 2020 7768 6572 655f 6669 6c74 6572 5f6f    where_filter_o
+00057e40: 776e 6572 203d 2022 4d45 5441 5f4f 574e  wner = "META_OWN
+00057e50: 4552 3d27 2220 2b20 7365 6c66 2e6f 776e  ER='" + self.own
+00057e60: 6572 202b 2022 2722 0d0a 2020 2020 2020  er + "'"..      
+00057e70: 2020 636f 6d6d 6974 5f76 616c 7565 735f    commit_values_
+00057e80: 6261 7463 6820 3d20 7365 6c66 2e70 726f  batch = self.pro
+00057e90: 7065 7274 6965 735f 6669 6c65 5b27 6f70  perties_file['op
+00057ea0: 7469 6f6e 7327 5d5b 276d 6178 5f63 6f6d  tions']['max_com
+00057eb0: 6d69 745f 6261 7463 6827 5d0d 0a0d 0a20  mit_batch'].... 
+00057ec0: 2020 2020 2020 2023 204f 4d5f 4441 5441         # OM_DATA
+00057ed0: 5345 545f 5041 5448 0d0a 2020 2020 2020  SET_PATH..      
+00057ee0: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
+00057ef0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00057f00: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
+00057f10: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
+00057f20: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00057f30: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
+00057f40: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
+00057f50: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
+00057f60: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
+00057f70: 595f 5459 5045 5f44 454c 4554 4529 0d0a  Y_TYPE_DELETE)..
+00057f80: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00057f90: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
+00057fa0: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
+00057fb0: 5041 5448 290d 0a20 2020 2020 2020 2071  PATH)..        q
+00057fc0: 7565 7279 2e73 6574 5f77 6865 7265 5f66  uery.set_where_f
+00057fd0: 696c 7465 7273 2877 6865 7265 5f66 696c  ilters(where_fil
+00057fe0: 7465 725f 6f77 6e65 7229 0d0a 2020 2020  ter_owner)..    
+00057ff0: 2020 2020 636f 6e6e 6563 7469 6f6e 2e65      connection.e
+00058000: 7865 6375 7465 2873 7472 2871 7565 7279  xecute(str(query
+00058010: 2929 0d0a 0d0a 2020 2020 2020 2020 7175  ))....        qu
+00058020: 6572 7920 3d20 5175 6572 7928 290d 0a20  ery = Query().. 
+00058030: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+00058040: 5f64 6174 6162 6173 6528 636f 6e6e 6563  _database(connec
+00058050: 7469 6f6e 5f74 7970 6529 0d0a 2020 2020  tion_type)..    
+00058060: 2020 2020 7175 6572 792e 7365 745f 7661      query.set_va
+00058070: 6c75 6573 5f62 6174 6368 2863 6f6d 6d69  lues_batch(commi
+00058080: 745f 7661 6c75 6573 5f62 6174 6368 290d  t_values_batch).
+00058090: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+000580a0: 6574 5f74 7970 6528 5155 4552 595f 5459  et_type(QUERY_TY
+000580b0: 5045 5f56 414c 5545 5329 0d0a 2020 2020  PE_VALUES)..    
+000580c0: 2020 2020 7175 6572 792e 7365 745f 7461      query.set_ta
+000580d0: 7267 6574 5f74 6162 6c65 2854 4142 4c45  rget_table(TABLE
+000580e0: 5f4f 4d5f 4441 5441 5345 545f 5041 5448  _OM_DATASET_PATH
+000580f0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058100: 2e73 6574 5f69 6e73 6572 745f 636f 6c75  .set_insert_colu
+00058110: 6d6e 7328 434f 4c55 4d4e 535f 4f4d 5f44  mns(COLUMNS_OM_D
+00058120: 4154 4153 4554 5f50 4154 4829 0d0a 2020  ATASET_PATH)..  
+00058130: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
+00058140: 6861 735f 6865 6164 6572 2846 616c 7365  has_header(False
+00058150: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058160: 2e73 6574 5f76 616c 7565 7328 7365 6c66  .set_values(self
+00058170: 2e6d 6574 6164 6174 615f 746f 5f6c 6f61  .metadata_to_loa
+00058180: 642e 6f6d 5f64 6174 6173 6574 5f70 6174  d.om_dataset_pat
+00058190: 6829 0d0a 2020 2020 2020 2020 636f 6e6e  h)..        conn
+000581a0: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
+000581b0: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
+000581c0: 2020 2020 2020 2320 4f4d 5f44 4154 4153        # OM_DATAS
+000581d0: 4554 0d0a 2020 2020 2020 2020 7175 6572  ET..        quer
+000581e0: 7920 3d20 5175 6572 7928 290d 0a20 2020  y = Query()..   
+000581f0: 2020 2020 2071 7565 7279 2e73 6574 5f64       query.set_d
+00058200: 6174 6162 6173 6528 636f 6e6e 6563 7469  atabase(connecti
+00058210: 6f6e 5f74 7970 6529 0d0a 2020 2020 2020  on_type)..      
+00058220: 2020 7175 6572 792e 7365 745f 7661 6c75    query.set_valu
+00058230: 6573 5f62 6174 6368 2863 6f6d 6d69 745f  es_batch(commit_
+00058240: 7661 6c75 6573 5f62 6174 6368 290d 0a20  values_batch).. 
+00058250: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+00058260: 5f74 7970 6528 5155 4552 595f 5459 5045  _type(QUERY_TYPE
+00058270: 5f44 454c 4554 4529 0d0a 2020 2020 2020  _DELETE)..      
+00058280: 2020 7175 6572 792e 7365 745f 7461 7267    query.set_targ
+00058290: 6574 5f74 6162 6c65 2854 4142 4c45 5f4f  et_table(TABLE_O
+000582a0: 4d5f 4441 5441 5345 5429 0d0a 2020 2020  M_DATASET)..    
+000582b0: 2020 2020 7175 6572 792e 7365 745f 7768      query.set_wh
+000582c0: 6572 655f 6669 6c74 6572 7328 7768 6572  ere_filters(wher
+000582d0: 655f 6669 6c74 6572 5f6f 776e 6572 290d  e_filter_owner).
+000582e0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+000582f0: 696f 6e2e 6578 6563 7574 6528 7374 7228  ion.execute(str(
+00058300: 7175 6572 7929 290d 0a0d 0a20 2020 2020  query))....     
+00058310: 2020 2071 7565 7279 203d 2051 7565 7279     query = Query
+00058320: 2829 0d0a 2020 2020 2020 2020 7175 6572  ()..        quer
+00058330: 792e 7365 745f 6461 7461 6261 7365 2863  y.set_database(c
+00058340: 6f6e 6e65 6374 696f 6e5f 7479 7065 290d  onnection_type).
+00058350: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+00058360: 6574 5f76 616c 7565 735f 6261 7463 6828  et_values_batch(
+00058370: 636f 6d6d 6974 5f76 616c 7565 735f 6261  commit_values_ba
+00058380: 7463 6829 0d0a 2020 2020 2020 2020 7175  tch)..        qu
+00058390: 6572 792e 7365 745f 7479 7065 2851 5545  ery.set_type(QUE
+000583a0: 5259 5f54 5950 455f 5641 4c55 4553 290d  RY_TYPE_VALUES).
+000583b0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+000583c0: 6574 5f74 6172 6765 745f 7461 626c 6528  et_target_table(
+000583d0: 5441 424c 455f 4f4d 5f44 4154 4153 4554  TABLE_OM_DATASET
+000583e0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+000583f0: 2e73 6574 5f69 6e73 6572 745f 636f 6c75  .set_insert_colu
+00058400: 6d6e 7328 434f 4c55 4d4e 535f 4f4d 5f44  mns(COLUMNS_OM_D
+00058410: 4154 4153 4554 290d 0a20 2020 2020 2020  ATASET)..       
+00058420: 2071 7565 7279 2e73 6574 5f68 6173 5f68   query.set_has_h
+00058430: 6561 6465 7228 4661 6c73 6529 0d0a 2020  eader(False)..  
+00058440: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
+00058450: 7661 6c75 6573 2873 656c 662e 6d65 7461  values(self.meta
+00058460: 6461 7461 5f74 6f5f 6c6f 6164 2e6f 6d5f  data_to_load.om_
+00058470: 6461 7461 7365 7429 0d0a 2020 2020 2020  dataset)..      
+00058480: 2020 636f 6e6e 6563 7469 6f6e 2e65 7865    connection.exe
+00058490: 6375 7465 2873 7472 2871 7565 7279 2929  cute(str(query))
+000584a0: 0d0a 0d0a 2020 2020 2020 2020 2320 4f4d  ....        # OM
+000584b0: 5f44 4154 4153 4554 5f44 560d 0a20 2020  _DATASET_DV..   
+000584c0: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
+000584d0: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
+000584e0: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
+000584f0: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
+00058500: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058510: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
+00058520: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
+00058530: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
+00058540: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
+00058550: 5545 5259 5f54 5950 455f 4445 4c45 5445  UERY_TYPE_DELETE
+00058560: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058570: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
+00058580: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
+00058590: 4554 5f44 5629 0d0a 2020 2020 2020 2020  ET_DV)..        
+000585a0: 7175 6572 792e 7365 745f 7768 6572 655f  query.set_where_
+000585b0: 6669 6c74 6572 7328 7768 6572 655f 6669  filters(where_fi
+000585c0: 6c74 6572 5f6f 776e 6572 290d 0a20 2020  lter_owner)..   
+000585d0: 2020 2020 2063 6f6e 6e65 6374 696f 6e2e       connection.
+000585e0: 6578 6563 7574 6528 7374 7228 7175 6572  execute(str(quer
+000585f0: 7929 290d 0a0d 0a20 2020 2020 2020 2071  y))....        q
+00058600: 7565 7279 203d 2051 7565 7279 2829 0d0a  uery = Query()..
+00058610: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00058620: 745f 6461 7461 6261 7365 2863 6f6e 6e65  t_database(conne
+00058630: 6374 696f 6e5f 7479 7065 290d 0a20 2020  ction_type)..   
+00058640: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
+00058650: 616c 7565 735f 6261 7463 6828 636f 6d6d  alues_batch(comm
+00058660: 6974 5f76 616c 7565 735f 6261 7463 6829  it_values_batch)
+00058670: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+00058680: 7365 745f 7479 7065 2851 5545 5259 5f54  set_type(QUERY_T
+00058690: 5950 455f 5641 4c55 4553 290d 0a20 2020  YPE_VALUES)..   
+000586a0: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
+000586b0: 6172 6765 745f 7461 626c 6528 5441 424c  arget_table(TABL
+000586c0: 455f 4f4d 5f44 4154 4153 4554 5f44 5629  E_OM_DATASET_DV)
+000586d0: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+000586e0: 7365 745f 696e 7365 7274 5f63 6f6c 756d  set_insert_colum
+000586f0: 6e73 2843 4f4c 554d 4e53 5f4f 4d5f 4441  ns(COLUMNS_OM_DA
+00058700: 5441 5345 545f 4456 290d 0a20 2020 2020  TASET_DV)..     
+00058710: 2020 2071 7565 7279 2e73 6574 5f68 6173     query.set_has
+00058720: 5f68 6561 6465 7228 4661 6c73 6529 0d0a  _header(False)..
+00058730: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00058740: 745f 7661 6c75 6573 2873 656c 662e 6d65  t_values(self.me
+00058750: 7461 6461 7461 5f74 6f5f 6c6f 6164 2e6f  tadata_to_load.o
+00058760: 6d5f 6461 7461 7365 745f 6476 290d 0a20  m_dataset_dv).. 
+00058770: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00058780: 6e2e 6578 6563 7574 6528 7374 7228 7175  n.execute(str(qu
+00058790: 6572 7929 290d 0a0d 0a20 2020 2020 2020  ery))....       
+000587a0: 2023 204f 4d5f 4441 5441 5345 545f 5350   # OM_DATASET_SP
+000587b0: 4543 4946 4943 4154 494f 4e0d 0a20 2020  ECIFICATION..   
+000587c0: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
+000587d0: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
+000587e0: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
+000587f0: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
+00058800: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058810: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
+00058820: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
+00058830: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
+00058840: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
+00058850: 5545 5259 5f54 5950 455f 4445 4c45 5445  UERY_TYPE_DELETE
+00058860: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058870: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
+00058880: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
+00058890: 4554 5f53 5045 4349 4649 4341 5449 4f4e  ET_SPECIFICATION
+000588a0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+000588b0: 2e73 6574 5f77 6865 7265 5f66 696c 7465  .set_where_filte
+000588c0: 7273 2877 6865 7265 5f66 696c 7465 725f  rs(where_filter_
+000588d0: 6f77 6e65 7229 0d0a 2020 2020 2020 2020  owner)..        
+000588e0: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
+000588f0: 7465 2873 7472 2871 7565 7279 2929 0d0a  te(str(query))..
+00058900: 0d0a 2020 2020 2020 2020 7175 6572 7920  ..        query 
+00058910: 3d20 5175 6572 7928 290d 0a20 2020 2020  = Query()..     
+00058920: 2020 2071 7565 7279 2e73 6574 5f64 6174     query.set_dat
+00058930: 6162 6173 6528 636f 6e6e 6563 7469 6f6e  abase(connection
+00058940: 5f74 7970 6529 0d0a 2020 2020 2020 2020  _type)..        
+00058950: 7175 6572 792e 7365 745f 7661 6c75 6573  query.set_values
+00058960: 5f62 6174 6368 2863 6f6d 6d69 745f 7661  _batch(commit_va
+00058970: 6c75 6573 5f62 6174 6368 290d 0a20 2020  lues_batch)..   
+00058980: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
+00058990: 7970 6528 5155 4552 595f 5459 5045 5f56  ype(QUERY_TYPE_V
+000589a0: 414c 5545 5329 0d0a 2020 2020 2020 2020  ALUES)..        
+000589b0: 7175 6572 792e 7365 745f 7461 7267 6574  query.set_target
+000589c0: 5f74 6162 6c65 2854 4142 4c45 5f4f 4d5f  _table(TABLE_OM_
+000589d0: 4441 5441 5345 545f 5350 4543 4946 4943  DATASET_SPECIFIC
+000589e0: 4154 494f 4e29 0d0a 2020 2020 2020 2020  ATION)..        
+000589f0: 7175 6572 792e 7365 745f 696e 7365 7274  query.set_insert
+00058a00: 5f63 6f6c 756d 6e73 2843 4f4c 554d 4e53  _columns(COLUMNS
+00058a10: 5f4f 4d5f 4441 5441 5345 545f 5350 4543  _OM_DATASET_SPEC
+00058a20: 4946 4943 4154 494f 4e29 0d0a 2020 2020  IFICATION)..    
+00058a30: 2020 2020 7175 6572 792e 7365 745f 6861      query.set_ha
+00058a40: 735f 6865 6164 6572 2846 616c 7365 290d  s_header(False).
+00058a50: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+00058a60: 6574 5f76 616c 7565 7328 7365 6c66 2e6d  et_values(self.m
+00058a70: 6574 6164 6174 615f 746f 5f6c 6f61 642e  etadata_to_load.
+00058a80: 6f6d 5f64 6174 6173 6574 5f73 7065 6369  om_dataset_speci
+00058a90: 6669 6361 7469 6f6e 290d 0a20 2020 2020  fication)..     
+00058aa0: 2020 2063 6f6e 6e65 6374 696f 6e2e 6578     connection.ex
+00058ab0: 6563 7574 6528 7374 7228 7175 6572 7929  ecute(str(query)
+00058ac0: 290d 0a0d 0a20 2020 2020 2020 2023 204f  )....        # O
+00058ad0: 4d5f 4441 5441 5345 545f 5245 4c41 5449  M_DATASET_RELATI
+00058ae0: 4f4e 5348 4950 530d 0a20 2020 2020 2020  ONSHIPS..       
+00058af0: 2071 7565 7279 203d 2051 7565 7279 2829   query = Query()
+00058b00: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+00058b10: 7365 745f 6461 7461 6261 7365 2863 6f6e  set_database(con
+00058b20: 6e65 6374 696f 6e5f 7479 7065 290d 0a20  nection_type).. 
+00058b30: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+00058b40: 5f76 616c 7565 735f 6261 7463 6828 636f  _values_batch(co
+00058b50: 6d6d 6974 5f76 616c 7565 735f 6261 7463  mmit_values_batc
+00058b60: 6829 0d0a 2020 2020 2020 2020 7175 6572  h)..        quer
+00058b70: 792e 7365 745f 7479 7065 2851 5545 5259  y.set_type(QUERY
+00058b80: 5f54 5950 455f 4445 4c45 5445 290d 0a20  _TYPE_DELETE).. 
+00058b90: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+00058ba0: 5f74 6172 6765 745f 7461 626c 6528 5441  _target_table(TA
+00058bb0: 424c 455f 4f4d 5f44 4154 4153 4554 5f52  BLE_OM_DATASET_R
+00058bc0: 454c 4154 494f 4e53 4849 5053 290d 0a20  ELATIONSHIPS).. 
+00058bd0: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+00058be0: 5f77 6865 7265 5f66 696c 7465 7273 2877  _where_filters(w
+00058bf0: 6865 7265 5f66 696c 7465 725f 6f77 6e65  here_filter_owne
+00058c00: 7229 0d0a 2020 2020 2020 2020 636f 6e6e  r)..        conn
+00058c10: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
+00058c20: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
+00058c30: 2020 2020 2020 7175 6572 7920 3d20 5175        query = Qu
+00058c40: 6572 7928 290d 0a20 2020 2020 2020 2071  ery()..        q
+00058c50: 7565 7279 2e73 6574 5f64 6174 6162 6173  uery.set_databas
+00058c60: 6528 636f 6e6e 6563 7469 6f6e 5f74 7970  e(connection_typ
+00058c70: 6529 0d0a 2020 2020 2020 2020 7175 6572  e)..        quer
+00058c80: 792e 7365 745f 7661 6c75 6573 5f62 6174  y.set_values_bat
+00058c90: 6368 2863 6f6d 6d69 745f 7661 6c75 6573  ch(commit_values
+00058ca0: 5f62 6174 6368 290d 0a20 2020 2020 2020  _batch)..       
+00058cb0: 2071 7565 7279 2e73 6574 5f74 7970 6528   query.set_type(
+00058cc0: 5155 4552 595f 5459 5045 5f56 414c 5545  QUERY_TYPE_VALUE
+00058cd0: 5329 0d0a 2020 2020 2020 2020 7175 6572  S)..        quer
+00058ce0: 792e 7365 745f 7461 7267 6574 5f74 6162  y.set_target_tab
+00058cf0: 6c65 2854 4142 4c45 5f4f 4d5f 4441 5441  le(TABLE_OM_DATA
+00058d00: 5345 545f 5245 4c41 5449 4f4e 5348 4950  SET_RELATIONSHIP
+00058d10: 5329 0d0a 2020 2020 2020 2020 7175 6572  S)..        quer
+00058d20: 792e 7365 745f 696e 7365 7274 5f63 6f6c  y.set_insert_col
+00058d30: 756d 6e73 2843 4f4c 554d 4e53 5f4f 4d5f  umns(COLUMNS_OM_
+00058d40: 4441 5441 5345 545f 5245 4c41 5449 4f4e  DATASET_RELATION
+00058d50: 5348 4950 5329 0d0a 2020 2020 2020 2020  SHIPS)..        
+00058d60: 7175 6572 792e 7365 745f 6861 735f 6865  query.set_has_he
+00058d70: 6164 6572 2846 616c 7365 290d 0a20 2020  ader(False)..   
+00058d80: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
+00058d90: 616c 7565 7328 7365 6c66 2e6d 6574 6164  alues(self.metad
+00058da0: 6174 615f 746f 5f6c 6f61 642e 6f6d 5f64  ata_to_load.om_d
+00058db0: 6174 6173 6574 5f72 656c 6174 696f 6e73  ataset_relations
+00058dc0: 6869 7073 290d 0a20 2020 2020 2020 2063  hips)..        c
+00058dd0: 6f6e 6e65 6374 696f 6e2e 6578 6563 7574  onnection.execut
+00058de0: 6528 7374 7228 7175 6572 7929 290d 0a0d  e(str(query))...
+00058df0: 0a20 2020 2020 2020 2023 204f 4d5f 4441  .        # OM_DA
+00058e00: 5441 5345 545f 545f 4147 470d 0a20 2020  TASET_T_AGG..   
+00058e10: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
+00058e20: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
+00058e30: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
+00058e40: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
+00058e50: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058e60: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
+00058e70: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
+00058e80: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
+00058e90: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
+00058ea0: 5545 5259 5f54 5950 455f 4445 4c45 5445  UERY_TYPE_DELETE
+00058eb0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058ec0: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
+00058ed0: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
+00058ee0: 4554 5f54 5f41 4747 290d 0a20 2020 2020  ET_T_AGG)..     
+00058ef0: 2020 2071 7565 7279 2e73 6574 5f77 6865     query.set_whe
+00058f00: 7265 5f66 696c 7465 7273 2877 6865 7265  re_filters(where
+00058f10: 5f66 696c 7465 725f 6f77 6e65 7229 0d0a  _filter_owner)..
+00058f20: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00058f30: 6f6e 2e65 7865 6375 7465 2873 7472 2871  on.execute(str(q
+00058f40: 7565 7279 2929 0d0a 0d0a 2020 2020 2020  uery))....      
+00058f50: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
+00058f60: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00058f70: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
+00058f80: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
+00058f90: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00058fa0: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
+00058fb0: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
+00058fc0: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
+00058fd0: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
+00058fe0: 595f 5459 5045 5f56 414c 5545 5329 0d0a  Y_TYPE_VALUES)..
+00058ff0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059000: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
+00059010: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
+00059020: 545f 4147 4729 0d0a 2020 2020 2020 2020  T_AGG)..        
+00059030: 7175 6572 792e 7365 745f 696e 7365 7274  query.set_insert
+00059040: 5f63 6f6c 756d 6e73 2843 4f4c 554d 4e53  _columns(COLUMNS
+00059050: 5f4f 4d5f 4441 5441 5345 545f 545f 4147  _OM_DATASET_T_AG
+00059060: 4729 0d0a 2020 2020 2020 2020 7175 6572  G)..        quer
+00059070: 792e 7365 745f 6861 735f 6865 6164 6572  y.set_has_header
+00059080: 2846 616c 7365 290d 0a20 2020 2020 2020  (False)..       
+00059090: 2071 7565 7279 2e73 6574 5f76 616c 7565   query.set_value
+000590a0: 7328 7365 6c66 2e6d 6574 6164 6174 615f  s(self.metadata_
+000590b0: 746f 5f6c 6f61 642e 6f6d 5f64 6174 6173  to_load.om_datas
+000590c0: 6574 5f74 5f61 6767 290d 0a20 2020 2020  et_t_agg)..     
+000590d0: 2020 2063 6f6e 6e65 6374 696f 6e2e 6578     connection.ex
+000590e0: 6563 7574 6528 7374 7228 7175 6572 7929  ecute(str(query)
+000590f0: 290d 0a0d 0a20 2020 2020 2020 2023 204f  )....        # O
+00059100: 4d5f 4441 5441 5345 545f 545f 4f52 4445  M_DATASET_T_ORDE
+00059110: 520d 0a20 2020 2020 2020 2071 7565 7279  R..        query
+00059120: 203d 2051 7565 7279 2829 0d0a 2020 2020   = Query()..    
+00059130: 2020 2020 7175 6572 792e 7365 745f 6461      query.set_da
+00059140: 7461 6261 7365 2863 6f6e 6e65 6374 696f  tabase(connectio
+00059150: 6e5f 7479 7065 290d 0a20 2020 2020 2020  n_type)..       
+00059160: 2071 7565 7279 2e73 6574 5f76 616c 7565   query.set_value
+00059170: 735f 6261 7463 6828 636f 6d6d 6974 5f76  s_batch(commit_v
+00059180: 616c 7565 735f 6261 7463 6829 0d0a 2020  alues_batch)..  
+00059190: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
+000591a0: 7479 7065 2851 5545 5259 5f54 5950 455f  type(QUERY_TYPE_
+000591b0: 4445 4c45 5445 290d 0a20 2020 2020 2020  DELETE)..       
+000591c0: 2071 7565 7279 2e73 6574 5f74 6172 6765   query.set_targe
+000591d0: 745f 7461 626c 6528 5441 424c 455f 4f4d  t_table(TABLE_OM
+000591e0: 5f44 4154 4153 4554 5f54 5f4f 5244 4552  _DATASET_T_ORDER
+000591f0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00059200: 2e73 6574 5f77 6865 7265 5f66 696c 7465  .set_where_filte
+00059210: 7273 2877 6865 7265 5f66 696c 7465 725f  rs(where_filter_
+00059220: 6f77 6e65 7229 0d0a 2020 2020 2020 2020  owner)..        
+00059230: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
+00059240: 7465 2873 7472 2871 7565 7279 2929 0d0a  te(str(query))..
+00059250: 0d0a 2020 2020 2020 2020 7175 6572 7920  ..        query 
+00059260: 3d20 5175 6572 7928 290d 0a20 2020 2020  = Query()..     
+00059270: 2020 2071 7565 7279 2e73 6574 5f64 6174     query.set_dat
+00059280: 6162 6173 6528 636f 6e6e 6563 7469 6f6e  abase(connection
+00059290: 5f74 7970 6529 0d0a 2020 2020 2020 2020  _type)..        
+000592a0: 7175 6572 792e 7365 745f 7661 6c75 6573  query.set_values
+000592b0: 5f62 6174 6368 2863 6f6d 6d69 745f 7661  _batch(commit_va
+000592c0: 6c75 6573 5f62 6174 6368 290d 0a20 2020  lues_batch)..   
+000592d0: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
+000592e0: 7970 6528 5155 4552 595f 5459 5045 5f56  ype(QUERY_TYPE_V
+000592f0: 414c 5545 5329 0d0a 2020 2020 2020 2020  ALUES)..        
+00059300: 7175 6572 792e 7365 745f 7461 7267 6574  query.set_target
+00059310: 5f74 6162 6c65 2854 4142 4c45 5f4f 4d5f  _table(TABLE_OM_
+00059320: 4441 5441 5345 545f 545f 4f52 4445 5229  DATASET_T_ORDER)
+00059330: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+00059340: 7365 745f 696e 7365 7274 5f63 6f6c 756d  set_insert_colum
+00059350: 6e73 2843 4f4c 554d 4e53 5f4f 4d5f 4441  ns(COLUMNS_OM_DA
+00059360: 5441 5345 545f 545f 4f52 4445 5229 0d0a  TASET_T_ORDER)..
+00059370: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059380: 745f 6861 735f 6865 6164 6572 2846 616c  t_has_header(Fal
+00059390: 7365 290d 0a20 2020 2020 2020 2071 7565  se)..        que
+000593a0: 7279 2e73 6574 5f76 616c 7565 7328 7365  ry.set_values(se
+000593b0: 6c66 2e6d 6574 6164 6174 615f 746f 5f6c  lf.metadata_to_l
+000593c0: 6f61 642e 6f6d 5f64 6174 6173 6574 5f74  oad.om_dataset_t
+000593d0: 5f6f 7264 6572 290d 0a20 2020 2020 2020  _order)..       
+000593e0: 2063 6f6e 6e65 6374 696f 6e2e 6578 6563   connection.exec
+000593f0: 7574 6528 7374 7228 7175 6572 7929 290d  ute(str(query)).
+00059400: 0a0d 0a20 2020 2020 2020 2023 204f 4d5f  ...        # OM_
+00059410: 4441 5441 5345 545f 545f 4d41 5050 494e  DATASET_T_MAPPIN
+00059420: 470d 0a20 2020 2020 2020 2071 7565 7279  G..        query
+00059430: 203d 2051 7565 7279 2829 0d0a 2020 2020   = Query()..    
+00059440: 2020 2020 7175 6572 792e 7365 745f 6461      query.set_da
+00059450: 7461 6261 7365 2863 6f6e 6e65 6374 696f  tabase(connectio
+00059460: 6e5f 7479 7065 290d 0a20 2020 2020 2020  n_type)..       
+00059470: 2071 7565 7279 2e73 6574 5f76 616c 7565   query.set_value
+00059480: 735f 6261 7463 6828 636f 6d6d 6974 5f76  s_batch(commit_v
+00059490: 616c 7565 735f 6261 7463 6829 0d0a 2020  alues_batch)..  
+000594a0: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
+000594b0: 7479 7065 2851 5545 5259 5f54 5950 455f  type(QUERY_TYPE_
+000594c0: 4445 4c45 5445 290d 0a20 2020 2020 2020  DELETE)..       
+000594d0: 2071 7565 7279 2e73 6574 5f74 6172 6765   query.set_targe
+000594e0: 745f 7461 626c 6528 5441 424c 455f 4f4d  t_table(TABLE_OM
+000594f0: 5f44 4154 4153 4554 5f54 5f4d 4150 5049  _DATASET_T_MAPPI
+00059500: 4e47 290d 0a20 2020 2020 2020 2071 7565  NG)..        que
+00059510: 7279 2e73 6574 5f77 6865 7265 5f66 696c  ry.set_where_fil
+00059520: 7465 7273 2877 6865 7265 5f66 696c 7465  ters(where_filte
+00059530: 725f 6f77 6e65 7229 0d0a 2020 2020 2020  r_owner)..      
+00059540: 2020 636f 6e6e 6563 7469 6f6e 2e65 7865    connection.exe
+00059550: 6375 7465 2873 7472 2871 7565 7279 2929  cute(str(query))
+00059560: 0d0a 0d0a 2020 2020 2020 2020 7175 6572  ....        quer
+00059570: 7920 3d20 5175 6572 7928 290d 0a20 2020  y = Query()..   
+00059580: 2020 2020 2071 7565 7279 2e73 6574 5f64       query.set_d
+00059590: 6174 6162 6173 6528 636f 6e6e 6563 7469  atabase(connecti
+000595a0: 6f6e 5f74 7970 6529 0d0a 2020 2020 2020  on_type)..      
+000595b0: 2020 7175 6572 792e 7365 745f 7661 6c75    query.set_valu
+000595c0: 6573 5f62 6174 6368 2863 6f6d 6d69 745f  es_batch(commit_
+000595d0: 7661 6c75 6573 5f62 6174 6368 290d 0a20  values_batch).. 
+000595e0: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+000595f0: 5f74 7970 6528 5155 4552 595f 5459 5045  _type(QUERY_TYPE
+00059600: 5f56 414c 5545 5329 0d0a 2020 2020 2020  _VALUES)..      
+00059610: 2020 7175 6572 792e 7365 745f 7461 7267    query.set_targ
+00059620: 6574 5f74 6162 6c65 2854 4142 4c45 5f4f  et_table(TABLE_O
+00059630: 4d5f 4441 5441 5345 545f 545f 4d41 5050  M_DATASET_T_MAPP
+00059640: 494e 4729 0d0a 2020 2020 2020 2020 7175  ING)..        qu
+00059650: 6572 792e 7365 745f 696e 7365 7274 5f63  ery.set_insert_c
+00059660: 6f6c 756d 6e73 2843 4f4c 554d 4e53 5f4f  olumns(COLUMNS_O
+00059670: 4d5f 4441 5441 5345 545f 545f 4d41 5050  M_DATASET_T_MAPP
+00059680: 494e 4729 0d0a 2020 2020 2020 2020 7175  ING)..        qu
+00059690: 6572 792e 7365 745f 6861 735f 6865 6164  ery.set_has_head
+000596a0: 6572 2846 616c 7365 290d 0a20 2020 2020  er(False)..     
+000596b0: 2020 2071 7565 7279 2e73 6574 5f76 616c     query.set_val
+000596c0: 7565 7328 7365 6c66 2e6d 6574 6164 6174  ues(self.metadat
+000596d0: 615f 746f 5f6c 6f61 642e 6f6d 5f64 6174  a_to_load.om_dat
+000596e0: 6173 6574 5f74 5f6d 6170 7069 6e67 290d  aset_t_mapping).
+000596f0: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+00059700: 696f 6e2e 6578 6563 7574 6528 7374 7228  ion.execute(str(
+00059710: 7175 6572 7929 290d 0a0d 0a20 2020 2020  query))....     
+00059720: 2020 2023 204f 4d5f 4441 5441 5345 545f     # OM_DATASET_
+00059730: 545f 4449 5354 494e 4354 0d0a 2020 2020  T_DISTINCT..    
+00059740: 2020 2020 7175 6572 7920 3d20 5175 6572      query = Quer
+00059750: 7928 290d 0a20 2020 2020 2020 2071 7565  y()..        que
+00059760: 7279 2e73 6574 5f64 6174 6162 6173 6528  ry.set_database(
+00059770: 636f 6e6e 6563 7469 6f6e 5f74 7970 6529  connection_type)
+00059780: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+00059790: 7365 745f 7661 6c75 6573 5f62 6174 6368  set_values_batch
+000597a0: 2863 6f6d 6d69 745f 7661 6c75 6573 5f62  (commit_values_b
+000597b0: 6174 6368 290d 0a20 2020 2020 2020 2071  atch)..        q
+000597c0: 7565 7279 2e73 6574 5f74 7970 6528 5155  uery.set_type(QU
+000597d0: 4552 595f 5459 5045 5f44 454c 4554 4529  ERY_TYPE_DELETE)
+000597e0: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+000597f0: 7365 745f 7461 7267 6574 5f74 6162 6c65  set_target_table
+00059800: 2854 4142 4c45 5f4f 4d5f 4441 5441 5345  (TABLE_OM_DATASE
+00059810: 545f 545f 4449 5354 494e 4354 290d 0a20  T_T_DISTINCT).. 
+00059820: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+00059830: 5f77 6865 7265 5f66 696c 7465 7273 2877  _where_filters(w
+00059840: 6865 7265 5f66 696c 7465 725f 6f77 6e65  here_filter_owne
+00059850: 7229 0d0a 2020 2020 2020 2020 636f 6e6e  r)..        conn
+00059860: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
+00059870: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
+00059880: 2020 2020 2020 7175 6572 7920 3d20 5175        query = Qu
+00059890: 6572 7928 290d 0a20 2020 2020 2020 2071  ery()..        q
+000598a0: 7565 7279 2e73 6574 5f64 6174 6162 6173  uery.set_databas
+000598b0: 6528 636f 6e6e 6563 7469 6f6e 5f74 7970  e(connection_typ
+000598c0: 6529 0d0a 2020 2020 2020 2020 7175 6572  e)..        quer
+000598d0: 792e 7365 745f 7661 6c75 6573 5f62 6174  y.set_values_bat
+000598e0: 6368 2863 6f6d 6d69 745f 7661 6c75 6573  ch(commit_values
+000598f0: 5f62 6174 6368 290d 0a20 2020 2020 2020  _batch)..       
+00059900: 2071 7565 7279 2e73 6574 5f74 7970 6528   query.set_type(
+00059910: 5155 4552 595f 5459 5045 5f56 414c 5545  QUERY_TYPE_VALUE
+00059920: 5329 0d0a 2020 2020 2020 2020 7175 6572  S)..        quer
+00059930: 792e 7365 745f 7461 7267 6574 5f74 6162  y.set_target_tab
+00059940: 6c65 2854 4142 4c45 5f4f 4d5f 4441 5441  le(TABLE_OM_DATA
+00059950: 5345 545f 545f 4449 5354 494e 4354 290d  SET_T_DISTINCT).
+00059960: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+00059970: 6574 5f69 6e73 6572 745f 636f 6c75 6d6e  et_insert_column
+00059980: 7328 434f 4c55 4d4e 535f 4f4d 5f44 4154  s(COLUMNS_OM_DAT
+00059990: 4153 4554 5f54 5f44 4953 5449 4e43 5429  ASET_T_DISTINCT)
+000599a0: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+000599b0: 7365 745f 6861 735f 6865 6164 6572 2846  set_has_header(F
+000599c0: 616c 7365 290d 0a20 2020 2020 2020 2071  alse)..        q
+000599d0: 7565 7279 2e73 6574 5f76 616c 7565 7328  uery.set_values(
+000599e0: 7365 6c66 2e6d 6574 6164 6174 615f 746f  self.metadata_to
+000599f0: 5f6c 6f61 642e 6f6d 5f64 6174 6173 6574  _load.om_dataset
+00059a00: 5f74 5f64 6973 7469 6e63 7429 0d0a 2020  _t_distinct)..  
+00059a10: 2020 2020 2020 636f 6e6e 6563 7469 6f6e        connection
+00059a20: 2e65 7865 6375 7465 2873 7472 2871 7565  .execute(str(que
+00059a30: 7279 2929 0d0a 0d0a 2020 2020 2020 2020  ry))....        
+00059a40: 2320 4f4d 5f44 4154 4153 4554 5f54 5f46  # OM_DATASET_T_F
+00059a50: 494c 5445 520d 0a20 2020 2020 2020 2071  ILTER..        q
+00059a60: 7565 7279 203d 2051 7565 7279 2829 0d0a  uery = Query()..
+00059a70: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059a80: 745f 6461 7461 6261 7365 2863 6f6e 6e65  t_database(conne
+00059a90: 6374 696f 6e5f 7479 7065 290d 0a20 2020  ction_type)..   
+00059aa0: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
+00059ab0: 616c 7565 735f 6261 7463 6828 636f 6d6d  alues_batch(comm
+00059ac0: 6974 5f76 616c 7565 735f 6261 7463 6829  it_values_batch)
+00059ad0: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+00059ae0: 7365 745f 7479 7065 2851 5545 5259 5f54  set_type(QUERY_T
+00059af0: 5950 455f 4445 4c45 5445 290d 0a20 2020  YPE_DELETE)..   
+00059b00: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
+00059b10: 6172 6765 745f 7461 626c 6528 5441 424c  arget_table(TABL
+00059b20: 455f 4f4d 5f44 4154 4153 4554 5f54 5f46  E_OM_DATASET_T_F
+00059b30: 494c 5445 5229 0d0a 2020 2020 2020 2020  ILTER)..        
+00059b40: 7175 6572 792e 7365 745f 7768 6572 655f  query.set_where_
+00059b50: 6669 6c74 6572 7328 7768 6572 655f 6669  filters(where_fi
+00059b60: 6c74 6572 5f6f 776e 6572 290d 0a20 2020  lter_owner)..   
+00059b70: 2020 2020 2063 6f6e 6e65 6374 696f 6e2e       connection.
+00059b80: 6578 6563 7574 6528 7374 7228 7175 6572  execute(str(quer
+00059b90: 7929 290d 0a0d 0a20 2020 2020 2020 2071  y))....        q
+00059ba0: 7565 7279 203d 2051 7565 7279 2829 0d0a  uery = Query()..
+00059bb0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059bc0: 745f 6461 7461 6261 7365 2863 6f6e 6e65  t_database(conne
+00059bd0: 6374 696f 6e5f 7479 7065 290d 0a20 2020  ction_type)..   
+00059be0: 2020 2020 2071 7565 7279 2e73 6574 5f76       query.set_v
+00059bf0: 616c 7565 735f 6261 7463 6828 636f 6d6d  alues_batch(comm
+00059c00: 6974 5f76 616c 7565 735f 6261 7463 6829  it_values_batch)
+00059c10: 0d0a 2020 2020 2020 2020 7175 6572 792e  ..        query.
+00059c20: 7365 745f 7479 7065 2851 5545 5259 5f54  set_type(QUERY_T
+00059c30: 5950 455f 5641 4c55 4553 290d 0a20 2020  YPE_VALUES)..   
+00059c40: 2020 2020 2071 7565 7279 2e73 6574 5f74       query.set_t
+00059c50: 6172 6765 745f 7461 626c 6528 5441 424c  arget_table(TABL
+00059c60: 455f 4f4d 5f44 4154 4153 4554 5f54 5f46  E_OM_DATASET_T_F
+00059c70: 494c 5445 5229 0d0a 2020 2020 2020 2020  ILTER)..        
+00059c80: 7175 6572 792e 7365 745f 696e 7365 7274  query.set_insert
+00059c90: 5f63 6f6c 756d 6e73 2843 4f4c 554d 4e53  _columns(COLUMNS
+00059ca0: 5f4f 4d5f 4441 5441 5345 545f 545f 4649  _OM_DATASET_T_FI
+00059cb0: 4c54 4552 290d 0a20 2020 2020 2020 2071  LTER)..        q
+00059cc0: 7565 7279 2e73 6574 5f68 6173 5f68 6561  uery.set_has_hea
+00059cd0: 6465 7228 4661 6c73 6529 0d0a 2020 2020  der(False)..    
+00059ce0: 2020 2020 7175 6572 792e 7365 745f 7661      query.set_va
+00059cf0: 6c75 6573 2873 656c 662e 6d65 7461 6461  lues(self.metada
+00059d00: 7461 5f74 6f5f 6c6f 6164 2e6f 6d5f 6461  ta_to_load.om_da
+00059d10: 7461 7365 745f 745f 6669 6c74 6572 290d  taset_t_filter).
+00059d20: 0a20 2020 2020 2020 2063 6f6e 6e65 6374  .        connect
+00059d30: 696f 6e2e 6578 6563 7574 6528 7374 7228  ion.execute(str(
+00059d40: 7175 6572 7929 290d 0a0d 0a20 2020 2020  query))....     
+00059d50: 2020 2023 204f 4d5f 4441 5441 5345 545f     # OM_DATASET_
+00059d60: 545f 4841 5649 4e47 0d0a 2020 2020 2020  T_HAVING..      
+00059d70: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
+00059d80: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00059d90: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
+00059da0: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
+00059db0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059dc0: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
+00059dd0: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
+00059de0: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
+00059df0: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
+00059e00: 595f 5459 5045 5f44 454c 4554 4529 0d0a  Y_TYPE_DELETE)..
+00059e10: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059e20: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
+00059e30: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
+00059e40: 545f 4841 5649 4e47 290d 0a20 2020 2020  T_HAVING)..     
+00059e50: 2020 2071 7565 7279 2e73 6574 5f77 6865     query.set_whe
+00059e60: 7265 5f66 696c 7465 7273 2877 6865 7265  re_filters(where
+00059e70: 5f66 696c 7465 725f 6f77 6e65 7229 0d0a  _filter_owner)..
+00059e80: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00059e90: 6f6e 2e65 7865 6375 7465 2873 7472 2871  on.execute(str(q
+00059ea0: 7565 7279 2929 0d0a 0d0a 2020 2020 2020  uery))....      
+00059eb0: 2020 7175 6572 7920 3d20 5175 6572 7928    query = Query(
+00059ec0: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+00059ed0: 2e73 6574 5f64 6174 6162 6173 6528 636f  .set_database(co
+00059ee0: 6e6e 6563 7469 6f6e 5f74 7970 6529 0d0a  nnection_type)..
+00059ef0: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059f00: 745f 7661 6c75 6573 5f62 6174 6368 2863  t_values_batch(c
+00059f10: 6f6d 6d69 745f 7661 6c75 6573 5f62 6174  ommit_values_bat
+00059f20: 6368 290d 0a20 2020 2020 2020 2071 7565  ch)..        que
+00059f30: 7279 2e73 6574 5f74 7970 6528 5155 4552  ry.set_type(QUER
+00059f40: 595f 5459 5045 5f56 414c 5545 5329 0d0a  Y_TYPE_VALUES)..
+00059f50: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+00059f60: 745f 7461 7267 6574 5f74 6162 6c65 2854  t_target_table(T
+00059f70: 4142 4c45 5f4f 4d5f 4441 5441 5345 545f  ABLE_OM_DATASET_
+00059f80: 545f 4841 5649 4e47 290d 0a20 2020 2020  T_HAVING)..     
+00059f90: 2020 2071 7565 7279 2e73 6574 5f69 6e73     query.set_ins
+00059fa0: 6572 745f 636f 6c75 6d6e 7328 434f 4c55  ert_columns(COLU
+00059fb0: 4d4e 535f 4f4d 5f44 4154 4153 4554 5f54  MNS_OM_DATASET_T
+00059fc0: 5f48 4156 494e 4729 0d0a 2020 2020 2020  _HAVING)..      
+00059fd0: 2020 7175 6572 792e 7365 745f 6861 735f    query.set_has_
+00059fe0: 6865 6164 6572 2846 616c 7365 290d 0a20  header(False).. 
+00059ff0: 2020 2020 2020 2071 7565 7279 2e73 6574         query.set
+0005a000: 5f76 616c 7565 7328 7365 6c66 2e6d 6574  _values(self.met
+0005a010: 6164 6174 615f 746f 5f6c 6f61 642e 6f6d  adata_to_load.om
+0005a020: 5f64 6174 6173 6574 5f74 5f68 6176 696e  _dataset_t_havin
+0005a030: 6729 0d0a 2020 2020 2020 2020 636f 6e6e  g)..        conn
+0005a040: 6563 7469 6f6e 2e65 7865 6375 7465 2873  ection.execute(s
+0005a050: 7472 2871 7565 7279 2929 0d0a 0d0a 2020  tr(query))....  
+0005a060: 2020 2020 2020 2320 4f4d 5f44 4154 4153        # OM_DATAS
+0005a070: 4554 5f45 5845 4355 5449 4f4e 0d0a 2020  ET_EXECUTION..  
+0005a080: 2020 2020 2020 7175 6572 7920 3d20 5175        query = Qu
+0005a090: 6572 7928 290d 0a20 2020 2020 2020 2071  ery()..        q
+0005a0a0: 7565 7279 2e73 6574 5f64 6174 6162 6173  uery.set_databas
+0005a0b0: 6528 636f 6e6e 6563 7469 6f6e 5f74 7970  e(connection_typ
+0005a0c0: 6529 0d0a 2020 2020 2020 2020 7175 6572  e)..        quer
+0005a0d0: 792e 7365 745f 7661 6c75 6573 5f62 6174  y.set_values_bat
+0005a0e0: 6368 2863 6f6d 6d69 745f 7661 6c75 6573  ch(commit_values
+0005a0f0: 5f62 6174 6368 290d 0a20 2020 2020 2020  _batch)..       
+0005a100: 2071 7565 7279 2e73 6574 5f74 7970 6528   query.set_type(
+0005a110: 5155 4552 595f 5459 5045 5f44 454c 4554  QUERY_TYPE_DELET
+0005a120: 4529 0d0a 2020 2020 2020 2020 7175 6572  E)..        quer
+0005a130: 792e 7365 745f 7461 7267 6574 5f74 6162  y.set_target_tab
+0005a140: 6c65 2854 4142 4c45 5f4f 4d5f 4441 5441  le(TABLE_OM_DATA
+0005a150: 5345 545f 4558 4543 5554 494f 4e29 0d0a  SET_EXECUTION)..
+0005a160: 2020 2020 2020 2020 7175 6572 792e 7365          query.se
+0005a170: 745f 7768 6572 655f 6669 6c74 6572 7328  t_where_filters(
+0005a180: 7768 6572 655f 6669 6c74 6572 5f6f 776e  where_filter_own
+0005a190: 6572 290d 0a20 2020 2020 2020 2063 6f6e  er)..        con
+0005a1a0: 6e65 6374 696f 6e2e 6578 6563 7574 6528  nection.execute(
+0005a1b0: 7374 7228 7175 6572 7929 290d 0a0d 0a20  str(query)).... 
+0005a1c0: 2020 2020 2020 2071 7565 7279 203d 2051         query = Q
+0005a1d0: 7565 7279 2829 0d0a 2020 2020 2020 2020  uery()..        
+0005a1e0: 7175 6572 792e 7365 745f 6461 7461 6261  query.set_databa
+0005a1f0: 7365 2863 6f6e 6e65 6374 696f 6e5f 7479  se(connection_ty
+0005a200: 7065 290d 0a20 2020 2020 2020 2071 7565  pe)..        que
+0005a210: 7279 2e73 6574 5f76 616c 7565 735f 6261  ry.set_values_ba
+0005a220: 7463 6828 636f 6d6d 6974 5f76 616c 7565  tch(commit_value
+0005a230: 735f 6261 7463 6829 0d0a 2020 2020 2020  s_batch)..      
+0005a240: 2020 7175 6572 792e 7365 745f 7479 7065    query.set_type
+0005a250: 2851 5545 5259 5f54 5950 455f 5641 4c55  (QUERY_TYPE_VALU
+0005a260: 4553 290d 0a20 2020 2020 2020 2071 7565  ES)..        que
+0005a270: 7279 2e73 6574 5f74 6172 6765 745f 7461  ry.set_target_ta
+0005a280: 626c 6528 5441 424c 455f 4f4d 5f44 4154  ble(TABLE_OM_DAT
+0005a290: 4153 4554 5f45 5845 4355 5449 4f4e 290d  ASET_EXECUTION).
+0005a2a0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+0005a2b0: 6574 5f69 6e73 6572 745f 636f 6c75 6d6e  et_insert_column
+0005a2c0: 7328 434f 4c55 4d4e 535f 4f4d 5f44 4154  s(COLUMNS_OM_DAT
+0005a2d0: 4153 4554 5f45 5845 4355 5449 4f4e 290d  ASET_EXECUTION).
+0005a2e0: 0a20 2020 2020 2020 2071 7565 7279 2e73  .        query.s
+0005a2f0: 6574 5f68 6173 5f68 6561 6465 7228 4661  et_has_header(Fa
+0005a300: 6c73 6529 0d0a 2020 2020 2020 2020 7175  lse)..        qu
+0005a310: 6572 792e 7365 745f 7661 6c75 6573 2873  ery.set_values(s
+0005a320: 656c 662e 6d65 7461 6461 7461 5f74 6f5f  elf.metadata_to_
+0005a330: 6c6f 6164 2e6f 6d5f 6461 7461 7365 745f  load.om_dataset_
+0005a340: 6578 6563 7574 696f 6e29 0d0a 2020 2020  execution)..    
+0005a350: 2020 2020 636f 6e6e 6563 7469 6f6e 2e65      connection.e
+0005a360: 7865 6375 7465 2873 7472 2871 7565 7279  xecute(str(query
+0005a370: 2929 0d0a 0d0a 2020 2020 2020 2020 2320  ))....        # 
+0005a380: 4f4d 5f44 4154 4153 4554 5f46 494c 450d  OM_DATASET_FILE.
+0005a390: 0a20 2020 2020 2020 2071 7565 7279 203d  .        query =
+0005a3a0: 2051 7565 7279 2829 0d0a 2020 2020 2020   Query()..      
+0005a3b0: 2020 7175 6572 792e 7365 745f 6461 7461    query.set_data
+0005a3c0: 6261 7365 2863 6f6e 6e65 6374 696f 6e5f  base(connection_
+0005a3d0: 7479 7065 290d 0a20 2020 2020 2020 2071  type)..        q
+0005a3e0: 7565 7279 2e73 6574 5f76 616c 7565 735f  uery.set_values_
+0005a3f0: 6261 7463 6828 636f 6d6d 6974 5f76 616c  batch(commit_val
+0005a400: 7565 735f 6261 7463 6829 0d0a 2020 2020  ues_batch)..    
+0005a410: 2020 2020 7175 6572 792e 7365 745f 7479      query.set_ty
+0005a420: 7065 2851 5545 5259 5f54 5950 455f 4445  pe(QUERY_TYPE_DE
+0005a430: 4c45 5445 290d 0a20 2020 2020 2020 2071  LETE)..        q
+0005a440: 7565 7279 2e73 6574 5f74 6172 6765 745f  uery.set_target_
+0005a450: 7461 626c 6528 5441 424c 455f 4f4d 5f44  table(TABLE_OM_D
+0005a460: 4154 4153 4554 5f46 494c 4529 0d0a 2020  ATASET_FILE)..  
+0005a470: 2020 2020 2020 7175 6572 792e 7365 745f        query.set_
+0005a480: 7768 6572 655f 6669 6c74 6572 7328 7768  where_filters(wh
+0005a490: 6572 655f 6669 6c74 6572 5f6f 776e 6572  ere_filter_owner
+0005a4a0: 290d 0a20 2020 2020 2020 2063 6f6e 6e65  )..        conne
+0005a4b0: 6374 696f 6e2e 6578 6563 7574 6528 7374  ction.execute(st
+0005a4c0: 7228 7175 6572 7929 290d 0a0d 0a20 2020  r(query))....   
+0005a4d0: 2020 2020 2071 7565 7279 203d 2051 7565       query = Que
+0005a4e0: 7279 2829 0d0a 2020 2020 2020 2020 7175  ry()..        qu
+0005a4f0: 6572 792e 7365 745f 6461 7461 6261 7365  ery.set_database
+0005a500: 2863 6f6e 6e65 6374 696f 6e5f 7479 7065  (connection_type
+0005a510: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+0005a520: 2e73 6574 5f76 616c 7565 735f 6261 7463  .set_values_batc
+0005a530: 6828 636f 6d6d 6974 5f76 616c 7565 735f  h(commit_values_
+0005a540: 6261 7463 6829 0d0a 2020 2020 2020 2020  batch)..        
+0005a550: 7175 6572 792e 7365 745f 7479 7065 2851  query.set_type(Q
+0005a560: 5545 5259 5f54 5950 455f 5641 4c55 4553  UERY_TYPE_VALUES
+0005a570: 290d 0a20 2020 2020 2020 2071 7565 7279  )..        query
+0005a580: 2e73 6574 5f74 6172 6765 745f 7461 626c  .set_target_tabl
+0005a590: 6528 5441 424c 455f 4f4d 5f44 4154 4153  e(TABLE_OM_DATAS
+0005a5a0: 4554 5f46 494c 4529 0d0a 2020 2020 2020  ET_FILE)..      
+0005a5b0: 2020 7175 6572 792e 7365 745f 696e 7365    query.set_inse
+0005a5c0: 7274 5f63 6f6c 756d 6e73 2843 4f4c 554d  rt_columns(COLUM
+0005a5d0: 4e53 5f4f 4d5f 4441 5441 5345 545f 4649  NS_OM_DATASET_FI
+0005a5e0: 4c45 290d 0a20 2020 2020 2020 2071 7565  LE)..        que
+0005a5f0: 7279 2e73 6574 5f68 6173 5f68 6561 6465  ry.set_has_heade
+0005a600: 7228 4661 6c73 6529 0d0a 2020 2020 2020  r(False)..      
+0005a610: 2020 7175 6572 792e 7365 745f 7661 6c75    query.set_valu
+0005a620: 6573 2873 656c 662e 6d65 7461 6461 7461  es(self.metadata
+0005a630: 5f74 6f5f 6c6f 6164 2e6f 6d5f 6461 7461  _to_load.om_data
+0005a640: 7365 745f 6669 6c65 290d 0a20 2020 2020  set_file)..     
+0005a650: 2020 2063 6f6e 6e65 6374 696f 6e2e 6578     connection.ex
+0005a660: 6563 7574 6528 7374 7228 7175 6572 7929  ecute(str(query)
+0005a670: 290d 0a0d 0a20 2020 2020 2020 2063 6f6e  )....        con
+0005a680: 6e65 6374 696f 6e2e 636f 6d6d 6974 2829  nection.commit()
+0005a690: 0d0a 2020 2020 2020 2020 636f 6e6e 6563  ..        connec
+0005a6a0: 7469 6f6e 2e63 6c6f 7365 2829 0d0a 0d0a  tion.close()....
+0005a6b0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0005a6c0: 2e6c 6f67 2873 656c 662e 656e 6769 6e65  .log(self.engine
+0005a6d0: 5f6e 616d 652c 2022 5570 6c6f 6164 696e  _name, "Uploadin
+0005a6e0: 6720 636f 6d70 6c65 7465 6422 2c20 4c4f  g completed", LO
+0005a6f0: 475f 4c45 5645 4c5f 494e 464f 290d 0a    G_LEVEL_INFO)..
```

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_recover.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_recover.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_restore.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_restore.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_run.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_run.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_upload.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_upload.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/engines/engine_validate.py` & `Metamorf-0.4.4.1/metamorf/engines/engine_validate.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/help.py` & `Metamorf-0.4.4.1/metamorf/help.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/mysql/init_example_data_mysql.sql` & `Metamorf-0.4.4.1/metamorf/initialization/mysql/init_example_data_mysql.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/mysql/init_example_metadata_mysql.sql` & `Metamorf-0.4.4.1/metamorf/initialization/mysql/init_example_metadata_mysql.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/mysql/init_mysql.sql` & `Metamorf-0.4.4.1/metamorf/initialization/mysql/init_mysql.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/postgresql/init_example_data_postgresql.sql` & `Metamorf-0.4.4.1/metamorf/initialization/postgresql/init_example_data_postgresql.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/postgresql/init_example_metadata_postgresql.sql` & `Metamorf-0.4.4.1/metamorf/initialization/postgresql/init_example_metadata_postgresql.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/postgresql/init_postgresql.sql` & `Metamorf-0.4.4.1/metamorf/initialization/postgresql/init_postgresql.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/snowflake/init_example_data_snowflake.sql` & `Metamorf-0.4.4.1/metamorf/initialization/snowflake/init_example_data_snowflake.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/snowflake/init_example_metadata_snowflake.sql` & `Metamorf-0.4.4.1/metamorf/initialization/snowflake/init_example_metadata_snowflake.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/snowflake/init_snowflake.sql` & `Metamorf-0.4.4.1/metamorf/initialization/snowflake/init_snowflake.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/sqlite/init_example_data_sqlite.sql` & `Metamorf-0.4.4.1/metamorf/initialization/sqlite/init_example_data_sqlite.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/sqlite/init_example_metadata_sqlite.sql` & `Metamorf-0.4.4.1/metamorf/initialization/sqlite/init_example_metadata_sqlite.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/initialization/sqlite/init_sqlite.sql` & `Metamorf-0.4.4.1/metamorf/initialization/sqlite/init_sqlite.sql`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/main.py` & `Metamorf-0.4.4.1/metamorf/main.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/argparser.py` & `Metamorf-0.4.4.1/metamorf/tools/argparser.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/configvalidator.py` & `Metamorf-0.4.4.1/metamorf/tools/configvalidator.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/connection.py` & `Metamorf-0.4.4.1/metamorf/tools/connection.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/database_objects.py` & `Metamorf-0.4.4.1/metamorf/tools/database_objects.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/filecontroller.py` & `Metamorf-0.4.4.1/metamorf/tools/filecontroller.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/log.py` & `Metamorf-0.4.4.1/metamorf/tools/log.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/manifest.py` & `Metamorf-0.4.4.1/metamorf/tools/manifest.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/metadata.py` & `Metamorf-0.4.4.1/metamorf/tools/metadata.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/metadata_validator.py` & `Metamorf-0.4.4.1/metamorf/tools/metadata_validator.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/node.py` & `Metamorf-0.4.4.1/metamorf/tools/node.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/query.py` & `Metamorf-0.4.4.1/metamorf/tools/query.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/metamorf/tools/utils.py` & `Metamorf-0.4.4.1/metamorf/tools/utils.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/pyproject.toml` & `Metamorf-0.4.4.1/pyproject.toml`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [project]
 name = "Metamorf"
-version = "0.4.3.1"
+version = "0.4.4.1"
 authors = [
   { name="Guillermo Aumatell", email="gaumatellsalom@gmail.com" },
 ]
 description = "Metadata Suite to build and manage your Datawarehouse"
 readme = "README.md"
 requires-python = ">=3.10"
 classifiers = [
```

### Comparing `Metamorf-0.4.3.1/tests/tests.py` & `Metamorf-0.4.4.1/tests/tests.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/tests/tests_query.py` & `Metamorf-0.4.4.1/tests/tests_query.py`

 * *Files identical despite different names*

### Comparing `Metamorf-0.4.3.1/tests/tests_validator.py` & `Metamorf-0.4.4.1/tests/tests_validator.py`

 * *Files identical despite different names*

