# Comparing `tmp/hat_drivers-0.6.8-cp38.cp39.cp310-none-any.whl.zip` & `tmp/hat_drivers-0.6.9-cp38.cp39.cp310-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,26 +1,26 @@
-Zip file size: 156815 bytes, number of entries: 97
+Zip file size: 156904 bytes, number of entries: 97
 -rw-r--r--  2.0 unx       28 b- defN 21-May-03 22:33 hat/drivers/__init__.py
 -rw-r--r--  2.0 unx    14501 b- defN 21-Feb-14 00:28 hat/drivers/cosp.py
 -rw-r--r--  2.0 unx    14253 b- defN 21-Feb-14 00:39 hat/drivers/cotp.py
 -rw-r--r--  2.0 unx     6645 b- defN 23-Jan-06 22:25 hat/drivers/serial.py
 -rw-r--r--  2.0 unx     2735 b- defN 22-Aug-29 13:31 hat/drivers/ssdp.py
 -rw-r--r--  2.0 unx    10153 b- defN 23-Jan-23 17:39 hat/drivers/tcp.py
 -rw-r--r--  2.0 unx     4036 b- defN 21-Feb-23 13:44 hat/drivers/tpkt.py
 -rw-r--r--  2.0 unx     2756 b- defN 22-May-10 19:12 hat/drivers/udp.py
 -rw-r--r--  2.0 unx    15198 b- defN 22-Jul-16 23:39 hat/drivers/acse/__init__.py
--rw-r--r--  2.0 unx     8498 b- defN 23-Jan-23 20:01 hat/drivers/acse/asn1_repo.json
+-rw-r--r--  2.0 unx     8498 b- defN 23-Jan-23 22:11 hat/drivers/acse/asn1_repo.json
 -rw-r--r--  2.0 unx     1024 b- defN 22-Nov-01 19:30 hat/drivers/cdt/__init__.py
 -rw-r--r--  2.0 unx      286 b- defN 22-Oct-30 23:00 hat/drivers/cdt/browser.py
 -rw-r--r--  2.0 unx     3476 b- defN 22-Oct-30 23:23 hat/drivers/cdt/connection.py
 -rw-r--r--  2.0 unx      596 b- defN 22-Nov-01 19:29 hat/drivers/cdt/page.py
 -rw-r--r--  2.0 unx     1297 b- defN 22-Oct-30 23:31 hat/drivers/cdt/runtime.py
 -rw-r--r--  2.0 unx     2859 b- defN 22-Oct-30 23:08 hat/drivers/cdt/target.py
 -rw-r--r--  2.0 unx    14325 b- defN 22-Jul-16 23:39 hat/drivers/copp/__init__.py
--rw-r--r--  2.0 unx    12628 b- defN 23-Jan-23 20:01 hat/drivers/copp/asn1_repo.json
+-rw-r--r--  2.0 unx    12628 b- defN 23-Jan-23 22:11 hat/drivers/copp/asn1_repo.json
 -rw-r--r--  2.0 unx     7994 b- defN 22-Nov-22 02:28 hat/drivers/iec101/__init__.py
 -rw-r--r--  2.0 unx    16692 b- defN 22-Nov-22 00:17 hat/drivers/iec101/common.py
 -rw-r--r--  2.0 unx     1025 b- defN 22-Nov-22 02:00 hat/drivers/iec101/connection.py
 -rw-r--r--  2.0 unx    33150 b- defN 22-Dec-07 00:44 hat/drivers/iec101/encoder.py
 -rw-r--r--  2.0 unx     3592 b- defN 22-Nov-22 00:18 hat/drivers/iec103/__init__.py
 -rw-r--r--  2.0 unx     4230 b- defN 22-Nov-22 00:19 hat/drivers/iec103/common.py
 -rw-r--r--  2.0 unx    17825 b- defN 22-Dec-07 00:44 hat/drivers/iec103/master.py
@@ -57,21 +57,21 @@
 -rw-r--r--  2.0 unx      182 b- defN 22-Nov-22 00:15 hat/drivers/iec60870/msgs/iec104/__init__.py
 -rw-r--r--  2.0 unx     9677 b- defN 22-Dec-06 20:26 hat/drivers/iec60870/msgs/iec104/common.py
 -rw-r--r--  2.0 unx    10043 b- defN 22-Dec-07 02:11 hat/drivers/iec60870/msgs/iec104/encoder.py
 -rw-r--r--  2.0 unx      203 b- defN 22-Dec-06 20:15 hat/drivers/iec60870/msgs/security/__init__.py
 -rw-r--r--  2.0 unx     7219 b- defN 22-Dec-15 08:40 hat/drivers/iec60870/msgs/security/common.py
 -rw-r--r--  2.0 unx    25326 b- defN 22-Dec-19 12:43 hat/drivers/iec60870/msgs/security/encoder.py
 -rw-r--r--  2.0 unx     4434 b- defN 21-Feb-07 20:54 hat/drivers/mms/__init__.py
--rw-r--r--  2.0 unx   186717 b- defN 23-Jan-23 20:01 hat/drivers/mms/asn1_repo.json
+-rw-r--r--  2.0 unx   186717 b- defN 23-Jan-23 22:11 hat/drivers/mms/asn1_repo.json
 -rw-r--r--  2.0 unx    10223 b- defN 22-Apr-11 21:00 hat/drivers/mms/common.py
 -rw-r--r--  2.0 unx    13095 b- defN 22-Jul-16 23:41 hat/drivers/mms/connection.py
 -rw-r--r--  2.0 unx    26923 b- defN 21-Jan-19 20:56 hat/drivers/mms/encoder.py
 -rw-r--r--  2.0 unx     1112 b- defN 23-Jan-07 03:37 hat/drivers/modbus/__init__.py
 -rw-r--r--  2.0 unx      532 b- defN 21-May-19 00:33 hat/drivers/modbus/common.py
--rw-r--r--  2.0 unx    11655 b- defN 23-Jan-23 19:41 hat/drivers/modbus/master.py
+-rw-r--r--  2.0 unx    12155 b- defN 23-Jan-23 22:08 hat/drivers/modbus/master.py
 -rw-r--r--  2.0 unx    15351 b- defN 23-Jan-07 20:35 hat/drivers/modbus/slave.py
 -rw-r--r--  2.0 unx     3526 b- defN 23-Jan-06 17:57 hat/drivers/modbus/transport/__init__.py
 -rw-r--r--  2.0 unx     5176 b- defN 23-Jan-06 17:55 hat/drivers/modbus/transport/common.py
 -rw-r--r--  2.0 unx     3907 b- defN 23-Jan-23 19:38 hat/drivers/modbus/transport/connection.py
 -rw-r--r--  2.0 unx    19777 b- defN 23-Jan-07 19:45 hat/drivers/modbus/transport/encoder.py
 -rw-r--r--  2.0 unx      823 b- defN 22-Sep-12 23:42 hat/drivers/pnetgateway/__init__.py
 -rw-r--r--  2.0 unx     6161 b- defN 22-Sep-12 23:59 hat/drivers/pnetgateway/client.py
@@ -80,20 +80,20 @@
 -rw-r--r--  2.0 unx      791 b- defN 23-Jan-07 20:49 hat/drivers/pnetgateway/transport.py
 -rw-r--r--  2.0 unx     2029 b- defN 22-May-10 19:12 hat/drivers/snmp/__init__.py
 -rw-r--r--  2.0 unx     6184 b- defN 22-May-10 19:12 hat/drivers/snmp/agent.py
 -rw-r--r--  2.0 unx     4942 b- defN 22-May-10 19:12 hat/drivers/snmp/common.py
 -rw-r--r--  2.0 unx     7545 b- defN 22-May-10 19:12 hat/drivers/snmp/manager.py
 -rw-r--r--  2.0 unx    12648 b- defN 22-May-11 11:37 hat/drivers/snmp/trap.py
 -rw-r--r--  2.0 unx     2511 b- defN 22-Jul-16 23:43 hat/drivers/snmp/encoder/__init__.py
--rw-r--r--  2.0 unx     9211 b- defN 23-Jan-23 20:01 hat/drivers/snmp/encoder/asn1_repo.json
+-rw-r--r--  2.0 unx     9211 b- defN 23-Jan-23 22:11 hat/drivers/snmp/encoder/asn1_repo.json
 -rw-r--r--  2.0 unx     6259 b- defN 22-May-10 19:12 hat/drivers/snmp/encoder/v1.py
 -rw-r--r--  2.0 unx     7937 b- defN 22-May-10 19:12 hat/drivers/snmp/encoder/v2c.py
 -rw-r--r--  2.0 unx     1943 b- defN 22-May-10 19:12 hat/drivers/snmp/encoder/v3.py
 -rw-r--r--  2.0 unx       34 b- defN 21-May-03 22:27 hat/drivers/upnp/__init__.py
 -rw-r--r--  2.0 unx     3199 b- defN 21-May-03 22:25 hat/drivers/upnp/description.py
--rw-r--r--  2.0 unx    11358 b- defN 23-Jan-23 20:01 hat_drivers-0.6.8.dist-info/LICENSE
--rw-r--r--  2.0 unx     2063 b- defN 23-Jan-23 20:01 hat_drivers-0.6.8.dist-info/METADATA
--rw-r--r--  2.0 unx      132 b- defN 23-Jan-23 20:01 hat_drivers-0.6.8.dist-info/WHEEL
--rw-r--r--  2.0 unx        4 b- defN 23-Jan-23 20:01 hat_drivers-0.6.8.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 23-Jan-23 20:01 hat_drivers-0.6.8.dist-info/zip-safe
-?rw-rw-r--  2.0 unx     8689 b- defN 23-Jan-23 20:01 hat_drivers-0.6.8.dist-info/RECORD
-97 files, 877414 bytes uncompressed, 142985 bytes compressed:  83.7%
+-rw-r--r--  2.0 unx    11358 b- defN 23-Jan-23 22:11 hat_drivers-0.6.9.dist-info/LICENSE
+-rw-r--r--  2.0 unx     2063 b- defN 23-Jan-23 22:11 hat_drivers-0.6.9.dist-info/METADATA
+-rw-r--r--  2.0 unx      132 b- defN 23-Jan-23 22:11 hat_drivers-0.6.9.dist-info/WHEEL
+-rw-r--r--  2.0 unx        4 b- defN 23-Jan-23 22:11 hat_drivers-0.6.9.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 23-Jan-23 22:11 hat_drivers-0.6.9.dist-info/zip-safe
+?rw-rw-r--  2.0 unx     8689 b- defN 23-Jan-23 22:11 hat_drivers-0.6.9.dist-info/RECORD
+97 files, 877914 bytes uncompressed, 143074 bytes compressed:  83.7%
```

## zipnote {}

```diff
@@ -267,26 +267,26 @@
 
 Filename: hat/drivers/upnp/__init__.py
 Comment: 
 
 Filename: hat/drivers/upnp/description.py
 Comment: 
 
-Filename: hat_drivers-0.6.8.dist-info/LICENSE
+Filename: hat_drivers-0.6.9.dist-info/LICENSE
 Comment: 
 
-Filename: hat_drivers-0.6.8.dist-info/METADATA
+Filename: hat_drivers-0.6.9.dist-info/METADATA
 Comment: 
 
-Filename: hat_drivers-0.6.8.dist-info/WHEEL
+Filename: hat_drivers-0.6.9.dist-info/WHEEL
 Comment: 
 
-Filename: hat_drivers-0.6.8.dist-info/top_level.txt
+Filename: hat_drivers-0.6.9.dist-info/top_level.txt
 Comment: 
 
-Filename: hat_drivers-0.6.8.dist-info/zip-safe
+Filename: hat_drivers-0.6.9.dist-info/zip-safe
 Comment: 
 
-Filename: hat_drivers-0.6.8.dist-info/RECORD
+Filename: hat_drivers-0.6.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## hat/drivers/modbus/master.py

```diff
@@ -282,35 +282,35 @@
 
         return res_adu.pdu
 
     async def _send_loop(self):
         mlog.debug("starting master send loop")
         future = None
         try:
-            while True:
+            while self.is_open:
                 async with self.async_group.create_subgroup() as subgroup:
                     subgroup.spawn(self._reset_input_buffer_loop)
                     mlog.debug("started discarding incomming data")
 
                     while not future or future.done():
                         req_adu, future = await self._send_queue.get()
 
                 await self._reset_input_buffer()
                 mlog.debug("stopped discarding incomming data")
 
                 await self._conn.send(req_adu)
 
-                res_adu = await self._conn.receive(
-                    modbus_type=self._modbus_type,
-                    direction=transport.Direction.RESPONSE)
+                async with self.async_group.create_subgroup() as subgroup:
+                    task = subgroup.spawn(self._receive)
 
-                if future.done():
-                    continue
+                    await asyncio.wait([task, future],
+                                       return_when=asyncio.FIRST_COMPLETED)
 
-                future.set_result(res_adu)
+                    if task.done() and self.is_open and not future.done():
+                        future.set_result(task.result())
 
         except ConnectionError:
             pass
 
         except Exception as e:
             mlog.error("error in send loop: %s", e, exc_info=e)
 
@@ -341,7 +341,20 @@
             self.close()
 
     async def _reset_input_buffer(self):
         count = await self._conn.reset_input_buffer()
         if not count:
             return
         mlog.debug("discarded %s bytes from input buffer", count)
+
+    async def _receive(self):
+        try:
+            return await self._conn.receive(
+                modbus_type=self._modbus_type,
+                direction=transport.Direction.RESPONSE)
+
+        except ConnectionError:
+            self.close()
+
+        except Exception as e:
+            mlog.error("receive error: %s", e, exc_info=e)
+            self.close()
```

## Comparing `hat_drivers-0.6.8.dist-info/LICENSE` & `hat_drivers-0.6.9.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `hat_drivers-0.6.8.dist-info/METADATA` & `hat_drivers-0.6.9.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: hat-drivers
-Version: 0.6.8
+Version: 0.6.9
 Summary: Hat communication drivers
 Home-page: https://github.com/hat-open/hat-drivers
 License: Apache-2.0
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: Apache Software License
 Requires-Python: >=3.8
 Description-Content-Type: text/x-rst
```

## Comparing `hat_drivers-0.6.8.dist-info/RECORD` & `hat_drivers-0.6.9.dist-info/RECORD`

 * *Files 2% similar despite different names*

```diff
@@ -62,15 +62,15 @@
 hat/drivers/mms/__init__.py,sha256=tJgjZad0VPvnGg0bcsAafF3XiBb-oPRhw5ZWJqLmpP8,4434
 hat/drivers/mms/asn1_repo.json,sha256=kgJs61OAUoruZ_8rTEQyKn4ZZoTNYiUS1t9h-vZZEuk,186717
 hat/drivers/mms/common.py,sha256=U7zZARJIQaYPPDchZtXNYXWlFFJ_cYUc6qK4vBWGSY0,10223
 hat/drivers/mms/connection.py,sha256=IjyfBOo2JFJrauT6dfnR-ERrPiARObNQ3NaWZS-RURk,13095
 hat/drivers/mms/encoder.py,sha256=-YUA_by7ejs1A5yo1hBv5v8dYu-SEw72gbVUBYu5CZI,26923
 hat/drivers/modbus/__init__.py,sha256=0QHorC_OjrIKfxZeEY1FU7RIOY1vl2jJCwbg09WcomM,1112
 hat/drivers/modbus/common.py,sha256=i7ZdYxQ4S9XAg0VF6MZ-__OK2-xwIjfQrFC5NGTVNOo,532
-hat/drivers/modbus/master.py,sha256=e1p_vWkb3RykqakyFEOf7goiFx5dUyGxsOAzauWLBgc,11655
+hat/drivers/modbus/master.py,sha256=LrjUaH_kayhJ_KuTXvAbyueQdao5ioBeLM-TcuBTtLs,12155
 hat/drivers/modbus/slave.py,sha256=Mqlibee44JCqFI3vQ3TV5vJI_pNYOEjj0tB4oYg9bLQ,15351
 hat/drivers/modbus/transport/__init__.py,sha256=BaavJsOVBa_ruNub5XSd1mlrSVHQBvj5kexEVj9D14s,3526
 hat/drivers/modbus/transport/common.py,sha256=5bHGDrOR05H58Jo93piz_Du9DX_sSYPF-PJhEjdjGBs,5176
 hat/drivers/modbus/transport/connection.py,sha256=rfbqMo73FzBN09W7hZbc-nnaajWS16Iqj3nNxHGeq30,3907
 hat/drivers/modbus/transport/encoder.py,sha256=HsBePlLUf8hTukWz8YjTwerV74mbBo67EQQuRUWKajQ,19777
 hat/drivers/pnetgateway/__init__.py,sha256=H6q9I-xn4rf0Z0YUoVgJgLao8ihOGaQPFWYo0YIGhmA,823
 hat/drivers/pnetgateway/client.py,sha256=NDfR9HNeKwzTPIQu0LQWOWgmGemRny-OZ_VmORbQJrI,6161
@@ -85,13 +85,13 @@
 hat/drivers/snmp/encoder/__init__.py,sha256=QP0qXyogN-3fuI-fPSeGQf5NmCnOD5jX4kV2UymXzzY,2511
 hat/drivers/snmp/encoder/asn1_repo.json,sha256=pW-zNotno2j-q-RPNtike2yzyMMPL3S9Ls-ctSFglMc,9211
 hat/drivers/snmp/encoder/v1.py,sha256=0y-FRLx4do2zVcZ2vi00w3ZUF9wB05eQya1f_EyZm0U,6259
 hat/drivers/snmp/encoder/v2c.py,sha256=GYa-vj74W7uqsqJkxCicBBpcfLjfNW4Cq3ERZvOp63M,7937
 hat/drivers/snmp/encoder/v3.py,sha256=bY5yBFvw-SdoaIo_5hr0e_7vUvHhPrSZen9eF9CqHlY,1943
 hat/drivers/upnp/__init__.py,sha256=DmKhdhUxEVXPtrJ1IY4xavSZvAimJJVP86ikJrMJ8Wk,34
 hat/drivers/upnp/description.py,sha256=cC1ywmOwjh24m9j6seUciQ7VcTaHMe2Iua2RcgTPVrc,3199
-hat_drivers-0.6.8.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-hat_drivers-0.6.8.dist-info/METADATA,sha256=snbyXEn3oaVkFsSSW9HJLA8xW36iaFIP2LcAsXuZeDY,2063
-hat_drivers-0.6.8.dist-info/WHEEL,sha256=CV8iyE3A7V2uhg9OaTlpshab_dzxBhIEuLDh8OHPmAw,132
-hat_drivers-0.6.8.dist-info/top_level.txt,sha256=3RuRoRsaXQZNKwr3T2RE9XepBRTk4YpnXUbMiH5nes8,4
-hat_drivers-0.6.8.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-hat_drivers-0.6.8.dist-info/RECORD,,
+hat_drivers-0.6.9.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+hat_drivers-0.6.9.dist-info/METADATA,sha256=tQ6kFRACUSeLe1sRhqLsKbhEUeic6nXkzW3CmZfAaH8,2063
+hat_drivers-0.6.9.dist-info/WHEEL,sha256=CV8iyE3A7V2uhg9OaTlpshab_dzxBhIEuLDh8OHPmAw,132
+hat_drivers-0.6.9.dist-info/top_level.txt,sha256=3RuRoRsaXQZNKwr3T2RE9XepBRTk4YpnXUbMiH5nes8,4
+hat_drivers-0.6.9.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+hat_drivers-0.6.9.dist-info/RECORD,,
```

